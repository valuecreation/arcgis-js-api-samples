"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9473],{28769:(e,t,i)=>{i.d(t,{vF:()=>E,_D:()=>y,Qp:()=>S,P_:()=>M,Hq:()=>C,zD:()=>c,tB:()=>v,nF:()=>g,VO:()=>x,kZ:()=>q,kr:()=>P}),i(15572);var s=i(76877),r=i(43388),n=i(89462),a=i(87320),o=i(11559),l=i(3982),h=i(75508);const p=5e-4,u=function(e,t){const i=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||i)},d={3395:20037508.342789244,3410:17334193.943686873,3832:3339584.723798206,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,8858:7396237.374497803,8859:2465412.4581659334,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53025:7276828.3848298555,53031:10384677.558821043,53034:20015086.79602057,53036:7389443.187332862,53037:2463147.729110953,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54025:7311399.09166516,54031:10396310.810074743,54034:20037508.342789244,54050:808820.9223376509,54053:1920897.3915568967,54079:20037508.342789244,54080:20037508.342789244,54099:13524439.768288724,54100:20037508.342789244,54101:20037508.342789244,102038:4297258.582585486,102299:5013965.117483125};async function c(){if((0,a.kR)()||!(0,a.Gb)())return null;await(0,a.zD)()}function y(e,t,i){if(!u(e.spatialReference,t))return null;if(!(0,a.kR)())throw new s.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");return i?(0,a.rS)(t,e.spatialReference,e):(0,a.rS)(e.spatialReference,t,e)}function x(e,t,i,r=null){if(e.spatialReference.equals(t))return e;const n=u(e.spatialReference,t);if(n&&!(0,a.kR)())throw new s.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");const h=i.center,p=new l.Z({xmin:h.x-e.x/2,xmax:h.x+e.x/2,ymin:h.y-e.y/2,ymax:h.y+e.y/2,spatialReference:e.spatialReference}),d=n?(0,a.iV)(p,t,r):(0,o.iV)(p,t);return null==d?null:{x:d.xmax-d.xmin,y:d.ymax-d.ymin}}function m(e,t=.01){return(0,n.c9)(e)?t/(0,n.c9)(e):0}function g(e,t,i=null,r=!0){const n=e.spatialReference;if(n.equals(t))return e;const l=u(n,t);if(l&&!(0,a.kR)())throw new s.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");const h=l?(0,a.iV)(e,t,i):(0,o.iV)(e,t);if(h&&r&&t.isGeographic){const[t,i]=b(n,!0),s=m(n);s&&null!=t&&null!=i&&(Math.abs(e.x-t)<s&&Math.abs(180-h.x)<p?h.x-=360:Math.abs(e.x-i)<s&&Math.abs(180+h.x)<p&&(h.x+=360))}return h}function f(e){const t=_(e[0].spatialReference);if(e.length<2||!(0,r.pC)(t))return e[0];let{xmin:i,xmax:s,ymin:n,ymax:a}=e[0];for(let i=1;i<e.length;i++){const r=e[i];s=r.xmax+t*i,n=Math.min(n,r.ymin),a=Math.max(a,r.ymax)}return new l.Z({xmin:i,xmax:s,ymin:n,ymax:a,spatialReference:e[0].spatialReference})}function v(e,t,i=null,s=!0){if(e.spatialReference.equals(t))return e;const n=C(e),a=_(e.spatialReference,!0);return(0,r.pC)(a)&&0!==n?f(e.clone().normalize().map((e=>w(e,t,i,s)))):w(e,t,i,s)}function w(e,t,i=null,r=!0){const n=e.spatialReference;if(n.equals(t))return e;const l=u(n,t);if(l&&!(0,a.kR)())throw new s.Z("rasterprojectionhelper-projectExtent","projection engine is not loaded");const d=l?(0,a.iV)(e,t,i):(0,o.iV)(e,t);let[c,y]=b(n,!0);if(d&&r&&n.isWebMercator&&t.isGeographic&&null!=c&&null!=y){const s=.001,r=1e3;if(Math.abs(e.xmin-c)<s&&Math.abs(y-e.xmax)>r&&Math.abs(180-d.xmax)<p){d.xmin=-180;const s=[];s.push(new h.Z(e.xmax,e.ymin,n)),s.push(new h.Z(e.xmax,(e.ymin+e.ymax)/2,n)),s.push(new h.Z(e.xmax,e.ymax,n));const r=s.map((e=>g(e,t,i))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));d.xmax=Math.max.apply(null,r)}if(Math.abs(e.xmax-y)<s&&Math.abs(c-e.xmin)>r&&Math.abs(180+d.xmin)<p){d.xmax=180;const s=[];s.push(new h.Z(e.xmin,e.ymin,n)),s.push(new h.Z(e.xmin,(e.ymin+e.ymax)/2,n)),s.push(new h.Z(e.xmin,e.ymax,n));const r=s.map((e=>g(e,t,i))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));d.xmin=Math.min.apply(null,r)}}[c,y]=b(t,!0);const x=m(t);return x&&null!=c&&null!=y&&(Math.abs(d.xmin-c)<x&&(d.xmin=c),Math.abs(d.xmax-y)<x&&(d.xmax=y)),d}function _(e,t=!1){const i=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*d[e.wkid]||null}function b(e,t=!1){const i=[],s=_(e,t);return(0,r.pC)(s)&&(i.push(-s/2),i.push(s/2)),i}function R(e,t,i,s){let r=(e-t)/i;return r-Math.floor(r)!=0?r=Math.floor(r):s&&(r-=1),r}function C(e,t=!1){const i=_(e.spatialReference);if(!(0,r.pC)(i))return 0;const s=t?0:-i/2;return R(e.xmax,s,i,!0)-R(e.xmin,s,i,!1)}function M(e){const t=e.storageInfo.origin.x,i=_(e.spatialReference,!0);if(!(0,r.pC)(i))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const s=i/2,{nativePixelSize:n,storageInfo:a,extent:o}=e,{maximumPyramidLevel:l,blockWidth:h,pyramidScalingFactor:p}=a;let u=n.x;const d=[],c=(0,r.pC)(e.transform)&&"gcs-shift"===e.transform.type,y=t+s,x=c?i-t:s-t;for(let e=0;e<=l;e++){const e=(o.xmax-t)/u/h,s=e-Math.floor(e)==0?e:Math.ceil(e),r=(i/2-t)/u/h,n=r-Math.floor(r)==0?r:Math.ceil(r),a=Math.floor(y/u/h),l=Math.round(y/u)%h,c=(h-Math.round(x/u)%h)%h;d.push({resolutionX:u,blockWidth:h,datsetColumnCount:s,worldColumnCountFromOrigin:n,leftMargin:l,rightPadding:c,originColumnOffset:a}),u*=p}return{originX:t,halfWorldWidth:s,pyramidsInfo:d,hasGCSSShiftTransform:c}}function S(e,t,i,n=null,o=null,l=!1,p=[32,32]){if(u(e.spatialReference,t.spatialReference)&&!(0,a.kR)())throw new s.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&t&&i))return null;const{xmin:d,ymin:c,xmax:y,ymax:x}=e,m=e.spatialReference,f=t.spatialReference,v=_(f);l=l||"gcs-shift"===(null==o?void 0:o.type);const w={x:p[0]*i.x,y:p[1]*i.y},b={cols:Math.ceil((y-d)/w.x-.1)+1,rows:Math.ceil((x-c)/w.y-.1)+1},R=w.x,C=w.y,M=[];let S,q=!1;for(let e=0;e<b.cols;e++){const i=[];for(let s=0;s<b.rows;s++){let a=g(new h.Z({x:d+R*e,y:x-C*s,spatialReference:m}),f,n);o&&(a=o.inverseTransform(a)),i.push(a),e>0&&l&&a&&S[s]&&(0,r.pC)(v)&&a.x<S[s].x&&(a.x+=v),a?(M.push((a.x-t.xmin)/(t.xmax-t.xmin)),M.push((t.ymax-a.y)/(t.ymax-t.ymin))):(M.push(NaN),M.push(NaN),q=!0)}S=i}const P=function(e,t){const i=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,s=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(i-e[2*t.rows+2]),Math.abs(s-e[2*t.rows+3])]}(M,b),E=new Float32Array((b.cols-1)*(b.rows-1)*2*6),I=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),Z=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<b.cols-1;e++){for(let t=0;t<b.rows-1;t++){let i=e*b.rows*2+2*t;const s=M[i],r=M[i+1],n=M[i+2],a=M[i+3];i+=2*b.rows;const o=M[i],l=M[i+1],h=M[i+2],p=M[i+3];let u=0,d=12*(t*(b.cols-1)+e);for(let e=0;e<3;e++)E[d++]=I[u++]*s+I[u++]*n+I[u++]*h;u=0;for(let e=0;e<3;e++)E[d++]=I[u++]*r+I[u++]*a+I[u++]*p;u=0;for(let e=0;e<3;e++)E[d++]=Z[u++]*s+Z[u++]*o+Z[u++]*h;u=0;for(let e=0;e<3;e++)E[d++]=Z[u++]*r+Z[u++]*l+Z[u++]*p}if(q)for(let e=0;e<E.length;e++)isNaN(E[e])&&(E[e]=-1)}return{offsets:M,error:P,coefficients:E,spacing:p,size:[b.cols-1,b.rows-1]}}function q(e){const t=e.clone().normalize();return 1===t.length?t[0]:f(t)}function P(e,t,i){const{storageInfo:s,pixelSize:n}=t;let a,o=!1;const{pyramidResolutions:l}=s;if((0,r.pC)(l)&&l.length){const s=(e.x+e.y)/2,r=l[l.length-1],p=(r.x+r.y)/2,u=(n.x+n.y)/2;if(s<=u)a=0;else if(s>=p)a=l.length,o=s/p>8;else{let e,t=u;for(let r=1;r<=l.length;r++){if(e=(l[r-1].x+l[r-1].y)/2,s<=e){s===e?a=r:"down"===i?(a=r-1,o=s/t>8):a="up"===i||s-t>e-s||s/t>2?r:r-1;break}t=e}}const d=0===a?n:l[a-1];return{pyramidLevel:a,pyramidResolution:new h.Z({x:d.x,y:d.y,spatialReference:t.spatialReference}),excessiveReading:o}}const p=Math.log(e.x/n.x)/Math.LN2,u=Math.log(e.y/n.y)/Math.LN2,d=t.storageInfo.maximumPyramidLevel||0;a="down"===i?Math.floor(Math.min(p,u)):"up"===i?Math.ceil(Math.max(p,u)):Math.round((p+u)/2),a<0?a=0:a>d&&(o=a>d+3,a=d);const c=2**a;return{pyramidLevel:a,pyramidResolution:new h.Z({x:c*t.nativePixelSize.x,y:c*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}function E(e,t,i=512,s=!0){const{extent:r,spatialReference:a,pixelSize:o}=e,l=x(new h.Z({x:o.x,y:o.y,spatialReference:a}),t,r);if(null==l)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const p=(l.x+l.y)/2,u=(0,n.c9)(t),d=p*u*96*39.37,c=t.isGeographic?256/i*295828763.7958547:256/i*591657527.591555;let y=!1;const m=v(r,t);s&&(t.isGeographic||t.isWebMercator)&&(y=m.xmin*m.xmax<0);let g,f=d;const w=1.001;if(y){f=c;const e=t.isGeographic?1341104507446289e-21:.29858214164761665,i=e*(96*u*39.37),s=t.isGeographic?4326:3857;g=x(new h.Z({x:e,y:e,spatialReference:{wkid:s}}),a,m),g.x*=f/i,g.y*=f/i}else{g={x:o.x,y:o.y};const t=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let i=0;for(;f<c*(w/2)&&i<t;)i++,f*=2,g.x*=2,g.y*=2;Math.max(f,c)/Math.min(f,c)<=w&&(f=c)}const _=[f],b=[{x:g.x,y:g.y}],R=Math.min(70.5310735,d)/w;for(;f>=R;)f/=2,g.x/=2,g.y/=2,_.push(f),b.push({x:g.x,y:g.y});return{projectedPixelSize:l,scales:_,srcResolutions:b,isCustomTilingScheme:!y}}},46841:(e,t,i)=>{i.d(t,{KC:()=>d,QI:()=>c,Yx:()=>l,BH:()=>y});var s=i(43388),r=i(32911);const n=180/Math.PI,a=function(e){return e&&"esri.layers.support.PixelBlock"===e.declaredClass&&e.pixels&&e.pixels.length>0},o=new Map;function l(e,t){return o.get(e)/o.get(t)||1}function h(e){return(450-e)%360}function p(e,t="geographic"){const[i,s]=e,r=Math.sqrt(i*i+s*s);let a=Math.atan2(s,i)*n;return a=(360+a)%360,"geographic"===t&&(a=h(a)),[r,a]}function u(e,t="geographic"){let i=e[1];"geographic"===t&&(i=h(i)),i%=360;const s=e[0];return[s*Math.cos(i/n),s*Math.sin(i/n)]}function d(e,t,i="geographic",s=1){if(!a(e))return e;const{pixels:n,width:o,height:l}=e,h=o*l,d=n[0],c=n[1],y=r.Z.createEmptyBand(e.pixelType,h),x=r.Z.createEmptyBand(e.pixelType,h);let m=0;for(let e=0;e<l;e++)for(let e=0;e<o;e++)"vector-uv"===t?([y[m],x[m]]=p([d[m],c[m]],i),y[m]*=s):([y[m],x[m]]=u([d[m],c[m]],i),y[m]*=s,x[m]*=s),m++;const g=new r.Z({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[y,x]});return g.updateStatistics(),g}function c(e,t,i=1){if(1===i||!a(e))return e;const s=e.clone(),{pixels:r,width:n,height:o}=s,l=r[0],h=r[1];let p=0;for(let e=0;e<o;e++)for(let e=0;e<n;e++)"vector-uv"===t?(l[p]*=i,h[p]*=i):l[p]*=i,p++;return s.updateStatistics(),s}function y(e,t,i,r,n){if(!(0,s.pC)(n)||!n.spatialReference.equals(e.spatialReference))return{extent:e,width:t,height:i,resolution:e.width/t};const a=n.xmin,o=n.ymax;r=Math.max(r||0,30);const l=Math.ceil(t*(1/r)),h=Math.ceil(i*(1/r)),p=((e.xmax-e.xmin)/l+(e.ymax-e.ymin)/h)/2;return e.xmin=a+Math.floor((e.xmin-a)/p)*p,e.xmax=a+Math.ceil((e.xmax-a)/p)*p,e.ymin=o+Math.floor((e.ymin-o)/p)*p,e.ymax=o+Math.ceil((e.ymax-o)/p)*p,{extent:e,width:Math.round(e.width/p),height:Math.round(e.height/p),resolution:p}}o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704)},47410:(e,t,i)=>{i.d(t,{e:()=>p});var s=i(40341),r=i(47980),n=i(24899),a=(i(60663),i(79830),i(32780),i(62146),i(61605),i(23265),i(16820)),o=(i(65585),i(35180)),l=i(85439);function h(e,t,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return t&&i&&(s.width=t,s.height=i),new a.Z(e,s)}class p extends o.s{constructor(e=null,t,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.transforms={dvs:(0,r.c)()},this.blendFunction=t,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){this._source=e,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}setTransform(e){const t=(0,s.b)(this.transforms.dvs),[i,r]=e.toScreenNoRotation([0,0],this.x,this.y),a=this.resolution/this.pixelRatio/e.resolution,o=a*this.width,l=a*this.height,h=Math.PI*this.rotation/180;(0,s.c)(t,t,(0,n.f)(i,r)),(0,s.c)(t,t,(0,n.f)(o/2,l/2)),(0,s.r)(t,t,-h),(0,s.c)(t,t,(0,n.f)(-o/2,-l/2)),(0,s.k)(t,t,(0,n.f)(o,l)),(0,s.m)(this.transforms.dvs,e.displayViewMat3,t)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind(e,t){this._texture&&e.bindTexture(this._texture,t)}updateTexture(e){var t;if(!this.stage)return null==(t=this._texture)||t.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=h(e,this.sourceWidth,this.sourceHeight):this._texture=h(e));const i=this.source;if(i){if(this._texture.resize(this.sourceWidth,this.sourceHeight),function(e){return e&&"render"in e}(i))if(i instanceof l.Z){const e=i.getRenderedRasterPixels();this._texture.setData(e.renderedRasterPixels)}else this._texture.setData(function(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}(i));else(function(e){return e&&!("render"in e)})(i)&&this._texture.setData(i);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}},9959:(e,t,i)=>{i.d(t,{c:()=>a});var s=i(72528),r=i(78281),n=i(58627);class a extends n.Z{get requiresDedicatedFBO(){return this.children.some((e=>"additive"===e.blendFunction))}prepareRenderPasses(e){const t=e.registerRenderPass({name:"bitmap",brushes:[s.U.bitmap],target:()=>this.children,drawPhase:r.jx.MAP});return[...super.prepareRenderPasses(e),t]}}},85439:(e,t,i)=>{i.d(t,{Z:()=>s});const s=class{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return this.pixelBlock?this.pixelBlock.width:0}get height(){return this.pixelBlock?this.pixelBlock.height:0}render(e){const t=this.pixelBlock;if(!t)return;const i=this.filter({pixelBlock:t}),s=i.pixelBlock.getAsRGBA(),r=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);r.data.set(s),e.putImageData(r,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}},99473:(e,t,i)=>{i.r(t),i.d(t,{default:()=>F});var s=i(23324),r=i(77030),n=i(74791),a=(i(32780),i(76997),i(20337)),o=i(72903),l=i(54379),h=i(13470),p=i(57603),u=i(22685),d=i(43388),c=i(19955),y=i(96255),x=i(43329),m=i(3982),g=i(28769),f=i(46841),v=i(68670),w=i(63201),_=i(60722),b=i(15543);const R=a.Z.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");let C=class extends u.Z{constructor(){super(...arguments),this.attached=!1,this.container=new w.W,this.updateRequested=!1,this._graphicsView=null,this._projectFullExtentPromise=null,this._previousExtents=[],this._previousSymbolTileResolution=0,this._previousRendererSignature="",this.type="Graphics",this._graphics=new v.ZP,this._updateGraphics=(0,c.Ds)((async(e,t)=>{if(!e.stationary)return;const i=e.state,s=new m.Z({xmin:i.extent.xmin,ymin:i.extent.ymin,xmax:i.extent.xmax,ymax:i.extent.ymax,spatialReference:i.spatialReference}),[r,n]=e.state.size,a={};a.timeExtent=this.timeExtent,a.requestAsImageElement=!1,a.signal=t,null==this._projectFullExtentPromise&&(this._projectFullExtentPromise=this._getProjectedFullExtent(s.spatialReference));const o="vector-field"===this.layer.renderer.type?this.layer.renderer.symbolTileSize:50,l=await this._projectFullExtentPromise,{extent:h,resolution:p,width:u,height:c}=(0,f.BH)(s,r,n,o,l),y=await this.layer.fetchImage(h,u,c,a),x=this.layer.renderer;if("vector-field"===x.type){const t=y.pixelData.pixelBlock,i=x.sizeVariables[0];i.minDataValue&&i.maxDataValue||(i.minDataValue=t.statistics[0].minValue,i.maxDataValue=t.statistics[0].maxValue),this._pixelData={extent:h,pixelBlock:y.pixelData.pixelBlock};const s=JSON.stringify(this.layer.renderer),r=this._previousRendererSignature===s,n=Math.abs(this._previousSymbolTileResolution-p)/p<.01,a=h.clone().normalize(),o=this._previousExtents.some((e=>a.some((t=>e.intersects(t))))),l=r&&n&&o?this._previousExtents:[],u=await x.getGraphicsFromPixelData(y.pixelData,"vector-uv"===this.layer.rasterInfo.dataType,l);if(l.length){const e=this._graphics.items.filter((e=>(0,d.pC)(e.geometry)&&l.some((t=>t.intersects(e.geometry)))&&!a.some((t=>t.intersects(e.geometry)))));this._graphics.removeMany(e),this._graphics.addMany(u)}else this._graphics.set("items",u);this._graphicsView.update(e),this._previousExtents=a,this._previousRendererSignature=s,this._previousSymbolTileResolution=p}}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this._updateGraphics(e).catch((e=>{(0,c.D_)(e)||R.error(e)}))}hitTest(e,t){const i=this.view.toMap((0,y.vW)(e,t));return Promise.resolve(new h.Z({attributes:{},geometry:i,layer:this.layer}))}attach(){this._graphicsView=new b.Z({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new _.Z(this.view.featuresTilingScheme)}),this.attached=!0}detach(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._graphicsView.container),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._graphicsView.container),e.removeChild(this.container)}isUpdating(){return this._graphicsView.updating||this.updateRequested}getPixelData(){return this.updating?null:this._pixelData}redraw(){}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}async _getProjectedFullExtent(e){try{return await(0,g.tB)(this.layer.fullExtent,e)}catch(t){try{const t=(await(0,p.default)(this.layer.url,{query:{option:"footprints",outSR:e.wkid||JSON.stringify(e.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return t?m.Z.fromJSON(t):null}catch{return null}}}};(0,s._)([(0,n.Cb)()],C.prototype,"attached",void 0),(0,s._)([(0,n.Cb)()],C.prototype,"container",void 0),(0,s._)([(0,n.Cb)()],C.prototype,"layer",void 0),(0,s._)([(0,n.Cb)()],C.prototype,"timeExtent",void 0),(0,s._)([(0,n.Cb)()],C.prototype,"view",void 0),(0,s._)([(0,n.Cb)()],C.prototype,"updateRequested",void 0),(0,s._)([(0,n.Cb)()],C.prototype,"updating",null),(0,s._)([(0,x.J)({graphics:"Graphics"})],C.prototype,"type",void 0),C=(0,s._)([(0,o.j)("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],C);const M=C;var S=i(62296),q=i(9959),P=i(85439),E=i(53284);const I=a.Z.getLogger("esri.views.2d.layers.imagery.ImageryView2D");let Z=class extends u.Z{constructor(){super(...arguments),this.attached=!1,this.container=new w.W,this.updateRequested=!1,this.type="Imagery",this._bitmapView=null}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch((e=>{(0,c.D_)(e)||I.error(e)}))}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}hitTest(e,t){const i=this.view.toMap((0,y.vW)(e,t));return Promise.resolve(new h.Z({attributes:{},geometry:i,layer:this.layer}))}attach(){const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new q.c,this.strategy=new E.Z({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()}),this.attached=!0}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._bitmapView),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._bitmapView),e.removeChild(this.container)}redraw(){this.strategy.updateExports((e=>{e.source instanceof HTMLImageElement?e.requestRender():this.layer.applyRenderer({pixelBlock:e.source.pixelBlock}).then((t=>{const i=e.source;i.pixelBlock=t.pixelBlock,i.filter=e=>this.layer.applyFilter(e),this.container.requestRender()}))}))}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,i=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),s=(0,S.Kh)(i,t);return s?{extent:s.extent,pixelBlock:s.pixelBlock}:null}return null}_fetchImage(e,t,i,s){return(s=s||{}).timeExtent=this.timeExtent,s.requestAsImageElement=!0,this.layer.fetchImage(e,t,i,s).then((e=>e.imageElement?e.imageElement:this.layer.applyRenderer(e.pixelData,{signal:s.signal}).then((t=>{const i=new P.Z(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return i.filter=e=>this.layer.applyFilter(e),i}))))}};(0,s._)([(0,n.Cb)()],Z.prototype,"attached",void 0),(0,s._)([(0,n.Cb)()],Z.prototype,"container",void 0),(0,s._)([(0,n.Cb)()],Z.prototype,"layer",void 0),(0,s._)([(0,n.Cb)()],Z.prototype,"strategy",void 0),(0,s._)([(0,n.Cb)()],Z.prototype,"timeExtent",void 0),(0,s._)([(0,n.Cb)()],Z.prototype,"view",void 0),(0,s._)([(0,n.Cb)()],Z.prototype,"updateRequested",void 0),(0,s._)([(0,n.Cb)()],Z.prototype,"updating",null),(0,s._)([(0,x.J)({imagery:"Imagery"})],Z.prototype,"type",void 0),Z=(0,s._)([(0,o.j)("esri.views.2d.layers.imagery.ImageryView2D")],Z);const k=Z;var V=i(76877),T=i(75508),j=i(23867),D=i(54945),B=i(42096);const U=e=>{let t=class extends e{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)throw new V.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:s}=i,r=(0,B.V)(i,t);if(!s||!(0,d.pC)(r))throw new V.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:s,popupTemplate:r});const n=await r.getRequiredFields(),a=new D.Z;a.timeExtent=this.timeExtent,a.geometry=e,a.outFields=n,a.outSpatialReference=e.spatialReference;const o=this.view.resolution,l="2d"===this.view.type?new T.Z(o,o,this.view.spatialReference):new T.Z(.5*o,.5*o,this.view.spatialReference),{returnTopmostRaster:h,showNoDataRecords:p}=r.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},u={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:l,showNoDataRecords:p,signal:(0,d.pC)(t)?t.signal:null};return i.queryVisibleRasters(a,u).then((e=>e))}canResume(){var e;return!(!super.canResume()||null!=(e=this.timeExtent)&&e.isEmpty)}};return(0,s._)([(0,n.Cb)()],t.prototype,"layer",void 0),(0,s._)([(0,n.Cb)()],t.prototype,"suspended",void 0),(0,s._)([(0,n.Cb)(j.qG)],t.prototype,"timeExtent",void 0),(0,s._)([(0,n.Cb)()],t.prototype,"view",void 0),t=(0,s._)([(0,o.j)("esri.views.layers.ImageryLayerView")],t),t};var N=i(4311),W=i(6682);let z=class extends(U((0,W.yc)((0,l.y)(N.Z)))){constructor(){super(...arguments),this._exportImageVersion=-1}initialize(){this.handles.add((0,r.S1)(this,["layer.blendMode"],(e=>{this.subview&&(this.subview.container.blendMode=e)}),!0))}get pixelData(){return this.updating?null:this.subview.getPixelData()}get updating(){return!(this.subview&&!this.subview.updating)}hitTest(e,t){return this.suspended||!this.subview?Promise.resolve(null):this.subview.hitTest(e,t)}update(e){var t;null==(t=this.subview)||t.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([(0,r.S1)(this,"layer.exportImageServiceParameters.version",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),this.watch("timeExtent",(()=>{this.subview.timeExtent=this.timeExtent,this.requestUpdate()})),this.layer.on("redraw",(()=>this.subview.redraw())),(0,r.YP)(this.layer,"renderer",(()=>this._setSubView()))],"imagerylayerview-update")}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove("imagerylayerview-update"),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||!this.suspended&&this.subview.isUpdating()}_setSubView(){var e;let t="Imagery";var i,s;"vector-field"===(null==(e=this.layer.renderer)?void 0:e.type)&&"lerc"===this.layer.format&&(t="Graphics"),this.subview&&this.subview.type===t||(null==(i=this.subview)||i.uninstall(this.container),null==(s=this.subview)||s.destroy(),this.subview="Imagery"===t?new k({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new M({layer:this.layer,view:this.view,timeExtent:this.timeExtent}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode),this.requestUpdate()}};(0,s._)([(0,n.Cb)()],z.prototype,"pixelData",null),(0,s._)([(0,n.Cb)({readOnly:!0})],z.prototype,"updating",null),(0,s._)([(0,n.Cb)()],z.prototype,"subview",void 0),z=(0,s._)([(0,o.j)("esri.views.2d.layers.ImageryLayerView2D")],z);const F=z},54379:(e,t,i)=>{i.d(t,{y:()=>q});var s=i(23324),r=i(72690),n=i(26299),a=i(77030),o=i(74791),l=(i(32780),i(76997),i(20337),i(72903)),h=i(63201),p=i(12210);let u=class extends p.wq{};u=(0,s._)([(0,l.j)("esri.views.layers.support.ClipArea")],u);const d=u;var c;let y=c=class extends d{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new c({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,s._)([(0,o.Cb)({type:[Number,String],json:{write:!0}})],y.prototype,"left",void 0),(0,s._)([(0,o.Cb)({type:[Number,String],json:{write:!0}})],y.prototype,"right",void 0),(0,s._)([(0,o.Cb)({type:[Number,String],json:{write:!0}})],y.prototype,"top",void 0),(0,s._)([(0,o.Cb)({type:[Number,String],json:{write:!0}})],y.prototype,"bottom",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],y.prototype,"version",null),y=c=(0,s._)([(0,l.j)("esri.views.layers.support.ClipRect")],y);const x=y;i(15572);var m,g=i(72155),f=i(9673),v=i(3982),w=i(18223);const _={base:g.Z,key:"type",typeMap:{extent:v.Z,polygon:w.Z}};let b=m=class extends d{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new m({geometry:this.geometry.clone()})}};(0,s._)([(0,o.Cb)({types:_,json:{read:f.im,write:!0}})],b.prototype,"geometry",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],b.prototype,"version",null),b=m=(0,s._)([(0,l.j)("esri.views.layers.support.Geometry")],b);const R=b;let C=class extends d{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,s._)([(0,o.Cb)({type:[[[Number]]],json:{write:!0}})],C.prototype,"path",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],C.prototype,"version",null),C=(0,s._)([(0,l.j)("esri.views.layers.support.Path")],C);const M=C,S=r.Z.ofType({key:"type",base:d,typeMap:{rect:x,path:M,geometry:R}}),q=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new S,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new h.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,a.S1)(this,"suspended",(e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),!0),(0,a.S1)(this,["layer.opacity","container"],(()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)}),!0),(0,a.S1)(this,["layer.blendMode"],(e=>{this.container&&(this.container.blendMode=e)}),!0),(0,a.S1)(this,["layer.effect"],(e=>{this.container&&(this.container.effect=e)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){let t=!0;const i=this.layer,s=i.minScale,r=i.maxScale;if(null!=s&&null!=r){let i=!s,n=!r;!i&&e<=s&&(i=!0),!n&&e>=r&&(n=!0),t=i&&n}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return(0,s._)([(0,o.Cb)({type:S,set(e){const t=(0,n.Z)(e,this._get("clips"),S);this._set("clips",t)}})],t.prototype,"clips",void 0),(0,s._)([(0,o.Cb)()],t.prototype,"moving",void 0),(0,s._)([(0,o.Cb)()],t.prototype,"attached",void 0),(0,s._)([(0,o.Cb)()],t.prototype,"container",void 0),(0,s._)([(0,o.Cb)()],t.prototype,"suspended",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],t.prototype,"updateParameters",void 0),(0,s._)([(0,o.Cb)()],t.prototype,"updateRequested",void 0),(0,s._)([(0,o.Cb)()],t.prototype,"updating",null),(0,s._)([(0,o.Cb)()],t.prototype,"view",void 0),t=(0,s._)([(0,l.j)("esri.views.2d.layers.LayerView2D")],t),t}},60722:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(78281),r=i(95814);class n extends r.Z{renderChildren(e){this.attributeView.bindTextures(e.context),this.children.some((e=>e.hasData))&&(super.renderChildren(e),e.drawPhase===s.jx.MAP&&this._renderChildren(e),e.drawPhase===s.jx.HIGHLIGHT&&this._renderHighlight(e))}_renderHighlight(e){const{painter:t}=e,i=t.effects.highlight;i.bind(e),this._renderChildren(e,i.defines),i.draw(e),i.unbind()}}const a=n},53284:(e,t,i)=>{i.d(t,{Z:()=>b});var s=i(23324),r=i(22685),n=i(19955),a=i(74791),o=(i(32780),i(76997),i(20337),i(72903)),l=i(3982),h=i(89805),p=i(54522),u=i(54552);const d=Math.PI/180;function c(e){return e*d}function y(e,t){const i=c(t.rotation),s=Math.abs(Math.cos(i)),r=Math.abs(Math.sin(i)),[n,a]=t.size;return e[0]=Math.round(a*r+n*s),e[1]=Math.round(a*s+n*r),e}var x=i(47410),m=i(22552),g=i(79630);const f=(0,h.Ue)(),v=[0,0],w=new g.Z(0,0,0,0);let _=class extends r.Z{constructor(e){super(e),this._imagePromise=null,this.bitmaps=[],this.hidpi=false,this.imageMaxWidth=2048,this.imageMaxHeight=2048,this.imageRotationSupported=false,this.imageNormalizationSupported=false,this.update=(0,n.Ds)((async(e,t)=>{if(!e.stationary||this.destroyed)return null;const i=e.state,s=(0,p.C5)(i.spatialReference),r=this.hidpi?e.pixelRatio:1,n=this.imageNormalizationSupported&&i.worldScreenWidth&&i.worldScreenWidth<i.size[0];n?(v[0]=i.worldScreenWidth,v[1]=i.size[1]):this.imageRotationSupported?(v[0]=i.size[0],v[1]=i.size[1]):y(v,i);const a=Math.floor(v[0]*r)>this.imageMaxWidth||Math.floor(v[1]*r)>this.imageMaxHeight,o=s&&(i.extent.xmin<s.valid[0]||i.extent.xmax>s.valid[1]),l=!this.imageNormalizationSupported&&o,h=!a&&!l,u=this.imageRotationSupported?i.rotation:0;if(h){const e=n?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,v,e,i.resolution,u,r,t)}else{let e=Math.min(this.imageMaxWidth,this.imageMaxHeight);l&&(e=Math.min(i.worldScreenWidth,e)),this._imagePromise=this._tiledExport(i,e,u,r,t)}return this._imagePromise.then((async e=>{if(this._imagePromise=null,!this.destroyed){this.bitmaps=null!=e?e:[];for(const t of this.container.children)e.includes(t)||t.fadeOut().then((()=>{t.remove()}));for(const t of e)this.container.addChild(t),t.fadeIn()}})).catch((e=>{throw this._imagePromise=null,e}))}),5e3)}destroy(){this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}updateExports(e){for(const t of this.container.children){if(!t.visible||!t.stage)return;e(t),t.invalidateTexture(),t.requestRender()}}async _export(e,t,i,s,r,n){const a=await this.fetchSource(e,Math.floor(t*r),Math.floor(i*r),{rotation:s,pixelRatio:r,signal:n}),o=new x.e(a,"additive");return o.x=e.xmin,o.y=e.ymax,o.resolution=e.width/t,o.rotation=s,o.pixelRatio=r,o}async _singleExport(e,t,i,s,r,n,a){!function(e,t,i,s){const[r,n]=t,[a,o]=s,l=.5*i;e[0]=r-l*a,e[1]=n-l*o,e[2]=r+l*a,e[3]=n+l*o}(f,i,s,t);const o=new l.Z(f[0],f[1],f[2],f[3],e.spatialReference);return[await this._export(o,t[0],t[1],r,n,a)]}_tiledExport(e,t,i,s,r){const n=u.Z.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),a=new m.Z(n),o=a.getTileCoverage(e);if(!o)return null;const h=[];return o.forEach(((n,o,p,u)=>{w.set(n,o,p,u),a.getTileBounds(f,w);const d=new l.Z(f[0],f[1],f[2],f[3],e.spatialReference);h.push(this._export(d,t,t,i,s,r))})),Promise.all(h)}};(0,s._)([(0,a.Cb)()],_.prototype,"_imagePromise",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"bitmaps",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"container",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"fetchSource",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"hidpi",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"imageMaxWidth",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"imageMaxHeight",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"imageRotationSupported",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"imageNormalizationSupported",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"requestUpdate",void 0),(0,s._)([(0,a.Cb)()],_.prototype,"updating",null),_=(0,s._)([(0,o.j)("esri.views.2d.layers.support.ExportStrategy")],_);const b=_},4311:(e,t,i)=>{i.d(t,{Z:()=>c});var s=i(23324),r=i(22685),n=i(79001),a=i(47811),o=i(50194),l=i(20337),h=i(12659),p=i(74791),u=(i(32780),i(76997),i(72903));let d=class extends((0,a.p)((0,o.I)((0,h.v)(n.Z.EventedMixin(r.Z))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw l.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}}))}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,s._)([(0,p.Cb)()],d.prototype,"fullOpacity",null),(0,s._)([(0,p.Cb)()],d.prototype,"layer",void 0),(0,s._)([(0,p.Cb)()],d.prototype,"parent",void 0),(0,s._)([(0,p.Cb)({readOnly:!0})],d.prototype,"suspended",null),(0,s._)([(0,p.Cb)({readOnly:!0})],d.prototype,"suspendInfo",null),(0,s._)([(0,p.Cb)({readOnly:!0})],d.prototype,"legendEnabled",null),(0,s._)([(0,p.Cb)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),(0,s._)([(0,p.Cb)({readOnly:!0})],d.prototype,"updatingProgress",null),(0,s._)([(0,p.Cb)()],d.prototype,"visible",null),d=(0,s._)([(0,u.j)("esri.views.layers.LayerView")],d);const c=d},42096:(e,t,i)=>{i.d(t,{V:()=>a,e:()=>n});var s=i(43388),r=i(51531);async function n(e,t=e.popupTemplate){if(!(0,s.pC)(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:n}=t,{objectIdField:a,typeIdField:o,globalIdField:l,relationships:h}=e;if(i.includes("*"))return["*"];const p=n?await(0,r.CH)(e):[],u=(0,r.Q0)(e.fieldsIndex,[...i,...p]);return o&&u.push(o),u&&a&&e.fieldsIndex.has(a)&&-1===u.indexOf(a)&&u.push(a),u&&l&&e.fieldsIndex.has(l)&&-1===u.indexOf(l)&&u.push(l),h&&h.forEach((t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex.has(i)&&-1===u.indexOf(i)&&u.push(i)})),u}function a(e,t){return e.popupTemplate?e.popupTemplate:(0,s.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,s.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);