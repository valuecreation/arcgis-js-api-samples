{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/support/FeatureFilter.js","../node_modules/@arcgis/core/views/3d/layers/support/attributeUtils.js","../node_modules/@arcgis/core/views/3d/layers/graphics/QueryEngine.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFilterVisibility.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView.js","../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3DStateSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStateSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStates.js","../node_modules/@arcgis/core/views/3d/layers/graphics/ExtentSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DElevationAlignment.js","../node_modules/@arcgis/core/views/3d/layers/support/floorFilterUtils.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js"],"names":["d","m","i","esriSpatialRelIntersects","esriSpatialRelContains","esriSpatialRelCrosses","esriSpatialRelDisjoint","esriSpatialRelEnvelopeIntersects","esriSpatialRelIndexIntersects","esriSpatialRelOverlaps","esriSpatialRelTouches","esriSpatialRelWithin","esriSpatialRelRelation","u","esriSRUnit_Meter","esriSRUnit_Kilometer","esriSRUnit_Foot","esriSRUnit_StatuteMile","esriSRUnit_NauticalMile","esriSRUnit_USNauticalMile","h","s","constructor","e","super","this","where","geometry","spatialRelationship","hiddenIds","Set","distance","objectIds","units","timeExtent","enabled","writeWhere","t","enable","_set","createQuery","r","n","a","p","c","o","clone","l","forEach","add","type","String","prototype","types","json","read","write","source","reader","target","writer","Array","from","Number","overridePolicy","readOnly","y","toLowerCase","get","name","_dataQueryEngineInstance","layer","geometryType","outSpatialReference","spatialReference","toJSON","ensureDataQueryEngine","destroy","clear","dataQueryEngine","executeQueryForIdSet","_ensureQueryJSON","executeQueryForCount","count","extent","executeQueryForExtent","fromJSON","executeQueryForIds","executeQueryForLatestObservations","features","sourceLayer","executeQuery","defaultQueryJSON","timeInfo","objectIdField","queryGeometryType","fields","map","layerView","view","resourceController","scheduler","priority","graphics3d","graphicsCore","featureStore","hasZ","hasM","constructOnly","aliasOf","getLogger","_","filter","_dirty","_querying","_handles","_queryResult","setup","_layerView","_core","_objectIdField","_queryEngine","FILTER_VISIBILITY","registerTask","owner","_graphicsChanged","dirty","filterChanged","modifyGraphics3DGraphicVisibilities","clearVisibilityFlag","notifyChange","updateVisibility","active","hasVisibilityFlag","setVisibilityFlag","recomputeFilter","graphics3DGraphics","size","intersection","runTask","done","then","catch","warn","error","_getFeatureId","graphic","madeProgress","has","objectId","attributes","V","watchUpdatingTracking","C","suspendResumeExtentMode","dataExtent","suspendResumeExtent","scaleVisibility","suspended","outsideScaleRange","frustumVisibility","outsideOfView","updating","normalizeCtorArgs","frustumVisibilityEnabled","f","scaleVisibilityEnabled","w","filterVisibilityEnabled","timeExtentVisibilityEnabled","elevationAlignmentEnabled","g","preferredUpdatePolicy","elevationFeatureExpressionEnabled","graphicSymbolSupported","updateClippingExtent","filterVisibility","elevationAlignment","initialize","layerMinMaxScaleChangeHandler","addPromise","elevationInfoChange","updateVisibilityInfo","updateLabelingInfo","basemapTerrain","spatialIndex","queryGraphicUIDsInExtent","elevationProvider","b","labeler","addGraphicsOwner","deconflictor","deconfliction","labeling","objectStates","rendererChange","opacityChange","setupSuspendResumeExtent","_updateClippingExtent","startCreateGraphics","labelsEnabled","maskOccludee","set","handle","acquireSet","setUid","uid","highlight","queryObjectIds","setObjectIds","toArray","isArray","length","E","fieldsIndex","setUids","S","clippingArea","setClippingExtent","recreateAllGraphics","remove","j","updateSuspendResumeExtent","watch","computedExtent","suspendResumeExtentChanged","extentToSuspendResumeRect","equals","x","extentPadding","setExtent","dependsOn","v","pause","resume","items","addObject","push","objectStateId","object","addRenderGeometry","renderGeometry","addExternal","_removeObjectStateItem","splice","removeObject","removeRenderGeometry","removeAll","channel","removeHighlight","removeOcclude","removeRenderGeometryObjectState","stateType","objectStateSet","ids","paused","hasGraphic","_graphicsCore","_stateSets","releaseSet","indexOf","_addObjectStateSet","addObjectStateSet","_removeObjectStateSet","removeObjectState","initializeSet","addGraphic","removeGraphic","allGraphicsDeleted","states","_extents","allocator","_tmpExtent","contains","removeContained","pushNew","pop","mergeTight","merge","hasProgressed","sort","getItemAt","delete","some","filterInPlace","containsPoint","arguments","dirtyExtents","globalDirty","averageExtentUpdateSize","dirtyGraphicsSet","handles","updateElevation","events","on","_elevationChanged","suspendedChange","ELEVATION_ALIGNMENT","running","empty","markAllGraphicsElevationDirty","run","_updateDirtyGraphics","_updateDirtyExtents","setDirty","renderCoordsHelper","effectiveUpdatePolicy","keys","getGraphics3DGraphicById","alignWithElevation","emit","needsElevationUpdates","context","elevationInfo","mode","xmin","xmax","ymin","ymax","floorInfo","floors","floorField","join","extentIntersectionDirty","_isVisibleBelowSurface","extentIntersection","viewChange","state","FRUSTUM_VISIBILITY","elevationBoundsChange","viewingMode","isVisibleBelowSurface","updateIsVisibleBelowSurface","_setDirty","ground","navigationConstraint","opaque","updateExtentIntersection","radius","min","max","elevationBounds","Math","update","frustum","isVisibleInFrustum"],"mappings":"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","file":"static/js/5.29c9023b.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{geometryTypes as t}from\"../../../geometry.js\";import r from\"../../../TimeExtent.js\";import{JSONMap as i}from\"../../../core/jsonMap.js\";import{JSONSupport as s}from\"../../../core/JSONSupport.js\";import{clone as o}from\"../../../core/lang.js\";import{property as n}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{writer as p}from\"../../../core/accessorSupport/decorators/writer.js\";import{fromJSON as l}from\"../../../geometry/support/jsonUtils.js\";import c from\"../../../rest/support/Query.js\";var d;const m=new i({esriSpatialRelIntersects:\"intersects\",esriSpatialRelContains:\"contains\",esriSpatialRelCrosses:\"crosses\",esriSpatialRelDisjoint:\"disjoint\",esriSpatialRelEnvelopeIntersects:\"envelope-intersects\",esriSpatialRelIndexIntersects:\"index-intersects\",esriSpatialRelOverlaps:\"overlaps\",esriSpatialRelTouches:\"touches\",esriSpatialRelWithin:\"within\",esriSpatialRelRelation:\"relation\"}),u=new i({esriSRUnit_Meter:\"meters\",esriSRUnit_Kilometer:\"kilometers\",esriSRUnit_Foot:\"feet\",esriSRUnit_StatuteMile:\"miles\",esriSRUnit_NauticalMile:\"nautical-miles\",esriSRUnit_USNauticalMile:\"us-nautical-miles\"});let h=d=class extends s{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship=\"intersects\",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||\"1=1\"}enable(){this._set(\"enabled\",!0)}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:a,distance:p}=this;return new c({geometry:o(r),objectIds:o(n),spatialRelationship:i,timeExtent:o(s),where:t,units:a,distance:p,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,hiddenIds:i,timeExtent:s,objectIds:n,units:a,distance:p}=this,l=new Set;return i.forEach((e=>l.add(e))),new d({geometry:o(t),hiddenIds:l,objectIds:o(n),spatialRelationship:r,timeExtent:o(s),where:e,units:a,distance:p})}};e([n({type:String})],h.prototype,\"where\",void 0),e([p(\"where\")],h.prototype,\"writeWhere\",null),e([n({types:t,json:{read:l,write:!0}})],h.prototype,\"geometry\",void 0),e([n({type:String,json:{read:{source:\"spatialRel\",reader:m.read},write:{target:\"spatialRel\",writer:m.write}}})],h.prototype,\"spatialRelationship\",void 0),e([n({json:{write:(e,t,r)=>t[r]=Array.from(e),read:e=>new Set(e)}})],h.prototype,\"hiddenIds\",void 0),e([n({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],h.prototype,\"distance\",void 0),e([n({type:[Number],json:{write:!0}})],h.prototype,\"objectIds\",void 0),e([n({type:String,json:{read:u.read,write:{writer:u.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],h.prototype,\"units\",void 0),e([n({type:r,json:{write:!0}})],h.prototype,\"timeExtent\",void 0),e([n({readOnly:!0})],h.prototype,\"enabled\",void 0),h=d=e([a(\"esri.views.layers.support.FeatureFilter\")],h);var y=h;export default y;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nfunction n(n,t,e){if(!e||null==t)return null;if(!n)return r(t,e);const o=n.get(e);return o?t[o.name]:null}function r(n,r){const t=r.toLowerCase();for(const e in n)if(e.toLowerCase()===t)return n[e];return null}export{n as attributeLookup};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import r from\"../../../../core/Accessor.js\";import{isNone as t}from\"../../../../core/maybe.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../../geometry/Extent.js\";import o from\"../../../../layers/graphics/data/QueryEngine.js\";import i from\"../../../../rest/support/FeatureSet.js\";import u from\"../../../../rest/support/Query.js\";import{featureGeometryTypeKebabDictionary as y}from\"../../../../geometry/support/typeUtils.js\";const c=o;let l=class extends r{constructor(e){super(e),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case\"multipoint\":case\"point\":case\"polygon\":case\"polyline\":return this.layer.geometryType;case\"mesh\":return\"polygon\";default:return}}get defaultQueryJSON(){return new u({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}async executeQueryForIdSet(e,r){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),r)}async executeQueryForCount(e,r){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),r)}async executeQueryForExtent(e,r){const{count:t,extent:s}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),r);return{count:t,extent:n.fromJSON(s)}}async executeQueryForIds(e,r){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),r)}async executeQueryForLatestObservations(e,r){const t=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}async executeQuery(e,r){const t=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}_ensureQueryJSON(e){return t(e)?this.defaultQueryJSON:(\"outSpatialReference\"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=\"timeInfo\"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,r=this.layer.objectIdField,t=y.toJSON(this.queryGeometryType),s=this.layer.fields.map((e=>e.toJSON())),a=this.layerView.view.resourceController.scheduler,n=this.priority,o=this.spatialReference.toJSON(),i=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:u,hasM:l}=this.layerView;return this._dataQueryEngineInstance=new c({hasZ:u,hasM:l,geometryType:t,fields:s,timeInfo:e,spatialReference:o,objectIdField:r,featureStore:i,scheduler:a,priority:n}),this._dataQueryEngineInstance}};e([s({constructOnly:!0})],l.prototype,\"layerView\",void 0),e([s({constructOnly:!0})],l.prototype,\"priority\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.view.spatialReference\"})],l.prototype,\"spatialReference\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.layer\"})],l.prototype,\"layer\",void 0),e([s({readOnly:!0})],l.prototype,\"queryGeometryType\",null),e([s({readOnly:!0})],l.prototype,\"defaultQueryJSON\",null),l=e([a(\"esri.views.3d.layers.graphics.QueryEngine\")],l);var p=l;export default p;export{l as QueryEngine};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import i from\"../../../../core/Accessor.js\";import t from\"../../../../core/Handles.js\";import r from\"../../../../core/Logger.js\";import{isNone as s,isSome as h}from\"../../../../core/maybe.js\";import{isAbortError as l}from\"../../../../core/promiseUtils.js\";import{on as o}from\"../../../../core/watchUtils.js\";import{property as n}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import u from\"./QueryEngine.js\";import{getFloorFilterClause as c}from\"../support/floorFilterUtils.js\";import y from\"../../../layers/support/FeatureFilter.js\";import{TaskPriority as d}from\"../../../support/Scheduler.js\";const p=r.getLogger(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\");let _=class extends i{constructor(...e){super(...e),this.filter=null,this._dirty=!1,this._querying=!1,this._handles=new t}get updating(){return this._dirty||this._querying||null!=this._queryResult}setup(e,i){this._layerView=e,this._core=i,this._objectIdField=e.layer.objectIdField,this._queryEngine=new u({layerView:this._layerView,priority:d.FILTER_VISIBILITY});const t=this._layerView.view.resourceController.scheduler;this._handles.add(t.registerTask(d.FILTER_VISIBILITY,this)),this._handles.add(o(i.owner,\"loadedGraphics\",\"after-changes\",(e=>this._graphicsChanged(e)),(()=>this.dirty=!0))),this.filterChanged()}destroy(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}clear(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((e=>e.clearVisibilityFlag(2))),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange(\"updating\")}_graphicsChanged(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)}updateVisibility(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)}filterChanged(){const e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)}get active(){return this.filter&&this._core.graphics3DGraphics.size>0}recomputeFilter(){const e=\"filter\"in this._layerView?this._layerView.filter:null,i=\"timeExtent\"in this._layerView?this._layerView.timeExtent:null,t=c(this._layerView);if(s(i)&&s(t))return e;const r=h(e)?e.clone():new y;if(h(i)&&(r.timeExtent=h(r.timeExtent)?r.timeExtent.intersection(i):i),h(t)){const e=null==r.where||\"\"===r.where;r.where=e?t:`(${r.where}) AND (${t})`}return r}get running(){return this._dirty&&!this._querying||null!=this._queryResult}runTask(e){this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((e=>{this._queryResult=e,this._querying=!1})).catch((e=>{l(e)||(p.warn(\"FeatureFilter query failed: \"+e,{error:e}),this._queryResult=new Set,this._core.graphics3DGraphics.forEach((e=>this._queryResult.add(this._getFeatureId(e.graphic)))),this._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((i=>{if(e.done)return!1;const t=this._queryResult.has(this._getFeatureId(i.graphic));return!!i.setVisibilityFlag(2,t,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange(\"updating\")):this.clear()}_getFeatureId(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}set dirty(e){this._dirty!==e&&(this._dirty=e,this.notifyChange(\"updating\"))}};e([n({readOnly:!0})],_.prototype,\"updating\",null),_=e([a(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\")],_);export{_ as Graphics3DFilterVisibility};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Graphic.js\";import i from\"../../../../core/Accessor.js\";import{neverReached as s}from\"../../../../core/compilerUtils.js\";import r from\"../../../../core/Handles.js\";import{logOnError as n}from\"../../../../core/promiseUtils.js\";import{init as a}from\"../../../../core/watchUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{diff as p}from\"../../../../core/accessorSupport/diffUtils.js\";import{canProject as h,project as d}from\"../../../../geometry/support/webMercatorUtils.js\";import c from\"../../../../rest/support/Query.js\";import{SUSPEND_RESUME_EXTENT_OPTIMISM as u}from\"./constants.js\";import{Graphics3DCore as g}from\"./Graphics3DCore.js\";import m from\"./Graphics3DElevationAlignment.js\";import{Graphics3DFilterVisibility as y}from\"./Graphics3DFilterVisibility.js\";import f from\"./Graphics3DFrustumVisibility.js\";import{Graphics3DObjectStates as b}from\"./Graphics3DObjectStates.js\";import w from\"./Graphics3DScaleVisibility.js\";import{enlargeExtent as x}from\"./graphicUtils.js\";import{attributeLookup as E}from\"../support/attributeUtils.js\";import{WatchUpdatingTracking as C}from\"../../../support/WatchUpdatingTracking.js\";let V=class extends i{constructor(t){super(t),this._handles=new r,this.watchUpdatingTracking=new C,this.suspendResumeExtentMode=\"computed\",this.dataExtent=null,this.suspendResumeExtent=null}get suspended(){var t;return null==(t=this.scaleVisibility)?void 0:t.suspended}get suspendInfo(){var t,e;const i={};return null!=(t=this.scaleVisibility)&&t.suspended&&(i.outsideScaleRange=!0),null!=(e=this.frustumVisibility)&&e.suspended&&(i.outsideOfView=!0),i}get updating(){var t,e,i;return!!(null!=(t=this.graphicsCore)&&t.updating||null!=(e=this.frustumVisibility)&&e.updating||null!=(i=this.watchUpdatingTracking)&&i.updating)}normalizeCtorArgs(t){const e=t.frustumVisibilityEnabled?new f:null,i=t.scaleVisibilityEnabled?new w:null,s=(t.filterVisibilityEnabled||t.timeExtentVisibilityEnabled)&&\"multipatch\"!==t.layer.geometryType?new y:null,r=t.elevationAlignmentEnabled?new m:null,n=new g({owner:t.owner,layer:t.layer,preferredUpdatePolicy:t.preferredUpdatePolicy,elevationFeatureExpressionEnabled:t.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:t.owner.hasZ,hasM:t.owner.hasM}),{updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}=t;return{graphicsCore:n,frustumVisibility:e,scaleVisibility:i,filterVisibility:s,elevationAlignment:r,updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}}initialize(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,\"scaleRangeId\",(()=>this.scaleVisibility.layerMinMaxScaleChangeHandler())),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,\"filter\",(()=>this.filterVisibility.filterChanged())),this.watchUpdatingTracking.add(this.owner,\"timeExtent\",(()=>this.filterVisibility.filterChanged()))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,\"elevationInfo\",((t,e)=>{p(t,e)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,\"labelsVisible\",(()=>this.graphicsCore.updateVisibilityInfo())),this.watchUpdatingTracking.add(this.layer,\"labelingInfo\",((t,e)=>{p(t,e)&&this.graphicsCore.updateLabelingInfo()}))}async setup(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const t=this.owner,e=this.owner.view.basemapTerrain,i=(t,e,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i);if(this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,i,this.graphicsCore,e),this.filterVisibility&&(\"filter\"in t||\"timeExtent\"in t)&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment){const e=t.view.elevationProvider;this.elevationAlignment.setup(t,i,this.graphicsCore,e)}this._set(\"objectStates\",new b(this.graphicsCore)),this._set(\"labeling\",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set(\"deconfliction\",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),await n(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates})),this.watchUpdatingTracking.add(this.layer,\"renderer\",(t=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(t)))),this.watchUpdatingTracking.add(t,\"fullOpacity\",(()=>this.graphicsCore.opacityChange())),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(t.view,\"clippingArea\",(()=>this._updateClippingExtent())),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled&&await n(this.graphicsCore.updateLabelingInfo())}destroy(){this._handles&&(this._handles.destroy(),this._handles=null);const t=[\"watchUpdatingTracking\",\"frustumVisibility\",\"scaleVisibility\",\"filterVisibility\",\"elevationAlignment\",\"objectStates\",\"graphicsCore\"];for(const e of t){const t=this[e];t&&(t.destroy(),this._set(e,null))}this._set(\"layer\",null),this._set(\"owner\",null)}maskOccludee(t){const{set:e,handle:i}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(e,t.uid),i}highlight(t,i){if(t instanceof c){const{set:e,handle:s}=this.objectStates.acquireSet(0,i);return this.owner.queryObjectIds(t).then((t=>this.objectStates.setObjectIds(e,t))),s}if(\"number\"==typeof t||\"string\"==typeof t)return this.highlight([t],i);if(t instanceof e)return this.highlight([t],i);if(\"toArray\"in t&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof e){const e=t;if(null==E(this.layer.fieldsIndex,e[0].attributes,i)){const t=e.map((t=>t.uid)),{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(i,t),s}t=e.map((t=>E(this.layer.fieldsIndex,t.attributes,i)))}if(\"number\"==typeof t[0]||\"string\"==typeof t[0]){const e=t,{set:s,handle:r}=this.objectStates.acquireSet(0,i);return this.objectStates.setObjectIds(s,e),r}}return S}_updateClippingExtent(){const t=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.owner.view.spatialReference)&&(this.updateClippingExtent(t)||this.graphicsCore.recreateAllGraphics())}setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(a(this,\"suspendResumeExtentMode\",(()=>{switch(this._handles.remove(j),this.suspendResumeExtentMode){case\"computed\":this._handles.add([a(this.graphicsCore,\"computedExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent)))],j);break;case\"data\":this._handles.add([a(this,\"dataExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.dataExtent)))],j);break;default:s(this.suspendResumeExtentMode)}})))}updateSuspendResumeExtent(t){t?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(t,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)}extentToSuspendResumeRect(t,e){const i=this.owner.view.spatialReference;if(!t.spatialReference.equals(i)){if(!h(t,i))return;t=d(t,i)}return x(t,e,u,this.graphicsCore.extentPadding)}suspendResumeExtentChanged(t){this.frustumVisibility&&this.frustumVisibility.setExtent(t),this.scaleVisibility&&this.scaleVisibility.setExtent(t)}};t([o({aliasOf:\"graphicsCore.layer\"})],V.prototype,\"layer\",void 0),t([o({aliasOf:\"graphicsCore.owner\"})],V.prototype,\"owner\",void 0),t([o({constructOnly:!0})],V.prototype,\"updateClippingExtent\",void 0),t([o({constructOnly:!0})],V.prototype,\"graphicsCore\",void 0),t([o({constructOnly:!0})],V.prototype,\"scaleVisibility\",void 0),t([o({constructOnly:!0})],V.prototype,\"filterVisibility\",void 0),t([o({constructOnly:!0})],V.prototype,\"elevationAlignment\",void 0),t([o({constructOnly:!0})],V.prototype,\"frustumVisibility\",void 0),t([o({readOnly:!0})],V.prototype,\"deconfliction\",void 0),t([o({readOnly:!0})],V.prototype,\"labeling\",void 0),t([o({readOnly:!0})],V.prototype,\"objectStates\",void 0),t([o({readOnly:!0})],V.prototype,\"watchUpdatingTracking\",void 0),t([o()],V.prototype,\"suspendResumeExtentMode\",void 0),t([o()],V.prototype,\"dataExtent\",void 0),t([o({readOnly:!0})],V.prototype,\"suspended\",null),t([o({readOnly:!0})],V.prototype,\"suspendInfo\",null),t([o({readOnly:!0,dependsOn:[\"graphicsCore.updating\",\"frustumVisibility.updating\",\"watchUpdatingTracking.updating\"]})],V.prototype,\"updating\",null),V=t([l(\"esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView\")],V);var v=V;const j=\"suspendResumeExtentMode\",S={remove(){},pause(){},resume(){}};export default v;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nclass e{constructor(){this.items=[]}addObject(e,t){this.items.push({type:0,objectStateId:t,object:e})}addRenderGeometry(e,t,s){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:s})}addExternal(e,t){this.items.push({type:2,objectStateId:t,remove:e})}remove(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];s.objectStateId===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeObject(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];0===s.type&&s.object===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeRenderGeometry(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];1===s.type&&s.renderGeometry===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeAll(){this.items.forEach((e=>{this._removeObjectStateItem(e)})),this.items=[]}_removeObjectStateItem(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}export{e as Object3DStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{Object3DStateSet as t}from\"../../webgl-engine/lib/Object3DStateSet.js\";class e{constructor(e,i){this.stateType=e,this.objectIdField=i,this.objectStateSet=new t,this.ids=new Set,this.paused=!1}hasGraphic(t){if(this.objectIdField){const e=t.graphic.attributes[this.objectIdField];return this.ids.has(e)}return this.ids.has(t.graphic.uid)}}export{e as Graphics3DObjectStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../core/handleUtils.js\";import{Graphics3DObjectStateSet as e}from\"./Graphics3DObjectStateSet.js\";class s{constructor(t){this._graphicsCore=t,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll())),this._stateSets=null}acquireSet(s,a){const i=new e(s,a);this._stateSets.push(i);const h=t((()=>this.releaseSet(i)));return{set:i,handle:h}}releaseSet(t){t.objectStateSet.removeAll();const e=this._stateSets?this._stateSets.indexOf(t):-1;-1!==e&&this._stateSets.splice(e,1)}_addObjectStateSet(t,e){t.addObjectStateSet(e.stateType,e.objectStateSet)}_removeObjectStateSet(t,e){t.removeObjectState(e.objectStateSet)}setUid(t,e){t.ids.add(e);const s=this._graphicsCore.graphics3DGraphics.get(e);s&&this._addObjectStateSet(s,t)}setUids(t,e){e.forEach((e=>this.setUid(t,e)))}setObjectIds(t,e){e.forEach((e=>t.ids.add(e))),this.initializeSet(t)}addGraphic(t){this._stateSets.forEach((e=>{!e.paused&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)}))}removeGraphic(t){this._stateSets.forEach((e=>{e.hasGraphic(t)&&this._removeObjectStateSet(t,e)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll()))}initializeSet(t){const e=this._graphicsCore.graphics3DGraphics;t.objectIdField?e.forEach((e=>{e&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)})):t.ids.forEach((s=>{const a=e.get(s);a&&this._addObjectStateSet(a,t)}))}get test(){return{states:this._stateSets}}}export{s as Graphics3DObjectStates};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/PooledArray.js\";import{create as e,set as r,area as s,expand as n,contains as o,containsPoint as i}from\"../../../../geometry/support/aaBoundingRect.js\";import{noBudget as h}from\"../../../support/Scheduler.js\";const a=.05;class c{constructor(){this._extents=new t({allocator:t=>t||e()}),this._tmpExtent=e(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(t){this.contains(t)||(this.removeContained(t),r(this._extents.pushNew(),t),this._dirty=!0)}pop(){return this._dirty&&this.mergeTight(),this._extents.pop()}merge(t){return this.mergeTight(t),t.hasProgressed}mergeTight(t=h){const e=this._extents,o=new Set;let i=0;for(;i!==e.length;){e.sort(((t,e)=>t[0]-e[0])),i=e.length,o.clear();for(let i=0;i<e.length;++i){if(t.done)return;const h=e.getItemAt(i);for(let t=i+1;t<e.length;++t){const r=e.getItemAt(t);if(r[0]>=h[2])break;o.add(r)}o.forEach((i=>{if(h===i)return;if(i[2]<=h[0])return void o.delete(i);const c=s(h),g=s(i),m=this._tmpExtent;n(h,i,m);const d=c+g;(s(m)-d)/d<a&&(r(h,m),o.delete(i),e.remove(i),t.madeProgress())})),o.add(h)}}this._dirty=!1}contains(t){return this._extents.some((e=>o(e,t)))}removeContained(t){this._extents.filterInPlace((e=>!o(t,e)))}get test(){const t=this;return{containsPoint:e=>t._extents.some((t=>i(t,e)))}}}export{c as ExtentSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import i from\"../../../../core/Evented.js\";import s from\"../../../../core/Handles.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{ExtentSet as h}from\"./ExtentSet.js\";import{TaskPriority as o}from\"../../../support/Scheduler.js\";let p=class extends t{constructor(){super(...arguments),this.dirtyExtents=new h,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new s,this.updateElevation=!1,this.layerView=null,this.graphicsCore=null,this.events=new i}setup(e,t,i,s){this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=s;const r=this.layerView.view.resourceController.scheduler;this.handles.add([s.on(\"elevation-change\",(e=>this._elevationChanged(e))),this.layerView.watch(\"suspended\",(()=>this.suspendedChange())),r.registerTask(o.ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange(\"updating\")}suspendedChange(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange(\"updating\"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange(\"updating\")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((()=>this.dirtyExtents.merge(e)));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange(\"updating\")}_updateDirtyGraphics(e){const t=this.layerView.view.renderCoordsHelper,i=0===this.graphicsCore.effectiveUpdatePolicy;for(const s of this.dirtyGraphicsSet.keys()){const a=this.graphicsCore.getGraphics3DGraphicById(s);if(this.dirtyGraphicsSet.delete(s),r(a)&&(a.alignWithElevation(this.elevationProvider,t,i),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this.dirtyExtents.empty&&!e.done;){const t=this.dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit(\"invalidate-elevation\",{extent:t,spatialReference:i});const s=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,(e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);r(t)&&t.needsElevationUpdates()&&this.dirtyGraphicsSet.add(e)})),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-s)+.9*this.averageExtentUpdateSize,e.madeProgress()}}markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this.dirtyGraphicsSet.add(t)))}_elevationChanged(e){if(\"scene\"===e.context&&(!this.graphicsCore.layer.elevationInfo||\"relative-to-scene\"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:t,spatialReference:i}=e;if(this.layerView.suspended){if(!this.updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this.updateElevation=!0)}this.events.emit(\"invalidate-elevation\",{extent:t,spatialReference:i})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange(\"updating\")}};e([a({readOnly:!0})],p.prototype,\"updating\",null),e([a({readOnly:!0})],p.prototype,\"updatingRemaining\",null),p=e([n(\"esri.views.3d.layers.graphics.Graphics3DElevationAlignment\")],p);var d=p;export default d;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nfunction o(o){const n=o.layer;if(\"floorInfo\"in n&&n.floorInfo){const r=o.view.floors;if(!r||!r.length)return null;const l=r.filter((o=>\"\"!==o)).map((o=>`'${o}'`));l.push(\"''\");const f=n.floorInfo.floorField;return`${f} IN (${l.join(\", \")}) OR ${f} IS NULL`}return null}export{o as getFloorFilterClause};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import s from\"../../../../core/Handles.js\";import{init as i}from\"../../../../core/watchUtils.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getReferenceEllipsoid as o}from\"../../../../geometry/projectionEllipsoid.js\";import{FrustumExtentIntersection as a}from\"../../support/FrustumExtentIntersection.js\";import{TaskPriority as l}from\"../../../support/Scheduler.js\";const h=1.2;let u=class extends t{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new s,this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new a({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,s=t.basemapTerrain,r=t.resourceController.scheduler;this.handles.add([t.on(\"resize\",(()=>this.viewChange())),t.state.watch(\"camera\",(()=>this.viewChange()),!0),r.registerTask(l.FRUSTUM_VISIBILITY,this),s.on(\"elevation-bounds-change\",(()=>this.elevationBoundsChange()))]),\"local\"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([i(s,[\"opacity\",\"wireframe\"],(()=>this.updateIsVisibleBelowSurface())),i(t,\"map.ground.navigationConstraint.type\",(()=>this.updateIsVisibleBelowSurface()))])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set(\"updating\",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,s=\"local\"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&\"none\"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=s||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*o(e.spatialReference).radius;else{const{min:s,max:i}=e.basemapTerrain.elevationBounds;t=s-Math.max(1,(i-s)*(h-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set(\"updating\",!1),!this.extent)return void this._set(\"suspended\",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=o(this.layerView.view.spatialReference).radius;this._set(\"suspended\",!this.extentIntersection.isVisibleInFrustum(e,t))}};e([r({readOnly:!0})],u.prototype,\"suspended\",void 0),e([r({readOnly:!0})],u.prototype,\"updating\",void 0),u=e([n(\"esri.views.3d.layers.graphics.Graphics3DFrustumVisibility\")],u);var p=u;export default p;\n"],"sourceRoot":""}