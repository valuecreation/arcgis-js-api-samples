{"version":3,"sources":["../node_modules/@arcgis/core/libs/vxl/VxlModule.js","../node_modules/@arcgis/core/layers/VoxelWasmPerScene.js","../node_modules/@arcgis/core/layers/VoxelWasmManager.js","../node_modules/@arcgis/core/views/3d/layers/VoxelLayerView3D.js"],"names":["n","t","e","v","getLogger","p","constructor","this","_useDepthPass","_havePreparedWithAllLayers","_renderPluginContext","_vxl","_pluginIsActive","_moreToLoad","_viewportWidth","_viewportHeight","_newLayers","_layers","Map","_renderPass","_renderSlot","_rctx","_renderTargetToRestore","_dbgFlags","Set","add","_view","initialize","viewingMode","dbg","has","error","warn","removeRenderPlugin","_stage","_readyWatchHandle","addRenderPlugin","_qualityWatchHandle","set_quality","toWasmQuality","initializeRenderContext","renderContext","rctx","webglVersion","initializeWasm","gl","uninitializeRenderContext","restoreFramebuffer","fbo","bindFramebuffer","viewport","setViewport","x","y","width","height","bindPreviousDepthToSlot","s","i","r","depthStencilTexture","bindTexture","setBlendState","setBlendingEnabled","setBlendFunction","setBlendEquation","setFrontFace","setDepthStencilStateFunction","setDepthFunction","setDepthTestEnabled","setDepthWriteEnabled","setStencilTestEnabled","setStencilFunction","setStencilOpSeparate","setRasterizerState","setFaceCullingEnabled","setCullFace","syncRequestsResponses","forEach","responses","push","size","respond","delete","a","get_new_requests","l","abortController","signal","o","outstandingRequestCount","layerView","updatingFlagChanged","responseType","url","then","data","byteLength","_malloc","Uint8Array","HEAPU8","buffer","set","type","ptr","success","catch","updateWasmCamera","set_projection_matrix","apply","projectionMatrix","set_view_matrix","viewMatrix","set_near_far","near","far","isUpdating","_vxlPromise","get","setEnabled","set_enabled","requestRender","addVoxelLayer","resolveCallback","rejectCallback","Promise","_addVoxelLayer","reject","resolve","removeVoxelLayer","findIndex","splice","length","destroy","abort","remove_layer","layer","layerData","spatialReference","wkid","isWGS84","add_layer","serviceRoot","_free","prepareRender","viewForward","eye","update_camera_pos_and_direction","cull","render","pass","slot","getBoundFramebufferObject","getViewport","begin_frame","set_viewport","camera","draw","externalTextureUnitUpdate","get_texture_units_bound_in_frame","get_active_texture_unit","externalVertexArrayObjectUpdate","externalVertexBufferUpdate","queryDepthRange","get_near","get_far","remove","uninitialize_voxel_wasm","default","locateFile","preinitializedWebGLContext","onRuntimeInitialized","g","addFunction","bind","initialize_voxel_wasm","qualityProfile","intersect","intersectDepth","intersectObject","pick_object","u","h","worldX","worldY","worldZ","b","d","c","w","_","f","m","R","intersector","dist","target","metadata","layerUid","intersectionHandlerId","C","results","min","P","max","options","store","ray","all","pick_depth","view2WASM","instance","addLayer","removeLayer","setLayerEnabled","super","arguments","_wasmLayerId","view","getInstance","_suspendedHandle","addResolvingPromise","notifyChange","prototype","readOnly","aliasOf"],"mappings":"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","file":"static/js/175.448da00e.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as e}from\"../../assets.js\";function t(e){return new Promise((t=>import(\"../../chunks/vxlLayer.js\").then((function(e){return e.v})).then((({default:i})=>{const r=i({locateFile:n,preinitializedWebGLContext:e,onRuntimeInitialized:()=>t(r)})})))).catch((e=>Promise.reject(e)))}function n(t){return e(`esri/libs/vxl/${t}`)}export{t as loadVoxelWASM};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../request.js\";import t from\"../core/Logger.js\";import{clamp as s}from\"../core/mathUtils.js\";import{isAbortError as i,createAbortController as r}from\"../core/promiseUtils.js\";import{init as n}from\"../core/watchUtils.js\";import{w as a,n as l,i as o,s as h,a as d,d as c,b as _}from\"../chunks/vec3.js\";import{c as u}from\"../chunks/vec3f64.js\";import{loadVoxelWASM as g}from\"../libs/vxl/VxlModule.js\";import{IntersectorResult as x}from\"../views/3d/webgl-engine/lib/intersectorUtils.js\";const v=t.getLogger(\" esri.layers.VoxelWasmPerScene\");class p{constructor(e){this._useDepthPass=!1,this._havePreparedWithAllLayers=!1,this._renderPluginContext=null,this._vxl=null,this._pluginIsActive=!1,this._moreToLoad=!1,this._viewportWidth=-1,this._viewportHeight=-1,this._newLayers=[],this._layers=new Map,this._renderPass=0,this._renderSlot=4,this._rctx=null,this._renderTargetToRestore=null,this._dbgFlags=new Set,this._dbgFlags.add(4),this._view=e,this.initialize()}get canRender(){return!!this._vxl&&\"local\"===this._view.viewingMode}dbg(e,t){this._dbgFlags.has(e)&&(4===e?v.error(t):v.warn(t))}removeRenderPlugin(){this._pluginIsActive&&this._view._stage&&(this.dbg(1,\"--removeRenderPlugin--\"),this._view._stage.removeRenderPlugin(this)),this._pluginIsActive=!1}initialize(){this.dbg(1,\"--initialize--\"),this._readyWatchHandle=n(this._view,\"ready\",(e=>{e&&\"local\"===this._view.viewingMode?(this.dbg(1,\"view ready status changed to ready on a local view, calling addRenderPlugin\"),this._view._stage.addRenderPlugin([this._renderSlot],this),this._pluginIsActive=!0):(this.dbg(1,\"view ready status changed, not ready or not a local view!\"),this.removeRenderPlugin())})),this._qualityWatchHandle=n(this._view,\"qualityProfile\",(e=>{this.dbg(3,\"qualityProfile changed to \"+e),this._vxl&&this._vxl.set_quality(this.toWasmQuality(e))}))}initializeRenderContext(e){this.dbg(1,\"--initializeRenderContext--\");const t=e.renderContext.rctx;\"webgl2\"===t.webglVersion?(this._renderPluginContext=e,this._rctx=e.renderContext.rctx,this.initializeWasm(t.gl)):this.dbg(4,\"WebGL 1 context only!\")}uninitializeRenderContext(){this._renderPluginContext=null,this._rctx=null,this.dbg(1,\"--uninitializeRenderContext--\")}restoreFramebuffer(){if(!this._renderTargetToRestore)return;const e=this._renderTargetToRestore.fbo;if(!!!this._rctx)return void this.dbg(4,\"no context in restoreFramebuffer!\");this._rctx.bindFramebuffer(e,!0);const t=this._renderTargetToRestore.viewport;this._rctx.setViewport(t.x,t.y,t.width,t.height)}bindPreviousDepthToSlot(e,t){const s=!!this._rctx,i=!!this._renderTargetToRestore;if(!s||!i)return 0;const r=this._renderTargetToRestore.fbo.depthStencilTexture;return r?(0===t?this._rctx.bindTexture(null,e,!0):this._rctx.bindTexture(r,e,!0),1):(this.dbg(4,\"no depth/stencil texture exists!\"),0)}setBlendState(e,t,s,i){this._rctx?(this._rctx.setBlendingEnabled(1===e),this._rctx.setBlendFunction(t,s),this._rctx.setBlendEquation(i)):this.dbg(4,\"setBlendState callback has no rendering context!\")}setFrontFace(e){this._rctx?this._rctx.setFrontFace(e):this.dbg(4,\"setFrontFace callback has no rendering context!\")}setDepthStencilStateFunction(e,t,s){this._rctx?(this._rctx.setDepthFunction(s),this._rctx.setDepthTestEnabled(1===e),this._rctx.setDepthWriteEnabled(1===t),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(519,0,255),this._rctx.setStencilOpSeparate(1028,7680,7682,7680),this._rctx.setStencilOpSeparate(1029,7680,7683,7680)):this.dbg(4,\"setDepthStencilStateFunction callback has no rendering context!\")}setRasterizerState(e){if(this._rctx)switch(e){case 1:this._rctx.setFaceCullingEnabled(!1);break;case 3:this._rctx.setCullFace(1029),this._rctx.setFaceCullingEnabled(!0);break;case 2:this._rctx.setCullFace(1028),this._rctx.setFaceCullingEnabled(!0)}else this.dbg(4,\"setRasterizerState callback has no rendering context!\")}setViewport(e,t,s,i){this._rctx?this._rctx.setViewport(e,t,s,i):this.dbg(4,\"setViewport callback has no rendering context!\")}syncRequestsResponses(){this._layers.forEach(((t,s)=>{const r=[];t.responses.forEach(((e,t)=>{r.push(t),this.dbg(2,\"responding for requestID:\"+t+\" size:\"+e.size),this._vxl.respond(s,t,e)}));const n=t.responses;for(const e of r)n.delete(e);const a=this._vxl.get_new_requests(s),l=t.abortController.signal;for(const o in a){t.outstandingRequestCount+=1,1===t.outstandingRequestCount&&t.layerView.updatingFlagChanged();const s=a[o],r={responseType:\"array-buffer\",signal:l};this.dbg(2,\"making requestID:\"+o+\" url:\"+s.url),e(s.url,r).then((e=>{t.outstandingRequestCount-=1,0===t.outstandingRequestCount&&t.layerView.updatingFlagChanged(),this.dbg(2,\"have response for requestID:\"+o);let i=0;if(e.data.byteLength>0){i=this._vxl._malloc(e.data.byteLength);const t=new Uint8Array(this._vxl.HEAPU8.buffer,i,e.data.byteLength),s=new Uint8Array(e.data);for(let i=0;i<e.data.byteLength;++i)t[i]=s[i]}n.set(+o,{type:s.type,ptr:i,size:e.data.byteLength,success:!0})})).catch((e=>{t.outstandingRequestCount-=1,0===t.outstandingRequestCount&&t.layerView.updatingFlagChanged(),i(e)||(this.dbg(4,\"requestID:\"+o+\" failed\"),n.set(+o,{type:s.type,ptr:0,size:0,success:!1}))}))}}))}updateWasmCamera(e){this._vxl.set_projection_matrix.apply(this._vxl,e.projectionMatrix),this._vxl.set_view_matrix.apply(this._vxl,e.viewMatrix),this._vxl.set_near_far(e.near,e.far)}isUpdating(e){return!(this._vxl||!this._vxlPromise)||!!this._layers.has(e)&&this._layers.get(e).outstandingRequestCount>0}setEnabled(e,t){this._layers.forEach(((s,i)=>{s.layerView===e&&(this._vxl.set_enabled(i,t?1:0),this._renderPluginContext.requestRender())}))}addVoxelLayer(e){if(!this._vxl){const t={layerView:e,resolveCallback:\"\",rejectCallback:\"\"},s=new Promise(((e,s)=>{t.resolveCallback=e,t.rejectCallback=s}));return this._newLayers.push(t),s}const t=this._addVoxelLayer(e);return t<0?Promise.reject(-1):Promise.resolve(t)}removeVoxelLayer(e){if(!this._vxl){const t=this._newLayers.findIndex((t=>e===t.layerView));t>=0&&(this._newLayers[t].resolveCallback(-1),this._newLayers.splice(t,1));const s=this._newLayers.length;return 0===s&&(this.dbg(1,\" no voxel layers left after removing a layer, removing RenderPlugin and destroying\"),this.destroy()),s}let t=-1;this._layers.forEach(((s,i)=>{s.layerView===e&&(t=i,s.abortController.abort(),this._vxl.remove_layer(t))})),t>=0&&this._layers.delete(t);const s=this._layers.size;return 0===s&&(this.dbg(1,\" no voxel layers left after removing a layer, removing RenderPlugin and destroying\"),this.destroy()),s}_addVoxelLayer(e){const t=e.layer;let s=-1;const i=t.layerData;if(i&&i.data.byteLength>0){const e=this._vxl._malloc(i.data.byteLength),r=new Uint8Array(this._vxl.HEAPU8.buffer,e,i.data.byteLength),n=new Uint8Array(i.data);for(let t=0;t<i.data.byteLength;++t)r[t]=n[t];const a=32662===this._view.spatialReference.wkid&&t.spatialReference.isWGS84?111319.49079327357:1;s=this._vxl.add_layer(t.serviceRoot,e,i.data.byteLength,a,a),this._vxl._free(e)}if(s>=0){const t=r();return this._layers.set(s,{layerView:e,responses:new Map,outstandingRequestCount:0,abortController:t}),s}return-1}prepareRender(e){if(!this._vxl)return;const t=e.viewForward,s=e.eye;this._vxl.update_camera_pos_and_direction(s[0],s[1],s[2],t[0],t[1],t[2]);const i=this._vxl.cull();this.dbg(2,\"missingResourceCount=\"+i),this._moreToLoad=i>0,this._havePreparedWithAllLayers=0===this._newLayers.length}render(e){if(!this._vxl)return!1;for(const s of this._newLayers){const e=this._addVoxelLayer(s.layerView);-1===e?s.rejectCallback(-1):s.resolveCallback(e)}if(this._newLayers=[],e.pass!==this._renderPass)return!1;if(e.slot!==this._renderSlot)return!1;if(0===this._layers.size)return this.dbg(4,\"No voxel layers but RenderPlugin instance is being asked to render!\"),!0;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()},this.syncRequestsResponses(),this._vxl.begin_frame();const t=this._renderTargetToRestore.viewport;return t.width===this._viewportWidth&&t.height===this._viewportHeight||(this._viewportWidth=t.width,this._viewportHeight=t.height,this._vxl.set_viewport(t.width,t.height)),0===t.x&&0===t.y||this.dbg(4,\"Unsupported viewport parameters detected!\"),this.updateWasmCamera(e.camera),this._vxl.draw(),this._renderTargetToRestore.fbo=null,e.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),e.rctx.externalVertexArrayObjectUpdate(),e.rctx.externalVertexBufferUpdate(),(this._moreToLoad||!this._havePreparedWithAllLayers&&this._layers.size>0)&&this._renderPluginContext.requestRender(),!0}queryDepthRange(e){this.dbg(1,\"--queryDepthRange--\");const t=e.viewForward,s=e.eye;this._vxl.update_camera_pos_and_direction(s[0],s[1],s[2],t[0],t[1],t[2]),this._vxl.cull();const i={near:5,far:1e4};return i.near=this._vxl.get_near(),i.far=this._vxl.get_far(),i}destroy(){this.dbg(1,\"--destroy--\"),this.removeRenderPlugin(),this._readyWatchHandle&&(this._readyWatchHandle.remove(),this._readyWatchHandle=null),this._qualityWatchHandle&&(this._qualityWatchHandle.remove(),this._qualityWatchHandle=null),this._vxl&&(this._vxl.uninitialize_voxel_wasm(),this._vxl=null)}initializeWasm(e){return this._vxl?Promise.resolve():(this._vxlPromise||(this._vxlPromise=g(e).then((e=>{if(this._vxl=e,this._vxlPromise=null,this._newLayers.length<=0)return this.dbg(1,\" no voxel layers left after WASM downloaded, removing RenderPlugin and destroying\"),void this.destroy();const t=this._vxl.addFunction(this.restoreFramebuffer.bind(this),\"v\"),s=this._vxl.addFunction(this.setBlendState.bind(this),\"viiii\"),i=this._vxl.addFunction(this.setFrontFace.bind(this),\"vi\"),r=this._vxl.addFunction(this.setRasterizerState.bind(this),\"vi\"),n=this._vxl.addFunction(this.setDepthStencilStateFunction.bind(this),\"viii\"),a=this._vxl.addFunction(this.setViewport.bind(this),\"viiii\"),l=this._vxl.addFunction(this.bindPreviousDepthToSlot.bind(this),\"iii\");this._vxl.initialize_voxel_wasm(t,s,i,r,n,a,l),this._vxl.set_quality(this.toWasmQuality(this._view.qualityProfile)),this._renderPluginContext&&this._renderPluginContext.requestRender()})).catch((()=>{for(const e of this._newLayers)e.rejectCallback(-2);this.dbg(4,\" WASM failed to download, removing RenderPlugin and destroying\"),this.destroy()}))),this._vxlPromise)}get type(){return\"external\"}get isGround(){return!1}get slicePlane(){return!1}get intersectionHandlerId(){return\"unj\"}intersect(e,t,s,i,r){if(!this._vxl)return;if(!this._rctx)return;if(0===this._layers.size)return;if(r[0]<0||r[0]>e.camera.viewport[2]||r[1]<0||r[1]>e.camera.viewport[3])return;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};const n=e.camera.viewForward,a=e.camera.eye;this._vxl.update_camera_pos_and_direction(a[0],a[1],a[2],n[0],n[1],n[2]),this.updateWasmCamera(e.camera),this._vxl.begin_frame(),this._useDepthPass?this.intersectDepth(e,t,s,i,r):this.intersectObject(e,t,s,i,r),this._renderTargetToRestore.fbo=null,this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),this._rctx.externalVertexArrayObjectUpdate(),this._rctx.externalVertexBufferUpdate()}intersectObject(e,t,i,r,n){const g=this._vxl.pick_object(n[0],n[1]);if(g.success){const n=u();a(n,r,i),l(n,n);const v=o(i,r),p=u();h(p,g.worldX,g.worldY,g.worldZ);const y=u();a(y,p,i);const b=u();d(b,n,c(y,n));const w=u();_(w,i,b);const f=o(i,w),m=s(f/v,0,1),R=e=>{e.intersector=\"Voxel\",e.dist=m,e.target={type:\"external\",metadata:{layerUid:this.intersectionHandlerId}}},C=e.results.min;(null==C.dist||m<C.dist)&&(null==t||t(i,r,m))&&R(C);const P=e.results.max;if(0!==e.options.store&&(null==P.dist||m>P.dist)&&(null==t||t(i,r,m))&&R(P),2===e.options.store){const t=new x(e.ray);R(t),e.results.all.push(t)}}}intersectDepth(e,t,i,r,n){const g=this._vxl.pick_depth(n[0],n[1]);if(g.success){const n=u();a(n,r,i),l(n,n);const v=o(i,r),p=u();h(p,g.worldX,g.worldY,g.worldZ);const y=u();a(y,p,i);const b=u();d(b,n,c(y,n));const w=u();_(w,i,b);const f=o(i,w),m=s(f/v,0,1),R=e=>{e.intersector=\"Voxel\",e.dist=m,e.target={type:\"external\",metadata:{layerUid:this.intersectionHandlerId}}},C=e.results.min;(null==C.dist||m<C.dist)&&(null==t||t(i,r,m))&&R(C);const P=e.results.max;if(0!==e.options.store&&(null==P.dist||m>P.dist)&&(null==t||t(i,r,m))&&R(P),2===e.options.store){const t=new x(e.ray);R(t),e.results.all.push(t)}}}toWasmQuality(e){switch(e){case\"low\":return 0;case\"medium\":return 1;case\"high\":return 2}}}export default p;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"./VoxelWasmPerScene.js\";class t{constructor(){this.view2WASM=new Map}static getInstance(){return t.instance||(t.instance=new t),t.instance}isUpdating(e,t){return!!this.view2WASM.has(e)&&this.view2WASM.get(e).isUpdating(t)}addLayer(t,i){return this.view2WASM.has(t)||this.view2WASM.set(t,new e(t)),this.view2WASM.get(t).addVoxelLayer(i)}removeLayer(e,t){if(this.view2WASM.has(e)){this.view2WASM.get(e).removeVoxelLayer(t)<1&&this.view2WASM.delete(e)}}setLayerEnabled(e,t,i){if(this.view2WASM.has(e)){this.view2WASM.get(e).setEnabled(t,i)}}}export default t;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import s from\"../../../core/Error.js\";import{init as r}from\"../../../core/watchUtils.js\";import{property as t}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import i from\"../../../layers/VoxelWasmManager.js\";import{LayerView3D as a}from\"./LayerView3D.js\";import d from\"../../layers/LayerView.js\";let n=class extends(a(d)){constructor(){super(...arguments),this.type=\"voxel-3d\",this._wasmLayerId=-1}initialize(){if(\"local\"!==this.view.viewingMode)throw new s(\"voxel:unsupported-viewingMode\",\"Voxel layers support local viewingMode only.\",{});if(\"webgl\"===this.view.renderContext)throw new s(\"voxel:unsupported-context\",\"Voxel layers are supported in WebGL2 rendering contexts only.\",{});const e=i.getInstance(),t=e.addLayer(this.view,this).then((e=>{this._wasmLayerId=e,this._suspendedHandle=r(this,\"suspended\",(e=>{i.getInstance().setLayerEnabled(this.view,this,!e)}))})).catch((r=>{if(e.removeLayer(this.view,this),this._wasmLayerId=-1,-1===r)throw new s(\"voxel:addLayer-failure\",\"The voxel layer description was invalid.\",{});if(-2===r)throw new s(\"voxel:addLayer-failure\",\"The voxel layer web assembly module failed to download.\",{})}));this.addResolvingPromise(t)}destroy(){i.getInstance().removeLayer(this.view,this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null)}isUpdating(){return!(this._wasmLayerId<0)&&i.getInstance().isUpdating(this.view,this._wasmLayerId)}updatingFlagChanged(){this.notifyChange(\"updating\")}};e([t()],n.prototype,\"layer\",void 0),e([t({readOnly:!0,aliasOf:\"layer.parsedUrl.path\"})],n.prototype,\"baseUrl\",void 0),n=e([o(\"esri.views.3d.layers.VoxelLayerView3D\")],n);var l=n;export default l;\n"],"sourceRoot":""}