{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/MapImageLayerView.js","../node_modules/@arcgis/core/views/3d/layers/MapImageLayerView3D.js","../node_modules/@arcgis/core/views/layers/support/popupUtils.js","../node_modules/@arcgis/core/views/3d/layers/support/projectExtentUtils.js","../node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js","../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js","../node_modules/@arcgis/core/views/3d/webgl-engine/materials/ImageMaterial.js","../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/views/3d/layers/support/overlayImageUtils.js","../node_modules/@arcgis/core/views/3d/layers/DynamicLayerView3D.js","../node_modules/@arcgis/core/views/support/drapedUtils.js","../node_modules/@arcgis/core/layers/support/sublayerUtils.js","../node_modules/@arcgis/core/layers/support/ExportImageParameters.js"],"names":["c","y","initialize","this","exportImageParameters","i","layer","destroy","e","commitProperty","_get","s","a","Promise","reject","r","p","get","l","async","minScale","o","maxScale","visible","sublayers","forEach","popupEnabled","u","defaultPopupTemplateEnabled","t","unshift","sublayer","popupTemplate","toArray","reverse","map","all","load","catch","createQuery","event","m","renderer","createFetchPopupFeaturesQueryGeometry","geometry","outFields","n","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","reduce","value","filter","canResume","super","timeExtent","isEmpty","prototype","readOnly","constructor","arguments","type","updatingHandles","add","addPromise","refreshDebounced","view","getFetchOptions","timestamp","refreshTimestamp","d","getRequiredFields","fieldsIndex","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","f","push","has","indexOf","keyField","defaultPopupTemplate","spatialReference","fullExtent","equals","resolve","clone","state","isLocal","portalItem","then","destroyed","include","linearDepth","vertex","uniforms","attributes","varyings","multipassTerrainEnabled","code","fragment","output","float","OITEnabled","Object","freeze","__proto__","build","E","initializeProgram","shader","configuration","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","transparencyPassType","cullAboveGround","rctx","bindPass","program","camera","projectionMatrix","setUniform1f","opacity","setUniform2fv","nearFar","inverseViewport","bindDraw","rebindTextures","setPipelineState","T","blending","transparent","w","culling","P","cullFace","depthTest","func","depthWrite","writeDepth","v","colorWrite","j","stencilWrite","sceneHasOcludees","b","stencilTest","g","polygonOffset","h","enableOffset","initializePipeline","_occludeePipelineState","getPipelineState","pipeline","S","O","count","supportsEdges","techniqueConfig","getTechniqueConfig","params","relativeElevation","intersect","getGLMaterial","createBufferWriter","material","updateParameters","_material","updateTexture","textureId","_technique","_techniqueRep","releaseAndAcquire","_output","beginSlot","_updateOccludeeState","hasOccludees","setParameterValues","ensureParameters","bind","bindTextures","bindTextureScale","initTextureTransparent","xoffset","Math","max","abs","yoffset","stops","length","size","maxSize","minSize","floor","pointerType","visualVariables","symbol","uniqueValueInfos","classBreakInfos","createSquareGeometry","H","getLogger","G","drapeSourceType","updatePolicy","fullExtentInLocalViewSpatialReference","maximumDataResolution","_images","Array","_extents","_overlayExtents","updateWhenStationary","addResolvingPromise","L","_set","_suspendedChangeHandler","handles","resourceController","scheduler","registerIdleStateCallbacks","_isScaleRangeActive","notifyChange","_isScaleRangeLayer","viewingMode","basemapTerrain","_updateImageExtent","clear","setDrapingExtent","index","extent","x","resolution","renderLocalOrigin","pixelRatio","_clippedExtent","height","round","imageMaxWidth","imageMaxHeight","_imageSizeDiffers","imageSize","suspended","_fetch","error","_clearImage","scale","isUpdating","some","loadingPromise","HTMLImageElement","HTMLCanvasElement","image","findExtentInfoAt","contains","_createStageObjects","A","TESTS_DISABLE_UPDATE_THRESHOLDS","_","texture","renderGeometry","loadingAbortController","pixelData","renderExtent","abort","signal","_waitFetchReady","requestAsImageElement","fetchImage","warnOnce","processResult","R","overlayManager","removeGeometries","_stage","remove","D","preMultiplyAlpha","wrap","min","Float64Array","Float32Array","Uint32Array","M","data","exclusive","I","id","C","origin","addGeometries","ready","refresh","V","overlayPixelSizeInMapUnits","basemapSpatialReference","xmin","ymin","xmax","ymax","flatten","originIdOf","source","mapLayerId","gdbVersion","slice","layerDefinition","definitionExpression","labelingInfo","labelsVisible","hasDynamicLayers","visibleSublayers","toExportImageJSON","JSON","stringify","serviceSublayers","allSublayers","on","propertyName","join","toJSON","dpi","format","imageFormat","imageTransparency","dynamicLayers","layers","layerDefs","Number"],"mappings":"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","file":"static/js/43.1d30ee01.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as p}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as i}from\"../../layers/support/ExportImageParameters.js\";import{calculateTolerance as m}from\"../../renderers/support/clickToleranceUtils.js\";import{loadArcade as l}from\"../../support/arcadeOnDemand.js\";import{getRequiredFields as n,getFetchPopupTemplate as u}from\"./support/popupUtils.js\";const c=c=>{let y=class extends c{initialize(){this.exportImageParameters=new i({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const p=this.get(\"view.scale\"),i=[],l=async e=>{const r=0===e.minScale||p<=e.minScale,o=0===e.maxScale||p>=e.maxScale;if(e.visible&&r&&o)if(e.sublayers)e.sublayers.forEach(l);else if(e.popupEnabled){const r=u(e,{...s,defaultPopupTemplateEnabled:!1});t(r)&&i.unshift({sublayer:e,popupTemplate:r})}},c=a.sublayers.toArray().reverse().map(l);await Promise.all(c);const y=i.map((async({sublayer:r,popupTemplate:o})=>{await r.load().catch((()=>{}));const a=r.createQuery(),p=t(s)?s.event:null,i=m({renderer:r.renderer,event:p}),l=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=l,a.outFields=await n(r,o);const u=await this._loadArcadeModules(o);u&&u.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=l.width/i);return(await r.queryFeatures(a)).features}));return(await o(y)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\"))return l()}};return e([s()],y.prototype,\"exportImageParameters\",void 0),e([s({readOnly:!0})],y.prototype,\"exportImageVersion\",null),e([s()],y.prototype,\"layer\",void 0),e([s()],y.prototype,\"suspended\",void 0),e([s(p)],y.prototype,\"timeExtent\",void 0),y=e([a(\"esri.views.layers.MapImageLayerView\")],y),y};export default c;export{c as MapImageLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import{MapImageLayerView as t}from\"../../layers/MapImageLayerView.js\";import{createQueryGeometry as o}from\"../../support/drapedUtils.js\";let i=class extends(t(s)){constructor(){super(...arguments),this.type=\"map-image-3d\"}initialize(){this.updatingHandles.add(this,\"exportImageVersion\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}createFetchPopupFeaturesQueryGeometry(e,r){return o(e,r,this.view)}getFetchOptions(){return{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp}}};i=e([r(\"esri.views.3d.layers.MapImageLayerView3D\")],i);var a=i;export default a;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{canProject as e,project as r}from\"../../../../geometry/support/webMercatorUtils.js\";import{projectGeometry as o}from\"../../../../portal/support/geometryServiceUtils.js\";function t(t){const l=t.view.spatialReference,s=t.layer.fullExtent,i=s&&s.spatialReference;return i?i.equals(l)?Promise.resolve(s.clone()):e(i,l)?Promise.resolve(r(s,l)):t.view.state.isLocal?o(s,l,t.layer.portalItem).then((e=>!t.destroyed&&e?e:void 0)).catch((()=>null)):Promise.resolve(null):Promise.resolve(null)}export{t as toViewIfLocal};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{Slice as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ReadLinearDepth as a}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{multipassTerrainTest as o}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{defaultMaskAlphaCutoff as i}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{ColorConversion as d}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{glsl as t}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as l}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function s(s){const n=new l;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(t`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(e,s),s.multipassTerrainEnabled&&(n.fragment.include(a),n.include(o,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(d),n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}var n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{bindSliceUniformsWithOrigin as t}from\"../core/shaderLibrary/Slice.glsl.js\";import{bindMultipassTerrainTexture as r}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{bindProjectionMatrix as i,bindView as s}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as a}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as o}from\"../core/shaderTechnique/ShaderTechnique.js\";import{ShaderTechniqueConfiguration as n,parameter as l}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as p}from\"../lib/DefaultVertexAttributeLocations.js\";import{OITBlending as c,OITDepthTest as u,OITDepthWrite as d,getOITPolygonOffset as h}from\"../lib/OrderIndependentTransparency.js\";import{Program as m}from\"../lib/Program.js\";import{stencilWriteMaskOn as b,stencilToolMaskBaseParams as f,stencilBaseAllZerosParams as g}from\"../lib/StencilUtils.js\";import{I as y}from\"../../../../chunks/ImageMaterial.glsl.js\";import{makePipelineState as T,cullingParams as P,defaultDepthWriteParams as v,defaultColorWriteParams as j,simpleBlendingParams as S}from\"../../../webgl/renderState.js\";class E extends o{initializeProgram(e){const t=E.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new m(e.rctx,i,p)}bindPass(e,t){i(this.program,t.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",t.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",t.inverseViewport),r(this.program,t))}bindDraw(e){s(this.program,e),t(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e;return T({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?w:c(e),culling:P(r.cullFace),depthTest:{func:u(e)},depthWrite:i?r.writeDepth&&v:d(e),colorWrite:j,stencilWrite:r.sceneHasOcludees?b:null,stencilTest:r.sceneHasOcludees?t?f:g:null,polygonOffset:i||s?null:h(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}E.shader=new a(y,(()=>import(\"./ImageMaterial.glsl.js\")));const w=S(1,771);class O extends n{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([l({count:8})],O.prototype,\"output\",void 0),e([l({count:3})],O.prototype,\"cullFace\",void 0),e([l()],O.prototype,\"slicePlaneEnabled\",void 0),e([l()],O.prototype,\"transparent\",void 0),e([l()],O.prototype,\"enableOffset\",void 0),e([l()],O.prototype,\"writeDepth\",void 0),e([l()],O.prototype,\"sceneHasOcludees\",void 0),e([l({count:4})],O.prototype,\"transparencyPassType\",void 0),e([l()],O.prototype,\"multipassTerrainEnabled\",void 0),e([l()],O.prototype,\"cullAboveGround\",void 0);export{E as ImageMaterialTechnique,O as ImageMaterialTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../lib/GLMaterialTexture.js\";import{Material as t,materialParametersDefaults as i}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as s}from\"../lib/OrderIndependentTransparency.js\";import{DefaultBufferWriter as a,PositionUVLayout as r}from\"./internal/DefaultBufferWriter.js\";import{intersectTriangleGeometry as n}from\"./internal/MaterialUtil.js\";import{ImageMaterialTechniqueConfiguration as u,ImageMaterialTechnique as h}from\"../shaders/ImageMaterialTechnique.js\";class c extends t{constructor(e){super(e,p),this.supportsEdges=!0,this.techniqueConfig=new u}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<s,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,s,a,r,u){n(e,t,s,a,r,void 0,u)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new l(e):void 0}createBufferWriter(){return new a(r)}}class l extends e{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(h,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){if(4===this._output)return 3===e;return e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const p={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...i};export{c as ImageMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{width as t,height as e,intersects as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{Geometry as i}from\"../../webgl-engine/lib/Geometry.js\";import r from\"../../webgl-engine/lib/GeometryUtil.js\";function o(n,i,r){const o=t(n)/e(n),a={width:r,height:r};return o>1.0001?a.height=r/o:o<.9999&&(a.width=r*o),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function a(t){return r.createSquareGeometry([[t[0],t[1],-1],[t[2],t[1],-1],[t[2],t[3],-1],[t[0],t[3],-1]])}function h(t,e){if(!n(t,e))return a(e);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],o=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],h=e[2]-e[0],u=e[3]-e[1],l=o[0]>0&&o[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,c=(m+1)*(l+1),g=new Float64Array(3*c),w=new Float32Array(2*c),d=new Uint32Array(6*(m*l-1));let f=0,p=0,y=0,x=0,M=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=o[r];t<=0||(g[p++]=e[0]+i,g[p++]=e[1]+f,g[p++]=-1,w[y++]=i/h,w[y++]=f/u,r<3&&n<3&&(1!==r||1!==n)&&(d[M++]=x,d[M++]=x+1,d[M++]=x+l+1,d[M++]=x+1,d[M++]=x+l+2,d[M++]=x+l+1),x++,i+=t)}f+=t}const v=new Uint32Array(d.length);return new i([[\"position\",{size:3,data:g,exclusive:!0}],[\"normal\",{size:3,data:s,exclusive:!0}],[\"uv0\",{size:2,data:w,exclusive:!0}]],[[\"position\",d],[\"normal\",v],[\"uv0\",d]])}const s=[0,0,1];export{o as computeImageExportSize,a as createGeometryForExtent,h as createOuterImageGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{forEach as t,result as i}from\"../../../core/asyncUtils.js\";import r from\"../../../core/Logger.js\";import{isSome as a,isNone as s}from\"../../../core/maybe.js\";import{isAbortError as n,eachAlways as o,createAbortController as l,onAbort as h,isAborted as m,createAbortError as d,always as c,throwIfAborted as g}from\"../../../core/promiseUtils.js\";import{whenOnce as u}from\"../../../core/watchUtils.js\";import{property as p}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as y}from\"../../../core/accessorSupport/decorators/subclass.js\";import f from\"../../../geometry/Extent.js\";import{create as x,equals as w,width as _,height as v,set as R,intersection as b}from\"../../../geometry/support/aaBoundingRect.js\";import{LayerView3D as S}from\"./LayerView3D.js\";import{computeImageExportSize as E,createGeometryForExtent as j,createOuterImageGeometry as I}from\"./support/overlayImageUtils.js\";import{toViewIfLocal as L}from\"./support/projectExtentUtils.js\";import A from\"../support/debugFlags.js\";import{RenderGeometry as C}from\"../webgl-engine/lib/RenderGeometry.js\";import{Texture as D}from\"../webgl-engine/lib/Texture.js\";import{ImageMaterial as M}from\"../webgl-engine/materials/ImageMaterial.js\";import G from\"../../layers/LayerView.js\";import{RefreshableLayerView as T}from\"../../layers/RefreshableLayerView.js\";const H=r.getLogger(\"esri.views.3d.layers.DynamicLayerView3D\");let O=class extends(T(S(G))){constructor(){super(...arguments),this.drapeSourceType=0,this.updatePolicy=1,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlayExtents=new Array,this.updateWhenStationary=!0}initialize(){this.addResolvingPromise(L(this).then((e=>this._set(\"fullExtentInLocalViewSpatialReference\",e)))),this.updatingHandles.add(this,\"suspended\",(()=>this._suspendedChangeHandler())),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((()=>{this._isScaleRangeActive()&&this.notifyChange(\"suspended\")}),(()=>{}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this.notifyChange(\"suspended\"))),\"local\"===this.view.viewingMode&&this.updatingHandles.add(this.view.basemapTerrain,\"extent\",(()=>this._overlayExtents.forEach(((e,t)=>this._updateImageExtent(t)))))}destroy(){this.clear()}setDrapingExtent(e,t){this._overlayExtents[e.index]={extent:x(e.extent),spatialReference:t,resolution:e.resolution,renderLocalOrigin:e.renderLocalOrigin,pixelRatio:e.pixelRatio},this._updateImageExtent(e.index)}_updateImageExtent(e){const t=this._overlayExtents[e],i=this._clippedExtent(t.extent,P),r=E(t.extent,i,t.resolution);let a=t.pixelRatio*this.view.pixelRatio;if(\"imageMaxWidth\"in this.layer||\"imageMaxHeight\"in this.layer){const e=this.layer.imageMaxWidth,t=this.layer.imageMaxHeight;if(r.width>e){const t=e/r.width;r.height=Math.floor(r.height*t),r.width=e,a*=t}if(r.height>t){const e=t/r.height;r.width=Math.floor(r.width*e),r.height=t,a*=e}}const s=this._extents[e];s&&w(s.extent,i)&&!this._imageSizeDiffers(i,s.imageSize,r)||(this._extents[e]={extent:x(i),spatialReference:t.spatialReference,imageSize:r,pixelRatio:a},this.suspended||this._fetch(e).catch((e=>{n(e)||H.error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(e){if(this.suspended)return;const t=[];for(let i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));await o(t)}canResume(){if(!super.canResume())return!1;if(this._isScaleRangeLayer()){const{minScale:e,maxScale:t}=this.layer;if(e>0||t>0){const i=this.view.scale;if(i<t||e>0&&i>e)return!1}}return!0}isUpdating(){return this._images.some((e=>!!e.loadingPromise))}async processResult(e,t,i){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const i=t.extent;if(new f(i[0],i[1],i[2],i[3],t.spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,i){await t(this._images,(async(t,r)=>{t&&(await e(t,i),await this._createStageObjects(r,t.image))}))}_imageSizeDiffers(e,t,i){if(!this.maximumDataResolution||A.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;const r=_(e)/this.maximumDataResolution.x,a=v(e)/this.maximumDataResolution.y,s=r/t.width,n=a/t.height,o=r/i.width,l=a/i.height,h=Math.abs(s-o),m=Math.abs(n-l);return h>1.5||m>1.5}async _fetch(e,t){if(this.suspended)return;const i=this._extents[e],r=i.extent;this._images[e]||(this._images[e]={texture:null,material:null,renderGeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:x(r)});const a=this._images[e];a.loadingAbortController&&(a.loadingAbortController.abort(),a.loadingAbortController=null);const s=new f(r[0],r[1],r[2],r[3],i.spatialReference);if(0===s.width||0===s.height)return void this._clearImage(e);const o=l();a.loadingAbortController=o,h(t,(()=>o.abort()));const g=o.signal,u=this._waitFetchReady(g).then((()=>{const t={requestAsImageElement:!0,pixelRatio:this._overlayExtents[e].pixelRatio,...this.getFetchOptions(),signal:g},{height:r,width:a}=i.imageSize;return t.timestamp=this.refreshTimestamp,this.layer.fetchImage(s,a,r,t)})).then((e=>{if(m(g))throw H.warnOnce(\"A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true.\"),d();return this.processResult(a,e)})).then((()=>R(a.renderExtent,r)));a.loadingPromise=u,c(u,(()=>{u===a.loadingPromise&&(a.loadingPromise=null,a.loadingAbortController=null)}));const p=u.then((async()=>{await this._createStageObjects(e,a.image),this.notifyChange(\"updating\")})).catch((e=>{throw e&&!n(e)&&H.error(e),this.notifyChange(\"updating\"),e}));this.notifyChange(\"updating\"),await p}_clearImage(e){const t=this._images[e];if(t){a(t.renderGeometry)&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.renderGeometry],this,2),t.renderGeometry=null);const e=this.view._stage;e.remove(t.texture),t.texture=null,e.remove(t.material),t.material=null,t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null}}async _createStageObjects(e,t){const r=this.view._stage,n=this._images[e],o=this.view.basemapTerrain.overlayManager.renderer,l=()=>{r.remove(n.texture),n.texture=null,a(n.renderGeometry)&&(o.removeGeometries([n.renderGeometry],this,2),n.renderGeometry=null)};if(t){const a=new D(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});let h;if(await i(this._images[0===e?1:0].loadingPromise),0===e)h=j(n.renderExtent);else{const e=this._images[0].renderExtent;if(!e)return void l();h=I(e,n.renderExtent)}l(),r.add(a),n.texture=a,s(n.material)?(n.material=new M({transparent:!0,textureId:a.id}),r.add(n.material)):n.material.setParameterValues({textureId:a.id}),n.renderGeometry=new C(h,n.material),n.renderGeometry.origin=this._overlayExtents[e].renderLocalOrigin,o.addGeometries([n.renderGeometry],this,2)}else l(),r.remove(n.material),n.material=null}_isScaleRangeLayer(){return\"minScale\"in this.layer&&\"maxScale\"in this.layer}_isScaleRangeActive(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)}_clippedExtent(e,t){if(\"local\"!==this.view.viewingMode)return R(t,e);const i=this.view.basemapTerrain,r=i.extent;return i.ready&&r?b(e,r,t):R(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refresh()}async _waitFetchReady(e){await u(this.view,\"stationary\",e),g(e)}};e([p()],O.prototype,\"layer\",void 0),e([p()],O.prototype,\"suspended\",void 0),e([p({readOnly:!0})],O.prototype,\"fullExtentInLocalViewSpatialReference\",void 0),e([p()],O.prototype,\"updating\",void 0),O=e([y(\"esri.views.3d.layers.DynamicLayerView3D\")],O);const P=x();var V=O;export default V;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{isSome as e,isNone as t}from\"../../core/maybe.js\";import{getMetersPerUnitForSR as r}from\"../../core/unitUtils.js\";import{calculateTolerance as n}from\"../../renderers/support/clickToleranceUtils.js\";import i from\"../../geometry/Extent.js\";function a(t,n,a,o=new i){let s;if(\"2d\"===a.type)s=n*a.resolution;else if(\"3d\"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?r(o)/r(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,i){const o=i.toMap(e);if(t(o))return!1;return a(o,n(),i,s).intersects(r)}const s=new i;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nfunction e(e,n,i){if(n.flatten((({sublayers:e})=>e)).length!==e.length)return!0;return!!e.some((e=>e.originIdOf(\"minScale\")>i||e.originIdOf(\"maxScale\")>i||e.originIdOf(\"renderer\")>i||e.originIdOf(\"labelingInfo\")>i||e.originIdOf(\"opacity\")>i||e.originIdOf(\"labelsVisible\")>i||e.originIdOf(\"source\")>i))||!r(e,n)}function n(e,n,i){return!!e.some((e=>{const n=e.source;return!(!n||\"map-layer\"===n.type&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===i.gdbVersion))||e.originIdOf(\"renderer\")>2||e.originIdOf(\"labelingInfo\")>2||e.originIdOf(\"opacity\")>2||e.originIdOf(\"labelsVisible\")>2}))||!r(e,n)}function r(e,n){if(!e||!e.length)return!0;const r=n.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>r.length)return!1;let i=0;const o=r.length;for(const{id:t}of e){for(;i<o&&r[i]!==t;)i++;if(i>=o)return!1}return!0}function i(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}export{n as isExportDynamic,i as isSublayerOverhaul,e as shouldWriteSublayerStructure};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Accessor.js\";import{HandleOwnerMixin as s}from\"../../core/HandleOwner.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{isExportDynamic as o}from\"./sublayerUtils.js\";const l={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let n=class extends(s(r)){constructor(e){super(e),this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&o(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(l[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,r)=>(e[r.id]=r.definitionExpression,e)),{})):null}get version(){this.commitProperty(\"layers\"),this.commitProperty(\"layerDefs\"),this.commitProperty(\"dynamicLayers\"),this.commitProperty(\"timeExtent\");const e=this.layer;return e&&(e.commitProperty(\"dpi\"),e.commitProperty(\"imageFormat\"),e.commitProperty(\"imageTransparency\"),e.commitProperty(\"gdbVersion\")),(this._get(\"version\")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,a=0===r.minScale||t<=r.minScale,o=0===r.maxScale||t>=r.maxScale;r.visible&&(i||a&&o)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get(\"visibleSublayers\");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};e([t({readOnly:!0})],n.prototype,\"dynamicLayers\",null),e([t({readOnly:!0})],n.prototype,\"hasDynamicLayers\",null),e([t()],n.prototype,\"layer\",null),e([t({readOnly:!0})],n.prototype,\"layers\",null),e([t({readOnly:!0})],n.prototype,\"layerDefs\",null),e([t({type:Number})],n.prototype,\"scale\",void 0),e([t(a)],n.prototype,\"timeExtent\",void 0),e([t({readOnly:!0})],n.prototype,\"version\",null),e([t({readOnly:!0})],n.prototype,\"visibleSublayers\",null),n=e([i(\"esri.layers.mixins.ExportImageParameters\")],n);export{n as ExportImageParameters};\n"],"sourceRoot":""}