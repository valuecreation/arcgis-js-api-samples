/*! For license information please see 35.d2b60f66.chunk.js.LICENSE.txt */
(this["webpackJsonpjsapi-create-react-app"]=this["webpackJsonpjsapi-create-react-app"]||[]).push([[35],[function(e,t,r){"use strict";function i(e,t,r,i){var n,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,r,a):n(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a}r.d(t,"a",(function(){return i}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u}));var i=r(7),n=r(9),s=r(189),a=r(194),o=r(496);const l=i.a.getLogger("esri.core.accessorSupport.decorators.property");function c(e={}){return(t,r,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${r}. Accessor does not support static properties.`);const c=Object(a.b)(t,r);i&&(i.get||i.set?(c.get=i.get||c.get,c.set=i.set||c.set):"value"in i&&("value"in e&&l.warn(`@property() will redefine the value of "${r}" on "${t.constructor.name}" already defined in the metadata`,e),c.value=e.value=i.value)),null!=e.readOnly&&(c.readOnly=e.readOnly);const u=e.aliasOf;if(u){const e="string"==typeof u?u:u.source,t="string"==typeof u?null:!0===u.overridable;let i;c.dependsOn=[e],c.get=function(){let t=Object(s.b)(this,e);if("function"==typeof t){i||(i=e.split(".").slice(0,-1).join("."));const r=Object(s.b)(this,i);r&&(t=t.bind(r))}return t},c.readOnly||(c.set=t?function(e){void 0!==e?this._override(r,e):this._clearOverride(r)}:function(t){Object(o.a)(this,e,t)})}const h=e.type,p=e.types;c.cast||(h?c.cast=function(e){let t=0,r=e;if(Object(n.n)(e))return Object(n.f)(e);for(;Array.isArray(r)&&1===r.length&&"string"!=typeof r[0]&&"number"!=typeof r[0];)r=r[0],t++;const i=r;if(Object(n.o)(i))return 0===t?Object(n.j)(i):Object(n.h)(Object(n.j)(i),t);if(1===t)return Object(n.b)(i);if(t>1)return Object(n.g)(i,t);const s=e;return s.from?s.from:Object(n.m)(s)}(h):p&&(Array.isArray(p)?c.cast=Object(n.c)(Object(n.k)(p[0])):c.cast=Object(n.k)(p))),e.range&&(c.cast=d(c.cast,e.range)),Object(a.c)(c,e)}}function u(e,t,r){const i=Object(a.b)(e,r);i.json||(i.json={});let n=i.json;return void 0!==t&&(n.origins||(n.origins={}),n.origins[t]||(n.origins[t]={}),n=n.origins[t]),n}function d(e,t){return r=>{let i=+e(r);return null!=t.step&&(i=Math.round(i/t.step)*t.step),null!=t.min&&(i=Math.max(t.min,i)),null!=t.max&&(i=Math.min(t.max,i)),i}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return j})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return v})),r.d(t,"h",(function(){return _})),r.d(t,"i",(function(){return s})),r.d(t,"j",(function(){return n})),r.d(t,"k",(function(){return a})),r.d(t,"l",(function(){return y})),r.d(t,"m",(function(){return O})),r.d(t,"n",(function(){return g})),r.d(t,"o",(function(){return i})),r.d(t,"p",(function(){return m})),r.d(t,"q",(function(){return b})),r.d(t,"r",(function(){return p})),r.d(t,"s",(function(){return l})),r.d(t,"t",(function(){return u})),r.d(t,"u",(function(){return c}));const i=null;function n(e){return null!=e}function s(e){return null==e}function a(e){return void 0===e}function o(e,t){return n(e)?t(e):i}function l(e){return e}function c(e,t){if(s(e))throw new Error(t);return e}function u(e,t){return n(e)?e:"function"==typeof t?t():t}function d(e){return n(e)&&e.destroy(),null}function h(e){return n(e)&&e.dispose(),null}function p(e){return n(e)&&e.remove(),null}function f(e){return n(e)&&e.abort(),null}function b(e){return n(e)&&e.release(),null}function m(e){return null}function g(e,t){const r=new Array;return e.forEach((e=>{const i=t(e);n(i)&&r.push(i)})),r}function y(e,t){const r=new Array;for(const i of e)r.push(O(i,null,t));return r}function v(e,t){for(const r of e)O(r,null,t)}function O(e,t,r){return n(e)?r(e):t}function j(e,t){return n(e)?t(e):null}function _(e,...t){let r=e;for(let i=0;i<t.length&&r;++i)r=r[t[i]];return r}function w(e){return e}},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return N})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return b})),r.d(t,"g",(function(){return f})),r.d(t,"h",(function(){return l})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return j})),r.d(t,"k",(function(){return w})),r.d(t,"l",(function(){return c})),r.d(t,"m",(function(){return a})),r.d(t,"n",(function(){return g})),r.d(t,"o",(function(){return m})),r.d(t,"p",(function(){return L})),r.d(t,"q",(function(){return A})),r.d(t,"r",(function(){return s})),r.d(t,"s",(function(){return x})),r.d(t,"t",(function(){return O})),r.d(t,"u",(function(){return v})),r.d(t,"v",(function(){return y})),r.d(t,"w",(function(){return T})),r.d(t,"x",(function(){return R})),r.d(t,"y",(function(){return o})),r.d(t,"z",(function(){return S})),r.d(t,"A",(function(){return z})),r.d(t,"B",(function(){return C})),r.d(t,"C",(function(){return I})),r.d(t,"D",(function(){return V})),r.d(t,"E",(function(){return k})),r.d(t,"F",(function(){return E}));var i=r(5),n=r(49);function s(e){const t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function o(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function l(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function c(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function u(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function d(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function h(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function p(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function f(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function b(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function m(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}function g(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function y(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function v(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function O(e,t){const r=t[0],i=t[1],n=t[2];let s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function j(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function _(e,t,r){const i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2];return e[0]=n*l-s*o,e[1]=s*a-i*l,e[2]=i*o-n*a,e}function w(e,t,r,i){const n=t[0],s=t[1],a=t[2];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e}function x(e,t,r){const i=t[0],n=t[1],s=t[2];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12],e[1]=r[1]*i+r[5]*n+r[9]*s+r[13],e[2]=r[2]*i+r[6]*n+r[10]*s+r[14],e}function S(e,t,r){const i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function T(e,t,r){const i=r[0],n=r[1],s=r[2],a=r[3],o=t[0],l=t[1],c=t[2];let u=n*c-s*l,d=s*o-i*c,h=i*l-n*o,p=n*h-s*d,f=s*u-i*h,b=i*d-n*u;const m=2*a;return u*=m,d*=m,h*=m,p*=2,f*=2,b*=2,e[0]=o+u+p,e[1]=l+d+f,e[2]=c+h+b,e}function C(e,t){a(M,e),a(P,t),O(M,M),O(P,P);const r=j(M,P);return r>1?0:r<-1?Math.PI:Math.acos(r)}const M=Object(i.e)(),P=Object(i.e)();function A(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function E(e,t){const r=e[0],i=e[1],s=e[2],a=t[0],o=t[1],l=t[2];return Math.abs(r-a)<=n.a*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=n.a*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-l)<=n.a*Math.max(1,Math.abs(s),Math.abs(l))}function R(e,t,r){const i=r[0]-t[0],n=r[1]-t[1],s=r[2]-t[2];let a=i*i+n*n+s*s;return a>0?(a=1/Math.sqrt(a),e[0]=i*a,e[1]=n*a,e[2]=s*a,e):(e[0]=0,e[1]=0,e[2]=0,e)}const I=c,D=u,F=d,L=m,k=g,z=s,V=y;var N=Object.freeze({__proto__:null,length:s,copy:a,set:o,add:l,subtract:c,multiply:u,divide:d,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:h,max:p,round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:f,scaleAndAdd:b,distance:m,squaredDistance:g,squaredLength:y,negate:v,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:O,dot:j,cross:_,lerp:w,hermite:function(e,t,r,i,n,s){const a=s*s,o=a*(2*s-3)+1,l=a*(s-2)+s,c=a*(s-1),u=a*(3-2*s);return e[0]=t[0]*o+r[0]*l+i[0]*c+n[0]*u,e[1]=t[1]*o+r[1]*l+i[1]*c+n[1]*u,e[2]=t[2]*o+r[2]*l+i[2]*c+n[2]*u,e},bezier:function(e,t,r,i,n,s){const a=1-s,o=a*a,l=s*s,c=o*a,u=3*s*o,d=3*l*a,h=l*s;return e[0]=t[0]*c+r[0]*u+i[0]*d+n[0]*h,e[1]=t[1]*c+r[1]*u+i[1]*d+n[1]*h,e[2]=t[2]*c+r[2]*u+i[2]*d+n[2]*h,e},random:function(e,t){t=t||1;const r=2*Object(n.b)()*Math.PI,i=2*Object(n.b)()-1,s=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*s,e[1]=Math.sin(r)*s,e[2]=i*t,e},transformMat4:x,transformMat3:S,transformQuat:T,rotateX:function(e,t,r,i){const n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e},rotateY:function(e,t,r,i){const n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e},rotateZ:function(e,t,r,i){const n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e},angle:C,str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:A,equals:E,direction:R,sub:I,mul:D,div:F,dist:L,sqrDist:k,len:z,sqrLen:V})},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));r(8);const i=[r(287).a];var n=r(194),s=r(65);const a=new Set,o=new Set;function l(e){return t=>{t.prototype.declaredClass=e,function(e,t){for(const r of i)if(r.processPrototypePropertyMetadata)for(const i in e){const n=e[i];r.processPrototypePropertyMetadata(i,n,e,t)}}(Object(n.a)(t.prototype).properties,e),function(e){const t=e.prototype,r=t.declaredClass,s=Object(n.a)(t).properties;!function(e,t){for(const r of i)if(r.processClassPropertyMetadata)for(const i in e){const n=e[i];r.processClassPropertyMetadata(i,n,e,t)}}(s,r);const a={};for(const i of Object.getOwnPropertyNames(s)){const e=s[i];a[i]={enumerable:!0,configurable:!0,get:c(i,e),set(t){const r=this.__accessor__;if(void 0!==r){if(!Object.isFrozen(this)){if(r.initialized&&e.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${i}' of ${this.declaredClass}`);if(2===r.lifecycle&&e.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${i}' of ${this.declaredClass}`);r.set(i,t)}}else Object.defineProperty(this,i,{enumerable:!0,configurable:!0,writable:!0,value:t})}}}Object.defineProperties(e.prototype,a)}(t);const r=[],s=[];let l=t.prototype;for(;l;)l.hasOwnProperty("initialize")&&!a.has(l.initialize)&&(a.add(l.initialize),r.push(l.initialize)),l.hasOwnProperty("destroy")&&!o.has(l.destroy)&&(o.add(l.destroy),s.push(l.destroy)),l=Object.getPrototypeOf(l);a.clear(),o.clear();class u extends t{constructor(...e){if(super(...e),this.constructor===u&&"function"==typeof this.postscript){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let e=r.length-1;e>=0;e--)r[e].call(this)}}),s.length){let e=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!e){e=!0;for(let e=0;e<s.length;e++)s[e].call(this)}}})}this.postscript(...e)}}}return u.__accessorMetadata__=Object(n.a)(t.prototype),u.prototype.declaredClass=e,u}}function c(e,t){return null==t.get?function(){const t=this.__accessor__.properties.get(e);if(void 0===t)return;Object(s.c)(t);const r=this.__accessor__.store;return r.has(e)?r.get(e):t.metadata.value}:function(){const t=this.__accessor__.properties.get(e);if(void 0!==t)return t.getComputed()}}},function(e,t,r){"use strict";function i(){return[0,0,0]}function n(e){return[e[0],e[1],e[2]]}function s(e,t,r){return[e,t,r]}function a(e){const t=[0,0,0],r=Math.min(3,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function o(e,t){return new Float64Array(e,t,3)}function l(){return[0,0,0]}function c(){return s(1,1,1)}function u(){return s(1,0,0)}function d(){return s(0,1,0)}function h(){return s(0,0,1)}r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return i})),r.d(t,"f",(function(){return a})),r.d(t,"g",(function(){return s})),r.d(t,"h",(function(){return h}));const p=[0,0,0],f=c(),b=u(),m=d(),g=h();Object.freeze({__proto__:null,create:i,clone:n,fromValues:s,fromArray:a,createView:o,zeros:l,ones:c,unitX:u,unitY:d,unitZ:h,ZEROS:p,ONES:f,UNIT_X:b,UNIT_Y:m,UNIT_Z:g})},function(e,t,r){"use strict";function i(e,...t){let r="";for(let i=0;i<t.length;i++)r+=e[i]+t[i];return r+=e[e.length-1],r}r.d(t,"a",(function(){return i})),function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(i||(i={}))},function(e,t,r){"use strict";var i=r(114),n=(r(8),r(2)),s=r(134);const a={info:0,warn:1,error:2,none:3};class o{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},null!=e.level&&(this.level=e.level),null!=e.writer&&(this.writer=e.writer),this._module=e.module,o._loggers[this.module]=this;const t=this.module.lastIndexOf(".");-1!==t&&(this._parent=o.getLogger(this.module.slice(0,t)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const t=o._loggers;return o._loggers=e,t},set throttlingDisabled(e){o._throttlingDisabled=e}}}static getLogger(e){let t=o._loggers[e];return t||(t=new o({module:e})),t}_log(e,t,...r){if(this._matchLevel(e)){if("always"!==t&&!o._throttlingDisabled){const i=this._argsToKey(r),n=this._loggedMessages[e].get(i);if("once"===t&&null!=n||"oncePerTick"===t&&n&&n>=o._tickCounter)return;this._loggedMessages[e].set(i,o._tickCounter),o._scheduleTickCounterIncrement()}for(const t of i.a.log.interceptors)if(t(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,t){let r=this;for(;Object(n.j)(r);){const t=r[e];if(Object(n.j)(t))return t;r=r.parent}return t}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,t,...r){console[e](`[${t}]`,...r)}_matchLevel(e){const t=i.a.log.level?i.a.log.level:"warn";return a[this._parentWithMember("level",t)]<=a[e]}_argsToKey(...e){return Object(s.b)(JSON.stringify(e,((e,t)=>"object"!=typeof t||Array.isArray(t)?t:"[Object]")))}static _scheduleTickCounterIncrement(){o._tickCounterScheduled||(o._tickCounterScheduled=!0,Promise.resolve().then((()=>{o._tickCounter++,o._tickCounterScheduled=!1})))}}o._loggers={},o._tickCounter=0,o._tickCounterScheduled=!1,o._throttlingDisabled=!1,t.a=o},function(e,t,r){"use strict";var i,n,s=r(56);let a;var o,l;function c(e){return"function"==typeof a[e]?a[e]=a[e](s.a):a[e]}a=null!=(i=s.a.dojoConfig)&&i.has||null!=(n=s.a.esriConfig)&&n.has?{...null==(o=s.a.dojoConfig)?void 0:o.has,...null==(l=s.a.esriConfig)?void 0:l.has}:{},c.add=(e,t,r,i)=>((i||void 0===a[e])&&(a[e]=t),r&&c(e)),c.cache=a,c.add("esri-deprecation-warnings",!0),(()=>{c.add("host-webworker",void 0!==s.a.WorkerGlobalScope&&self instanceof s.a.WorkerGlobalScope);const e="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document;if(c.add("host-browser",e),c.add("host-node","object"==typeof s.a.process&&s.a.process.versions&&s.a.process.versions.node&&s.a.process.versions.v8),c.add("dom",e),c("host-browser")){const e=navigator,t=e.userAgent,r=e.appVersion,i=parseFloat(r);if(c.add("wp",parseFloat(t.split("Windows Phone")[1])||void 0),c.add("msapp",parseFloat(t.split("MSAppHost/")[1])||void 0),c.add("khtml",r.includes("Konqueror")?i:void 0),c.add("edge",parseFloat(t.split("Edge/")[1])||void 0),c.add("opr",parseFloat(t.split("OPR/")[1])||void 0),c.add("webkit",!c("wp")&&!c("edge")&&parseFloat(t.split("WebKit/")[1])||void 0),c.add("chrome",!c("edge")&&!c("opr")&&parseFloat(t.split("Chrome/")[1])||void 0),c.add("android",!c("wp")&&parseFloat(t.split("Android ")[1])||void 0),c.add("safari",!r.includes("Safari")||c("wp")||c("chrome")||c("android")||c("edge")||c("opr")?void 0:parseFloat(r.split("Version/")[1])),c.add("mac",r.includes("Macintosh")),!c("wp")&&t.match(/(iPhone|iPod|iPad)/)){const e=RegExp.$1.replace(/P/,"p"),r=t.match(/OS ([\d_]+)/)?RegExp.$1:"1",i=parseFloat(r.replace(/_/,".").replace(/_/g,""));c.add(e,i),c.add("ios",i)}c.add("trident",parseFloat(r.split("Trident/")[1])||void 0),c("webkit")||(!t.includes("Gecko")||c("wp")||c("khtml")||c("trident")||c("edge")||c.add("mozilla",i),c("mozilla")&&c.add("ff",parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0))}})(),(()=>{if(s.a.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),r=/iPhone/i.test(e);t&&c.add("esri-mobile",t),r&&c.add("esri-iPhone",r),c.add("esri-geolocation",!!navigator.geolocation)}c.add("esri-canvas-svg-support",!c("trident")),c.add("esri-wasm","WebAssembly"in s.a),c.add("esri-shared-array-buffer",(()=>{const e="SharedArrayBuffer"in s.a,t=!1===s.a.crossOriginIsolated;return e&&!t})),c.add("esri-atomics","Atomics"in s.a),c.add("esri-workers","Worker"in s.a),c.add("esri-text-decoder","TextDecoder"in s.a),c.add("esri-text-encoder","TextEncoder"in s.a),c.add("web-feat:cache","caches"in s.a),c.add("esri-workers-arraybuffer-transfer",!c("safari")||Number(c("safari"))>=12),c.add("featurelayer-snapshot-enabled",!0),c.add("featurelayer-snapshot-point-min-threshold",8e4),c.add("featurelayer-snapshot-point-max-threshold",4e5),c.add("featurelayer-snapshot-point-coverage",.1),c.add("featurelayer-advanced-symbols",!1),c.add("featurelayer-pbf",!0),c.add("featurelayer-pbf-statistics",!1),c.add("feature-layers-workers",!0),c.add("mapview-transitions-duration",200),c.add("mapserver-pbf-enabled",!1),c("host-webworker")||c("host-browser")&&(c.add("csp-restrictions",(()=>{try{new Function}catch{return!0}return!1})),c.add("esri-image-decode",(()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then((()=>{c.add("esri-image-decode",!0,!0,!0)})).catch((()=>{c.add("esri-image-decode",!1,!0,!0)}))}return!1})),c.add("esri-url-encodes-apostrophe",(()=>{const e=s.a.document.createElement("a");return e.href="?'",e.href.includes("?%27")})),c.add("vectortilelayer-max-buffers",c("ff")?160:Number.POSITIVE_INFINITY))})(),t.a=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return P})),r.d(t,"g",(function(){return _})),r.d(t,"h",(function(){return j})),r.d(t,"i",(function(){return o})),r.d(t,"j",(function(){return x})),r.d(t,"k",(function(){return S})),r.d(t,"l",(function(){return a})),r.d(t,"m",(function(){return g})),r.d(t,"n",(function(){return M})),r.d(t,"o",(function(){return w})),r.d(t,"p",(function(){return C}));r(8);const i=r(7).a.getLogger("esri.core.Accessor");function n(e){return null==e?e:new Date(e)}function s(e){return null==e?e:!!e}function a(e){return null==e?e:e.toString()}function o(e){return null==e?e:(e=parseFloat(e),isNaN(e)?0:e)}function l(e){return null==e?e:Math.round(parseFloat(e))}function c(e){return e&&e.constructor&&void 0!==e.constructor.__accessorMetadata__}function u(e,t){return null!=t&&e&&!(t instanceof e)}function d(e){return e&&"isCollection"in e}function h(e){return e&&e.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function p(e,t){return!!c(t)&&(i.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+b(e)+"'"),!0)}function f(e,t){return null==t?t:d(e)?function(e,t){if(!t||!t.constructor||!d(t.constructor))return p(e,t)?t:new e(t);const r=h(e.prototype.itemType),i=h(t.constructor.prototype.itemType);return r?i?r===i?t:r.prototype.isPrototypeOf(i.prototype)?new e(t):(p(e,t),t):new e(t):t}(e,t):u(e,t)?p(e,t)?t:new e(t):t}function b(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}function m(e){switch(e){case Number:return o;case T:return l;case Boolean:return s;case String:return a;case Date:return n;default:return f.bind(null,e)}}function g(e,t){const r=m(e);return 1===arguments.length?r:r(t)}function y(e,t,r){return 1===arguments.length?y.bind(null,e):t?Array.isArray(t)?t.map((t=>e(t,r))):[e(t,r)]:t}function v(e,t){return 1===arguments.length?y(g.bind(null,e)):y(g.bind(null,e),t)}function O(e,t,r){return 0!==t&&Array.isArray(r)?r.map((r=>O(e,t-1,r))):e(r)}function j(e,t,r){if(2===arguments.length)return j.bind(null,e,t);if(!r)return r;let i=t,n=r=O(e,t,r);for(;i>0&&Array.isArray(n);)i--,n=n[0];if(void 0!==n)for(let s=0;s<i;s++)r=[r];return r}function _(e,t,r){return 2===arguments.length?j(g.bind(null,e),t):j(g.bind(null,e),t,r)}function w(e){return!!Array.isArray(e)&&!e.some((t=>{const r=typeof t;return!("string"===r||"number"===r||"function"===r&&e.length>1)}))}function x(e,t){if(2===arguments.length)return x(e).call(null,t);const r=new Set,n=e.filter((e=>"function"!=typeof e)),s=e.filter((e=>"function"==typeof e));for(const i of e)"string"!=typeof i&&"number"!=typeof i||r.add(i);let a=null,o=null;return(e,t)=>{if(null==e)return e;const l=typeof e,c="string"===l||"number"===l;return c&&(r.has(e)||s.some((e=>"string"===l&&e===String||"number"===l&&e===Number)))||"object"===l&&s.some((t=>!u(e,t)))?e:(c&&n.length?(a||(a=n.map((e=>"string"==typeof e?`'${e}'`:`${e}`)).join(", ")),i.error("Accessor#set",`'${e}' is not a valid value for this property, only the following values are valid: ${a}`)):"object"==typeof e&&s.length?(o||(o=s.map((e=>b(e))).join(", ")),i.error("Accessor#set",`'${e}' is not a valid value for this property, value must be one of ${o}`)):i.error("Accessor#set",`'${e}' is not a valid value for this property`),t&&(t.valid=!1),null)}}function S(e,t){if(2===arguments.length)return S(e).call(null,t);const r={},n=[],s=[];for(const i in e.typeMap){const t=e.typeMap[i];r[i]=g(t),n.push(b(t)),s.push(i)}const a=()=>`'${n.join("', '")}'`,o=()=>`'${s.join("', '")}'`,l="string"==typeof e.key?t=>t[e.key]:e.key;return t=>{if(e.base&&!u(e.base,t))return t;if(null==t)return t;const n=l(t)||e.defaultKeyValue,s=r[n];if(!s)return i.error("Accessor#set",`Invalid property value, value needs to be one of ${a()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!u(e.typeMap[n],t))return t;if("string"==typeof e.key&&!c(t)){const r={};for(const i in t)i!==e.key&&(r[i]=t[i]);return s(r)}return s(t)}}class T{}const C={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function M(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function P(e){switch(e.type){case"native":return g(e.value);case"array":return y(P(e.value));case"one-of":return function(e){let t=null;return(r,n)=>E(r,e)?r:(null==t&&(t=A(e)),i.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),n&&(n.valid=!1),null)}(e);default:return null}}function A(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case T:return"integer";case Date:return"date";default:return b(e.value)}case"array":return`array of ${A(e.value)}`;case"one-of":{const t=e.values.map((e=>A(e)));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function E(e,t){if(null==e)return!0;switch(t.type){case"native":switch(t.value){case Number:case T:return"number"==typeof e;case Boolean:return"boolean"==typeof e;case String:return"string"==typeof e}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some((e=>!E(e,t.value)));case"one-of":return t.values.some((t=>E(e,t)))}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return v})),r.d(t,"d",(function(){return S})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return b})),r.d(t,"h",(function(){return j})),r.d(t,"i",(function(){return O})),r.d(t,"j",(function(){return s})),r.d(t,"k",(function(){return a})),r.d(t,"l",(function(){return c})),r.d(t,"m",(function(){return f})),r.d(t,"n",(function(){return p})),r.d(t,"o",(function(){return d})),r.d(t,"p",(function(){return o})),r.d(t,"q",(function(){return u})),r.d(t,"r",(function(){return m})),r.d(t,"s",(function(){return g})),r.d(t,"t",(function(){return h})),r.d(t,"u",(function(){return x}));var i=r(3);const n=new Float32Array(1),s=Number.isFinite||function(e){return"number"==typeof e&&window.isFinite(e)},a=Number.isNaN||function(e){return e!=e};function o(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function l(e,t,r){return Math.min(Math.max(e,t),r)}function c(e){return 0==(e&e-1)}function u(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function d(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}const h=Math.sign||function(e){return+(e>0)-+(e<0)||+e},p=Math.log2||function(e){return Math.log(e)/Math.LN2};function f(e,t,r){return e+(t-e)*r}function b(e){return e*Math.PI/180}function m(e){return 180*e/Math.PI}function g(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function y(e){return Math.acos(l(e,-1,1))}function v(e){return Math.asin(l(e,-1,1))}function O(e,t,r=1e-6){if(a(e)||a(t))return!1;if(e===t)return!0;const i=Math.abs(e-t),n=Math.abs(e),s=Math.abs(t);if(0===e||0===t||n<1e-12&&s<1e-12){if(i>.01*r)return!1}else if(i/(n+s)>r)return!1;return!0}function j(e,t,r=1e-6){return!a(e)&&!a(t)&&(e>t?e-t:t-e)<=r}function _(e){return w(Math.max(-T,Math.min(e,T)))}function w(e){return n[0]=e,n[0]}function x(e,t,r){const i=l((r-e)/(t-e),0,1);return i*i*(3-2*i)}function S(e,t){const r=Object(i.r)(e),n=v(e[2]/r),s=Math.atan2(e[1]/r,e[0]/r);return Object(i.y)(t,r,n,s),t}const T=w(34028234663852886e22)},function(e,t,r){"use strict";var i=r(13),n=r(7),s=r(494);class a extends s.a{constructor(e,t,r){if(super(e,t,r),!(this instanceof a))return new a(e,t,r)}toJSON(){if(null!=this.details)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,((e,t)=>{if(t&&"object"==typeof t&&"function"==typeof t.toJSON)return t;try{return Object(i.a)(t)}catch(a){return"[object]"}})))}}catch(e){throw n.a.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new a(e.name,e.message,e.details)}}a.prototype.type="error",t.a=a},function(e,t,r){"use strict";r.d(t,"a",(function(){return M})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return D})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return w})),r.d(t,"h",(function(){return I})),r.d(t,"i",(function(){return F})),r.d(t,"j",(function(){return R})),r.d(t,"k",(function(){return x})),r.d(t,"l",(function(){return S})),r.d(t,"m",(function(){return j})),r.d(t,"n",(function(){return O})),r.d(t,"o",(function(){return f})),r.d(t,"p",(function(){return E})),r.d(t,"q",(function(){return P})),r.d(t,"r",(function(){return _})),r.d(t,"s",(function(){return g})),r.d(t,"t",(function(){return y})),r.d(t,"u",(function(){return T})),r.d(t,"v",(function(){return C})),r.d(t,"w",(function(){return b})),r.d(t,"x",(function(){return h})),r.d(t,"y",(function(){return m})),r.d(t,"z",(function(){return A})),r.d(t,"A",(function(){return v}));var i=r(319),n=r(11),s=r(155),a=r(7),o=r(2);function l(e){return Promise.all(e)}function c(e){return new Promise(((t,r)=>{try{e(t,r)}catch(i){Promise.resolve().then((()=>r(i)))}}))}function u(e="Aborted"){return new n.a("AbortError",e)}function d(){return new AbortController}function h(e,t="Aborted"){if(f(e))throw u(t)}function p(e){return Object(o.j)(e)?"aborted"in e?e:e.signal:e}function f(e){const t=p(e);return Object(o.j)(t)&&t.aborted}function b(e){if(O(e))throw e}function m(e){if(!O(e))throw e}function g(e,t){const r=p(e);if(!Object(o.i)(r)){if(!r.aborted)return Object(s.d)(r,"abort",(()=>t()));t()}}function y(e,t){const r=p(e);if(!Object(o.i)(r))return h(r),Object(s.d)(r,"abort",(()=>t(u())))}function v(e,t){const r=p(t);return Object(o.i)(r)?e:new Promise(((r,i)=>{let n=g(t,(()=>i(u())));const s=()=>n=Object(o.r)(n);e.then(s,s),e.then(r,i)}))}function O(e){return e&&"AbortError"===e.name}function j(e){return e.catch((e=>{if(!O(e))throw e}))}function _(e,t=a.a.getLogger("esri")){return e.catch((e=>{O(e)||t.error(e)}))}function w(){let e=null;const t=new Promise(((t,r)=>{e={promise:void 0,resolve:t,reject:r}}));return e.promise=t,e}function x(e){if(!e)return;if("function"!=typeof e.forEach){const t=Object.keys(e);return x(t.map((t=>e[t]))).then((e=>{const r={};return t.forEach(((t,i)=>r[t]=e[i])),r}))}const t=e;return c((e=>{const r=[];let i=t.length;0===i&&e(r),t.forEach((t=>{const n={promise:t||Promise.resolve(t)};r.push(n),n.promise.then((e=>{n.value=e})).catch((e=>{n.error=e})).then((()=>{--i,0===i&&e(r)}))}))}))}function S(e){return x(e).then((e=>e.filter((e=>!!e.value)).map((e=>e.value))))}function T(e){return Promise.reject(e)}function C(e){return Promise.resolve(e)}function M(e,t,r){const i=d();return g(r,(()=>i.abort())),new Promise(((r,n)=>{let s=setTimeout((()=>{s=0,r(t)}),e);g(i,(()=>{s&&(clearTimeout(s),n(u()))}))}))}function P(e){return e&&"function"==typeof e.then}function A(e){return E(e)?e:Promise.resolve(e)}function E(e){return e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}function R(e,t=-1){let r,i,n,s,a=null;const l=(...c)=>{if(r){i=c,s&&s.reject(u()),s=w();const e=Object(o.d)(s.promise);if(a){const e=a;a=null,e.abort()}return e}if(n=s||w(),s=null,t>0){const i=d();r=A(e(...c,i.signal));const n=r;M(t).then((()=>{r===n&&(s?i.abort():a=i)}))}else r=1,r=A(e(...c));const h=()=>{const e=i;i=n=r=a=null,null!=e&&l(...e)},p=r,f=n;return p.then(h,h),p.then(f.resolve,f.reject),Object(o.d)(f.promise)};return l}function I(){let e,t;const r=new Promise(((r,i)=>{e=r,t=i})),n=t=>{e(t)};return n.resolve=t=>e(t),n.reject=e=>t(e),n.timeout=(e,t)=>i.a.setTimeout((()=>n.reject(t)),e),n.promise=r,n}function D(e,t){return e.then(t,t)}function F(e){let t=d();const r=e(t.signal);let i={promise:r,finished:!1,abort:()=>{t&&(t.abort(),t=null)}};const n=()=>{i&&(i.finished=!0,i=null),t=null};return r.then(n,n),i}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n}));r(8);var i=r(81);function n(e,t){let r;if(t)for(r in e)e.hasOwnProperty(r)&&(void 0===e[r]?delete e[r]:e[r]instanceof Object&&n(e[r],!0));else for(r in e)e.hasOwnProperty(r)&&void 0===e[r]&&delete e[r];return e}function s(e){if(!e||"object"!=typeof e||"function"==typeof e)return e;if(Object(i.h)(e)||Object(i.k)(e)||Object(i.l)(e)||Object(i.f)(e)||Object(i.i)(e)||Object(i.g)(e)||Object(i.j)(e)||Object(i.d)(e)||Object(i.e)(e))return Object(i.m)(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach(((e,r)=>{t.set(r,s(e))})),t}if(e instanceof Set){const t=new Set;return e.forEach((e=>{t.add(s(e))})),t}let t;const r=e;if("function"==typeof r.clone)t=r.clone();else if("function"==typeof r.map&&"function"==typeof r.forEach)t=r.map(s);else if("function"==typeof r.notifyChange&&"function"==typeof r.watch)t=r.clone();else{t={};for(const r of Object.getOwnPropertyNames(e))t[r]=s(e[r])}return t}function a(e,t){return e===t||"number"==typeof e&&isNaN(e)&&"number"==typeof t&&isNaN(t)||"function"==typeof(e||{}).getTime&&"function"==typeof(t||{}).getTime&&e.getTime()===t.getTime()||!1}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l}));var i=r(0),n=r(19),s=r(320),a=r(386),o=r(4);const l=e=>{let t=class extends e{constructor(...e){super(...e)}read(e,t){Object(s.a)(this,e,t)}write(e={},t){return Object(a.b)(this,e,t)}toJSON(e){return this.write({},e)}static fromJSON(e,t){return c.call(this,e,t)}};return t=Object(i.a)([Object(o.a)("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function c(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(e,t),r}let u=class extends(l(n.a)){};u=Object(i.a)([Object(o.a)("esri.core.JSONSupport")],u)},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var i=r(10);class n{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits.map((()=>0))}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const r of e)t[r]=this[r];return t}}function s(e={}){return(t,r)=>{var n,s;t._parameterNames=null!=(n=t._parameterNames)?n:[],t._parameterNames.push(r);const a=t._parameterNames.length-1,o=e.count||2,l=Math.ceil(Object(i.n)(o)),c=null!=(s=t._parameterBits)?s:[0];let u=0;for(;c[u]+l>16;)u++,u>=c.length&&c.push(0);t._parameterBits=c;const d=c[u],h=(1<<l)-1<<d;c[u]+=l,Object.defineProperty(t,r,{get(){return this[a]},set(e){if(this[a]!==e&&(this[a]=e,this._keyDirty=!0,this._parameterBits[u]=this._parameterBits[u]&~h|+e<<d&h,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+r+" must be boolean or number, got "+typeof e}})}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return P})),r.d(t,"g",(function(){return M})),r.d(t,"h",(function(){return a})),r.d(t,"i",(function(){return o})),r.d(t,"j",(function(){return b})),r.d(t,"k",(function(){return x})),r.d(t,"l",(function(){return T})),r.d(t,"m",(function(){return u})),r.d(t,"n",(function(){return v})),r.d(t,"o",(function(){return S})),r.d(t,"p",(function(){return A})),r.d(t,"q",(function(){return g})),r.d(t,"r",(function(){return m})),r.d(t,"s",(function(){return h})),r.d(t,"t",(function(){return d})),r.d(t,"u",(function(){return _})),r.d(t,"v",(function(){return y})),r.d(t,"w",(function(){return w}));var i=r(5),n=r(49);function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a(e,t,r,i,n,s,a,o,l,c,u,d,h,p,f,b,m){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=c,e[9]=u,e[10]=d,e[11]=h,e[12]=p,e[13]=f,e[14]=b,e[15]=m,e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t){if(e===t){const r=t[1],i=t[2],n=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function c(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],f=t[12],b=t[13],m=t[14],g=t[15],y=r*o-i*a,v=r*l-n*a,O=r*c-s*a,j=i*l-n*o,_=i*c-s*o,w=n*c-s*l,x=u*b-d*f,S=u*m-h*f,T=u*g-p*f,C=d*m-h*b,M=d*g-p*b,P=h*g-p*m;let A=y*P-v*M+O*C+j*T-_*S+w*x;return A?(A=1/A,e[0]=(o*P-l*M+c*C)*A,e[1]=(n*M-i*P-s*C)*A,e[2]=(b*w-m*_+g*j)*A,e[3]=(h*_-d*w-p*j)*A,e[4]=(l*T-a*P-c*S)*A,e[5]=(r*P-n*T+s*S)*A,e[6]=(m*O-f*w-g*v)*A,e[7]=(u*w-h*O+p*v)*A,e[8]=(a*M-o*T+c*x)*A,e[9]=(i*T-r*M-s*x)*A,e[10]=(f*_-b*O+g*y)*A,e[11]=(d*O-u*_-p*y)*A,e[12]=(o*S-a*C-l*x)*A,e[13]=(r*C-i*S+n*x)*A,e[14]=(b*v-f*j-m*y)*A,e[15]=(u*j-d*v+h*y)*A,e):null}function u(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],p=t[10],f=t[11],b=t[12],m=t[13],g=t[14],y=t[15];let v=r[0],O=r[1],j=r[2],_=r[3];return e[0]=v*i+O*o+j*d+_*b,e[1]=v*n+O*l+j*h+_*m,e[2]=v*s+O*c+j*p+_*g,e[3]=v*a+O*u+j*f+_*y,v=r[4],O=r[5],j=r[6],_=r[7],e[4]=v*i+O*o+j*d+_*b,e[5]=v*n+O*l+j*h+_*m,e[6]=v*s+O*c+j*p+_*g,e[7]=v*a+O*u+j*f+_*y,v=r[8],O=r[9],j=r[10],_=r[11],e[8]=v*i+O*o+j*d+_*b,e[9]=v*n+O*l+j*h+_*m,e[10]=v*s+O*c+j*p+_*g,e[11]=v*a+O*u+j*f+_*y,v=r[12],O=r[13],j=r[14],_=r[15],e[12]=v*i+O*o+j*d+_*b,e[13]=v*n+O*l+j*h+_*m,e[14]=v*s+O*c+j*p+_*g,e[15]=v*a+O*u+j*f+_*y,e}function d(e,t,r){const i=r[0],n=r[1],s=r[2];let a,o,l,c,u,d,h,p,f,b,m,g;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*s+t[12],e[13]=t[1]*i+t[5]*n+t[9]*s+t[13],e[14]=t[2]*i+t[6]*n+t[10]*s+t[14],e[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(a=t[0],o=t[1],l=t[2],c=t[3],u=t[4],d=t[5],h=t[6],p=t[7],f=t[8],b=t[9],m=t[10],g=t[11],e[0]=a,e[1]=o,e[2]=l,e[3]=c,e[4]=u,e[5]=d,e[6]=h,e[7]=p,e[8]=f,e[9]=b,e[10]=m,e[11]=g,e[12]=a*i+u*n+f*s+t[12],e[13]=o*i+d*n+b*s+t[13],e[14]=l*i+h*n+m*s+t[14],e[15]=c*i+p*n+g*s+t[15]),e}function h(e,t,r){const i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function p(e,t,r,i){let s,a,o,l,c,u,d,h,p,f,b,m,g,y,v,O,j,_,w,x,S,T,C,M,P=i[0],A=i[1],E=i[2],R=Math.sqrt(P*P+A*A+E*E);return R<n.a?null:(R=1/R,P*=R,A*=R,E*=R,s=Math.sin(r),a=Math.cos(r),o=1-a,l=t[0],c=t[1],u=t[2],d=t[3],h=t[4],p=t[5],f=t[6],b=t[7],m=t[8],g=t[9],y=t[10],v=t[11],O=P*P*o+a,j=A*P*o+E*s,_=E*P*o-A*s,w=P*A*o-E*s,x=A*A*o+a,S=E*A*o+P*s,T=P*E*o+A*s,C=A*E*o-P*s,M=E*E*o+a,e[0]=l*O+h*j+m*_,e[1]=c*O+p*j+g*_,e[2]=u*O+f*j+y*_,e[3]=d*O+b*j+v*_,e[4]=l*w+h*x+m*S,e[5]=c*w+p*x+g*S,e[6]=u*w+f*x+y*S,e[7]=d*w+b*x+v*S,e[8]=l*T+h*C+m*M,e[9]=c*T+p*C+g*M,e[10]=u*T+f*C+y*M,e[11]=d*T+b*C+v*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function f(e,t,r){const i=Math.sin(r),n=Math.cos(r),s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+c*i,e[5]=a*n+u*i,e[6]=o*n+d*i,e[7]=l*n+h*i,e[8]=c*n-s*i,e[9]=u*n-a*i,e[10]=d*n-o*i,e[11]=h*n-l*i,e}function b(e,t,r){const i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-c*i,e[1]=a*n-u*i,e[2]=o*n-d*i,e[3]=l*n-h*i,e[8]=s*i+c*n,e[9]=a*i+u*n,e[10]=o*i+d*n,e[11]=l*i+h*n,e}function m(e,t,r){const i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],c=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+c*i,e[1]=a*n+u*i,e[2]=o*n+d*i,e[3]=l*n+h*i,e[4]=c*n-s*i,e[5]=u*n-a*i,e[6]=d*n-o*i,e[7]=h*n-l*i,e}function g(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function y(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function O(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=i+i,l=n+n,c=s+s,u=i*o,d=i*l,h=i*c,p=n*l,f=n*c,b=s*c,m=a*o,g=a*l,y=a*c;return e[0]=1-(p+b),e[1]=d+y,e[2]=h-g,e[3]=0,e[4]=d-y,e[5]=1-(u+b),e[6]=f+m,e[7]=0,e[8]=h+g,e[9]=f-m,e[10]=1-(u+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}const j=Object(i.e)();function _(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function w(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,l=n+n,c=r*a,u=i*a,d=i*o,h=n*a,p=n*o,f=n*l,b=s*a,m=s*o,g=s*l;return e[0]=1-d-f,e[1]=u+g,e[2]=h-m,e[3]=0,e[4]=u-g,e[5]=1-c-f,e[6]=p+b,e[7]=0,e[8]=h+m,e[9]=p-b,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t,r,i,n,s,a){const o=1/(r-t),l=1/(n-i),c=1/(s-a);return e[0]=2*s*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*l,e[10]=(a+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*c,e[15]=0,e}function S(e,t,r,i,n,s,a){const o=1/(t-r),l=1/(i-n),c=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(a+s)*c,e[15]=1,e}function T(e,t,r,i){let s,a,l,c,u,d,h,p,f,b;const m=t[0],g=t[1],y=t[2],v=i[0],O=i[1],j=i[2],_=r[0],w=r[1],x=r[2];return Math.abs(m-_)<n.a&&Math.abs(g-w)<n.a&&Math.abs(y-x)<n.a?o(e):(h=m-_,p=g-w,f=y-x,b=1/Math.sqrt(h*h+p*p+f*f),h*=b,p*=b,f*=b,s=O*f-j*p,a=j*h-v*f,l=v*p-O*h,b=Math.sqrt(s*s+a*a+l*l),b?(b=1/b,s*=b,a*=b,l*=b):(s=0,a=0,l=0),c=p*l-f*a,u=f*s-h*l,d=h*a-p*s,b=Math.sqrt(c*c+u*u+d*d),b?(b=1/b,c*=b,u*=b,d*=b):(c=0,u=0,d=0),e[0]=s,e[1]=c,e[2]=h,e[3]=0,e[4]=a,e[5]=u,e[6]=p,e[7]=0,e[8]=l,e[9]=d,e[10]=f,e[11]=0,e[12]=-(s*m+a*g+l*y),e[13]=-(c*m+u*g+d*y),e[14]=-(h*m+p*g+f*y),e[15]=1,e)}function C(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function M(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function P(e,t){const r=e[0],i=e[1],s=e[2],a=e[3],o=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=e[9],p=e[10],f=e[11],b=e[12],m=e[13],g=e[14],y=e[15],v=t[0],O=t[1],j=t[2],_=t[3],w=t[4],x=t[5],S=t[6],T=t[7],C=t[8],M=t[9],P=t[10],A=t[11],E=t[12],R=t[13],I=t[14],D=t[15];return Math.abs(r-v)<=n.a*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-O)<=n.a*Math.max(1,Math.abs(i),Math.abs(O))&&Math.abs(s-j)<=n.a*Math.max(1,Math.abs(s),Math.abs(j))&&Math.abs(a-_)<=n.a*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-w)<=n.a*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(l-x)<=n.a*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(c-S)<=n.a*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-T)<=n.a*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(d-C)<=n.a*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(h-M)<=n.a*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(p-P)<=n.a*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(f-A)<=n.a*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(b-E)<=n.a*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(m-R)<=n.a*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-I)<=n.a*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(y-D)<=n.a*Math.max(1,Math.abs(y),Math.abs(D))}function A(e){const t=n.a,r=e[0],i=e[1],s=e[2],a=e[4],o=e[5],l=e[6],c=e[8],u=e[9],d=e[10];return Math.abs(1-(r*r+a*a+c*c))<=t&&Math.abs(1-(i*i+o*o+u*u))<=t&&Math.abs(1-(s*s+l*l+d*d))<=t}const E=u,R=C;Object.freeze({__proto__:null,copy:s,set:a,identity:o,transpose:l,invert:c,adjoint:function(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],f=t[12],b=t[13],m=t[14],g=t[15];return e[0]=o*(h*g-p*m)-d*(l*g-c*m)+b*(l*p-c*h),e[1]=-(i*(h*g-p*m)-d*(n*g-s*m)+b*(n*p-s*h)),e[2]=i*(l*g-c*m)-o*(n*g-s*m)+b*(n*c-s*l),e[3]=-(i*(l*p-c*h)-o*(n*p-s*h)+d*(n*c-s*l)),e[4]=-(a*(h*g-p*m)-u*(l*g-c*m)+f*(l*p-c*h)),e[5]=r*(h*g-p*m)-u*(n*g-s*m)+f*(n*p-s*h),e[6]=-(r*(l*g-c*m)-a*(n*g-s*m)+f*(n*c-s*l)),e[7]=r*(l*p-c*h)-a*(n*p-s*h)+u*(n*c-s*l),e[8]=a*(d*g-p*b)-u*(o*g-c*b)+f*(o*p-c*d),e[9]=-(r*(d*g-p*b)-u*(i*g-s*b)+f*(i*p-s*d)),e[10]=r*(o*g-c*b)-a*(i*g-s*b)+f*(i*c-s*o),e[11]=-(r*(o*p-c*d)-a*(i*p-s*d)+u*(i*c-s*o)),e[12]=-(a*(d*m-h*b)-u*(o*m-l*b)+f*(o*h-l*d)),e[13]=r*(d*m-h*b)-u*(i*m-n*b)+f*(i*h-n*d),e[14]=-(r*(o*m-l*b)-a*(i*m-n*b)+f*(i*l-n*o)),e[15]=r*(o*h-l*d)-a*(i*h-n*d)+u*(i*l-n*o),e},determinant:function(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],b=e[14],m=e[15];return(t*a-r*s)*(d*m-h*b)-(t*o-i*s)*(u*m-h*f)+(t*l-n*s)*(u*b-d*f)+(r*o-i*a)*(c*m-h*p)-(r*l-n*a)*(c*b-d*p)+(i*l-n*o)*(c*f-u*p)},multiply:u,translate:d,scale:h,rotate:p,rotateX:f,rotateY:b,rotateZ:m,fromTranslation:g,fromScaling:y,fromRotation:function(e,t,r){let i,s,a,o=r[0],l=r[1],c=r[2],u=Math.sqrt(o*o+l*l+c*c);return u<n.a?null:(u=1/u,o*=u,l*=u,c*=u,i=Math.sin(t),s=Math.cos(t),a=1-s,e[0]=o*o*a+s,e[1]=l*o*a+c*i,e[2]=c*o*a-l*i,e[3]=0,e[4]=o*l*a-c*i,e[5]=l*l*a+s,e[6]=c*l*a+o*i,e[7]=0,e[8]=o*c*a+l*i,e[9]=l*c*a-o*i,e[10]=c*c*a+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:v,fromYRotation:function(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:O,fromQuat2:function(e,t){const r=j,i=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],d=i*i+n*n+s*s+a*a;return d>0?(r[0]=2*(o*a+u*i+l*s-c*n)/d,r[1]=2*(l*a+u*n+c*i-o*s)/d,r[2]=2*(c*a+u*s+o*n-l*i)/d):(r[0]=2*(o*a+u*i+l*s-c*n),r[1]=2*(l*a+u*n+c*i-o*s),r[2]=2*(c*a+u*s+o*n-l*i)),O(e,t,r),e},getTranslation:_,getScaling:function(e,t){const r=t[0],i=t[1],n=t[2],s=t[4],a=t[5],o=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(s*s+a*a+o*o),e[2]=Math.sqrt(l*l+c*c+u*u),e},getRotation:function(e,t){const r=t[0]+t[5]+t[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},fromRotationTranslationScale:function(e,t,r,i){const n=t[0],s=t[1],a=t[2],o=t[3],l=n+n,c=s+s,u=a+a,d=n*l,h=n*c,p=n*u,f=s*c,b=s*u,m=a*u,g=o*l,y=o*c,v=o*u,O=i[0],j=i[1],_=i[2];return e[0]=(1-(f+m))*O,e[1]=(h+v)*O,e[2]=(p-y)*O,e[3]=0,e[4]=(h-v)*j,e[5]=(1-(d+m))*j,e[6]=(b+g)*j,e[7]=0,e[8]=(p+y)*_,e[9]=(b-g)*_,e[10]=(1-(d+f))*_,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,r,i,n){const s=t[0],a=t[1],o=t[2],l=t[3],c=s+s,u=a+a,d=o+o,h=s*c,p=s*u,f=s*d,b=a*u,m=a*d,g=o*d,y=l*c,v=l*u,O=l*d,j=i[0],_=i[1],w=i[2],x=n[0],S=n[1],T=n[2],C=(1-(b+g))*j,M=(p+O)*j,P=(f-v)*j,A=(p-O)*_,E=(1-(h+g))*_,R=(m+y)*_,I=(f+v)*w,D=(m-y)*w,F=(1-(h+b))*w;return e[0]=C,e[1]=M,e[2]=P,e[3]=0,e[4]=A,e[5]=E,e[6]=R,e[7]=0,e[8]=I,e[9]=D,e[10]=F,e[11]=0,e[12]=r[0]+x-(C*x+A*S+I*T),e[13]=r[1]+S-(M*x+E*S+D*T),e[14]=r[2]+T-(P*x+R*S+F*T),e[15]=1,e},fromQuat:w,frustum:x,perspective:function(e,t,r,i,n){const s=1/Math.tan(t/2);let a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(a=1/(i-n),e[10]=(n+i)*a,e[14]=2*n*i*a):(e[10]=-1,e[14]=-2*i),e},perspectiveFromFieldOfView:function(e,t,r,i){const n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+o),c=2/(n+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-o)*l*.5,e[9]=(n-s)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},ortho:S,lookAt:T,targetTo:function(e,t,r,i){const n=t[0],s=t[1],a=t[2],o=i[0],l=i[1],c=i[2];let u=n-r[0],d=s-r[1],h=a-r[2],p=u*u+d*d+h*h;p>0&&(p=1/Math.sqrt(p),u*=p,d*=p,h*=p);let f=l*h-c*d,b=c*u-o*h,m=o*d-l*u;return p=f*f+b*b+m*m,p>0&&(p=1/Math.sqrt(p),f*=p,b*=p,m*=p),e[0]=f,e[1]=b,e[2]=m,e[3]=0,e[4]=d*m-h*b,e[5]=h*f-u*m,e[6]=u*b-d*f,e[7]=0,e[8]=u,e[9]=d,e[10]=h,e[11]=0,e[12]=n,e[13]=s,e[14]=a,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},subtract:C,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},exactEquals:M,equals:P,isOrthoNormal:A,mul:E,sub:R})},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return o})),r.d(t,"f",(function(){return l})),r.d(t,"g",(function(){return n})),r.d(t,"h",(function(){return s})),r.d(t,"i",(function(){return p})),r.d(t,"j",(function(){return a}));const i=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function n(e){return e?e/72*96:0}function s(e){return e?72*e/96:0}function a(e){if("string"==typeof e){if(i.test(e)){const t=e.match(i),r=Number(t[1]),n=t[3]&&t[3].toLowerCase(),a="-"===e.charAt(0),o="px"===n?s(r):r;return a?-o:o}return console.warn("screenUtils.toPt: input not recognized!"),null}return e}function o(e=0,t=0){return{x:e,y:t}}function l(e=0,t=0){return[e,t]}function c(e=0,t=0){return[e,t]}function u(e=0,t=0,r=0){return[e,t,r]}function d(e){return e}function h(e){return e}function p(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return T})),r.d(t,"f",(function(){return g})),r.d(t,"g",(function(){return v})),r.d(t,"h",(function(){return y})),r.d(t,"i",(function(){return a})),r.d(t,"j",(function(){return p})),r.d(t,"k",(function(){return x})),r.d(t,"l",(function(){return f})),r.d(t,"m",(function(){return O})),r.d(t,"n",(function(){return m})),r.d(t,"o",(function(){return j})),r.d(t,"p",(function(){return d})),r.d(t,"q",(function(){return w})),r.d(t,"r",(function(){return s})),r.d(t,"s",(function(){return _}));var i=r(49);function n(e,t){return e[0]=t[0],e[1]=t[1],e}function s(e,t,r){return e[0]=t,e[1]=r,e}function a(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function l(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function c(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function u(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function d(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function h(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function p(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function f(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function b(e){const t=e[0],r=e[1];return t*t+r*r}function m(e,t){return e[0]=-t[0],e[1]=-t[1],e}function g(e,t){const r=t[0],i=t[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e}function y(e,t){return e[0]*t[0]+e[1]*t[1]}function v(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function O(e,t,r,i){const n=t[0],s=t[1];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e}function j(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function _(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function w(e,t,r,i){const n=t[0]-r[0],s=t[1]-r[1],a=Math.sin(i),o=Math.cos(i);return e[0]=n*o-s*a+r[0],e[1]=n*a+s*o+r[1],e}function x(e,t){return e[0]===t[0]&&e[1]===t[1]}const S=f,T=o,C=l,M=c,P=h,A=p,E=b;Object.freeze({__proto__:null,copy:n,set:s,add:a,subtract:o,multiply:l,divide:c,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:u,scaleAndAdd:d,distance:h,squaredDistance:p,length:f,squaredLength:b,negate:m,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:g,dot:y,cross:v,lerp:O,random:function(e,t){t=t||1;const r=2*Object(i.b)()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},transformMat2:j,transformMat2d:_,transformMat3:function(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},transformMat4:function(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},rotate:w,angle:function(e,t){const r=e[0],i=e[1],n=t[0],s=t[1];let a=r*r+i*i;a>0&&(a=1/Math.sqrt(a));let o=n*n+s*s;o>0&&(o=1/Math.sqrt(o));const l=(r*n+i*s)*a*o;return l>1?0:l<-1?Math.PI:Math.acos(l)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:x,equals:function(e,t){const r=e[0],n=e[1],s=t[0],a=t[1];return Math.abs(r-s)<=i.a*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=i.a*Math.max(1,Math.abs(n),Math.abs(a))},len:S,sub:T,mul:C,div:M,dist:P,sqrDist:A,sqrLen:E})},function(e,t,r){"use strict";var i=r(295),n=r(7),s=r(189),a=r(194),o=(r(8),r(13)),l=r(104),c=r(65),u=r(495);class d{constructor(e,t,r){this.properties=e,this.propertyName=t,this.metadata=r,this._observers=null,this._accessed=null,this._handles=null,this.flags=1|(r.nonNullable?8:0)|(r.hasOwnProperty("value")?16:0)|(void 0===r.get?32:0)|(void 0===r.dependsOn?64:0)}destroy(){this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){Object(c.c)(this);const e=this.properties.store,t=this.propertyName,r=this.flags,i=e.get(t);if(4&r)return i;if(1&~r&&e.has(t))return i;this.flags|=4;const n=this.properties.host;let s;64&r?s=Object(c.b)(this,this.metadata.get,n):(Object(c.d)(n,this),s=this.metadata.get.call(n)),e.set(t,s,1);const a=e.get(t);return a===i?this.flags&=-2:this.commit(),this.flags&=-5,a}onObservableAccessed(e){e!==this&&(null===this._accessed&&(this._accessed=[]),this._accessed.includes(e)||this._accessed.push(e))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=32;const e=this._accessed;if(null===e)return;let t=this._handles;null===t&&(t=this._handles=[]);for(let r=0;r<e.length;++r)t.push(e[r].observe(this));e.length=0}observe(e){return null===this._observers&&(this._observers=[]),this._observers.includes(e)||this._observers.push(e),new u.a(this._observers,e)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){2&~this.flags&&(this.flags|=1);const e=this._observers;if(null!==e)for(let t=0;t<e.length;++t)e[t].onInvalidated()}commit(){this.flags&=-2,this.onCommitted()}onCommitted(){if(null===this._observers)return;const e=this._observers.slice();for(let t=0;t<e.length;++t)e[t].onCommitted()}_clearObservationHandles(){const e=this._handles;if(null!==e){for(let t=0;t<e.length;++t)e[t].remove();e.length=0}}}var h=r(150);class p{constructor(){this._values=new Map}clone(e){const t=new p;return this._values.forEach(((r,i)=>{e&&e.has(i)||t.set(i,Object(o.a)(r))})),t}get(e){return this._values.get(e)}originOf(){return 6}keys(){return[...this._values.keys()]}set(e,t){this._values.set(e,t)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}}var f=r(101);function b(e,t,r){return void 0!==e}function m(e,t,r,i){return void 0!==e&&(!(null==r&&8&e.flags)||(i.lifecycle,!1))}function g(e){return e&&"function"==typeof e.destroy}n.a.getLogger("esri.core.accessorSupport.Properties");const y=new l.a(class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});var v=class{constructor(e){this.host=e,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=0,this.store=new p,this._origin=6;const t=this.host.constructor.__accessorMetadata__,r=t.properties;for(const i in r){const e=new d(this,i,r[i]);this.properties.set(i,e)}this.metadatas=r,this._autoDestroy=t.autoDestroy}initialize(){this.lifecycle=1}constructed(){this.lifecycle=2}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[e,t]of this.properties){const r=this.internalGet(e);r&&g(r)&&(r.destroy(),8&~t.flags&&this._internalSet(t,null)),t.destroy()}else for(const[e,t]of this.properties)t.destroy()}get initialized(){return 0!==this.lifecycle}get(e){const t=this.properties.get(e);if(t.metadata.get)return t.getComputed();Object(c.c)(t);const r=this.store;return r.has(e)?r.get(e):t.metadata.value}originOf(e){const t=this.store.originOf(e);if(void 0===t){const t=this.properties.get(e);if(void 0!==t&&16&t.flags)return"defaults"}return Object(h.b)(t)}has(e){return!!this.properties.has(e)&&this.store.has(e)}keys(){return[...this.properties.keys()]}internalGet(e){const t=this.properties.get(e);if(b(t))return this.store.has(e)?this.store.get(e):t.metadata.value}internalSet(e,t){const r=this.properties.get(e);b(r)&&this._internalSet(r,t)}getDependsInfo(e,t,r){const i=this.properties.get(t);if(!b(i))return"";const n=new Set,s=Object(c.b)({onObservableAccessed:e=>n.add(e),onTrackingEnd:()=>{}},(()=>{var t;return null==(t=i.metadata.get)?void 0:t.call(e)}));let a=`${r}${e.declaredClass.split(".").pop()}.${t}: ${s}\n`;if(0===n.size)return a;r+="  ";for(const o of n){if(!(o instanceof d))continue;const e=o.properties.host,t=o.propertyName,i=Object(f.a)(e);a+=i?i.getDependsInfo(e,t,r):`${r}${t}: undefined\n`}return a}setAtOrigin(e,t,r){const i=this.properties.get(e);if(b(i))return this._setAtOrigin(i,t,r)}isOverridden(e){const t=this.properties.get(e);return void 0!==t&&!!(2&t.flags)}clearOverride(e){const t=this.properties.get(e);void 0!==t&&2&t.flags&&(t.flags&=-3,t.notifyChange())}override(e,t){const r=this.properties.get(e);if(!m(r,0,t,this))return;const i=r.metadata.cast;if(i){const e=this._cast(i,t),{valid:r,value:n}=e;if(y.release(e),!r)return;t=n}r.flags|=2,this._internalSet(r,t)}set(e,t){const r=this.properties.get(e);if(!m(r,0,t,this))return;const i=r.metadata.cast;if(i){const e=this._cast(i,t),{valid:r,value:n}=e;if(y.release(e),!r)return;t=n}const n=r.metadata.set;n?n.call(this.host,t):this._internalSet(r,t)}setDefaultOrigin(e){this._origin=Object(h.d)(e)}getDefaultOrigin(){return Object(h.b)(this._origin)}notifyChange(e){const t=this.properties.get(e);void 0!==t&&t.notifyChange()}invalidate(e){const t=this.properties.get(e);void 0!==t&&t.invalidate()}commit(e){const t=this.properties.get(e);void 0!==t&&t.commit()}_internalSet(e,t){const r=0!==this.lifecycle?this._origin:0;this._setAtOrigin(e,t,r)}_setAtOrigin(e,t,r){const i=this.store,n=e.propertyName;i.has(n,r)&&Object(o.b)(t,i.get(n))&&2&~e.flags&&r===i.originOf(n)||(e.invalidate(),i.set(n,t,r),e.commit(),Object(c.a)(this.host,e))}_cast(e,t){const r=y.acquire();return r.valid=!0,r.value=t,e&&(r.value=e.call(this.host,t,r)),r}},O=r(496),j=r(298),_=r(1),w=r(4);function x(e){if(null==e)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return e.constructor&&e.constructor.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}class S{constructor(...e){if(this.constructor===S)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new v(this)}),e.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,e))}static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:t,declaredClass:r,constructor:i}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class s extends n{constructor(...e){super(...e),this.inherited=null,i&&i.apply(this,e)}}Object(a.a)(s.prototype);for(const a in e){const t=e[a];s.prototype[a]="function"==typeof t?function(...e){const r=this.inherited;let i;this.inherited=function(...e){if(n.prototype[a])return n.prototype[a].apply(this,e)};try{i=t.apply(this,e)}catch(s){throw this.inherited=r,s}return this.inherited=r,i}:e[a]}for(const a in t){const e=x(t[a]);Object(_.b)(e)(s.prototype,a)}return Object(w.a)(r)(s)}postscript(e){const t=this.__accessor__,r=t.ctorArgs||e;t.initialize(),r&&(this.set(r),t.ctorArgs=null),t.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(Object(j.c)(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&2===this.__accessor__.lifecycle||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return Object(s.b)(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}isInstanceOf(e){return Object(i.b)(n.a.getLogger(this.declaredClass),"isInstanceOf",{replacement:"Use instanceof directly",version:"4.16"}),this instanceof e}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,t){return Object(O.a)(this,e,t),this}watch(e,t,r){return Object(j.d)(this,e,t,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_override(e,t){return this.__accessor__.override(e,t)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,t){return this.__accessor__.internalSet(e,t),this}}t.a=S},function(e,t,r){"use strict";function i(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function s(e,t,r,i,n,s,a,o,l,c,u,d,h,p,f,b){return[e,t,r,i,n,s,a,o,l,c,u,d,h,p,f,b]}function a(e,t){return new Float64Array(e,t,16)}r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return i})),r.d(t,"e",(function(){return s}));const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze({__proto__:null,create:i,clone:n,fromValues:s,createView:a,IDENTITY:o})},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return O})),r.d(t,"c",(function(){return N})),r.d(t,"d",(function(){return q})),r.d(t,"e",(function(){return L})),r.d(t,"f",(function(){return m})),r.d(t,"g",(function(){return g})),r.d(t,"h",(function(){return y})),r.d(t,"i",(function(){return v})),r.d(t,"j",(function(){return M})),r.d(t,"k",(function(){return R})),r.d(t,"l",(function(){return x})),r.d(t,"m",(function(){return p})),r.d(t,"n",(function(){return j})),r.d(t,"o",(function(){return U})),r.d(t,"p",(function(){return H})),r.d(t,"q",(function(){return k})),r.d(t,"r",(function(){return P})),r.d(t,"s",(function(){return I})),r.d(t,"t",(function(){return S})),r.d(t,"u",(function(){return f})),r.d(t,"v",(function(){return _})),r.d(t,"w",(function(){return B})),r.d(t,"x",(function(){return W})),r.d(t,"y",(function(){return z})),r.d(t,"z",(function(){return A})),r.d(t,"A",(function(){return D})),r.d(t,"B",(function(){return T})),r.d(t,"C",(function(){return b})),r.d(t,"D",(function(){return w})),r.d(t,"E",(function(){return G})),r.d(t,"F",(function(){return $})),r.d(t,"G",(function(){return V})),r.d(t,"H",(function(){return E})),r.d(t,"I",(function(){return F})),r.d(t,"J",(function(){return C}));class i{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=9;const s=this.TypedArrayConstructor;void 0===i&&(i=9*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let i=0;i<9;i++)t[i]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let i=0;i<9;i++)this.typedBuffer[r++]=t[i]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,a=r*t.typedBufferStride;for(let o=0;o<9;++o)i[s++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}i.ElementCount=9;class n{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=16;const s=this.TypedArrayConstructor;void 0===i&&(i=16*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let i=0;i<16;i++)t[i]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let i=0;i<16;i++)this.typedBuffer[r++]=t[i]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,a=r*t.typedBufferStride;for(let o=0;o<16;++o)i[s++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=16;class s{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=1;const s=this.TypedArrayConstructor;void 0===i&&(i=s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}s.ElementCount=1;var a=r(18);class o{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=2;const s=this.TypedArrayConstructor;void 0===i&&(i=2*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(a.r)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,a=r*t.typedBufferStride;i[s++]=n[a++],i[s]=n[a]}get buffer(){return this.typedBuffer.buffer}}o.ElementCount=2;var l=r(3);class c{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=3;const s=this.TypedArrayConstructor;void 0===i&&(i=3*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(l.y)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,a=r*t.typedBufferStride;i[s++]=n[a++],i[s++]=n[a++],i[s]=n[a]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=3;var u=r(40);class d{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=4;const s=this.TypedArrayConstructor;void 0===i&&(i=4*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(u.l)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=n}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,a=r*t.typedBufferStride;i[s++]=n[a++],i[s++]=n[a++],i[s++]=n[a++],i[s]=n[a]}get buffer(){return this.typedBuffer.buffer}}d.ElementCount=4;class h extends s{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static fromTypedArray(e,t){return new h(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}h.ElementType="f32";class p extends o{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends c{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class b extends d{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f32";class m extends i{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f32";class g extends i{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f64";class y extends n{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f32";class v extends n{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f64";class O extends s{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="f64";class j extends o{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="f64";class _ extends c{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f64";class w extends d{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="f64";class x extends s{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="u8";class S extends o{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="u8";class T extends c{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="u8";class C extends d{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u8";class M extends s{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u16";class P extends o{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u16";class A extends c{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u16";class E extends d{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u16";class R extends s{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u32";class I extends o{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u32";class D extends c{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class F extends d{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="u32";class L extends s{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="i8";class k extends o{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i8";class z extends c{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i8";class V extends d{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i8";class N extends s{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="i16";class U extends o{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i16";class B extends c{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i16";class G extends d{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i16";class q extends s{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(q,e,t)}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32";class H extends o{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i32";class W extends c{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32";class $ extends d{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer($,e,t)}static fromTypedArray(e,t){return new $(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}$.ElementType="i32"},function(e,t,r){"use strict";r.d(t,"a",(function(){return z})),r.d(t,"b",(function(){return k})),r.d(t,"c",(function(){return V})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return j})),r.d(t,"h",(function(){return s})),r.d(t,"i",(function(){return b})),r.d(t,"j",(function(){return g})),r.d(t,"k",(function(){return A})),r.d(t,"l",(function(){return F})),r.d(t,"m",(function(){return o})),r.d(t,"n",(function(){return u})),r.d(t,"o",(function(){return h})),r.d(t,"p",(function(){return d})),r.d(t,"q",(function(){return l})),r.d(t,"r",(function(){return c})),r.d(t,"s",(function(){return R})),r.d(t,"t",(function(){return a})),r.d(t,"u",(function(){return m})),r.d(t,"v",(function(){return w})),r.d(t,"w",(function(){return x})),r.d(t,"x",(function(){return D})),r.d(t,"y",(function(){return O})),r.d(t,"z",(function(){return S})),r.d(t,"A",(function(){return T})),r.d(t,"B",(function(){return P})),r.d(t,"C",(function(){return M})),r.d(t,"D",(function(){return C})),r.d(t,"E",(function(){return v})),r.d(t,"F",(function(){return E})),r.d(t,"G",(function(){return f})),r.d(t,"H",(function(){return L}));var i=r(2),n=(r(50),r(28));function s(e=V){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,r,i,n,a,o=s()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=n,o[5]=a,o}function o(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function l(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function c(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function u(e,t,r=0,i=t.length/3){let n=e[0],s=e[1],a=e[2],o=e[3],l=e[4],c=e[5];for(let u=0;u<i;u++)n=Math.min(n,t[r+3*u]),s=Math.min(s,t[r+3*u+1]),a=Math.min(a,t[r+3*u+2]),o=Math.max(o,t[r+3*u]),l=Math.max(l,t[r+3*u+1]),c=Math.max(c,t[r+3*u+2]);e[0]=n,e[1]=s,e[2]=a,e[3]=o,e[4]=l,e[5]=c}function d(e,t,r,i){e[0]=Math.min(e[0],e[0]+t),e[3]=Math.max(e[3],e[3]+t),e[1]=Math.min(e[1],e[1]+r),e[4]=Math.max(e[4],e[4]+r),e[2]=Math.min(e[2],e[2]+i),e[5]=Math.max(e[5],e[5]+i)}function h(e,t,r){const i=t.length;let n=e[0],s=e[1],a=e[2],o=e[3],l=e[4],c=e[5];if(r)for(let u=0;u<i;u++){const e=t[u];n=Math.min(n,e[0]),s=Math.min(s,e[1]),a=Math.min(a,e[2]),o=Math.max(o,e[0]),l=Math.max(l,e[1]),c=Math.max(c,e[2])}else for(let u=0;u<i;u++){const e=t[u];n=Math.min(n,e[0]),s=Math.min(s,e[1]),o=Math.max(o,e[0]),l=Math.max(l,e[1])}e[0]=n,e[1]=s,e[2]=a,e[3]=o,e[4]=l,e[5]=c}function p(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function f(e){return e[0]>=e[3]?0:e[3]-e[0]}function b(e){return e[1]>=e[4]?0:e[4]-e[1]}function m(e){return e[2]>=e[5]?0:e[5]-e[2]}function g(e){const t=f(e),r=m(e),i=b(e);return Math.sqrt(t*t+r*r+i*i)}function y(e,t=[0,0,0]){return t[0]=e[0]+f(e)/2,t[1]=e[1]+b(e)/2,t[2]=e[2]+m(e)/2,t}function v(e,t=[0,0,0]){return t[0]=f(e),t[1]=b(e),t[2]=m(e),t}function O(e){return Math.max(f(e),m(e),b(e))}function j(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function _(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function w(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function x(e,t){return!!Object(i.i)(t)||w(e,t)}function S(e,t,r,i,n=e){return n[0]=e[0]+t,n[1]=e[1]+r,n[2]=e[2]+i,n[3]=e[3]+t,n[4]=e[4]+r,n[5]=e[5]+i,n}function T(e,t,r=e){const i=e[0]+f(e)/2,n=e[1]+b(e)/2,s=e[2]+m(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=n+(e[1]-n)*t,r[2]=s+(e[2]-s)*t,r[3]=i+(e[3]-i)*t,r[4]=n+(e[4]-n)*t,r[5]=s+(e[5]-s)*t,r}function C(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function M(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function P(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function A(e){return e?P(e,z):s(z)}function E(e,t){return t||(t=Object(n.k)()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function R(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function I(e){return 6===e.length}function D(e){return 0===f(e)&&0===b(e)&&0===m(e)}function F(e,t,r){if(Object(i.i)(e)||Object(i.i)(t))return e===t;if(!I(e)||!I(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function L(e,t,r,i,n,s){return a(e,t,r,i,n,s,N)}const k=[-1/0,-1/0,-1/0,1/0,1/0,1/0],z=[1/0,1/0,1/0,-1/0,-1/0,-1/0],V=[0,0,0,0,0,0],N=s()},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return _})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return b})),r.d(t,"g",(function(){return O})),r.d(t,"h",(function(){return j})),r.d(t,"i",(function(){return g})),r.d(t,"j",(function(){return m})),r.d(t,"k",(function(){return y})),r.d(t,"l",(function(){return v})),r.d(t,"m",(function(){return a}));var i=r(155),n=(r(13),r(12));function s(e,t,r,i,n){const s=e.watch(t,((t,n,s,a)=>{r&&!r(t)||null==i||i.call(e,t,n,s,a)}),n);if(Array.isArray(t))for(const a of t){const n=e.get(a);r&&r(n)&&(null==i||i.call(e,n,n,t,e))}else{const n=e.get(t);r&&r(n)&&(null==i||i.call(e,n,n,t,e))}return s}function a(e,t,r,i,a){const o="function"==typeof i?i:null,l="object"==typeof i?i:null;"boolean"==typeof i&&(a=i);let c,u=!1;function d(){c&&(c.remove(),c=null)}const h=Object(n.g)();Object(n.s)(l,(()=>{d(),h.reject(Object(n.f)())}));const p={then:h.promise.then.bind(h.promise),catch:h.promise.catch.bind(h.promise),remove:d};return Object.freeze(p),c=s(e,t,r,((t,r,i,n)=>{u=!0,d(),o&&o.call(e,t,r,i,n),h.resolve({value:t,oldValue:r,propertyName:i,target:n})}),a),u&&d(),p}function o(e){return!!e}function l(e){return!e}function c(e){return!0===e}function u(e){return!1===e}const d=/\?(\.|$)/g;function h(e,t,r,i){const n=Array.isArray(t)?t:t.indexOf(",")>-1?t.split(","):[t],s=p(e,t,r,i);for(const a of n){const t=a.trim().replace(d,"$1"),i=e.get(t);r.call(e,i,i,t,e)}return s}function p(e,t,r,i){return e.watch(t,r,i)}function f(e,t,r,i){return a(e,t,null,r,i)}function b(e,t,r,i){return s(e,t,o,r,i)}function m(e,t,r,i){return a(e,t,o,r,i)}function g(e,t,r,i){return a(e,t,l,r,i)}function y(e,t,r,i){return s(e,t,c,r,i)}function v(e,t,r,i){return a(e,t,c,r,i)}function O(e,t,r,i){return s(e,t,u,r,i)}function j(e,t,r,i){return a(e,t,u,r,i)}function _(e,t,r,i){let n=!1;const s=e.watch(t,((t,i,s,a)=>{n||r.call(e,t,i,s,a)}),i);return{remove(){s.remove()},pause(){n=!0},resume(){n=!1}}}function w(e,t,r,n,s,a,o){const l={};function c(t){const i=l[t];i&&(a&&a(i.target,t,e,r),i.handle.remove(),delete l[t])}const u=h(e,t,((t,a,o)=>{c(o),Object(i.b)(t)&&(l[o]={handle:Object(i.c)(t,r,n),target:t},s&&s(t,o,e,r))}),o);return{remove(){u.remove();for(const e in l)c(e)}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(401),n=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},s=function(e,t){for(var r=0,i=e.length;r<i;r++){var a=e[r];Array.isArray(a)?s(a,t):null!=a&&!1!==a&&(a.hasOwnProperty("vnodeSelector")||(a=n(a)),t.push(a))}},a=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(1===r.length&&"string"==typeof r[0])return{vnodeSelector:e,properties:t||void 0,children:void 0,text:r[0],domNode:null};var n=[];return s(r,n),{vnodeSelector:e,properties:t||void 0,children:n,text:void 0,domNode:null}};function o(e,t,...r){return"function"!=typeof e||Object(i.b)(e)?a(e,t,...r):e(t,...r)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return C})),r.d(t,"c",(function(){return E})),r.d(t,"d",(function(){return ue})),r.d(t,"e",(function(){return de})),r.d(t,"f",(function(){return j})),r.d(t,"g",(function(){return v})),r.d(t,"h",(function(){return ae})),r.d(t,"i",(function(){return Z})),r.d(t,"j",(function(){return $})),r.d(t,"k",(function(){return ne})),r.d(t,"l",(function(){return F})),r.d(t,"m",(function(){return G})),r.d(t,"n",(function(){return he})),r.d(t,"o",(function(){return R})),r.d(t,"p",(function(){return T})),r.d(t,"q",(function(){return L})),r.d(t,"r",(function(){return I})),r.d(t,"s",(function(){return q})),r.d(t,"t",(function(){return H})),r.d(t,"u",(function(){return W})),r.d(t,"v",(function(){return K})),r.d(t,"w",(function(){return J})),r.d(t,"x",(function(){return le})),r.d(t,"y",(function(){return k})),r.d(t,"z",(function(){return B})),r.d(t,"A",(function(){return V})),r.d(t,"B",(function(){return X})),r.d(t,"C",(function(){return N})),r.d(t,"D",(function(){return U})),r.d(t,"E",(function(){return S})),r.d(t,"F",(function(){return w})),r.d(t,"G",(function(){return ie})),r.d(t,"H",(function(){return ce})),r.d(t,"I",(function(){return se})),r.d(t,"J",(function(){return ee})),r.d(t,"K",(function(){return _}));var i=r(114),n=r(11),s=(r(56),r(7)),a=r(2);const o=s.a.getLogger("esri.core.urlUtils"),l=i.a.request,c="esri/config: esriConfig.request.proxyUrl is not set.",u=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,d=/^\s*http:/i,h=/^\s*https:/i,p=/^\s*file:/i,f=/:\d+$/,b=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,m=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),g=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class y{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let t=Object(a.d)(this.uri.match(m));this.scheme=t[2]||(t[1]?"":null),this.authority=t[4]||(t[3]?"":null),this.path=t[5],this.query=t[7]||(t[6]?"":null),this.fragment=t[9]||(t[8]?"":null),null!=this.authority&&(t=Object(a.d)(this.authority.match(g)),this.user=t[3]||null,this.password=t[4]||null,this.host=t[6]||t[7],this.port=t[9]||null)}toString(){return this.uri}}const v=new y(i.a.applicationUrl),O={},j=(()=>{const e=Object(a.d)(v.path),t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${v.scheme}://${v.host}${null!=v.port?`:${v.port}`:""}${t}`})();function _(e){const t={path:null,query:null},r=new y(e),i=e.indexOf("?");return null===r.query?t.path=e:(t.path=e.substring(0,i),t.query=w(r.query)),r.fragment&&(t.hash=r.fragment,null===r.query&&(t.path=t.path.substring(0,t.path.length-(r.fragment.length+1)))),t}function w(e){const t=e.split("&"),r={};for(const i of t){if(!i)continue;const e=i.indexOf("=");let t,n;e<0?(t=decodeURIComponent(i),n=""):(t=decodeURIComponent(i.slice(0,e)),n=decodeURIComponent(i.slice(e+1)));let s=r[t];"string"==typeof s&&(s=r[t]=[s]),Array.isArray(s)?s.push(n):r[t]=n}return r}function x(e){return e&&"object"==typeof e&&"toJSON"in e&&"function"==typeof e.toJSON}function S(e,t){return e?t&&"function"==typeof t?Object.keys(e).map((r=>encodeURIComponent(r)+"="+encodeURIComponent(t(r,e[r])))).join("&"):Object.keys(e).map((r=>{const i=e[r];if(null==i)return"";const n=encodeURIComponent(r)+"=",s=t&&t[r];return s?n+encodeURIComponent(s(i)):Array.isArray(i)?i.map((e=>x(e)?n+encodeURIComponent(JSON.stringify(e)):n+encodeURIComponent(e))).join("&"):x(i)?n+encodeURIComponent(JSON.stringify(i)):n+encodeURIComponent(i)})).filter((e=>e)).join("&"):""}function T(e=!1){let t,r=l.proxyUrl;if("string"==typeof e){t=K(e);const i=R(e);i&&(r=i.proxyUrl)}else t=!!e;if(!r)throw o.warn(c),new n.a("urlutils:proxy-not-set",c);return t&&te()&&(r=ee(r)),_(r)}function C(e){const t=R(e);let r,i;if(t){const e=P(t.proxyUrl);r=e.path,i=e.query?w(e.query):null}if(r){const t=_(e);e=r+"?"+t.path;const n=S({...i,...t.query});n&&(e=`${e}?${n}`)}return e}const M={path:"",query:""};function P(e){const t=e.indexOf("?");return-1!==t?(M.path=e.slice(0,t),M.query=e.slice(t+1)):(M.path=e,M.query=null),M}function A(e){return(e=re(e=function(e){return e&&"/"===e[e.length-1]?e:`${e}/`}(e=P(e).path),!0)).toLowerCase()}function E(e){const t={proxyUrl:e.proxyUrl,urlPrefix:A(e.urlPrefix)},r=l.proxyRules,i=t.urlPrefix;let n=r.length;for(let s=0;s<r.length;s++){const e=r[s].urlPrefix;if(0===i.indexOf(e)){if(i.length===e.length)return-1;n=s;break}0===e.indexOf(i)&&(n=s+1)}return r.splice(n,0,t),n}function R(e){const t=l.proxyRules,r=A(e);for(let i=0;i<t.length;i++)if(0===r.indexOf(t[i].urlPrefix))return t[i]}function I(e,t){return e=D(e),t=D(t),re(e)===re(t)}function D(e){const t=(e=U(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function F(e){const t=t=>null==t||t instanceof RegExp&&t.test(e)||"string"==typeof t&&e.startsWith(t),r=l.interceptors;if(r)for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(t))return i}else if(t(i.urls))return i;return null}function L(e,t,r=!1){const i=oe(e),n=oe(t);return!(!r&&i.scheme!==n.scheme)&&null!=i.host&&null!=n.host&&i.host.toLowerCase()===n.host.toLowerCase()&&i.port===n.port}function k(e){if("string"==typeof e){if(!q(e))return!0;e=oe(e)}if(L(e,v))return!0;const t=l.trustedServers||[];for(let r=0;r<t.length;r++){const i=z(t[r]);for(let t=0;t<i.length;t++)if(L(e,i[t]))return!0}return!1}function z(e){return O[e]||(Y(e)||J(e)?O[e]=[new y(V(e))]:O[e]=[new y(`http://${e}`),new y(`https://${e}`)]),O[e]}function V(e,t=j,r){return J(e)?r&&r.preserveProtocolRelative?e:"http"===v.scheme&&v.authority===G(e).slice(2)?`http:${e}`:`https:${e}`:Y(e)?e:Object(a.d)(B("/"===e[0]?function(e){const t=e.indexOf("//"),r=e.indexOf("/",t+2);return-1===r?e:e.slice(0,r)}(t):t,e))}function N(e,t=j,r){if(!q(e))return e;const i=U(e),n=i.toLowerCase(),s=U(t).toLowerCase().replace(/\/+$/,""),a=r?U(r).toLowerCase().replace(/\/+$/,""):null;if(a&&0!==s.indexOf(a))return e;const o=(e,t,r)=>-1===(r=e.indexOf(t,r))?e.length:r;let l=o(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=o(n,"/",l+1);if(-1===c)return e;if(a&&c<a.length)return e;e=i.slice(c);const u=s.slice(c-1).replace(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)e=`../${e}`;else e=`./${e}`;return e}function U(e){return function(e){const t=l.httpsDomains;if(!function(e){return d.test(e)||"http"===v.scheme&&J(e)}(e))return e;const r=e.indexOf("/",7);let i;if(i=-1===r?e:e.slice(0,r),i=i.toLowerCase().slice(7),f.test(i)){if(!i.endsWith(":80"))return e;i=i.slice(0,-3),e=e.replace(":80","")}return"http"===v.scheme&&i===v.authority&&!b.test(e)||(te()&&i===v.authority||t&&t.some((e=>i===e||i.endsWith(`.${e}`)))||te()&&!R(e))&&(e=ee(e)),e}(e=function(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(e=function(e){if(/^https?:\/\//i.test(e)){const t=P(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}(e=V(e=e.trim()))))}function B(...e){const t=e.filter(a.j);if(!t||!t.length)return;const r=[];if(q(t[0])){const e=t[0],i=e.indexOf("//");-1!==i&&(r.push(e.slice(0,i+1)),function(e){return p.test(e)}(t[0])&&(r[0]+="/"),t[0]=e.slice(i+2))}else"/"===t[0][0]&&r.push("");const i=t.reduce(((e,t)=>t?e.concat(t.split("/")):e),[]);for(let n=0;n<i.length;n++){const e=i[n];".."===e&&r.length>0&&".."!==r[r.length-1]?r.pop():(!e&&n===i.length-1||e&&("."!==e||0===r.length))&&r.push(e)}return r.join("/")}function G(e,t=!1){if(H(e)||W(e))return null;let r=e.indexOf("://");if(-1===r&&J(e))r=2;else{if(-1===r)return null;r+=3}const i=e.indexOf("/",r);return-1!==i&&(e=e.slice(0,i)),t&&(e=re(e,!0)),e}function q(e){return J(e)||Y(e)}function H(e){return null!=e&&"blob:"===e.slice(0,5)}function W(e){return"data:"===e.slice(0,5)}function $(e){const t=Z(e);if(!t||!t.isBase64)return null;const r=atob(t.data),i=new Uint8Array(r.length);for(let n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i.buffer}const Q=/^data:(.*?)(;base64)?,(.*)$/;function Z(e){const t=e.match(Q);if(!t)return null;const[,r,i,n]=t;return{mediaType:r,isBase64:!!i,data:n}}function X(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function J(e){return null!=e&&void 0!==e&&"/"===e[0]&&"/"===e[1]}function Y(e){return u.test(e)}function K(e){return h.test(e)||"https"===v.scheme&&J(e)}function ee(e){return J(e)?`https:${e}`:e.replace(d,"https:")}function te(){return"https"===v.scheme}function re(e,t=!1){return J(e)?e.slice(2):(e=e.replace(u,""),t&&e.length>1&&"/"===e[0]&&"/"===e[1]&&(e=e.slice(2)),e)}function ie(e){let t=0;if(q(e)){const r=e.indexOf("//");-1!==r&&(t=r+2)}const r=e.lastIndexOf("/");return r<t?e:e.slice(0,r+1)}function ne(e,t){if(!e)return"";const r=_(e).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(null==t||!t.length)return i;const n=new RegExp(`.(${t.join("|")})$`,"ig");return i.replace(n,"")}function se(e){return e.replace(/\/+$/,"")}function ae(e,t,r){if(!(t&&r&&e&&q(e)))return e;const i=e.indexOf("//"),n=e.indexOf("/",i+2),s=e.indexOf(":",i+2),a=Math.min(n<0?e.length:n,s<0?e.length:s);return e.slice(i+2,a).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,i+2)}${r}${e.slice(a)}`}function oe(e){return"string"==typeof e?new y(V(e)):(e.scheme||(e.scheme=v.scheme),e)}function le(e){return fe.test(e)}function ce(e,t){const r=_(e),i=Object.keys(r.query||{});return i.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function ue(e,t,r){const i=_(e),n=i.query||{};return n[t]=String(r),`${i.path}?${S(n)}`}function de(e,t){const r=_(e),i=r.query||{};for(const s in t)i[s]=t[s];const n=S(i);return n?`${r.path}?${n}`:r.path}function he(e){if(Object(a.i)(e))return null;const t=e.match(pe);return t?t[1]:null}const pe=/.*?\.([^\/]*)$/,fe=/(^data:image\/svg|\.svg$)/i},function(e,t,r){"use strict";r.d(t,"a",(function(){return I})),r.d(t,"b",(function(){return D})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return p})),r.d(t,"g",(function(){return b})),r.d(t,"h",(function(){return f})),r.d(t,"i",(function(){return h})),r.d(t,"j",(function(){return S})),r.d(t,"k",(function(){return C})),r.d(t,"l",(function(){return M})),r.d(t,"m",(function(){return T})),r.d(t,"n",(function(){return R})),r.d(t,"o",(function(){return A})),r.d(t,"p",(function(){return E})),r.d(t,"q",(function(){return P})),r.d(t,"r",(function(){return x})),r.d(t,"s",(function(){return V})),r.d(t,"t",(function(){return F})),r.d(t,"u",(function(){return L})),r.d(t,"v",(function(){return w})),r.d(t,"w",(function(){return k})),r.d(t,"x",(function(){return u}));var i=r(10),n=r(2),s=r(3),a=r(5),o=r(55),l=r(34);function c(e=N){return[e[0],e[1],e[2],e[3]]}function u(e,t,r,i){return h(e,t,r,i,l.d.get())}function d(e,t=c()){return h(e[0],e[1],e[2],e[3],t)}function h(e,t,r,i,n=c()){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function p(e,t,r){return Object(s.m)(r,e),r[3]=t,r}function f(e,t,r){Object(s.m)(r,t);const i=Object(s.j)(t,t);return Math.abs(i-1)>1e-5&&i>1e-12&&Object(s.g)(r,r,1/Math.sqrt(i)),w(r,e,r)}function b(e,t,r,i=c()){return S(Object(s.l)(l.c.get(),e,t),Object(s.l)(l.c.get(),r,t),e,i)}function m(e,t,r,i,n){if(e.count<3)return!1;e.getVec(r,y);let a=i,o=!1;for(;a<e.count-1&&!o;)e.getVec(a,v),a++,o=!Object(s.q)(y,v);if(!o)return!1;for(a=Math.max(a,n),o=!1;a<e.count&&!o;)e.getVec(a,O),a++,Object(s.l)(j,y,v),Object(s.t)(j,j),Object(s.l)(_,v,O),Object(s.t)(_,_),o=!Object(s.q)(y,O)&&!Object(s.q)(v,O)&&Math.abs(Object(s.j)(j,_))<g;return o?(b(y,v,O,t),!0):(0!==r||1!==i||2!==n)&&m(e,t,0,1,2)}const g=.99619469809,y=Object(a.e)(),v=Object(a.e)(),O=Object(a.e)(),j=Object(a.e)(),_=Object(a.e)();function w(e,t,r){return e!==r&&d(e,r),r[3]=-Object(s.j)(r,t),r}function x(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function S(e,t,r,i){return f(r,Object(s.i)(O,t,e),i)}function T(e,t,r){return!!Object(n.j)(t)&&z(e,t.origin,t.direction,U,r)}function C(e,t,r){return z(e,t.origin,t.vector,0,r)}function M(e,t,r){return z(e,t.origin,t.vector,1,r)}function P(e,t){return k(e,Object(o.g)(t))-t[3]>=0}function A(e,t){return k(e,t)>=0}function E(e,t){return k(e,t)<0}function R(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5];return e[0]*(e[0]>0?r:s)+e[1]*(e[1]>0?i:a)+e[2]*(e[2]>0?n:o)+e[3]>=0}function I(e,t){const r=Object(s.j)(e,t.ray.direction),i=-k(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function D(e,t){const r=Object(s.j)(e,t.ray.direction),i=-k(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function F(e,t,r){const i=Object(s.g)(l.c.get(),e,-e[3]),n=L(e,Object(s.l)(l.c.get(),t,i),l.c.get());return Object(s.h)(r,n,i),r}function L(e,t,r){const i=Object(s.g)(l.c.get(),e,Object(s.j)(e,t));return Object(s.l)(r,t,i),r}function k(e,t){return Object(s.j)(e,t)+e[3]}function z(e,t,r,n,a){const o=Object(s.j)(e,r);if(0===o)return!1;let l=-(Object(s.j)(e,t)+e[3])/o;return 1&n&&(l=Object(i.e)(l,0,1)),!(!(4&n)&&l<0||!(8&n)&&l>1)&&(Object(s.h)(a,t,Object(s.g)(a,r,l)),!0)}function V(e){return e}const N=[0,0,1,0],U=8},function(e,t,r){"use strict";function i(){return[0,0]}function n(e){return[e[0],e[1]]}function s(e,t){return[e,t]}function a(e){const t=[0,0],r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function o(e,t){return new Float64Array(e,t,2)}function l(){return[0,0]}function c(){return s(1,1)}function u(){return s(1,0)}function d(){return s(0,1)}r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return a})),r.d(t,"f",(function(){return s}));const h=[0,0],p=c(),f=u(),b=d();Object.freeze({__proto__:null,create:i,clone:n,fromValues:s,fromArray:a,createView:o,zeros:l,ones:c,unitX:u,unitY:d,ZEROS:h,ONES:p,UNIT_X:f,UNIT_Y:b})},function(e,t,r){"use strict";r.d(t,"a",(function(){return D})),r.d(t,"b",(function(){return I})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return g})),r.d(t,"f",(function(){return a})),r.d(t,"g",(function(){return w})),r.d(t,"h",(function(){return y})),r.d(t,"i",(function(){return v})),r.d(t,"j",(function(){return j})),r.d(t,"k",(function(){return s})),r.d(t,"l",(function(){return S})),r.d(t,"m",(function(){return M})),r.d(t,"n",(function(){return E})),r.d(t,"o",(function(){return d})),r.d(t,"p",(function(){return u})),r.d(t,"q",(function(){return h})),r.d(t,"r",(function(){return l})),r.d(t,"s",(function(){return o})),r.d(t,"t",(function(){return b})),r.d(t,"u",(function(){return x})),r.d(t,"v",(function(){return _})),r.d(t,"w",(function(){return A})),r.d(t,"x",(function(){return T})),r.d(t,"y",(function(){return C})),r.d(t,"z",(function(){return c})),r.d(t,"A",(function(){return f}));r(8);var i=r(2),n=r(50);function s(e=F){return[e[0],e[1],e[2],e[3]]}function a(e){return[e[0],e[1],e[2],e[3]]}function o(e,t,r,i,n=s()){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function l(e,t=s()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function c(e,t){return new n.a({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function u(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function d(e,t,r=e){if("length"in t)P(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3])):2!==t.length&&3!==t.length||(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[0]),r[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":r[0]=Math.min(e[0],t.xmin),r[1]=Math.min(e[1],t.ymin),r[2]=Math.max(e[2],t.xmax),r[3]=Math.max(e[3],t.ymax);break;case"point":r[0]=Math.min(e[0],t.x),r[1]=Math.min(e[1],t.y),r[2]=Math.max(e[2],t.x),r[3]=Math.max(e[3],t.y)}return r}function h(e,t,r=e){const i=t.length;let n=e[0],s=e[1],a=e[2],o=e[3];for(let l=0;l<i;l++){const e=t[l];n=Math.min(n,e[0]),s=Math.min(s,e[1]),a=Math.max(a,e[0]),o=Math.max(o,e[1])}return r[0]=n,r[1]=s,r[2]=a,r[3]=o,r}function p(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function f(e){return e[0]>=e[2]?0:e[2]-e[0]}function b(e){return e[1]>=e[3]?0:e[3]-e[1]}function m(e){return f(e)*b(e)}function g(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function y(e,t){return O(e,t[0],t[1])}function v(e,t){return O(e,t.x,t.y)}function O(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function j(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r}function _(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function w(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function x(e,t,r=e){const i=t[0],n=t[1],s=t[2],a=t[3];return r[0]=R(e[0],i,s),r[1]=R(e[1],n,a),r[2]=R(e[2],i,s),r[3]=R(e[3],n,a),r}function S(e,t){const r=(e[0]+e[2])/2,i=(e[1]+e[3])/2,n=Math.max(Math.abs(t[0]-r)-f(e)/2,0),s=Math.max(Math.abs(t[1]-i)-b(e)/2,0);return Math.sqrt(n*n+s*s)}function T(e,t,r,i=e){return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+t,i[3]=e[3]+r,i}function C(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function M(e){return e?C(e,D):s(D)}function P(e){return 4===e.length}function A(e){return!(0!==f(e)&&isFinite(e[0])||0!==b(e)&&isFinite(e[1]))}function E(e,t,r){if(Object(i.i)(e)||Object(i.i)(t))return e===t;if(!P(e)||!P(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function R(e,t,r){return e<t?t:e>r?r:e}const I=[-1/0,-1/0,1/0,1/0],D=[1/0,1/0,-1/0,-1/0],F=[0,0,0,0]},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(99),n=r(1);function s(e,t,r){let s,a;return void 0===t?(a=e,s=[void 0]):"string"!=typeof t?(a=e,s=[void 0],r=t):(a=t,s=Array.isArray(e)?e:[e]),(e,t)=>{const o=e.constructor.prototype;s.forEach((s=>{const l=Object(n.c)(e,s,a);l.write&&"object"!=typeof l.write&&(l.write={}),r&&Object(i.c)("write.target",r,l),Object(i.c)("write.writer",o[t],l)}))}}},function(e,t,r){"use strict";function i(e,t,r=32774,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function n(e,t,r,i,n=32774,s=32774,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}r.d(t,"a",(function(){return z})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return a})),r.d(t,"g",(function(){return y})),r.d(t,"h",(function(){return n})),r.d(t,"i",(function(){return i}));const s={face:1029,mode:2305},a={face:1028,mode:2305},o=e=>2===e?s:1===e?a:null,l={zNear:0,zFar:1},c={r:!0,g:!0,b:!0,a:!0};function u(e){return j.intern(e)}function d(e){return w.intern(e)}function h(e){return S.intern(e)}function p(e){return C.intern(e)}function f(e){return P.intern(e)}function b(e){return E.intern(e)}function m(e){return I.intern(e)}function g(e){return F.intern(e)}function y(e){return k.intern(e)}class v{constructor(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}intern(e){if(!e)return null;const t=this.makeKey(e),r=this.interns;return r.has(t)||r.set(t,this.makeRef(e)),r.get(t)}}function O(e){return"["+e.join(",")+"]"}const j=new v(_,(e=>({__tag:"Blending",...e})));function _(e){return e?O([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const w=new v(x,(e=>({__tag:"Culling",...e})));function x(e){return e?O([e.face,e.mode]):null}const S=new v(T,(e=>({__tag:"PolygonOffset",...e})));function T(e){return e?O([e.factor,e.units]):null}const C=new v(M,(e=>({__tag:"DepthTest",...e})));function M(e){return e?O([e.func]):null}const P=new v(A,(e=>({__tag:"StencilTest",...e})));function A(e){return e?O([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const E=new v(R,(e=>({__tag:"DepthWrite",...e})));function R(e){return e?O([e.zNear,e.zFar]):null}const I=new v(D,(e=>({__tag:"ColorWrite",...e})));function D(e){return e?O([e.r,e.g,e.b,e.a]):null}const F=new v(L,(e=>({__tag:"StencilWrite",...e})));function L(e){return e?O([e.mask]):null}const k=new v((function(e){return e?O([_(e.blending),x(e.culling),T(e.polygonOffset),M(e.depthTest),A(e.stencilTest),R(e.depthWrite),D(e.colorWrite),L(e.stencilWrite)]):null}),(e=>({blending:u(e.blending),culling:d(e.culling),polygonOffset:h(e.polygonOffset),depthTest:p(e.depthTest),stencilTest:f(e.stencilTest),depthWrite:b(e.depthWrite),colorWrite:m(e.colorWrite),stencilWrite:g(e.stencilWrite)})));class z{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this.setBlending(e.blending),this.setCulling(e.culling),this.setPolygonOffset(e.polygonOffset),this.setDepthTest(e.depthTest),this.setStencilTest(e.stencilTest),this.setDepthWrite(e.depthWrite),this.setColorWrite(e.colorWrite),this.setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}setBlending(e){this._blending=this.setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}setCulling(e){this._culling=this.setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}setPolygonOffset(e){this._polygonOffset=this.setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}setDepthTest(e){this._depthTest=this.setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}setStencilTest(e){this._stencilTest=this.setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}setDepthWrite(e){this._depthWrite=this.setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}setColorWrite(e){this._colorWrite=this.setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}setStencilWrite(e){this._stencilWrite=this.setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}setSubState(e,t,r,i){return(r||e!==t)&&(i(e),this._pipelineInvalid=!0),e}}},function(e,t,r){"use strict";function i(){return[0,0,0,0]}function n(e){return[e[0],e[1],e[2],e[3]]}function s(e,t,r,i){return[e,t,r,i]}function a(e){const t=[0,0,0,0],r=Math.min(4,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function o(e,t){return new Float64Array(e,t,4)}function l(){return[0,0,0,0]}function c(){return s(1,1,1,1)}function u(){return s(1,0,0,0)}function d(){return s(0,1,0,0)}function h(){return s(0,0,1,0)}function p(){return s(0,0,0,1)}r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return i})),r.d(t,"f",(function(){return n})),r.d(t,"g",(function(){return s}));const f=[0,0,0,0],b=c(),m=u(),g=d(),y=h(),v=p();Object.freeze({__proto__:null,create:i,clone:n,fromValues:s,fromArray:a,createView:o,zeros:l,ones:c,unitX:u,unitY:d,unitZ:h,unitW:p,ZEROS:f,ONES:b,UNIT_X:m,UNIT_Y:g,UNIT_Z:y,UNIT_W:v})},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(99),n=r(1);function s(e,t,r){let s,a;return void 0===t||Array.isArray(t)?(a=e,r=t,s=[void 0]):(a=t,s=Array.isArray(e)?e:[e]),(e,t)=>{const o=e.constructor.prototype;s.forEach((s=>{const l=Object(n.c)(e,s,a);l.read&&"object"!=typeof l.read&&(l.read={}),Object(i.c)("read.reader",o[t],l),r&&(l.read.source=(l.read.source||[]).concat(r))}))}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return O})),r.d(t,"c",(function(){return j})),r.d(t,"d",(function(){return y})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return M})),r.d(t,"g",(function(){return g})),r.d(t,"h",(function(){return b})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return f})),r.d(t,"k",(function(){return h})),r.d(t,"l",(function(){return p})),r.d(t,"m",(function(){return m})),r.d(t,"n",(function(){return w})),r.d(t,"o",(function(){return d}));var i=r(10),n=(r(16),r(18)),s=r(27),a=(r(5),r(40)),o=r(31);const l=Object(o.e)();class c{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function u(e,t){if(!e){t=t||"assert";const e=new Error(t);throw e.stack&&console.log(e.stack),new c(t)}}function d(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function h(e,t,r,i){let n,s=(r[0]-e[0])/t[0],a=(i[0]-e[0])/t[0];s>a&&(n=s,s=a,a=n);let o=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(o>l&&(n=o,o=l,l=n),s>l||o>a)return!1;o>s&&(s=o),l<a&&(a=l);let c=(r[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>a)&&(u<a&&(a=u),!(a<0))}function p(e,t,r,i,n,a=Object(s.b)()){const o=(i[n]-r[n])*(t[0]-e[0])-(i[0]-r[0])*(t[n]-e[n]),l=(i[0]-r[0])*(e[n]-r[n])-(i[n]-r[n])*(e[0]-r[0]);if(0===o)return!1;const c=l/o;return a[0]=e[0]+c*(t[0]-e[0]),a[1]=e[n]+c*(t[n]-e[n]),!0}function f(e,t,r,i,n){n||(n=e),l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=1,Object(a.m)(l,l,t),n.length>2&&(n[2]=-l[2]),Object(a.m)(l,l,r),u(0!==l[3]),n[0]=l[0]/l[3],n[1]=l[1]/l[3],n[2]=l[2]/l[3],n[0]=(.5*n[0]+.5)*i[2]+i[0],n[1]=(.5*n[1]+.5)*i[3]+i[1]}function b(e,t){return Math.log(e)/Math.log(t)}function m(e,t,r,i){e[12]=t,e[13]=r,e[14]=i}function g(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}function y(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}function v(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}function O(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function j(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function _(e,t,r=0){const n=Object(i.e)(e,0,T);for(let i=0;i<4;i++)t[r+i]=Math.floor(256*C(n*x[i]))}function w(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*S[i];return r}const x=[1,256,65536,16777216],S=[1/256,1/65536,1/16777216,1/4294967296],T=w(new Uint8ClampedArray([255,255,255,255]));function C(e){return e-Math.floor(e)}function M(e,t,r,i,s){const a=e;0===e[11]?(i[0]=2/(t*a[0]),i[1]=2/(r*a[5]),i[2]=(1+a[12])/a[0],i[3]=(1+a[13])/a[5],Object(n.r)(s,0,1)):(i[0]=-2/(t*a[0]),i[1]=-2/(r*a[5]),i[2]=(1-a[8])/a[0],i[3]=(1-a[9])/a[5],Object(n.r)(s,1,0))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return f}));var i=r(2),n=r(299),s=r(83),a=r(20),o=r(185),l=r(27),c=r(5),u=r(31);class d{constructor(e,t,r){this.itemByteSize=e,this.itemCreate=t,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(r/this.itemByteSize),this.tickHandle=n.a.before((()=>this.reset()))}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=Object(i.p)(this.tickHandle)),this.itemsPtr=0,this.items=Object(i.p)(this.items),this.buffers=Object(i.p)(this.buffers)}get(){0===this.itemsPtr&&Object(n.a)((()=>{}));const e=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=e;){const e=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let t=0;t<this.itemsPerBuffer;++t)this.items.push(this.itemCreate(e,t*this.itemByteSize));this.buffers.push(e)}return this.items[this.itemsPtr++]}reset(){const e=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>e;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0}static createVec2f64(e=h){return new d(16,l.d,e)}static createVec3f64(e=h){return new d(24,c.d,e)}static createVec4f64(e=h){return new d(32,u.c,e)}static createMat3f64(e=h){return new d(72,s.a,e)}static createMat4f64(e=h){return new d(128,a.b,e)}static createQuatf64(e=h){return new d(32,o.d,e)}get test(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}}}const h=4096,p=(d.createVec2f64(),d.createVec3f64()),f=d.createVec4f64(),b=(d.createMat3f64(),d.createMat4f64()),m=d.createQuatf64()},function(e,t,r){"use strict";const i={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,5,10]};function n(e){var t;return null!=(t=i[e.toLowerCase()])?t:null}function s(e,t,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?e+(t-e)*i:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}var a=r(10),o=r(2),l=r(9);function c(e){return Object(a.e)(Object(l.e)(e),0,255)}function u(e,t,r){return e=Number(e),isNaN(e)?r:e<t?t:e>r?r:e}class d{constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}static blendColors(e,t,r,i=new d){return i.r=Math.round(e.r+(t.r-e.r)*r),i.g=Math.round(e.g+(t.g-e.g)*r),i.b=Math.round(e.b+(t.b-e.b)*r),i.a=e.a+(t.a-e.a)*r,i._sanitize()}static fromRgb(e,t){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const e=r[2].split(/\s*,\s*/),i=r[1];if("rgb"===i&&3===e.length||"rgba"===i&&4===e.length){const r=e[0];if("%"===r.charAt(r.length-1)){const r=e.map((e=>2.56*parseFloat(e)));return 4===e.length&&(r[3]=parseFloat(e[3])),d.fromArray(r,t)}return d.fromArray(e.map((e=>parseFloat(e))),t)}if("hsl"===i&&3===e.length||"hsla"===i&&4===e.length)return d.fromArray(function(e,t,r,i=1){const n=(e%360+360)%360/360,a=r<=.5?r*(t+1):r+t-r*t,o=2*r-a;return[Math.round(256*s(o,a,n+1/3)),Math.round(256*s(o,a,n)),Math.round(256*s(o,a,n-1/3)),i]}(parseFloat(e[0]),parseFloat(e[1])/100,parseFloat(e[2])/100,parseFloat(e[3])),t)}return null}static fromHex(e,t=new d){if(4!==e.length&&7!==e.length||"#"!==e[0])return null;const r=4===e.length?4:8,i=(1<<r)-1;let n=Number("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach((e=>{const s=n&i;n>>=r,t[e]=4===r?17*s:s})),t.a=1,t)}static fromArray(e,t=new d){return t._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(t.a)&&(t.a=1),t._sanitize()}static fromString(e,t){const r=n(e);return r&&d.fromArray(r,t)||d.fromRgb(e,t)||d.fromHex(e,t)}static fromJSON(e){return e&&new d([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return Object(o.j)(e)?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return Object(o.j)(e)?[e.r/255,e.g/255,e.b/255,null!=e.a?e.a:1]:null}get isBright(){return.299*this.r+.587*this.g+.114*this.b>=127}setColor(e){if("string"==typeof e)d.fromString(e,this);else if(Array.isArray(e))d.fromArray(e,this);else{var t,r,i,n;this._set(null!=(t=e.r)?t:0,null!=(r=e.g)?r:0,null!=(i=e.b)?i:0,null!=(n=e.a)?n:1),e instanceof d||this._sanitize()}return this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),t=this.g.toString(16),r=this.b.toString(16);return`#${e.length<2?"0"+e:e}${t.length<2?"0"+t:t}${r.length<2?"0"+r:r}`}toCss(e=!1){const t=this.r+", "+this.g+", "+this.b;return e?`rgba(${t}, ${this.a})`:`rgb(${t})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=0){const t=c(this.r),r=c(this.g),i=c(this.b);return 0===e||1!==this.a?[t,r,i,c(255*this.a)]:[t,r,i]}clone(){return new d(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}_sanitize(){return this.r=Math.round(u(this.r,0,255)),this.g=Math.round(u(this.g,0,255)),this.b=Math.round(u(this.b,0,255)),this.a=u(this.a,0,1),this}_set(e,t,r,i){this.r=e,this.g=t,this.b=r,this.a=i}}d.prototype.declaredClass="esri.Color";t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return Be})),r.d(t,"b",(function(){return ce})),r.d(t,"c",(function(){return De})),r.d(t,"d",(function(){return Re})),r.d(t,"e",(function(){return de})),r.d(t,"f",(function(){return oe})),r.d(t,"g",(function(){return ue})),r.d(t,"h",(function(){return re})),r.d(t,"i",(function(){return ie})),r.d(t,"j",(function(){return ne})),r.d(t,"k",(function(){return Ee})),r.d(t,"l",(function(){return Ge})),r.d(t,"m",(function(){return Ne})),r.d(t,"n",(function(){return se})),r.d(t,"o",(function(){return Ae})),r.d(t,"p",(function(){return Pe})),r.d(t,"q",(function(){return Te})),r.d(t,"r",(function(){return Ce})),r.d(t,"s",(function(){return ae})),r.d(t,"t",(function(){return he})),r.d(t,"u",(function(){return je})),r.d(t,"v",(function(){return xe})),r.d(t,"w",(function(){return me})),r.d(t,"x",(function(){return Oe})),r.d(t,"y",(function(){return ve})),r.d(t,"z",(function(){return we})),r.d(t,"A",(function(){return Se})),r.d(t,"B",(function(){return _e})),r.d(t,"C",(function(){return Qe}));var i=r(11),n=r(10),s=r(2),a=r(12),o=r(54),l=r(16),c=r(3),u=r(5),d=r(50),h=r(243),p=r(79),f=r(8);let b,m=null;function g(){return!!m}function y(){return b||(b=Promise.all([r.e(134),r.e(143)]).then(r.bind(null,975)).then((function(e){return e.p})).then((({default:e})=>e({locateFile:e=>Object(p.b)(`esri/geometry/support/${e}`)}))).then((e=>{I(e)})),b)}var v,O,j,_;!function(e){function t(e,t,r){m.ensureCache.prepare();const i=L(r),n=r===i,s=m.ensureFloat64(i),a=m._pe_geog_to_proj(m.getPointer(e),t,s);return a&&k(r,t,s,n),a}function r(e,t,r){return i(e,t,r,0)}function i(e,t,r,i){m.ensureCache.prepare();const n=L(r),s=r===n,a=m.ensureFloat64(n),o=m._pe_proj_to_geog_center(m.getPointer(e),t,a,i);return o&&k(r,t,a,s),o}e.geogToProj=t,e.projGeog=function(e,i,n,s){switch(s){case O.PE_TRANSFORM_P_TO_G:return r(e,i,n);case O.PE_TRANSFORM_G_TO_P:return t(e,i,n)}return 0},e.projToGeog=r,e.projToGeogCenter=i}(v||(v={})),(_=O||(O={})).init=function(){_.PE_BUFFER_MAX=m.PeDefs.prototype.PE_BUFFER_MAX,_.PE_NAME_MAX=m.PeDefs.prototype.PE_NAME_MAX,_.PE_MGRS_MAX=m.PeDefs.prototype.PE_MGRS_MAX,_.PE_USNG_MAX=m.PeDefs.prototype.PE_USNG_MAX,_.PE_DD_MAX=m.PeDefs.prototype.PE_DD_MAX,_.PE_DDM_MAX=m.PeDefs.prototype.PE_DDM_MAX,_.PE_DMS_MAX=m.PeDefs.prototype.PE_DMS_MAX,_.PE_UTM_MAX=m.PeDefs.prototype.PE_UTM_MAX,_.PE_PARM_MAX=m.PeDefs.prototype.PE_PARM_MAX,_.PE_TYPE_NONE=m.PeDefs.prototype.PE_TYPE_NONE,_.PE_TYPE_GEOGCS=m.PeDefs.prototype.PE_TYPE_GEOGCS,_.PE_TYPE_PROJCS=m.PeDefs.prototype.PE_TYPE_PROJCS,_.PE_TYPE_GEOGTRAN=m.PeDefs.prototype.PE_TYPE_GEOGTRAN,_.PE_TYPE_COORDSYS=m.PeDefs.prototype.PE_TYPE_COORDSYS,_.PE_TYPE_UNIT=m.PeDefs.prototype.PE_TYPE_UNIT,_.PE_TYPE_LINUNIT=m.PeDefs.prototype.PE_TYPE_LINUNIT,_.PE_STR_OPTS_NONE=m.PeDefs.prototype.PE_STR_OPTS_NONE,_.PE_STR_AUTH_NONE=m.PeDefs.prototype.PE_STR_AUTH_NONE,_.PE_STR_AUTH_TOP=m.PeDefs.prototype.PE_STR_AUTH_TOP,_.PE_STR_NAME_CANON=m.PeDefs.prototype.PE_STR_NAME_CANON,_.PE_PARM_X0=m.PeDefs.prototype.PE_PARM_X0,_.PE_PARM_ND=m.PeDefs.prototype.PE_PARM_ND,_.PE_TRANSFORM_1_TO_2=m.PeDefs.prototype.PE_TRANSFORM_1_TO_2,_.PE_TRANSFORM_2_TO_1=m.PeDefs.prototype.PE_TRANSFORM_2_TO_1,_.PE_TRANSFORM_P_TO_G=m.PeDefs.prototype.PE_TRANSFORM_P_TO_G,_.PE_TRANSFORM_G_TO_P=m.PeDefs.prototype.PE_TRANSFORM_G_TO_P,_.PE_HORIZON_RECT=m.PeDefs.prototype.PE_HORIZON_RECT,_.PE_HORIZON_POLY=m.PeDefs.prototype.PE_HORIZON_POLY,_.PE_HORIZON_LINE=m.PeDefs.prototype.PE_HORIZON_LINE,_.PE_HORIZON_DELTA=m.PeDefs.prototype.PE_HORIZON_DELTA},function(e){const t={},r={},i=e=>{if(e){const t=e.getType();switch(t){case O.PE_TYPE_GEOGCS:e=m.castObject(e,m.PeGeogcs);break;case O.PE_TYPE_PROJCS:e=m.castObject(e,m.PeProjcs);break;case O.PE_TYPE_GEOGTRAN:e=m.castObject(e,m.PeGeogtran);break;default:t&O.PE_TYPE_UNIT&&(e=m.castObject(e,m.PeUnit))}}return e};function n(e,r){let n=null,s=t[e];if(s||(s={},t[e]=s),s.hasOwnProperty(String(r)))n=s[r];else{const t=m.PeFactory.prototype.factoryByType(e,r);m.compare(t,m.NULL)||(n=t,s[r]=n)}return n=i(n),n}e.initialize=function(){m.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return n(O.PE_TYPE_COORDSYS,e)},e.factoryByType=n,e.fromString=function(e,t){let n=null,s=r[e];if(s||(s={},r[e]=s),s.hasOwnProperty(t))n=s[t];else{const r=m.PeFactory.prototype.fromString(e,t);m.compare(r,m.NULL)||(n=r,s[t]=n)}return n=i(n),n},e.geogcs=function(e){return n(O.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return n(O.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return m.PeFactory.prototype.getCode(e)},e.projcs=function(e){return n(O.PE_TYPE_PROJCS,e)},e.unit=function(e){return n(O.PE_TYPE_UNIT,e)}}(j||(j={}));let w=null;var x,S,T,C,M,P,A,E,R;function I(e){function t(e,t,r){e[t]=r(e[t])}m=e,O.init(),x.init(),M.init(),A.init(),E.init(),w=class extends m.PeGCSExtent{destroy(){m.destroy(this)}};const r=[m.PeDatum,m.PeGeogcs,m.PeGeogtran,m.PeObject,m.PeParameter,m.PePrimem,m.PeProjcs,m.PeSpheroid,m.PeUnit];for(const s of r)t(s.prototype,"getName",(e=>function(){return e.call(this,new Array(O.PE_NAME_MAX))}));for(const s of[m.PeGeogtran,m.PeProjcs])t(s.prototype,"getParameters",(e=>function(){const t=new Array(O.PE_PARM_MAX);let r=e.call(this);for(let e=0;e<t.length;e++){const i=m.getValue(r,"*");t[e]=i?m.wrapPointer(i,m.PeParameter):null,r+=Int32Array.BYTES_PER_ELEMENT}return t}));t(m.PeHorizon.prototype,"getCoord",(e=>function(){const t=this.getSize();if(!t)return null;const r=[];return k(r,t,e.call(this)),r})),t(m.PeGTlistExtendedEntry.prototype,"getEntries",(e=>{const t=m._pe_getPeGTlistExtendedGTsSize();return function(){let r=null;const i=e.call(this);if(!m.compare(i,m.NULL)){r=[i];const e=this.getSteps();if(e>1){const n=m.getPointer(i);for(let i=1;i<e;i++)r.push(m.wrapPointer(n+t*i,m.PeGTlistExtendedGTs))}}return r}}));const i=m._pe_getPeHorizonSize(),n=e=>function(){let t=this._cache;if(t||(t=new Map,this._cache=t),t.has(e))return t.get(e);let r=null;const n=e.call(this);if(!m.compare(n,m.NULL)){r=[n];const e=n.getNump();if(e>1){const t=m.getPointer(n);for(let n=1;n<e;n++)r.push(m.wrapPointer(t+i*n,m.PeHorizon))}}return t.set(e,r),r};t(m.PeProjcs.prototype,"horizonGcsGenerate",n),t(m.PeProjcs.prototype,"horizonPcsGenerate",n),m.PeObject.prototype.toString=function(e=O.PE_STR_OPTS_NONE){m.ensureCache.prepare();const t=m.getPointer(this),r=m.ensureInt8(new Array(O.PE_BUFFER_MAX));return m.UTF8ToString(m._pe_object_to_string_ext(t,e,r))}}function D(e){if(!e)return;const t=m.getClass(e);if(!t)return;const r=m.getCache(t);if(!r)return;const i=m.getPointer(e);i&&delete r[i]}function F(e,t){const r=[],i=new Array(t);for(let n=0;n<e;n++)r.push(m.ensureInt8(i));return r}function L(e){let t;return Array.isArray(e[0])?(t=[],e.forEach((e=>{t.push(e[0],e[1])}))):t=e,t}function k(e,t,r,i=!1){if(i)for(let n=0;n<2*t;n++)e[n]=m.getValue(r+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const i=0===e.length;for(let n=0;n<t;n++)i&&(e[n]=new Array(2)),e[n][0]=m.getValue(r,"double"),e[n][1]=m.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}!function(e){let t;e.init=function(){e.PE_GTLIST_OPTS_COMMON=m.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=m._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,r,i,n,s,a){let o=null;const l=new m.PeInteger(a);try{const c=m.PeGTlistExtended.prototype.getGTlist(e,r,i,n,s,l);if((a=l.val)&&(o=[c],a>1)){const e=m.getPointer(c);for(let r=1;r<a;r++)o.push(m.wrapPointer(e+t*r,m.PeGTlistExtendedEntry))}}finally{m.destroy(l)}return o}}(x||(x={})),function(e){e.destroy=function(e){if(e&&e.length){for(const t of e)D(t),t.getEntries().forEach((e=>{D(e);const t=e.getGeogtran();D(t),t.getParameters().forEach(D),[t.getGeogcs1(),t.getGeogcs2()].forEach((e=>{D(e);const t=e.getDatum();D(t),D(t.getSpheroid()),D(e.getPrimem()),D(e.getUnit())}))}));m.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(S||(S={})),function(e){e.geogToGeog=function(e,t,r,i,n){m.ensureCache.prepare();const s=L(r),a=r===s,o=m.ensureFloat64(s);let l=0;i&&(l=m.ensureFloat64(i));const c=m._pe_geog_to_geog(m.getPointer(e),t,o,l,n);return c&&k(r,t,o,a),c}}(T||(T={})),function(e){const t=(e,t,r,i,n,s)=>{let a,o;switch(m.ensureCache.prepare(),e){case"dd":a=m._pe_geog_to_dd,o=O.PE_DD_MAX;break;case"ddm":a=m._pe_geog_to_ddm,o=O.PE_DDM_MAX;break;case"dms":a=m._pe_geog_to_dms,o=O.PE_DMS_MAX}let l=0;t&&(l=m.getPointer(t));const c=L(i),u=m.ensureFloat64(c),d=F(r,o),h=a(l,r,u,n,m.ensureInt32(d));if(h)for(let p=0;p<r;p++)s[p]=m.UTF8ToString(d[p]);return h},r=(e,t,r,i,n)=>{let s;switch(m.ensureCache.prepare(),e){case"dd":s=m._pe_dd_to_geog;break;case"ddm":s=m._pe_ddm_to_geog;break;case"dms":s=m._pe_dms_to_geog}let a=0;t&&(a=m.getPointer(t));const o=i.map((e=>m.ensureString(e))),l=m.ensureInt32(o),c=m.ensureFloat64(new Array(2*r)),u=s(a,r,l,c);return u&&k(n,r,c),u};e.geog_to_dms=function(e,r,i,n,s){return t("dms",e,r,i,n,s)},e.dms_to_geog=function(e,t,i,n){return r("dms",e,t,i,n)},e.geog_to_ddm=function(e,r,i,n,s){return t("ddm",e,r,i,n,s)},e.ddm_to_geog=function(e,t,i,n){return r("ddm",e,t,i,n)},e.geog_to_dd=function(e,r,i,n,s){return t("dd",e,r,i,n,s)},e.dd_to_geog=function(e,t,i,n){return r("dd",e,t,i,n)}}(C||(C={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=m.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=m.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=m.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=m.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=m.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geog_to_mgrs_extended=function(e,t,r,i,n,s,a){m.ensureCache.prepare();let o=0;e&&(o=m.getPointer(e));const l=L(r),c=m.ensureFloat64(l),u=F(t,O.PE_MGRS_MAX),d=m.ensureInt32(u),h=m._pe_geog_to_mgrs_extended(o,t,c,i,n,s,d);if(h)for(let p=0;p<t;p++)a[p]=m.UTF8ToString(u[p]);return h},e.mgrs_to_geog_extended=function(e,t,r,i,n){m.ensureCache.prepare();let s=0;e&&(s=m.getPointer(e));const a=r.map((e=>m.ensureString(e))),o=m.ensureInt32(a),l=m.ensureFloat64(new Array(2*t)),c=m._pe_mgrs_to_geog_extended(s,t,o,i,l);return c&&k(n,t,l),c}}(M||(M={})),function(e){e.geog_to_usng=function(e,t,r,i,n,s,a){m.ensureCache.prepare();let o=0;e&&(o=m.getPointer(e));const l=L(r),c=m.ensureFloat64(l),u=F(t,O.PE_MGRS_MAX),d=m.ensureInt32(u),h=m._pe_geog_to_usng(o,t,c,i,n,s,d);if(h)for(let p=0;p<t;p++)a[p]=m.UTF8ToString(u[p]);return h},e.usng_to_geog=function(e,t,r,i){m.ensureCache.prepare();let n=0;e&&(n=m.getPointer(e));const s=r.map((e=>m.ensureString(e))),a=m.ensureInt32(s),o=m.ensureFloat64(new Array(2*t)),l=m._pe_usng_to_geog(n,t,a,o);return l&&k(i,t,o),l}}(P||(P={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=m.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=m.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=m.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geog_to_utm=function(e,t,r,i,n){m.ensureCache.prepare();let s=0;e&&(s=m.getPointer(e));const a=L(r),o=m.ensureFloat64(a),l=F(t,O.PE_UTM_MAX),c=m.ensureInt32(l),u=m._pe_geog_to_utm(s,t,o,i,c);if(u)for(let d=0;d<t;d++)n[d]=m.UTF8ToString(l[d]);return u},e.utm_to_geog=function(e,t,r,i,n){m.ensureCache.prepare();let s=0;e&&(s=m.getPointer(e));const a=r.map((e=>m.ensureString(e))),o=m.ensureInt32(a),l=m.ensureFloat64(new Array(2*t)),c=m._pe_utm_to_geog(s,t,o,i,l);return c&&k(n,t,l),c}}(A||(A={})),function(e){const t=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=m.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=m.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=m.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=m.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(r,i=e.PE_PCSINFO_OPTION_DOMAIN){let n,s;return t.has(r)&&(s=t.get(r),s[i]&&(n=s[i])),n||(n=m.PePCSInfo.prototype.generate(r,i),s||(s=[],t.set(r,s)),s[i]=n),n}}(E||(E={})),function(e){e.version_string=function(){return m.PeVersion.prototype.version_string()}}(R||(R={}));var z=Object.freeze({__proto__:null,get _pe(){return m},isLoaded:g,isSupported:function(){return!!Object(f.a)("esri-wasm")},load:y,get PeCSTransformations(){return v},get PeDefs(){return O},get PeFactory(){return j},get PeGCSExtent(){return w},get PeGTlistExtended(){return x},get PeGTlistExtendedEntry(){return S},get PeGTTransformations(){return T},get PeNotationDms(){return C},get PeNotationMgrs(){return M},get PeNotationUsng(){return P},get PeNotationUtm(){return A},get PePCSInfo(){return E},get PeVersion(){return R},_init:I}),V=r(41),N=r(144),U=r(166),B=r(53),G=r(28),q=r(57),H=r(631);let W=0;class ${constructor(e=null){this.uid=W++,e?(this._wkt=void 0!==e.wkt?e.wkt:null,this._wkid=void 0!==e.wkid?e.wkid:-1,this._isInverse=void 0!==e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(e){const t=new $;return t._wkt=e.wkt,t._wkid=e.wkid,t._isInverse=e.isInverse,t}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=W++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=W++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=W++}getInverse(){const e=new $;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}}var Q=$;class Z{constructor(e){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const t of e.steps)t instanceof Q?this.steps.push(t):this.steps.push(new Q({wkid:t.wkid,wkt:t.wkt,isInverse:t.isInverse}))}static cacheKey(e,t){return[void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&null!==e.wkt?e.wkt.toString():"",void 0!==t.wkid&&null!==t.wkid?t.wkid.toString():"-1",void 0!==t.wkt&&null!==t.wkt?t.wkt.toString():""].join(",")}static fromGE(e){const t=new Z;let r="";for(const i of e.steps){const e=Q.fromGE(i);t.steps.push(e),r+=e.uid.toString()+","}return t._cached_projection={},t._gtlistentry=null,t._chain=r,t}getInverse(){const e=new Z;e.steps=[];for(let t=this.steps.length-1;t>=0;t--){const r=this.steps[t];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const t of this.steps)e+=t.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e),this._gtlistentry}assignCachedGe(e,t,r){this._cached_projection[Z.cacheKey(e,t)]=r}getCachedGeTransformation(e,t){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);const i=this._cached_projection[Z.cacheKey(e,t)];return void 0===i?null:i}}var X=Z,J=r(43);let Y=null,K=null,ee=null,te={};function re(){return!!Y&&g()}function ie(){return!0}function ne(e){return Object(s.i)(ee)&&(ee=Promise.all([y(),r.e(4).then(r.bind(null,792)).then((function(e){return e.g})),r.e(151).then(r.bind(null,823))])),ee.then((([,t,{hydratedAdapter:r}])=>{Object(a.x)(e),K=r,Y=t.default,Y._enableProjection(z)}))}function se(e,t,r=null){return Array.isArray(e)?0===e.length?[]:ae(K,e,e[0].spatialReference,t,r):ae(K,[e],e.spatialReference,t,r)[0]}function ae(e,t,r,i,n=null){if(Object(s.i)(r)||Object(s.i)(i))return t;if(ce(r,i,n))return t.map((e=>function(e,t,r){if(!e)return e;if("x"in e){const i=new V.a;return pe(e,t,i,r)?i:null}if("xmin"in e){const i=new d.a;return ye(e,t,i,r)?i:null}if("rings"in e){const i=new N.a;return ge(e,t,i,r)?i:null}if("paths"in e){const i=new U.a;return be(e,t,i,r)?i:null}if("points"in e){const i=new h.a;return fe(e,t,i,r)?i:null}return null}(e,r,i)));if(Object(s.i)(n)){const e=X.cacheKey(r,i);void 0!==te[e]?n=te[e]:(n=oe(r,i,null),Object(s.i)(n)&&(n=new X),te[e]=n)}if(Object(s.i)(Y))throw new le;return Y._project(e,t,r,i,n)}function oe(e,t,r=null){if(Object(s.i)(Y))throw new le;if(Object(s.i)(e)||Object(s.i)(t))return null;const i=Y._getTransformation(K,e,t,r,null==r?void 0:r.spatialReference);return null!==i?X.fromGE(i):null}class le extends i.a{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function ce(e,t,r){return!r&&(!!Object(J.c)(e,t)||Object(J.j)(e)&&Object(J.j)(t)&&!!st(e,t,ut))}async function ue(e,t,r,i){if(!re())if(Array.isArray(e)){for(const{source:n,dest:s,geographicTransformation:a}of e)if(!ce(n,s,a))return ne(i)}else if(!ce(e,t,r))return ne(i)}function de(e,t){switch(st(e,t,ut)){case Le:return"copy3";case $e:return"wgs84ToSphericalECEF";case Ue:return"wgs84ToWebMercator";case et:return"wgs84ToWGS84ECEF";case ke:return"webMercatorToWGS84";case ze:return"webMercatorToSphericalECEF";case Ve:return"webMercatorToWGS84ECEF";case tt:return"wgs84ECEFToWGS84";case rt:return"wgs84ECEFToSphericalECEF";case it:return"wgs84ECEFToWebMercator";case Je:return"sphericalECEFToWGS84";case Ye:return"sphericalECEFToWebMercator";case Xe:return"sphericalMarsPCPFToMars2000";case Ze:return"sphericalMoonPCPFToMoon2000";case Ke:return"sphericalECEFToWGS84ECEF";case We:return"mars2000ToSphericalPCPF";case He:return"moon2000ToSphericalPCPF";default:return null}}function he(e,t,r=t.spatialReference,i=0){return!Object(s.i)(r)&&pe(e,e.spatialReference,t,r,i)}function pe(e,t,r,i,n=0){gt[0]=e.x,gt[1]=e.y;const s=e.z;return gt[2]=void 0!==s?s:n,!!Te(gt,t,0,gt,i,0,1)&&(r.x=gt[0],r.y=gt[1],r.spatialReference=i,void 0===s?(r.z=void 0,r.hasZ=!1):(r.z=gt[2],r.hasZ=!0),void 0===e.m?(r.m=void 0,r.hasM=!1):(r.m=e.m,r.hasM=!0),!0)}function fe(e,t,r,i,n=0){const{points:s,hasZ:a,hasM:o}=e,l=[],c=s.length,u=[];for(const d of s)u.push(d[0],d[1],a?d[2]:n);if(!Te(u,t,0,u,i,0,c))return!1;for(let d=0;d<c;++d){const e=3*d,t=u[e],r=u[e+1];a&&o?l.push([t,r,u[e+2],s[d][3]]):a?l.push([t,r,u[e+2]]):o?l.push([t,r,s[d][2]]):l.push([t,r])}return r.points=l,r.spatialReference=i,r.hasZ=a,r.hasM=o,!0}function be(e,t,r,i,n=0){const{paths:s,hasZ:a,hasM:o}=e,l=[];return!!Me(s,a,o,t,l,i,n)&&(r.paths=l,r.spatialReference=i,r.hasZ=a,r.hasM=o,!0)}function me(e,t,r=t.spatialReference,i=0){return!Object(s.i)(r)&&ge(e,e.spatialReference,t,r,i)}function ge(e,t,r,i,n=0){const{rings:s,hasZ:a,hasM:o}=e,l=[];return!!Me(s,a,o,t,l,i,n)&&(r.rings=l,r.spatialReference=i,r.hasZ=a,r.hasM=o,!0)}function ye(e,t,r,i,n=0){const{xmin:s,ymin:a,xmax:o,ymax:l,hasZ:c,hasM:u}=e;return!!_e(s,a,c?e.zmin:n,t,gt,i)&&(r.xmin=gt[0],r.ymin=gt[1],c&&(r.zmin=gt[2]),!!_e(o,l,c?e.zmax:n,t,gt,i)&&(r.xmax=gt[0],r.ymax=gt[1],c&&(r.zmax=gt[2]),u&&(r.mmin=e.mmin,r.mmax=e.mmax),r.spatialReference=i,!0))}function ve(e,t,r){if(Object(s.i)(t)||Object(s.i)(r))return null;const i=new V.a({spatialReference:r});return Te(e,t,0,gt,r,0,1)?(i.x=gt[0],i.y=gt[1],i.z=gt[2],i):null}function Oe(e,t,r){return Te(e,t,0,gt,r.spatialReference,0,1)?(r.x=gt[0],r.y=gt[1],r.z=gt[2],r):null}function je(e,t,r,i=0){gt[0]=e.x,gt[1]=e.y;const n=e.z;return gt[2]=void 0!==n?n:i,Te(gt,e.spatialReference,0,t,r,0,1)}function _e(e,t,r,i,n,s){return ft[0]=e,ft[1]=t,ft[2]=r,Te(ft,i,0,n,s,0,1)}function we(e,t,r,i){return!(Object(s.i)(t)||Object(s.i)(i)||e.length<2)&&(2===e.length&&(ft[0]=e[0],ft[1]=e[1],ft[2]=0,e=ft),Te(e,t,0,r,i,0,1))}function xe(e,t){gt[0]=e.x,gt[1]=e.y;const r=e.z;return gt[2]=void 0!==r?r:0,Se(gt,e.spatialReference,t)}function Se(e,t,r){return function(e,t,r){if(Object(s.i)(t))return!1;const i=Fe(t,lt),n=nt[i][6];return!Object(s.i)(n)&&(n(e,0,ft,0),r!==ft&&(r[0]=ft[0],r[1]=ft[1],r.length>2&&(r[2]=ft[2])),!0)}(e,t,r)}function Te(e,t,r,i,n,a,o=1){const l=st(t,n,ut);if(Object(s.i)(l))return!1;if(l===Le){if(e===i&&r===a)return!0;const t=r+3*o;for(let n=r,s=a;n<t;n++,s++)i[s]=e[n];return!0}const c=r+3*o;for(let s=r,u=a;s<c;s+=3,u+=3)l(e,s,i,u);return!0}function Ce(e,t,r,i,n){Object(c.m)(gt,e),Object(c.h)(yt,e,t),we(gt,r,gt,n),we(yt,r,yt,n),Object(c.l)(i,yt,gt),Object(c.t)(i,i)}function Me(e,t,r,i,n,s,a=0){const o=new Array;for(const c of e)for(const e of c)o.push(e[0],e[1],t?e[2]:a);if(!Te(o,i,0,o,s,0,o.length/3))return!1;let l=0;n.length=0;for(const c of e){const e=new Array;for(const i of c)t&&r?e.push([o[l++],o[l++],o[l++],i[3]]):t?e.push([o[l++],o[l++],o[l++]]):r?(e.push([o[l++],o[l++],i[2]]),l++):(e.push([o[l++],o[l++]]),l++);n.push(e)}return!0}function Pe(e,t,r,i){if(Object(s.i)(t)||Object(s.i)(i))return!1;const n=at(t,i,dt);if(n.projector===Le)return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],!0;if(Object(s.i)(n.projector))return!1;const{source:a,dest:o}=n;if(3===o.spatialReferenceId){const t=nt[a.spatialReferenceId][2];if(Object(s.i)(t))return!1;t(e,0,bt,0);const i=Math.abs(ht*bt[1])+Math.asin(e[3]/(q.a.radius+e[2]));if(Ue(bt,0,r,0),i>.9999*Math.PI)r[3]=Number.MAX_VALUE;else{const t=1/Math.cos(i);r[3]=t*e[3]}return!0}return n.projector(e,0,r,0),r[3]=e[3]*a.metersPerUnit/o.metersPerUnit,!0}function Ae(e,t,r,i){return null!=e&&(Object(J.c)(t,i)?(Object(G.y)(r,e),!0):(ft[0]=e[0],ft[1]=e[1],ft[2]=0,!!Te(ft,t,0,ft,i,0,1)&&(r[0]=ft[0],r[1]=ft[1],ft[0]=e[2],ft[1]=e[3],ft[2]=0,!!Te(ft,t,0,ft,i,0,1)&&(r[2]=ft[0],r[3]=ft[1],!0))))}function Ee(e,t,r,i){if(Object(s.i)(t)||Object(s.i)(i))return!1;const n=Fe(t,lt),a=Fe(i,ct);if(n===a&&0!==n||Object(J.c)(t,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(1===n){const t=Object(c.r)(e),i=t/Math.sqrt(e[0]*e[0]+e[1]*e[1]),n=t/q.a.radius;if(3===a)return r[0]=i*n,r[1]=i*n,r[2]=1,!0;if(2===a||5===a){const e=180/(q.a.radius*Math.PI);return r[0]=e*i*n,r[1]=e*n,r[2]=1,!0}}return!1}function Re(e,t,r,i){if(Object(s.i)(e)||Object(s.i)(i))return!1;const n=Fe(e,lt),a=Fe(i,ct);if(n===a&&!Ie(a)&&(0!==n||Object(J.c)(e,i)))return Object(l.i)(r),Object(l.t)(r,r,t),!0;if(Ie(a)){let e=0,i=0;const o=nt[n][11],l=nt[11][a];return!Object(s.i)(o)&&!Object(s.i)(l)&&(o(t,0,bt,0),l(bt,0,mt,0),e=ht*bt[0],i=ht*bt[1],De(i,e,r),r[12]=mt[0],r[13]=mt[1],r[14]=mt[2],!0)}if(3===a&&(2===n||1===n)){const e=nt[n][11];if(Object(s.i)(e))return!1;e(t,0,bt,0);const i=ht*bt[1];Ue(bt,0,mt,0),Object(l.i)(r),Object(l.t)(r,r,mt);const a=1/Math.cos(i);return Object(l.s)(r,r,[a,a,1]),!0}return!1}function Ie(e){return 1===e||7===e||9===e}function De(e,t,r){const i=Math.sin(t),n=Math.cos(t),s=Math.sin(e),a=Math.cos(e),o=r;return o[0]=-i,o[4]=-s*n,o[8]=a*n,o[12]=0,o[1]=n,o[5]=-s*i,o[9]=a*i,o[13]=0,o[2]=0,o[6]=a,o[10]=s,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,o}function Fe(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=Object(o.f)(e,1)),e.wkt===B.a.wkt?t.spatialReferenceId=1:Object(J.k)(e)?t.spatialReferenceId=2:Object(J.n)(e)?t.spatialReferenceId=3:e.wkt===B.d.wkt?t.spatialReferenceId=4:4490===e.wkid?t.spatialReferenceId=5:e.wkt===B.b.wkt?t.spatialReferenceId=7:e.wkt===B.c.wkt?t.spatialReferenceId=9:Object(J.h)(e)?t.spatialReferenceId=8:Object(J.i)(e)?t.spatialReferenceId=10:t.spatialReferenceId=0)}function Le(e,t,r,i){e!==r&&(r[i++]=e[t++],r[i++]=e[t++],r[i]=e[t])}function ke(e,t,r,i){r[i++]=pt*(e[t++]/q.a.radius),r[i++]=pt*(Math.PI/2-2*Math.atan(Math.exp(-1*e[t++]/q.a.radius))),r[i]=e[t]}function ze(e,t,r,i){ke(e,t,r,i),$e(r,i,r,i)}function Ve(e,t,r,i){ke(e,t,r,i),et(r,i,r,i)}function Ne(e,t,r,i,s){const a=.4999999*Math.PI,o=Object(n.e)(ht*e[t+1],-a,a),l=Math.sin(o);r[i++]=ht*e[t]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+l)/(1-l)),r[i]=e[t+2]}function Ue(e,t,r,i){Ne(e,t,r,i,q.a)}function Be(e){if(Object(s.i)(e))return!1;const t=Fe(e,lt);return!!nt[t][6]}function Ge(e,t,r,i,n=0){const s=i+n,a=Math.cos(r);e[0]=Math.cos(t)*a*s,e[1]=Math.sin(t)*a*s,e[2]=Math.sin(r)*s}function qe(e,t,r,i,n){const s=n+e[t+2],a=ht*e[t+1],o=ht*e[t],l=Math.cos(a);r[i++]=Math.cos(o)*l*s,r[i++]=Math.sin(o)*l*s,r[i]=Math.sin(a)*s}function He(e,t,r,i){qe(e,t,r,i,q.c.radius)}function We(e,t,r,i){qe(e,t,r,i,q.b.radius)}function $e(e,t,r,i){qe(e,t,r,i,q.a.radius)}function Qe(e,t,r,i,s){const a=e[t],o=e[t+1],l=e[t+2],c=Math.sqrt(a*a+o*o+l*l),u=Object(n.c)(l/(0===c?1:c)),d=Math.atan2(o,a);r[i++]=pt*d,r[i++]=pt*u,r[i]=c-s}function Ze(e,t,r,i){Qe(e,t,r,i,q.c.radius)}function Xe(e,t,r,i){Qe(e,t,r,i,q.b.radius)}function Je(e,t,r,i){Qe(e,t,r,i,q.a.radius)}function Ye(e,t,r,i){Je(e,t,r,i),Ue(r,i,r,i)}function Ke(e,t,r,i){Je(e,t,r,i),et(r,i,r,i)}function et(e,t,r,i){!function(e,t,r,i,n){const s=ht*e[t],a=ht*e[t+1],o=e[t+2],l=Math.sin(a),c=Math.cos(a),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);r[i++]=(u+o)*c*Math.cos(s),r[i++]=(u+o)*c*Math.sin(s),r[i++]=(u*(1-n.eccentricitySquared)+o)*l}(e,t,r,i,q.a)}function tt(e,t,r,i){const n=H.b,s=e[t],a=e[t+1],o=e[t+2];let l,c,u,d,h,p,f,b,m,g,y,v,O,j,_,w,x,S,T,C,M;l=Math.abs(o),c=s*s+a*a,u=Math.sqrt(c),d=c+o*o,h=Math.sqrt(d),C=Math.atan2(a,s),p=o*o/d,f=c/d,j=n.a2/h,_=n.a3-n.a4/h,f>.3?(b=l/h*(1+f*(n.a1+j+p*_)/h),T=Math.asin(b),g=b*b,m=Math.sqrt(1-g)):(m=u/h*(1-p*(n.a5-j-f*_)/h),T=Math.acos(m),g=1-m*m,b=Math.sqrt(g)),y=1-q.a.eccentricitySquared*g,v=q.a.radius/Math.sqrt(y),O=n.a6*v,j=u-v*m,_=l-O*b,x=m*j+b*_,w=m*_-b*j,S=w/(O/y+x),T+=S,M=x+w*S/2,o<0&&(T=-T),r[i++]=pt*C,r[i++]=pt*T,r[i]=M}function rt(e,t,r,i){tt(e,t,r,i),$e(r,i,r,i)}function it(e,t,r,i){tt(e,t,r,i),Ue(r,i,r,i)}const nt={2:{5:null,8:null,10:null,11:Le,6:Le,1:$e,7:null,9:null,0:null,3:Ue,2:Le,4:et},5:{5:Le,8:null,10:null,11:Le,6:Le,1:$e,7:null,9:null,0:null,3:null,2:null,4:et},8:{5:null,8:Le,10:null,11:Le,6:null,1:null,7:We,9:null,0:null,3:null,2:null,4:null},10:{5:null,8:null,10:Le,11:Le,6:null,1:null,7:null,9:He,0:null,3:null,2:null,4:null},3:{5:null,8:null,10:null,11:ke,6:ke,1:ze,7:null,9:null,0:null,3:Le,2:ke,4:Ve},4:{5:tt,8:null,10:null,11:tt,6:tt,1:rt,7:null,9:null,0:null,3:it,2:tt,4:Le},1:{5:Je,8:null,10:null,11:Je,6:Je,1:Le,7:null,9:null,0:null,3:Ye,2:Je,4:Ke},7:{5:null,8:Xe,10:null,11:Xe,6:null,1:null,7:Le,9:null,0:null,3:null,2:null,4:null},9:{5:null,8:null,10:Ze,11:Ze,6:null,1:null,7:null,9:Le,0:null,3:null,2:null,4:null},0:{5:null,8:null,10:null,11:null,6:null,1:null,7:null,9:null,0:Le,3:null,2:null,4:null},11:{5:Le,8:Le,10:Le,11:Le,6:Le,1:$e,7:We,9:He,0:null,3:Ue,2:Le,4:et},6:{5:null,8:null,10:null,11:Le,6:Le,1:$e,7:null,9:null,0:null,3:null,2:Le,4:et}};function st(e,t,r=ot()){return Object(s.i)(e)||Object(s.i)(t)?null:at(e,t,r).projector}function at(e,t,r){if(Object(s.i)(e)||Object(s.i)(t)||r.source.spatialReference===e&&r.dest.spatialReference===t)return r;const i=Fe(e,r.source),n=Fe(t,r.dest);return 0===i&&0===n?Object(J.c)(e,t)?r.projector=Le:r.projector=null:r.projector=nt[i][n],r}function ot(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:Le}}const lt={spatialReference:null,spatialReferenceId:0},ct={spatialReference:null,spatialReferenceId:0},ut=ot(),dt=ot(),ht=Object(n.g)(1),pt=Object(n.r)(1),ft=Object(u.e)(),bt=Object(u.e)(),mt=Object(u.e)(),gt=Object(u.e)(),yt=Object(u.e)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(44),n=r(1);function s(e,t={}){var r;const s=e instanceof i.a?e:new i.a(e,t),a={type:null==(r=null==t?void 0:t.ignoreUnknown)||r?s.apiValues:String,readOnly:null==t?void 0:t.readOnly,json:{type:s.jsonValues,read:(null==t||!t.readOnly)&&{reader:s.read},write:{writer:s.write}}};return void 0!==(null==t?void 0:t.default)&&(a.json.default=t.default),void 0!==(null==t?void 0:t.name)&&(a.json.name=t.name),Object(n.b)(a)}},function(e,t,r){"use strict";var i,n=r(0),s=r(173),a=r(68),o=r(13),l=r(2),c=r(104),u=r(128),d=r(9),h=r(65),p=r(1),f=r(4),b=r(495);class m{constructor(){this._observers=[]}observe(e){return this._observers.includes(e)||this._observers.push(e),new b.a(this._observers,e)}notify(){const e=this._observers.slice();for(let t=0;t<e.length;++t){const r=e[t];r.onInvalidated(),r.onCommitted()}}}const g=new c.a(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,(e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1})),y=()=>{};function v(e){return e?e instanceof M?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function O(e){if(e&&e.length)return e[0]}function j(e,t,r,i){const n=Math.min(e.length-r,t.length-i);let s=0;for(;s<n&&e[r+s]===t[i+s];)s++;return s}function _(e,t,r,i){t&&t.forEach(((t,n,s)=>{e.push(t),_(e,r.call(i,t,n,s),r,i)}))}const w=new Set,x=new Set,S=new Set,T=new Map;let C=0,M=i=class extends a.a.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new m,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:C++})}static isCollection(e){return null!=e&&e instanceof i}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof i?{items:e}:e:{}}*[Symbol.iterator](){yield*this.items}get items(){return Object(h.c)(this._observable),this._items}set items(e){this._emitBeforeChanges(1)||(this._splice(0,this.length,...v(e)),this._emitAfterChanges(1))}hasEventListener(e){return"change"===e?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if("change"===e){const e=this._chgListeners,r={removed:!1,callback:t};return e.push(r),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=y,r.removed=!0,e.splice(e.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const r=this.on(e,t);return{remove(){r.remove()}}}add(e,t){if(Object(h.c)(this._observable),this._emitBeforeChanges(1))return this;const r=this.getNextIndex(null!=t?t:null);return this._splice(r,0,e),this._emitAfterChanges(1),this}addMany(e,t=this._items.length){if(Object(h.c)(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(1))return this;const r=this.getNextIndex(t);return this._splice(r,0,...v(e)),this._emitAfterChanges(1),this}removeAll(){if(Object(h.c)(this._observable),!this.length||this._emitBeforeChanges(2))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(2),e}clone(){return Object(h.c)(this._observable),this._createNewInstance({items:this._items.map(o.a)})}concat(...e){Object(h.c)(this._observable);const t=e.map(v);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(Object(h.c)(this._observable),!this.length||this._emitBeforeChanges(2))return;const r=Object(l.d)(this._splice(0,this.length)),i=r.length;for(let n=0;n<i;n++)e.call(t,r[n],n,r);this._emitAfterChanges(2)}every(e,t){return Object(h.c)(this._observable),this._items.every(e,t)}filter(e,t){let r;return Object(h.c)(this._observable),r=2===arguments.length?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:r})}find(e,t){return Object(h.c)(this._observable),this._items.find(e,t)}findIndex(e,t){return Object(h.c)(this._observable),this._items.findIndex(e,t)}flatten(e,t){Object(h.c)(this._observable);const r=[];return _(r,this,e,t),new i(r)}forEach(e,t){return Object(h.c)(this._observable),this._items.forEach(e,t)}getItemAt(e){return Object(h.c)(this._observable),this._items[e]}getNextIndex(e){Object(h.c)(this._observable);const t=this.length;return(e=null==e?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return Object(h.c)(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return Object(h.c)(this._observable),this._items.indexOf(e,t)}join(e=","){return Object(h.c)(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return Object(h.c)(this._observable),this._items.lastIndexOf(e,t)}map(e,t){Object(h.c)(this._observable);const r=this._items.map(e,t);return new i({items:r})}reorder(e,t=this.length-1){Object(h.c)(this._observable);const r=this.indexOf(e);if(-1!==r){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(4))return e;this._splice(r,1),this._splice(t,0,e),this._emitAfterChanges(4)}return e}}pop(){if(Object(h.c)(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=O(this._splice(this.length-1,1));return this._emitAfterChanges(2),e}push(...e){return Object(h.c)(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,...e),this._emitAfterChanges(1)),this.length}reduce(e,t){Object(h.c)(this._observable);const r=this._items;return 2===arguments.length?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){Object(h.c)(this._observable);const r=this._items;return 2===arguments.length?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return Object(h.c)(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(Object(h.c)(this._observable),e<0||e>=this.length||this._emitBeforeChanges(2))return;const t=O(this._splice(e,1));return this._emitAfterChanges(2),t}removeMany(e){if(Object(h.c)(this._observable),!e||!e.length||this._emitBeforeChanges(2))return[];const t=e instanceof i?e.toArray():e,r=this._items,n=[],s=t.length;for(let i=0;i<s;i++){const e=t[i],s=r.indexOf(e);if(s>-1){const e=1+j(t,r,i+1,s+1),a=this._splice(s,e);a&&a.length>0&&n.push.apply(n,a),i+=e-1}}return this._emitAfterChanges(2),n}reverse(){if(Object(h.c)(this._observable),this._emitBeforeChanges(4))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,...e)),this._emitAfterChanges(4),this}shift(){if(Object(h.c)(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=O(this._splice(0,1));return this._emitAfterChanges(2),e}slice(e=0,t=this.length){return Object(h.c)(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return Object(h.c)(this._observable),this._items.some(e,t)}sort(e){if(Object(h.c)(this._observable),!this.length||this._emitBeforeChanges(4))return this;const t=Object(l.d)(this._splice(0,this.length));return arguments.length?t.sort(e):t.sort(),this._splice(0,0,...t),this._emitAfterChanges(4),this}splice(e,t,...r){Object(h.c)(this._observable);const i=(t?2:0)|(r.length?1:0);if(this._emitBeforeChanges(i))return[];const n=this._splice(e,t,...r)||[];return this._emitAfterChanges(i),n}toArray(){return Object(h.c)(this._observable),this._items.slice()}toJSON(){return Object(h.c)(this._observable),this.toArray()}toLocaleString(){return Object(h.c)(this._observable),this._items.toLocaleString()}toString(){return Object(h.c)(this._observable),this._items.toString()}unshift(...e){return Object(h.c)(this._observable),!e.length||this._emitBeforeChanges(1)||(this._splice(0,0,...e),this._emitAfterChanges(1)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,...r){const i=this._items,n=this.constructor.prototype.itemType;let s,a;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=Object(u.b)((()=>this._dispatchChange()))),t){if(a=i.splice(e,t),this.hasEventListener("before-remove")){const t=g.acquire();t.target=this,t.cancellable=!0;for(let r=0,n=a.length;r<n;r++)s=a[r],t.reset(s),this.emit("before-remove",t),t.defaultPrevented&&(a.splice(r,1),i.splice(e,0,s),e+=1,r-=1,n-=1);g.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=g.acquire();e.target=this,e.cancellable=!1;const t=a.length;for(let r=0;r<t;r++)e.reset(a[r]),this.emit("after-remove",e);g.release(e)}}if(r&&r.length){if(n){const e=[];for(const t of r){const r=n.ensureType(t);null==r&&null!=t||e.push(r)}r=e}const t=this.hasEventListener("before-add"),s=this.hasEventListener("after-add"),a=e===this.length;if(t||s){const n=g.acquire();n.target=this,n.cancellable=!0;const o=g.acquire();o.target=this,o.cancellable=!1;for(const l of r)t?(n.reset(l),this.emit("before-add",n),n.defaultPrevented||(a?i.push(l):i.splice(e++,0,l),this._set("length",i.length),s&&(o.reset(l),this.emit("after-add",o)))):(a?i.push(l):i.splice(e++,0,l),this._set("length",i.length),o.reset(l),this.emit("after-add",o));g.release(o),g.release(n)}else{if(a)for(const e of r)i.push(e);else i.splice(e,0,...r);this._set("length",i.length)}}return(r&&r.length||a&&a.length)&&this._notifyChangeEvent(r,a),a}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=g.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,g.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=g.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),g.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const e=t.changes;w.clear(),x.clear(),S.clear();for(const{added:t,removed:s}of e){if(t)if(0===S.size&&0===x.size)for(const e of t)w.add(e);else for(const e of t)x.has(e)?(S.add(e),x.delete(e)):S.has(e)||w.add(e);if(s)if(0===S.size&&0===w.size)for(const e of s)x.add(e);else for(const e of s)w.has(e)?w.delete(e):(S.delete(e),x.add(e))}const r=s.a.acquire();w.forEach((e=>{r.push(e)}));const i=s.a.acquire();x.forEach((e=>{i.push(e)}));const n=this._items,a=t.items,o=s.a.acquire();if(S.forEach((e=>{a.indexOf(e)!==n.indexOf(e)&&o.push(e)})),t.listeners&&(r.length||i.length||o.length)){const e={target:this,added:r,removed:i,moved:o},n=t.listeners.length;for(let r=0;r<n;r++){const i=t.listeners[r];i.removed||i.callback.call(this,e)}}s.a.release(r),s.a.release(i),s.a.release(o)}w.clear(),x.clear(),S.clear()}};M.ofType=e=>{if(!e)return i;if(T.has(e))return T.get(e);let t=null;if("function"==typeof e)t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const r=e.typeMap[i].prototype.declaredClass;t?t+=` | ${r}`:t=r}let r=class extends i{};r=Object(n.a)([Object(f.a)(`esri.core.Collection<${t}>`)],r);const s={Type:e,ensureType:"function"==typeof e?Object(d.m)(e):Object(d.k)(e)};return Object.defineProperty(r.prototype,"itemType",{value:s}),T.set(e,r),r},Object(n.a)([Object(p.b)()],M.prototype,"length",void 0),Object(n.a)([Object(p.b)()],M.prototype,"items",null),M=i=Object(n.a)([Object(f.a)("esri.core.Collection")],M);var P=M;t.a=P},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(13),o=r(9),l=r(1),c=r(4),u=r(29),d=r(43);let h=i=class extends s.a{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(102100===e.wkid)return i.WebMercator;if(4326===e.wkid)return i.WGS84}const t=new i;return t.read(e),t}normalizeCtorArgs(e){return e&&"object"==typeof e?e:{["string"==typeof e?"wkt":"wkid"]:e}}get isWGS84(){return Object(d.k)(this)}get isWebMercator(){return Object(d.n)(this)}get isGeographic(){return Object(d.g)(this)}get isWrappable(){return Object(d.o)(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===i.WGS84)return i.WGS84;if(this===i.WebMercator)return i.WebMercator;const e=new i;return null!=this.wkid?(e.wkid=this.wkid,null!=this.latestWkid&&(e.latestWkid=this.latestWkid),null!=this.vcsWkid&&(e.vcsWkid=this.vcsWkid),null!=this.latestVcsWkid&&(e.latestVcsWkid=this.latestVcsWkid)):null!=this.wkt&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=Object(a.a)(this.imageCoordinateSystem)),e}equals(e){if(null==e)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(null==this.imageCoordinateSystem||null==e.imageCoordinateSystem)return!1;const{id:t,referenceServiceName:r}=e.imageCoordinateSystem,{geodataXform:i}=e.imageCoordinateSystem,n=this.imageCoordinateSystem;return null==t||i?JSON.stringify(n)===JSON.stringify(e.imageCoordinateSystem):r?n.id===t&&n.referenceServiceName===r:n.id===t}return Object(d.c)(this,e)}toJSON(e){return this.write(void 0,e)}};h.GCS_NAD_1927=null,h.WGS84=null,h.WebMercator=null,Object(n.a)([Object(l.b)({readOnly:!0})],h.prototype,"isWGS84",null),Object(n.a)([Object(l.b)({readOnly:!0})],h.prototype,"isWebMercator",null),Object(n.a)([Object(l.b)({readOnly:!0})],h.prototype,"isGeographic",null),Object(n.a)([Object(l.b)({readOnly:!0})],h.prototype,"isWrappable",null),Object(n.a)([Object(l.b)({type:o.a,json:{write:!0}})],h.prototype,"latestWkid",void 0),Object(n.a)([Object(l.b)({type:o.a,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkt}}}}}}})],h.prototype,"wkid",void 0),Object(n.a)([Object(l.b)({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkid}}}}}}})],h.prototype,"wkt",void 0),Object(n.a)([Object(u.a)("wkt"),Object(u.a)("web-scene","wkt")],h.prototype,"writeWkt",null),Object(n.a)([Object(l.b)({type:o.a,json:{write:!0}})],h.prototype,"vcsWkid",void 0),Object(n.a)([Object(l.b)({type:o.a,json:{write:!0}})],h.prototype,"latestVcsWkid",void 0),Object(n.a)([Object(l.b)()],h.prototype,"imageCoordinateSystem",void 0),h=i=Object(n.a)([Object(c.a)("esri.geometry.SpatialReference")],h),h.prototype.toJSON.isDefaultToJSON=!0,h.GCS_NAD_1927=new h({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),h.WGS84=new h(d.a),h.WebMercator=new h(d.b),Object.freeze&&(Object.freeze(h.GCS_NAD_1927),Object.freeze(h.WGS84),Object.freeze(h.WebMercator));var p=h;t.a=p},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return v})),r.d(t,"h",(function(){return O})),r.d(t,"i",(function(){return h})),r.d(t,"j",(function(){return g})),r.d(t,"k",(function(){return b})),r.d(t,"l",(function(){return s})),r.d(t,"m",(function(){return y})),r.d(t,"n",(function(){return M}));var i=r(49);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function s(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function a(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function l(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function c(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function u(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function d(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function h(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return r*r+i*i+n*n+s*s}function p(e){const t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function f(e){const t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function b(e,t){const r=t[0],i=t[1],n=t[2],s=t[3];let a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=s*a),e}function m(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function g(e,t,r,i){const n=t[0],s=t[1],a=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e[3]=o+i*(r[3]-o),e}function y(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,e}function v(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function O(e,t){const r=e[0],n=e[1],s=e[2],a=e[3],o=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(r-o)<=i.a*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=i.a*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=i.a*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-u)<=i.a*Math.max(1,Math.abs(a),Math.abs(u))}const j=o,_=l,w=c,x=d,S=h,T=p,C=f;var M=Object.freeze({__proto__:null,copy:n,set:s,add:a,subtract:o,multiply:l,divide:c,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:u,scaleAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},distance:d,squaredDistance:h,length:p,squaredLength:f,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:b,dot:m,lerp:g,random:function(e,t){let r,n,s,a,o,l;t=t||1;do{r=2*Object(i.b)()-1,n=2*Object(i.b)()-1,o=r*r+n*n}while(o>=1);do{s=2*Object(i.b)()-1,a=2*Object(i.b)()-1,l=s*s+a*a}while(l>=1);const c=Math.sqrt((1-o)/l);return e[0]=t*r,e[1]=t*n,e[2]=t*s*c,e[3]=t*a*c,e},transformMat4:y,transformQuat:function(e,t,r){const i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2],c=r[3],u=c*i+o*s-l*n,d=c*n+l*i-a*s,h=c*s+a*n-o*i,p=-a*i-o*n-l*s;return e[0]=u*c+p*-a+d*-l-h*-o,e[1]=d*c+p*-o+h*-a-u*-l,e[2]=h*c+p*-l+u*-o-d*-a,e[3]=t[3],e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:v,equals:O,sub:j,mul:_,div:w,dist:x,sqrDist:S,len:T,sqrLen:C})},function(e,t,r){"use strict";var i=r(0),n=r(7),s=r(1),a=(r(8),r(45)),o=r(32),l=r(4),c=r(29),u=r(9),d=r(146),h=r(39);var p,f=r(43),b=r(46);const m=[0,0];function g(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}const y=n.a.getLogger("esri.geometry.Point");let v=p=class extends d.a{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const r=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(r)?r:r.clone())}normalizeCtorArgs(e,t,r,i,n){let s;if(Array.isArray(e))s=e,n=t,e=s[0],t=s[1],r=s[2],i=s[3];else if(e&&"object"==typeof e){if(s=e,e=null!=s.x?s.x:s.longitude,t=null!=s.y?s.y:s.latitude,r=s.z,i=s.m,(n=s.spatialReference)&&"esri.geometry.SpatialReference"!==n.declaredClass&&(n=new h.a(n)),null!=s.longitude||null!=s.latitude)if(null==s.longitude)y.warn(".longitude=","Latitude was defined without longitude");else if(null==s.latitude)y.warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const r=Object(b.c)(s.longitude,s.latitude,m);e=r[0],t=r[1]}}else g(r)?(n=r,r=null):g(i)&&(n=i,i=null);const a={x:e,y:t};return null==a.x&&null!=a.y?y.warn(".y=","Y coordinate was defined without an X coordinate"):null==a.y&&null!=a.x&&y.warn(".x=","X coordinate was defined without a Y coordinate"),null!=n&&(a.spatialReference=n),null!=r&&(a.z=r),null!=i&&(a.m=i),a}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return void 0!==this.m}set hasM(e){e!==(void 0!==this._get("m"))&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return void 0!==this.z}set hasZ(e){e!==(void 0!==this._get("z"))&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:r}=this;if(e){if(e.isWebMercator)return Object(b.g)(t,r,m)[1];if(e.isGeographic)return r}return null}set latitude(e){const{spatialReference:t,x:r}=this;t&&(t.isWebMercator?this._set("y",Object(b.c)(r,e,m)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:r}=this;if(r){if(r.isWebMercator)return Object(b.g)(e,t,m)[0];if(r.isGeographic)return e}return NaN}set longitude(e){const{y:t,spatialReference:r}=this;r&&(r.isWebMercator?this._set("x",Object(b.c)(e,t,m)[0]):r.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,r){t[r]=isNaN(e)?"NaN":e}readX(e){return"string"==typeof e?NaN:e}clone(){const e=new p;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return p.copy(e,this),this}equals(e){if(!e)return!1;const{x:t,y:r,z:i,m:n,spatialReference:s}=this,{z:a,m:o}=e;let{x:l,y:c,spatialReference:u}=e;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=Object(b.c)(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=Object(b.g)(l,c),u=s}return t===l&&r===c&&i===a&&n===o&&s.wkid===u.wkid}offset(e,t,r){return function(e,t,r,i){var n;return e.x=e.x+t,e.y=e.y+r,null!=i&&(e.z=(null!=(n=e.z)?n:0)+i),e}(this,e,t,r)}normalize(){if(!this.spatialReference)return this;const e=Object(f.d)(this.spatialReference);if(!e)return this;let t=this.x;const[r,i]=e.valid,n=2*i;let s;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n),this._set("x",t),this}distance(e){return function(e,t){const r=e.x-t.x,i=e.y-t.y,n=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(r*r+i*i+n*n)}(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write(null,e)}};Object(i.a)([Object(s.b)({readOnly:!0})],v.prototype,"cache",null),Object(i.a)([Object(s.b)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],v.prototype,"hasM",null),Object(i.a)([Object(s.b)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],v.prototype,"hasZ",null),Object(i.a)([Object(s.b)({type:Number})],v.prototype,"latitude",null),Object(i.a)([Object(s.b)({type:Number})],v.prototype,"longitude",null),Object(i.a)([Object(s.b)({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Object(a.a)((e=>isNaN(e)?e:Object(u.i)(e)))],v.prototype,"x",void 0),Object(i.a)([Object(c.a)("x")],v.prototype,"writeX",null),Object(i.a)([Object(o.a)("x")],v.prototype,"readX",null),Object(i.a)([Object(s.b)({type:Number,json:{write:!0}})],v.prototype,"y",void 0),Object(i.a)([Object(s.b)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],v.prototype,"z",void 0),Object(i.a)([Object(s.b)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],v.prototype,"m",void 0),v=p=Object(i.a)([Object(l.a)("esri.geometry.Point")],v),v.prototype.toJSON.isDefaultToJSON=!0;var O=v;t.a=O},function(e,t,r){"use strict";var i=r(0),n=r(19),s=r(38),a=r(2),o=r(1),l=r(4);let c=class extends n.a{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach((t=>{e+=t.length})),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!s.a.isCollection(e))return this;const r=this._getOrCreateGroup(t);return Array.isArray(e)||s.a.isCollection(e)?e.forEach((e=>this._isHandle(e)&&r.push(e))):r.push(e),this.notifyChange("size"),this}forEach(e,t){if("function"==typeof e)this._groups.forEach((t=>t.forEach(e)));else{const r=this._getGroup(e);r&&t&&r.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||s.a.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let r=0;r<t.length;r++)t[r].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach((e=>{for(let t=0;t<e.length;t++)e[t].remove()})),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return Object(a.d)(this._groups.get(this._ensureGroupKey(e)))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};Object(i.a)([Object(o.b)({readOnly:!0})],c.prototype,"size",null),c=Object(i.a)([Object(l.a)("esri.core.Handles")],c);var u=c;t.a=u},function(e,t,r){"use strict";r.d(t,"a",(function(){return S})),r.d(t,"b",(function(){return T})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return g})),r.d(t,"f",(function(){return b})),r.d(t,"g",(function(){return f})),r.d(t,"h",(function(){return O})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return x})),r.d(t,"k",(function(){return m})),r.d(t,"l",(function(){return v})),r.d(t,"m",(function(){return j})),r.d(t,"n",(function(){return y})),r.d(t,"o",(function(){return w}));var i=r(2),n=r(134),s=r(477);const a={102113:!0,102100:!0,3857:!0,3785:!0},o={102113:!0,102100:!0,3857:!0,3785:!0,4326:!0},l='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',c=[-20037508.342788905,20037508.342788905],u=[-20037508.342787,20037508.342787],d={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:c,origin:u,dx:1e-5},102100:{wkTemplate:l,valid:c,origin:u,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:c,origin:u,dx:1e-5},3857:{wkTemplate:l,valid:c,origin:u,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function h(e,t){return!Object(i.i)(e)&&!Object(i.i)(t)&&(e===t||(null!=e.wkid||null!=t.wkid?e.wkid===t.wkid||y(e)&&y(t)||null!=t.latestWkid&&e.wkid===t.latestWkid||null!=e.latestWkid&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function p(e){return x(e)&&e.wkid?d[e.wkid]:null}function f(e){return!!x(e)&&(e.wkid?null==s.a[e.wkid]:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function b(e){return!(O(e)||_(e))}function m(e){return x(e)&&4326===e.wkid}function g(e){return x(e)&&4490===e.wkid}function y(e){return x(e)&&null!=e.wkid&&!0===a[e.wkid]}function v(e){return 104971===e||104905===e}function O(e){return x(e)&&null!=e.wkid&&v(e.wkid)}function j(e){return 104903===e}function _(e){return x(e)&&null!=e.wkid&&j(e.wkid)}function w(e){return x(e)&&null!=e.wkid&&!0===o[e.wkid]}function x(e){return Object(i.j)(e)&&(null!=e.wkid&&e.wkid>=2e3||null!=e.wkt)}const S={wkid:4326,wkt:Object(n.c)(d[4326].wkTemplate,{Central_Meridian:"0.0"})},T={wkid:102100,latestWkid:3857}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var i=r(99);class n{constructor(e,t={ignoreUnknown:!1}){this.jsonToAPI=e,this.options=t,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this.invertMap(e),this.apiValues=this.getKeysSorted(this.apiToJSON),this.jsonValues=this.getKeysSorted(this.jsonToAPI),this.read=e=>this.fromJSON(e),this.write=(e,t,r)=>{const n=this.toJSON(e);void 0!==n&&Object(i.c)(r,n,t)},this.write.isJSONMapWriter=!0}toJSON(e){return this.apiToJSON.hasOwnProperty(e)?this.apiToJSON[e]:this.options.ignoreUnknown?void 0:e}fromJSON(e){return this.jsonToAPI.hasOwnProperty(e)?this.jsonToAPI[e]:this.options.ignoreUnknown?void 0:e}invertMap(e){const t={};for(const r in e)t[e[r]]=r;return t}getKeysSorted(e){const t=[];for(const r in e)t.push(r);return t.sort(),t}}function s(){return function(e){return new n(e,{ignoreUnknown:!0})}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(9),n=r(194);const s=Object.prototype.toString;function a(e){const t="__accessorMetadata__"in e?Object(i.m)(e):e;return function(...e){if(e.push(t),"number"==typeof e[2])throw new Error("Using @cast has parameter decorator is not supported since 4.16");return o.apply(this,e)}}function o(e,t,r,i){Object(n.b)(e,t).cast=i}function l(...e){if(3!==e.length||"string"!=typeof e[1])return 1===e.length&&"[object Function]"===s.call(e[0])?a(e[0]):1===e.length&&"string"==typeof e[0]?function(e){return function(t,r){Object(n.b)(t,e).cast=t[r]}}(e[0]):void 0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return c})),r.d(t,"g",(function(){return g})),r.d(t,"h",(function(){return u}));var i=r(13),n=r(39),s=r(57),a=r(43);function o(e){return 57.29577951308232*e}function l(e){return.017453292519943*e}function c(e){return e/s.a.radius}function u(e){return Math.PI/2-2*Math.atan(Math.exp(-1*e/s.a.radius))}function d(e){return null!=e.wkid||null!=e.wkt}const h=[0,0];function p(e,t,r,i,n){const s=e,a=n;if(a.spatialReference=r,"x"in s&&"x"in a)[a.x,a.y]=t(s.x,s.y,h,i);else if("xmin"in s&&"xmin"in a)[a.xmin,a.ymin]=t(s.xmin,s.ymin,h,i),[a.xmax,a.ymax]=t(s.xmax,s.ymax,h,i);else if("paths"in s&&"paths"in a||"rings"in s&&"rings"in a){const e="paths"in s?s.paths:s.rings,r=[];let n;for(let s=0;s<e.length;s++){const a=e[s];n=[],r.push(n);for(let e=0;e<a.length;e++)n.push(t(a[e][0],a[e][1],[0,0],i)),a[e].length>2&&n[e].push(a[e][2]),a[e].length>3&&n[e].push(a[e][3])}"paths"in a?a.paths=r:a.rings=r}else if("points"in s&&"points"in a){const e=s.points,r=[];for(let n=0;n<e.length;n++)r[n]=t(e[n][0],e[n][1],[0,0],i),e[n].length>2&&r[n].push(e[n][2]),e[n].length>3&&r[n].push(e[n][3]);a.points=r}return n}function f(e,t){const r=e&&(d(e)?e:e.spatialReference),i=t&&(d(t)?t:t.spatialReference);return!(e&&"type"in e&&"mesh"===e.type||t&&"type"in t&&"mesh"===t.type||!r||!i)&&(!!Object(a.c)(i,r)||Object(a.n)(i)&&Object(a.k)(r)||Object(a.n)(r)&&Object(a.k)(i))}function b(e,t){const r=e&&e.spatialReference,s=t&&(d(t)?t:t.spatialReference);return f(r,s)?Object(a.c)(r,s)?Object(i.a)(e):Object(a.n)(s)?p(e,m,n.a.WebMercator,!1,Object(i.a)(e)):Object(a.k)(s)?p(e,g,n.a.WGS84,!1,Object(i.a)(e)):null:null}function m(e,t,r=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const i=l(t);return r[0]=l(e)*s.a.radius,r[1]=s.a.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function g(e,t,r=[0,0],i=!1){const n=o(e/s.a.radius);return r[0]=i?n:n-360*Math.floor((n+180)/360),r[1]=o(Math.PI/2-2*Math.atan(Math.exp(-1*t/s.a.radius))),r}function y(e,t=!1,r=Object(i.a)(e)){return p(e,m,n.a.WebMercator,t,r)}function v(e,t=!1,r=Object(i.a)(e)){return p(e,g,n.a.WGS84,t,r)}},function(e,t,r){"use strict";var i=r(10),n=r(2),s=r(109),a=r(143);class o{constructor(e,t,r=null){this._context=e,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,e.instanceCounter.increment(s.b.Texture,this),this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...t},this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(s.b.Texture,this))}release(){this.dispose()}resize(e,t){const r=this._descriptor;r.width===e&&r.height===t||(r.width=e,r.height=t,this.setData(null))}setData(e){if(!this._context||!this._context.gl)return;const t=this._context.gl;this._glName||(this._glName=t.createTexture()),void 0===e&&(e=null),null===e&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const r=this._context.bindTexture(this,o.TEXTURE_UNIT_FOR_UPDATES),i=this._descriptor;o._validateTexture(this._context,i),t.pixelStorei(t.UNPACK_ALIGNMENT,i.unpackAlignment),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i.flipped?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.preMultiplyAlpha?1:0);const s=i.pixelFormat;let a=i.internalFormat?i.internalFormat:s;if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let r=e.width,n=e.height;e instanceof HTMLVideoElement&&(r=e.videoWidth,n=e.videoHeight),i.width&&i.height,t.texImage2D(t.TEXTURE_2D,0,a,s,i.dataType,e),i.hasMipmap&&this.generateMipmap(),void 0===i.width&&(i.width=r),void 0===i.height&&(i.height=n)}else{null!=i.width&&null!=i.height||console.error("Width and height must be specified!"),t.DEPTH24_STENCIL8&&a===t.DEPTH_STENCIL&&(a=t.DEPTH24_STENCIL8);let r=i.width,o=i.height;if(function(e){return Object(n.j)(e)&&"type"in e&&"compressed"===e.type}(e)){const n=Math.round(Math.log(Math.max(r,o))/Math.LN2)+1;i.hasMipmap=i.hasMipmap&&n===e.levels.length;for(let s=0;;++s){const n=e.levels[Math.min(s,e.levels.length-1)];if(t.compressedTexImage2D(t.TEXTURE_2D,s,a,r,o,0,n),1===r&&1===o||!i.hasMipmap)break;r=Math.max(1,r>>1),o=Math.max(1,o>>1)}}else if(Object(n.j)(e))t.texImage2D(t.TEXTURE_2D,0,a,r,o,0,s,i.dataType,e),i.hasMipmap&&this.generateMipmap();else for(let e=0;t.texImage2D(t.TEXTURE_2D,e,a,r,o,0,s,i.dataType,null),(1!==r||1!==o)&&i.hasMipmap;++e)r=Math.max(1,r>>1),o=Math.max(1,o>>1)}o._applySamplingMode(t,this._descriptor),o._applyWrapMode(t,this._descriptor),o._applyAnisotropicFilteringParameters(this._context,this._descriptor),this._context.bindTexture(r,o.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,r,i,n,s){s||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,c=this._context.bindTexture(this,o.TEXTURE_UNIT_FOR_UPDATES);(t<0||r<0||i>l.width||n>l.height||t+i>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),a.pixelStorei(a.UNPACK_ALIGNMENT,l.unpackAlignment),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,l.flipped?1:0),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l.preMultiplyAlpha?1:0),s instanceof ImageData||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement?a.texSubImage2D(a.TEXTURE_2D,e,t,r,l.pixelFormat,l.dataType,s):a.texSubImage2D(a.TEXTURE_2D,e,t,r,i,n,l.pixelFormat,l.dataType,s),this._context.bindTexture(c,o.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,this._samplingModeDirty=!0,o._validateTexture(this._context,e)),9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._context.bindTexture(this,o.TEXTURE_UNIT_FOR_UPDATES),r=this._context.gl;r.generateMipmap(r.TEXTURE_2D),this._context.bindTexture(t,o.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,o._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(o._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(o._applyWrapMode(e,t),this._wrapModeDirty=!1)}static _validateTexture(e,t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!");const r=Object(i.l)(t.width)&&Object(i.l)(t.height);Object(a.a)(e.gl)||r||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let r=t.samplingMode,i=t.samplingMode;9985===r||9987===r?(r=9729,t.hasMipmap||(i=9729)):9984!==r&&9986!==r||(r=9728,t.hasMipmap||(i=9728)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){var r;const i=e.capabilities.textureFilterAnisotropic;if(!i)return;const n=e.gl;n.texParameterf(n.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY,null!=(r=t.maxAnisotropy)?r:1)}}o.TEXTURE_UNIT_FOR_UPDATES=0,t.a=o},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(1);function n(e,t){const r=t?{...t,source:e}:e;return Object(i.b)({aliasOf:r})}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return o}));const i=1e-6,n=Math.random,s=Math.PI/180,a=180/Math.PI;function o(e){return e*s}function l(e){return e*a}Object.freeze({__proto__:null,EPSILON:i,RANDOM:n,toRadian:o,toDegree:l,equals:function(e,t){return Math.abs(e-t)<=i*Math.max(1,Math.abs(e),Math.abs(t))}})},function(e,t,r){"use strict";var i,n=r(0),s=r(2),a=r(134),o=r(1),l=(r(8),r(9),r(7),r(4)),c=r(146),u=r(41),d=r(39),h=r(156),p=r(444),f=r(43),b=r(46);function m(e,t,r){return null==t?r:null==r?t:e(t,r)}let g=i=class extends c.a{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,r,i,n){return function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:"object"==typeof e?(e.spatialReference=null==e.spatialReference?d.a.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:r,ymax:i,spatialReference:null==n?d.a.WGS84:n}}static fromBounds(e,t){return new i({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new u.a({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return null!=e.z&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new i;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,null!=this.zmin&&(e.zmin=this.zmin,e.zmax=this.zmax),null!=this.mmin&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&Object(b.a)(t,r)&&(e=t.isWebMercator?Object(b.b)(e):Object(b.e)(e,!0)),"point"===e.type?Object(h.e)(this,e):"extent"===e.type&&Object(h.c)(this,e)}equals(e){if(!e)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&Object(b.a)(t,r)&&(e=t.isWebMercator?Object(b.b)(e):Object(b.e)(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),r=this.width*t,i=this.height*t;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const e=(this.zmax-this.zmin)*t;this.zmin+=e,this.zmax-=e}if(this.hasM){const e=(this.mmax-this.mmin)*t;this.mmin+=e,this.mmax-=e}return this}intersects(e){if(Object(s.i)(e))return!1;"mesh"===e.type&&(e=e.extent);const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&Object(b.a)(t,r)&&(e=t.isWebMercator?Object(b.b)(e):Object(b.e)(e,!0)),Object(p.b)(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,r){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,null!=r&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=m(Math.min,this.zmin,e.zmin),this.zmax=m(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=m(Math.min,this.mmin,e.mmin),this.mmax=m(Math.max,this.mmax,e.mmax)),this}intersection(e){return this.intersects(e)?(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=m(Math.max,this.zmin,e.zmin),this.zmax=m(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=m(Math.max,this.mmin,e.mmin),this.mmax=m(Math.min,this.mmax,e.mmax)),this):null}toJSON(e){return this.write(null,e)}_shiftCM(e=Object(f.d)(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,r=this._getCM(e);if(r){const i=t.isWebMercator?Object(b.e)(r):r;this.xmin-=r.x,this.xmax-=r.x,t.isWebMercator||(i.x=this._normalizeX(i.x,e).x),this.spatialReference=new d.a(Object(a.c)(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(e){let t=null;const[r,i]=e.valid,n=this.xmin,s=this.xmax;return n>=r&&n<=i&&s>=r&&s<=i||(t=this.center),t}_normalize(e,t,r){const i=this.spatialReference;if(!i)return this;if(!(r=r||Object(f.d)(i)))return this;const n=this._getParts(r).map((e=>e.extent));if(n.length<2)return n[0]||this;if(n.length>2)return e?this._shiftCM(r):this.set({xmin:r.valid[0],xmax:r.valid[1]});if(e)return this._shiftCM(r);if(t)return n;let s=!0,a=!0;return n.forEach((e=>{e.hasZ||(s=!1),e.hasM||(a=!1)})),{rings:n.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(s){const r=(e.zmax-e.zmin)/2;for(let e=0;e<t.length;e++)t[e].push(r)}if(a){const r=(e.mmax-e.mmin)/2;for(let e=0;e<t.length;e++)t[e].push(r)}return t})),hasZ:s,hasM:a,spatialReference:i}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:r,ymax:n,spatialReference:s}=this,a=this.width,o=this.xmin,l=this.xmax;let c;e=e||Object(f.d)(s);const[u,d]=e.valid;c=this._normalizeX(this.xmin,e);const h=c.x,p=c.frameId;c=this._normalizeX(this.xmax,e);const b=c.x,m=c.frameId,g=h===b&&a>0;if(a>2*d){const e=new i(o<l?h:b,r,d,n,s),a=new i(u,r,o<l?b:h,n,s),c=new i(0,r,d,n,s),f=new i(u,r,0,n,s),g=[],y=[];e.contains(c)&&g.push(p),e.contains(f)&&y.push(p),a.contains(c)&&g.push(m),a.contains(f)&&y.push(m);for(let t=p+1;t<m;t++)g.push(t),y.push(t);t.push({extent:e,frameIds:[p]},{extent:a,frameIds:[m]},{extent:c,frameIds:g},{extent:f,frameIds:y})}else h>b||g?t.push({extent:new i(h,r,d,n,s),frameIds:[p]},{extent:new i(u,r,b,n,s),frameIds:[m]}):t.push({extent:new i(h,r,b,n,s),frameIds:[p]});this.cache._parts=t}const r=this.hasZ,n=this.hasM;if(r||n){const e={};r&&(e.zmin=this.zmin,e.zmax=this.zmax),n&&(e.mmin=this.mmin,e.mmax=this.mmax);for(let r=0;r<t.length;r++)t[r].extent.set(e)}return t}_normalizeX(e,t){const[r,i]=t.valid,n=2*i;let s,a=0;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n,a=s):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n,a=-s),{x:e,frameId:a}}};Object(n.a)([Object(o.b)({readOnly:!0})],g.prototype,"cache",null),Object(n.a)([Object(o.b)({readOnly:!0})],g.prototype,"center",null),Object(n.a)([Object(o.b)({readOnly:!0})],g.prototype,"extent",null),Object(n.a)([Object(o.b)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasM",null),Object(n.a)([Object(o.b)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasZ",null),Object(n.a)([Object(o.b)({readOnly:!0})],g.prototype,"height",null),Object(n.a)([Object(o.b)({readOnly:!0})],g.prototype,"width",null),Object(n.a)([Object(o.b)({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],g.prototype,"xmin",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],g.prototype,"ymin",void 0),Object(n.a)([Object(o.b)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],g.prototype,"mmin",void 0),Object(n.a)([Object(o.b)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],g.prototype,"zmin",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],g.prototype,"xmax",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],g.prototype,"ymax",void 0),Object(n.a)([Object(o.b)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],g.prototype,"mmax",void 0),Object(n.a)([Object(o.b)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],g.prototype,"zmax",void 0),g=i=Object(n.a)([Object(l.a)("esri.geometry.Extent")],g),g.prototype.toJSON.isDefaultToJSON=!0;var y=g;t.a=y},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return g})),r.d(t,"g",(function(){return y}));var i,n,s=r(120),a=r(2),o=r(16),l=r(20),c=r(5),u=r(36),d=r(359),h=r(91),p=r(148);function f(e,t,r,i,n,s,a,o,l,c,d){const h=O[d.mode];let p,f,b=0;if(Object(u.q)(e,t,r,i,l.spatialReference,n,o))return h.requiresAlignment(d)?(b=h.applyElevationAlignmentBuffer(i,n,s,a,o,l,c,d),p=s,f=a):(p=i,f=n),Object(u.q)(p,l.spatialReference,f,s,c.spatialReference,a,o)?b:void 0}function b(e,t,r,i,n){const o=(Object(d.a)(e)?e.z:Object(p.c)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const r=Object(a.t)(Object(p.b)(t,e,"ground"),0);return n&&(n.verticalDistanceToGround=0,n.sampledElevation=r),r}case"relative-to-ground":{const s=Object(a.t)(Object(p.b)(t,e,"ground"),0),l=r.geometryZWithOffset(o,i);return n&&(n.verticalDistanceToGround=l,n.sampledElevation=s),l+s}case"relative-to-scene":{const s=Object(a.t)(Object(p.b)(t,e,"scene"),0),l=r.geometryZWithOffset(o,i);return n&&(n.verticalDistanceToGround=l,n.sampledElevation=s),l+s}case"absolute-height":{const s=r.geometryZWithOffset(o,i);if(n){const r=Object(a.t)(Object(p.b)(t,e,"ground"),0);n.verticalDistanceToGround=s-r,n.sampledElevation=r}return s}default:return Object(s.a)(r.mode),0}}function m(e,t,r){return null==t||null==r?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?i.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function y(e){return"absolute-height"!==e}function v(e,t,r,i,n){const s=b(t,r,n,i,_);Object(h.j)(e,_.verticalDistanceToGround);const a=_.sampledElevation,l=Object(o.d)(j,e.transformation);return w[0]=t.x,w[1]=t.y,w[2]=s,Object(u.d)(t.spatialReference,w,l,i.spatialReference)?e.transformation=l:console.warn("Could not locate symbol object properly, it might be misplaced"),a}(n=i||(i={}))[n.NONE=0]="NONE",n[n.UPDATE=1]="UPDATE",n[n.RECREATE=2]="RECREATE";const O={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s,a,o){const l=o.calculateOffsetRenderUnits(a),c=o.featureExpressionInfoContext;t*=3,i*=3;for(let u=0;u<n;++u){const n=e[t+0],s=e[t+1],a=e[t+2];r[i+0]=n,r[i+1]=s,r[i+2]=null==c?a+l:l,t+=3,i+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s){let o=0;const l=s.spatialReference;t*=3,i*=3;for(let c=0;c<n;++c){const n=e[t+0],c=e[t+1],u=e[t+2],d=Object(a.t)(s.getElevation(n,c,u,l,"ground"),0);o+=d,r[i+0]=n,r[i+1]=c,r[i+2]=d,t+=3,i+=3}return o/n},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s,o,l){let c=0;const u=l.calculateOffsetRenderUnits(o),d=l.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],l=e[t+2],p=Object(a.t)(s.getElevation(n,o,l,h,"ground"),0);c+=p,r[i+0]=n,r[i+1]=o,r[i+2]=null==d?l+p+u:p+u,t+=3,i+=3}return c/n},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s,o,l){let c=0;const u=l.calculateOffsetRenderUnits(o),d=l.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],l=e[t+2],p=Object(a.t)(s.getElevation(n,o,l,h,"scene"),0);c+=p,r[i+0]=n,r[i+1]=o,r[i+2]=null==d?l+p+u:p+u,t+=3,i+=3}return c/n},requiresAlignment:()=>!0}},j=Object(l.d)(),_={verticalDistanceToGround:0,sampledElevation:0},w=Object(c.e)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return c})),r.d(t,"f",(function(){return n})),r.d(t,"g",(function(){return s})),r.d(t,"h",(function(){return f})),r.d(t,"i",(function(){return y})),r.d(t,"j",(function(){return u})),r.d(t,"k",(function(){return b})),r.d(t,"l",(function(){return h})),r.d(t,"m",(function(){return a})),r.d(t,"n",(function(){return l}));var i=r(49);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function a(e,t,r,i,n,s,a,o,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=c,e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function l(e,t){if(e===t){const r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function c(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],d=u*a-o*c,h=-u*s+o*l,p=c*s-a*l;let f=r*d+i*h+n*p;return f?(f=1/f,e[0]=d*f,e[1]=(-u*i+n*c)*f,e[2]=(o*i-n*a)*f,e[3]=h*f,e[4]=(u*r-n*l)*f,e[5]=(-o*r+n*s)*f,e[6]=p*f,e[7]=(-c*r+i*l)*f,e[8]=(a*r-i*s)*f,e):null}function u(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=r[0],p=r[1],f=r[2],b=r[3],m=r[4],g=r[5],y=r[6],v=r[7],O=r[8];return e[0]=h*i+p*a+f*c,e[1]=h*n+p*o+f*u,e[2]=h*s+p*l+f*d,e[3]=b*i+m*a+g*c,e[4]=b*n+m*o+g*u,e[5]=b*s+m*l+g*d,e[6]=y*i+v*a+O*c,e[7]=y*n+v*o+O*u,e[8]=y*s+v*l+O*d,e}function d(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=r[0],p=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=h*i+p*a+c,e[7]=h*n+p*o+u,e[8]=h*s+p*l+d,e}function h(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=Math.sin(r),p=Math.cos(r);return e[0]=p*i+h*a,e[1]=p*n+h*o,e[2]=p*s+h*l,e[3]=p*a-h*i,e[4]=p*o-h*n,e[5]=p*l-h*s,e[6]=c,e[7]=u,e[8]=d,e}function p(e,t,r){const i=r[0],n=r[1],s=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=s*t[6],e[7]=s*t[7],e[8]=s*t[8],e}function f(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,l=n+n,c=r*a,u=i*a,d=i*o,h=n*a,p=n*o,f=n*l,b=s*a,m=s*o,g=s*l;return e[0]=1-d-f,e[3]=u-g,e[6]=h+m,e[1]=u+g,e[4]=1-c-f,e[7]=p-b,e[2]=h-m,e[5]=p+b,e[8]=1-c-d,e}function b(e,t){const r=t[0],i=t[1],n=t[2],s=t[4],a=t[5],o=t[6],l=t[8],c=t[9],u=t[10],d=u*a-o*c,h=-u*s+o*l,p=c*s-a*l,f=r*d+i*h+n*p;if(!f)return null;const b=1/f;return e[0]=d*b,e[1]=(-u*i+n*c)*b,e[2]=(o*i-n*a)*b,e[3]=h*b,e[4]=(u*r-n*l)*b,e[5]=(-o*r+n*s)*b,e[6]=p*b,e[7]=(-c*r+i*l)*b,e[8]=(a*r-i*s)*b,e}function m(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],f=t[12],b=t[13],m=t[14],g=t[15],y=r*o-i*a,v=r*l-n*a,O=r*c-s*a,j=i*l-n*o,_=i*c-s*o,w=n*c-s*l,x=u*b-d*f,S=u*m-h*f,T=u*g-p*f,C=d*m-h*b,M=d*g-p*b,P=h*g-p*m;let A=y*P-v*M+O*C+j*T-_*S+w*x;return A?(A=1/A,e[0]=(o*P-l*M+c*C)*A,e[1]=(l*T-a*P-c*S)*A,e[2]=(a*M-o*T+c*x)*A,e[3]=(n*M-i*P-s*C)*A,e[4]=(r*P-n*T+s*S)*A,e[5]=(i*T-r*M-s*x)*A,e[6]=(b*w-m*_+g*j)*A,e[7]=(m*O-f*w-g*v)*A,e[8]=(f*_-b*O+g*y)*A,e):null}function g(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function y(e){const t=i.a,r=e[0],n=e[1],s=e[2],a=e[3],o=e[4],l=e[5],c=e[6],u=e[7],d=e[8];return Math.abs(1-(r*r+a*a+c*c))<=t&&Math.abs(1-(n*n+o*o+u*u))<=t&&Math.abs(1-(s*s+l*l+d*d))<=t}const v=u,O=g;Object.freeze({__proto__:null,fromMat4:n,copy:s,set:a,identity:o,transpose:l,invert:c,adjoint:function(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return e[0]=a*u-o*c,e[1]=n*c-i*u,e[2]=i*o-n*a,e[3]=o*l-s*u,e[4]=r*u-n*l,e[5]=n*s-r*o,e[6]=s*c-a*l,e[7]=i*l-r*c,e[8]=r*a-i*s,e},determinant:function(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*(c*s-a*l)+r*(-c*n+a*o)+i*(l*n-s*o)},multiply:u,translate:d,rotate:h,scale:p,scaleByVec2:function(e,t,r){const i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:f,normalFromMat4Legacy:b,normalFromMat4:m,projection:function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},subtract:g,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){const r=e[0],n=e[1],s=e[2],a=e[3],o=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=t[0],p=t[1],f=t[2],b=t[3],m=t[4],g=t[5],y=t[6],v=t[7],O=t[8];return Math.abs(r-h)<=i.a*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-p)<=i.a*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-f)<=i.a*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-b)<=i.a*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(o-m)<=i.a*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-g)<=i.a*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=i.a*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-v)<=i.a*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(d-O)<=i.a*Math.max(1,Math.abs(d),Math.abs(O))},isOrthoNormal:y,mul:v,sub:O})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return d}));var i=r(39),n=r(57),s=r(43);function a(e){return new i.a({wkt:`GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",${e.radius},0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]`})}const o=a(n.a),l=a(n.b),c=a(n.c),u=new i.a({wkt:`GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",${n.a.radius},298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]`});function d(e){return e&&e===n.b?l:e&&e===n.c?c:o}function h(e){return e&&(Object(s.h)(e)||e===l)?l:e&&(Object(s.i)(e)||e===c)?c:o}function p(e){return e&&(Object(s.h)(e)||e===l)?n.b:e&&(Object(s.i)(e)||e===c)?n.c:n.a}function f(e){return Object(s.l)(e)?n.b:Object(s.m)(e)?n.c:n.a}},function(e,t,r){"use strict";r.d(t,"a",(function(){return N})),r.d(t,"b",(function(){return j})),r.d(t,"c",(function(){return w})),r.d(t,"d",(function(){return k})),r.d(t,"e",(function(){return F})),r.d(t,"f",(function(){return D})),r.d(t,"g",(function(){return R})),r.d(t,"h",(function(){return L})),r.d(t,"i",(function(){return I})),r.d(t,"j",(function(){return c})),r.d(t,"k",(function(){return _})),r.d(t,"l",(function(){return A})),r.d(t,"m",(function(){return U})),r.d(t,"n",(function(){return O})),r.d(t,"o",(function(){return P})),r.d(t,"p",(function(){return T})),r.d(t,"q",(function(){return C})),r.d(t,"r",(function(){return M})),r.d(t,"s",(function(){return x})),r.d(t,"t",(function(){return S})),r.d(t,"u",(function(){return E}));r(8);var i=r(44),n=r(53),s=r(39),a=r(57),o=r(43),l=r(477);const c=39.37,u=a.a.radius*Math.PI/200,d=/UNIT\[([^\]]+)\]\]$/i,h=l.a,p=/UNIT\[([^\]]+)\]/i,f=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),b=Object(i.b)()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),m=e=>e*e,g=e=>e*e*e,y={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:m(.001)},"square-centimeters":{inBaseUnits:m(.01)},"square-decimeters":{inBaseUnits:m(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:m(1e3)},"square-inches":{inBaseUnits:m(.0254)},"square-feet":{inBaseUnits:m(.3048)},"square-yards":{inBaseUnits:m(.9144)},"square-miles":{inBaseUnits:m(1609.344)},"square-us-feet":{inBaseUnits:m(1200/3937)},acres:{inBaseUnits:.0015625*m(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*g(.001)},"cubic-centimeters":{inBaseUnits:1e3*g(.01)},"cubic-decimeters":{inBaseUnits:1e3*g(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*g(1e3)},"cubic-inches":{inBaseUnits:1e3*g(.0254)},"cubic-feet":{inBaseUnits:1e3*g(.3048)},"cubic-yards":{inBaseUnits:1e3*g(.9144)},"cubic-miles":{inBaseUnits:1e3*g(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},v=function(){const e={};for(const t in y)for(const r in y[t].units)e[r]=t;return e}();function O(e){const t=v[e];if(t)return t;throw new Error("unknown measure")}function j(e){return function(e){return y[e].baseUnit}(O(e))}function _(e,t=null){return t=t||O(e),y[t].baseUnit===e}function w(e,t,r){if(t===r)return e;const i=O(t);if(i!==O(r))throw new Error("incompatible units");const n=_(t,i)?e:function(e,t,r){return e*y[r].units[t].inBaseUnits}(e,t,i);return _(r,i)?n:function(e,t,r){return e/y[r].units[t].inBaseUnits}(n,r,i)}function x(e,t){return w(e,t,"meters")<3e3?"meters":"kilometers"}function S(e,t){return w(e,t,"meters")<1e5?"meters":"kilometers"}function T(e,t){return w(e,t,"feet")<1e3?"feet":"miles"}function C(e,t){return w(e,t,"feet")<1e5?"feet":"miles"}function M(e,t){return w(e,t,"square-meters")<3e6?"square-meters":"square-kilometers"}function P(e,t){return w(e,t,"square-feet")<1e6?"square-feet":"square-miles"}function A(e,t,r){return w(e,t,"meters")/(r*Math.PI/180)}function E(e){return b.fromJSON(e.toLowerCase())||null}function R(e){if(e&&"object"==typeof e&&!Object(o.f)(e))return 1;const t=D(e);return t>1e5?1:t}function I(e){return D(e)>=(e instanceof s.a?Object(n.e)(e).metersPerDegree:1e5)?"meters":L(e)}function D(e,t=a.a.metersPerDegree){return F(e,!0)||t}function F(e,t=!1){let r,i,n=null;if(null!=e&&("object"==typeof e?(r=e.wkid,i=e.wkt):"number"==typeof e?r=e:"string"==typeof e&&(i=e)),r){if(Object(o.l)(r))return a.b.metersPerDegree;if(Object(o.m)(r))return a.c.metersPerDegree;n=h.values[h[r]],!n&&t&&f.has(r)&&(n=u)}else if(i)if(-1!==i.search(/^PROJCS/i)){const e=d.exec(i);e&&e[1]&&(n=parseFloat(e[1].split(",")[1]))}else if(-1!==i.search(/^GEOCCS/i)){const e=p.exec(i);e&&e[1]&&(n=parseFloat(e[1].split(",")[1]))}return n}function L(e){let t,r,i=null;if(null!=e&&("object"==typeof e?(t=e.wkid,r=e.wkt):"number"==typeof e?t=e:"string"==typeof e&&(r=e)),t)i=h.units[h[t]];else if(r&&-1!==r.search(/^PROJCS/i)){let e=d.exec(r);e&&e[1]&&(e=/[\\"\\']{1}([^\\"\\']+)/.exec(e[1]),i=e&&e[1])}return i?E(i):null}function k(e){if(!e)return null;switch(L(e)){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric";case null:case void 0:return null}return null}const z={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},V={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},N=Object(i.b)()(z),U=Object(i.b)()(V);Object(i.b)()({...z,...V})},function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return T})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return M})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return w})),r.d(t,"g",(function(){return _})),r.d(t,"h",(function(){return m})),r.d(t,"i",(function(){return x})),r.d(t,"j",(function(){return S})),r.d(t,"k",(function(){return g})),r.d(t,"l",(function(){return F})),r.d(t,"m",(function(){return y}));r(8);var i=r(7),n=r(10),s=r(2),a=r(16),o=r(3),l=r(5),c=r(40),u=r(31),d=r(64),h=r(198),p=r(34);const f=i.a.getLogger("esri.geometry.support.sphere");function b(){return Object(u.e)()}function m(e,t=b()){return Object(c.c)(t,e)}function g(e,t){return Object(u.g)(e[0],e[1],e[2],t)}function y(e){return e}function v(e){e[0]=e[1]=e[2]=e[3]=0}function O(e){return e}function j(e){return Array.isArray(e)?e[3]:e}function _(e){return Array.isArray(e)?e:I}function w(e,t,r,i){return Object(u.g)(e,t,r,i)}function x(e,t,r){if(Object(s.i)(t))return!1;const i=Object(o.l)(p.c.get(),t.origin,_(e)),n=Object(o.j)(t.direction,t.direction),a=2*Object(o.j)(t.direction,i),l=a*a-4*n*(Object(o.j)(i,i)-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let u=(-a-c)/(2*n);const d=(-a+c)/(2*n);return(u<0||d<u&&d>0)&&(u=d),!(u<0)&&(r&&Object(o.h)(r,t.origin,Object(o.g)(p.c.get(),t.direction,u)),!0)}function S(e,t){return x(e,t,null)}function T(e,t,r){const i=p.c.get(),n=p.a.get();Object(o.i)(i,t.origin,t.direction);const s=j(e);Object(o.i)(r,i,t.origin),Object(o.g)(r,r,1/Object(o.r)(r)*s);const l=P(e,t.origin),c=Object(h.a)(t.origin,r);return Object(a.i)(n),Object(a.c)(n,n,c+l,i),Object(o.s)(r,r,n),r}function C(e,t,r){const i=Object(o.l)(p.c.get(),t,_(e)),n=Object(o.g)(p.c.get(),i,e[3]/Object(o.r)(i));return Object(o.h)(r,n,_(e))}function M(e,t){const r=Object(o.l)(p.c.get(),t,_(e)),i=Object(o.v)(r),n=e[3]*e[3];return Math.sqrt(Math.abs(i-n))}function P(e,t){const r=Object(o.l)(p.c.get(),t,_(e)),i=Object(o.r)(r),s=j(e),a=s+Math.abs(s-i);return Object(n.b)(s/a)}const A=Object(l.e)();function E(e,t,r,i){const s=Object(o.l)(A,t,_(e));switch(r){case 0:{const e=Object(n.d)(s,A)[2];return Object(o.y)(i,-Math.sin(e),Math.cos(e),0)}case 1:{const e=Object(n.d)(s,A),t=e[1],r=e[2],a=Math.sin(t);return Object(o.y)(i,-a*Math.cos(r),-a*Math.sin(r),Math.cos(t))}case 2:return Object(o.t)(i,s);default:return}}function R(e,t){const r=Object(o.l)(D,t,_(e));return Object(o.r)(r)-e[3]}const I=Object(l.e)(),D=Object(l.e)();var F=Object.freeze({__proto__:null,create:b,copy:m,fromCenterAndRadius:g,wrap:y,clear:v,fromRadius:O,getRadius:j,getCenter:_,fromValues:w,elevate:function(e,t,r){return e!==r&&Object(o.m)(r,e),r[3]=e[3]+t,r},setExtent:function(e,t,r){return f.error("sphere.setExtent is not yet supported"),e===r?r:m(e,r)},intersectRay:x,intersectsRay:S,intersectRayClosestSilhouette:function(e,t,r){if(x(e,t,r))return r;const i=T(e,t,p.c.get());return Object(o.h)(r,t.origin,Object(o.g)(p.c.get(),t.direction,Object(o.o)(t.origin,i)/Object(o.r)(t.direction))),r},closestPointOnSilhouette:T,closestPoint:function(e,t,r){return x(e,t,r)?r:(Object(d.a)(t,_(e),r),C(e,r,r))},projectPoint:C,distanceToSilhouette:M,angleToSilhouette:P,axisAt:E,altitudeAt:R,setAltitudeAt:function(e,t,r,i){const n=R(e,t),s=E(e,t,2,D),a=Object(o.g)(D,s,r-n);return Object(o.h)(i,t,a)}})},function(e,t,r){"use strict";(function(e){const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof e?e:void 0;t.a=r}).call(this,r(674))},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));class i{constructor(e,t,r,i){this.semiMajorAxis=e,this.flattening=t,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=i||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const n=new i(6378137,1/298.257223563,3e5,.006694379990137799),s=new i(3396190,1/169.8944472236118,23e4),a=new i(1737400,0,0)},function(e,t,r){"use strict";function i(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function a(e,t){return new Float32Array(e,t,3)}function o(){return i()}function l(){return s(1,1,1)}function c(){return s(1,0,0)}function u(){return s(0,1,0)}function d(){return s(0,0,1)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return s}));const h=o(),p=l(),f=c(),b=u(),m=d();Object.freeze({__proto__:null,create:i,clone:n,fromValues:s,createView:a,zeros:o,ones:l,unitX:c,unitY:u,unitZ:d,ZEROS:h,ONES:p,UNIT_X:f,UNIT_Y:b,UNIT_Z:m})},function(e,t,r){"use strict";var i,n=r(87);!function(e){const t=(e,t,r,i)=>{let n=t,s=t;const a=r>>>1,o=e[n-1];for(;s<=a;){s=n<<1,s<r&&i(e[s-1],e[s])<0&&++s;const t=e[s-1];if(i(t,o)<=0)break;e[n-1]=t,n=s}e[n-1]=o},r=(e,t)=>e<t?-1:e>t?1:0;e.sort=function(e,i,n,s){void 0===i&&(i=0),void 0===n&&(n=e.length),void 0===s&&(s=r);for(let r=n>>>1;r>i;r--)t(e,r,n,s);const a=i+1;for(let r=n-1;r>i;r--){const n=e[i];e[i]=e[r],e[r]=n,t(e,a,r,s)}},e.iterableSort=function*(e,i,n,s){void 0===i&&(i=0),void 0===n&&(n=e.length),void 0===s&&(s=r);for(let r=n>>>1;r>i;r--)t(e,r,n,s),yield;const a=i+1;for(let r=n-1;r>i;r--){const n=e[i];e[i]=e[r],e[r]=n,t(e,a,r,s),yield}}}(i||(i={}));var s=i;function a(e){e.data.length>1.5*e.length&&(e.data.length=Math.floor(1.1*e.length))}t.a=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new n.a,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),void 0!==e.deallocator&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>a(this)))}toArray(){return this.data.slice(0,this.length)}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let t=e;t<this._length;++t)this.data[t]=this._deallocator(this.data[t]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,t=e.length){for(let r=0;r<t;r++)this.data[this._length++]=e[r]}fill(e,t){for(let r=0;r<t;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,a(this)}pop(){if(0===this.length)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const t=Object(n.g)(this.data,e,this.length,this._hint);if(-1!==t)return this.data.splice(t,1),this.length=this.length-1,e}removeUnordered(e){const t=Object(n.k)(this.data,e,this.length,this._hint);return void 0!==t&&(this.length=this.length-1),this._shrink(),t}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,t=e.length,r){this.length=Object(n.l)(this.data,e,this.length,t,this._hint,r),this._shrink()}front(){if(0!==this.length)return this.data[0]}back(){if(0!==this.length)return this.data[this.length-1]}swapElements(e,t){e>=this.length||t>=this.length||e===t||([this.data[e],this.data[t]]=[this.data[t],this.data[e]])}sort(e){s.sort(this.data,0,this.length,e)}iterableSort(e){return s.iterableSort(this.data,0,this.length,e)}some(e,t){for(let r=0;r<this.length;++r)if(e.call(t,this.data[r],r,this.data))return!0;return!1}filterInPlace(e,t){let r=0;for(let i=0;i<this._length;++i){const n=this.data[i];e.call(t,n,i,this.data)&&(this.data[i]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let i=r;i<this._length;i++)this.data[i]=this._deallocator(this.data[i]);return this._length=r,this._shrink(),this}forAll(e,t){const r=this.length,i=this.data;for(let n=0;n<r;++n)e.call(t,i[n],n,i)}map(e,t){const r=new Array(this.length);for(let i=0;i<this.length;++i)r[i]=e.call(t,this.data[i],i,this.data);return r}reduce(e,t){let r=t;for(let i=0;i<this.length;++i)r=e(r,this.data[i],i,this.data);return r}has(e){const t=this.length,r=this.data;for(let i=0;i<t;++i)if(r[i]===e)return!0;return!1}}},function(e,t,r){"use strict";function i(e){return e}function n(e){return 1e3*e}function s(e){return e}function a(e){return.001*e}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return a}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return l}));var i=r(2),n=r(3),s=r(5),a=r(6);function o(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");const r=a.a`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,i=a.a`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
if (sliceByFactors(factors)) {
return color;
}
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.sliceHighlightDisabled?a.a`#define highlightSlice(_color_, _pos_) (_color_)`:a.a`
        ${i}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}else{const r=a.a`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(r),e.fragment.code.add(r)}}function l(e,t,r){c(e,t,r.slicePlane,r.origin)}function c(e,t,r,a){t.slicePlaneEnabled&&(Object(i.j)(r)?(a?(Object(n.l)(u,r.origin,a),e.setUniform3fv("slicePlaneOrigin",u)):e.setUniform3fv("slicePlaneOrigin",r.origin),e.setUniform3fv("slicePlaneBasis1",r.basis1),e.setUniform3fv("slicePlaneBasis2",r.basis2)):(e.setUniform3fv("slicePlaneBasis1",s.b),e.setUniform3fv("slicePlaneBasis2",s.b),e.setUniform3fv("slicePlaneOrigin",s.b)))}const u=Object(s.e)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i=new Map([["position",0],["normal",1],["uv0",2],["color",3],["size",4],["tangent",4],["auxpos1",5],["symbolColor",5],["auxpos2",6],["featureAttribute",6],["instanceFeatureAttribute",6],["instanceColor",7],["model",8],["modelNormal",12],["modelOriginHi",11],["modelOriginLo",15]])},function(e,t,r){"use strict";r.d(t,"a",(function(){return B})),r.d(t,"b",(function(){return C})),r.d(t,"c",(function(){return M})),r.d(t,"d",(function(){return G})),r.d(t,"e",(function(){return D})),r.d(t,"f",(function(){return E})),r.d(t,"g",(function(){return L})),r.d(t,"h",(function(){return A})),r.d(t,"i",(function(){return V})),r.d(t,"j",(function(){return F})),r.d(t,"k",(function(){return z})),r.d(t,"l",(function(){return R})),r.d(t,"m",(function(){return P})),r.d(t,"n",(function(){return I})),r.d(t,"o",(function(){return k})),r.d(t,"p",(function(){return N})),r.d(t,"q",(function(){return q})),r.d(t,"r",(function(){return U})),r.d(t,"s",(function(){return x}));var i=r(2),n=r(353),s=r(296),a=r(427),o=r(11),l=r(3),c=r(5),u=r(28),d=r(76),h=r(195);const p=Object(c.e)(),f=Object(c.e)(),b=Object(c.e)(),m=Object(c.e)();function g(e,t,r,i){Object(l.m)(p,r),p[i]=t[i];const n=Object(l.l)(p,p,t),s=Object(l.l)(f,e,t),a=Object(l.j)(s,n),o=Object(l.j)(n,n);let c;c=a<=0?t:o<=a?r:Object(l.h)(p,t,Object(l.g)(n,n,a/o));const u=Object(l.l)(p,e,c);return Math.PI/2-Math.atan(u[2]/Math.sqrt(u[0]*u[0]+u[1]*u[1]))}var y=Object.freeze({__proto__:null,isInsideExtent:function(e,t,r=0){const i=e.extent;if(0===r)return Object(u.h)(i,t);const n=Math.min(i[2]-i[0],i[3]-i[1]);return Object(u.j)(i,t,r*n)},tiltToExtentEdge:function(e,t,r){const i=e.extent;b[0]=i[0],b[1]=i[1],b[2]=r,m[0]=i[2],m[1]=i[3],m[2]=r;let n=1/0,s=1/0;return t[0]<b[0]?n=g(t,b,m,0):t[0]>m[0]&&(n=g(t,m,b,0)),t[1]<b[1]?s=g(t,b,m,1):t[1]>m[1]&&(s=g(t,m,b,1)),Math.min(n,s)},checkIfTileInfoSupportedForViewSR:function(e,t,r){if(e.spatialReference.isGeographic)return new o.a("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");const i=h.a.checkUnsupported(e);return i||(function(e,t){const r=e.lods,i=r[0].resolution*2**r[0].level,n=[i*e.size[0],i*e.size[1]],s=[e.origin.x,e.origin.y],a=Object(u.r)(t),l=Object(u.k)();h.a.computeRowColExtent(a,n,s,l);const c=(l[2]-l[0])*(l[3]-l[1]);if(c>d.i){const t=r[0].scale*2**r[0].level;let n=Math.max((a[3]-a[1])/e.size[1],(a[2]-a[0])/e.size[0])*t/i;const s=Math.floor(Math.log(n)/Math.log(10));return n=Math.ceil(n/10**s)*10**s,new o.a("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(t).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+n.toLocaleString()+".",{level0Scale:t,suggestedLevel0Scale:n,requiredNumRootTiles:c,allowedNumRootTiles:d.i})}return null}(e,r)||(t&&!e.spatialReference.equals(t)?new o.a("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null))}}),v=r(36),O=r(43);var j=Object.freeze({__proto__:null,isInsideExtent:function(){return!0},tiltToExtentEdge:function(){return 0},checkIfTileInfoSupportedForViewSR:function(e,t){const r=e.lods.length-1,i=e.spatialReference,n=Object(v.a)(i)||Object(O.h)(i)||Object(O.i)(i);if(i.isWebMercator){if(!h.a.makeWebMercatorAuxiliarySphere(r).compatibleWith(e))return new o.a("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new o.a("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!h.a.makeGCSWithTileSize(e.spatialReference,e.size[0],r).compatibleWith(e))return e.spatialReference.isWGS84?new o.a("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new o.a("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}if(t&&!e.spatialReference.equals(t))return new o.a("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}}),_=r(241);const w={1:j,2:y};function x(e,t){e||console.warn("Terrain: "+t)}const S=80/180*Math.PI,T=110/180*Math.PI;function C(e,t,r){const n=w[e.viewingMode];let s;if(n.isInsideExtent(e,t))s=Object(i.t)(e.getElevation(t[0],t[1],t[1],e.spatialReference),0);else{if(!n.isInsideExtent(e,t,1.2))return 0;const r=e.getTileWithElevation(t[0],t[1],t[1],e.spatialReference);s=.5*((Object(i.j)(r)?r.elevationBounds[0]:e.elevationBounds.min)+(Object(i.j)(r)?r.elevationBounds[1]:e.elevationBounds.max));const a=n.tiltToExtentEdge(e,t,s);if(a>S&&a<T)return 0}const a=t[2]-s;return Math.abs(a)<r?0:a<0?-1:1}function M(e){return E(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function P(e){return"vector-tile"===(null==e?void 0:e.type)}function A(e){return"imagery-tile"===(null==e?void 0:e.type)||"wcs"===(null==e?void 0:e.type)}function E(e){return"imagery-tile-3d"===(null==e?void 0:e.type)}function R(e){return"tile-3d"===(null==e?void 0:e.type)}function I(e){return"vector-tile-3d"===(null==e?void 0:e.type)}function D(e){return"elevation-3d"===(null==e?void 0:e.type)}function F(e){return e&&(R(e)||E(e)||D(e)||I(e)||function(e){return"wmts-3d"===(null==e?void 0:e.type)}(e))}function L(e){var t;return(null==e||null==(t=e.sourceLayerInfo)?void 0:t.data)instanceof a.a}function k(e){var t;return(null==e||null==(t=e.sourceLayerInfo)?void 0:t.data)instanceof n.a}function z(e){var t;return(null==e||null==(t=e.sourceLayerInfo)?void 0:t.data)instanceof _.a}function V(e){var t;const r=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return r instanceof HTMLImageElement||r instanceof s.a||r instanceof HTMLCanvasElement||r instanceof ImageData}function N(e){return Object(i.j)(e)&&"release"in e&&e.release(),null}function U(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function B(e,t,r,i){return w[i].checkIfTileInfoSupportedForViewSR(e,r,t)}function G(e,t,r){let i,n;if("wmts"===e.type){const s=e.activeLayer;if(s){const e=s.tileMatrixSet;if(e)i=e.tileInfo,n=e.fullExtent;else{const e=s.tileMatrixSets;if(e){const i=e.find((e=>null==B(e.tileInfo,e.fullExtent,t,r)));if(i)return{tileInfo:i.tileInfo,fullExtent:i.fullExtent}}}}}else n=A(e)?e.getCompatibleFullExtent(t):e.fullExtent,i=P(e)&&!q.force512VTL?e.compatibleTileInfo256:A(e)?e.getCompatibleTileInfo(t,n,2===r):e.tileInfo;return i&&n&&null==B(i,n,t,r)?{tileInfo:i,fullExtent:n}:{tileInfo:null,fullExtent:null}}const q={force512VTL:!1}},function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return l}));var i=r(201),n=r(3),s=r(5),a=r(34);function o(e){return e?{origin:Object(s.c)(e.origin),direction:Object(s.c)(e.direction)}:{origin:Object(s.e)(),direction:Object(s.e)()}}function l(e,t){const r=f.get();return r.origin=e,r.direction=t,r}function c(e,t=o()){return d(e.origin,e.direction,t)}function u(e,t,r=o()){return Object(n.m)(r.origin,e),Object(n.l)(r.direction,t,e),r}function d(e,t,r=o()){return Object(n.m)(r.origin,e),Object(n.m)(r.direction,t),r}function h(e,t){const r=Object(n.i)(a.c.get(),Object(n.t)(a.c.get(),e.direction),Object(n.l)(a.c.get(),t,e.origin));return Object(n.j)(r,r)}function p(e,t,r){const i=Object(n.j)(e.direction,Object(n.l)(r,t,e.origin));return Object(n.h)(r,e.origin,Object(n.g)(r,e.direction,i)),r}const f=new i.a((function(){return{origin:null,direction:null}}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return g}));r(8);var i=r(7),n=r(101);let s,a=[];const o=i.a.getLogger("esri.core.Accessor");function l(e){void 0!==s&&s.onObservableAccessed(e)}let c=!1,u=!1;function d(e,t,r){if(c)return h(e,t,r);p(e);const i=t.call(r);return f(),i}function h(e,t,r){const i=c;c=!0,p(e);let n=null;try{n=t.call(r)}catch(s){u&&o.error(s)}return f(),c=i,n}function p(e){s=e,a.push(e)}function f(){const e=a.pop();s=a.length>0?a[a.length-1]:void 0,void 0!==e&&e.onTrackingEnd()}function b(e,t){if(32&t.flags)return;const r=u;u=!1,64&t.flags?h(t,t.metadata.get,e):g(e,t),u=r}const m=[];function g(e,t){128&t.flags||(t.flags|=128,h(t,(()=>{const r=t.metadata.dependsOn||m;for(const t of r)if("string"==typeof t&&-1===t.indexOf("."))y(e,t,!1);else{const r=Object(n.f)(t);for(let t=0,i=e;t<r.length&&null!=i&&"object"==typeof i;++t)i=y(i,r[t],t!==r.length-1)}})),t.flags&=-129)}function y(e,t,r){const i="?"===t[t.length-1]?t.slice(0,-1):t;if(null!=e.getItemAt||Array.isArray(e)){const t=parseInt(i,10);if(!isNaN(t))return Array.isArray(e)?e[t]:e.getItemAt(t)}const s=Object(n.a)(e),a=null==s?void 0:s.properties.get(i);return a&&(l(a),b(e,a)),r?e[i]:void 0}},function(e,t,r){"use strict";var i=r(7),n=r(81),s=r(11),a=r(145);const o=i.a.getLogger("esri/views/webgl");function l(e){if(Object(a.b)()){const t=e.getError();if(t){const r=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),i=(new Error).stack;o.error(new s.a("webgl-error","WebGL error occured",{message:r,stack:i}))}}}var c=r(109);const u=i.a.getLogger("esri.views.webgl.BufferObject");class d{constructor(e,t,r,i,n){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(c.b.Buffer,this),this._glName=this._context.gl.createBuffer(),l(this._context.gl),i&&this.setData(i,n)}static createIndex(e,t,r,i){return new d(e,34963,t,r,i)}static createVertex(e,t,r){return new d(e,34962,t,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}dispose(){var e;null!=(e=this._context)&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(c.b.Buffer,this),this._context=null):this._glName&&u.warn("Leaked WebGL buffer object")}setData(e,t){if(!e)return;if("number"==typeof e){if(e<0&&u.error("Buffer size cannot be negative!"),34963===this.bufferType&&t)switch(this._indexType=t,this._size=e,t){case 5123:e*=2;break;case 5125:e*=4}}else{let t=e.byteLength;Object(n.i)(e)&&(t/=2,this._indexType=5123),Object(n.j)(e)&&(t/=4,this._indexType=5125),this._size=t}const r=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;i.bufferData(this.bufferType,e,this.usage),l(i),this._context.bindVAO(r)}setSubData(e,t=0,r=0,i=e.byteLength){if(!e)return;(t<0||t>=this._size)&&u.error("offset is out of range!");let s=t,a=r,o=i,c=e.byteLength;Object(n.i)(e)&&(c/=2,s*=2,a*=2,o*=2),Object(n.j)(e)&&(c/=4,s*=4,a*=4,o*=4),void 0===i&&(i=c-1),r>=i&&u.error("end must be bigger than start!"),t+r-i>this._size&&u.error("An attempt to write beyond the end of the buffer!");const d=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,p=ArrayBuffer.isView(e)?e.buffer:e,f=0===a&&o===e.byteLength?p:p.slice(a,o);h.bufferSubData(this.bufferType,s,f),l(h),this._context.bindVAO(d)}}t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return j})),r.d(t,"e",(function(){return w})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return l})),r.d(t,"h",(function(){return b})),r.d(t,"i",(function(){return a})),r.d(t,"j",(function(){return u})),r.d(t,"k",(function(){return g})),r.d(t,"l",(function(){return o})),r.d(t,"m",(function(){return h})),r.d(t,"n",(function(){return p})),r.d(t,"o",(function(){return c}));var i=r(10),n=r(3),s=r(5);function a(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}function o(e,t){const r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return Object(n.y)(e,r,i,s),e}function l(e,t,r){r=r||e;const i=Object(n.j)(e,t);Object(n.y)(r,e[0]-i*t[0],e[1]-i*t[1],e[2]-i*t[2]),Object(n.t)(r,r)}function c(e,t,r){Math.abs(e[0])>Math.abs(e[1])?Object(n.y)(t,0,1,0):Object(n.y)(t,1,0,0),Object(n.i)(r,e,t),Object(n.t)(t,t),Object(n.i)(t,r,e),Object(n.t)(r,r)}function u(e,t){return(e%t+t)%t}function d(e,t,r,i,n,s){const a=e+(t-e)*n;return a+(r+(i-r)*n-a)*s}function h(e,t,r,i=Object(s.e)()){const a=Object(n.r)(e),o=Object(n.r)(t),l=Object(n.j)(e,t)/(a*o);if(l<.9999999999999999){const s=Math.acos(l),c=((1-r)*a+r*o)/Math.sin(s),u=c/a*Math.sin((1-r)*s),d=c/o*Math.sin(r*s);return Object(n.g)(S,e,u),Object(n.g)(T,t,d),Object(n.h)(i,S,T)}return Object(n.k)(i,e,t,r)}function p(e,t,r,i=Object(s.e)(),a=Object(s.e)()){const o=Object(n.r)(e),l=Object(n.r)(t),c=Object(n.j)(e,t)/(o*l);if(c<.9999999999999999){const s=Math.acos(c),u=Math.sin(s),d=Math.sin(r*s),h=Math.sin((1-r)*s),p=(1-r)*o+r*l;{const r=p/u,s=r/l*d;Object(n.g)(S,e,r/o*h),Object(n.g)(T,t,s),Object(n.h)(i,S,T)}{const i=1/o*(-Math.cos((1-r)*s)*s*p+h*(-o+l));Object(n.g)(S,e,i);const c=1/l*(Math.cos(r*s)*s*p+d*(-o+l));Object(n.g)(T,t,c),Object(n.h)(a,S,T),Object(n.g)(a,a,1/u)}return a}return Object(n.k)(i,e,t,r),Object(n.l)(a,t,e),Object(n.t)(a,a),a}function f(e,t,r){e=Object(n.t)(S,e),t=Object(n.t)(T,t);const s=Object(i.b)(Object(n.j)(e,t));if(r){const i=Object(n.i)(x,e,t);if(Object(n.j)(i,r)<0)return-s}return s}function b(e){const t=e.length;return function(r){if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const n=e[i-1][0],s=e[i][0],a=(s-r)/(s-n);return a*e[i-1][1]+(1-a)*e[i][1]}}class m{constructor(e,t){this.min=e,this.max=t,this.range=t-e}ndiff(e,t=0){return Math.ceil((e-t)/this.range)*this.range+t}_normalize(e,t,r,i=0,n=!1){return(r-=i)<e?r+=this.ndiff(e-r):r>t&&(r-=this.ndiff(r-t)),n&&r===t&&(r=e),r+i}normalize(e,t=0,r=!1){return this._normalize(this.min,this.max,e,t,r)}clamp(e,t=0){return Object(i.e)(e-t,this.min,this.max)+t}monotonic(e,t,r){return e<t?t:t+this.ndiff(e-t,r)}minimalMonotonic(e,t,r){return this._normalize(e,e+this.range,t,r)}center(e,t,r){return t=this.monotonic(e,t,r),this.normalize((e+t)/2,r)}diff(e,t,r){return this.monotonic(e,t,r)-e}shortestSignedDiff(e,t){e=this.normalize(e);const r=(t=this.normalize(t))-e,i=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(r)<Math.abs(i)?r:i}contains(e,t,r){return t=this.minimalMonotonic(e,t),(r=this.minimalMonotonic(e,r))>e&&r<t}}function g(e,t,r,i){Object(n.l)(y,t,e),Object(n.l)(v,r,e),Object(n.i)(i,y,v),Object(n.t)(i,i),i[3]=-Object(n.j)(e,i)}const y=Object(s.e)(),v=Object(s.e)();function O(e){for(const t in e){const r=e[t];r instanceof Function&&(e[t]=r.bind(e))}return e}const j=O(new m(0,2*Math.PI)),_=O(new m(-Math.PI,Math.PI)),w=O(new m(0,360)),x=Object(s.e)(),S=Object(s.e)(),T=Object(s.e)()},function(e,t,r){"use strict";var i=r(0),n=r(19),s=r(180),a=r(4);class o{constructor(){this._emitter=new o.EventEmitter(this)}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}}!function(e){class t{constructor(e=null){this.target=e,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear()}emit(e,t){const r=this._listenersMap&&this._listenersMap.get(e);if(!r)return!1;const i=this.target||this;return[...r].forEach((e=>{e.call(i,t)})),r.length>0}on(e,t){if(Array.isArray(e)){const r=e.map((e=>this.on(e,t)));return Object(s.a)(r)}if(e.indexOf(",")>-1)throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const r=this._listenersMap.get(e)||[];return r.push(t),this._listenersMap.set(e,r),{remove:()=>{const r=this._listenersMap&&this._listenersMap.get(e)||[],i=r.indexOf(t);i>=0&&r.splice(i,1)}}}once(e,t){const r=this.on(e,(e=>{r.remove(),t.call(null,e)}));return r}hasEventListener(e){const t=this._listenersMap&&this._listenersMap.get(e);return null!=t&&t.length>0}}e.EventEmitter=t,e.EventedMixin=e=>{let r=class extends e{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};return r=Object(i.a)([Object(a.a)("esri.core.Evented")],r),r};let r=class extends n.a{constructor(){super(...arguments),this._emitter=new o.EventEmitter(this)}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};r=Object(i.a)([Object(a.a)("esri.core.Evented")],r),e.EventedAccessor=r}(o||(o={}));var l=o;t.a=l},function(e,t,r){"use strict";r.d(t,"a",(function(){return je})),r.d(t,"b",(function(){return Se})),r.d(t,"c",(function(){return we})),r.d(t,"d",(function(){return Re})),r.d(t,"e",(function(){return Ae})),r.d(t,"f",(function(){return Pe})),r.d(t,"g",(function(){return Ee})),r.d(t,"h",(function(){return _e})),r.d(t,"i",(function(){return Me})),r.d(t,"j",(function(){return xe}));var i,n,s=Function.prototype,a=Object.prototype,o=s.toString,l=a.hasOwnProperty,c=o.call(Object),u=a.toString,d=(i=Object.getPrototypeOf,n=Object,function(e){return i(n(e))});var h=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=u.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(r){}return t}(e))return!1;var t=d(e);if(null===t)return!0;var r=l.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&o.call(r)==c},p={exports:{}},f={},b={exports:{}},m={};function g(){var e={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1};return e}var y=/javascript\s*\:/gim;m.whiteList=g(),m.getDefaultWhiteList=g,m.onAttr=function(e,t,r){},m.onIgnoreAttr=function(e,t,r){},m.safeAttrValue=function(e,t){return y.test(t)?"":t};var v={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,n;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,n=e.length;i<n;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}};var O=m,j=function(e,t){";"!==(e=v.trimRight(e))[e.length-1]&&(e+=";");var r=e.length,i=!1,n=0,s=0,a="";function o(){if(!i){var r=v.trim(e.slice(n,s)),o=r.indexOf(":");if(-1!==o){var l=v.trim(r.slice(0,o)),c=v.trim(r.slice(o+1));if(l){var u=t(n,a.length,l,c,r);u&&(a+=u+"; ")}}}n=s+1}for(;s<r;s++){var l=e[s];if("/"===l&&"*"===e[s+1]){var c=e.indexOf("*/",s+2);if(-1===c)break;n=(s=c+1)+1,i=!1}else"("===l?i=!0:")"===l?i=!1:";"===l?i||o():"\n"===l&&o()}return v.trim(a)};function _(e){return void 0===e||null===e}function w(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).whiteList=e.whiteList||O.whiteList,e.onAttr=e.onAttr||O.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||O.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||O.safeAttrValue,this.options=e}w.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,r=t.whiteList,i=t.onAttr,n=t.onIgnoreAttr,s=t.safeAttrValue;return j(e,(function(e,t,a,o,l){var c=r[a],u=!1;if(!0===c?u=c:"function"===typeof c?u=c(o):c instanceof RegExp&&(u=c.test(o)),!0!==u&&(u=!1),o=s(a,o)){var d,h={position:t,sourcePosition:e,source:l,isWhite:u};return u?_(d=i(a,o,h))?a+":"+o:d:_(d=n(a,o,h))?void 0:d}}))};var x=w;!function(e,t){var r=m,i=x;for(var n in(t=e.exports=function(e,t){return new i(t).process(e)}).FilterCSS=i,r)t[n]=r[n]}(b,b.exports);var S={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,n;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,n=e.length;i<n;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}},T=b.exports.FilterCSS,C=b.exports.getDefaultWhiteList,M=S;function P(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var A=new T;function E(e){return e.replace(R,"&lt;").replace(I,"&gt;")}var R=/</g,I=/>/g,D=/"/g,F=/&quot;/g,L=/&#([a-zA-Z0-9]*);?/gim,k=/&colon;?/gim,z=/&newline;?/gim,V=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,N=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,U=/u\s*r\s*l\s*\(.*/gi;function B(e){return e.replace(D,"&quot;")}function G(e){return e.replace(F,'"')}function q(e){return e.replace(L,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function H(e){return e.replace(k,":").replace(z," ")}function W(e){for(var t="",r=0,i=e.length;r<i;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return M.trim(t)}function $(e){return e=W(e=H(e=q(e=G(e))))}function Q(e){return e=E(e=B(e))}var Z=/<!--[\s\S]*?-->/g;f.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},f.getDefaultWhiteList=P,f.onTag=function(e,t,r){},f.onIgnoreTag=function(e,t,r){},f.onTagAttr=function(e,t,r){},f.onIgnoreTagAttr=function(e,t,r){},f.safeAttrValue=function(e,t,r,i){if(r=$(r),"href"===t||"src"===t){if("#"===(r=M.trim(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"data:image/"!==r.substr(0,11)&&"ftp://"!==r.substr(0,6)&&"./"!==r.substr(0,2)&&"../"!==r.substr(0,3)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===t){if(V.lastIndex=0,V.test(r))return""}else if("style"===t){if(N.lastIndex=0,N.test(r))return"";if(U.lastIndex=0,U.test(r)&&(V.lastIndex=0,V.test(r)))return"";!1!==i&&(r=(i=i||A).process(r))}return r=Q(r)},f.escapeHtml=E,f.escapeQuote=B,f.unescapeQuote=G,f.escapeHtmlEntities=q,f.escapeDangerHtml5Entities=H,f.clearNonPrintableCharacter=W,f.friendlyAttrValue=$,f.escapeAttrValue=Q,f.onIgnoreTagStripAll=function(){return""},f.StripTagBody=function(e,t){"function"!==typeof t&&(t=function(){});var r=!Array.isArray(e),i=[],n=!1;return{onIgnoreTag:function(s,a,o){if(function(t){return!!r||-1!==M.indexOf(e,t)}(s)){if(o.isClosing){var l="[/removed]",c=o.position+l.length;return i.push([!1!==n?n:o.position,c]),n=!1,l}return n||(n=o.position),"[removed]"}return t(s,a,o)},remove:function(e){var t="",r=0;return M.forEach(i,(function(i){t+=e.slice(r,i[0]),r=i[1]})),t+=e.slice(r)}}},f.stripCommentTag=function(e){return e.replace(Z,"")},f.stripBlankChar=function(e){var t=e.split("");return(t=t.filter((function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}))).join("")},f.cssFilter=A,f.getDefaultCSSWhiteList=C;var X={},J=S;function Y(e){var t=J.spaceIndex(e);if(-1===t)var r=e.slice(1,-1);else r=e.slice(1,t+1);return"/"===(r=J.trim(r).toLowerCase()).slice(0,1)&&(r=r.slice(1)),"/"===r.slice(-1)&&(r=r.slice(0,-1)),r}function K(e){return"</"===e.slice(0,2)}var ee=/[^a-zA-Z0-9_:\.\-]/gim;function te(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"="===r?t:-1}}function re(e,t){for(;t>0;t--){var r=e[t];if(" "!==r)return"="===r?t:-1}}function ie(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}X.parseTag=function(e,t,r){var i="",n=0,s=!1,a=!1,o=0,l=e.length,c="",u="";e:for(o=0;o<l;o++){var d=e.charAt(o);if(!1===s){if("<"===d){s=o;continue}}else if(!1===a){if("<"===d){i+=r(e.slice(n,o)),s=o,n=o;continue}if(">"===d){i+=r(e.slice(n,s)),c=Y(u=e.slice(s,o+1)),i+=t(s,i.length,c,u,K(u)),n=o+1,s=!1;continue}if('"'===d||"'"===d)for(var h=1,p=e.charAt(o-h);""===p.trim()||"="===p;){if("="===p){a=d;continue e}p=e.charAt(o-++h)}}else if(d===a){a=!1;continue}}return n<e.length&&(i+=r(e.substr(n))),i},X.parseAttr=function(e,t){var r=0,i=[],n=!1,s=e.length;function a(e,r){if(!((e=(e=J.trim(e)).replace(ee,"").toLowerCase()).length<1)){var n=t(e,r||"");n&&i.push(n)}}for(var o=0;o<s;o++){var l,c=e.charAt(o);if(!1!==n||"="!==c)if(!1===n||o!==r||'"'!==c&&"'"!==c||"="!==e.charAt(o-1))if(/\s|\n|\t/.test(c)){if(e=e.replace(/\s|\n|\t/g," "),!1===n){if(-1===(l=te(e,o))){a(J.trim(e.slice(r,o))),n=!1,r=o+1;continue}o=l-1;continue}if(-1===(l=re(e,o-1))){a(n,ie(J.trim(e.slice(r,o)))),n=!1,r=o+1;continue}}else;else{if(-1===(l=e.indexOf(c,o+1)))break;a(n,J.trim(e.slice(r+1,l))),n=!1,r=(o=l)+1}else n=e.slice(r,o),r=o+1}return r<e.length&&(!1===n?a(e.slice(r)):a(n,ie(J.trim(e.slice(r))))),J.trim(i.join(" "))};var ne=b.exports.FilterCSS,se=f,ae=X,oe=ae.parseTag,le=ae.parseAttr,ce=S;function ue(e){return void 0===e||null===e}function de(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=se.onIgnoreTagStripAll),e.whiteList=e.whiteList||se.whiteList,e.onTag=e.onTag||se.onTag,e.onTagAttr=e.onTagAttr||se.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||se.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||se.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||se.safeAttrValue,e.escapeHtml=e.escapeHtml||se.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new ne(e.css))}de.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,r=t.whiteList,i=t.onTag,n=t.onIgnoreTag,s=t.onTagAttr,a=t.onIgnoreTagAttr,o=t.safeAttrValue,l=t.escapeHtml,c=this.cssFilter;t.stripBlankChar&&(e=se.stripBlankChar(e)),t.allowCommentTag||(e=se.stripCommentTag(e));var u=!1;if(t.stripIgnoreTagBody){u=se.StripTagBody(t.stripIgnoreTagBody,n);n=u.onIgnoreTag}var d=oe(e,(function(e,t,u,d,h){var p,f={sourcePosition:e,position:t,isClosing:h,isWhite:r.hasOwnProperty(u)};if(!ue(p=i(u,d,f)))return p;if(f.isWhite){if(f.isClosing)return"</"+u+">";var b=function(e){var t=ce.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=ce.trim(e.slice(t+1,-1)))[e.length-1];return r&&(e=ce.trim(e.slice(0,-1))),{html:e,closing:r}}(d),m=r[u],g=le(b.html,(function(e,t){var r,i=-1!==ce.indexOf(m,e);return ue(r=s(u,e,t,i))?i?(t=o(u,e,t,c))?e+'="'+t+'"':e:ue(r=a(u,e,t,i))?void 0:r:r}));d="<"+u;return g&&(d+=" "+g),b.closing&&(d+=" /"),d+=">"}return ue(p=n(u,d,f))?l(d):p}),l);return u&&(d=u.remove(d)),d};var he=de;!function(e,t){var r=f,i=X,n=he;function s(e,t){return new n(t).process(e)}for(var a in(t=e.exports=s).filterXSS=s,t.FilterXSS=n,r)t[a]=r[a];for(var a in i)t[a]=i[a];"undefined"!==typeof self&&"undefined"!==typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}(p,p.exports);var pe,fe,be=function(){function e(e,t){var r,i=this;this.arcgisWhiteList={a:["href","target","style"],abbr:["title"],img:["src","width","height","border","alt","style"],video:["autoplay","controls","height","loop","muted","poster","preload","width"],audio:["autoplay","controls","loop","muted","preload"],source:["media","src","type"],span:["style"],table:["width","height","cellpadding","cellspacing","border","style"],div:["style","align"],font:["size","color","style"],tr:["height","valign","align","style"],td:["height","width","valign","align","colspan","rowspan","nowrap","style"],th:["height","width","valign","align","colspan","rowspan","nowrap","style"],p:["style"],b:[],strong:[],i:[],em:[],u:[],br:[],li:[],ul:[],ol:[],hr:[],tbody:[]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(e,t,r,n){return"a"===e&&"href"===t||("img"===e||"source"===e)&&"src"===t?i.sanitizeUrl(r):p.exports.safeAttrValue(e,t,r,n)}},e&&!t?r=e:e&&t?(r=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach((function(t){"whiteList"===t?r.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):r[t]=e[t]}))):(r=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,this.xssFilterOptions=r,this._xssFilter=new p.exports.FilterXSS(r)}return e.prototype.sanitize=function(e,t){switch(void 0===t&&(t={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,t);default:if(t.allowUndefined&&"undefined"===typeof e)return;return null}},e.prototype.sanitizeUrl=function(e){var t=this._trim(e.substring(0,e.indexOf(":")));return"/"===e||"#"===e||"#"===e[0]||this.allowedProtocols.indexOf(t.toLowerCase())>-1?p.exports.escapeAttrValue(e):""},e.prototype.sanitizeHTMLAttribute=function(e,t,r,i){return"function"===typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(e,t,r,i):p.exports.safeAttrValue(e,t,r,i)},e.prototype.validate=function(e,t){void 0===t&&(t={});var r=this.sanitize(e,t);return{isValid:e===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(r){Array.isArray(e[r])&&Array.isArray(t[r])?t[r]=t[r].concat(e[r]):t[r]=e[r]}))})),t},e.prototype._iterateOverObject=function(e,t){var r=this;void 0===t&&(t={});try{var i=!1,n=void 0;if(Array.isArray(e))n=e.reduce((function(e,n){var s=r.validate(n,t);return s.isValid?e.concat([n]):(i=!0,e.concat([s.sanitized]))}),[]);else{if(!h(e)){if(t.allowUndefined&&"undefined"===typeof e)return;return null}n=Object.keys(e).reduce((function(n,s){var a=e[s],o=r.validate(a,t);return o.isValid?n[s]=a:(i=!0,n[s]=o.sanitized),n}),{})}return i?n:e}catch(s){return null}},e.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},e}(),me=r(173),ge=(r(8),r(7)),ye=function(e){pe||function(e){if("WebkitTransition"in e.style)pe="webkitTransitionEnd",fe="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");pe="transitionend",fe="animationend"}}(e)},ve=function(e,t){return void 0===t&&(t=e+"-active"),function(r){ye(r);var i=!1,n=function(s){i||(i=!0,r.removeEventListener(pe,n),r.removeEventListener(fe,n),r.classList.remove(e),r.classList.remove(t))};r.classList.add(e),r.addEventListener(pe,n),r.addEventListener(fe,n),requestAnimationFrame((function(){r.classList.add(t)}))}},Oe=function(e,t){return void 0===t&&(t=e+"-active"),function(r,i){ye(r);var n=!1,s=function(e){n||(n=!0,r.removeEventListener(pe,s),r.removeEventListener(fe,s),i())};r.classList.add(e),r.addEventListener(pe,s),r.addEventListener(fe,s),requestAnimationFrame((function(){r.classList.add(t)}))}};function je(e){const t=me.a.acquire();for(let i=0;i<arguments.length;i++){const e=arguments[i],r=typeof e;if("string"===r)t.push(e);else if(Array.isArray(e))t.push.apply(t,e);else if("object"===r)for(const i in e)e[i]&&t.push(i)}const r=t.join(" ");return me.a.release(t),r}function _e(){return"rtl"===document.dir}function we(e){this[e.getAttribute("data-node-ref")]=null}function xe(e){this[e.getAttribute("data-node-ref")]=e}function Se(e,t){return("enter"===e?ve:Oe)(t)}ge.a.getLogger("esri.widgets.support.widgetUtils");const Te=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((e,t)=>(e[t]=[],e)),{}),Ce=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Me=new be({whiteList:Te,onTagAttr:(e,t,r)=>{const i=`${t}="${r}"`;if(Ce.includes(t))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function Pe(e){return"Enter"===e||" "===e}function Ae(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function Ee(){return Ae().startsWith("dark")}function Re(){return"calcite-theme-"+(Ee()?"dark":"light")}},function(e,t,r){"use strict";var i=r(0),n=r(19),s=r(1),a=(r(8),r(9),r(7),r(4));let o=class extends n.a{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,this.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,this.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.ENABLE_PROFILE_DEPTH_RANGE=!1,this.DISABLE_FAST_UPDATES=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1}};Object(i.a)([Object(s.b)()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(i.a)([Object(s.b)()],o.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(i.a)([Object(s.b)()],o.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(i.a)([Object(s.b)()],o.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(i.a)([Object(s.b)()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(i.a)([Object(s.b)()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(i.a)([Object(s.b)()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(i.a)([Object(s.b)()],o.prototype,"LABELS_SHOW_BORDER",void 0),Object(i.a)([Object(s.b)()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(i.a)([Object(s.b)()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(i.a)([Object(s.b)()],o.prototype,"SHOW_POI",void 0),Object(i.a)([Object(s.b)()],o.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),Object(i.a)([Object(s.b)()],o.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),Object(i.a)([Object(s.b)()],o.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),Object(i.a)([Object(s.b)()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(i.a)([Object(s.b)()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(i.a)([Object(s.b)()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(i.a)([Object(s.b)()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(i.a)([Object(s.b)()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(i.a)([Object(s.b)()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(i.a)([Object(s.b)()],o.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),Object(i.a)([Object(s.b)()],o.prototype,"DISABLE_FAST_UPDATES",void 0),Object(i.a)([Object(s.b)()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(i.a)([Object(s.b)()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(i.a)([Object(s.b)()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),o=Object(i.a)([Object(a.a)("esri.views.3d.support.DebugFlags")],o);const l=new o;t.a=l},function(e,t,r){"use strict";r.d(t,"a",(function(){return Oe})),r.d(t,"b",(function(){return ve})),r.d(t,"c",(function(){return oe})),r.d(t,"d",(function(){return ne})),r.d(t,"e",(function(){return ee})),r.d(t,"f",(function(){return ae})),r.d(t,"g",(function(){return se})),r.d(t,"h",(function(){return ue})),r.d(t,"i",(function(){return le})),r.d(t,"j",(function(){return K})),r.d(t,"k",(function(){return re})),r.d(t,"l",(function(){return ie})),r.d(t,"m",(function(){return ye})),r.d(t,"n",(function(){return me})),r.d(t,"o",(function(){return de})),r.d(t,"p",(function(){return ge}));var i=r(157),n=r(7),s=r(10),a=r(2),o=r(12),l=r(3),c=r(5),u=r(41),d=r(36),h=r(53),p=r(39),f=r(465),b=r(162),m=r(16),g=r(20),y=r(50),v=r(332);const O=Object(c.g)(0,1,0),j=Object(c.g)(0,0,1),_=Object(g.d)(),w=Object(c.e)(),x=Object(c.e)();function S(e,t,r,i=Object(v.a)()){Object(m.i)(_);const{direction:n,up:a}=i;return Object(m.r)(_,_,-Object(s.g)(t)),Object(m.b)(_,_,Object(s.g)(r)),Object(l.s)(n,j,_),Object(l.g)(n,n,-1),Object(l.s)(a,O,_),i}function T(e,t,r,i,n){const s=e.renderSpatialReference,a=e.map&&e.spatialReference||t.spatialReference;return Object(d.u)(t,w,s),Object(d.u)(t,x,s),w[0]-=r/2,x[0]+=r/2,w[1]-=i/2,x[1]+=i/2,Object(d.z)(w,s,w,a),Object(d.z)(x,s,x,a),n?(n.xmin=w[0],n.ymin=w[1],n.xmax=x[0],n.ymax=x[1],n.spatialReference=a):n=new y.a(w[0],w[1],x[0],x[1],a),n}var C=Object.freeze({__proto__:null,headingTiltToDirectionUp:S,directionToHeadingTilt:function(e,t,r,i){return Object(v.b)(t,r,i,j,O)},eyeForCenterWithHeadingTilt:function(e,t,r,i){const n=S(0,r,i),s=Object(c.e)();return Object(l.g)(s,n.direction,-t),Object(l.h)(s,s,e),{up:n.up,eye:s,heading:r,tilt:i}},lookAtTiltToEyeTilt:function(e){return Object(s.r)(e)},eyeTiltToLookAtTilt:function(e){return Object(s.g)(e)},toExtent:T}),M=r(46),P=r(358),A=r(67);const E=Object(c.g)(0,0,1),R=Object(l.t)(Object(c.e)(),Object(c.g)(1,1,1)),I=new A.a(-180,180),D=Object(g.d)(),F=Object(c.e)(),L=Object(c.e)();function k(e,t,r,i=Object(v.a)()){Object(l.i)(F,e,E),0===Object(l.j)(F,F)&&Object(l.i)(F,e,R),Object(m.i)(D),Object(m.c)(D,D,-Object(s.g)(t),e),Object(m.c)(D,D,-Object(s.g)(r),F);const{up:n,direction:a}=i;return Object(l.i)(n,F,e),Object(l.t)(n,n),Object(l.s)(n,n,D),Object(l.t)(a,e),Object(l.u)(a,a),Object(l.s)(a,a,D),i}function z(e){const t=e[1];e[1]=-e[2],e[2]=t}function V(e,t){const r=k(t,e.heading,e.tilt);return e.up=r.up,e}function N(e,t,r,i,n){let a,o,l,c;const u=t.latitude,d=t.longitude,f=Object(P.b)(u,r,Object(h.e)(e.spatialReference).radius)/2;a=d-f,o=d+f;const b=Object(s.g)(u),m=Object(h.e)(e.spatialReference).radius,g=(1+Math.sin(b))/(1-Math.sin(b)),v=(g+1)*Math.tan(i/m/2),O=v*v;function j(e){const t=Math.PI/2;return(e=A.d.normalize(e,-t))>t&&(e=Math.PI-e),e}if(l=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*g+O))),c=l+i/m,l=j(l),c=j(c),c<l){const e=c;c=l,l=e}if(l=Math.max(Object(s.r)(l),-90),c=Math.min(Object(s.r)(c),90),o=I.monotonic(a,o),o-a>180){const e=(o-a-180)/2;a+=e,o-=e}const _=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:p.a.WGS84;return n?(n.xmin=a,n.ymin=l,n.xmax=o,n.ymax=c,n.spatialReference=_):n=new y.a(a,l,o,c,_),e.spatialReference&&e.spatialReference.isWebMercator&&Object(M.b)(n,!1,n),n}var U=Object.freeze({__proto__:null,headingTiltToDirectionUp:k,directionToHeadingTilt:function(e,t,r,i){const n=F,s=L;return Object(l.t)(n,e),Object(l.i)(L,n,E),0===Object(l.j)(L,L)&&Object(l.i)(L,n,R),Object(l.i)(s,L,n),Object(v.b)(t,r,i,n,s)},eyeForCenterWithHeadingTilt:function(e,t,r,i){const n={eye:Object(c.e)(),up:null,tilt:i,heading:r},a=F;a[0]=e[0],a[1]=e[2],a[2]=-e[1];const o=t,u=Object(s.g)(r),d=Object(s.g)(i),h=Math.sin(u),p=Math.cos(u),f=Math.sin(d),b=Math.cos(d),m=Object(l.r)(a);let g;if(Math.abs(d)<1e-8)g=o+m;else{const e=m/f,t=Object(s.c)(o/e),r=Math.PI-d-t;g=e*Math.sin(r)}const y=b*o,v=o*o*(f*f),O=p*p*v,j=g-y,_=j*j,w=O*(O+_-a[1]*a[1]);if(w<0)return Object(l.g)(n.eye,a,g/m),n.tilt=0,n;const x=Math.sqrt(w),S=a[1]*j,T=O+_;let C;if(C=p>0?-x+S:x+S,Math.abs(T)<1e-8)return m<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):Object(l.g)(n.eye,a,g/m),n.tilt=0,z(n.eye),V(n,e);n.eye[1]=C/T;const M=h*h*v,P=f*o,A=p*P*n.eye[1],E=n.eye[1]*n.eye[1],R=1-E,I=Math.sqrt(R),D=O*E+M-2*A*I*j+R*_;return Math.abs(D)<1e-8?(Object(l.g)(n.eye,a,g/m),n.tilt=0,z(n.eye),V(n,e)):(n.eye[0]=(R*(g*a[0]-y*a[0])-P*I*(a[0]*n.eye[1]*p+a[2]*h))/D,n.eye[2]=(R*(g*a[2]-y*a[2])-P*I*(a[2]*n.eye[1]*p-a[0]*h))/D,Object(l.g)(n.eye,n.eye,g),z(n.eye),V(n,e))},lookAtTiltToEyeTilt:function(e,t,r){const i=Object(l.r)(t),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-e)),a=Object(s.c)(r/(n/Math.sin(e)));return Object(s.r)(e-a)},eyeTiltToLookAtTilt:function(e,t,r){const i=Object(s.g)(e),n=Object(l.r)(t);return Object(s.c)(r/(n/Math.sin(i)))+i},toExtent:N}),B=r(148),G=r(330);const q=n.a.getLogger("esri.views.3d.support.cameraUtils"),H=Object(c.e)(),W=Object(c.e)(),$={heading:0,tilt:0},Q=new u.a,Z=new A.a(-20037508.342788905,20037508.342788905),X=new A.a(-180,180);function J(e){return e.spatialReference||p.a.WGS84}function Y(e){return"global"===e.viewingMode?U:C}function K(e,t,r,i,n){return Y(e).headingTiltToDirectionUp(t,r,i,n)}function ee(e,t){if(Object(a.i)(t))return null;const r=e.renderSpatialReference,i=Y(e).headingTiltToDirectionUp,n=Object(c.e)();if(!Object(d.u)(t.position,n,r))return null;const o=i(n,t.heading,t.tilt);Object(l.g)(o.direction,o.direction,e.state.camera.distance),Object(l.h)(o.direction,o.direction,n);const u=Object(b.a)(e,n,o.direction,o.up);return u.fov=Object(s.g)(t.fov),u}const te=Object(c.e)();function re(e,t,r){const n=e.renderSpatialReference,o=oe(e,t.eye,t.viewForward,t.up,$);let l=J(e);return Object(d.z)(t.eye,n,te,l)||(l=p.a.WGS84,Object(d.z)(t.eye,n,te,l)),Object(a.i)(r)?new i.a(new u.a(te,l),o.heading,o.tilt,Object(s.r)(t.fov)):(r.position.x=te[0],r.position.y=te[1],r.position.z=te[2],r.position.spatialReference=l,r.heading=o.heading,r.tilt=o.tilt,r.fov=Object(s.r)(t.fov),r)}function ie(e,t,r){const i=e.state.camera,n=i.width/2/i.pixelRatio;return 1===e.renderCoordsHelper.viewingMode&&null!=r&&(t*=Math.cos(Object(s.g)(r))),n/(96*39.37/(t/=e.renderCoordsHelper.unitInMeters))/Math.tan(i.fovX/2)}function ne(e,t,r){const i=e.state.camera,n=t*Math.tan(i.fovX/2);let a=96*39.37/(i.width/2/i.pixelRatio/n);return 1===e.renderCoordsHelper.viewingMode&&(a/=Math.cos(Object(s.g)(r))),a*=e.renderCoordsHelper.unitInMeters,a}function se(e,t,r,i,n,s){return ae(e,t,ie(e,r,t.latitude),i,n,s)}function ae(e,t,r,i,n,s){if(je(s)){const o=new Oe(s.signal);return le(e,i.heading,i.tilt,t,r,n,o),void o.resolver.promise.then((t=>{const r=be(e,t,i.fov);if(!Object(a.i)(r))return s.resolver.resolve(r);s.resolver.reject()}),(e=>s.resolver.reject(e)))}const o=le(e,i.heading,i.tilt,t,r,n);return be(e,o,i.fov,s)}function oe(e,t,r,i,n){return Y(e).directionToHeadingTilt(t,r,i,n)}function le(e,t,r,i,n,s,o){const h=i&&i instanceof u.a?i:null;if(je(o))return async function(e,t,r){const i=Object(c.e)();if(t)if(t instanceof u.a){if(Object(d.u)(t,i,e.renderSpatialReference),null==t.z&&null!=e.basemapTerrain){const n=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",r);return Object(a.j)(n)&&e.renderCoordsHelper.setAltitude(i,n),i}}else Object(l.m)(i,t);else Object(l.m)(i,e.state.camera.center);return i}(e,i,o.signal).then((i=>{ce(e,t,r,h,i,n,s,o)}),(e=>o.resolver.reject(e))),null;const p=function(e,t){const r=Object(c.e)();if(t&&t instanceof u.a){if(Object(d.u)(t,r,e.renderSpatialReference),null==t.z&&null!=e.basemapTerrain){const i=Object(B.b)(e.elevationProvider,t);Object(a.j)(i)&&e.renderCoordsHelper.setAltitude(r,i)}}else Object(l.m)(r,t||e.state.camera.center);return r}(e,i);return ce(e,t,r,h,p,n,s,o)}function ce(e,t,r,i,n,s,o,l){if(Object(a.i)(i)){const t=e.renderSpatialReference;if(i=Object(d.y)(n,t,J(e)),Object(a.i)(i))return null}s=Math.max(s,e.state.constraints.minimumPoiDistance);const u=function(e,t,r,i,n,s){let o=0;return 1===s&&function(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>8)return!0;const n=e.renderSpatialReference,s=J(e),o=Object(d.y)(t,n,s),l=Object(d.y)(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(Object(a.i)(o)||Object(a.i)(l))return!1;const c=Math.tan(.5*e.state.camera.fov)*i;return l.distance(o)/c>5}(e,i,n)?(t=0,o=function(e,t,r,i){const n=e.state.constraints.tilt(t);n.max=Math.min(n.max,.5*Math.PI);const s=n.min*(1-he)+n.max*he,a=fe(e,i,t,r);return Math.min(a,s)}(e,n,r,i)):o=fe(e,i,n,r),o=e.state.constraints.clampTilt(n,o),{heading:t,tilt:r=pe(e,i,n,o)}}(e,t,r,n,s,o),h=(0,Y(e).eyeForCenterWithHeadingTilt)(n,s,u.heading,u.tilt);if(1===o&&"global"===e.viewingMode&&r>0){const u=()=>{const a=pe(e,n,s,function(e,t,r,i){const n=e.state.constraints.tilt(t);let s=fe(e,i,t,r);return s=Math.min(s,.5*Math.PI),n.min*(1-he)+s*he}(e,s,r,n));return ce(e,t,a,i,n,s,o=r-a<1?0:1,l)},d=e.map.ground.navigationConstraint;if(!d||"stay-above"===d.type){if(function(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Q,e.spatialReference)&&Object(a.t)(Object(B.b)(e.elevationProvider,Q),0)>Q.z-1)}(e,h.eye))return u();if(je(l))return async function(e,t,r){if(!e.renderCoordsHelper.fromRenderCoords(t,Q,e.spatialReference))return!1;const i=await e.elevationProvider.queryElevation(Q.x,Q.y,Q.z,Q.spatialReference,"ground",r);return Object(a.t)(i,0)>Q.z-1}(e,h.eye,l.signal).then((e=>e?u():(l.resolver.resolve({eye:h.eye,up:h.up,center:Object(c.c)(n),heading:h.heading,tilt:h.tilt}),null))),null}}const p=!l||je(l)?{center:Object(c.e)(),eye:Object(c.e)(),up:Object(c.e)(),tilt:0,heading:0}:l;return p.eye=h.eye,p.up=h.up,p.center=Object(c.c)(n),p.heading=h.heading,p.tilt=h.tilt,je(l)&&l.resolver.resolve(p),p}function ue(e,t,r,i,n,s=null){let o,l,c,d,p=0;if(null!=t.zmax&&null!=t.zmin&&(o=(t.zmax+t.zmin)/2,p=t.zmax-t.zmin),"global"===e.viewingMode){if(!Object(G.a)(t.spatialReference,"global"))return je(s)&&s.resolver.reject(),null;const e=new u.a(t.xmin,t.ymin,t.spatialReference),r=new u.a(t.xmax,t.ymax,t.spatialReference),i=t.spatialReference.isGeographic?X:Z;l=new u.a(i.center(e.x,r.x),(r.y+e.y)/2,t.spatialReference),null!=o&&(l.z=o);const n=Object(h.e)(t.spatialReference),a=Object(P.a)(l,e,r);c=a.lon,d=a.lat,i.diff(e.x,r.x)>i.range/2&&(c+=n.halfCircumference),c=Math.min(c,n.halfCircumference),d=Math.min(d,n.halfCircumference)}else{const r=J(e);c=t.xmax-t.xmin,d=t.ymax-t.ymin,l=new u.a({x:t.xmin+.5*c,y:t.ymin+.5*d,z:o,spatialReference:r})}const f=e.state.camera,b=1/Math.tan(f.fovX/2),m=1/Math.tan(f.fovY/2),g=1/Math.tan(f.fov/2),y=Math.max(.5*c*b,.5*d*m,.5*p*g)/1;if(je(s)){const t=new Oe(s.signal);return le(e,r,i,l,y,n,t),void t.resolver.promise.then((t=>{const r=be(e,t,e.camera.fov);if(!Object(a.i)(r))return s.resolver.resolve(r);s.resolver.reject()}),(e=>s.resolver.reject(e)))}const v=le(e,r,i,l,y,n);return be(e,v,e.camera.fov,s)}function de(e,t,r){const i=e.renderSpatialReference,n=Object(d.y)(r,i,J(e));if(Object(a.i)(n))return null;const s=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),c=Object(l.p)(t.eye,r),u=2*c*s*1,h=2*c*o*1;return"global"===e.viewingMode?N(e,n,u,h):T(e,n,u,h)}const he=.7;function pe(e,t,r,i){return Y(e).lookAtTiltToEyeTilt(i,t,r)}function fe(e,t,r,i){return Y(e).eyeTiltToLookAtTilt(i,t,r)}function be(e,t,r,n){if(Object(a.i)(t))return null;const s=e.renderSpatialReference,o=Object(d.y)(t.eye,s,J(e));return Object(a.i)(o)?null:Object(a.j)(n)?(n.position=o,n.heading=t.heading,n.tilt=t.tilt,n.fov=r,n):new i.a(o,t.heading,t.tilt,r)}function me(e,t){var r;const i=null==(r=e.basemapTerrain)?void 0:r.tilingScheme;if(i)return i.levelAtScale(t);q.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function ge(e,t){var r;const i=null==(r=e.basemapTerrain)?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(t);q.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function ye(e,t){return e.spatialReference?Object(f.a)(t,e.spatialReference):void 0}function ve(e,t,r){const n=e.renderSpatialReference;let s,a;t||(t=e.state.camera);const o=p.a.WGS84;return t instanceof i.a?(s=t.position.latitude,Object(d.u)(t.position,H,n),Object(d.u)(r,W,n),a=Object(l.o)(H,W)):(Object(d.z)(t.center,n,W,o),s=W[1],a=t.distance),ne(e,a,s)}class Oe{constructor(e){this.signal=e,this.resolver=Object(o.h)()}}function je(e){return e&&"resolver"in e}},function(e,t,r){"use strict";var i=r(7),n=r(10),s=r(2),a=r(17),o=r(16),l=r(20),c=r(18),u=r(27),d=r(3),h=r(5),p=r(40),f=r(31),b=r(105),m=r(64),g=r(198),y=r(33);const v=i.a.getLogger("esri.views.3d.webgl-engine.lib.Camera");class O{constructor(e=null,t=null,r=null){this._viewUp=Object(h.e)(),this._viewForward=Object(h.e)(),this._viewRight=Object(h.e)(),this._ray=Object(m.c)(),this._viewport=Object(f.g)(0,0,1,1),this._padding=Object(f.g)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(u.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(l.d)(),this._projectionDirty=!0,this._projectionMatrix=Object(l.d)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(l.d)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(l.d)(),this._frustumDirty=!0,this._frustum=Object(b.c)(),this._fullViewport=Object(f.e)(),this.pixelRatio=1,this.relativeElevation=0,Object(s.j)(e)&&Object(d.m)(this._ray.origin,e),this._center=Object(s.j)(t)?Object(h.c)(t):Object(h.e)(),this._up=Object(s.j)(r)?Object(h.c)(r):Object(h.g)(0,0,1)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return Object(d.l)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(o.d)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(e){this.width=e-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(e){this.height=e-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(p.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(o.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this.aspect;Object(o.k)(this._projectionMatrix,-i*(1+2*this._padding[3]/e),i*(1+2*this._padding[1]/e),-r*(1+2*this._padding[2]/t),r*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(e){Object(o.d)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(y.b)(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(y.d)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(y.c)(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(y.e)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(d.o)(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(o.a)(this._viewInverseTransposeMatrix,this.viewMatrix),Object(o.e)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){Object(d.m)(this._ray.origin,e.eye),Object(d.m)(this._center,e.center),Object(d.m)(this._up,e.up),Object(p.c)(this._viewport,e.viewport),Object(p.c)(this._padding,e.padding),Object(c.c)(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(o.d)(this._viewMatrix,e.viewMatrix),Object(d.m)(this._viewRight,e.viewRight),Object(d.m)(this._viewUp,e.viewUp),Object(d.m)(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(o.d)(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(b.b)(e.frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(o.d)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(p.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new O).copyFrom(this)}equals(e){return Object(d.q)(this.eye,e.eye)&&Object(d.q)(this._center,e.center)&&Object(d.q)(this._up,e.up)&&Object(p.g)(this._viewport,e.viewport)&&Object(p.g)(this._padding,e.padding)&&Object(c.k)(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4;Object(d.C)(w,e.eye,e.center),Object(d.C)(x,this.eye,this._center);const r=Object(d.j)(w,x),i=Object(d.D)(w),n=Object(d.D)(x);return r*r>=(1-1e-10)*i*n&&Object(d.E)(e.eye,this.eye)<Math.max(i,n)*t*t&&Object(p.i)(e.padding,this._padding)<.5&&Object(p.i)(e.viewport,this._viewport)<.5}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}viewDirectionDistance(e){return Math.abs(Object(g.c)(this.viewForward,Object(d.l)(w,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(a.f)()){return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e||(e=Object(a.d)()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*r,e.length>2&&(e[2]=.5),e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t,r=!1){e!==j&&Object(d.m)(j,e),j[3]=1,r&&(t[2]=-j[2]),Object(p.m)(j,j,this.projectionMatrix),Object(d.g)(j,j,1/Math.abs(j[3]));const i=this.fullViewport;return t[0]=Object(n.m)(0,i[0]+i[2],.5+.5*j[0]),t[1]=Object(n.m)(0,i[1]+i[3],.5+.5*j[1]),r||(t[2]=.5*(j[2]+1)),t}projectToScreen(e,t){this.projectToRenderScreen(e,S),this.renderToScreen(S,t)}projectToRenderScreen(e,t){if(j[0]=e[0],j[1]=e[1],j[2]=e[2],j[3]=1,Object(p.m)(j,j,this.viewProjectionMatrix),0===j[3])return null;Object(d.g)(j,j,1/Math.abs(j[3]));const r=this.fullViewport;return"x"in t?(t.x=Object(n.m)(0,r[0]+r[2],.5+.5*j[0]),t.y=Object(n.m)(0,r[1]+r[3],.5+.5*j[1])):(t[0]=Object(n.m)(0,r[0]+r[2],.5+.5*j[0]),t[1]=Object(n.m)(0,r[1]+r[3],.5+.5*j[1]),t.length>2&&(t[2]=.5*(j[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,S),t)}unprojectFromRenderScreen(e,t){if(Object(o.m)(_,this.projectionMatrix,this.viewMatrix),!Object(o.a)(_,_))return null;const r=this.fullViewport;return j[0]=2*(e[0]-r[0])/r[2]-1,j[1]=2*(e[1]-r[1])/r[3]-1,j[2]=2*e[2]-1,j[3]=1,Object(p.m)(j,j,_),0===j[3]?null:(t[0]=j[0]/j[3],t[1]=j[1]/j[3],t[2]=j[2]/j[3],t)}constrainWindowSize(e,t,r,i=r){const n=e*this.pixelRatio,s=t*this.pixelRatio,a=Math.max(n-r/2,0),o=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0);return[a,o,r-l- -Math.min(this.fullWidth-n-r/2,0),i-c- -Math.min(s-i/2,0)]}computeUp(e){1===e?this.computeUpGlobal():this.computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}computeUpGlobal(){Object(d.l)(w,this.center,this.eye);const e=Object(d.r)(this.center);e<1?(Object(d.y)(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(d.j)(w,this.center))>.9999*Object(d.r)(w)*e||(Object(d.i)(this._up,w,this.center),Object(d.i)(this._up,this._up,w),Object(d.t)(this._up,this._up),this._markViewDirty())}computeUpLocal(){Object(d.x)(w,this.eye,this.center),Math.abs(w[2])<=.9999&&(Object(d.g)(w,w,w[2]),Object(d.y)(this._up,-w[0],-w[1],1-w[2]),Object(d.t)(this._up,this._up),this._markViewDirty())}_compareAndSetView(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(d.q)(e,t)||(Object(d.m)(t,e),this._markViewDirty()):v.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Object(b.e)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(o.l)(this._viewMatrix,this.eye,this._center,this._up),Object(d.y)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(d.y)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(d.y)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const j=Object(f.e)(),_=Object(l.d)(),w=Object(h.e)(),x=Object(h.e)(),S=Object(a.d)();t.a=O},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));const i=r(7).a.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class n{constructor(){this.includedModules=new Map}include(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&i.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))}}class s extends n{constructor(){super(...arguments),this.vertex=new l,this.fragment=new l,this.attributes=new c,this.varyings=new u,this.extensions=new d,this.constants=new h}get fragmentUniforms(){return this.fragment.uniforms}get builder(){return this}generateSource(e){const t=this.extensions.generateSource(e),r=this.attributes.generateSource(e),i=this.varyings.generateSource(),n="vertex"===e?this.vertex:this.fragment,s=n.uniforms.generateSource(),a=n.code.generateSource(),o="vertex"===e?f:p,l=this.constants.generateSource().concat(n.constants.generateSource());return`\n${t.join("\n")}\n\n${o}\n\n${l.join("\n")}\n\n${s.join("\n")}\n\n${r.join("\n")}\n\n${i.join("\n")}\n\n${a.join("\n")}`}}class a{constructor(){this._entries=new Map}add(e,t,r){const i=`${e}_${t}_${r}`;return this._entries.set(i,{name:e,type:t,arraySize:r}),this}generateSource(){return Array.from(this._entries.values()).map((e=>`uniform ${e.type} ${e.name}${(e=>e?`[${e}]`:"")(e.arraySize)};`))}get entries(){return Array.from(this._entries.values())}}class o{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class l extends n{constructor(){super(...arguments),this.uniforms=new a,this.code=new o,this.constants=new h}get builder(){return this}}class c{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`attribute ${e[1]} ${e[0]};`))}}class u{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map((e=>`varying ${e[1]} ${e[0]};`))}}class d{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?d.ALLOWLIST_VERTEX:d.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}d.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],d.ALLOWLIST_VERTEX=[];class h{constructor(){this._entries=[]}add(e,t,r){let i="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":i=h.numberToFloatStr(r);break;case"int":i=h.numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${h.numberToFloatStr(r[0])},                            ${h.numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${h.numberToFloatStr(r[0])},                            ${h.numberToFloatStr(r[1])},                            ${h.numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${h.numberToFloatStr(r[0])},                            ${h.numberToFloatStr(r[1])},                            ${h.numberToFloatStr(r[2])},                            ${h.numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${h.numberToIntStr(r[0])},                             ${h.numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${h.numberToIntStr(r[0])},                             ${h.numberToIntStr(r[1])},                             ${h.numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${h.numberToIntStr(r[0])},                             ${h.numberToIntStr(r[1])},                             ${h.numberToIntStr(r[2])},                             ${h.numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${t}(${Array.prototype.map.call(r,(e=>h.numberToFloatStr(e))).join(", ")})`}return this._entries.push(`const ${t} ${e} = ${i};`),this}static numberToIntStr(e){return e.toFixed(0)}static numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const p="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",f="precision highp float;\nprecision highp sampler2D;"},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(2),n=r(59),s=r(384),a=r(145);class o extends s.a{constructor(e,t,r){super(e,t.generateSource("vertex"),t.generateSource("fragment"),r),this._textures=new Map,this._freeTextureUnits=new n.a({deallocator:null}),this._fragmentUniforms=Object(a.b)()?t.fragmentUniforms.entries:null}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(Object(i.i)(e)||null==e.glName){const e=this._textures.get(t);return e&&(this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(t)),null}let r=this._textures.get(t);return null==r?(r=this._allocTextureUnit(e),this._textures.set(t,r)):r.texture=e,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(e,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),Object(i.j)(this._fragmentUniforms)&&this._fragmentUniforms.forEach((e=>{if(("sampler2D"===e.type||"samplerCube"===e.type)&&!this._textures.has(e.name))throw new Error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return c})),r.d(t,"f",(function(){return n})),r.d(t,"g",(function(){return d}));var i=r(30);const n=Object(i.h)(770,1,771,771),s=Object(i.i)(1,1),a=Object(i.i)(0,771);function o(e){return 2===e?null:1===e?a:s}function l(e){return 2===e?i.e:null}const c=5e5,u={factor:-1,units:-2};function d(e){return e?u:null}function h(e){return 3===e||2===e?513:515}},function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return a})),r.d(t,"g",(function(){return c})),r.d(t,"h",(function(){return l})),r.d(t,"i",(function(){return o})),r.d(t,"j",(function(){return d})),r.d(t,"k",(function(){return b})),r.d(t,"l",(function(){return m})),r.d(t,"m",(function(){return p}));var i=r(10),n=r(28),s=r(195);const a=[0,1],o=64,l=512,c=2.5,u=Object(i.f)(i.a/10),d=4,h=4,p=Object(n.k)();s.a.WebMercatorAuxiliarySphere.getExtent(0,0,0,p);const f=Object(n.k)([-180,-90,180,90]),b="Cannot extend surface to encompass all layers because it would result in too many root tiles.",m="Surface extent is too large for tile resolution at level 0.",g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC",y=5},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return o})),r.d(t,"f",(function(){return n}));r(8);var i=r(2);function n(e,t){return e.vertexBuffers[t].size/s(e.layout[t])}function s(e){return e[0].stride}function a(e,t,r,i,n){const s=e.gl,a=e.capabilities.instancing;e.bindBuffer(r);for(const o of i){const e=t.get(o.name);void 0===e&&console.error(`There is no location for vertex attribute '${o.name}' defined.`),o.baseInstance&&!o.divisor&&console.error(`Vertex attribute '${o.name}' uses baseInstanceOffset without divisor.`);const r=(n||(0+o.baseInstance?o.baseInstance:0))*o.stride;if(o.count<=4)s.vertexAttribPointer(e,o.count,o.type,o.normalized,o.stride,o.offset+r),s.enableVertexAttribArray(e),o.divisor>0&&a&&a.vertexAttribDivisor(e,o.divisor);else if(9===o.count)for(let t=0;t<3;t++)s.vertexAttribPointer(e+t,3,o.type,o.normalized,o.stride,o.offset+12*t+r),s.enableVertexAttribArray(e+t),o.divisor>0&&a&&a.vertexAttribDivisor(e+t,o.divisor);else if(16===o.count)for(let t=0;t<4;t++)s.vertexAttribPointer(e+t,4,o.type,o.normalized,o.stride,o.offset+16*t+r),s.enableVertexAttribArray(e+t),o.divisor>0&&a&&a.vertexAttribDivisor(e+t,o.divisor);else console.error("Unsupported vertex attribute element count: "+o.count)}}function o(e,t,r,i){const n=e.gl,s=e.capabilities.instancing;e.bindBuffer(r);for(const a of i){const e=t.get(a.name);if(a.count<=4)n.disableVertexAttribArray(e),a.divisor&&a.divisor>0&&s&&s.vertexAttribDivisor(e,0);else if(9===a.count)for(let t=0;t<3;t++)n.disableVertexAttribArray(e+t),a.divisor&&a.divisor>0&&s&&s.vertexAttribDivisor(e+t,0);else if(16===a.count)for(let t=0;t<4;t++)n.disableVertexAttribArray(e+t),a.divisor&&a.divisor>0&&s&&s.vertexAttribDivisor(e+t,0);else console.error("Unsupported vertex attribute element count: "+a.count)}e.unbindBuffer(34962)}function l(e){switch(e){case 6406:case 6409:case 36168:return 1;case 6410:case 32854:case 33325:case 32854:case 33189:return 2;case 6407:case 6402:return 3;case 6408:case 34041:case 33326:case 35898:case 33327:case 34041:return 4;case 33328:case 34842:return 8;case 34836:return 16;case 33776:case 33777:return.5;case 33778:case 33779:return 1;case 37488:case 37489:case 37492:case 37493:case 37494:case 37495:return.5;case 37490:case 37491:case 37496:case 37497:return 1}return 0}function c(e){if(Object(i.i)(e))return 0;if("descriptor"in e)return e.glName?c(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const r="hasMipmap"in e&&e.hasMipmap?1.3:1,n=e.width*e.height;return l(t)*n*r}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u}));var i=r(114),n=r(84),s=r(11),a=r(7),o=r(25);const l=a.a.getLogger("esri.assets");function c(e,t){return Object(n.default)(u(e),t)}function u(e){if(!i.a.assetsPath)throw l.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new s.a("assets:path-not-set","config.assetsPath is not set");return Object(o.z)(i.a.assetsPath,e)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return E})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return A}));var i=r(0),n=r(19),s=r(7),a=r(2),o=r(258),l=r(59),c=r(12),u=r(60),d=r(23),h=r(1),p=(r(8),r(9),r(4)),f=r(580);let b=class extends n.a{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};Object(i.a)([Object(h.b)()],b.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),Object(i.a)([Object(h.b)()],b.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),b=Object(i.a)([Object(p.a)("esri.views.support.DebugFlags")],b);var m=new b;const g=s.a.getLogger("esri.views.support.Scheduler");function y(e){return new M.Scheduler({nowFunc:e})}var v,O;(O=v||(v={})).RESOURCE_CONTROLLER="schedule",O.SLIDE="slide",O.STREAM_DATA_LOADER="stream loader",O.ELEVATION_QUERY="elevation query",O.TERRAIN_SURFACE="terrain",O.SURFACE_GEOMETRY_UPDATES="surface geometry updates",O.GRAPHICS_CORE="Graphics3D",O.I3S_CONTROLLER="I3S",O.POINT_CLOUD_LAYER="point cloud",O.FEATURE_TILE_FETCHER="feature fetcher",O.STAGE="stage",O.GRAPHICS_DECONFLICTOR="graphics deconflictor",O.FILTER_VISIBILITY="Graphics3D filter visibility",O.SCALE_VISIBILITY="Graphics3D scale visibility",O.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",O.POINT_OF_INTEREST_FREQUENT="POI frequent",O.POINT_OF_INTEREST_INFREQUENT="POI infrequent",O.LABELER="labeler",O.FEATURE_QUERY_ENGINE="feature query",O.FEATURE_TILE_TREE="feature tile tree",O.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",O.ELEVATION_ALIGNMENT="elevation alignment",O.TEXT_TEXTURE_ATLAS="text texture atlas",O.TEXTURE_UNLOAD="texture unload",O.OVERLAY_MANAGER="overlay manager",O.LINE_OF_SIGHT_TOOL="line of sight tool",O.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",O.ELEVATION_PROFILE="elevation profile",O.SNAPPING="snapping",O.SHADOW_ACCUMULATOR="shadow accumulator",O[O.TEST_PRIO=1]="TEST_PRIO";const j=new Map([[v.RESOURCE_CONTROLLER,0],[v.SLIDE,0],[v.STREAM_DATA_LOADER,0],[v.ELEVATION_QUERY,0],[v.TERRAIN_SURFACE,1],[v.SURFACE_GEOMETRY_UPDATES,1],[v.GRAPHICS_CORE,2],[v.I3S_CONTROLLER,2],[v.POINT_CLOUD_LAYER,2],[v.FEATURE_TILE_FETCHER,2],[v.STAGE,4],[v.GRAPHICS_DECONFLICTOR,4],[v.FILTER_VISIBILITY,4],[v.SCALE_VISIBILITY,4],[v.FRUSTUM_VISIBILITY,4],[v.POINT_OF_INTEREST_FREQUENT,6],[v.POINT_OF_INTEREST_INFREQUENT,30],[v.LABELER,8],[v.FEATURE_QUERY_ENGINE,8],[v.FEATURE_TILE_TREE,16],[v.FEATURE_TILE_TREE_ACTIVE,0],[v.ELEVATION_ALIGNMENT,12],[v.TEXT_TEXTURE_ATLAS,12],[v.TEXTURE_UNLOAD,12],[v.OVERLAY_MANAGER,12],[v.LINE_OF_SIGHT_TOOL,16],[v.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[v.SNAPPING,0],[v.SHADOW_ACCUMULATOR,30]]);function _(e){return j.has(e)?j.get(e):"number"==typeof e?e:1}const w=Object(u.a)(6.5),x=Object(u.a)(1),S=Object(u.a)(30),T=Object(u.a)(1e3/30),C=Object(u.a)(100);var M,P;!function(e){let t=class extends n.a{constructor(e){super(e),this.updating=!0,this.performanceInfo={total:new o.a("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=null,this._state=1,this._tasks=new l.a,this._runQueue=new l.a,this._load=0,this._idleStateCallbacks=new l.a,this._idleUpdatesStartFired=!1,this._maxReschedule=R,this._forceTask=!1,this._debug=!1,this._debugHandle=Object(d.a)(m,"SCHEDULER_LOG_SLOW_TASKS",(e=>this._debug=e)),this._budget=new s(e.nowFunc);for(const i of Object.keys(v))this.performanceInfo.tasks.set(v[i],new o.a(v[i]));let t;const r=this;this._test={get state(){return Object(a.i)(t)?r._state:t},set state(e){t=e},FRAME_SAFETY_BUDGET:w,INTERACTING_BUDGET:T,IDLE_BUDGET:C,get budget(){return r._budget.budget},usedBudget:0,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._debugHandle&&this._debugHandle.remove()}registerTask(e,t){const i=_(e),n=new r(this,e,t,i);return this._tasks.push(n),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new o.a(e)),n}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),2===this.state&&this._idleUpdatesStartFired&&r.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){i._idleUpdatesStartFired&&(r.idleEnd(),2===i._state&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get now(){return this.nowFunc()}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return Object(a.i)(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let t=w,r=e.frameDuration,i=x;switch(this.state){case 2:t=Object(u.a)(0),r=Object(u.a)(Math.max(C,e.frameDuration)),i=S;break;case 1:r=Object(u.a)(Math.max(T,e.frameDuration))}return r=Object(u.a)(r-e.elapsedFrameTime-t),2!==this.state&&r<x&&!this._forceTask?(this._forceTask=!0,!1):(r=Object(u.a)(Math.max(r,i)),this._budget.reset(r,this.state),this._maxReschedule=R,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(Object(u.a)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return P.SCHEDULED;let t=P.IDLE;return this._tasks.forAll((r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=P.READY:t!==P.READY&&(t=P.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.some((t=>t===e))&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{if(r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority)switch(e=!0,t=Math.max(t,r.basePriority),r.schedulePriority){case 1:r.schedulePriority=0,this._runQueue.push(r);break;default:--r.schedulePriority}})),!e)return this.updating=!1,!1;this._maxReschedule===R&&(this._maxReschedule=t),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const r=this._budget.now(),i=this._runQueue.pop();this._budget.resetProgress();try{i.task.runTask(this._budget)}catch(t){g.error(`Exception in task "${i.name}"`,t)}i.schedulePriority=i.basePriority;const n=this._budget.now()-r;if(i.runtime+=n,this._frameTaskTimes.set(i.priority,this._frameTaskTimes.get(i.priority)+n),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",i.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(v))this._frameTaskTimes.set(v[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};Object(i.a)([Object(h.b)()],t.prototype,"updating",void 0),Object(i.a)([Object(h.b)()],t.prototype,"nowFunc",void 0),t=Object(i.a)([Object(p.a)("esri.views.support.Scheduler")],t),e.Scheduler=t;let r=class extends n.a{constructor(e,t,r,i){super({}),this._scheduler=e,this.name=t,this._basePriority=i,this.runtime=0,this._queue=new f.a,this.updating=!1,this.schedulePriority=this._basePriority,this.task=Object(a.j)(r)?r:{running:!1,runTask:e=>this.processQueue(e)}}normalizeCtorArgs(){return{}}remove(){this.processQueue(A),this._scheduler.removeTask(this),this.schedule=E.schedule,this.reschedule=E.reschedule}get basePriority(){return this._basePriority}setPriority(e){this.name=e;const t=_(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this.updating=!0,this._queue.push(e,t,r)}reschedule(e,t,r){return this.updating=!0,this._queue.unshift(e,t,r)}processQueue(e){for(;!e.done&&this._queue.process();)e.madeProgress();this.updating=this._queue.length>0}};Object(i.a)([Object(h.b)()],r.prototype,"updating",void 0),r=Object(i.a)([Object(p.a)("esri.views.support.SchedulerTask")],r);class s{constructor(e){this.now=e,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=s}(M||(M={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(P||(P={}));const A=(()=>{const e=new M.Budget((()=>performance.now()));return e.enabled=!1,e})();const E=new class{remove(){}processQueue(){}schedule(e,t,r){try{if(Object(c.o)(t)){const e=Object(c.f)();return r?Promise.resolve(r(e)):Promise.reject(e)}return Object(c.z)(e())}catch(i){return Promise.reject(i)}}reschedule(e,t,r){return this.schedule(e,t,r)}},R=Number.MAX_SAFE_INTEGER},function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return o})),r.d(t,"i",(function(){return d})),r.d(t,"j",(function(){return p})),r.d(t,"k",(function(){return l})),r.d(t,"l",(function(){return c})),r.d(t,"m",(function(){return s})),r.d(t,"n",(function(){return m}));var i=r(2);function n(e,t){if(e.forEach)e.forEach(t);else for(let r=0;r<e.length;r++)t(e[r],r,e)}function s(e,t,r){if(e.slice)return e.slice(t,r);void 0===t?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),void 0===r?r=e.length:(r<0&&(r+=e.length),r=Math.min(e.length,Math.max(0,r)));const i=Math.max(0,r-t),n=new(0,e.constructor)(i);for(let s=0;s<i;s++)n[s]=e[t+s];return n}function a(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}function o(e){return e instanceof Int8Array||e&&e.constructor&&"Int8Array"===e.constructor.name}function l(e){return e instanceof Uint8Array||e&&e.constructor&&"Uint8Array"===e.constructor.name}function c(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&"Uint8ClampedArray"===e.constructor.name}function u(e){return e instanceof Int16Array||e&&e.constructor&&"Int16Array"===e.constructor.name}function d(e){return e instanceof Uint16Array||e&&e.constructor&&"Uint16Array"===e.constructor.name}function h(e){return e instanceof Int32Array||e&&e.constructor&&"Int32Array"===e.constructor.name}function p(e){return e instanceof Uint32Array||e&&e.constructor&&"Uint32Array"===e.constructor.name}function f(e){return e instanceof Float32Array||e&&e.constructor&&"Float32Array"===e.constructor.name}function b(e){return e instanceof Float64Array||e&&e.constructor&&"Float64Array"===e.constructor.name}function m(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}function g(e){return Object(i.i)(e)?0:128+e.buffer.byteLength+64}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(2);class n{constructor(e,t,r=(()=>this.dispose())){this.release=r,t&&(this._config=t.snapshot()),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}dispose(){this._program=Object(i.f)(this._program),this._pipeline=this._config=null}reload(e){Object(i.f)(this._program),this._program=this.initializeProgram(e)}get program(){return this._program}get pipeline(){return this._pipeline}get key(){return this._config.key}get configuration(){return this._config}bindPass(e,t){}bindMaterial(e,t){}bindDraw(e,t,r){}bindPipelineState(e){e.setPipelineState(this.pipeline)}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return 4}}},function(e,t,r){"use strict";function i(){return[1,0,0,0,1,0,0,0,1]}function n(e,t){return new Float64Array(e,t,9)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));Object.freeze({__proto__:null,create:i,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,r,i,n,s,a,o,l){return[e,t,r,i,n,s,a,o,l]},createView:n})},function(e,t,r){"use strict";r.r(t);var i=r(114),n=r(110),s=r(11),a=r(56),o=r(8),l=r(13),c=r(2),u=r(12),d=r(25),h=r(628),p=r(499);async function f(e,t){const l=Object(d.u)(e),p=Object(d.t)(e);p||l||(e=Object(d.D)(e));const y={url:e,requestOptions:{...Object(c.s)(t)}};let v=Object(d.l)(e);if(v){const e=await async function(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,i;try{i=await e.before(t)}catch(p){r=x("request:interceptor",p,t)}if((i instanceof Error||i instanceof s.a)&&(r=x("request:interceptor",i,t)),r)throw e.error&&e.error(r),r;return i}}(v,y);if(null!=e)return{data:e,getHeader:j,requestOptions:y.requestOptions,url:y.url};v.after||v.error||(v=null)}if(e=y.url,"image"===(t=y.requestOptions).responseType){if(Object(o.a)("host-webworker")||Object(o.a)("host-node"))throw x("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),y)}else if(l)throw x("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),y);if("head"===t.method){if(t.body)throw x("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),y);if(l||p)throw x("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),y)}if(await async function(){Object(o.a)("host-webworker")?b||(b=await r.e(150).then(r.bind(null,688))):f._abortableFetch||(f._abortableFetch=a.a.fetch.bind(a.a))}(),b)return b.execute(e,t);const O=Object(u.e)();Object(u.s)(t,(()=>O.abort()));const _={controller:O,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:v,params:y,redoRequest:!1,useIdentity:m.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},w=await async function(e){var t,r;let s,o;await async function(e){const t=e.params.url,r=e.params.requestOptions,s=e.controller.signal,o=r.body;let l=null,c=null,d=null;if(g&&"HTMLFormElement"in a.a&&(o instanceof FormData?l=o:o instanceof HTMLFormElement&&(c=o,l=new FormData(c))),"string"==typeof o&&(d=o),e.fetchOptions={cache:r.cacheBust&&!f._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:"head"===r.method?"HEAD":"GET",mode:"cors",redirect:"follow",signal:s},(l||d)&&(e.fetchOptions.body=l||d),"anonymous"===r.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||r.query&&r.query.token||l&&l.get&&l.get("token")||c&&c.elements.token),!e.hasToken&&i.a.apiKey&&Object(h.a)(t)&&(r.query||(r.query={}),r.query.token=i.a.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!T(t)&&!Object(u.o)(s)){let i;"immediate"===r.authMode?(await S(),i=await n.b.getCredential(t,{signal:s}),e.credential=i):"no-prompt"===r.authMode?(await S(),i=await n.b.getCredential(t,{prompt:!1,signal:s}).catch((()=>{})),e.credential=i):n.b&&(i=n.b.findCredential(t)),i&&(e.credentialToken=i.token,e.useSSL=!!i.ssl)}}(e);try{do{[s,o]=await C(e)}while(!await P(e,s,o))}catch(p){const t=x("request:server",p,e.params,s);throw t.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(t),t}const l=e.params.url;if(/\/sharing\/rest\/(accounts|portals)\/self/i.test(l)&&!e.hasToken&&!e.credentialToken&&null!=(t=o)&&null!=(r=t.user)&&r.username&&!Object(d.y)(l)){const e=Object(d.m)(l,!0);e&&m.trustedServers.push(e)}const c=e.credential;if(c&&n.b){const e=n.b.findServerInfo(c.server);let t=e&&e.owningSystemUrl;if(t){t=t.replace(/\/?$/,"/sharing");const e=n.b.findCredential(t,c.userId);e&&-1===n.b._getIdenticalSvcIdx(t,e)&&e.resources.unshift(t)}}return{data:o,getHeader:s?e=>s.headers.get(e):j,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}(_);return v&&v.after&&v.after(w),w}let b;const m=i.a.request,g="FormData"in a.a,y=[499,498,403,401],v=["COM_0056","COM_0057","SB_0008"],O=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],j=()=>null,_=Symbol();function w(e){const t=Object(d.m)(e);return!t||t.endsWith(".arcgis.com")||f._corsServers.includes(t)||Object(d.y)(t)}function x(e,t,r,i){let n="Error";const a={url:r.url,requestOptions:r.requestOptions,getHeader:j,ssl:!1};if(t instanceof s.a)return t.details?(t.details=Object(l.a)(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=a,t;if(t){const e=i&&(e=>i.headers.get(e)),r=i&&i.status,s=t.message;s&&(n=s),e&&(a.getHeader=e),a.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||r||0,a.subCode=t.subcode,a.messageCode=t.messageCode,"string"==typeof t.details?a.messages=[t.details]:a.messages=t.details,a.raw=_ in t?t[_]:t}return Object(u.n)(t)?Object(u.f)():new s.a(e,n,a)}async function S(){n.b||await r.e(153).then(r.bind(null,694))}function T(e){return O.some((t=>t.test(e)))}async function C(e){let t=e.params.url;const r=e.params.requestOptions,i=e.fetchOptions,s=Object(d.t)(t)||Object(d.u)(t),a=r.responseType||"json",l=s?0:null!=r.timeout?r.timeout:m.timeout;let c=!1;if(!s){e.useSSL&&(t=Object(d.J)(t)),r.cacheBust&&"default"===i.cache&&(t=Object(d.d)(t,"request.preventCache",Date.now()));let s={...r.query};e.credentialToken&&(s.token=e.credentialToken);let a=Object(d.E)(s);Object(o.a)("esri-url-encodes-apostrophe")&&(a=a.replace(/'/g,"%27"));const l=t.length+1+a.length;let u;c="delete"===r.method||"post"===r.method||"put"===r.method||!!r.body||l>m.maxUrlLength;const h=r.useProxy||!!Object(d.o)(t);if(h){const e=Object(d.p)(t);u=e.path,!c&&u.length+1+l>m.maxUrlLength&&(c=!0),e.query&&(s={...e.query,...s})}if("HEAD"===i.method&&(c||h)){if(c){if(l>m.maxUrlLength)throw x("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw x("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(h)throw x("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(c?(i.method="delete"===r.method?"DELETE":"put"===r.method?"PUT":"POST",r.body?t=Object(d.e)(t,s):(i.body=Object(d.E)(s),i.headers["Content-Type"]="application/x-www-form-urlencoded")):t=Object(d.e)(t,s),h&&(e.useProxy=!0,t=`${u}?${t}`),s.token&&g&&i.body instanceof FormData){const e=i.body;e.set?e.set("token",s.token):e.append("token",s.token)}if(r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!Object(d.q)(t,d.g))if(Object(d.y)(t))e.withCredentials=!0;else if(n.b){const r=n.b.findServerInfo(t);r&&r.webTierAuth&&(e.withCredentials=!0)}e.withCredentials&&(i.credentials="include")}let h,p,b=0,y=!1;l>0&&(b=setTimeout((()=>{y=!0,e.controller.abort()}),l));try{if("native-request-init"===r.responseType)p=i,p.url=t;else if("image"!==r.responseType||"default"!==i.cache||"GET"!==i.method||c||function(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}(r.headers)||!s&&!e.useProxy&&m.proxyUrl&&!w(t)){if(h=await f._abortableFetch(t,i),e.useProxy||function(e){const t=Object(d.m)(e);t&&!f._corsServers.includes(t)&&f._corsServers.push(t)}(t),"native"===r.responseType)p=h;else if("HEAD"!==i.method)if(h.ok){switch(a){case"array-buffer":p=await h.arrayBuffer();break;case"blob":case"image":p=await h.blob();break;default:p=await h.text()}if(b&&(clearTimeout(b),b=0),"json"===a||"xml"===a||"document"===a)if(p)switch(a){case"json":p=JSON.parse(p);break;case"xml":p=M(p,"application/xml");break;case"document":p=M(p,"text/html")}else p=null;if(p){if("array-buffer"===a||"blob"===a){const e=h.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(e)&&p["blob"===a?"size":"byteLength"]<=750)try{const e=await new Response(p).json();e.error&&(p=e)}catch{}}"image"===a&&p instanceof Blob&&(p=await A(URL.createObjectURL(p),e,!0))}}else p=await h.text()}else p=await A(t,e)}catch(v){if("AbortError"===v.name){if(y)throw new Error("Timeout exceeded");throw Object(u.f)("Request canceled")}if(!(!h&&v instanceof TypeError&&m.proxyUrl)||r.body||"delete"===r.method||"head"===r.method||"post"===r.method||"put"===r.method||e.useProxy||w(t))throw v;e.redoRequest=!0,Object(d.c)({proxyUrl:m.proxyUrl,urlPrefix:Object(d.m)(t)})}finally{b&&clearTimeout(b)}return[h,p]}function M(e,t){let r;try{r=(new DOMParser).parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function P(e,t,r){if(e.redoRequest)return e.redoRequest=!1,!1;const i=e.params.requestOptions;if(!t||"native"===i.responseType||"native-request-init"===i.responseType)return!0;let s,a,o,l;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[_]=r,s;null!=r&&r.error&&(s=r.error),s&&(a=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,l=s.messageCode,l=l&&l.toUpperCase());const c=i.authMode;if(403===a&&(4===o||s.message&&s.message.toLowerCase().indexOf("ssl")>-1&&-1===s.message.toLowerCase().indexOf("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&("no-prompt"!==c||498===a)&&-1!==y.indexOf(a)&&!T(e.params.url)&&(403!==a||-1===v.indexOf(l)&&(null==o||2===o&&e.credentialToken))){await S();try{const t=await n.b.getCredential(e.params.url,{error:x("request:server",s,e.params),prompt:"no-prompt"!==c,signal:e.controller.signal,token:e.credentialToken});return e.credential=t,e.credentialToken=t.token,e.useSSL=e.useSSL||t.ssl,!1}catch(u){if("no-prompt"===c)return e.credential=null,e.credentialToken=null,!1;s=u}}if(s)throw s;return!0}function A(e,t,r=!1){const i=t.controller.signal,n=new Image;return t.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.src=e,Object(p.a)(n,e,r,i)}f._abortableFetch=null,f._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],t.default=f},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return p})),r.d(t,"h",(function(){return h}));var i=r(50),n=r(146),s=r(243),a=r(41),o=r(144),l=r(166);function c(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function u(e){return void 0!==e.points}function d(e){return void 0!==e.x&&void 0!==e.y}function h(e){return void 0!==e.paths}function p(e){return void 0!==e.rings}function f(e){return e?e instanceof n.a?e:d(e)?a.a.fromJSON(e):h(e)?l.a.fromJSON(e):p(e)?o.a.fromJSON(e):u(e)?s.a.fromJSON(e):c(e)?i.a.fromJSON(e):null:null}function b(e){return e?d(e)?"esriGeometryPoint":h(e)?"esriGeometryPolyline":p(e)?"esriGeometryPolygon":c(e)?"esriGeometryEnvelope":u(e)?"esriGeometryMultipoint":null:null}const m={esriGeometryPoint:a.a,esriGeometryPolyline:l.a,esriGeometryPolygon:o.a,esriGeometryEnvelope:i.a,esriGeometryMultipoint:s.a};function g(e){return e&&m[e]||null}},function(e,t,r){"use strict";r.d(t,"a",(function(){return z})),r.d(t,"b",(function(){return P})),r.d(t,"c",(function(){return A})),r.d(t,"d",(function(){return I})),r.d(t,"e",(function(){return E})),r.d(t,"f",(function(){return R})),r.d(t,"g",(function(){return F})),r.d(t,"h",(function(){return k})),r.d(t,"i",(function(){return D})),r.d(t,"j",(function(){return L}));var i,n=r(9),s=r(246),a=r(277),o=(r(348),r(387)),l=(r(263),r(323),r(190),r(292)),c=r(293),u=(r(253),r(390),r(351)),d=(r(279),r(349),r(0)),h=r(13),p=r(17),f=r(1),b=(r(8),r(7),r(37)),m=r(4),g=r(400);let y=i=class extends o.a{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,r,i){if(e&&"string"!=typeof e&&null==e.imageData)return e;const n={};return e&&(n.url=e),t&&(n.outline=t),null!=r&&(n.width=Object(p.j)(r)),null!=i&&(n.height=Object(p.j)(i)),n}clone(){const e=new i({color:Object(h.a)(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",Object(h.a)(this.source)),e}hash(){var e;return`${super.hash()}.${null==(e=this.color)?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};Object(d.a)([Object(b.a)({esriPFS:"picture-fill"},{readOnly:!0})],y.prototype,"type",void 0),Object(d.a)([Object(f.b)(g.b)],y.prototype,"url",void 0),Object(d.a)([Object(f.b)({type:Number,json:{write:!0}})],y.prototype,"xscale",void 0),Object(d.a)([Object(f.b)({type:Number,json:{write:!0}})],y.prototype,"yscale",void 0),Object(d.a)([Object(f.b)({type:Number,cast:p.j,json:{write:!0}})],y.prototype,"width",void 0),Object(d.a)([Object(f.b)({type:Number,cast:p.j,json:{write:!0}})],y.prototype,"height",void 0),Object(d.a)([Object(f.b)({type:Number,cast:p.j,json:{write:!0}})],y.prototype,"xoffset",void 0),Object(d.a)([Object(f.b)({type:Number,cast:p.j,json:{write:!0}})],y.prototype,"yoffset",void 0),Object(d.a)([Object(f.b)(g.a)],y.prototype,"source",void 0),y=i=Object(d.a)([Object(m.a)("esri.symbols.PictureFillSymbol")],y);var v=y,O=r(309),j=r(207),_=r(245),w=r(211),x=r(152),S=r(249),T=r(121),C=(r(212),r(147),r(247)),M=(r(208),r(350),r(215));r(481),r(482),r(389);function P(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function A(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const E={base:T.a,key:"type",typeMap:{"simple-fill":w.a,"picture-fill":v,"picture-marker":O.a,"simple-line":x.a,"simple-marker":S.a,text:C.a,"label-3d":l.a,"line-3d":c.a,"mesh-3d":u.a,"point-3d":j.a,"polygon-3d":_.a,"web-style":M.a,cim:a.a},errorContext:"symbol"},R={base:T.a,key:"type",typeMap:{"picture-marker":O.a,"simple-marker":S.a,text:C.a,"web-style":M.a,cim:a.a},errorContext:"symbol"},I=Object(s.b)({types:E}),D={base:T.a,key:"type",typeMap:{"simple-fill":w.a,"picture-fill":v,"picture-marker":O.a,"simple-line":x.a,"simple-marker":S.a,text:C.a,"line-3d":c.a,"mesh-3d":u.a,"point-3d":j.a,"polygon-3d":_.a,"web-style":M.a,cim:a.a},errorContext:"symbol"},F={base:T.a,key:"type",typeMap:{text:C.a,"label-3d":l.a},errorContext:"symbol"},L=(T.a,l.a,c.a,u.a,j.a,_.a,M.a,{base:T.a,key:"type",typeMap:{"line-3d":c.a,"mesh-3d":u.a,"point-3d":j.a,"polygon-3d":_.a,"web-style":M.a},errorContext:"symbol"}),k={base:T.a,key:"type",typeMap:{"label-3d":l.a},errorContext:"symbol"},z=Object(n.k)(E)},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return a})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return g})),r.d(t,"h",(function(){return l})),r.d(t,"i",(function(){return h})),r.d(t,"j",(function(){return x})),r.d(t,"k",(function(){return y})),r.d(t,"l",(function(){return O})),r.d(t,"m",(function(){return _})),r.d(t,"n",(function(){return c})),r.d(t,"o",(function(){return s}));var i=r(2),n=r(464);function s(e,t){return t?e.filter(((e,r,i)=>i.findIndex(t.bind(null,e))===r)):e.filter(((e,t,r)=>r.indexOf(e)===t))}function a(e,t,r){if(Object(i.i)(e)&&Object(i.i)(t))return!0;if(Object(i.i)(e)||Object(i.i)(t)||e.length!==t.length)return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function o(e,t,r){let i,n;return r?(i=t.filter((t=>!e.some((e=>r(e,t))))),n=e.filter((e=>!t.some((t=>r(t,e)))))):(i=t.filter((t=>!e.includes(t))),n=e.filter((e=>!t.includes(e)))),{added:i,removed:n}}function l(e,t,r){return e&&t?r?e.filter((function(e){return t.findIndex((function(t){return r(e,t)}))>-1})):e.filter((function(e){return t.indexOf(e)>-1})):[]}function c(e,t){const r=e.length;if(0===r)return[];const i=[];for(let n=0;n<r;n+=t)i.push(e.slice(n,n+t));return i}const u=!!Array.prototype.fill;function d(e,t){if(u)return new Array(e).fill(t);const r=new Array(e);for(let i=0;i<e;i++)r[i]=t;return r}function h(e,t){void 0===t&&(t=e,e=0);const r=new Array(t-e);for(let i=e;i<t;i++)r[i-e]=i;return r}function p(e,t,r){const i=e.length;let n=0,s=i-1;for(;n<s;){const r=n+Math.floor((s-n)/2);t>e[r]?n=r+1:s=r}const a=e[n];return r?t>=e[i-1]?-1:a===t?n:n-1:a===t?n:-1}function f(e){return e.reduce(((e,t)=>e.concat(t||[])),[])}class b{constructor(){this.last=0}}const m=new b;function g(e,t,r,i){i=i||m;const n=Math.max(0,i.last-10);for(let a=n;a<r;++a)if(e[a]===t)return i.last=a,a;const s=Math.min(n,r);for(let a=0;a<s;++a)if(e[a]===t)return i.last=a,a;return-1}function y(e,t,r,i){const n=null==r?e.length:r,s=g(e,t,n,i);if(-1!==s)return e[s]=e[n-1],null==r&&e.pop(),t}const v=new Set;function O(e,t,r=e.length,i=t.length,n,s){if(0===i||0===r)return r;v.clear();for(let o=0;o<i;++o)v.add(t[o]);n=n||m;const a=Math.max(0,n.last-10);for(let o=a;o<r;++o)if(v.has(e[o])&&(s&&s.push(e[o]),v.delete(e[o]),e[o]=e[r-1],--r,--o,0===v.size||0===r))return v.clear(),r;for(let o=0;o<a;++o)if(v.has(e[o])&&(s&&s.push(e[o]),v.delete(e[o]),e[o]=e[r-1],--r,--o,0===v.size||0===r))return v.clear(),r;return v.clear(),r}function j(e){return e?(w.seed=e,()=>w.getFloat()):Math.random}function _(e,t){const r=j(t);for(let i=e.length-1;i>0;i--){const t=Math.floor(r()*(i+1)),n=e[i];e[i]=e[t],e[t]=n}return e}const w=new n.a;function x(e,t){const r=e.indexOf(t);return-1!==r?(e.splice(r,1),t):null}},function(e,t,r){"use strict";r.d(t,"a",(function(){return x})),r.d(t,"b",(function(){return P})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return v})),r.d(t,"e",(function(){return S})),r.d(t,"f",(function(){return j})),r.d(t,"g",(function(){return _})),r.d(t,"h",(function(){return C})),r.d(t,"i",(function(){return h})),r.d(t,"j",(function(){return m})),r.d(t,"k",(function(){return T})),r.d(t,"l",(function(){return w}));var i=r(10),n=r(2),s=r(3),a=r(5),o=r(22),l=r(219),c=r(33),u=r(123);const d=Object(o.h)();function h(e,t,r,i,n,s,a){if(!Object(u.e)(t))if(e.boundingInfo){Object(c.a)(0===e.primitiveType);const t=r.tolerance;f(e.boundingInfo,i,n,t,s,a)}else{const t=e.indices.get("position"),r=e.vertexAttributes.get("position");m(i,n,0,t.length/3,t,r,void 0,s,a)}}const p=Object(a.e)();function f(e,t,r,i,s,a){if(Object(n.i)(e))return;const l=O(t,r,p);if(Object(o.D)(d,e.getBBMin()),Object(o.C)(d,e.getBBMax()),Object(n.j)(s)&&s.applyToAabb(d),j(d,t,l,i)){const{primitiveIndices:n,indices:o,position:l}=e,c=n?n.length:o.length/3;if(c>A){const n=e.getChildren();if(void 0!==n){for(let e=0;e<8;++e)void 0!==n[e]&&f(n[e],t,r,i,s,a);return}}m(t,r,0,c,o,l,n,s,a)}}const b=Object(a.e)();function m(e,t,r,i,s,a,o,l,c){if(o)return function(e,t,r,i,s,a,o,l,c){const u=a.data,d=a.stride||a.size,h=e[0],p=e[1],f=e[2],m=t[0]-h,g=t[1]-p,y=t[2]-f;for(let O=r;O<i;++O){const e=o[O];let t=3*e,r=d*s[t++],i=u[r++],a=u[r++],j=u[r];r=d*s[t++];let _=u[r++],w=u[r++],x=u[r];r=d*s[t];let S=u[r++],T=u[r++],C=u[r];Object(n.j)(l)&&([i,a,j]=l.applyToVertex(i,a,j,O),[_,w,x]=l.applyToVertex(_,w,x,O),[S,T,C]=l.applyToVertex(S,T,C,O));const M=_-i,P=w-a,A=x-j,E=S-i,R=T-a,I=C-j,D=g*I-R*y,F=y*E-I*m,L=m*R-E*g,k=M*D+P*F+A*L;if(Math.abs(k)<=Number.EPSILON)continue;const z=h-i,V=p-a,N=f-j,U=z*D+V*F+N*L;if(k>0){if(U<0||U>k)continue}else if(U>0||U<k)continue;const B=V*A-P*N,G=N*M-A*z,q=z*P-M*V,H=m*B+g*G+y*q;if(k>0){if(H<0||U+H>k)continue}else if(H>0||U+H<k)continue;const W=(E*B+R*G+I*q)/k;W>=0&&c(W,v(M,P,A,E,R,I,b),e)}}(e,t,r,i,s,a,o,l,c);const u=a.data,d=a.stride||a.size,h=e[0],p=e[1],f=e[2],m=t[0]-h,g=t[1]-p,y=t[2]-f;for(let O=r,j=3*r;O<i;++O){let e=d*s[j++],t=u[e++],r=u[e++],i=u[e];e=d*s[j++];let a=u[e++],o=u[e++],_=u[e];e=d*s[j++];let w=u[e++],x=u[e++],S=u[e];Object(n.j)(l)&&([t,r,i]=l.applyToVertex(t,r,i,O),[a,o,_]=l.applyToVertex(a,o,_,O),[w,x,S]=l.applyToVertex(w,x,S,O));const T=a-t,C=o-r,M=_-i,P=w-t,A=x-r,E=S-i,R=g*E-A*y,I=y*P-E*m,D=m*A-P*g,F=T*R+C*I+M*D;if(Math.abs(F)<=Number.EPSILON)continue;const L=h-t,k=p-r,z=f-i,V=L*R+k*I+z*D;if(F>0){if(V<0||V>F)continue}else if(V>0||V<F)continue;const N=k*M-C*z,U=z*T-M*L,B=L*C-T*k,G=m*N+g*U+y*B;if(F>0){if(G<0||V+G>F)continue}else if(G>0||V+G<F)continue;const q=(P*N+A*U+E*B)/F;q>=0&&c(q,v(T,C,M,P,A,E,b),O)}}const g=Object(a.e)(),y=Object(a.e)();function v(e,t,r,i,n,a,o){return Object(s.y)(g,e,t,r),Object(s.y)(y,i,n,a),Object(s.i)(o,g,y),Object(s.t)(o,o),o}function O(e,t,r){return Object(s.y)(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function j(e,t,r,i){return _(e,t,r,i,1/0)}function _(e,t,r,i,n){const s=(e[0]-i-t[0])*r[0],a=(e[3]+i-t[0])*r[0];let o=Math.min(s,a),l=Math.max(s,a);const c=(e[1]-i-t[1])*r[1],u=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(o=Math.max(o,Math.min(c,u)),o>l)return!1;const d=(e[2]-i-t[2])*r[2],h=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(d,h)),!(l<0)&&(o=Math.max(o,Math.min(d,h)),!(o>l)&&o<n)}function w(e,t,r,n,s){let a=(r.screenLength||0)*e.pixelRatio;s&&(a=Object(l.f)(a,n,t,s));const o=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Object(i.e)(o*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)}function x(e,t,r){if(!e)return;const i=e.parameters,n=e.paddingPixelsOverride;t.setUniform4f(r,i.divisor,i.offset,i.minPixelSize,n)}function S(e,t){const r=t?S(t):{};for(const i in e){let t=e[i];t&&t.forEach&&(t=M(t)),null==t&&i in r||(r[i]=t)}return r}function T(e,t){let r=!1;for(const i in t){const n=t[i];void 0!==n&&(r=!0,Array.isArray(n)?e[i]=n.slice():e[i]=n)}return r}function C(e,t,r,n,s){if(!t.options.selectionMode)return;const a=e.vertexAttributes.get("position").data,o=e.vertexAttributes.get("size"),l=o&&o.data[0],c=r[0],u=r[1],d=((l+n)/2+4)*e.screenToWorldRatio;let h=Number.MAX_VALUE;for(let p=0;p<a.length-5;p+=3){const e=a[p],t=a[p+1],r=c-e,n=u-t,s=a[p+3]-e,o=a[p+4]-t,l=Object(i.e)((s*r+o*n)/(s*s+o*o),0,1),d=s*l-r,f=o*l-n,b=d*d+f*f;b<h&&(h=b)}h<d*d&&s()}function M(e){const t=[];return e.forEach((e=>t.push(e))),t}const P={multiply:1,ignore:2,replace:3,tint:4},A=1e3},function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return _})),r.d(t,"c",(function(){return w})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return x})),r.d(t,"g",(function(){return T})),r.d(t,"h",(function(){return X})),r.d(t,"i",(function(){return f})),r.d(t,"j",(function(){return u})),r.d(t,"k",(function(){return h})),r.d(t,"l",(function(){return O})),r.d(t,"m",(function(){return S})),r.d(t,"n",(function(){return C})),r.d(t,"o",(function(){return z})),r.d(t,"p",(function(){return V})),r.d(t,"q",(function(){return L})),r.d(t,"r",(function(){return J})),r.d(t,"s",(function(){return B})),r.d(t,"t",(function(){return g})),r.d(t,"u",(function(){return G})),r.d(t,"v",(function(){return Z}));var i=r(11),n=r(2),s=r(99),a=r(237),o=r(139);const l=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],c=["field","normalizationField"];function u(e,t){if(null!=e&&null!=t)for(const r of Array.isArray(e)?e:[e])if(d(l,r,t),"visualVariables"in r&&r.visualVariables)for(const e of r.visualVariables)d(c,e,t)}function d(e,t,r){if(e)for(const i of e){const e=Object(s.b)(i,t),n=e&&"function"!=typeof e&&r.get(e);n&&Object(s.c)(i,n.name,t)}}function h(e,t){if(null!=e&&null!=t&&t.fields.length)if("startField"in e){const r=t.get(e.startField),i=t.get(e.endField);e.startField=r&&r.name||null,e.endField=i&&i.name||null}else{const r=t.get(e.startTimeField),i=t.get(e.endTimeField);e.startTimeField=r&&r.name||null,e.endTimeField=i&&i.name||null}}const p=new Set;function f(e,t){return e&&t?(p.clear(),b(p,e,t),Array.from(p).sort()):[]}function b(e,t,r){var i;if(r)if(null!=t&&null!=(i=t.fields)&&i.length)if(r.includes("*"))for(const{name:n}of t.fields)e.add(n);else for(const n of r)m(e,t,n);else{if(r.includes("*"))return e.clear(),void e.add("*");for(const t of r)e.add(t)}}function m(e,t,r){if("string"==typeof r)if(t){const i=t.get(r);i&&e.add(i.name)}else e.add(r)}function g(e,t){return Object(n.i)(t)||Object(n.i)(e)?[]:t.includes("*")?e.fields.map((e=>e.name)):t}async function y(e,t,r){if(!r)return;const{arcadeUtils:i}=await Object(o.e)(),n=i.extractFieldNames(r);for(const s of n)m(e,t,s)}async function v(e,t,n){if(n&&"1=1"!==n){const s=(await r.e(1).then(r.bind(null,675))).WhereClause.create(n,t);if(!s.isStandardized)throw new i.a("fieldUtils:collectFilterFields","Where clause is not standardized");b(e,t,s.fieldNames)}}function O({displayField:e,fields:t}){return e||(t&&t.length?j(t,"name-or-title")||j(t,"unique-identifier")||j(t,"type-or-category")||function(e){for(const t of e){if(!t||!t.name)continue;const e=t.name.toLowerCase();if(e.indexOf("name")>-1||e.indexOf("title")>-1)return t.name}return null}(t):null)}function j(e,t){for(const r of e)if(r&&r.valueType&&r.valueType===t)return r.name;return null}async function _(e,t){if(!t)return;const r=Object(s.b)("elevationInfo.featureExpressionInfo",t);return r?r.collectRequiredFields(e,t.fieldsIndex):void 0}async function w(e,t,r){t&&r&&"cluster"===r.type&&r.fields&&await Promise.all(r.fields.map((r=>async function(e,t,r){r.outStatistic.onStatisticValueExpression?y(e,t,r.outStatistic.onStatisticValueExpression):e.add(r.outStatistic.onStatisticField)}(e,t.fieldsIndex,r))))}async function x(e,t,r){t&&(t.timeInfo&&Object(n.j)(r)&&r.timeExtent&&b(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&b(e,t.fieldsIndex,[t.floorInfo.floorField]),Object(n.j)(r)&&Object(n.j)(r.where)&&await v(e,t.fieldsIndex,r.where))}function S(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?f(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function T(e,t){const{labelingInfo:r,fieldsIndex:i}=t;r&&r.length&&await Promise.all(r.map((t=>async function(e,t,r){if(!r)return;const i=r.getLabelExpression(),n=r.where;if("arcade"===i.type)await y(e,t,i.expression);else{const r=i.expression.match(/{[^}]*}/g);r&&r.forEach((r=>{m(e,t,r.slice(1,-1))}))}await v(e,t,n)}(e,i,t))))}function C(e){const t=e.defaultValue;return void 0!==t&&F(e,t)?t:e.nullable?null:void 0}function M(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function P(e){return null===e||M(e)}const A="isInteger"in Number?Number.isInteger:e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e;function E(e){return null===e||A(e)}function R(e){return null!=e&&"string"==typeof e}function I(e){return null===e||R(e)}function D(){return!0}function F(e,t){let r;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=e.nullable?E:A;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=e.nullable?P:M;break;case"string":case"esriFieldTypeString":r=e.nullable?I:R;break;default:r=D}return 1===arguments.length?r:r(t)}const L=["integer","small-integer","single","double"],k=new Set([...L,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function z(e){return null!=e&&k.has(e.type)}function V(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}var N,U;function B(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function G(e,t){return e.nullable&&null===t?null:z(e)&&!function(e,t){const r="string"==typeof e?q(e):e;return!!r&&(r.isInteger?A(t)&&t>=r.min&&t<=r.max:t>=r.min&&t<=r.max)}(e.type,Number(t))?N.OUT_OF_RANGE:F(e,t)?e.domain?Object(a.e)(e.domain,t):null:U.INVALID_TYPE}function q(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return H;case"esriFieldTypeInteger":case"integer":return W;case"esriFieldTypeSingle":case"single":return $;case"esriFieldTypeDouble":case"double":return Q}}(N||(N={})).OUT_OF_RANGE="numeric-range-validation-error::out-of-range",function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(U||(U={}));const H={min:-32768,max:32767,isInteger:!0},W={min:-2147483648,max:2147483647,isInteger:!0},$={min:-34e37,max:12e37,isInteger:!1},Q={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function Z(e,t,r){switch(e){case a.a.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case a.a.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case U.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case N.OUT_OF_RANGE:{const{min:e,max:i}=q(t.type);return`Value ${r} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${e} to ${i}`}}}function X(e,t){return!J(e,t,null)}function J(e,t,r){if(!t||!t.attributes||!e){if(Object(n.j)(r))for(const t of e)r.add(t);return!0}const i=t.attributes;let s=!1;for(const a of e)if(!(a in i)){if(s=!0,!Object(n.j)(r))break;r.add(a)}return s}},function(e,t,r){"use strict";var i=r(7),n=r(2),s=r(109),a=r(78);const o=i.a.getLogger("esri.views.webgl.VertexArrayObject");t.a=class{constructor(e,t,r,i,n=null){this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(s.b.VAO,this)}get glName(){return this._glName}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].size),Object(n.j)(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){if(this._context){if(this._glName){var t,r;const e=null==(t=this._context)||null==(r=t.capabilities)?void 0:r.vao;e?(e.deleteVertexArray(this._glName),this._glName=null):o.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer=Object(n.f)(this._indexBuffer)}this._context.instanceCounter.decrement(s.b.VAO,this),this._context=null}else(this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&o.warn("Leaked WebGL VAO")}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||o.error("Vertex buffer dictionary is empty!");const i=this._context.gl;for(const n in e){const r=e[n];r||o.error("Vertex buffer is uninitialized!");const i=t[n];i||o.error("Vertex element descriptor is empty!"),Object(a.a)(this._context,this._locations,r,i)}Object(n.j)(r)&&(this._context.capabilities.vao?i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:t}=this;e||o.error("Vertex buffer dictionary is empty!");for(const r in e){const i=e[r];i||o.error("Vertex buffer is uninitialized!");const n=t[r];Object(a.e)(this._context,this._locations,i,n)}Object(n.j)(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return M})),r.d(t,"c",(function(){return S})),r.d(t,"d",(function(){return P})),r.d(t,"e",(function(){return j})),r.d(t,"f",(function(){return C})),r.d(t,"g",(function(){return w})),r.d(t,"h",(function(){return A})),r.d(t,"i",(function(){return x})),r.d(t,"j",(function(){return _})),r.d(t,"k",(function(){return T}));var i=r(10),n=r(2),s=r(16),a=r(20),o=r(27),l=r(5),c=r(40),u=r(31),d=r(36),h=r(22),p=r(28),f=r(500),b=r(224),m=r(191),g=r(339);function y(e,t){if("point"===e.type)return O(e,t,!1);if(Object(g.d)(e))switch(e.type){case"extent":return O(e.center,t,!1);case"polygon":return O(e.centroid,t,!1);case"polyline":return O(v(e),t,!0);case"mesh":return O(e.origin,t,!1)}else switch(e.type){case"extent":return O(function(e){const t=Object(i.j)(e.zmin);return Object(m.j)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return O(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=Object(f.b)(e.rings,e.hasZ);return Object(m.j)(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return O(v(e),t,!0)}}function v(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=Object(b.d)(t,Object(b.c)(t)/2);return Object(m.j)(r[0],r[1],r[2],e.spatialReference)}function O(e,t,r){const i=r?e:Object(g.a)(e);return t&&e?Object(d.t)(e,i,t)?i:null:i}function j(e,t,r,i=0){if(e){t||(t=Object(p.k)());const n=e;let s=.5*n.width*(r-1),a=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=a/20:n.height<1e-7*n.width&&(a+=s/20),Object(c.l)(t,n.xmin-s-i,n.ymin-a-i,n.xmax+s+i,n.ymax+a+i),t}return null}function _(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute("auxpos1");i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(r))}}function w(e,t){const r=Object(u.f)(u.a);return Object(n.j)(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),Object(n.j)(t)?r[3]=t:Object(n.j)(e)&&e.length>3&&(r[3]=e[3]),r}function x(e,t,r,i,s,a=[0,0,0,0]){for(let o=0;o<3;++o)Object(n.j)(e)&&null!=e[o]?a[o]=e[o]:Object(n.j)(r)&&null!=r[o]?a[o]=r[o]:a[o]=s[o];return Object(n.j)(t)?a[3]=t:Object(n.j)(i)?a[3]=i:a[3]=s[3],a}function S(e=l.a,t,r,i=1){const s=new Array(3);if(Object(n.i)(t)||Object(n.i)(r))s[0]=1,s[1]=1,s[2]=1;else{let i,n=0;for(let a=2;a>=0;a--){const o=e[a];let l;const c=null!=o,u=0===a&&!i&&!c,d=r[a];"symbol-value"===o||u?l=0!==d?t[a]/d:1:c&&"proportional"!==o&&isFinite(o)&&(l=0!==d?o/d:1),null!=l&&(s[a]=l,i=l,n=Math.max(n,Math.abs(l)))}for(let e=2;e>=0;e--)null==s[e]?s[e]=i:0===s[e]&&(s[e]=.001*n)}for(let n=2;n>=0;n--)s[n]/=i;return Object(l.f)(s)}function T(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),C(e)?null:"Symbol sizes may not be negative values"}function C(e){if(Array.isArray(e)){for(const t of e)if(!C(t))return!1;return!0}return null==e||e>=0}function M(e,t,r,i=Object(a.d)()){const n=e||0,o=t||0,l=r||0;return 0!==n&&Object(s.r)(i,i,-n/180*Math.PI),0!==o&&Object(s.b)(i,i,o/180*Math.PI),0!==l&&Object(s.j)(i,i,l/180*Math.PI),i}function P(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(h.x)(e)?t.minDemResolutionForPoints:.01*Object(h.y)(e)}const A={"bottom-left":Object(o.f)(0,0),bottom:Object(o.f)(.5,0),"bottom-right":Object(o.f)(1,0),left:Object(o.f)(0,.5),center:Object(o.f)(.5,.5),right:Object(o.f)(1,.5),"top-left":Object(o.f)(0,1),top:Object(o.f)(.5,1),"top-right":Object(o.f)(1,1)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return u}));var i=r(16),n=r(640);function s(e,t,r){e.setUniform3f("camPos",r[3]-t[0],r[7]-t[1],r[11]-t[2])}function a(e,t){e.setUniformMatrix4fv("proj",t)}function o(e,t){e.setUniform2fv("nearFar",t)}function l(e,t,r){Object(i.t)(d,r,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",d)}function c(e,t){l(e,t.origin,t.camera.viewMatrix)}function u(e,t){e.setUniform4fv("viewport",t.camera.fullViewport)}const d=Object(n.a)()},function(e,t,r){"use strict";var i=r(7),n=r(109),s=r(367),a=r(145),o=r(47),l=r(78);const c=i.a.getLogger("esri.views.webgl.FrameBufferObject");class u{constructor(e,t,r,i){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc={...t},e.instanceCounter.increment(n.b.Framebuffer,this),r){Array.isArray(r)||(r=[r]);for(let t=0;t<r.length;++t){var a;const i=r[t];let n;d(i)?(n=i.descriptor,this._colorAttachments.set(36064+t,i)):(n=i,this._colorAttachments.set(36064+t,new o.a(e,i))),0!==(null==(a=this._desc)?void 0:a.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),this._validateColorAttachmentPoint(36064+t),this._validateTextureDimensions(n,this._desc)}}if(i instanceof s.a){var l;const e=null!=(l=this._desc.depthStencilTarget)?l:3;2===e?this._stencilAttachment=i:1===e||3===e?this._depthAttachment=i:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),h(i.descriptor,this._desc)}else if(i){let e;this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),d(i)?(this._depthStencilTexture=i,e=i.descriptor):this._depthStencilTexture=new o.a(this._context,i),this._validateTextureDimensions(e,this._desc)}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(n.b.Framebuffer,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(36064);return e&&d(e)?e:null}get colorAttachment(){return this._colorAttachments.get(36064)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return Object(l.c)(this.colorAttachment)+Object(l.c)(this.depthStencilAttachment)}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&d(t)?t:null}attachColorTexture(e,t=36064){if(!e)return;this._validateColorAttachmentPoint(t);const r=e.descriptor;if(this._validateTextureDimensions(r,this._desc),this._disposeColorAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl;r.framebufferTexture2D(r.FRAMEBUFFER,t,r.TEXTURE_2D,e.glName,0)}this._colorAttachments.set(t,e)}detachColorTexture(e=36064){const t=this._colorAttachments.get(e);if(d(t)){const r=t;if(this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl;t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,null,0)}return this._colorAttachments.delete(e),r}}attachDepthStencilTexture(e){if(!e)return;const t=e.descriptor;if(34041!==t.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==t.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDimensions(t,this._desc),this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,e.glName,0)}this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl;this._context.gl.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(!e)return;const t=e.descriptor;if(34041!==t.internalFormat&&33189!==t.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),h(t,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===t.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl,r=1===this._desc.depthStencilTarget?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(t.FRAMEBUFFER,r,t.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);const t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}return this._depthAttachment=null,t}detachAll(){this.detachColorTexture(),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(e,t,r,i,n,s,a){(e<0||t<0||n<0||s<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;3553!==a.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(e+r>l.width||t+i>l.height||n+r>c.width||s+i>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const u=this._context,d=u.bindTexture(a,o.a.TEXTURE_UNIT_FOR_UPDATES);u.bindFramebuffer(this),u.gl.copyTexSubImage2D(3553,0,n,s,e,t,r,i),u.bindTexture(d,o.a.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,r,i,n,s,a){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,i,n,s,a)}resize(e,t){const r=this._desc;if(r.width!==e||r.height!==t){if(!this._initialized)return r.width=e,r.height=t,this._colorAttachments.forEach((r=>{r&&r.resize(e,t)})),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,t));r.width=e,r.height=t,this._colorAttachments.forEach((r=>{r&&r.resize(e,t)})),null!=this._depthStencilTexture?this._depthStencilTexture.resize(e,t):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,t),this._stencilAttachment&&this._stencilAttachment.resize(e,t)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(){var e,t,r,i;const n=this._context.gl;if(this._initialized)return void n.bindFramebuffer(n.FRAMEBUFFER,this.glName);this._glName&&n.deleteFramebuffer(this._glName);const l=this._context,c=n.createFramebuffer(),u=this._desc,h=null!=(e=u.colorTarget)?e:1,p=null!=(t=u.width)?t:1,f=null!=(r=u.height)?r:1;if(n.bindFramebuffer(n.FRAMEBUFFER,c),0===this._colorAttachments.size)if(0===h)this._colorAttachments.set(36064,function(e,t){return new o.a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height})}(l,u));else{const e=new s.a(l,{internalFormat:32854,width:p,height:f});this._colorAttachments.set(36064,e)}this._colorAttachments.forEach(((e,t)=>{e&&(d(e)?n.framebufferTexture2D(n.FRAMEBUFFER,t,n.TEXTURE_2D,e.glName,0):n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,e.glName))}));const b=null!=(i=u.depthStencilTarget)?i:0;switch(b){case 1:case 3:{this._depthAttachment||(this._depthAttachment=new s.a(l,{internalFormat:1===u.depthStencilTarget?33189:34041,width:p,height:f}));const e=1===b?n.DEPTH_ATTACHMENT:n.DEPTH_STENCIL_ATTACHMENT;n.framebufferRenderbuffer(n.FRAMEBUFFER,e,n.RENDERBUFFER,this._depthAttachment.glName);break}case 2:this._stencilAttachment||(this._stencilAttachment=new s.a(l,{internalFormat:36168,width:p,height:f})),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){l.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const e={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:p,height:f};this._depthStencilTexture=new o.a(l,e)}n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,this._depthStencilTexture.glName,0)}Object(a.c)()&&n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=c,this._initialized=!0}_disposeColorAttachments(){this._colorAttachments.forEach(((e,t)=>{if(d(e)){if(this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,t,e.TEXTURE_2D,null,0)}e.dispose()}else if(e instanceof WebGLRenderbuffer){const r=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(e)}})),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateTextureDimensions(e,t){3553!==e.target&&console.error("Texture type must be TEXTURE_2D!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}_validateColorAttachmentPoint(e){if(-1===u._MAX_COLOR_ATTACHMENTS){const e=this._context.capabilities.drawBuffers;if(e){const t=this._context.gl;u._MAX_COLOR_ATTACHMENTS=t.getParameter(e.MAX_COLOR_ATTACHMENTS)}else u._MAX_COLOR_ATTACHMENTS=1}const t=e-36064;t+1>u._MAX_COLOR_ATTACHMENTS&&c.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${u._MAX_COLOR_ATTACHMENTS} color attachments`)}}function d(e){return"type"in e&&"texture"===e.type}function h(e,t){void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}u._MAX_COLOR_ATTACHMENTS=-1,t.a=u},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(21),n=r(334);class s{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const r of e.fieldNames){const t=e.fields.get(r);this[r]=new t.constructor(this.buffer,t.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null}slice(e,t){return new s(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t,r,i){const n=this.stride;if(n%4==0){const s=new Uint32Array(e.buffer,t*n,i*n/4);new Uint32Array(this.buffer,r*n,i*n/4).set(s)}else{const s=new Uint8Array(e.buffer,t*n,i*n);new Uint8Array(this.buffer,r*n,i*n).set(s)}}}class a{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,t){return this.appendField(e,i.m,t),this}vec2f64(e,t){return this.appendField(e,i.n,t),this}vec3f(e,t){return this.appendField(e,i.u,t),this}vec3f64(e,t){return this.appendField(e,i.v,t),this}vec4f(e,t){return this.appendField(e,i.C,t),this}vec4f64(e,t){return this.appendField(e,i.D,t),this}mat3f(e,t){return this.appendField(e,i.f,t),this}mat3f64(e,t){return this.appendField(e,i.g,t),this}mat4f(e,t){return this.appendField(e,i.h,t),this}mat4f64(e,t){return this.appendField(e,i.i,t),this}vec4u8(e,t){return this.appendField(e,i.J,t),this}f32(e,t){return this.appendField(e,i.a,t),this}f64(e,t){return this.appendField(e,i.b,t),this}u8(e,t){return this.appendField(e,i.l,t),this}u16(e,t){return this.appendField(e,i.j,t),this}i8(e,t){return this.appendField(e,i.e,t),this}vec2i8(e,t){return this.appendField(e,i.q,t),this}vec2i16(e,t){return this.appendField(e,i.o,t),this}vec2u8(e,t){return this.appendField(e,i.t,t),this}vec4u16(e,t){return this.appendField(e,i.H,t),this}u32(e,t){return this.appendField(e,i.k,t),this}appendField(e,t,r){const i=t.ElementCount*Object(n.a)(t.ElementType),s=this.stride;this.fields.set(e,{size:i,constructor:t,offset:s,optional:r}),this.stride+=i,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.indexOf(e)>=0}createBuffer(e){return new s(this,e)}createView(e){return new s(this,e)}clone(){const e=new a;return e.stride=this.stride,e.fields=new Map,this.fields.forEach(((t,r)=>e.fields.set(r,t))),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}}function o(){return new a}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s}));var i=r(6);const n=.1,s=.001;function a(e,t){const r=e.fragment;switch(t.alphaDiscardMode){case 0:r.code.add(i.a`
        #define discardOrAdjustAlpha(color) { if (color.a < ${i.a.float(s)}) { discard; } }
      `);break;case 1:r.code.add(i.a`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case 2:r.uniforms.add("textureAlphaCutoff","float"),r.code.add(i.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(i.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return a}));var i=r(31),n=r(6);const s=Object(i.g)(1,1,0,1),a=Object(i.g)(1,0,1,1);function o(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.constants.add("occludedHighlightFlag","vec4",s).add("unoccludedHighlightFlag","vec4",a),e.fragment.code.add(n.a`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}function l(e,t){e.bindTexture(t.highlightDepthTexture,"depthTex"),e.setUniform4f("highlightViewportPixelSz",0,0,t.inverseViewport[0],t.inverseViewport[1])}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return d})),r.d(t,"h",(function(){return h})),r.d(t,"i",(function(){return a})),r.d(t,"j",(function(){return s}));const i={func:513},n={func:519},s={mask:255},a={mask:0},o=e=>({function:{func:517,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7680}}),l=e=>({function:{func:519,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7681}}),c={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},u={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},d={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},h={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var i=r(6);function n(e,t){e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.code.add(i.a`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, cameraNearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `)}function s(e,t){t.multipassTerrainEnabled&&t.terrainLinearDepthTexture&&e.bindTexture(t.terrainLinearDepthTexture,"terrainDepthTexture")}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));var i=r(13);function n(e,t,r=!1){return l(e,t,r)}function s(e,t){if(null!=t)return t[e]||o(e.split("."),!1,t)}function a(e,t,r){const i=e.split("."),n=i.pop(),s=o(i,!0,r);s&&n&&(s[n]=t)}function o(e,t,r){let i=r;for(const n of e){if(null==i)return;if(!(n in i)){if(!t)return;i[n]={}}i=i[n]}return i}function l(e,t,r){return t?Object.keys(t).reduce((function(e,n){let s=e[n],a=t[n];return s===a?e:void 0===s?(e[n]=Object(i.a)(a),e):(Array.isArray(a)||Array.isArray(e)?(s=s?Array.isArray(s)?e[n]=s.concat():e[n]=[s]:e[n]=[],a&&(Array.isArray(a)||(a=[a]),r?a.forEach((e=>{-1===s.indexOf(e)&&s.push(e)})):e[n]=a.concat())):a&&"object"==typeof a?e[n]=l(s,a,r):e.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(e[n]=a),e)}),e||{}):e}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(2),n=r(513),s=r(236),a=r(136),o=r(33);class l extends s.a{constructor(e,t=[],r=0,i=-1){super(),this._primitiveType=r,this.edgeIndicesLength=i,this.type=2,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,s]of e)s&&this._vertexAttributes.set(n,{...s});if(null==t||0===t.length){const e=function(e){const t=e.values().next().value;return null==t?0:t.data.length/t.size}(this._vertexAttributes),t=Object(a.d)(e);this.edgeIndicesLength=this.edgeIndicesLength<0?e:this.edgeIndicesLength;for(const r of this._vertexAttributes.keys())this._indices.set(r,t)}else for(const[n,s]of t)s&&(this._indices.set(n,c(s)),"position"===n&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return Object(i.i)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)}computeAttachmentOriginTriangles(e){const t=this.indices.get("position"),r=this.vertexAttributes.get("position");return Object(a.c)(r,t,e)}computeAttachmentOriginPoints(e){const t=this.indices.get("position"),r=this.vertexAttributes.get("position");return Object(a.b)(r,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get("position");if(0===e.length)return null;const t=0===this.primitiveType?3:1;Object(o.a)(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const r=Object(a.d)(e.length/t),i=this.vertexAttributes.get("position");return new n.a(r,t,e,i)}}function c(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return u}));var i=r(180),n=r(13),s=r(2);function a(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function o(e,t){return null!=e&&e.metadatas&&null!=e.metadatas[t]}function l(e,t,r){return c(e,t,r?{policy:r,path:""}:null)}function c(e,t,r){return t?Object.keys(t).reduce((function(e,i){let a=null,o="merge";if(r&&(a=r.path?`${r.path}.${i}`:i,o=r.policy(a)),"replace"===o)return e[i]=t[i],e;if(void 0===e[i])return e[i]=Object(n.a)(t[i]),e;let l=e[i],u=t[i];if(l===u)return e;if(Array.isArray(u)||Array.isArray(e))l=l?Array.isArray(l)?e[i]=l.concat():e[i]=[l]:e[i]=[],u&&(Array.isArray(u)||(u=[u]),u.forEach((e=>{-1===l.indexOf(e)&&l.push(e)})));else if(u&&"object"==typeof u)if(r){const t=r.path;r.path=Object(s.d)(a),e[i]=c(l,u,r),r.path=t}else e[i]=c(l,u,null);else e.hasOwnProperty(i)&&!t.hasOwnProperty(i)||(e[i]=u);return e}),e||{}):e}function u(e){return e?"string"==typeof e&&-1===e.indexOf(".")?e:d(e):e}function d(e){return Array.isArray(e)?e:e.split(".")}function h(e){return e.indexOf(",")>-1?e.split(",").map((e=>e.trim())):[e.trim()]}function p(e,t,r,n){const s=function(e){if(Array.isArray(e)){const t=[];for(const r of e)t.push(...h(r));return t}return h(e)}(t);if(1!==s.length){const t=s.map((t=>n(e,t,r)));return Object(i.a)(t)}return n(e,s[0],r)}function f(e){let t=!1;return()=>{t||(t=!0,e())}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return l}));var i=r(2),n=r(12);function s(e,t,r){return Object(n.k)(e.map(((e,i)=>t.apply(r,[e,i]))))}function a(e,t,r){return Object(n.k)(e.map(((e,i)=>t.apply(r,[e,i])))).then((e=>e.map((e=>e.value))))}function o(e){return Object(i.i)(e)?Object(n.v)():e.then((e=>({ok:!0,value:e}))).catch((e=>({ok:!1,error:e})))}function l(e){return e.then((e=>({ok:!0,value:e}))).catch((e=>(Object(n.w)(e),{ok:!1,error:e})))}function c(e){if(!0===e.ok)return e.value;throw e.error}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return l}));var i=r(2),n=r(236),s=r(62),a=r(88);class o extends n.a{constructor(e,t){super(),this.type=3,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=s.a,this._params=Object(a.e)(e,t),this.validateParameterValues(this._params)}dispose(){}get params(){return this._params}update(e){return!1}setParameterValues(e){Object(a.k)(this._params,e)&&(this.validateParameterValues(this._params),this.parametersChanged())}validateParameterValues(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}isVisibleInPass(e){return!0}get renderOccluded(){return this.params.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){Object(i.j)(this.materialRepository)&&this.materialRepository.materialChanged(this)}}function l(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}const c={renderOccluded:1}},function(e,t,r){"use strict";class i{constructor(e,t,r,i=1,n=0){if(this.ctor=e,this.acquireFunction=t,this.releaseFunction=r,this.allocationSize=i,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let s=0;s<n;s++)this._pool[s]=new this.ctor;this.allocationSize=Math.max(i,1)}destroy(){this.prune(0)}acquire(...e){let t;if(i.test.disabled)t=new this.ctor;else{if(0===this._pool.length){const e=this.allocationSize;for(let t=0;t<e;t++)this._pool[t]=new this.ctor}t=this._pool.pop()}return this.acquireFunction?this.acquireFunction(t,...e):function(e){return e&&e.acquire&&"function"==typeof e.acquire}(t)&&t.acquire(...e),t}release(e){e&&!i.test.disabled&&(this.releaseFunction?this.releaseFunction(e):function(e){return e&&e.release&&"function"==typeof e.release}(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let t=e;t<this._pool.length;++t){const e=this._pool[t];this._dispose(e)}this._pool.length=e}}_dispose(e){e.dispose&&"function"==typeof e.dispose&&e.dispose()}}i.test={disabled:!1},t.a=i},function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return g})),r.d(t,"f",(function(){return w})),r.d(t,"g",(function(){return j})),r.d(t,"h",(function(){return _})),r.d(t,"i",(function(){return O})),r.d(t,"j",(function(){return v})),r.d(t,"k",(function(){return S}));var i=r(201),n=r(16),s=r(3),a=r(5),o=r(40),l=r(31),c=r(64),u=r(34);function d(e){return e?{ray:Object(c.c)(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(c.c)(),c0:0,c1:Number.MAX_VALUE}}function h(e,t,r=d()){const i=Object(s.r)(e.vector);return Object(c.f)(e.origin,t,r.ray),r.c0=0,r.c1=i,r}new i.a((()=>({c0:0,c1:0,ray:null})));var p=r(26);function f(e){return e?[Object(p.d)(e[0]),Object(p.d)(e[1]),Object(p.d)(e[2]),Object(p.d)(e[3]),Object(p.d)(e[4]),Object(p.d)(e[5])]:[Object(p.d)(),Object(p.d)(),Object(p.d)(),Object(p.d)(),Object(p.d)(),Object(p.d)()]}function b(){return[Object(a.e)(),Object(a.e)(),Object(a.e)(),Object(a.e)(),Object(a.e)(),Object(a.e)(),Object(a.e)(),Object(a.e)()]}function m(e,t=f()){for(let r=0;r<6;r++)Object(p.c)(e[r],t[r])}function g(e,t,r,i=M){const a=Object(n.m)(u.a.get(),t,e);Object(n.a)(a,a);for(let n=0;n<8;++n){const e=Object(o.m)(u.d.get(),T[n],a);Object(s.y)(i[n],e[0]/e[3],e[1]/e[3],e[2]/e[3])}y(r,i)}function y(e,t){Object(p.g)(t[4],t[0],t[3],e[0]),Object(p.g)(t[1],t[5],t[6],e[1]),Object(p.g)(t[4],t[5],t[1],e[2]),Object(p.g)(t[3],t[2],t[6],e[3]),Object(p.g)(t[0],t[1],t[2],e[4]),Object(p.g)(t[5],t[4],t[7],e[5])}function v(e,t){for(let r=0;r<6;r++)if(Object(p.q)(e[r],t))return!1;return!0}function O(e,t){return x(e,function(e,t=d()){return Object(c.b)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}(t,C.get()))}function j(e,t,r){return x(e,h(t,r,C.get()))}function _(e,t){for(let r=0;r<6;r++)if(Object(p.w)(e[r],t)>0)return!1;return!0}function w(e,t){for(let r=0;r<6;r++)if(Object(p.n)(e[r],t))return!1;return!0}function x(e,t){for(let r=0;r<6;r++)if(!Object(p.a)(e[r],t))return!1;return!0}const S={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},T=[Object(l.g)(-1,-1,-1,1),Object(l.g)(1,-1,-1,1),Object(l.g)(1,1,-1,1),Object(l.g)(-1,1,-1,1),Object(l.g)(-1,-1,1,1),Object(l.g)(1,-1,1,1),Object(l.g)(1,1,1,1),Object(l.g)(-1,1,1,1)],C=new i.a(d),M=b()},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return s}));const i=e=>class extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const r=this[t];this[t]=null,r&&"function"==typeof r.dispose&&r.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}};class n extends(i(class{})){}function s(){return(e,t)=>{var r,i;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(r=null==(i=e._managedDisposables)?void 0:i.slice())?r:[]),e._managedDisposables.unshift(t)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(183),n=r(6);function s(e){e.include(i.a),e.code.add(n.a`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},function(e,t,r){"use strict";function i(e,t){for(const[r,i]of e)if(t(i,r))return!0;return!1}function n(e,t){for(const[r,i]of e)if(t(i,r))return i;return null}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));const i=33984;var n;!function(e){e[e.Texture=0]="Texture",e[e.Buffer=1]="Buffer",e[e.VAO=2]="VAO",e[e.Program=3]="Program",e[e.Framebuffer=4]="Framebuffer",e[e.Renderbuffer=5]="Renderbuffer",e[e.COUNT=6]="COUNT"}(n||(n={}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return a}));var i=r(8),n=r(25);r(290);const s="4.20",a={request(e,t){var i;const n=null==(i=e.options)?void 0:i.responseType;return Promise.resolve().then(r.bind(null,84)).then((({default:r})=>{const i=e.options||{};return i.responseType="native"===n||"native-request-init"===n?"native-request-init":"array-buffer",i.signal=null==t?void 0:t.signal,r(e.url,i)})).then((e=>{const t={data:e.data,ssl:e.ssl};return"native-request-init"===e.requestOptions.responseType?(delete t.data.signal,t):{result:t,transferList:[t.data]}}))}};let o;function l(e){o=e}function c(e){const t=o&&o.findCredential(e);return t&&t.token?Object(n.d)(e,"token",t.token):e}Object(i.a)("host-webworker")||(Object(i.a)("edge")||Object(i.a)("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser")},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return c}));var i=r(62),n=r(257),s=r(66),a=r(47),o=r(90);function l(e,t=n.a,r=i.a,a=-1,l=1){let c=null;switch(t){case n.b:c=new Float32Array([a,a,0,0,l,a,1,0,a,l,0,1,l,l,1,1]);break;case n.a:default:c=new Float32Array([a,a,l,a,a,l,l,l])}return new o.a(e,r,{geometry:t},{geometry:s.a.createVertex(e,35044,c)})}function c(e,t=n.a,r=i.a){const a=new Float32Array([-1,-1,3,-1,-1,3]);return new o.a(e,r,{geometry:t},{geometry:s.a.createVertex(e,35044,a)})}function u(e,t=4){return new a.a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})}function d(e,t,r=4){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n+0]=255*t[0],i[n+1]=255*t[1],i[n+2]=255*t[2],i[n+3]=255*t[3];return new a.a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:r,height:r},i)}function h(e){return new a.a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return c})),r.d(t,"g",(function(){return h}));var i=r(10),n=r(201),s=r(3),a=r(5),o=r(34);function l(e){return e?{origin:Object(a.c)(e.origin),vector:Object(a.c)(e.vector)}:{origin:Object(a.e)(),vector:Object(a.e)()}}function c(e,t,r=l()){return Object(s.m)(r.origin,e),Object(s.m)(r.vector,t),r}function u(e,t,r=l()){return Object(s.m)(r.origin,e),Object(s.l)(r.vector,t,e),r}function d(e,t){const r=Object(s.l)(o.c.get(),t,e.origin),n=Object(s.j)(e.vector,r),a=Object(s.j)(e.vector,e.vector),l=Object(i.e)(n/a,0,1),c=Object(s.l)(o.c.get(),Object(s.g)(o.c.get(),e.vector,l),r);return Object(s.j)(c,c)}function h(e,t,r,n,a){const{vector:l,origin:c}=e,u=Object(s.l)(o.c.get(),t,c),d=Object(s.j)(l,u)/Object(s.v)(l);return Object(s.g)(a,l,Object(i.e)(d,r,n)),Object(s.h)(a,a,e.origin)}function p(e,t){if(b(e,function(e,t){const r=g.get();return r.origin=e,r.vector=t,r}(t.origin,t.direction),!1,m)){const{tA:t,pB:r,distance2:i}=m;if(t>=0&&t<=1)return i;if(t<0)return Object(s.n)(e.origin,r);if(t>1)return Object(s.n)(Object(s.h)(o.c.get(),e.origin,e.vector),r)}return null}function f(e,t,r){return!!b(e,t,!0,m)&&(Object(s.m)(r,m.pA),!0)}function b(e,t,r,n){const a=1e-6,l=e.origin,c=Object(s.h)(o.c.get(),l,e.vector),u=t.origin,d=Object(s.h)(o.c.get(),u,t.vector),h=o.c.get(),p=o.c.get();if(h[0]=l[0]-u[0],h[1]=l[1]-u[1],h[2]=l[2]-u[2],p[0]=d[0]-u[0],p[1]=d[1]-u[1],p[2]=d[2]-u[2],Math.abs(p[0])<a&&Math.abs(p[1])<a&&Math.abs(p[2])<a)return!1;const f=o.c.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<a&&Math.abs(f[1])<a&&Math.abs(f[2])<a)return!1;const b=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],m=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],g=h[0]*f[0]+h[1]*f[1]+h[2]*f[2],y=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],v=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*y-m*m;if(Math.abs(v)<a)return!1;let O=(b*m-g*y)/v,j=(b+m*O)/y;r&&(O=Object(i.e)(O,0,1),j=Object(i.e)(j,0,1));const _=o.c.get(),w=o.c.get();return _[0]=l[0]+O*f[0],_[1]=l[1]+O*f[1],_[2]=l[2]+O*f[2],w[0]=u[0]+j*p[0],w[1]=u[1]+j*p[1],w[2]=u[2]+j*p[2],n.tA=O,n.tB=j,n.pA=_,n.pB=w,n.distance2=Object(s.n)(_,w),!0}const m={tA:0,tB:0,pA:Object(a.e)(),pB:Object(a.e)(),distance2:0},g=new n.a((()=>({origin:null,vector:null})))},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(9),n=r(50),s=r(146),a=r(243),o=r(41),l=r(144),c=r(166);r(39),r(230),r(85);const u={base:s.a,key:"type",typeMap:{extent:n.a,multipoint:a.a,point:o.a,polyline:c.a,polygon:l.a}};Object(i.k)(u)},function(e,t,r){"use strict";var i=r(56),n=(r(8),r(99));const s={apiKey:void 0,applicationUrl:i.a.location&&i.a.location.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryService:null,geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(i.a.esriConfig&&(Object(n.a)(s,i.a.esriConfig,!0),delete s.has),!s.assetsPath){const e="4.20.2";s.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}s.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(s,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),s.request.corsEnabledServers=[],s.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0},t.a=s},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return a})),r.d(t,"f",(function(){return l}));var i=r(2),n=r(25);function s(e,t){const r=t&&t.url&&t.url.path;if(e&&r&&(e=Object(n.A)(e,r,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=Object(n.C)(e,t.portalItem.itemUrl);u.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return h(e,t&&t.portal)}function a(e,t,r=0){if(!e)return e;!Object(n.s)(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let i=Object(n.A)(e);if(t){const r=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(r){const s=h(r,t.portal);i=Object(n.C)(h(i,t.portal),s,s),i!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=function(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?Object(n.h)(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}(i,t&&t.portal),Object(n.s)(i)&&(i=Object(n.D)(i)),null!=t&&t.resources&&null!=t&&t.portalItem&&!Object(n.s)(i)&&!Object(n.u)(i)&&0===r&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i)}),i}function o(e,t,r){return s(e,r)}function l(e,t,r,i){const n=a(e,i);void 0!==n&&(t[r]=n)}const c=/\/items\/([^\/]+)\/resources\//,u=/^\.\/resources\//;function d(e){const t=Object(i.j)(e)?e.match(c):null;return Object(i.j)(t)?t[1]:null}function h(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const r=`${t.urlKey}.${t.customBaseUrl}`;return Object(n.q)(n.g,`${n.g.scheme}://${r}`)?Object(n.h)(e,t.portalHostname,r):Object(n.h)(e,r,t.portalHostname)}var p=Object.freeze({__proto__:null,fromJSON:s,toJSON:a,read:o,write:l,itemIdFromResourceUrl:d})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c}));var i=r(35),n=r(17),s=r(9),a=r(200);const o={type:i.a,json:{type:[s.a],default:null,read:{source:["color","transparency"],reader:function(e,t){const r=null!=t.transparency?Object(a.b)(t.transparency):1,n=t.color;return n&&Array.isArray(n)?new i.a([n[0]||0,n[1]||0,n[2]||0,r]):null}},write:{target:{color:{type:[s.a]},transparency:{type:s.a}},writer:function(e,t){t.color=e.toJSON().slice(0,3);const r=Object(a.a)(e.a);0!==r&&(t.transparency=r)}}}},l={type:Number,cast:n.j,json:{write:!0}},c={type:[Number],cast:e=>null!=e?e:Array.isArray(e)?e.map(n.j):null,json:{read:!1,write:!1}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){t.linearDepth?e.vertex.code.add(i.a`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(i.a`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},function(e,t,r){"use strict";var i=r(0),n=r(114),s=(r(340),r(110)),a=r(84),o=r(11),l=r(14),c=r(159),u=r(2),d=r(12),h=r(1),p=(r(8),r(9)),f=(r(7),r(32)),b=r(4),m=r(50),g=r(238),y=r(19);let v=class extends y.a{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};Object(i.a)([Object(h.b)()],v.prototype,"nextQueryParams",void 0),Object(i.a)([Object(h.b)()],v.prototype,"queryParams",void 0),Object(i.a)([Object(h.b)()],v.prototype,"results",void 0),Object(i.a)([Object(h.b)()],v.prototype,"total",void 0),v=Object(i.a)([Object(b.a)("esri.portal.PortalQueryResult")],v);var O,j=v,_=r(534),w=r(125);let x;const S={PortalGroup:()=>Promise.resolve().then(r.bind(null,561)),PortalItem:()=>Promise.resolve().then(r.bind(null,306)),PortalUser:()=>Promise.resolve().then(r.bind(null,534))};let T=O=class extends(Object(l.b)(c.a)){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=n.a.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return"string"==typeof e?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)-1===n.a.request.trustedServers.indexOf(t)&&n.a.request.trustedServers.push(t);return e}readDefaultBasemap(e){if(e){const t=x.fromJSON(e);return t.portalItem={portal:this},t}return null}readDefaultVectorBasemap(e){if(e){const t=x.fromJSON(e);return t.portalItem={portal:this},t}return null}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e?e.toLowerCase():e}readUser(e){let t=null;return e&&(t=_.default.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(r.bind(null,328)).then((({default:t})=>{Object(d.x)(e),x=t})).then((()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e))).then((e=>{if(s.b){const e=s.b;this.credential=e.findCredential(this.restUrl),this.credential||this.authMode!==O.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=e.on("credential-create",(()=>{e.findCredential(this.restUrl)&&this._signIn()})))}this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(t),Promise.resolve(this)}async createClosestFacilityTask(){await this.load();const e=this._getHelperServiceUrl("closestFacility");return new(0,(await r.e(68).then(r.bind(null,1167))).default)(e)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await r.e(23).then(r.bind(null,822))).default;return e?e.map((e=>new t({id:e.id,url:e.url}))):[]}async createGeometryService(){await this.load();const e=this._getHelperServiceUrl("geometry");return new(0,(await r.e(15).then(r.bind(null,676))).default)({url:e})}async createPrintTask(){await this.load();const e=this._getHelperServiceUrl("printTask");return new(0,(await r.e(139).then(r.bind(null,1155))).default)(e)}async createRouteTask(){await this.load();const e=this._getHelperServiceUrl("route");return new(0,(await r.e(69).then(r.bind(null,1172))).default)(e)}async createServiceAreaTask(){await this.load();const e=this._getHelperServiceUrl("serviceArea");return new(0,(await r.e(70).then(r.bind(null,1168))).default)(e)}fetchBasemaps(e,t){const r=new g.a;return r.query=e||(this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,t).then((e=>{if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',e.total){const i=e.results[0];return r.sortField=i.sortField||"name",r.sortOrder=i.sortOrder||"desc",i.queryItems(r,t)}return null})).then((e=>{let t;return t=e&&e.total?e.results.filter((e=>"Web Map"===e.type)).map((e=>new x({portalItem:e}))):[],t}))}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then((e=>e.categorySchema)):Object(d.o)(e)?Promise.reject(Object(d.f)()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,r=new g.a;if(r.num=100,r.sortField="title",t&&t.length){const i=[];for(const e of t)i.push(`(title:"${e.title}" AND owner:${e.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,e).then((e=>e.results))}return Object(d.o)(e)?Promise.reject(Object(d.f)()):Promise.resolve([])}fetchRegions(e){const t=this.user&&this.user.culture||this.culture||Object(w.b)();return this._request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}static getDefault(){return O._default&&!O._default.destroyed||(O._default=new O),O._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new o.a("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new O({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new o.a("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new o.a("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,r){const i=this.restUrl+"/portals/self",n={authMode:e,query:{culture:Object(w.b)().toLowerCase()},...r};return"auto"===n.authMode&&(n.authMode="no-prompt"),t&&(n.query.default=!0),this._request(i,n)}_queryPortal(e,t,r,i){const n=Object(p.m)(g.a,t),s=t=>this._request(this.restUrl+e,{...n.toRequestOptions(this),...i}).then((e=>{const r=n.clone();return r.start=e.nextStart,new j({nextQueryParams:r,queryParams:n,total:e.total,results:O._resultsToTypedArray(t,{portal:this},e,i)})})).then((e=>Promise.all(e.results.map((t=>"function"==typeof t.when?t.when():e))).then((()=>e),(t=>(Object(d.w)(t),e)))));return r&&S[r]?S[r]().then((({default:e})=>(Object(d.x)(i),s(e)))):s()}_signIn(){if(this.authMode===O.AUTH_MODE_ANONYMOUS)return Promise.reject(new o.a("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const e=e=>Promise.resolve().then((()=>"not-loaded"===this.loadStatus?(e||(this.authMode="immediate"),this.load().then((()=>null))):"loading"===this.loadStatus?this.load().then((()=>this.credential?null:(this.credential=e,this._fetchSelf("immediate")))):this.user&&this.credential===e?null:(this.credential=e,this._fetchSelf("immediate")))).then((e=>{e&&(this.sourceJSON=e,this.read(e))}));return s.b?s.b.getCredential(this.restUrl).then((t=>e(t))):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.indexOf("?")>-1?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,r){return this._request(e,t).then((e=>{const t=O._resultsToTypedArray(r,{portal:this},e);return Promise.all(t.map((t=>"function"==typeof t.when?t.when():e))).then((()=>t),(()=>t))}))}_request(e,t={}){const r={f:"json",...t.query},{authMode:i=(this.authMode===O.AUTH_MODE_ANONYMOUS?"anonymous":"auto"),body:n=null,cacheBust:s=!1,method:o="auto",responseType:l="json",signal:c}=t,u={authMode:i,body:n,cacheBust:s,method:o,query:r,responseType:l,timeout:0,signal:c};return Object(a.default)(this._normalizeSSL(e),u).then((e=>e.data))}static _resultsToTypedArray(e,t,r,i){let n;if(r){const s=Object(u.j)(i)?i.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(n=n.map((r=>{const i=Object.assign(e?e.fromJSON(r):r,t);return"function"==typeof i.load&&i.load(s),i})))}else n=[];return n}};T.AUTH_MODE_ANONYMOUS="anonymous",T.AUTH_MODE_AUTO="auto",T.AUTH_MODE_IMMEDIATE="immediate",Object(i.a)([Object(h.b)()],T.prototype,"access",void 0),Object(i.a)([Object(h.b)()],T.prototype,"allSSL",void 0),Object(i.a)([Object(h.b)()],T.prototype,"authMode",void 0),Object(i.a)([Object(h.b)()],T.prototype,"authorizedCrossOriginDomains",void 0),Object(i.a)([Object(f.a)("authorizedCrossOriginDomains")],T.prototype,"readAuthorizedCrossOriginDomains",null),Object(i.a)([Object(h.b)()],T.prototype,"basemapGalleryGroupQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"bingKey",void 0),Object(i.a)([Object(h.b)()],T.prototype,"canListApps",void 0),Object(i.a)([Object(h.b)()],T.prototype,"canListData",void 0),Object(i.a)([Object(h.b)()],T.prototype,"canListPreProvisionedItems",void 0),Object(i.a)([Object(h.b)()],T.prototype,"canProvisionDirectPurchase",void 0),Object(i.a)([Object(h.b)()],T.prototype,"canSearchPublic",void 0),Object(i.a)([Object(h.b)()],T.prototype,"canShareBingPublic",void 0),Object(i.a)([Object(h.b)()],T.prototype,"canSharePublic",void 0),Object(i.a)([Object(h.b)()],T.prototype,"canSignInArcGIS",void 0),Object(i.a)([Object(h.b)()],T.prototype,"canSignInIDP",void 0),Object(i.a)([Object(h.b)()],T.prototype,"colorSetsGroupQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"commentsEnabled",void 0),Object(i.a)([Object(h.b)({type:Date})],T.prototype,"created",void 0),Object(i.a)([Object(h.b)()],T.prototype,"credential",void 0),Object(i.a)([Object(h.b)()],T.prototype,"culture",void 0),Object(i.a)([Object(h.b)()],T.prototype,"currentVersion",void 0),Object(i.a)([Object(h.b)()],T.prototype,"customBaseUrl",void 0),Object(i.a)([Object(h.b)()],T.prototype,"defaultBasemap",void 0),Object(i.a)([Object(f.a)("defaultBasemap")],T.prototype,"readDefaultBasemap",null),Object(i.a)([Object(h.b)({type:m.a})],T.prototype,"defaultExtent",void 0),Object(i.a)([Object(h.b)()],T.prototype,"defaultVectorBasemap",void 0),Object(i.a)([Object(f.a)("defaultVectorBasemap")],T.prototype,"readDefaultVectorBasemap",null),Object(i.a)([Object(h.b)()],T.prototype,"description",void 0),Object(i.a)([Object(h.b)()],T.prototype,"eueiEnabled",void 0),Object(i.a)([Object(h.b)({readOnly:!0})],T.prototype,"extraQuery",null),Object(i.a)([Object(h.b)()],T.prototype,"featuredGroups",void 0),Object(i.a)([Object(h.b)()],T.prototype,"featuredItemsGroupQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"galleryTemplatesGroupQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"livingAtlasGroupQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"hasCategorySchema",void 0),Object(i.a)([Object(h.b)()],T.prototype,"helpBase",void 0),Object(i.a)([Object(h.b)()],T.prototype,"helperServices",void 0),Object(i.a)([Object(h.b)()],T.prototype,"helpMap",void 0),Object(i.a)([Object(h.b)()],T.prototype,"homePageFeaturedContent",void 0),Object(i.a)([Object(h.b)()],T.prototype,"homePageFeaturedContentCount",void 0),Object(i.a)([Object(h.b)()],T.prototype,"httpPort",void 0),Object(i.a)([Object(h.b)()],T.prototype,"httpsPort",void 0),Object(i.a)([Object(h.b)()],T.prototype,"id",void 0),Object(i.a)([Object(h.b)()],T.prototype,"ipCntryCode",void 0),Object(i.a)([Object(h.b)({readOnly:!0})],T.prototype,"isOrganization",null),Object(i.a)([Object(h.b)()],T.prototype,"isPortal",void 0),Object(i.a)([Object(h.b)()],T.prototype,"isReadOnly",void 0),Object(i.a)([Object(h.b)()],T.prototype,"layerTemplatesGroupQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"maxTokenExpirationMinutes",void 0),Object(i.a)([Object(h.b)({type:Date})],T.prototype,"modified",void 0),Object(i.a)([Object(h.b)()],T.prototype,"name",void 0),Object(i.a)([Object(h.b)()],T.prototype,"portalHostname",void 0),Object(i.a)([Object(h.b)()],T.prototype,"portalMode",void 0),Object(i.a)([Object(h.b)()],T.prototype,"portalProperties",void 0),Object(i.a)([Object(h.b)()],T.prototype,"region",void 0),Object(i.a)([Object(h.b)({readOnly:!0})],T.prototype,"restUrl",null),Object(i.a)([Object(h.b)()],T.prototype,"rotatorPanels",void 0),Object(i.a)([Object(h.b)()],T.prototype,"showHomePageDescription",void 0),Object(i.a)([Object(h.b)()],T.prototype,"sourceJSON",void 0),Object(i.a)([Object(h.b)()],T.prototype,"staticImagesUrl",void 0),Object(i.a)([Object(h.b)()],T.prototype,"stylesGroupQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"supportsHostedServices",void 0),Object(i.a)([Object(h.b)()],T.prototype,"symbolSetsGroupQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"templatesGroupQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"thumbnail",void 0),Object(i.a)([Object(h.b)({readOnly:!0})],T.prototype,"thumbnailUrl",null),Object(i.a)([Object(h.b)()],T.prototype,"units",void 0),Object(i.a)([Object(h.b)()],T.prototype,"url",void 0),Object(i.a)([Object(h.b)()],T.prototype,"urlKey",void 0),Object(i.a)([Object(f.a)("urlKey")],T.prototype,"readUrlKey",null),Object(i.a)([Object(h.b)()],T.prototype,"user",void 0),Object(i.a)([Object(f.a)("user")],T.prototype,"readUser",null),Object(i.a)([Object(h.b)()],T.prototype,"useStandardizedQuery",void 0),Object(i.a)([Object(h.b)()],T.prototype,"useVectorBasemaps",void 0),Object(i.a)([Object(h.b)()],T.prototype,"vectorBasemapGalleryGroupQuery",void 0),T=O=Object(i.a)([Object(b.a)("esri.portal.Portal")],T);var C=T;t.a=C},function(e,t,r){"use strict";var i=r(0),n=(r(340),r(295)),s=r(202),a=r(68),o=r(42),l=(r(8),r(13)),c=r(7),u=r(206),d=r(12),h=r(454),p=r(23),f=r(1),b=r(45),m=r(4),g=r(65),y=r(385),v=r(260);r(459);const O={handleInterceptedEvent:(e,t,r,i)=>(e.scheduleRender(),t.properties[`on${i.type}`].apply(t.properties.bind||r,[i]))},j={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}},_=(e,t,r=!1)=>{let i=e;return t.forEach(((e,n)=>{var s;const a=null!=(s=i)&&s.children?((e,t)=>e.find(t))(i.children,(t=>t.domNode===e)):void 0;r&&!a&&n!==t.length-1||(i=a)})),i},w=!1,x=!0,S=!0,T=!0,C=!0,M=!0,P=!0,A=!0,E=!0,R=!0,I=!0,D=!0,F=!0,L=!0,k=!0,z=!0,V=!0,N=!0,U=!0,B=!0,G=!0,q=!0,H=!0,W=!0,$=!0,Q=!0,Z=!0,X=!0,J=!0,Y=!0,K=!0,ee=!1,te=!1,re=!1,ie=!1,ne=!1,se=!1,ae=!1,oe=!1,le=!1,ce=!0,ue=!1,de=!0,he=!1,pe=!1,fe=!0,be=!1,me=!1,ge=!0,ye="app";let ve,Oe,je,_e,we=0,xe=!1,Se=!1,Te=!1,Ce=!1,Me=null,Pe=0,Ae=!1;const Ee="undefined"!==typeof window?window:{},Re=(pe&&Ee.CSS,Ee.document||{head:{}}),Ie=(Ee.HTMLElement,{$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,r,i)=>e.addEventListener(t,r,i),rel:(e,t,r,i)=>e.removeEventListener(t,r,i),ce:(e,t)=>new CustomEvent(e,t)}),De=!he||!L||(()=>(Re.head.attachShadow+"").indexOf("[native")>-1)(),Fe="sty-id",Le="http://www.w3.org/1999/xlink",ke=(e,t="")=>{if(le&&performance.mark){const r=`st:${e}:${t}:${we++}`;return performance.mark(r),()=>performance.measure(`[Stencil] ${e}() <${t}>`,r)}return()=>{}},ze=new WeakMap,Ve=(e,t,r,i)=>{let n=Ue(t,r),s=Gt.get(n);if(!ge)return n;if(e=11===e.nodeType?e:Re,s)if("string"===typeof s){e=e.head||e;let r,a=ze.get(e);if(a||ze.set(e,a=new Set),!a.has(n)){if(se&&e.host&&(r=e.querySelector(`[sty-id="${n}"]`)))r.innerHTML=s;else{if(pe&&Ie.$cssShim$){r=Ie.$cssShim$.createHostStyle(i,n,s,!!(10&t.$flags$));const e=r["s-sc"];e&&(n=e,a=null)}else r=Re.createElement("style"),r.innerHTML=s;(ne||ee)&&r.setAttribute(Fe,n),e.insertBefore(r,e.querySelector("link"))}a&&a.add(n)}}else fe&&!e.adoptedStyleSheets.includes(s)&&(e.adoptedStyleSheets=[...e.adoptedStyleSheets,s]);return n},Ne=e=>{const t=e.$cmpMeta$,r=e.$hostElement$,i=t.$flags$,n=ke("attachStyles",t.$tagName$),s=Ve(L&&De&&r.shadowRoot?r.shadowRoot:r.getRootNode(),t,e.$modeName$,r);(L||F)&&z&&10&i&&(r["s-sc"]=s,r.classList.add(s+"-h"),F&&2&i&&r.classList.add(s+"-s")),n()},Ue=(e,t)=>"sc-"+(I&&t&&32&e.$flags$?e.$tagName$+"-"+t:e.$tagName$),Be={},Ge=e=>"object"===(e=typeof e)||"function"===e,qe=(e,t,...r)=>{let i=null,n=null,s=null,a=!1,o=!1,l=[];const c=t=>{for(let r=0;r<t.length;r++)i=t[r],Array.isArray(i)?c(i):null!=i&&"boolean"!==typeof i&&((a="function"!==typeof e&&!Ge(i))?i=String(i):re&&"function"!==typeof e&&void 0===i.$flags$&&Ut("vNode passed as children has unexpected type.\nMake sure it's using the correct h() function.\nEmpty objects can also be the cause, look for JSX comments that became objects."),a&&o?l[l.length-1].$text$+=i:l.push(a?He(null,i):i),o=a)};if(c(r),t&&(re&&"input"===e&&Je(t),W&&t.key&&(n=t.key),ce&&t.name&&(s=t.name),q)){const e=t.className||t.class;e&&(t.class="object"!==typeof e?e:Object.keys(e).filter((t=>e[t])).join(" "))}if(re&&l.some($e)&&Ut("The <Host> must be the single root component. Make sure:\n- You are NOT using hostData() and <Host> in the same component.\n- <Host> is used once, and it's the single root component of the render() function."),H&&"function"===typeof e)return e(null===t?{}:t,l,Qe);const u=He(e,null);return u.$attrs$=t,l.length>0&&(u.$children$=l),W&&(u.$key$=n),ce&&(u.$name$=s),u},He=(e,t)=>{const r={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return B&&(r.$attrs$=null),W&&(r.$key$=null),ce&&(r.$name$=null),r},We={},$e=e=>e&&e.$tag$===We,Qe={forEach:(e,t)=>e.map(Ze).forEach(t),map:(e,t)=>e.map(Ze).map(t).map(Xe)},Ze=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),Xe=e=>{if("function"===typeof e.vtag){const t=Object.assign({},e.vattrs);return e.vkey&&(t.key=e.vkey),e.vname&&(t.name=e.vname),qe(e.vtag,t,...e.vchildren||[])}const t=He(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},Je=e=>{const t=Object.keys(e),r=t.indexOf("type"),i=t.indexOf("min"),n=t.indexOf("max"),s=t.indexOf("min"),a=t.indexOf("value");-1!==a&&(a<r||a<i||a<n||a<s)&&Bt('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},Ye=(e,t,r,i,n,s)=>{if(r!==i){let o=zt(e,t),l=t.toLowerCase();if(q&&"class"===t){const t=e.classList,n=et(r),s=et(i);t.remove(...n.filter((e=>e&&!s.includes(e)))),t.add(...s.filter((e=>e&&!n.includes(e))))}else if(J&&"style"===t){if(U)for(const t in r)i&&null!=i[t]||(!ne&&t.includes("-")?e.style.removeProperty(t):e.style[t]="");for(const t in i)r&&i[t]===r[t]||(!ne&&t.includes("-")?e.style.setProperty(t,i[t]):e.style[t]=i[t])}else if(W&&"key"===t);else if(Q&&"ref"===t)i&&i(e);else if(!$||(oe?o:e.__lookupSetter__(t))||"o"!==t[0]||"n"!==t[1]){if(Z){const c=Ge(i);if((o||c&&null!==i)&&!n)try{if(e.tagName.includes("-"))e[t]=i;else{let n=null==i?"":i;"list"===t?o=!1:null!=r&&e[t]==n||(e[t]=n)}}catch(a){}let u=!1;G&&l!==(l=l.replace(/^xlink\:?/,""))&&(t=l,u=!0),null==i||!1===i?!1===i&&""!==e.getAttribute(t)||(G&&u?e.removeAttributeNS(Le,t):e.removeAttribute(t)):(!o||4&s||n)&&!c&&(i=!0===i?"":i,G&&u?e.setAttributeNS(Le,t,i):e.setAttribute(t,i))}}else t="-"===t[2]?t.slice(3):zt(Ee,l)?l.slice(2):l[2]+t.slice(3),r&&Ie.rel(e,t,r,!1),i&&Ie.ael(e,t,i,!1)}},Ke=/\s/,et=e=>e?e.split(Ke):[],tt=(e,t,r,i)=>{const n=11===t.$elm$.nodeType&&t.$elm$.host?t.$elm$.host:t.$elm$,s=e&&e.$attrs$||Be,a=t.$attrs$||Be;if(U)for(i in s)i in a||Ye(n,i,s[i],void 0,r,t.$flags$);for(i in a)Ye(n,i,s[i],a[i],r,t.$flags$)},rt=(e,t,r,i)=>{let n,s,a,o=t.$children$[r],l=0;if(ce&&!xe&&(Te=!0,"slot"===o.$tag$&&(ve&&i.classList.add(ve+"-s"),o.$flags$|=o.$children$?2:1)),re&&o.$elm$&&Ut(`The JSX ${null!==o.$text$?`"${o.$text$}" text`:`"${o.$tag$}" element`} node should not be shared within the same renderer. The renderer caches element lookups in order to improve performance. However, a side effect from this is that the exact same JSX node should not be reused. For more information please see https://stenciljs.com/docs/templating-jsx#avoid-shared-jsx-nodes`),Y&&null!==o.$text$)n=o.$elm$=Re.createTextNode(o.$text$);else if(ce&&1&o.$flags$)n=o.$elm$=te||ne?mt(o):Re.createTextNode("");else{if(N&&!Ce&&(Ce="svg"===o.$tag$),n=o.$elm$=N?Re.createElementNS(Ce?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",ce&&2&o.$flags$?"slot-fb":o.$tag$):Re.createElement(ce&&2&o.$flags$?"slot-fb":o.$tag$),N&&Ce&&"foreignObject"===o.$tag$&&(Ce=!1),B&&tt(null,o,Ce),(L||F)&&null!=ve&&n["s-si"]!==ve&&n.classList.add(n["s-si"]=ve),o.$children$)for(l=0;l<o.$children$.length;++l)s=rt(e,o,l,n),s&&n.appendChild(s);N&&("svg"===o.$tag$?Ce=!1:"foreignObject"===n.tagName&&(Ce=!0))}return ce&&(n["s-hn"]=je,3&o.$flags$&&(n["s-sr"]=!0,n["s-cr"]=Oe,n["s-sn"]=o.$name$||"",a=e&&e.$children$&&e.$children$[r],a&&a.$tag$===o.$tag$&&e.$elm$&&it(e.$elm$,!1))),n},it=(e,t)=>{Ie.$flags$|=1;const r=e.childNodes;for(let i=r.length-1;i>=0;i--){const e=r[i];e["s-hn"]!==je&&e["s-ol"]&&(lt(e).insertBefore(e,ot(e)),e["s-ol"].remove(),e["s-ol"]=void 0,Te=!0),t&&it(e,t)}Ie.$flags$&=-2},nt=(e,t,r,i,n,s)=>{let a,o=ce&&e["s-cr"]&&e["s-cr"].parentNode||e;for(L&&o.shadowRoot&&o.tagName===je&&(o=o.shadowRoot);n<=s;++n)i[n]&&(a=rt(null,r,n,e),a&&(i[n].$elm$=a,o.insertBefore(a,ce?ot(t):t)))},st=(e,t,r,i,n)=>{for(;t<=r;++t)(i=e[t])&&(n=i.$elm$,ft(i),ce&&(Se=!0,n["s-ol"]?n["s-ol"].remove():it(n,!0)),n.remove())},at=(e,t)=>e.$tag$===t.$tag$&&(ce&&"slot"===e.$tag$?e.$name$===t.$name$:!W||e.$key$===t.$key$),ot=e=>e&&e["s-ol"]||e,lt=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,ct=(e,t)=>{const r=t.$elm$=e.$elm$,i=e.$children$,n=t.$children$,s=t.$tag$,a=t.$text$;let o;Y&&null!==a?Y&&ce&&(o=r["s-cr"])?o.parentNode.textContent=a:Y&&e.$text$!==a&&(r.data=a):(N&&(Ce="svg"===s||"foreignObject"!==s&&Ce),(B||D)&&(k&&"slot"===s||tt(e,t,Ce)),U&&null!==i&&null!==n?((e,t,r,i)=>{let n,s,a=0,o=0,l=0,c=0,u=t.length-1,d=t[0],h=t[u],p=i.length-1,f=i[0],b=i[p];for(;a<=u&&o<=p;)if(null==d)d=t[++a];else if(null==h)h=t[--u];else if(null==f)f=i[++o];else if(null==b)b=i[--p];else if(at(d,f))ct(d,f),d=t[++a],f=i[++o];else if(at(h,b))ct(h,b),h=t[--u],b=i[--p];else if(at(d,b))!ce||"slot"!==d.$tag$&&"slot"!==b.$tag$||it(d.$elm$.parentNode,!1),ct(d,b),e.insertBefore(d.$elm$,h.$elm$.nextSibling),d=t[++a],b=i[--p];else if(at(h,f))!ce||"slot"!==d.$tag$&&"slot"!==b.$tag$||it(h.$elm$.parentNode,!1),ct(h,f),e.insertBefore(h.$elm$,d.$elm$),h=t[--u],f=i[++o];else{if(l=-1,W)for(c=a;c<=u;++c)if(t[c]&&null!==t[c].$key$&&t[c].$key$===f.$key$){l=c;break}W&&l>=0?(s=t[l],s.$tag$!==f.$tag$?n=rt(t&&t[o],r,l,e):(ct(s,f),t[l]=void 0,n=s.$elm$),f=i[++o]):(n=rt(t&&t[o],r,o,e),f=i[++o]),n&&(ce?lt(d.$elm$).insertBefore(n,ot(d.$elm$)):d.$elm$.parentNode.insertBefore(n,d.$elm$))}a>u?nt(e,null==i[p+1]?null:i[p+1].$elm$,r,i,o,p):U&&o>p&&st(t,a,u)})(r,i,t,n):null!==n?(U&&Y&&null!==e.$text$&&(r.textContent=""),nt(r,null,t,n,0,n.length-1)):U&&null!==i&&st(i,0,i.length-1),N&&Ce&&"svg"===s&&(Ce=!1))},ut=e=>{let t,r,i,n,s,a,o=e.childNodes;for(r=0,i=o.length;r<i;r++)if(t=o[r],1===t.nodeType){if(t["s-sr"])for(s=t["s-sn"],t.hidden=!1,n=0;n<i;n++)if(a=o[n].nodeType,o[n]["s-hn"]!==t["s-hn"]||""!==s){if(1===a&&s===o[n].getAttribute("slot")){t.hidden=!0;break}}else if(1===a||3===a&&""!==o[n].textContent.trim()){t.hidden=!0;break}ut(t)}},dt=[],ht=e=>{let t,r,i,n,s,a,o=0,l=e.childNodes,c=l.length;for(;o<c;o++){if(t=l[o],t["s-sr"]&&(r=t["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,n=t["s-sn"],a=i.length-1;a>=0;a--)r=i[a],r["s-cn"]||r["s-nr"]||r["s-hn"]===t["s-hn"]||(pt(r,n)?(s=dt.find((e=>e.$nodeToRelocate$===r)),Se=!0,r["s-sn"]=r["s-sn"]||n,s?s.$slotRefNode$=t:dt.push({$slotRefNode$:t,$nodeToRelocate$:r}),r["s-sr"]&&dt.map((e=>{pt(e.$nodeToRelocate$,r["s-sn"])&&(s=dt.find((e=>e.$nodeToRelocate$===r)),s&&!e.$slotRefNode$&&(e.$slotRefNode$=s.$slotRefNode$))}))):dt.some((e=>e.$nodeToRelocate$===r))||dt.push({$nodeToRelocate$:r}));1===t.nodeType&&ht(t)}},pt=(e,t)=>1===e.nodeType?null===e.getAttribute("slot")&&""===t||e.getAttribute("slot")===t:e["s-sn"]===t||""===t,ft=e=>{Q&&(e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(ft))},bt=(e,t)=>{const r=e.$hostElement$,i=e.$cmpMeta$,n=e.$vnode$||He(null,null),s=$e(t)?t:qe(null,null,t);if(je=r.tagName,re&&Array.isArray(t)&&t.some($e))throw new Error(`The <Host> must be the single root component.\nLooks like the render() function of "${je.toLowerCase()}" is returning an array that contains the <Host>.\n\nThe render() function should look like this instead:\n\nrender() {\n  // Do not return an array\n  return (\n    <Host>{content}</Host>\n  );\n}\n  `);if(D&&i.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},i.$attrsToReflect$.map((([e,t])=>s.$attrs$[t]=r[e]))),s.$tag$=null,s.$flags$|=4,e.$vnode$=s,s.$elm$=n.$elm$=L&&r.shadowRoot||r,(F||L)&&(ve=r["s-sc"]),ce&&(Oe=r["s-cr"],xe=De&&0!==(1&i.$flags$),Se=!1),ct(n,s),ce){if(Ie.$flags$|=1,Te){let e,t,r,i,n,a;ht(s.$elm$);let o=0;for(;o<dt.length;o++)e=dt[o],t=e.$nodeToRelocate$,t["s-ol"]||(r=te||ne?gt(t):Re.createTextNode(""),r["s-nr"]=t,t.parentNode.insertBefore(t["s-ol"]=r,t));for(o=0;o<dt.length;o++)if(e=dt[o],t=e.$nodeToRelocate$,e.$slotRefNode$){for(i=e.$slotRefNode$.parentNode,n=e.$slotRefNode$.nextSibling,r=t["s-ol"];r=r.previousSibling;)if(a=r["s-nr"],a&&a["s-sn"]===t["s-sn"]&&i===a.parentNode&&(a=a.nextSibling,!a||!a["s-nr"])){n=a;break}(!n&&i!==t.parentNode||t.nextSibling!==n)&&t!==n&&(!t["s-hn"]&&t["s-ol"]&&(t["s-hn"]=t["s-ol"].parentNode.nodeName),i.insertBefore(t,n))}else 1===t.nodeType&&(t.hidden=!0)}Se&&ut(s.$elm$),Ie.$flags$&=-2,dt.length=0}},mt=e=>Re.createComment(`<slot${e.$name$?' name="'+e.$name$+'"':""}> (host=${je.toLowerCase()})`),gt=e=>Re.createComment("org-location for "+(e.localName?`<${e.localName}> (host=${e["s-hn"]})`:`[${e.textContent}]`)),yt=(e,t,r)=>{const i=(e=>oe?kt(e).$hostElement$:e)(e);return{emit:e=>(re&&!i.isConnected&&Bt(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),vt(i,t,{bubbles:!!(4&r),composed:!!(2&r),cancelable:!!(1&r),detail:e}))}},vt=(e,t,r)=>{const i=Ie.ce(t,r);return e.dispatchEvent(i),i},Ot=(e,t)=>{be&&t&&!e.$onRenderResolve$&&t["s-p"]&&t["s-p"].push(new Promise((t=>e.$onRenderResolve$=t)))},jt=(e,t)=>{if(K&&U&&(e.$flags$|=16),be&&4&e.$flags$)return void(e.$flags$|=512);Ot(e,e.$ancestorComponent$);const r=()=>_t(e,t);return K?Yt(r):r()},_t=(e,t)=>{const r=e.$hostElement$,i=ke("scheduleUpdate",e.$cmpMeta$.$tagName$),n=oe?e.$lazyInstance$:r;let s;return t?(oe&&E&&(e.$flags$|=256,e.$queuedListeners$&&(e.$queuedListeners$.map((([e,t])=>Mt(n,e,t))),e.$queuedListeners$=null)),At(r,"componentWillLoad"),C&&(s=Mt(n,"componentWillLoad"))):(At(r,"componentWillUpdate"),M&&(s=Mt(n,"componentWillUpdate"))),At(r,"componentWillRender"),P&&(s=Pt(s,(()=>Mt(n,"componentWillRender")))),i(),Pt(s,(()=>wt(e,n,t)))},wt=async(e,t,r)=>{const i=e.$hostElement$,n=ke("update",e.$cmpMeta$.$tagName$),s=i["s-rc"];V&&r&&Ne(e);const a=ke("render",e.$cmpMeta$.$tagName$);if(re&&(e.$flags$|=1024),ne?await xt(e,t,i):xt(e,t,i),pe&&Ie.$cssShim$&&Ie.$cssShim$.updateHost(i),re&&(e.$renderCount$++,e.$flags$&=-1025),ne)try{Rt(i),r&&(1&e.$cmpMeta$.$flags$?i["s-en"]="":2&e.$cmpMeta$.$flags$&&(i["s-en"]="c"))}catch(o){Vt(o,i)}if(be&&s&&(s.map((e=>e())),i["s-rc"]=void 0),a(),n(),be){const t=i["s-p"],r=()=>St(e);0===t.length?r():(Promise.all(t).then(r),e.$flags$|=4,t.length=0)}else St(e)},xt=(e,t,r)=>{const i=!!w,n=!!oe,s=!!K,a=!!U;try{if(Me=t,t=(i||t.render)&&t.render(),a&&s&&(e.$flags$&=-17),(a||n)&&(e.$flags$|=2),A||D)if(X||D){if(ne)return Promise.resolve(t).then((t=>bt(e,t)));bt(e,t)}else r.textContent=t}catch(o){Vt(o,e.$hostElement$)}return Me=null,null},St=e=>{const t=e.$cmpMeta$.$tagName$,r=e.$hostElement$,i=ke("postUpdate",t),n=oe?e.$lazyInstance$:r,s=e.$ancestorComponent$;T&&(re&&(e.$flags$|=1024),Mt(n,"componentDidRender"),re&&(e.$flags$&=-1025)),At(r,"componentDidRender"),64&e.$flags$?(S&&(re&&(e.$flags$|=1024),Mt(n,"componentDidUpdate"),re&&(e.$flags$&=-1025)),At(r,"componentDidUpdate"),i()):(e.$flags$|=64,be&&z&&Et(r),x&&(re&&(e.$flags$|=2048),Mt(n,"componentDidLoad"),re&&(e.$flags$&=-2049)),At(r,"componentDidLoad"),i(),be&&(e.$onReadyResolve$(r),s||Ct(t))),ee&&r["s-hmr-load"]&&r["s-hmr-load"](),R&&oe&&e.$onInstanceResolve$(r),be&&(e.$onRenderResolve$&&(e.$onRenderResolve$(),e.$onRenderResolve$=void 0),512&e.$flags$&&Jt((()=>jt(e,!1))),e.$flags$&=-517)},Tt=e=>{if(U){const t=kt(e),r=t.$hostElement$.isConnected;return r&&2===(18&t.$flags$)&&jt(t,!1),r}return!1},Ct=e=>{z&&Et(Re.documentElement),me&&(Ie.$flags$|=2),Jt((()=>vt(Ee,"appload",{detail:{namespace:ye}}))),le&&performance.measure&&performance.measure(`[Stencil] app initial load (by ${e})`,"st:app:start")},Mt=(e,t,r)=>{if(e&&e[t])try{return e[t](r)}catch(i){Vt(i)}},Pt=(e,t)=>e&&e.then?e.then(t):t(),At=(e,t)=>{ae&&vt(e,"stencil_"+t,{bubbles:!0,composed:!0,detail:{namespace:ye}})},Et=e=>de?e.classList.add("hydrated"):ue?e.setAttribute("hydrated",""):void 0,Rt=e=>{const t=e.children;if(null!=t)for(let r=0,i=t.length;r<i;r++){const e=t[r];"function"===typeof e.connectedCallback&&e.connectedCallback(),Rt(e)}},It=e=>{De?e.attachShadow({mode:"open"}):e.shadowRoot=e},Dt=e=>{const t=new URL(e,Ie.$resourcesUrl$);return t.origin!==Ee.location.origin?t.href:t.pathname},Ft=(e,t)=>t,Lt=new WeakMap,kt=e=>Lt.get(e),zt=(e,t)=>t in e,Vt=(e,t)=>(_e||console.error)(e,t),Nt=ie?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],Ut=(...e)=>console.error(...Nt,...e),Bt=(...e)=>console.warn(...Nt,...e),Gt=new Map,qt=[],Ht=[],Wt=[],$t=(e,t)=>r=>{e.push(r),Ae||(Ae=!0,t&&4&Ie.$flags$?Jt(Xt):Ie.raf(Xt))},Qt=e=>{for(let r=0;r<e.length;r++)try{e[r](performance.now())}catch(t){Vt(t)}e.length=0},Zt=(e,t)=>{let r=0,i=0;for(;r<e.length&&(i=performance.now())<t;)try{e[r++](i)}catch(n){Vt(n)}r===e.length?e.length=0:0!==r&&e.splice(0,r)},Xt=()=>{if(me&&Pe++,Qt(qt),me){const e=2===(6&Ie.$flags$)?performance.now()+14*Math.ceil(.1*Pe):1/0;Zt(Ht,e),Zt(Wt,e),Ht.length>0&&(Wt.push(...Ht),Ht.length=0),(Ae=qt.length+Ht.length+Wt.length>0)?Ie.raf(Xt):Pe=0}else Qt(Ht),(Ae=qt.length>0)&&Ie.raf(Xt)},Jt=e=>{return Promise.resolve(t).then(e);var t},Yt=$t(Ht,!0),Kt=!0;function er(e,t){const r={Up:"ArrowUp",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Spacebar:" ",Esc:"Escape"}[e]||e,i="rtl"===t;return i&&"ArrowLeft"===r?"ArrowRight":i&&"ArrowRight"===r?"ArrowLeft":r}function tr(e){const t=er(e);return" "===t||"Spacebar"===t}const rr=["0","1","2","3","4","5","6","7","8","9"],ir=(HTMLElement,"calcite-theme-dark"),nr="calcite--rtl";const sr=()=>[2,1,1,1,3].map((e=>{let t="";for(let r=0;r<e;r++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t})).join("-");function ar(e){return e?e.id=e.id||`${e.tagName.toLowerCase()}-${sr()}`:""}function or(e){return Array.isArray(e)?e:Array.from(e)}function lr(e,t){return Array.from(e.attributes).filter((e=>e&&!t.includes(e.name))).reduce(((e,{name:t,value:r})=>Object.assign(Object.assign({},e),{[t]:r})),{})}function cr(e){return br(`.${ir}`,e)?"dark":"light"}function ur(e){return dr(e,"dir","ltr",!0)}function dr(e,t,r,i=!1){const n=`[${t}]`,s=i?br(n,e):e.closest(n);return s?s.getAttribute(t):r}function hr(e){return e.getRootNode()}function pr(e){return e.host||null}function fr(e,t){return function e(r){if(!r)return null;r.assignedSlot&&(r=r.assignedSlot);const i=hr(r),n=i.querySelector(t),s=pr(i);return n||(s?e(s):null)}(e)}function br(e,t=this){return function t(r){if(!r||r===document||r===window)return null;const i=r.closest(e);return i||t(r.getRootNode().host)}(t)}async function mr(e){e&&("function"===typeof e.setFocus?e.setFocus():e.focus())}function gr(e,t,r){const i=`[slot="${t}"]`;return(null===r||void 0===r?void 0:r.all)?function(e,t,r){let i=Array.from(e.querySelectorAll(t));i=r&&!1===r.direct?i:i.filter((t=>t.parentElement===e));const n=null===r||void 0===r?void 0:r.selector;return n?i.map((e=>Array.from(e.querySelectorAll(n)))).reduce(((e,t)=>[...e,...t]),[]).filter((e=>!!e)):i}(e,i,r):function(e,t,r){let i=e.querySelector(t);i=r&&!1===r.direct||(null===i||void 0===i?void 0:i.parentElement)===e?i:null;const n=null===r||void 0===r?void 0:r.selector;return n?i.querySelector(n):i}(e,i,r)}function yr(e,t){return Array.from(e.children).filter((e=>e.matches(t)))}function vr(e,t){return e.contains(t)}function Or(e,t,r){return"string"===typeof t&&""!==t?t:""===t?e[r]:void 0}HTMLElement;const jr="button",_r="button--text-visible",wr="button--compact",xr="icon-container",Sr="slot-container",Tr="slot-container--hidden",Cr="text-container",Mr="text-container--visible",Pr="Loading",Ar=(HTMLElement,"chevrons-left"),Er="chevrons-right";function Rr({parent:e,expanded:t}){Array.from(e.querySelectorAll("calcite-action")).filter((e=>"menu-actions"!==e.slot)).forEach((e=>e.textEnabled=t)),e.querySelectorAll("calcite-action-group").forEach((e=>e.expanded=t))}const Ir=({expanded:e,intlExpand:t,intlCollapse:r,toggle:i,el:n,position:s,tooltip:a,ref:o})=>{const l="rtl"===ur(n),c=e?r:t,u=[Ar,Er];l&&u.reverse();const d="end"===function(e,t){var r;return e||(null===(r=t.closest("calcite-shell-panel"))||void 0===r?void 0:r.position)||"start"}(s,n),h=d?u[1]:u[0],p=d?u[0]:u[1],f=qe("calcite-action",{dir:l?"rtl":"ltr",icon:e?h:p,onClick:i,ref:t=>(({tooltip:e,referenceElement:t,expanded:r,ref:i})=>(e&&(e.referenceElement=!r&&t),i&&i(t),t))({tooltip:a,referenceElement:t,expanded:e,ref:o}),text:c,textEnabled:e});return a?qe("calcite-tooltip-manager",null,f):f},Dr="action-group--bottom",Fr="bottom-actions",Lr="expand-tooltip",kr="Expand",zr="Collapse",Vr=({actionCount:e,height:t,groupCount:r})=>Math.max(e-(({height:e,groupCount:t})=>Math.floor((e-18*t)/50))({height:t,groupCount:r}),0),Nr=(HTMLElement,"menu-actions"),Ur="menu-tooltip",Br="More",Gr="menu-button",qr="menu",Hr="ellipsis",Wr="tooltip";HTMLElement;function $r(e,t){return(e+t)%t}const Qr=["ArrowUp","ArrowDown"],Zr=["ArrowUp","ArrowDown","End","Home"],Xr=(HTMLElement,"action-group--bottom"),Jr="container",Yr="Expand",Kr="Collapse",ei="expand-tooltip",ti=(HTMLElement,"close"),ri={slow:14e3,medium:1e4,fast:6e3},ii="title",ni="message",si="link";var ai;!function(e){e.green="checkCircle",e.yellow="exclamationMarkTriangle",e.red="exclamationMarkTriangle",e.blue="lightbulb"}(ai||(ai={}));HTMLElement;function oi(e){const{r:t,g:r,b:i}=e;return`#${t.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`.toLowerCase()}const li=/^[0-9A-F]$/i,ci=/^#[0-9A-F]{3}$/i,ui=/^#[0-9A-F]{6}$/i;function di(e){return hi(e)||pi(e)}function hi(e){return e&&4===e.length&&ci.test(e)}function pi(e){return e&&7===e.length&&ui.test(e)}function fi(e){return(e=e.toLowerCase()).startsWith("#")||(e=`#${e}`),hi(e)?oi(bi(e)):e}function bi(e){if(!di(e))return null;if(3===(e=e.replace("#","")).length){const[t,r,i]=e.split("");return{r:parseInt(`${t}${t}`,16),g:parseInt(`${r}${r}`,16),b:parseInt(`${i}${i}`,16)}}return{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)}}const mi={HEX:"hex",HEXA:"hexa",RGB_CSS:"rgb-css",RGBA_CSS:"rgba-css",HSL_CSS:"hsl-css",HSLA_CSS:"hsla-css"},gi={RGB:"rgb",RGBA:"rgba",HSL:"hsl",HSLA:"hsla",HSV:"hsv",HSVA:"hsva"};function yi(e,...t){return t.every((t=>t&&e&&`${t}`in e))}function vi(e,t){return(null===e||void 0===e?void 0:e.rgbNumber())===(null===t||void 0===t?void 0:t.rgbNumber())}function Oi(e){return function(e){let{r:t,g:r,b:i}=e;t/=255,r/=255,i/=255;const n=Math.max(t,r,i),s=Math.min(t,r,i),a=n-s;if(n===s)return 0;let o=(n+s)/2;switch(n){case t:o=(r-i)/a+(r<i?6:0);break;case r:o=(i-t)/a+2;break;case i:o=(t-r)/a+4}return Math.round(60*o)}(bi(e))}HTMLElement;const ji="article",_i="content",wi="header-container",xi="icon",Si="toggle",Ti="toggle-icon",Ci="title",Mi="heading",Pi="header",Ai="summary",Ei="control-container",Ri="Collapse",Ii="Expand",Di="Loading",Fi="icon",Li="control",ki="chevron-up",zi="chevron-down";function Vi(e){return Math.min(Math.max(Math.ceil(e),1),6)}const Ni=(e,t)=>{const r=`h${e.level}`;return delete e.level,qe(r,Object.assign({},e),t)},Ui=(HTMLElement,"content"),Bi="toggle",Gi="toggle--switch",qi="toggle--switch__text",Hi="section-header",Wi="section-header__text",$i="Collapse",Qi="Expand",Zi="chevron-down",Xi="chevron-left",Ji="chevron-right",Yi=(HTMLElement,"calcite-button--loader"),Ki="content",en="content--slotted",tn="icon",rn="icon--start",nn="icon--end",sn="Loading",an=(HTMLElement,"container"),on="header",ln="footer",cn="thumbnail-wrapper",un="checkbox-wrapper",dn="thumbnail",hn="title",pn="subtitle",fn="footer-leading",bn="footer-trailing",mn="Select",gn="Deselect",yn="Loading",vn=(HTMLElement,"\n  bottom: 0 !important;\n  left: 0 !important;\n  margin: 0 !important;\n  opacity: 0 !important;\n  outline: none !important;\n  padding: 0 !important;\n  position: absolute !important;\n  right: 0 !important;\n  top: 0 !important;\n  transform: none !important;\n  -webkit-appearance: none !important;\n  z-index: -1 !important;\n"),On=(HTMLElement,"close"),jn="close";HTMLElement;function _n(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},r.exports),r.exports}var wn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},xn=_n((function(e){var t=Array.prototype.concat,r=Array.prototype.slice,i=e.exports=function(e){for(var i,n=[],s=0,a=e.length;s<a;s++){var o=e[s];(i=o)&&"string"!==typeof i&&(i instanceof Array||Array.isArray(i)||i.length>=0&&(i.splice instanceof Function||Object.getOwnPropertyDescriptor(i,i.length-1)&&"String"!==i.constructor.name))?n=t.call(n,r.call(o)):n.push(o)}return n};i.wrap=function(e){return function(){return e(i(arguments))}}})),Sn=_n((function(e){var t={};for(var r in wn)wn.hasOwnProperty(r)&&(t[wn[r]]=r);var i=e.exports={to:{},get:{}};function n(e,t,r){return Math.min(Math.max(t,e),r)}function s(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}i.get=function(e){var t,r;switch(e.substring(0,3).toLowerCase()){case"hsl":t=i.get.hsl(e),r="hsl";break;case"hwb":t=i.get.hwb(e),r="hwb";break;default:t=i.get.rgb(e),r="rgb"}return t?{model:r,value:t}:null},i.get.rgb=function(e){if(!e)return null;var t,r,i,s=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=t[2],t=t[1],r=0;r<3;r++){var a=2*r;s[r]=parseInt(t.slice(a,a+2),16)}i&&(s[3]=parseInt(i,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(i=(t=t[1])[3],r=0;r<3;r++)s[r]=parseInt(t[r]+t[r],16);i&&(s[3]=parseInt(i+i,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(r=0;r<3;r++)s[r]=parseInt(t[r+1],0);t[4]&&(s[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(s=wn[t[1]])?(s[3]=1,s):null:null;for(r=0;r<3;r++)s[r]=Math.round(2.55*parseFloat(t[r+1]));t[4]&&(s[3]=parseFloat(t[4]))}for(r=0;r<3;r++)s[r]=n(s[r],0,255);return s[3]=n(s[3],0,1),s},i.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var r=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,n(parseFloat(t[2]),0,100),n(parseFloat(t[3]),0,100),n(isNaN(r)?1:r,0,1)]}return null},i.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var r=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,n(parseFloat(t[2]),0,100),n(parseFloat(t[3]),0,100),n(isNaN(r)?1:r,0,1)]}return null},i.to.hex=function(){var e=xn(arguments);return"#"+s(e[0])+s(e[1])+s(e[2])+(e[3]<1?s(Math.round(255*e[3])):"")},i.to.rgb=function(){var e=xn(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},i.to.rgb.percent=function(){var e=xn(arguments),t=Math.round(e[0]/255*100),r=Math.round(e[1]/255*100),i=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+r+"%, "+i+"%)":"rgba("+t+"%, "+r+"%, "+i+"%, "+e[3]+")"},i.to.hsl=function(){var e=xn(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},i.to.hwb=function(){var e=xn(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},i.to.keyword=function(e){return t[e.slice(0,3)]}})),Tn=_n((function(e){var t={};for(var r in wn)wn.hasOwnProperty(r)&&(t[wn[r]]=r);var i=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var n in i)if(i.hasOwnProperty(n)){if(!("channels"in i[n]))throw new Error("missing channels property: "+n);if(!("labels"in i[n]))throw new Error("missing channel labels property: "+n);if(i[n].labels.length!==i[n].channels)throw new Error("channel and label counts mismatch: "+n);var s=i[n].channels,a=i[n].labels;delete i[n].channels,delete i[n].labels,Object.defineProperty(i[n],"channels",{value:s}),Object.defineProperty(i[n],"labels",{value:a})}function o(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2)}i.rgb.hsl=function(e){var t,r,i=e[0]/255,n=e[1]/255,s=e[2]/255,a=Math.min(i,n,s),o=Math.max(i,n,s),l=o-a;return o===a?t=0:i===o?t=(n-s)/l:n===o?t=2+(s-i)/l:s===o&&(t=4+(i-n)/l),(t=Math.min(60*t,360))<0&&(t+=360),r=(a+o)/2,[t,100*(o===a?0:r<=.5?l/(o+a):l/(2-o-a)),100*r]},i.rgb.hsv=function(e){var t,r,i,n,s,a=e[0]/255,o=e[1]/255,l=e[2]/255,c=Math.max(a,o,l),u=c-Math.min(a,o,l),d=function(e){return(c-e)/6/u+.5};return 0===u?n=s=0:(s=u/c,t=d(a),r=d(o),i=d(l),a===c?n=i-r:o===c?n=1/3+t-i:l===c&&(n=2/3+r-t),n<0?n+=1:n>1&&(n-=1)),[360*n,100*s,100*c]},i.rgb.hwb=function(e){var t=e[0],r=e[1],n=e[2];return[i.rgb.hsl(e)[0],100*(1/255*Math.min(t,Math.min(r,n))),100*(n=1-1/255*Math.max(t,Math.max(r,n)))]},i.rgb.cmyk=function(e){var t,r=e[0]/255,i=e[1]/255,n=e[2]/255;return[100*((1-r-(t=Math.min(1-r,1-i,1-n)))/(1-t)||0),100*((1-i-t)/(1-t)||0),100*((1-n-t)/(1-t)||0),100*t]},i.rgb.keyword=function(e){var r=t[e];if(r)return r;var i,n=1/0;for(var s in wn)if(wn.hasOwnProperty(s)){var a=o(e,wn[s]);a<n&&(n=a,i=s)}return i},i.keyword.rgb=function(e){return wn[e]},i.rgb.xyz=function(e){var t=e[0]/255,r=e[1]/255,i=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126*t+.7152*r+.0722*i),100*(.0193*t+.1192*r+.9505*i)]},i.rgb.lab=function(e){var t=i.rgb.xyz(e),r=t[0],n=t[1],s=t[2];return n/=100,s/=108.883,r=(r/=95.047)>.008856?Math.pow(r,1/3):7.787*r+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(r-n),200*(n-(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116))]},i.hsl.rgb=function(e){var t,r,i,n,s,a=e[0]/360,o=e[1]/100,l=e[2]/100;if(0===o)return[s=255*l,s,s];t=2*l-(r=l<.5?l*(1+o):l+o-l*o),n=[0,0,0];for(var c=0;c<3;c++)(i=a+1/3*-(c-1))<0&&i++,i>1&&i--,s=6*i<1?t+6*(r-t)*i:2*i<1?r:3*i<2?t+(r-t)*(2/3-i)*6:t,n[c]=255*s;return n},i.hsl.hsv=function(e){var t=e[0],r=e[1]/100,i=e[2]/100,n=r,s=Math.max(i,.01);return r*=(i*=2)<=1?i:2-i,n*=s<=1?s:2-s,[t,100*(0===i?2*n/(s+n):2*r/(i+r)),100*((i+r)/2)]},i.hsv.rgb=function(e){var t=e[0]/60,r=e[1]/100,i=e[2]/100,n=Math.floor(t)%6,s=t-Math.floor(t),a=255*i*(1-r),o=255*i*(1-r*s),l=255*i*(1-r*(1-s));switch(i*=255,n){case 0:return[i,l,a];case 1:return[o,i,a];case 2:return[a,i,l];case 3:return[a,o,i];case 4:return[l,a,i];case 5:return[i,a,o]}},i.hsv.hsl=function(e){var t,r,i,n=e[0],s=e[1]/100,a=e[2]/100,o=Math.max(a,.01);return i=(2-s)*a,r=s*o,[n,100*(r=(r/=(t=(2-s)*o)<=1?t:2-t)||0),100*(i/=2)]},i.hwb.rgb=function(e){var t,r,i,n,s,a,o,l=e[0]/360,c=e[1]/100,u=e[2]/100,d=c+u;switch(d>1&&(c/=d,u/=d),i=6*l-(t=Math.floor(6*l)),0!==(1&t)&&(i=1-i),n=c+i*((r=1-u)-c),t){default:case 6:case 0:s=r,a=n,o=c;break;case 1:s=n,a=r,o=c;break;case 2:s=c,a=r,o=n;break;case 3:s=c,a=n,o=r;break;case 4:s=n,a=c,o=r;break;case 5:s=r,a=c,o=n}return[255*s,255*a,255*o]},i.cmyk.rgb=function(e){var t=e[0]/100,r=e[1]/100,i=e[2]/100,n=e[3]/100;return[255*(1-Math.min(1,t*(1-n)+n)),255*(1-Math.min(1,r*(1-n)+n)),255*(1-Math.min(1,i*(1-n)+n))]},i.xyz.rgb=function(e){var t,r,i,n=e[0]/100,s=e[1]/100,a=e[2]/100;return r=-.9689*n+1.8758*s+.0415*a,i=.0557*n+-.204*s+1.057*a,t=(t=3.2406*n+-1.5372*s+-.4986*a)>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,[255*(t=Math.min(Math.max(0,t),1)),255*(r=Math.min(Math.max(0,r),1)),255*(i=Math.min(Math.max(0,i),1))]},i.xyz.lab=function(e){var t=e[0],r=e[1],i=e[2];return r/=100,i/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(t-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},i.lab.xyz=function(e){var t,r,i,n=e[0];t=e[1]/500+(r=(n+16)/116),i=r-e[2]/200;var s=Math.pow(r,3),a=Math.pow(t,3),o=Math.pow(i,3);return r=s>.008856?s:(r-16/116)/7.787,t=a>.008856?a:(t-16/116)/7.787,i=o>.008856?o:(i-16/116)/7.787,[t*=95.047,r*=100,i*=108.883]},i.lab.lch=function(e){var t,r=e[0],i=e[1],n=e[2];return(t=360*Math.atan2(n,i)/2/Math.PI)<0&&(t+=360),[r,Math.sqrt(i*i+n*n),t]},i.lch.lab=function(e){var t,r=e[0],i=e[1];return t=e[2]/360*2*Math.PI,[r,i*Math.cos(t),i*Math.sin(t)]},i.rgb.ansi16=function(e){var t=e[0],r=e[1],n=e[2],s=1 in arguments?arguments[1]:i.rgb.hsv(e)[2];if(0===(s=Math.round(s/50)))return 30;var a=30+(Math.round(n/255)<<2|Math.round(r/255)<<1|Math.round(t/255));return 2===s&&(a+=60),a},i.hsv.ansi16=function(e){return i.rgb.ansi16(i.hsv.rgb(e),e[2])},i.rgb.ansi256=function(e){var t=e[0],r=e[1],i=e[2];return t===r&&r===i?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(i/255*5)},i.ansi16.rgb=function(e){var t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];var r=.5*(1+~~(e>50));return[(1&t)*r*255,(t>>1&1)*r*255,(t>>2&1)*r*255]},i.ansi256.rgb=function(e){if(e>=232){var t=10*(e-232)+8;return[t,t,t]}var r;return e-=16,[Math.floor(e/36)/5*255,Math.floor((r=e%36)/6)/5*255,r%6/5*255]},i.rgb.hex=function(e){var t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},i.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var r=t[0];3===t[0].length&&(r=r.split("").map((function(e){return e+e})).join(""));var i=parseInt(r,16);return[i>>16&255,i>>8&255,255&i]},i.rgb.hcg=function(e){var t,r=e[0]/255,i=e[1]/255,n=e[2]/255,s=Math.max(Math.max(r,i),n),a=Math.min(Math.min(r,i),n),o=s-a;return t=o<=0?0:s===r?(i-n)/o%6:s===i?2+(n-r)/o:4+(r-i)/o+4,t/=6,[360*(t%=1),100*o,100*(o<1?a/(1-o):0)]},i.hsl.hcg=function(e){var t=e[1]/100,r=e[2]/100,i=1,n=0;return(i=r<.5?2*t*r:2*t*(1-r))<1&&(n=(r-.5*i)/(1-i)),[e[0],100*i,100*n]},i.hsv.hcg=function(e){var t=e[1]/100,r=e[2]/100,i=t*r,n=0;return i<1&&(n=(r-i)/(1-i)),[e[0],100*i,100*n]},i.hcg.rgb=function(e){var t=e[0]/360,r=e[1]/100,i=e[2]/100;if(0===r)return[255*i,255*i,255*i];var n,s=[0,0,0],a=t%1*6,o=a%1,l=1-o;switch(Math.floor(a)){case 0:s[0]=1,s[1]=o,s[2]=0;break;case 1:s[0]=l,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=o;break;case 3:s[0]=0,s[1]=l,s[2]=1;break;case 4:s[0]=o,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=l}return n=(1-r)*i,[255*(r*s[0]+n),255*(r*s[1]+n),255*(r*s[2]+n)]},i.hcg.hsv=function(e){var t=e[1]/100,r=t+e[2]/100*(1-t),i=0;return r>0&&(i=t/r),[e[0],100*i,100*r]},i.hcg.hsl=function(e){var t=e[1]/100,r=e[2]/100*(1-t)+.5*t,i=0;return r>0&&r<.5?i=t/(2*r):r>=.5&&r<1&&(i=t/(2*(1-r))),[e[0],100*i,100*r]},i.hcg.hwb=function(e){var t=e[1]/100,r=t+e[2]/100*(1-t);return[e[0],100*(r-t),100*(1-r)]},i.hwb.hcg=function(e){var t=e[1]/100,r=1-e[2]/100,i=r-t,n=0;return i<1&&(n=(r-i)/(1-i)),[e[0],100*i,100*n]},i.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},i.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},i.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},i.gray.hsl=i.gray.hsv=function(e){return[0,0,e[0]]},i.gray.hwb=function(e){return[0,100,e[0]]},i.gray.cmyk=function(e){return[0,0,0,e[0]]},i.gray.lab=function(e){return[e[0],0,0]},i.gray.hex=function(e){var t=255&Math.round(e[0]/100*255),r=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(r.length)+r},i.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}}));function Cn(e){var t=function(){for(var e={},t=Object.keys(Tn),r=t.length,i=0;i<r;i++)e[t[i]]={distance:-1,parent:null};return e}(),r=[e];for(t[e].distance=0;r.length;)for(var i=r.pop(),n=Object.keys(Tn[i]),s=n.length,a=0;a<s;a++){var o=n[a],l=t[o];-1===l.distance&&(l.distance=t[i].distance+1,l.parent=i,r.unshift(o))}return t}function Mn(e,t){return function(r){return t(e(r))}}function Pn(e,t){for(var r=[t[e].parent,e],i=Tn[t[e].parent][e],n=t[e].parent;t[n].parent;)r.unshift(t[n].parent),i=Mn(Tn[t[n].parent][n],i),n=t[n].parent;return i.conversion=r,i}var An={};Object.keys(Tn).forEach((function(e){An[e]={},Object.defineProperty(An[e],"channels",{value:Tn[e].channels}),Object.defineProperty(An[e],"labels",{value:Tn[e].labels});var t=function(e){for(var t=Cn(e),r={},i=Object.keys(t),n=i.length,s=0;s<n;s++){var a=i[s];null!==t[a].parent&&(r[a]=Pn(a,t))}return r}(e);Object.keys(t).forEach((function(r){var i=t[r];An[e][r]=function(e){var t=function(t){if(void 0===t||null===t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var r=e(t);if("object"===typeof r)for(var i=r.length,n=0;n<i;n++)r[n]=Math.round(r[n]);return r};return"conversion"in e&&(t.conversion=e.conversion),t}(i),An[e][r].raw=function(e){var t=function(t){return void 0===t||null===t?t:(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(i)}))}));var En=An,Rn=[].slice,In=["keyword","gray","hex"],Dn={};Object.keys(En).forEach((function(e){Dn[Rn.call(En[e].labels).sort().join("")]=e}));var Fn={};function Ln(e,t){if(!(this instanceof Ln))return new Ln(e,t);if(t&&t in In&&(t=null),t&&!(t in En))throw new Error("Unknown model: "+t);var r,i;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof Ln)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"===typeof e){var n=Sn.get(e);if(null===n)throw new Error("Unable to parse color from string: "+e);this.model=n.model,i=En[this.model].channels,this.color=n.value.slice(0,i),this.valpha="number"===typeof n.value[i]?n.value[i]:1}else if(e.length){this.model=t||"rgb",i=En[this.model].channels;var s=Rn.call(e,0,i);this.color=Nn(s,i),this.valpha="number"===typeof e[i]?e[i]:1}else if("number"===typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;var a=Object.keys(e);"alpha"in e&&(a.splice(a.indexOf("alpha"),1),this.valpha="number"===typeof e.alpha?e.alpha:0);var o=a.sort().join("");if(!(o in Dn))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=Dn[o];var l=En[this.model].labels,c=[];for(r=0;r<l.length;r++)c.push(e[l[r]]);this.color=Nn(c)}if(Fn[this.model])for(i=En[this.model].channels,r=0;r<i;r++){var u=Fn[this.model][r];u&&(this.color[r]=u(this.color[r]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function kn(e,t,r){return(e=Array.isArray(e)?e:[e]).forEach((function(e){(Fn[e]||(Fn[e]=[]))[t]=r})),e=e[0],function(i){var n;return arguments.length?(r&&(i=r(i)),(n=this[e]()).color[t]=i,n):(n=this[e]().color[t],r&&(n=r(n)),n)}}function zn(e){return function(t){return Math.max(0,Math.min(e,t))}}function Vn(e){return Array.isArray(e)?e:[e]}function Nn(e,t){for(var r=0;r<t;r++)"number"!==typeof e[r]&&(e[r]=0);return e}Ln.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var t=this.model in Sn.to?this:this.rgb(),r=1===(t=t.round("number"===typeof e?e:1)).valpha?t.color:t.color.concat(this.valpha);return Sn.to[t.model](r)},percentString:function(e){var t=this.rgb().round("number"===typeof e?e:1),r=1===t.valpha?t.color:t.color.concat(this.valpha);return Sn.to.rgb.percent(r)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},t=En[this.model].channels,r=En[this.model].labels,i=0;i<t;i++)e[r[i]]=this.color[i];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new Ln(this.color.map(function(e){return function(t){return function(e,t){return Number(e.toFixed(t))}(t,e)}}(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new Ln(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:kn("rgb",0,zn(255)),green:kn("rgb",1,zn(255)),blue:kn("rgb",2,zn(255)),hue:kn(["hsl","hsv","hsl","hwb","hcg"],0,(function(e){return(e%360+360)%360})),saturationl:kn("hsl",1,zn(100)),lightness:kn("hsl",2,zn(100)),saturationv:kn("hsv",1,zn(100)),value:kn("hsv",2,zn(100)),chroma:kn("hcg",1,zn(100)),gray:kn("hcg",2,zn(100)),white:kn("hwb",1,zn(100)),wblack:kn("hwb",2,zn(100)),cyan:kn("cmyk",0,zn(100)),magenta:kn("cmyk",1,zn(100)),yellow:kn("cmyk",2,zn(100)),black:kn("cmyk",3,zn(100)),x:kn("xyz",0,zn(100)),y:kn("xyz",1,zn(100)),z:kn("xyz",2,zn(100)),l:kn("lab",0,zn(100)),a:kn("lab",1),b:kn("lab",2),keyword:function(e){return arguments.length?new Ln(e):En[this.model].keyword(this.color)},hex:function(e){return arguments.length?new Ln(e):Sn.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,t=[],r=0;r<e.length;r++){var i=e[r]/255;t[r]=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(e){var t=this.luminosity(),r=e.luminosity();return t>r?(t+.05)/(r+.05):(r+.05)/(t+.05)},level:function(e){var t=this.contrast(e);return t>=7.1?"AAA":t>=4.5?"AA":""},isDark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten:function(e){var t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken:function(e){var t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate:function(e){var t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate:function(e){var t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten:function(e){var t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken:function(e){var t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale:function(){var e=this.rgb().color,t=.3*e[0]+.59*e[1]+.11*e[2];return Ln.rgb(t,t,t)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var t=this.hsl(),r=t.color[0];return r=(r=(r+e)%360)<0?360+r:r,t.color[0]=r,t},mix:function(e,t){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);var r=e.rgb(),i=this.rgb(),n=void 0===t?.5:t,s=2*n-1,a=r.alpha()-i.alpha(),o=((s*a===-1?s:(s+a)/(1+s*a))+1)/2,l=1-o;return Ln.rgb(o*r.red()+l*i.red(),o*r.green()+l*i.green(),o*r.blue()+l*i.blue(),r.alpha()*n+i.alpha()*(1-n))}},Object.keys(En).forEach((function(e){if(-1===In.indexOf(e)){var t=En[e].channels;Ln.prototype[e]=function(){if(this.model===e)return new Ln(this);if(arguments.length)return new Ln(arguments,e);var r="number"===typeof arguments[t]?t:this.valpha;return new Ln(Vn(En[this.model][e].raw(this.color)).concat(r),e)},Ln[e]=function(r){return"number"===typeof r&&(r=Nn(Rn.call(arguments),t)),new Ln(r,e)}}}));var Un=Ln;const Bn="container",Gn="control-section",qn="color-hex-options",Hn="section",Wn="header",$n="control",Qn="section--split",Zn="header--underlined",Xn="color-mode-container",Jn="color-mode",Yn="channels",Kn="channel",es="saved-colors",ts="saved-colors-section",rs="save-color",is="delete-color",ns="saved-colors-buttons",ss="header--hex",as="color-field-and-slider",os="color-field-and-slider--interactive",ls="color-field-and-slider-wrap",cs="scope",us="saved-color",ds=Un("#007AC2"),hs={r:255,g:255,b:255},ps={h:360,s:100,v:100},fs="B",bs="Blue",ms="Delete color",gs="G",ys="Green",vs="H",Os="HSV",js="Hex",_s="Hue",ws="No color",xs="R",Ss="Red",Ts="RGB",Cs="S",Ms="Saturation",Ps="Save color",As="Saved",Es="V",Rs="Value",Is={s:{slider:{height:10,width:156},colorField:{height:80,width:156},thumb:{radius:8}},m:{slider:{height:14,width:272},colorField:{height:150,width:272},thumb:{radius:10}},l:{slider:{height:16,width:420},colorField:{height:200,width:420},thumb:{radius:12}}};var Ds="object"==typeof global&&global&&global.Object===Object&&global,Fs="object"==typeof self&&self&&self.Object===Object&&self,Ls=Ds||Fs||Function("return this")(),ks=Ls.Symbol,zs=Object.prototype,Vs=zs.hasOwnProperty,Ns=zs.toString,Us=ks?ks.toStringTag:void 0;var Bs=Object.prototype.toString;var Gs=ks?ks.toStringTag:void 0;function qs(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Gs&&Gs in Object(e)?function(e){var t=Vs.call(e,Us),r=e[Us];try{e[Us]=void 0;var i=!0}catch(s){}var n=Ns.call(e);return i&&(t?e[Us]=r:delete e[Us]),n}(e):function(e){return Bs.call(e)}(e)}function Hs(e){return null!=e&&"object"==typeof e}function Ws(e){return"symbol"==typeof e||Hs(e)&&"[object Symbol]"==qs(e)}var $s=Array.isArray,Qs=ks?ks.prototype:void 0,Zs=Qs?Qs.toString:void 0;function Xs(e){if("string"==typeof e)return e;if($s(e))return function(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}(e,Xs)+"";if(Ws(e))return Zs?Zs.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}var Js=/\s/;var Ys=/^\s+/;function Ks(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&Js.test(e.charAt(t)););return t}(e)+1).replace(Ys,""):e}function ea(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var ta=/^[-+]0x[0-9a-f]+$/i,ra=/^0b[01]+$/i,ia=/^0o[0-7]+$/i,na=parseInt;function sa(e){if("number"==typeof e)return e;if(Ws(e))return NaN;if(ea(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ea(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ks(e);var r=ra.test(e);return r||ia.test(e)?na(e.slice(2),r?2:8):ta.test(e)?NaN:+e}function aa(e){return e}var oa=/^(?:0|[1-9]\d*)$/;function la(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&oa.test(e))&&e>-1&&e%1==0&&e<t}function ca(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function ua(e){return null!=e&&ca(e.length)&&!function(e){if(!ea(e))return!1;var t=qs(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}(e)}var da=Object.prototype;function ha(e){return Hs(e)&&"[object Arguments]"==qs(e)}var pa=Object.prototype,fa=pa.hasOwnProperty,ba=pa.propertyIsEnumerable,ma=ha(function(){return arguments}())?ha:function(e){return Hs(e)&&fa.call(e,"callee")&&!ba.call(e,"callee")};var ga="object"==typeof exports&&exports&&!exports.nodeType&&exports,ya=ga&&"object"==typeof e&&e&&!e.nodeType&&e,va=ya&&ya.exports===ga?Ls.Buffer:void 0,Oa=(va?va.isBuffer:void 0)||function(){return!1},ja={};ja["[object Float32Array]"]=ja["[object Float64Array]"]=ja["[object Int8Array]"]=ja["[object Int16Array]"]=ja["[object Int32Array]"]=ja["[object Uint8Array]"]=ja["[object Uint8ClampedArray]"]=ja["[object Uint16Array]"]=ja["[object Uint32Array]"]=!0,ja["[object Arguments]"]=ja["[object Array]"]=ja["[object ArrayBuffer]"]=ja["[object Boolean]"]=ja["[object DataView]"]=ja["[object Date]"]=ja["[object Error]"]=ja["[object Function]"]=ja["[object Map]"]=ja["[object Number]"]=ja["[object Object]"]=ja["[object RegExp]"]=ja["[object Set]"]=ja["[object String]"]=ja["[object WeakMap]"]=!1;var _a,wa="object"==typeof exports&&exports&&!exports.nodeType&&exports,xa=wa&&"object"==typeof e&&e&&!e.nodeType&&e,Sa=xa&&xa.exports===wa&&Ds.process,Ta=function(){try{var e=xa&&xa.require&&xa.require("util").types;return e||Sa&&Sa.binding&&Sa.binding("util")}catch(t){}}(),Ca=Ta&&Ta.isTypedArray,Ma=Ca?(_a=Ca,function(e){return _a(e)}):function(e){return Hs(e)&&ca(e.length)&&!!ja[qs(e)]},Pa=Object.prototype.hasOwnProperty;function Aa(e,t){var r=$s(e),i=!r&&ma(e),n=!r&&!i&&Oa(e),s=!r&&!i&&!n&&Ma(e),a=r||i||n||s,o=a?function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}(e.length,String):[],l=o.length;for(var c in e)!t&&!Pa.call(e,c)||a&&("length"==c||n&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||la(c,l))||o.push(c);return o}var Ea=Object.prototype.hasOwnProperty;function Ra(e){if(!ea(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||da)}(e),r=[];for(var i in e)("constructor"!=i||!t&&Ea.call(e,i))&&r.push(i);return r}function Ia(e){return ua(e)?Aa(e,!0):Ra(e)}var Da,Fa=function(e,t,r){for(var i=-1,n=Object(e),s=r(e),a=s.length;a--;){var o=s[Da?a:++i];if(!1===t(n[o],o,n))break}return e},La=function(){return Ls.Date.now()},ka=Math.max,za=Math.min;function Va(e,t,r){var i,n,s,a,o,l,c=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var r=i,s=n;return i=n=void 0,c=t,a=e.apply(s,r)}function f(e){return c=e,o=setTimeout(m,t),u?p(e):a}function b(e){var r=e-l;return void 0===l||r>=t||r<0||d&&e-c>=s}function m(){var e=La();if(b(e))return g(e);o=setTimeout(m,function(e){var r=t-(e-l);return d?za(r,s-(e-c)):r}(e))}function g(e){return o=void 0,h&&i?p(e):(i=n=void 0,a)}function y(){var e=La(),r=b(e);if(i=arguments,n=this,l=e,r){if(void 0===o)return f(l);if(d)return clearTimeout(o),o=setTimeout(m,t),p(l)}return void 0===o&&(o=setTimeout(m,t)),a}return t=sa(t)||0,ea(r)&&(u=!!r.leading,s=(d="maxWait"in r)?ka(sa(r.maxWait)||0,t):s,h="trailing"in r?!!r.trailing:h),y.cancel=function(){void 0!==o&&clearTimeout(o),c=0,i=l=n=o=void 0},y.flush=function(){return void 0===o?a:g(La())},y}var Na=/[\\^$.*+?()[\]{}|]/g,Ua=RegExp(Na.source);function Ba(e){var t;return(e=null==(t=e)?"":Xs(t))&&Ua.test(e)?e.replace(Na,"\\$&"):e}function Ga(e,t){return null==e?e:Fa(e,"function"==typeof(r=t)?r:aa,Ia);var r}const qa=(e,t,r)=>Math.max(t,Math.min(e,r)),Ha=fi(ds.hex()),Wa=(HTMLElement,"container"),$a="preview",Qa="input",Za=Un(),Xa=(HTMLElement,"swatch"),Ja="rgba(0, 0, 0, 0.15)",Ya="rgba(255, 255, 255, 0.15)";HTMLElement;var Ka="top",eo="bottom",to="right",ro="left",io="auto",no=[Ka,eo,to,ro],so="start",ao="end",oo="viewport",lo="popper",co=no.reduce((function(e,t){return e.concat([t+"-"+so,t+"-"+ao])}),[]),uo=[].concat(no,[io]).reduce((function(e,t){return e.concat([t,t+"-"+so,t+"-"+ao])}),[]),ho=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function po(e){return e?(e.nodeName||"").toLowerCase():null}function fo(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function bo(e){return e instanceof fo(e).Element||e instanceof Element}function mo(e){return e instanceof fo(e).HTMLElement||e instanceof HTMLElement}function go(e){return"undefined"!==typeof ShadowRoot&&(e instanceof fo(e).ShadowRoot||e instanceof ShadowRoot)}const yo={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var r=t.styles[e]||{},i=t.attributes[e]||{},n=t.elements[e];mo(n)&&po(n)&&(Object.assign(n.style,r),Object.keys(i).forEach((function(e){var t=i[e];!1===t?n.removeAttribute(e):n.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow),function(){Object.keys(t.elements).forEach((function(e){var i=t.elements[e],n=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:r[e]).reduce((function(e,t){return e[t]="",e}),{});mo(i)&&po(i)&&(Object.assign(i.style,s),Object.keys(n).forEach((function(e){i.removeAttribute(e)})))}))}},requires:["computeStyles"]};function vo(e){return e.split("-")[0]}function Oo(e){var t=e.getBoundingClientRect();return{width:t.width,height:t.height,top:t.top,right:t.right,bottom:t.bottom,left:t.left,x:t.left,y:t.top}}function jo(e){var t=Oo(e),r=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:i}}function _o(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&go(r)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function wo(e){return fo(e).getComputedStyle(e)}function xo(e){return["table","td","th"].indexOf(po(e))>=0}function So(e){return((bo(e)?e.ownerDocument:e.document)||window.document).documentElement}function To(e){return"html"===po(e)?e:e.assignedSlot||e.parentNode||(go(e)?e.host:null)||So(e)}function Co(e){return mo(e)&&"fixed"!==wo(e).position?e.offsetParent:null}function Mo(e){for(var t=fo(e),r=Co(e);r&&xo(r)&&"static"===wo(r).position;)r=Co(r);return r&&("html"===po(r)||"body"===po(r)&&"static"===wo(r).position)?t:r||function(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&mo(e)&&"fixed"===wo(e).position)return null;for(var r=To(e);mo(r)&&["html","body"].indexOf(po(r))<0;){var i=wo(r);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return r;r=r.parentNode}return null}(e)||t}function Po(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}var Ao=Math.max,Eo=Math.min,Ro=Math.round;function Io(e,t,r){return Ao(e,Eo(t,r))}function Do(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Fo(e,t){return t.reduce((function(t,r){return t[r]=e,t}),{})}var Lo={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ko(e){var t,r=e.popper,i=e.popperRect,n=e.placement,s=e.offsets,a=e.position,o=e.gpuAcceleration,l=e.adaptive,c=e.roundOffsets,u=!0===c?function(e){var t=e.x,r=e.y,i=window.devicePixelRatio||1;return{x:Ro(Ro(t*i)/i)||0,y:Ro(Ro(r*i)/i)||0}}(s):"function"===typeof c?c(s):s,d=u.x,h=void 0===d?0:d,p=u.y,f=void 0===p?0:p,b=s.hasOwnProperty("x"),m=s.hasOwnProperty("y"),g=ro,y=Ka,v=window;if(l){var O=Mo(r),j="clientHeight",_="clientWidth";O===fo(r)&&"static"!==wo(O=So(r)).position&&(j="scrollHeight",_="scrollWidth"),O=O,n===Ka&&(y=eo,f-=O[j]-i.height,f*=o?1:-1),n===ro&&(g=to,h-=O[_]-i.width,h*=o?1:-1)}var w,x=Object.assign({position:a},l&&Lo);return o?Object.assign({},x,((w={})[y]=m?"0":"",w[g]=b?"0":"",w.transform=(v.devicePixelRatio||1)<2?"translate("+h+"px, "+f+"px)":"translate3d("+h+"px, "+f+"px, 0)",w)):Object.assign({},x,((t={})[y]=m?f+"px":"",t[g]=b?h+"px":"",t.transform="",t))}var zo={passive:!0};var Vo={left:"right",right:"left",bottom:"top",top:"bottom"};function No(e){return e.replace(/left|right|bottom|top/g,(function(e){return Vo[e]}))}var Uo={start:"end",end:"start"};function Bo(e){return e.replace(/start|end/g,(function(e){return Uo[e]}))}function Go(e){var t=fo(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function qo(e){return Oo(So(e)).left+Go(e).scrollLeft}function Ho(e){var t=wo(e),r=t.overflow,i=t.overflowX,n=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+n+i)}function Wo(e){return["html","body","#document"].indexOf(po(e))>=0?e.ownerDocument.body:mo(e)&&Ho(e)?e:Wo(To(e))}function $o(e,t){var r;void 0===t&&(t=[]);var i=Wo(e),n=i===(null==(r=e.ownerDocument)?void 0:r.body),s=fo(i),a=n?[s].concat(s.visualViewport||[],Ho(i)?i:[]):i,o=t.concat(a);return n?o:o.concat($o(To(a)))}function Qo(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Zo(e,t){return t===oo?Qo(function(e){var t=fo(e),r=So(e),i=t.visualViewport,n=r.clientWidth,s=r.clientHeight,a=0,o=0;return i&&(n=i.width,s=i.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(a=i.offsetLeft,o=i.offsetTop)),{width:n,height:s,x:a+qo(e),y:o}}(e)):mo(t)?function(e){var t=Oo(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}(t):Qo(function(e){var t,r=So(e),i=Go(e),n=null==(t=e.ownerDocument)?void 0:t.body,s=Ao(r.scrollWidth,r.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),a=Ao(r.scrollHeight,r.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-i.scrollLeft+qo(e),l=-i.scrollTop;return"rtl"===wo(n||r).direction&&(o+=Ao(r.clientWidth,n?n.clientWidth:0)-s),{width:s,height:a,x:o,y:l}}(So(e)))}function Xo(e,t,r){var i="clippingParents"===t?function(e){var t=$o(To(e)),r=["absolute","fixed"].indexOf(wo(e).position)>=0&&mo(e)?Mo(e):e;return bo(r)?t.filter((function(e){return bo(e)&&_o(e,r)&&"body"!==po(e)})):[]}(e):[].concat(t),n=[].concat(i,[r]),s=n[0],a=n.reduce((function(t,r){var i=Zo(e,r);return t.top=Ao(i.top,t.top),t.right=Eo(i.right,t.right),t.bottom=Eo(i.bottom,t.bottom),t.left=Ao(i.left,t.left),t}),Zo(e,s));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Jo(e){return e.split("-")[1]}function Yo(e){var t,r=e.reference,i=e.element,n=e.placement,s=n?vo(n):null,a=n?Jo(n):null,o=r.x+r.width/2-i.width/2,l=r.y+r.height/2-i.height/2;switch(s){case Ka:t={x:o,y:r.y-i.height};break;case eo:t={x:o,y:r.y+r.height};break;case to:t={x:r.x+r.width,y:l};break;case ro:t={x:r.x-i.width,y:l};break;default:t={x:r.x,y:r.y}}var c=s?Po(s):null;if(null!=c){var u="y"===c?"height":"width";switch(a){case so:t[c]=t[c]-(r[u]/2-i[u]/2);break;case ao:t[c]=t[c]+(r[u]/2-i[u]/2)}}return t}function Ko(e,t){void 0===t&&(t={});var r=t,i=r.placement,n=void 0===i?e.placement:i,s=r.boundary,a=void 0===s?"clippingParents":s,o=r.rootBoundary,l=void 0===o?oo:o,c=r.elementContext,u=void 0===c?lo:c,d=r.altBoundary,h=void 0!==d&&d,p=r.padding,f=void 0===p?0:p,b=Do("number"!==typeof f?f:Fo(f,no)),m=u===lo?"reference":lo,g=e.elements.reference,y=e.rects.popper,v=e.elements[h?m:u],O=Xo(bo(v)?v:v.contextElement||So(e.elements.popper),a,l),j=Oo(g),_=Yo({reference:j,element:y,strategy:"absolute",placement:n}),w=Qo(Object.assign({},y,_)),x=u===lo?w:j,S={top:O.top-x.top+b.top,bottom:x.bottom-O.bottom+b.bottom,left:O.left-x.left+b.left,right:x.right-O.right+b.right},T=e.modifiersData.offset;if(u===lo&&T){var C=T[n];Object.keys(S).forEach((function(e){var t=[to,eo].indexOf(e)>=0?1:-1,r=[Ka,eo].indexOf(e)>=0?"y":"x";S[e]+=C[r]*t}))}return S}function el(e,t){void 0===t&&(t={});var r=t,i=r.placement,n=r.boundary,s=r.rootBoundary,a=r.padding,o=r.flipVariations,l=r.allowedAutoPlacements,c=void 0===l?uo:l,u=Jo(i),d=u?o?co:co.filter((function(e){return Jo(e)===u})):no,h=d.filter((function(e){return c.indexOf(e)>=0}));0===h.length&&(h=d);var p=h.reduce((function(t,r){return t[r]=Ko(e,{placement:r,boundary:n,rootBoundary:s,padding:a})[vo(r)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}function tl(e,t,r){return void 0===r&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function rl(e){return[Ka,to,eo,ro].some((function(t){return e[t]>=0}))}function il(e,t,r){void 0===r&&(r=!1);var i=So(t),n=Oo(e),s=mo(t),a={scrollLeft:0,scrollTop:0},o={x:0,y:0};return(s||!s&&!r)&&(("body"!==po(t)||Ho(i))&&(a=function(e){return e!==fo(e)&&mo(e)?{scrollLeft:(t=e).scrollLeft,scrollTop:t.scrollTop}:Go(e);var t}(t)),mo(t)?((o=Oo(t)).x+=t.clientLeft,o.y+=t.clientTop):i&&(o.x=qo(i))),{x:n.left+a.scrollLeft-o.x,y:n.top+a.scrollTop-o.y,width:n.width,height:n.height}}function nl(e){var t=new Map,r=new Set,i=[];function n(e){r.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!r.has(e)){var i=t.get(e);i&&n(i)}})),i.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){r.has(e.name)||n(e)})),i}function sl(e){var t;return function(){return t||(t=new Promise((function(r){Promise.resolve().then((function(){t=void 0,r(e())}))}))),t}}var al={placement:"bottom",modifiers:[],strategy:"absolute"};function ol(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some((function(e){return!(e&&"function"===typeof e.getBoundingClientRect)}))}function ll(e){void 0===e&&(e={});var t=e,r=t.defaultModifiers,i=void 0===r?[]:r,n=t.defaultOptions,s=void 0===n?al:n;return function(e,t,r){void 0===r&&(r=s);var n={placement:"bottom",orderedModifiers:[],options:Object.assign({},al,s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},a=[],o=!1,l={state:n,setOptions:function(r){c(),n.options=Object.assign({},s,n.options,r),n.scrollParents={reference:bo(e)?$o(e):e.contextElement?$o(e.contextElement):[],popper:$o(t)};var o=function(e){var t=nl(e);return ho.reduce((function(e,r){return e.concat(t.filter((function(e){return e.phase===r})))}),[])}(function(e){var t=e.reduce((function(e,t){var r=e[t.name];return e[t.name]=r?Object.assign({},r,t,{options:Object.assign({},r.options,t.options),data:Object.assign({},r.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}([].concat(i,n.options.modifiers)));return n.orderedModifiers=o.filter((function(e){return e.enabled})),n.orderedModifiers.forEach((function(e){var t=e.name,r=e.options,i=void 0===r?{}:r,s=e.effect;if("function"===typeof s){var o=s({state:n,name:t,instance:l,options:i}),c=function(){};a.push(o||c)}})),l.update()},forceUpdate:function(){if(!o){var e=n.elements,t=e.reference,r=e.popper;if(ol(t,r)){n.rects={reference:il(t,Mo(r),"fixed"===n.options.strategy),popper:jo(r)},n.reset=!1,n.placement=n.options.placement,n.orderedModifiers.forEach((function(e){return n.modifiersData[e.name]=Object.assign({},e.data)}));for(var i=0;i<n.orderedModifiers.length;i++)if(!0!==n.reset){var s=n.orderedModifiers[i],a=s.fn,c=s.options,u=void 0===c?{}:c,d=s.name;"function"===typeof a&&(n=a({state:n,options:u,name:d,instance:l})||n)}else n.reset=!1,i=-1}}},update:sl((function(){return new Promise((function(e){l.forceUpdate(),e(n)}))})),destroy:function(){c(),o=!0}};if(!ol(e,t))return l;function c(){a.forEach((function(e){return e()})),a=[]}return l.setOptions(r).then((function(e){!o&&r.onFirstUpdate&&r.onFirstUpdate(e)})),l}}var cl=ll({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,r=e.instance,i=e.options,n=i.scroll,s=void 0===n||n,a=i.resize,o=void 0===a||a,l=fo(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&c.forEach((function(e){e.addEventListener("scroll",r.update,zo)})),o&&l.addEventListener("resize",r.update,zo),function(){s&&c.forEach((function(e){e.removeEventListener("scroll",r.update,zo)})),o&&l.removeEventListener("resize",r.update,zo)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,r=e.name;t.modifiersData[r]=Yo({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,r=e.options,i=r.gpuAcceleration,n=void 0===i||i,s=r.adaptive,a=void 0===s||s,o=r.roundOffsets,l=void 0===o||o,c={placement:vo(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:n};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,ko(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,ko(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},yo,{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,r=e.options,i=e.name,n=r.offset,s=void 0===n?[0,0]:n,a=uo.reduce((function(e,r){return e[r]=function(e,t,r){var i=vo(e),n=[ro,Ka].indexOf(i)>=0?-1:1,s="function"===typeof r?r(Object.assign({},t,{placement:e})):r,a=s[0],o=s[1];return a=a||0,o=(o||0)*n,[ro,to].indexOf(i)>=0?{x:o,y:a}:{x:a,y:o}}(r,t.rects,s),e}),{}),o=a[t.placement],l=o.x,c=o.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[i]=a}},{name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var n=r.mainAxis,s=void 0===n||n,a=r.altAxis,o=void 0===a||a,l=r.fallbackPlacements,c=r.padding,u=r.boundary,d=r.rootBoundary,h=r.altBoundary,p=r.flipVariations,f=void 0===p||p,b=r.allowedAutoPlacements,m=t.options.placement,g=vo(m),y=l||(g===m||!f?[No(m)]:function(e){if(vo(e)===io)return[];var t=No(e);return[Bo(e),t,Bo(t)]}(m)),v=[m].concat(y).reduce((function(e,r){return e.concat(vo(r)===io?el(t,{placement:r,boundary:u,rootBoundary:d,padding:c,flipVariations:f,allowedAutoPlacements:b}):r)}),[]),O=t.rects.reference,j=t.rects.popper,_=new Map,w=!0,x=v[0],S=0;S<v.length;S++){var T=v[S],C=vo(T),M=Jo(T)===so,P=[Ka,eo].indexOf(C)>=0,A=P?"width":"height",E=Ko(t,{placement:T,boundary:u,rootBoundary:d,altBoundary:h,padding:c}),R=P?M?to:ro:M?eo:Ka;O[A]>j[A]&&(R=No(R));var I=No(R),D=[];if(s&&D.push(E[C]<=0),o&&D.push(E[R]<=0,E[I]<=0),D.every((function(e){return e}))){x=T,w=!1;break}_.set(T,D)}if(w)for(var F=function(e){var t=v.find((function(t){var r=_.get(t);if(r)return r.slice(0,e).every((function(e){return e}))}));if(t)return x=t,"break"},L=f?3:1;L>0;L--){if("break"===F(L))break}t.placement!==x&&(t.modifiersData[i]._skip=!0,t.placement=x,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,i=e.name,n=r.mainAxis,s=void 0===n||n,a=r.altAxis,o=void 0!==a&&a,l=r.boundary,c=r.rootBoundary,u=r.altBoundary,d=r.padding,h=r.tether,p=void 0===h||h,f=r.tetherOffset,b=void 0===f?0:f,m=Ko(t,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),g=vo(t.placement),y=Jo(t.placement),v=!y,O=Po(g),j="x"===O?"y":"x",_=t.modifiersData.popperOffsets,w=t.rects.reference,x=t.rects.popper,S="function"===typeof b?b(Object.assign({},t.rects,{placement:t.placement})):b,T={x:0,y:0};if(_){if(s||o){var C="y"===O?Ka:ro,M="y"===O?eo:to,P="y"===O?"height":"width",A=_[O],E=_[O]+m[C],R=_[O]-m[M],I=p?-x[P]/2:0,D=y===so?w[P]:x[P],F=y===so?-x[P]:-w[P],L=t.elements.arrow,k=p&&L?jo(L):{width:0,height:0},z=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},V=z[C],N=z[M],U=Io(0,w[P],k[P]),B=v?w[P]/2-I-U-V-S:D-U-V-S,G=v?-w[P]/2+I+U+N+S:F+U+N+S,q=t.elements.arrow&&Mo(t.elements.arrow),H=q?"y"===O?q.clientTop||0:q.clientLeft||0:0,W=t.modifiersData.offset?t.modifiersData.offset[t.placement][O]:0,$=_[O]+B-W-H,Q=_[O]+G-W;if(s){var Z=Io(p?Eo(E,$):E,A,p?Ao(R,Q):R);_[O]=Z,T[O]=Z-A}if(o){var X="x"===O?Ka:ro,J="x"===O?eo:to,Y=_[j],K=Y+m[X],ee=Y-m[J],te=Io(p?Eo(K,$):K,Y,p?Ao(ee,Q):ee);_[j]=te,T[j]=te-Y}}t.modifiersData[i]=T}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,r=e.state,i=e.name,n=e.options,s=r.elements.arrow,a=r.modifiersData.popperOffsets,o=vo(r.placement),l=Po(o),c=[ro,to].indexOf(o)>=0?"height":"width";if(s&&a){var u=function(e,t){return Do("number"!==typeof(e="function"===typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Fo(e,no))}(n.padding,r),d=jo(s),h="y"===l?Ka:ro,p="y"===l?eo:to,f=r.rects.reference[c]+r.rects.reference[l]-a[l]-r.rects.popper[c],b=a[l]-r.rects.reference[l],m=Mo(s),g=m?"y"===l?m.clientHeight||0:m.clientWidth||0:0,y=f/2-b/2,v=u[h],O=g-d[c]-u[p],j=g/2-d[c]/2+y,_=Io(v,j,O),w=l;r.modifiersData[i]=((t={})[w]=_,t.centerOffset=_-j,t)}},effect:function(e){var t=e.state,r=e.options.element,i=void 0===r?"[data-popper-arrow]":r;null!=i&&("string"!==typeof i||(i=t.elements.popper.querySelector(i)))&&_o(t.elements.popper,i)&&(t.elements.arrow=i)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,r=e.name,i=t.rects.reference,n=t.rects.popper,s=t.modifiersData.preventOverflow,a=Ko(t,{elementContext:"reference"}),o=Ko(t,{altBoundary:!0}),l=tl(a,i),c=tl(o,n,s),u=rl(l),d=rl(c);t.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}}]});const ul="calcite-popper-anim",dl="calcite-popper-anim--active";function hl(e,t){const r=["left","right"],i=["start","end"];return"rtl"===ur(e)&&(r.reverse(),i.reverse()),t.replace(/-leading/gi,`-${i[0]}`).replace(/-trailing/gi,`-${i[1]}`).replace(/leading/gi,r[0]).replace(/trailing/gi,r[1])}function pl({referenceEl:e,el:t,placement:r,overlayPositioning:i="absolute",modifiers:n}){return e?cl(e,t,{strategy:i,placement:hl(t,r),modifiers:n}):null}function fl({el:e,modifiers:t,placement:r,popper:i}){const n=hl(e,r);i.setOptions({modifiers:t,placement:n})}const bl=Math.ceil((ml=4,gl=4,Math.sqrt(Math.pow(ml,2)+Math.pow(gl,2))));var ml,gl;const yl="CALCITE-COMBOBOX-ITEM",vl="CALCITE-COMBOBOX-ITEM-GROUP",Ol=`${yl}, ${vl}`,jl="bottom-leading";function _l(e){var t,r;const i=null===(t=e.parentElement)||void 0===t?void 0:t.closest(Ol);return[i,null===(r=null===i||void 0===i?void 0:i.parentElement)||void 0===r?void 0:r.closest(Ol)].filter((e=>e))}function wl(e){var t;return(null===(t=e.ancestors)||void 0===t?void 0:t.filter((e=>"CALCITE-COMBOBOX-ITEM"===e.nodeName)))||[]}function xl(e){return or(e.querySelectorAll("calcite-combobox-item")).filter((e=>e.selected)).length>0}function Sl(e){const[t,r]=_l(e);return t?r?2:1:0}HTMLElement;const Tl="icon",Cl="icon--active",Ml="icon--custom",Pl="icon--dot",Al="label--single",El="label",Rl="label--active",Il="label--selected",Dl="title",Fl=(HTMLElement,"list"),Ll="label",kl="title",zl=(HTMLElement,["ar","bs","ca","cs","da","de","de-CH","el","en","en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","nb","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]);function Vl(e){return new Intl.NumberFormat(e,{minimumFractionDigits:0,maximumFractionDigits:20})}function Nl(e,t){if(e){const r=Ul(t),i=Bl(t),n=e.split(""),s=n.lastIndexOf(i),a=n.map(((e,t)=>e===r||e===i&&t!==s?"":e)).reduce(((e,t)=>e+t)).replace(i,".");return isNaN(Number(a))?e:a}return e}function Ul(e){const t=Vl(e).formatToParts(1234567.8).find((e=>"group"===e.type)).value;return 0===t.trim().length?" ":t}function Bl(e){const t=Vl(e).formatToParts(1234567.8).find((e=>"decimal"===e.type)).value;return 0===t.trim().length?" ":t}function Gl(e,t,r=!1){if(e){const i=Number(ql(e));if(!isNaN(i)){return Vl(t).formatToParts(i).map((({type:e,value:i})=>{switch(e){case"group":return r?Ul(t):"";case"decimal":return Bl(t);default:return i}})).reduce(((e,t)=>e+t))}}return e}function ql(e){return(null===e||void 0===e?void 0:e.endsWith("."))?e.replace(".",""):e}const Hl={},Wl={};async function $l(e){const t=function(e=""){if(zl.indexOf(e)>-1)return e;{const t=e.split("-")[0];return zl.indexOf(t)>-1?t:"en"}}(e);if(Hl[t])return Hl[t];Wl[t]||(Wl[t]=fetch(Dt(`./assets/calcite-date-picker/nls/${t}.json`)).then((e=>e.json())).catch((()=>(console.error(`Translations for "${t}" not found or invalid, falling back to english`),$l("en")))));const r=await Wl[t];return Hl[t]=r,r}function Ql(e,t,r){const i=e.getTime(),n=!(t instanceof Date)||i>=t.getTime(),s=!(r instanceof Date)||i<=r.getTime();return n&&s}function Zl(e,t,r){if(!(e instanceof Date))return null;const i=e.getTime(),n=t instanceof Date&&i<t.getTime(),s=r instanceof Date&&i>r.getTime();return n?t:s?r:e}function Xl(e){if(e instanceof Date)return e;if(!e||"string"!==typeof e)return null;const t=e.split(/[: T-]/).map(parseFloat),r=new Date(t[0],(t[1]||1)-1,t[2]||1);if(r.setFullYear(t[0]),isNaN(r.getTime()))throw new Error(`Invalid ISO 8601 date: "${e}"`);return r}function Jl(e){return"string"===typeof e?e:e instanceof Date?e.toISOString().split("T")[0]:""}function Yl(e,t){return e instanceof Date&&t instanceof Date&&e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}function Kl(e,t){return String(e).split("").map((e=>t.numerals[e])).join("")}function ec(e){const t=e.toLowerCase();return["d","m","y"].sort(((e,r)=>t.indexOf(e)-t.indexOf(r)))}function tc(e,t){const r=e.getTime(),i=t.getTime();return 1e3*Math.abs(r-i)*60*60*24}const rc="next month",ic="previous month",nc=(HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,"container--s"),sc="container--m",ac="container--l",oc=(HTMLElement,"container--link"),lc="container--s",cc="container--m",uc="container--l",dc="container--multi-selection",hc="container--single-selection",pc="container--none-selection",fc=(HTMLElement,"button"),bc="plus",mc=(HTMLElement,"container"),gc="search-icon",yc="clear-button",vc="filter",Oc="Clear filter",jc="search",_c="x",wc=(HTMLElement,"frame"),xc="frame--advancing",Sc="frame--retreating";HTMLElement;function Tc(e){return e<0?-1:1}function Cc(e,t,r){const i=t[0]-e[0],n=t[1]-e[1];return i?(3*n/i-r)/2:r}function Mc(e,t,r,i,n){const[s,a]=e,[o,l]=t,c=(o-s)/3;return`C ${n([s+c,a+c*r]).join(",")} ${n([o-c,l-c*i]).join(",")} ${n([o,l]).join(",")}`}function Pc({data:e,min:t,max:r,t:i}){if(0===e.length)return"";const[n,s]=i(e[0]),[a,o]=i(t),[l]=i(r);let c,u,d;const h=e.reduce(((t,r,n)=>{if(u=e[n-2],d=e[n-1],n>1){const e=function(e,t,r){const i=t[0]-e[0],n=r[0]-t[0],s=(t[1]-e[1])/(i||n<0&&0),a=(r[1]-t[1])/(n||i<0&&0),o=(s*n+a*i)/(i+n);return(Tc(s)+Tc(a))*Math.min(Math.abs(s),Math.abs(a),.5*Math.abs(o))||0}(u,d,r),n=void 0===c?Cc(u,d,e):c,s=Mc(u,d,n,e,i);return c=e,`${t} ${s}`}return t}),`M ${a},${o} L ${a},${s} L ${n},${s}`),p=e[e.length-1];return`${h} ${Mc(d,p,c,Cc(d,p,c),i)} L ${l},${o} Z`}HTMLElement;const Ac="handle",Ec="handle--activated",Rc="drag",Ic=(HTMLElement,"flip-rtl"),Dc={},Fc={},Lc={s:16,m:24,l:32};async function kc({icon:e,scale:t}){const r=Lc[t],i=function(e){const t=!isNaN(Number(e.charAt(0))),r=e.split("-");if(1===r.length)return t?`i${e}`:e;return r.map(((e,r)=>0===r?t?`i${e.toUpperCase()}`:e:e.charAt(0).toUpperCase()+e.slice(1))).join("")}(e),n="F"===i.charAt(i.length-1),s=`${n?i.substring(0,i.length-1):i}${r}${n?"F":""}`;if(Dc[s])return Dc[s];Fc[s]||(Fc[s]=fetch(Dt(`./assets/calcite-icon/${s}.json`)).then((e=>e.json())).catch((()=>(console.error(`"${s}" is not a valid calcite-ui-icon name`),""))));const a=await Fc[s];return Dc[s]=a,a}HTMLElement;const zc="Click to edit",Vc="Cancel",Nc="Save",Uc=(HTMLElement,{tel:"phone",password:"lock",email:"email-address",date:"calendar",time:"clock",search:"search"}),Bc="action";function Gc(e){return!(!e||isNaN(Number(e)))}function qc(e){if(!e||(t=e,!rr.some((e=>t.includes(e)))))return null;var t;let r=!1;const i=e.split("").filter(((e,t)=>e.match(/\./g)&&!r?(r=!0,!0):!(!e.match(/\-/g)||0!==t)||rr.includes(e))).reduce(((e,t)=>e+t));return Gc(i)?Number(i).toString():null}HTMLElement;const Hc="bottom-leading";HTMLElement;var Wc;!function(e){e.valid="check-circle",e.invalid="exclamation-mark-triangle",e.idle="information"}(Wc||(Wc={}));HTMLElement;function $c(e){if(!Gc(e))return null;const t=parseInt(e);return t>=0&&t<=11?"AM":"PM"}function Qc(e){if(!e||e.endsWith(":")||e.startsWith(":"))return null;const t=e.split(":");if(t.length>1){const[e,r,i]=t,n=parseInt(t[0]),s=parseInt(t[1]),a=parseInt(t[2]),o=Gc(e)&&n>=0&&n<24,l=Gc(r)&&s>=0&&s<60,c=Gc(i)&&a>=0&&a<60;if(o&&l&&!i||o&&l&&c){let e=`${Zc(n)}:${Zc(s)}`;return c&&(e=`${e}:${Zc(a)}`),e}}return null}function Zc(e){const t=e.toString();return e>=0&&e<=9?t.padStart(2,"0"):t}HTMLElement,HTMLElement,HTMLElement,HTMLElement;function Xc(e,t,r,i=20,n=0){let s=[];if(n>=i)return s;const a=e=>{const s=e.assignedNodes().filter((e=>1===e.nodeType));return s.length>0?Xc(s[0].parentElement,t,r,i,n+1):[]},o=Array.from(e.children||[]);for(const l of o)t(l)||(r(l)&&s.push(l),null!=l.shadowRoot?s.push(...Xc(l.shadowRoot,t,r,i,n+1)):"SLOT"===l.tagName?s.push(...a(l)):s.push(...Xc(l,t,r,i,n+1)));return s}function Jc(e){return e.hasAttribute("hidden")||e.hasAttribute("aria-hidden")&&"false"!==e.getAttribute("aria-hidden")||"none"===e.style.display||"0"===e.style.opacity||"hidden"===e.style.visibility||"collapse"===e.style.visibility}function Yc(e){return"function"===typeof e.setFocus||"-1"!==(t=e).getAttribute("tabindex")&&!Jc(t)&&!function(e){return e.hasAttribute("disabled")||e.hasAttribute("aria-disabled")&&"false"!==e.getAttribute("aria-disabled")}(t)&&(t.hasAttribute("tabindex")||(t instanceof HTMLAnchorElement||t instanceof HTMLAreaElement)&&t.hasAttribute("href")||t instanceof HTMLButtonElement||t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement||t instanceof HTMLIFrameElement);var t}function Kc(e){return Xc(e,Jc,Yc)}HTMLElement;const eu="Close",tu="title",ru="message",iu="link",nu=(HTMLElement,HTMLElement,HTMLElement,"page"),su="is-selected",au="previous",ou="next",lu="is-disabled",cu="ellipsis",uu="ellipsis--start",du="ellipsis--end",hu="next",pu="previous",fu=(HTMLElement,"back-button"),bu="container",mu="header",gu="heading",yu="summary",vu="header-content",Ou="header-actions",ju="header-actions--end",_u="header-actions--start",wu="content-container",xu="fab-container",Su="footer",Tu="x",Cu="chevron-left",Mu="chevron-right",Pu="header-actions-start",Au="header-actions-end",Eu="header-menu-actions",Ru="header-content",Iu="fab",Du="footer",Fu="footer-actions",Lu="Back",ku="Close",zu="Options",Vu=(HTMLElement,"sticky");var Nu;function Uu(){this.setUpItems(),this.setUpFilter()}!function(e){e.circle="circle",e.square="square",e.grip="grip"}(Nu||(Nu={}));const Bu=["ArrowUp","ArrowDown"];function Gu(){this.setUpItems(),this.setUpFilter(),this.emitCalciteListChange=Va(Xu.bind(this),0)}function qu(){this.observer.observe(this.el,{childList:!0,subtree:!0})}function Hu(){this.observer.disconnect()}function Wu(e){const{selectedValues:t}=this,{item:r,value:i,selected:n,shiftPressed:s}=e.detail;n?(this.multiple&&s&&this.selectSiblings(r),this.multiple||this.deselectSiblingItems(r),t.set(i,r)):(t.delete(i),this.multiple&&s&&this.selectSiblings(r,!0)),this.multiple||(Yu(r,n),n&&mr(r)),this.lastSelectedItem=r,this.emitCalciteListChange()}function $u(e){e.stopPropagation();const t=e.detail.oldValue,r=this.selectedValues;if(r.has(t)){const i=r.get(t);r.delete(t),r.set(e.detail.newValue,i)}}function Qu(e){const{el:t,items:r,multiple:i,selectedValues:n}=this;if(i)return;!t.contains(e.relatedTarget)?r.forEach((t=>Yu(t,0===n.size?e.target===t:t.selected))):Yu(e.target,!1)}function Zu(e){const{key:t,target:r}=e;if(!function(e){return!!Bu.find((t=>t===e))}(t))return;const{items:i}=this,{length:n}=i,s=i.indexOf(r);if(!n||-1===s)return;e.preventDefault();const a=i[$r(s+("ArrowUp"===t?-1:1),n)];Yu(a,!0),mr(a)}function Xu(){this.calciteListChange.emit(this.selectedValues)}function Ju(e){if(e.defaultPrevented)return;const t=e.target,r=this.selectedValues;"CALCITE-PICK-LIST-GROUP"===t.parentElement.tagName?(t.parentElement.remove(),Array.from(t.parentElement.children).forEach((e=>r.delete(e.value)))):(t.remove(),r.delete(t.value)),this.emitCalciteListChange()}function Yu(e,t){t?e.removeAttribute("tabindex"):e.setAttribute("tabindex","-1")}async function Ku(e){if(this.filterEnabled&&"filter"===e)return void await mr(this.filterEl);const{multiple:t,items:r}=this;if(0===r.length)return;if(t)return r[0].setFocus();const i=r.find((e=>e.selected));return(i||r[0]).setFocus()}function ed(e){this.items=Array.from(this.el.querySelectorAll(e));let t=!1;const{items:r}=this;r.forEach((e=>{e.icon=this.getIconType(),this.multiple||(e.disableDeselect=!0,Yu(e,!1)),e.selected&&(t=!0,Yu(e,!0),this.selectedValues.set(e.value,e))}));const[i]=r;!t&&i&&Yu(i,!0)}function td(e){this.items.forEach((t=>{t.value!==e.value&&(t.toggleSelected(!1),this.selectedValues.has(t.value)&&this.selectedValues.delete(t.value))}))}function rd(e,t=!1){if(!this.lastSelectedItem)return;const{items:r}=this,i=r.findIndex((e=>e.value===this.lastSelectedItem.value)),n=r.findIndex((t=>t.value===e.value));r.slice(Math.min(i,n),Math.max(i,n)).forEach((e=>{e.toggleSelected(!t),t?this.selectedValues.delete(e.value):this.selectedValues.set(e.value,e)}))}let id;function nd(e){const t=e.detail.map((e=>e.value));let r=!1;id||(id=new Set);const i=this.items.filter((e=>{const i=e.parentElement;i.matches("calcite-pick-list-group")&&id.add(i);const n=t.includes(e.value);return e.hidden=!n,r||(r=n&&e.selected),n}));id.forEach((e=>{const t=i.some((t=>e.contains(t)));if(e.hidden=!t,!t)return;const r=gr(e,"parent-item");r&&(r.hidden=!1,i.includes(r)&&Array.from(e.children).forEach((e=>e.hidden=!1)))})),id.clear(),i.length>0&&!r&&!this.multiple&&Yu(i[0],!0)}function sd(){return this.items.map((e=>({label:e.label,description:e.description,metadata:e.metadata,value:e.value})))}var ad=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r};const od=e=>{var{props:{disabled:t,loading:r,filterEnabled:i,dataForFilter:n,handleFilter:s,filterPlaceholder:a,el:o,setFilterEl:l}}=e,c=ad(e,["props"]);const u=qe("slot",null);return qe(We,Object.assign({"aria-busy":r.toString(),"aria-disabled":t.toString(),role:"menu"},c),qe("section",null,qe("header",{class:{[Vu]:!0}},i?qe("calcite-filter",{"aria-label":a,data:n,dir:ur(o),disabled:r||t,onCalciteFilterChange:s,placeholder:a,ref:l}):null,qe("slot",{name:"menu-actions"})),r||t?qe("calcite-scrim",{loading:r}):null,u))},ld=(HTMLElement,"heading"),cd="container",ud="container--indented",dd="parent-item",hd=(HTMLElement,"actions"),pd="actions--end",fd="actions--start",bd="description",md="handle",gd="handle--activated",yd="icon",vd="icon-dot",Od="label",jd="remove",_d="title",wd="text-container",xd="check",Sd="x",Td="actions-end",Cd="actions-start",Md="remove",Pd=(HTMLElement,"container"),Ad="arrow",Ed="close-button",Rd="content",Id="has-header",Dd="header",Fd="heading",Ld="Close",kd="data-calcite-popover-reference",zd="aria-controls",Vd="aria-expanded",Nd=(HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,"Rating"),Ud="stars: ${num}",Bd=(HTMLElement,"scrim"),Gd="Loading",qd=(HTMLElement,"icon"),Hd="icon-container",Wd="select";function $d(e){return"CALCITE-OPTION"===e.tagName}HTMLElement;const Qd="main",Zd="main--reversed",Xd="content",Jd="content--behind",Yd="footer",Kd="primary-panel",eh="contextual-panel",th="header",rh="footer",ih=(HTMLElement,"action-bar-container"),nh="content",sh="action-bar",ah=(HTMLElement,"content"),oh="content__header",lh="content__body",ch="content--detached",uh="action-bar",dh="header";HTMLElement,HTMLElement;function hh(e){return(hh="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ph(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fh(){return(fh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function bh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),i.forEach((function(t){ph(e,t,r[t])}))}return e}function mh(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function gh(e){if("undefined"!==typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var yh=gh(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),vh=gh(/Edge/i),Oh=gh(/firefox/i),jh=gh(/safari/i)&&!gh(/chrome/i)&&!gh(/android/i),_h=gh(/iP(ad|od|hone)/i),wh=gh(/chrome/i)&&gh(/android/i),xh={capture:!1,passive:!1};function Sh(e,t,r){e.addEventListener(t,r,!yh&&xh)}function Th(e,t,r){e.removeEventListener(t,r,!yh&&xh)}function Ch(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(r){return!1}return!1}}function Mh(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Ph(e,t,r,i){if(e){r=r||document;do{if(null!=t&&(">"===t[0]?e.parentNode===r&&Ch(e,t):Ch(e,t))||i&&e===r)return e;if(e===r)break}while(e=Mh(e))}return null}var Ah,Eh=/\s+/g;function Rh(e,t,r){if(e&&t)if(e.classList)e.classList[r?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(Eh," ").replace(" "+t+" "," ");e.className=(i+(r?" "+t:"")).replace(Eh," ")}}function Ih(e,t,r){var i=e&&e.style;if(i){if(void 0===r)return document.defaultView&&document.defaultView.getComputedStyle?r=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(r=e.currentStyle),void 0===t?r:r[t];t in i||-1!==t.indexOf("webkit")||(t="-webkit-"+t),i[t]=r+("string"===typeof r?"":"px")}}function Dh(e,t){var r="";if("string"===typeof e)r=e;else do{var i=Ih(e,"transform");i&&"none"!==i&&(r=i+" "+r)}while(!t&&(e=e.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(r)}function Fh(e,t,r){if(e){var i=e.getElementsByTagName(t),n=0,s=i.length;if(r)for(;n<s;n++)r(i[n],n);return i}return[]}function Lh(){var e=document.scrollingElement;return e||document.documentElement}function kh(e,t,r,i,n){if(e.getBoundingClientRect||e===window){var s,a,o,l,c,u,d;if(e!==window&&e.parentNode&&e!==Lh()?(a=(s=e.getBoundingClientRect()).top,o=s.left,l=s.bottom,c=s.right,u=s.height,d=s.width):(a=0,o=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,d=window.innerWidth),(t||r)&&e!==window&&(n=n||e.parentNode,!yh))do{if(n&&n.getBoundingClientRect&&("none"!==Ih(n,"transform")||r&&"static"!==Ih(n,"position"))){var h=n.getBoundingClientRect();a-=h.top+parseInt(Ih(n,"border-top-width")),o-=h.left+parseInt(Ih(n,"border-left-width")),l=a+s.height,c=o+s.width;break}}while(n=n.parentNode);if(i&&e!==window){var p=Dh(n||e),f=p&&p.a,b=p&&p.d;p&&(l=(a/=b)+(u/=b),c=(o/=f)+(d/=f))}return{top:a,left:o,bottom:l,right:c,width:d,height:u}}}function zh(e,t,r){for(var i=Gh(e,!0),n=kh(e)[t];i;){var s=kh(i)[r];if(!("top"===r||"left"===r?n>=s:n<=s))return i;if(i===Lh())break;i=Gh(i,!1)}return!1}function Vh(e,t,r){for(var i=0,n=0,s=e.children;n<s.length;){if("none"!==s[n].style.display&&s[n]!==Hp.ghost&&s[n]!==Hp.dragged&&Ph(s[n],r.draggable,e,!1)){if(i===t)return s[n];i++}n++}return null}function Nh(e,t){for(var r=e.lastElementChild;r&&(r===Hp.ghost||"none"===Ih(r,"display")||t&&!Ch(r,t));)r=r.previousElementSibling;return r||null}function Uh(e,t){var r=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Hp.clone||t&&!Ch(e,t)||r++;return r}function Bh(e){var t=0,r=0,i=Lh();if(e)do{var n=Dh(e),s=n.a,a=n.d;t+=e.scrollLeft*s,r+=e.scrollTop*a}while(e!==i&&(e=e.parentNode));return[t,r]}function Gh(e,t){if(!e||!e.getBoundingClientRect)return Lh();var r=e,i=!1;do{if(r.clientWidth<r.scrollWidth||r.clientHeight<r.scrollHeight){var n=Ih(r);if(r.clientWidth<r.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||r.clientHeight<r.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!r.getBoundingClientRect||r===document.body)return Lh();if(i||t)return r;i=!0}}}while(r=r.parentNode);return Lh()}function qh(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function Hh(e,t){return function(){if(!Ah){var r=arguments,i=this;1===r.length?e.call(i,r[0]):e.apply(i,r),Ah=setTimeout((function(){Ah=void 0}),t)}}}function Wh(e,t,r){e.scrollLeft+=t,e.scrollTop+=r}function $h(e){var t=window.Polymer,r=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):r?r(e).clone(!0)[0]:e.cloneNode(!0)}var Qh="Sortable"+(new Date).getTime();function Zh(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==Ih(e,"display")&&e!==Hp.ghost){t.push({target:e,rect:kh(e)});var r=bh({},t[t.length-1].rect);if(e.thisAnimationDuration){var i=Dh(e,!0);i&&(r.top-=i.f,r.left-=i.e)}e.fromRect=r}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var r in e)if(e.hasOwnProperty(r))for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[r][i])return Number(r);return-1}(t,{target:e}),1)},animateAll:function(r){var i=this;if(!this.options.animation)return clearTimeout(e),void("function"===typeof r&&r());var n=!1,s=0;t.forEach((function(e){var t=0,r=e.target,a=r.fromRect,o=kh(r),l=r.prevFromRect,c=r.prevToRect,u=e.rect,d=Dh(r,!0);d&&(o.top-=d.f,o.left-=d.e),r.toRect=o,r.thisAnimationDuration&&qh(l,o)&&!qh(a,o)&&(u.top-o.top)/(u.left-o.left)===(a.top-o.top)/(a.left-o.left)&&(t=function(e,t,r,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-r.top,2)+Math.pow(t.left-r.left,2))*i.animation}(u,l,c,i.options)),qh(o,a)||(r.prevFromRect=a,r.prevToRect=o,t||(t=i.options.animation),i.animate(r,u,o,t)),t&&(n=!0,s=Math.max(s,t),clearTimeout(r.animationResetTimer),r.animationResetTimer=setTimeout((function(){r.animationTime=0,r.prevFromRect=null,r.fromRect=null,r.prevToRect=null,r.thisAnimationDuration=null}),t),r.thisAnimationDuration=t)})),clearTimeout(e),n?e=setTimeout((function(){"function"===typeof r&&r()}),s):"function"===typeof r&&r(),t=[]},animate:function(e,t,r,i){if(i){Ih(e,"transition",""),Ih(e,"transform","");var n=Dh(this.el),s=n&&n.a,a=n&&n.d,o=(t.left-r.left)/(s||1),l=(t.top-r.top)/(a||1);e.animatingX=!!o,e.animatingY=!!l,Ih(e,"transform","translate3d("+o+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),Ih(e,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),Ih(e,"transform","translate3d(0,0,0)"),"number"===typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){Ih(e,"transition",""),Ih(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),i)}}}}var Xh=[],Jh={initializeByDefault:!0},Yh={mount:function(e){for(var t in Jh)Jh.hasOwnProperty(t)&&!(t in e)&&(e[t]=Jh[t]);Xh.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),Xh.push(e)},pluginEvent:function(e,t,r){var i=this;this.eventCanceled=!1,r.cancel=function(){i.eventCanceled=!0};var n=e+"Global";Xh.forEach((function(i){t[i.pluginName]&&(t[i.pluginName][n]&&t[i.pluginName][n](bh({sortable:t},r)),t.options[i.pluginName]&&t[i.pluginName][e]&&t[i.pluginName][e](bh({sortable:t},r)))}))},initializePlugins:function(e,t,r,i){for(var n in Xh.forEach((function(i){var n=i.pluginName;if(e.options[n]||i.initializeByDefault){var s=new i(e,t,e.options);s.sortable=e,s.options=e.options,e[n]=s,fh(r,s.defaults)}})),e.options)if(e.options.hasOwnProperty(n)){var s=this.modifyOption(e,n,e.options[n]);"undefined"!==typeof s&&(e.options[n]=s)}},getEventProperties:function(e,t){var r={};return Xh.forEach((function(i){"function"===typeof i.eventProperties&&fh(r,i.eventProperties.call(t[i.pluginName],e))})),r},modifyOption:function(e,t,r){var i;return Xh.forEach((function(n){e[n.pluginName]&&n.optionListeners&&"function"===typeof n.optionListeners[t]&&(i=n.optionListeners[t].call(e[n.pluginName],r))})),i}};var Kh=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.evt,n=mh(r,["evt"]);Yh.pluginEvent.bind(Hp)(e,t,bh({dragEl:tp,parentEl:rp,ghostEl:ip,rootEl:np,nextEl:sp,lastDownEl:ap,cloneEl:op,cloneHidden:lp,dragStarted:jp,putSortable:fp,activeSortable:Hp.active,originalEvent:i,oldIndex:cp,oldDraggableIndex:dp,newIndex:up,newDraggableIndex:hp,hideGhostForTarget:Up,unhideGhostForTarget:Bp,cloneNowHidden:function(){lp=!0},cloneNowShown:function(){lp=!1},dispatchSortableEvent:function(e){ep({sortable:t,name:e,originalEvent:i})}},n))};function ep(e){!function(e){var t=e.sortable,r=e.rootEl,i=e.name,n=e.targetEl,s=e.cloneEl,a=e.toEl,o=e.fromEl,l=e.oldIndex,c=e.newIndex,u=e.oldDraggableIndex,d=e.newDraggableIndex,h=e.originalEvent,p=e.putSortable,f=e.extraEventProperties;if(t=t||r&&r[Qh]){var b,m=t.options,g="on"+i.charAt(0).toUpperCase()+i.substr(1);!window.CustomEvent||yh||vh?(b=document.createEvent("Event")).initEvent(i,!0,!0):b=new CustomEvent(i,{bubbles:!0,cancelable:!0}),b.to=a||r,b.from=o||r,b.item=n||r,b.clone=s,b.oldIndex=l,b.newIndex=c,b.oldDraggableIndex=u,b.newDraggableIndex=d,b.originalEvent=h,b.pullMode=p?p.lastPutMode:void 0;var y=bh({},f,Yh.getEventProperties(i,t));for(var v in y)b[v]=y[v];r&&r.dispatchEvent(b),m[g]&&m[g].call(t,b)}}(bh({putSortable:fp,cloneEl:op,targetEl:tp,rootEl:np,oldIndex:cp,oldDraggableIndex:dp,newIndex:up,newDraggableIndex:hp},e))}var tp,rp,ip,np,sp,ap,op,lp,cp,up,dp,hp,pp,fp,bp,mp,gp,yp,vp,Op,jp,_p,wp,xp,Sp,Tp=!1,Cp=!1,Mp=[],Pp=!1,Ap=!1,Ep=[],Rp=!1,Ip=[],Dp="undefined"!==typeof document,Fp=_h,Lp=vh||yh?"cssFloat":"float",kp=Dp&&!wh&&!_h&&"draggable"in document.createElement("div"),zp=function(){if(Dp){if(yh)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Vp=function(e,t){var r=Ih(e),i=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),n=Vh(e,0,t),s=Vh(e,1,t),a=n&&Ih(n),o=s&&Ih(s),l=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+kh(n).width,c=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+kh(s).width;if("flex"===r.display)return"column"===r.flexDirection||"column-reverse"===r.flexDirection?"vertical":"horizontal";if("grid"===r.display)return r.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&a.float&&"none"!==a.float){var u="left"===a.float?"left":"right";return!s||"both"!==o.clear&&o.clear!==u?"horizontal":"vertical"}return n&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||l>=i&&"none"===r[Lp]||s&&"none"===r[Lp]&&l+c>i)?"vertical":"horizontal"},Np=function(e){function t(e,r){return function(i,n,s,a){var o=i.options.group.name&&n.options.group.name&&i.options.group.name===n.options.group.name;if(null==e&&(r||o))return!0;if(null==e||!1===e)return!1;if(r&&"clone"===e)return e;if("function"===typeof e)return t(e(i,n,s,a),r)(i,n,s,a);var l=(r?i:n).options.group.name;return!0===e||"string"===typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var r={},i=e.group;i&&"object"==hh(i)||(i={name:i}),r.name=i.name,r.checkPull=t(i.pull,!0),r.checkPut=t(i.put),r.revertClone=i.revertClone,e.group=r},Up=function(){!zp&&ip&&Ih(ip,"display","none")},Bp=function(){!zp&&ip&&Ih(ip,"display","")};Dp&&document.addEventListener("click",(function(e){if(Cp)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),Cp=!1,!1}),!0);var Gp=function(e){if(tp){var t=function(e,t){var r;return Mp.some((function(i){if(!Nh(i)){var n=kh(i),s=i[Qh].options.emptyInsertThreshold,a=e>=n.left-s&&e<=n.right+s,o=t>=n.top-s&&t<=n.bottom+s;return s&&a&&o?r=i:void 0}})),r}((e=e.touches?e.touches[0]:e).clientX,e.clientY);if(t){var r={};for(var i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);r.target=r.rootEl=t,r.preventDefault=void 0,r.stopPropagation=void 0,t[Qh]._onDragOver(r)}}},qp=function(e){tp&&tp.parentNode[Qh]._isOutsideThisEl(e.target)};function Hp(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=fh({},t),e[Qh]=this;var r={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Vp(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Hp.supportPointer&&"PointerEvent"in window&&!jh,emptyInsertThreshold:5};for(var i in Yh.initializePlugins(this,e,r),r)!(i in t)&&(t[i]=r[i]);for(var n in Np(t),this)"_"===n.charAt(0)&&"function"===typeof this[n]&&(this[n]=this[n].bind(this));this.nativeDraggable=!t.forceFallback&&kp,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?Sh(e,"pointerdown",this._onTapStart):(Sh(e,"mousedown",this._onTapStart),Sh(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(Sh(e,"dragover",this),Sh(e,"dragenter",this)),Mp.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),fh(this,Zh())}function Wp(e,t,r,i,n,s,a,o){var l,c,u=e[Qh],d=u.options.onMove;return!window.CustomEvent||yh||vh?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=r,l.draggedRect=i,l.related=n||t,l.relatedRect=s||kh(t),l.willInsertAfter=o,l.originalEvent=a,e.dispatchEvent(l),d&&(c=d.call(u,l,a)),c}function $p(e){e.draggable=!1}function Qp(){Rp=!1}function Zp(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,r=t.length,i=0;r--;)i+=t.charCodeAt(r);return i.toString(36)}function Xp(e){return setTimeout(e,0)}function Jp(e){return clearTimeout(e)}Hp.prototype={constructor:Hp,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(_p=null)},_getDirection:function(e,t){return"function"===typeof this.options.direction?this.options.direction.call(this,e,t,tp):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,r=this.el,i=this.options,n=i.preventOnFilter,s=e.type,a=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,o=(a||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||o,c=i.filter;if(function(e){Ip.length=0;var t=e.getElementsByTagName("input"),r=t.length;for(;r--;){var i=t[r];i.checked&&Ip.push(i)}}(r),!tp&&!(/mousedown|pointerdown/.test(s)&&0!==e.button||i.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!jh||!o||"SELECT"!==o.tagName.toUpperCase())&&(!(o=Ph(o,i.draggable,r,!1))||!o.animated)&&ap!==o){if(cp=Uh(o),dp=Uh(o,i.draggable),"function"===typeof c){if(c.call(this,e,o,this))return ep({sortable:t,rootEl:l,name:"filter",targetEl:o,toEl:r,fromEl:r}),Kh("filter",t,{evt:e}),void(n&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some((function(i){if(i=Ph(l,i.trim(),r,!1))return ep({sortable:t,rootEl:i,name:"filter",targetEl:o,fromEl:r,toEl:r}),Kh("filter",t,{evt:e}),!0}))))return void(n&&e.cancelable&&e.preventDefault());i.handle&&!Ph(l,i.handle,r,!1)||this._prepareDragStart(e,a,o)}}},_prepareDragStart:function(e,t,r){var i,n=this,s=n.el,a=n.options,o=s.ownerDocument;if(r&&!tp&&r.parentNode===s){var l=kh(r);if(np=s,rp=(tp=r).parentNode,sp=tp.nextSibling,ap=r,pp=a.group,Hp.dragged=tp,bp={target:tp,clientX:(t||e).clientX,clientY:(t||e).clientY},vp=bp.clientX-l.left,Op=bp.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,tp.style["will-change"]="all",i=function(){Kh("delayEnded",n,{evt:e}),Hp.eventCanceled?n._onDrop():(n._disableDelayedDragEvents(),!Oh&&n.nativeDraggable&&(tp.draggable=!0),n._triggerDragStart(e,t),ep({sortable:n,name:"choose",originalEvent:e}),Rh(tp,a.chosenClass,!0))},a.ignore.split(",").forEach((function(e){Fh(tp,e.trim(),$p)})),Sh(o,"dragover",Gp),Sh(o,"mousemove",Gp),Sh(o,"touchmove",Gp),Sh(o,"mouseup",n._onDrop),Sh(o,"touchend",n._onDrop),Sh(o,"touchcancel",n._onDrop),Oh&&this.nativeDraggable&&(this.options.touchStartThreshold=4,tp.draggable=!0),Kh("delayStart",this,{evt:e}),!a.delay||a.delayOnTouchOnly&&!t||this.nativeDraggable&&(vh||yh))i();else{if(Hp.eventCanceled)return void this._onDrop();Sh(o,"mouseup",n._disableDelayedDrag),Sh(o,"touchend",n._disableDelayedDrag),Sh(o,"touchcancel",n._disableDelayedDrag),Sh(o,"mousemove",n._delayedDragTouchMoveHandler),Sh(o,"touchmove",n._delayedDragTouchMoveHandler),a.supportPointer&&Sh(o,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(i,a.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){tp&&$p(tp),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;Th(e,"mouseup",this._disableDelayedDrag),Th(e,"touchend",this._disableDelayedDrag),Th(e,"touchcancel",this._disableDelayedDrag),Th(e,"mousemove",this._delayedDragTouchMoveHandler),Th(e,"touchmove",this._delayedDragTouchMoveHandler),Th(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?Sh(document,"pointermove",this._onTouchMove):Sh(document,t?"touchmove":"mousemove",this._onTouchMove):(Sh(tp,"dragend",this),Sh(np,"dragstart",this._onDragStart));try{document.selection?Xp((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(r){}},_dragStarted:function(e,t){if(Tp=!1,np&&tp){Kh("dragStarted",this,{evt:t}),this.nativeDraggable&&Sh(document,"dragover",qp);var r=this.options;!e&&Rh(tp,r.dragClass,!1),Rh(tp,r.ghostClass,!0),Hp.active=this,e&&this._appendGhost(),ep({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(mp){this._lastX=mp.clientX,this._lastY=mp.clientY,Up();for(var e=document.elementFromPoint(mp.clientX,mp.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(mp.clientX,mp.clientY))!==t;)t=e;if(tp.parentNode[Qh]._isOutsideThisEl(e),t)do{if(t[Qh]){if(t[Qh]._onDragOver({clientX:mp.clientX,clientY:mp.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);Bp()}},_onTouchMove:function(e){if(bp){var t=this.options,r=t.fallbackTolerance,i=t.fallbackOffset,n=e.touches?e.touches[0]:e,s=ip&&Dh(ip,!0),a=ip&&s&&s.a,o=ip&&s&&s.d,l=Fp&&Sp&&Bh(Sp),c=(n.clientX-bp.clientX+i.x)/(a||1)+(l?l[0]-Ep[0]:0)/(a||1),u=(n.clientY-bp.clientY+i.y)/(o||1)+(l?l[1]-Ep[1]:0)/(o||1);if(!Hp.active&&!Tp){if(r&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<r)return;this._onDragStart(e,!0)}if(ip){s?(s.e+=c-(gp||0),s.f+=u-(yp||0)):s={a:1,b:0,c:0,d:1,e:c,f:u};var d="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");Ih(ip,"webkitTransform",d),Ih(ip,"mozTransform",d),Ih(ip,"msTransform",d),Ih(ip,"transform",d),gp=c,yp=u,mp=n}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!ip){var e=this.options.fallbackOnBody?document.body:np,t=kh(tp,!0,Fp,!0,e),r=this.options;if(Fp){for(Sp=e;"static"===Ih(Sp,"position")&&"none"===Ih(Sp,"transform")&&Sp!==document;)Sp=Sp.parentNode;Sp!==document.body&&Sp!==document.documentElement?(Sp===document&&(Sp=Lh()),t.top+=Sp.scrollTop,t.left+=Sp.scrollLeft):Sp=Lh(),Ep=Bh(Sp)}Rh(ip=tp.cloneNode(!0),r.ghostClass,!1),Rh(ip,r.fallbackClass,!0),Rh(ip,r.dragClass,!0),Ih(ip,"transition",""),Ih(ip,"transform",""),Ih(ip,"box-sizing","border-box"),Ih(ip,"margin",0),Ih(ip,"top",t.top),Ih(ip,"left",t.left),Ih(ip,"width",t.width),Ih(ip,"height",t.height),Ih(ip,"opacity","0.8"),Ih(ip,"position",Fp?"absolute":"fixed"),Ih(ip,"zIndex","100000"),Ih(ip,"pointerEvents","none"),Hp.ghost=ip,e.appendChild(ip),Ih(ip,"transform-origin",vp/parseInt(ip.style.width)*100+"% "+Op/parseInt(ip.style.height)*100+"%")}},_onDragStart:function(e,t){var r=this,i=e.dataTransfer,n=r.options;Kh("dragStart",this,{evt:e}),Hp.eventCanceled?this._onDrop():(Kh("setupClone",this),Hp.eventCanceled||((op=$h(tp)).draggable=!1,op.style["will-change"]="",this._hideClone(),Rh(op,this.options.chosenClass,!1),Hp.clone=op),r.cloneId=Xp((function(){Kh("clone",r),Hp.eventCanceled||(r.options.removeCloneOnHide||np.insertBefore(op,tp),r._hideClone(),ep({sortable:r,name:"clone"}))})),!t&&Rh(tp,n.dragClass,!0),t?(Cp=!0,r._loopId=setInterval(r._emulateDragOver,50)):(Th(document,"mouseup",r._onDrop),Th(document,"touchend",r._onDrop),Th(document,"touchcancel",r._onDrop),i&&(i.effectAllowed="move",n.setData&&n.setData.call(r,i,tp)),Sh(document,"drop",r),Ih(tp,"transform","translateZ(0)")),Tp=!0,r._dragStartId=Xp(r._dragStarted.bind(r,t,e)),Sh(document,"selectstart",r),jp=!0,jh&&Ih(document.body,"user-select","none"))},_onDragOver:function(e){var t,r,i,n,s=this.el,a=e.target,o=this.options,l=o.group,c=Hp.active,u=pp===l,d=o.sort,h=fp||c,p=this,f=!1;if(!Rp){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),a=Ph(a,o.draggable,s,!0),M("dragOver"),Hp.eventCanceled)return f;if(tp.contains(e.target)||a.animated&&a.animatingX&&a.animatingY||p._ignoreWhileAnimating===a)return A(!1);if(Cp=!1,c&&!o.disabled&&(u?d||(i=!np.contains(tp)):fp===this||(this.lastPutMode=pp.checkPull(this,c,tp,e))&&l.checkPut(this,c,tp,e))){if(n="vertical"===this._getDirection(e,a),t=kh(tp),M("dragOverValid"),Hp.eventCanceled)return f;if(i)return rp=np,P(),this._hideClone(),M("revert"),Hp.eventCanceled||(sp?np.insertBefore(tp,sp):np.appendChild(tp)),A(!0);var b=Nh(s,o.draggable);if(!b||function(e,t,r){var i=kh(Nh(r.el,r.options.draggable)),n=10;return t?e.clientX>i.right+n||e.clientX<=i.right&&e.clientY>i.bottom&&e.clientX>=i.left:e.clientX>i.right&&e.clientY>i.top||e.clientX<=i.right&&e.clientY>i.bottom+n}(e,n,this)&&!b.animated){if(b===tp)return A(!1);if(b&&s===e.target&&(a=b),a&&(r=kh(a)),!1!==Wp(np,s,tp,t,a,r,e,!!a))return P(),s.appendChild(tp),rp=s,E(),A(!0)}else if(a.parentNode===s){r=kh(a);var m,g,y,v=tp.parentNode!==s,O=!function(e,t,r){var i=r?e.left:e.top,n=r?e.right:e.bottom,s=r?e.width:e.height,a=r?t.left:t.top,o=r?t.right:t.bottom,l=r?t.width:t.height;return i===a||n===o||i+s/2===a+l/2}(tp.animated&&tp.toRect||t,a.animated&&a.toRect||r,n),j=n?"top":"left",_=zh(a,"top","top")||zh(tp,"top","top"),w=_?_.scrollTop:void 0;if(_p!==a&&(g=r[j],Pp=!1,Ap=!O&&o.invertSwap||v),0!==(m=function(e,t,r,i,n,s,a,o){var l=i?e.clientY:e.clientX,c=i?r.height:r.width,u=i?r.top:r.left,d=i?r.bottom:r.right,h=!1;if(!a)if(o&&xp<c*n){if(!Pp&&(1===wp?l>u+c*s/2:l<d-c*s/2)&&(Pp=!0),Pp)h=!0;else if(1===wp?l<u+xp:l>d-xp)return-wp}else if(l>u+c*(1-n)/2&&l<d-c*(1-n)/2)return function(e){return Uh(tp)<Uh(e)?1:-1}(t);if((h=h||a)&&(l<u+c*s/2||l>d-c*s/2))return l>u+c/2?1:-1;return 0}(e,a,r,n,O?1:o.swapThreshold,null==o.invertedSwapThreshold?o.swapThreshold:o.invertedSwapThreshold,Ap,_p===a))){var x=Uh(tp);do{x-=m,y=rp.children[x]}while(y&&("none"===Ih(y,"display")||y===ip))}if(0===m||y===a)return A(!1);_p=a,wp=m;var S=a.nextElementSibling,T=!1,C=Wp(np,s,tp,t,a,r,e,T=1===m);if(!1!==C)return 1!==C&&-1!==C||(T=1===C),Rp=!0,setTimeout(Qp,30),P(),T&&!S?s.appendChild(tp):a.parentNode.insertBefore(tp,T?S:a),_&&Wh(_,0,w-_.scrollTop),rp=tp.parentNode,void 0===g||Ap||(xp=Math.abs(g-kh(a)[j])),E(),A(!0)}if(s.contains(tp))return A(!1)}return!1}function M(o,l){Kh(o,p,bh({evt:e,isOwner:u,axis:n?"vertical":"horizontal",revert:i,dragRect:t,targetRect:r,canSort:d,fromSortable:h,target:a,completed:A,onMove:function(r,i){return Wp(np,s,tp,t,r,kh(r),e,i)},changed:E},l))}function P(){M("dragOverAnimationCapture"),p.captureAnimationState(),p!==h&&h.captureAnimationState()}function A(t){return M("dragOverCompleted",{insertion:t}),t&&(u?c._hideClone():c._showClone(p),p!==h&&(Rh(tp,fp?fp.options.ghostClass:c.options.ghostClass,!1),Rh(tp,o.ghostClass,!0)),fp!==p&&p!==Hp.active?fp=p:p===Hp.active&&fp&&(fp=null),h===p&&(p._ignoreWhileAnimating=a),p.animateAll((function(){M("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(a===tp&&!tp.animated||a===s&&!a.animated)&&(_p=null),o.dragoverBubble||e.rootEl||a===document||(tp.parentNode[Qh]._isOutsideThisEl(e.target),!t&&Gp(e)),!o.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),f=!0}function E(){up=Uh(tp),hp=Uh(tp,o.draggable),ep({sortable:p,name:"change",toEl:s,newIndex:up,newDraggableIndex:hp,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){Th(document,"mousemove",this._onTouchMove),Th(document,"touchmove",this._onTouchMove),Th(document,"pointermove",this._onTouchMove),Th(document,"dragover",Gp),Th(document,"mousemove",Gp),Th(document,"touchmove",Gp)},_offUpEvents:function(){var e=this.el.ownerDocument;Th(e,"mouseup",this._onDrop),Th(e,"touchend",this._onDrop),Th(e,"pointerup",this._onDrop),Th(e,"touchcancel",this._onDrop),Th(document,"selectstart",this)},_onDrop:function(e){var t=this.el,r=this.options;up=Uh(tp),hp=Uh(tp,r.draggable),Kh("drop",this,{evt:e}),rp=tp&&tp.parentNode,up=Uh(tp),hp=Uh(tp,r.draggable),Hp.eventCanceled||(Tp=!1,Ap=!1,Pp=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Jp(this.cloneId),Jp(this._dragStartId),this.nativeDraggable&&(Th(document,"drop",this),Th(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),jh&&Ih(document.body,"user-select",""),Ih(tp,"transform",""),e&&(jp&&(e.cancelable&&e.preventDefault(),!r.dropBubble&&e.stopPropagation()),ip&&ip.parentNode&&ip.parentNode.removeChild(ip),(np===rp||fp&&"clone"!==fp.lastPutMode)&&op&&op.parentNode&&op.parentNode.removeChild(op),tp&&(this.nativeDraggable&&Th(tp,"dragend",this),$p(tp),tp.style["will-change"]="",jp&&!Tp&&Rh(tp,fp?fp.options.ghostClass:this.options.ghostClass,!1),Rh(tp,this.options.chosenClass,!1),ep({sortable:this,name:"unchoose",toEl:rp,newIndex:null,newDraggableIndex:null,originalEvent:e}),np!==rp?(up>=0&&(ep({rootEl:rp,name:"add",toEl:rp,fromEl:np,originalEvent:e}),ep({sortable:this,name:"remove",toEl:rp,originalEvent:e}),ep({rootEl:rp,name:"sort",toEl:rp,fromEl:np,originalEvent:e}),ep({sortable:this,name:"sort",toEl:rp,originalEvent:e})),fp&&fp.save()):up!==cp&&up>=0&&(ep({sortable:this,name:"update",toEl:rp,originalEvent:e}),ep({sortable:this,name:"sort",toEl:rp,originalEvent:e})),Hp.active&&(null!=up&&-1!==up||(up=cp,hp=dp),ep({sortable:this,name:"end",toEl:rp,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){Kh("nulling",this),np=tp=rp=ip=sp=op=ap=lp=bp=mp=jp=up=hp=cp=dp=_p=wp=fp=pp=Hp.dragged=Hp.ghost=Hp.clone=Hp.active=null,Ip.forEach((function(e){e.checked=!0})),Ip.length=gp=yp=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":tp&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],r=this.el.children,i=0,n=r.length,s=this.options;i<n;i++)Ph(e=r[i],s.draggable,this.el,!1)&&t.push(e.getAttribute(s.dataIdAttr)||Zp(e));return t},sort:function(e,t){var r={},i=this.el;this.toArray().forEach((function(e,t){var n=i.children[t];Ph(n,this.options.draggable,i,!1)&&(r[e]=n)}),this),t&&this.captureAnimationState(),e.forEach((function(e){r[e]&&(i.removeChild(r[e]),i.appendChild(r[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Ph(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var r=this.options;if(void 0===t)return r[e];var i=Yh.modifyOption(this,e,t);r[e]="undefined"!==typeof i?i:t,"group"===e&&Np(r)},destroy:function(){Kh("destroy",this);var e=this.el;e[Qh]=null,Th(e,"mousedown",this._onTapStart),Th(e,"touchstart",this._onTapStart),Th(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(Th(e,"dragover",this),Th(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),Mp.splice(Mp.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!lp){if(Kh("hideClone",this),Hp.eventCanceled)return;Ih(op,"display","none"),this.options.removeCloneOnHide&&op.parentNode&&op.parentNode.removeChild(op),lp=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(lp){if(Kh("showClone",this),Hp.eventCanceled)return;tp.parentNode!=np||this.options.group.revertClone?sp?np.insertBefore(op,sp):np.appendChild(op):np.insertBefore(op,tp),this.options.group.revertClone&&this.animate(tp,op),Ih(op,"display",""),lp=!1}}else this._hideClone()}},Dp&&Sh(document,"touchmove",(function(e){(Hp.active||Tp)&&e.cancelable&&e.preventDefault()})),Hp.utils={on:Sh,off:Th,css:Ih,find:Fh,is:function(e,t){return!!Ph(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},throttle:Hh,closest:Ph,toggleClass:Rh,clone:$h,index:Uh,nextTick:Xp,cancelNextTick:Jp,detectDirection:Vp,getChild:Vh},Hp.get=function(e){return e[Qh]},Hp.mount=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Hp.utils=bh({},Hp.utils,e.utils)),Yh.mount(e)}))},Hp.create=function(e,t){return new Hp(e,t)},Hp.version="1.13.0";var Yp,Kp,ef,tf,rf,nf,sf=[],af=!1;function of(){sf.forEach((function(e){clearInterval(e.pid)})),sf=[]}function lf(){clearInterval(nf)}var cf=Hh((function(e,t,r,i){if(t.scroll){var n,s=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,o=t.scrollSensitivity,l=t.scrollSpeed,c=Lh(),u=!1;Kp!==r&&(Kp=r,of(),Yp=t.scroll,n=t.scrollFn,!0===Yp&&(Yp=Gh(r,!0)));var d=0,h=Yp;do{var p=h,f=kh(p),b=f.top,m=f.bottom,g=f.left,y=f.right,v=f.width,O=f.height,j=void 0,_=void 0,w=p.scrollWidth,x=p.scrollHeight,S=Ih(p),T=p.scrollLeft,C=p.scrollTop;p===c?(j=v<w&&("auto"===S.overflowX||"scroll"===S.overflowX||"visible"===S.overflowX),_=O<x&&("auto"===S.overflowY||"scroll"===S.overflowY||"visible"===S.overflowY)):(j=v<w&&("auto"===S.overflowX||"scroll"===S.overflowX),_=O<x&&("auto"===S.overflowY||"scroll"===S.overflowY));var M=j&&(Math.abs(y-s)<=o&&T+v<w)-(Math.abs(g-s)<=o&&!!T),P=_&&(Math.abs(m-a)<=o&&C+O<x)-(Math.abs(b-a)<=o&&!!C);if(!sf[d])for(var A=0;A<=d;A++)sf[A]||(sf[A]={});sf[d].vx==M&&sf[d].vy==P&&sf[d].el===p||(sf[d].el=p,sf[d].vx=M,sf[d].vy=P,clearInterval(sf[d].pid),0==M&&0==P||(u=!0,sf[d].pid=setInterval(function(){i&&0===this.layer&&Hp.active._onTouchMove(rf);var t=sf[this.layer].vy?sf[this.layer].vy*l:0,r=sf[this.layer].vx?sf[this.layer].vx*l:0;"function"===typeof n&&"continue"!==n.call(Hp.dragged.parentNode[Qh],r,t,e,rf,sf[this.layer].el)||Wh(sf[this.layer].el,r,t)}.bind({layer:d}),24))),d++}while(t.bubbleScroll&&h!==c&&(h=Gh(h,!1)));af=u}}),30),uf=function(e){var t=e.originalEvent,r=e.putSortable,i=e.dragEl,n=e.activeSortable,s=e.dispatchSortableEvent,a=e.hideGhostForTarget,o=e.unhideGhostForTarget;if(t){var l=r||n;a();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,u=document.elementFromPoint(c.clientX,c.clientY);o(),l&&!l.el.contains(u)&&(s("spill"),this.onSpill({dragEl:i,putSortable:r}))}};function df(){}function hf(){}df.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,r=e.putSortable;this.sortable.captureAnimationState(),r&&r.captureAnimationState();var i=Vh(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(t,i):this.sortable.el.appendChild(t),this.sortable.animateAll(),r&&r.animateAll()},drop:uf},fh(df,{pluginName:"revertOnSpill"}),hf.prototype={onSpill:function(e){var t=e.dragEl,r=e.putSortable||this.sortable;r.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),r.animateAll()},drop:uf},fh(hf,{pluginName:"removeOnSpill"}),Hp.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"===typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?Sh(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Sh(document,"pointermove",this._handleFallbackAutoScroll):t.touches?Sh(document,"touchmove",this._handleFallbackAutoScroll):Sh(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?Th(document,"dragover",this._handleAutoScroll):(Th(document,"pointermove",this._handleFallbackAutoScroll),Th(document,"touchmove",this._handleFallbackAutoScroll),Th(document,"mousemove",this._handleFallbackAutoScroll)),lf(),of(),clearTimeout(Ah),Ah=void 0},nulling:function(){rf=Kp=Yp=af=nf=ef=tf=null,sf.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var r=this,i=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,s=document.elementFromPoint(i,n);if(rf=e,t||vh||yh||jh){cf(e,this.options,s,t);var a=Gh(s,!0);!af||nf&&i===ef&&n===tf||(nf&&lf(),nf=setInterval((function(){var s=Gh(document.elementFromPoint(i,n),!0);s!==a&&(a=s,of()),cf(e,r.options,s,t)}),10),ef=i,tf=n)}else{if(!this.options.bubbleScroll||Gh(s,!0)===Lh())return void of();cf(e,this.options,Gh(s,!1),!1)}}},fh(e,{pluginName:"scroll",initializeByDefault:!0})}),Hp.mount(hf,df);HTMLElement,HTMLElement;const pf=JSON.stringify({display:"flex",flexDirection:"column",flexWrap:"wrap",width:"100%",minWidth:"100%"}).replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/[,]/g,";").replace(/["{}]/g,"").toLowerCase(),ff=(HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,HTMLElement,"button--bottom-left"),bf="button--bottom-right",mf="button",gf="delimiter",yf="hour",vf="button--hour-down",Of="button--hour-up",jf="input",_f="meridiem",wf="button--meridiem-down",xf="button--meridiem-up",Sf="minute",Tf="button--minute-down",Cf="button--minute-up",Mf="second",Pf="button--second-down",Af="button--second-up",Ef="time-picker",Rf="button--top-left",If="button--top-right",Df="Hour",Ff="Decrease hour",Lf="Increase hour",kf="AM/PM",zf="Decrease AM/PM",Vf="Increase AM/PM",Nf="Minute",Uf="Decrease minute",Bf="Increase minute",Gf="Second",qf="Decrease second",Hf="Increase second",Wf=(HTMLElement,"header"),$f="heading",Qf="close",Zf="container",Xf="tip-container",Jf="tip-container--advancing",Yf="tip-container--retreating",Kf="pagination",eb="page-position",tb="page-next",rb="page-previous",ib="chevron-left",nb="chevron-right",sb="x",ab="Tips",ob="Tip",lb="Close",cb="Previous",ub="Next",db="container",hb="header",pb="heading",fb="close",bb="image-frame",mb="content",gb="info",yb="x",vb="thumbnail",Ob="Close",jb=(HTMLElement,HTMLElement,HTMLElement,"container"),_b="arrow",wb="data-calcite-tooltip-reference",xb="aria-describedby";HTMLElement,HTMLElement;var Sb;!function(e){e.Single="single",e.Multi="multi",e.Children="children",e.MultiChildren="multi-children",e.Ancestors="ancestors"}(Sb||(Sb={}));HTMLElement,HTMLElement;const Tb="handle";var Cb;!function(e){e.grip="grip"}(Cb||(Cb={}));HTMLElement;const Mb="drag",Pb="actions-end",Ab="actions-start";HTMLElement;function Eb(e){(e=>{Ie.$resourcesUrl$=e})(e)}var Rb=r(79),Ib=r(25);let Db;Db="components/assets";var Fb=r(401),Lb=r(69),kb=r(125),zb=r(232);const Vb="esri.widgets.Widget",Nb=c.a.getLogger(Vb);let Ub=0;const Bb="esri-icon-checkbox-unchecked";function Gb(e,t){for(const r in t)null!=e[r]&&("object"==typeof e[r]&&"object"==typeof t[r]?Gb(e[r],t[r]):e[r]=t[r]);return e}const qb=(e=>{let t;const r={...O,...e},i=(s=r,{...j,...s}),n=i.performanceLogger;var s;let a,o=!0,l=!1;const c=[],u=[],d=(e,s,a)=>{let o;i.eventHandlerInterceptor=(e,i,s,a)=>function(e){let i;n("domEvent",e);const s=((e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r})(e.currentTarget,o.domNode),a=s.some((e=>{var t;return customElements.get(null==e||null==(t=e.tagName)?void 0:t.toLowerCase())}));if(e.eventPhase!==Event.CAPTURING_PHASE&&a){const t=e.composedPath(),r=t.slice(t.indexOf(e.currentTarget),t.indexOf(o.domNode)).filter((e=>e.getRootNode()===e.ownerDocument)).reverse();i=_(o.getLastRender(),r,!0)}else s.reverse(),i=_(o.getLastRender(),s);let l;return i&&(l=r.handleInterceptedEvent(t,i,this,e)),n("domEventProcessed",e),l},null==r.postProcessProjectionOptions||r.postProcessProjectionOptions(i);const l=a();o=e(s,l,i),c.push(o),u.push(a),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(o,l)};let h=()=>{if(a=void 0,o){o=!1,n("renderStart",void 0);for(let e=0;e<c.length;e++){const t=u[e]();n("rendered",void 0),c[e].update(t),n("patched",void 0)}n("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(h=r.modifyDoRenderImplementation(h,c,u)),t={renderNow:h,scheduleRender:()=>{a||l||(a=requestAnimationFrame(h))},stop:()=>{a&&(cancelAnimationFrame(a),a=void 0),l=!0},resume:()=>{l=!1,o=!0,t.scheduleRender()},append:(e,t)=>{d(v.b.append,e,t)},insertBefore:(e,t)=>{d(v.b.insertBefore,e,t)},merge:(e,t)=>{d(v.b.merge,e,t)},replace:(e,t)=>{d(v.b.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t})({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(e,i,n,s)=>{const a=t(e,i,n,s),o=r.test(e);if(!((e=e.replace(r,"")).toLowerCase()in n)||o){const t=e[2].toLowerCase()+e.slice(3),r=e=>a.call(n,e);n.addEventListener(t,r,o);const i=()=>n.removeEventListener(t,r,o),l=s.afterRemoved;s.afterRemoved=e=>{null==l||l(e),i()}}return a}},handleInterceptedEvent(e,t,r,i){const{eventPhase:n,type:s}=i,a=n===Event.CAPTURING_PHASE;let o=`on${s}${a?"capture":""}`;const l=t.properties;(o in l||(o=`on${s[0].toUpperCase()}${s.slice(1)}${a?"Capture":""}`,o in l))&&(e.scheduleRender(),l[o].call(l.bind||r,i))}});let Hb=!1,Wb=class extends(Object(u.b)(a.a.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new o.a,this._projector=qb,this.domNode=null,this.iconClass=Bb,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=Object(d.j)((async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const e=await Object(d.k)(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{let r=await Object(zb.a)(e);this.localeStrings&&Object.keys(this.localeStrings)&&(r=Gb(Object(l.a)(r),this.localeStrings)),this[t]=r})));for(const t of e)t.error&&Nb.error("widget-intl:locale-error",this.declaredClass,t.error)}await this.loadLocale()})),Eb(Object(Ib.A)(Object(Rb.b)(Db)));const r=Object(Lb.e)()||"light";["light","dark"].includes(r)||Object(n.a)(Nb,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const i="esri-widget-uid-"+Object(h.a)(),s=this.render.bind(this);let a=!1;this._trackingTarget=new y.a((()=>this.scheduleRender()));const c=()=>{var e;if(!a||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const t=s();let{properties:r}=t;r||(t.properties=r={});let{key:n,styles:o}=r;n||(r.key=i),o||(r.styles=o={}),o.display||(o.display="");let l=0;return null==(e=t.children)||e.forEach((e=>{if(Object(Fb.b)(e.vnodeSelector))return;let{properties:t}=e;t||(e.properties=t={}),t.key||(t.key=`${this.id}--${l++}`)})),Object(Fb.c)(this,t)};this.render=()=>{if(Hb)return c();let e;this._trackingTarget.clear(),Hb=!0;try{e=Object(g.b)(this._trackingTarget,c)}finally{Hb=!1}return e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{a=!0,this._postInitialize()})))}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return this._loadLocale().catch(d.y)}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget.destroy(),this._trackingTarget=null,this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return Object(s.a)(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+Ub++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector,handles:this._internalHandles}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||this._projector.scheduleRender()}classes(...e){return Lb.a.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){this._projector.renderNow()}_postInitialize(){var e;if(this.destroyed)return;this.scheduleRender(),null!=(e=this._delegatedEventNames)&&e.length&&this._internalHandles.add(Object(p.a)(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize();const t=async()=>{await this._loadLocale().catch(d.y),this.scheduleRender()};this._internalHandles.add([Object(kb.c)(t),this.watch("localeStrings",t),Object(p.j)(this,"container",(async e=>{this.destroyed||this._attach(e)}))])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};Wb[Fb.a]=!0,Object(i.a)([Object(f.b)({value:null})],Wb.prototype,"container",null),Object(i.a)([Object(b.a)("container")],Wb.prototype,"castContainer",null),Object(i.a)([Object(f.b)({aliasOf:"container"})],Wb.prototype,"domNode",void 0),Object(i.a)([Object(f.b)()],Wb.prototype,"iconClass",void 0),Object(i.a)([Object(f.b)()],Wb.prototype,"id",null),Object(i.a)([Object(f.b)()],Wb.prototype,"label",void 0),Object(i.a)([Object(f.b)()],Wb.prototype,"localeStrings",void 0),Object(i.a)([Object(f.b)()],Wb.prototype,"renderable",null),Object(i.a)([Object(f.b)()],Wb.prototype,"viewModel",void 0),Object(i.a)([Object(f.b)()],Wb.prototype,"visible",void 0),Object(i.a)([Object(f.b)()],Wb.prototype,"key",void 0),Object(i.a)([Object(f.b)()],Wb.prototype,"afterCreate",void 0),Object(i.a)([Object(f.b)()],Wb.prototype,"afterUpdate",void 0),Object(i.a)([Object(f.b)()],Wb.prototype,"afterRemoved",void 0),Wb=Object(i.a)([Object(m.a)(Vb)],Wb);var $b=Wb;t.a=$b},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));r(8);function i(e){}function n(e){return()=>e}},function(e,t,r){"use strict";var i=r(0),n=r(35),s=r(44),a=r(14),o=r(1),l=(r(8),r(9),r(7),r(32)),c=r(4);const u=new s.a({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let d=0,h=class extends a.a{constructor(e){super(e),this.id="sym"+d++,this.type=null}set color(e){this._set("color",e)}readColor(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};Object(i.a)([Object(o.b)({type:u.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:u.write}}})],h.prototype,"type",void 0),Object(i.a)([Object(o.b)({type:n.a,value:new n.a([0,0,0,1]),json:{write:{allowNull:!0}}})],h.prototype,"color",null),Object(i.a)([Object(l.a)("color")],h.prototype,"readColor",null),h=Object(i.a)([Object(c.a)("esri.symbols.Symbol")],h);var p=h;t.a=p},function(e,t,r){"use strict";var i,n=r(0),s=r(157),a=r(113),o=r(14),l=r(2),c=r(1),u=(r(8),r(45)),d=(r(7),r(4)),h=r(85);let p=i=class extends o.a{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new i({rotation:this.rotation,scale:this.scale,targetGeometry:Object(l.j)(this.targetGeometry)?this.targetGeometry.clone():null,camera:Object(l.j)(this.camera)?this.camera.clone():null})}};function f(){return{enabled:!this.camera}}Object(n.a)([Object(c.b)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:f}}}}})],p.prototype,"rotation",void 0),Object(n.a)([Object(u.a)("rotation")],p.prototype,"castRotation",null),Object(n.a)([Object(c.b)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:f}}}}})],p.prototype,"scale",void 0),Object(n.a)([Object(c.b)({types:a.a,json:{read:h.a,write:!0,origins:{"web-scene":{read:h.a,write:{overridePolicy:f}}}}})],p.prototype,"targetGeometry",void 0),Object(n.a)([Object(c.b)({type:s.a,json:{write:!0}})],p.prototype,"camera",void 0),p=i=Object(n.a)([Object(d.a)("esri.Viewpoint")],p);var b=p;t.a=b},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return c}));var i=r(2),n=r(16),s=r(20),a=r(357),o=r(33);function l(e,t){return Object(i.i)(e)&&(e=[]),e.push(t),e}function c(e,t){if(Object(i.i)(e))return e;const r=e.filter((e=>e!==t));return 0===r.length?null:r}function u(e){return!!Object(i.j)(e)&&!e.visible}function d(e,t){const r=new Map;return r.set(0,t.acquire(e,0)),r.set(1,t.acquire(e,7)),r.set(4,t.acquire(e,3)),r.set(3,t.acquire(e,2)),r.set(2,t.acquire(e,1)),r.set(5,t.acquire(e,4)),r.set(7,t.acquire(e,3)),r.set(6,t.acquire(e,3)),r}function h(e,t){t.release(e,0),t.release(e,7),t.release(e,3),t.release(e,2),t.release(e,1),t.release(e,4)}function p(e,t,r){const s=e.origin.vec3;Object(o.m)(g,-s[0],-s[1],-s[2]),Object(i.j)(e.transformation)?Object(n.m)(t,g,e.transformation):Object(n.d)(t,g),r&&(Object(n.a)(r,t),Object(n.e)(r,r))}function f(e,t,r,i,n){b[0]=e.get(t,0),b[1]=e.get(t,1),b[2]=e.get(t,2),Object(a.a)(b,m,3),r.set(n,0,m[0]),i.set(n,0,m[1]),r.set(n,1,m[2]),i.set(n,1,m[3]),r.set(n,2,m[4]),i.set(n,2,m[5])}const b=new Float64Array(3),m=new Float32Array(6),g=Object(s.d)()},function(e,t,r){"use strict";var i,n=r(0),s=r(113),a=r(305),o=r(86),l=r(14),c=r(13),u=r(2),d=r(171),h=r(1),p=(r(9),r(8),r(7),r(4)),f=r(85);let b=i=class extends l.a{constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Object(d.b)(),configurable:!0})}normalizeCtorArgs(e,t,r,i){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:r,popupTemplate:i}}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&Object(u.j)(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{geometry:Object(u.j)(this.geometry)?this.geometry.toJSON():null,symbol:Object(u.j)(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}clone(){return new i(this.cloneProperties())}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}cloneProperties(){return{attributes:Object(c.a)(this.attributes),geometry:Object(c.a)(this.geometry),layer:this.layer,popupTemplate:this.popupTemplate&&this.popupTemplate.clone(),sourceLayer:this.sourceLayer,symbol:Object(c.a)(this.symbol),visible:this.visible}}_notifyLayer(e,t,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:t,newValue:r};"attributes"===e&&(n.attributeName=i),this.layer.graphicChanged(n)}};Object(n.a)([Object(h.b)({value:null})],b.prototype,"attributes",null),Object(n.a)([Object(h.b)({value:null,types:s.a,json:{read:f.a}})],b.prototype,"geometry",null),Object(n.a)([Object(h.b)({type:Boolean})],b.prototype,"isAggregate",void 0),Object(n.a)([Object(h.b)()],b.prototype,"layer",void 0),Object(n.a)([Object(h.b)({type:a.a})],b.prototype,"popupTemplate",void 0),Object(n.a)([Object(h.b)()],b.prototype,"sourceLayer",void 0),Object(n.a)([Object(h.b)({value:null,types:o.e})],b.prototype,"symbol",null),Object(n.a)([Object(h.b)({type:Boolean,value:!0})],b.prototype,"visible",null),b=i=Object(n.a)([Object(p.a)("esri.Graphic")],b),(b||(b={})).generateUID=d.b;var m=b;t.a=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return p}));var i,n,s,a=r(56);let o,l;const c=null!=(i=null==(n=a.a.esriConfig)?void 0:n.locale)?i:null==(s=a.a.dojoConfig)?void 0:s.locale;function u(){var e,t;return null!=(e=null!=c?c:null==(t=a.a.navigator)?void 0:t.language)?e:"en"}function d(){return void 0===l&&(l=u()),l}const h=[];function p(e){return h.push(e),{remove(){h.splice(h.indexOf(e),1)}}}const f=[];function b(e){return f.push(e),{remove(){h.splice(f.indexOf(e),1)}}}function m(){var e;const t=null!=(e=o)?e:u();l!==t&&(l=t,[...f].forEach((e=>{e.call(null,t)})),[...h].forEach((e=>{e.call(null,t)})))}null==a.a.addEventListener||a.a.addEventListener("languagechange",m)},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return p})),r.d(t,"g",(function(){return c})),r.d(t,"h",(function(){return d})),r.d(t,"i",(function(){return o})),r.d(t,"j",(function(){return f}));var i=r(2),n=r(59);class s{constructor(){this._queue=new n.a,this._last=null,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=null}reset(e=null){this._queue.clear(),Object(i.j)(e)&&this._queue.pushArray(e),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class a{constructor(){this.q=new n.a}get done(){return 0===this.q.length}reset(e){if(this.q.clear(),e){this.q.pushArray(e);for(let e=0;e<this.q.length;++e){const t=this.q.data[e];t.isLeaf||this.q.pushArray(t.children)}}}next(){return this.q.pop()}}function o(e){return Object(i.j)(e)?e.lij.toString():"null"}function l(e,t,r){if(Object(i.i)(t))return!1;const n=t.fullExtent,s=e.extent;if(r){if(s[0]<n.xmin||s[1]<n.ymin||s[2]>n.xmax||s[3]>n.ymax)return!1}else if(n.xmin>s[2]||n.ymin>s[3]||n.xmax<s[0]||n.ymax<s[1])return!1;const a=e.surface.tilingScheme.levels[e.lij[0]].scale;return!(t.minScale>0&&a>1.00000001*t.minScale)&&!(t.maxScale>0&&a<.99999999*t.maxScale)}function c(e,t){t.sort(((t,r)=>u(t,r,e)))}function u(e,t,r){const i=e.screenDepth,n=t.screenDepth;return i<n?-r:i>n?r:0}function d(e,t){const r=new Map;e.forAll((e=>r.set(e,e.distanceToSquared(t)))),e.sort(((e,t)=>r.get(e)-r.get(t)))}function h(e,t,r){let i=1,n=0,s=0;for(;e!==t;)if(i*=.5,n*=.5,s*=.5,1&e.lij[2]&&(n+=.5),0==(1&e.lij[1])&&(s+=.5),null==(e=e.parent))throw new Error("tile was not a descendant of upsampleTile");r.init(t,n,s,i)}function p(e){for(let t=0;t<e.length;t++){const r=e[t],i=r.parent;if(i)for(let e=0;e<4;e++){const t=i.children[e];if(t&&t!==r&&t.loadable)return!0}}return!1}function f(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],i=r?e:t,n=r?t:e,s=1<<n[0]-i[0];return Math.floor(n[1]/s)===i[1]&&Math.floor(n[2]/s)===i[2]}},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return g}));var i=r(35),n=(r(8),r(7)),s=r(10),a=r(2),o=r(5),l=r(31),c=r(51),u=r(140),d=r(223),h=r(91),p=r(395),f=r(273);const b=n.a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class m extends p.a{constructor(e,t,r,i){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this.complexity=null,this.logger=b,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=e,this.symbolLayer=t,this._renderPriority=i.renderPriority,this._renderPriorityStep=i.renderPriorityStep,this._elevationContext=new u.a,this.complexity=this.computeComplexity(),this._updateDrivenProperties(i.ignoreDrivers),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,i){const n=e.projectionSuccess,s="polygons"in e?e.polygons:null,a=`${i} geometry failed to be created`;let o=null;n?!t.length||1===t.length&&!t[0].length?o=`${a} (no ${r} were defined)`:Array.isArray(t)&&Array.isArray(t[0])?s&&0===s.length&&"rings"===r&&t.length>0&&t[0].length>2&&(o=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):o=`${a} (${r} should be defined as a 2D array)`:o=`${a} (failed to project geometry to view spatial reference)`,o&&b.warnOncePerTick(o)}_validateGeometry(e,t=null,r=null){if(Object(a.j)(t)&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;if("point"===e.type){const t=e;if(!Object(s.j)(t.x)||!Object(s.j)(t.y))return b.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return y}_defaultElevationInfoZ(){return v}_updateElevationContext(){Object(a.j)(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t){const r=Object(a.s)(e.geometry),i=this.getDefaultElevationInfo(r);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(r,i),t.offsetMeters=Object(a.t)(this._elevationContext.meterUnitOffset,Object(a.t)(i.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);const s=n?d.h:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(s,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}onRemoveGraphic(e){}_updateDrivenProperties(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};if(e)return void(this._drivenProperties=t);const r=this._context.renderer;r&&"visualVariables"in r&&r.visualVariables&&r.visualVariables.forEach((e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let r=0;r<e.stops.length;r++){const i=e.stops[r].color;i&&(t.opacity=!0,i.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}})),this._drivenProperties=t}_getLayerOpacity(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;const e=this._context.layer.opacity;return null==e?1:e}_getCombinedOpacity(e,t=O){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(Object(a.j)(e)?r*=e.a:t.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,t=O){const r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return Object(h.g)(null,r);const n=Object(a.j)(e)?i.a.toUnitRGB(e):o.a;return Object(h.g)(n,r)}_getVertexOpacityAndColor(e,t=null){const r=this._drivenProperties.color?e.color:null,i=this._drivenProperties.opacity?e.opacity:null,n=Object(h.g)(r,i);return Object(a.j)(t)&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return Object(f.c)(this.symbol,this.symbolLayer)}destroy(){this.abortLoad()}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r);case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,e)!==c.a.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,t,r){let i=c.a.UPDATE;return e.forEach((e=>{const n=t(e);if(Object(a.j)(n)){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=r(n.elevationContext.mode)}else i=c.a.RECREATE})),i}applyRendererDiff(e,t){return!1}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const t=this._fastUpdates.visualVariables,r=t.size?g(t.size.field,e):0,i=t.color?g(t.color.field,e):0,n=t.opacity?g(t.opacity.field,e):0;return Object(l.g)(r,i,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&b.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}}function g(e,t){const r=null!=e?t.attributes[e]:0;return null!=r&&isFinite(r)?r:0}const y={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"},O={hasIntrinsicColor:!1}},function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return C}));var i=r(2),n=r(299),s=r(258),a=r(59),o=r(12),l=r(60);class c{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}}class u{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}}let d=0,h=0;const p={time:Object(l.a)(0),deltaTime:Object(l.a)(0),elapsedFrameTime:Object(l.a)(0),frameDuration:Object(l.a)(0)},f=["prepare","preRender","render","postRender","update"],b=[],m=new a.a;class g{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const y={frameTasks:m,willDispatch:!1,clearFrameTasks:function(e=!1){m.forAll((e=>{e.removed=!0})),e&&S()},dispatch:T,executeFrameTasks:function(e){const t=Object(l.a)(e-d);d=e;const r=h>0?h:1e3/60,i=Math.max(0,t-r);for(let n=0;n<f.length;n++){const s=performance.now(),a=f[n];m.forAll((s=>{var o;s.paused||s.removed||(0===n&&s.ticks++,s.phases[a]&&(p.time=e,p.deltaTime=0===s.ticks?Object(l.a)(0):t,p.elapsedFrameTime=Object(l.a)(performance.now()-e),p.frameDuration=Object(l.a)(r-i),null==(o=s.phases[a])||o.call(s,p)))})),M[n].record(performance.now()-s)}S(),P.record(performance.now()-e)}};function v(e){const t=new u(e);return b.push(t),y.willDispatch||(y.willDispatch=!0,Object(n.a)(T)),t}function O(e){const t=new c(e);return m.push(t),null==j&&(d=performance.now(),j=requestAnimationFrame(w)),new g(t)}let j=null;function _(e){h=Math.max(0,e)}function w(){const e=performance.now();j=null,j=m.length>0?requestAnimationFrame(w):null,y.executeFrameTasks(e)}const x=new a.a;function S(){m.forAll((e=>{e.removed&&x.push(e)})),m.removeUnorderedMany(x.data,x.length),x.clear()}function T(){for(;b.length;){const e=Object(i.d)(b.shift());e.isActive&&e.callback()}y.willDispatch=!1}function C(e=1,t){const r=Object(o.h)(),i=()=>{Object(o.o)(t)?r.reject(Object(o.f)()):0===e?r():(--e,Object(n.a)((()=>i())))};return i(),r.promise}const M=f.map((e=>new s.a(e))),P=new s.a("total")},function(e,t,r){"use strict";function i(e,t=0){const r=e.stride;return e.fieldNames.filter((t=>{const r=e.fields.get(t).optional;return!(r&&r.glPadding)})).map((i=>{const s=e.fields.get(i),a=s.constructor.ElementCount,o=n(s.constructor.ElementType),l=s.offset,c=!(!s.optional||!s.optional.glNormalized);return{name:i,stride:r,count:a,type:o,offset:l,normalized:c,divisor:t}}))}function n(e){const t=s[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}r.d(t,"a",(function(){return i}));const s={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},function(e,t,r){"use strict";function i(e){return function(t,r){t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}r.d(t,"a",(function(){return i}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));r(8);var i=r(2),n=r(20),s=r(3),a=r(5),o=r(64);class l{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}var c=r(233),u=r(172),d=r(123);const h=1e-5;class p{constructor(e){this.options=new l,this.results=new c.b,this.transform=new u.a,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=h,this.verticalOffset=null,this._ray={origin:Object(a.e)(),direction:Object(a.e)()},this._rayEndPoint=Object(a.e)(),this._rayStartPointTransformed=Object(a.e)(),this._rayEndPointTransformed=Object(a.e)(),this.viewingMode=null==e?1:e}get ray(){return this._ray}get rayBeginPoint(){return this._ray.origin}get rayEndPoint(){return this._rayEndPoint}reset(e,t){this.resetWithRay(Object(o.e)(e,t,this._ray))}resetWithRay(e){e!==this._ray&&Object(o.b)(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(s.h)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}intersect(e=null,t,r,n,s,a){this.point=t,this.camera=r,this.filterPredicate=s,this.tolerance=null==n?h:n;const o=Object(u.d)(this.verticalOffset);if(Object(i.j)(e)&&e.length>0){const t=a?e=>{a(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator&&r.getSpatialQueryAccelerator();Object(i.j)(e)?(Object(i.j)(o)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){this._numObjectsTested++;const t=e.geometryRecords;if(!t)return;const r=e.id,a=e.transformation;let o;const l=Object(u.d)(this.verticalOffset);for(const u of t){const{geometry:t,material:h,instanceParameters:p}=u;if(Object(d.e)(p))continue;o=t.id,this.transform.setAndInvalidateLazyTransforms(a,u.getShaderTransformation()),Object(s.s)(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse),Object(s.s)(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const f=this.transform.transform;Object(i.j)(l)&&(l.objectTransform=this.transform),h.intersect(t,p,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,((t,s,a,l,u,d)=>{if(t>=0){if(Object(i.j)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEndPoint,t))return;const h=`Object3D ${r}`;if(u)return void((null==this.results.hud.dist||t<this.results.hud.dist)&&this.results.hud.set(e,h,t,s,n.a,l,d,o,a));const p=r=>r.set(e,h,t,s,f,l,null,o,a);if((null==this.results.min.drapedLayerOrder||l>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||t<this.results.min.dist)&&p(this.results.min),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||l<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||t>this.results.max.dist)&&p(this.results.max),2===this.options.store){const e=new c.a(this._ray);p(e),this.results.all.push(e)}}}),u.shaderTransformation)}}sortResults(){this.results.all.sort(((e,t)=>e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)))}}p.DEFAULT_TOLERANCE=h},function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r(83),n=r(20),s=r(5),a=r(311),o=r(216),l=r(6);function c(e,t){e.include(a.a),e.vertex.include(o.a,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(l.a`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
uTransform_WorldFromModel_TL,
uTransform_WorldFromModel_TH,
-uTransform_WorldFromView_TL,
-uTransform_WorldFromView_TH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 position_view() {
return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();
}
void forwardPosition() {
vPositionWorldCameraRelative = positionWorldCameraRelative();
vPosition_view = position_view();
gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);
}
vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(l.a`vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`)}!function(e){e.ModelTransform=class{constructor(){this.worldFromModel_RS=Object(i.b)(),this.worldFromModel_TH=Object(s.e)(),this.worldFromModel_TL=Object(s.e)()}};e.ViewProjectionTransform=class{constructor(){this.worldFromView_TH=Object(s.e)(),this.worldFromView_TL=Object(s.e)(),this.viewFromCameraRelative_RS=Object(i.b)(),this.projFromView=Object(n.d)()}},e.bindModelTransform=function(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)},e.bindViewProjTransform=function(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)}}(c||(c={}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s}));var i=r(25);function n(e,t){return t?{...t,query:{...e,...t.query}}:{query:e}}function s(e){return"string"==typeof e?Object(i.K)(e):e}function a(e,t,r){const i={};for(const n in e){if("declaredClass"===n)continue;const s=e[n];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){i[n]=[];for(let e=0;e<s.length;e++)i[n][e]=a(s[e])}else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(r&&r[n]);i[n]=t?e:JSON.stringify(e)}else i[n]=t?s:JSON.stringify(s);else i[n]=s}return i}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return c}));var i=r(99);const n=/\{([^\}]+)\}/g;function s(e){return null==e?"":e}function a(e,t){return e.replace(n,"object"==typeof t?(e,r)=>s(Object(i.b)(r,t)):(e,r)=>s(t(r)))}function o(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,(e=>t&&-1!==t.indexOf(e)?e:`\\${e}`))}function l(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}function c(e){return(new DOMParser).parseFromString(e||"","text/html").body.innerText||""}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return o}));var i=r(183),n=r(6);function s(e){e.fragment.include(i.a),e.fragment.uniforms.add("uShadowMapTex","sampler2D"),e.fragment.uniforms.add("uShadowMapNum","int"),e.fragment.uniforms.add("uShadowMapDistance","vec4"),e.fragment.uniforms.add("uShadowMapMatrix","mat4",4),e.fragment.uniforms.add("uDepthHalfPixelSz","float"),e.fragment.code.add(n.a`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = uShadowMapDistance;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= uShadowMapNum) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);
}`)}function a(e,t){t.shadowMappingEnabled&&(t.shadowMap.bind(e),t.shadowMap.bindView(e,t.origin))}function o(e,t,r){t.shadowMappingEnabled&&t.shadowMap.bindView(e,r)}function l(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return u}));var i=r(3),n=r(5),s=r(432);let a=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const o=new Uint16Array([0]),l=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function c(e){if(1===e)return o;if(e<l.length)return new Uint16Array(l.buffer,0,e);if(e>a.length){const t=Math.max(2*a.length,e);a=new Uint32Array(t);for(let e=0;e<a.length;e++)a[e]=e}return new Uint32Array(a.buffer,0,e)}function u(e){if(1===e)return new Uint16Array(o);if(e<l.length)return new Uint16Array(l.slice(0,e));if(e>a.length){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}return new Uint32Array(a.slice(0,e))}function d(e,t,r){if(!e)return!1;const{size:n,data:a}=e;Object(i.y)(r,0,0,0),Object(i.y)(g,0,0,0);let o=0,l=0;for(let c=0;c<t.length-2;c+=3){const e=t[c+0]*n,u=t[c+1]*n,d=t[c+2]*n;Object(i.y)(f,a[e+0],a[e+1],a[e+2]),Object(i.y)(b,a[u+0],a[u+1],a[u+2]),Object(i.y)(m,a[d+0],a[d+1],a[d+2]);const h=Object(s.b)(f,b,m);h?(Object(i.h)(f,f,b),Object(i.h)(f,f,m),Object(i.g)(f,f,1/3*h),Object(i.h)(r,r,f),o+=h):(Object(i.h)(g,g,f),Object(i.h)(g,g,b),Object(i.h)(g,g,m),l+=3)}return(0!==l||0!==o)&&(0!==o?(Object(i.g)(r,r,1/o),!0):0!==l&&(Object(i.g)(r,g,1/l),!0))}function h(e,t,r){if(!e||!t)return!1;const{size:n,data:s}=e;Object(i.y)(r,0,0,0);let a=-1,o=0;for(let i=0;i<t.length;i++){const e=t[i]*n;a!==e&&(r[0]+=s[e+0],r[1]+=s[e+1],r[2]+=s[e+2],o++),a=e}return o>1&&Object(i.g)(r,r,1/o),o>0}function p(e,t,r,n){if(!e)return!1;const{size:s,data:a}=e;Object(i.y)(n,0,0,0),Object(i.y)(g,0,0,0);let o=0,l=0;const c=t?t.length-1:a.length/s-1,u=c+(r?2:0);for(let d=0;d<u;d+=2){const e=d<c?d:c,r=d<c?d+1:0,u=(t?t[e]:e)*s,h=(t?t[r]:r)*s;f[0]=a[u+0],f[1]=a[u+1],f[2]=a[u+2],b[0]=a[h+0],b[1]=a[h+1],b[2]=a[h+2],Object(i.g)(f,Object(i.h)(f,f,b),.5);const p=Object(i.p)(f,b);p>0?(Object(i.h)(n,n,Object(i.g)(f,f,p)),o+=p):(Object(i.h)(g,g,f),l++)}return 0!==o?(Object(i.g)(n,n,1/o),!0):0!==l&&(Object(i.g)(n,g,1/l),!0)}const f=Object(n.e)(),b=Object(n.e)(),m=Object(n.e)(),g=Object(n.e)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return c}));var i=r(16),n=r(21),s=r(33);function a(e,t,r,i){const n=r.typedBuffer,s=r.typedBufferStride,a=e.length;i*=s;for(let o=0;o<a;++o){const r=2*e[o];n[i]=t[r],n[i+1]=t[r+1],i+=s}}function o(e,t,r,i,n){const s=r.typedBuffer,a=r.typedBufferStride,o=e.length;if(i*=a,null==n||1===n)for(let l=0;l<o;++l){const r=3*e[l];s[i]=t[r],s[i+1]=t[r+1],s[i+2]=t[r+2],i+=a}else for(let l=0;l<o;++l){const r=3*e[l];for(let e=0;e<n;++e)s[i]=t[r],s[i+1]=t[r+1],s[i+2]=t[r+2],i+=a}}function l(e,t,r,i,n=1){const s=r.typedBuffer,a=r.typedBufferStride,o=e.length;if(i*=a,1===n)for(let l=0;l<o;++l){const r=4*e[l];s[i]=t[r],s[i+1]=t[r+1],s[i+2]=t[r+2],s[i+3]=t[r+3],i+=a}else for(let l=0;l<o;++l){const r=4*e[l];for(let e=0;e<n;++e)s[i]=t[r],s[i+1]=t[r+1],s[i+2]=t[r+2],s[i+3]=t[r+3],i+=a}}function c(e,t,r,i,n,s=1){if(!r)return void o(e,t,i,n,s);const a=i.typedBuffer,l=i.typedBufferStride,c=e.length,u=r[0],d=r[1],h=r[2],p=r[4],f=r[5],b=r[6],m=r[8],g=r[9],y=r[10],v=r[12],O=r[13],j=r[14];if(n*=l,1===s)for(let o=0;o<c;++o){const r=3*e[o],i=t[r],s=t[r+1],c=t[r+2];a[n]=u*i+p*s+m*c+v,a[n+1]=d*i+f*s+g*c+O,a[n+2]=h*i+b*s+y*c+j,n+=l}else for(let o=0;o<c;++o){const r=3*e[o],i=t[r],c=t[r+1],_=t[r+2],w=u*i+p*c+m*_+v,x=d*i+f*c+g*_+O,S=h*i+b*c+y*_+j;for(let e=0;e<s;++e)a[n]=w,a[n+1]=x,a[n+2]=S,n+=l}}function u(e,t,r,n,s,a=1){if(!r)return void o(e,t,n,s,a);const l=r,c=n.typedBuffer,u=n.typedBufferStride,d=e.length,h=l[0],p=l[1],f=l[2],b=l[4],m=l[5],g=l[6],y=l[8],v=l[9],O=l[10],j=!Object(i.p)(l),_=1e-6,w=1-_;if(s*=u,1===a)for(let i=0;i<d;++i){const r=3*e[i],n=t[r],a=t[r+1],o=t[r+2];let l=h*n+b*a+y*o,d=p*n+m*a+v*o,x=f*n+g*a+O*o;if(j){const e=l*l+d*d+x*x;if(e<w&&e>_){const t=1/Math.sqrt(e);l*=t,d*=t,x*=t}}c[s+0]=l,c[s+1]=d,c[s+2]=x,s+=u}else for(let i=0;i<d;++i){const r=3*e[i],n=t[r],o=t[r+1],l=t[r+2];let d=h*n+b*o+y*l,x=p*n+m*o+v*l,S=f*n+g*o+O*l;if(j){const e=d*d+x*x+S*S;if(e<w&&e>_){const t=1/Math.sqrt(e);d*=t,x*=t,S*=t}}for(let e=0;e<a;++e)c[s+0]=d,c[s+1]=x,c[s+2]=S,s+=u}}function d(e,t,r,n,s,a=1){if(!r)return void l(e,t,n,s,a);const o=r,c=n.typedBuffer,u=n.typedBufferStride,d=e.length,h=o[0],p=o[1],f=o[2],b=o[4],m=o[5],g=o[6],y=o[8],v=o[9],O=o[10],j=!Object(i.p)(o),_=1e-6,w=1-_;if(s*=u,1===a)for(let i=0;i<d;++i){const r=4*e[i],n=t[r],a=t[r+1],o=t[r+2],l=t[r+3];let d=h*n+b*a+y*o,x=p*n+m*a+v*o,S=f*n+g*a+O*o;if(j){const e=d*d+x*x+S*S;if(e<w&&e>_){const t=1/Math.sqrt(e);d*=t,x*=t,S*=t}}c[s+0]=d,c[s+1]=x,c[s+2]=S,c[s+3]=l,s+=u}else for(let i=0;i<d;++i){const r=4*e[i],n=t[r],o=t[r+1],l=t[r+2],d=t[r+3];let x=h*n+b*o+y*l,S=p*n+m*o+v*l,T=f*n+g*o+O*l;if(j){const e=x*x+S*S+T*T;if(e<w&&e>_){const t=1/Math.sqrt(e);x*=t,S*=t,T*=t}}for(let e=0;e<a;++e)c[s+0]=x,c[s+1]=S,c[s+2]=T,c[s+3]=d,s+=u}}function h(e,t,r,i,n,s=1){const a=i.typedBuffer,o=i.typedBufferStride,l=e.length;if(n*=o,1===s){if(4===r)for(let c=0;c<l;++c){const r=4*e[c];a[n]=t[r],a[n+1]=t[r+1],a[n+2]=t[r+2],a[n+3]=t[r+3],n+=o}else if(3===r)for(let c=0;c<l;++c){const r=3*e[c];a[n]=t[r],a[n+1]=t[r+1],a[n+2]=t[r+2],a[n+3]=255,n+=o}}else if(4===r)for(let c=0;c<l;++c){const r=4*e[c];for(let e=0;e<s;++e)a[n]=t[r],a[n+1]=t[r+1],a[n+2]=t[r+2],a[n+3]=t[r+3],n+=o}else if(3===r)for(let c=0;c<l;++c){const r=3*e[c];for(let e=0;e<s;++e)a[n]=t[r],a[n+1]=t[r+1],a[n+2]=t[r+2],a[n+3]=255,n+=o}}function p(e,t,r,i,o,l){for(const p of t.fieldNames){const t=e.vertexAttributes.get(p),f=e.indices.get(p);if(t&&f)switch(p){case"position":{Object(s.a)(3===t.size);const e=o.getField(p,n.u);e&&c(f,t.data,r,e,l);break}case"normal":{Object(s.a)(3===t.size);const e=o.getField(p,n.u);e&&u(f,t.data,i,e,l);break}case"uv0":{Object(s.a)(2===t.size);const e=o.getField(p,n.m);e&&a(f,t.data,e,l);break}case"color":{Object(s.a)(3===t.size||4===t.size);const e=o.getField(p,n.J);e&&h(f,t.data,t.size,e,l);break}case"symbolColor":{Object(s.a)(3===t.size||4===t.size);const e=o.getField(p,n.J);e&&h(f,t.data,t.size,e,l);break}case"tangent":{Object(s.a)(4===t.size);const e=o.getField(p,n.C);e&&d(f,t.data,i,e,l);break}}}}},function(e,t,r){"use strict";var i,n=r(0),s=r(113),a=r(221),o=r(44),l=r(14),c=r(13),u=r(2),d=r(1),h=r(45),p=(r(8),r(7),r(37)),f=r(4),b=r(29),m=r(9),g=r(85),y=r(294),v=r(576),O=r(451),j=r(39),_=r(41);const w=new o.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),x=new o.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let S=i=class extends l.a{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.datumTransformation=null,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.units=null,this.where=null}static from(e){return Object(m.d)(i,e)}castDatumTransformation(e){return"number"==typeof e||"object"==typeof e?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const r={};for(const t in e){const i=e[t];Array.isArray(i)?r[t]=i.map((e=>e instanceof Date?e.getTime():e)):i instanceof Date?r[t]=i.getTime():r[t]=i}t.parameterValues=r}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new i(Object(c.a)({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:Object(u.j)(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))}};S.MAX_MAX_RECORD_COUNT_FACTOR=5,Object(n.a)([Object(d.b)({json:{write:!0}})],S.prototype,"aggregateIds",void 0),Object(n.a)([Object(d.b)({type:Boolean,json:{write:!0}})],S.prototype,"cacheHint",void 0),Object(n.a)([Object(d.b)({json:{write:!0}})],S.prototype,"datumTransformation",void 0),Object(n.a)([Object(h.a)("datumTransformation")],S.prototype,"castDatumTransformation",null),Object(n.a)([Object(d.b)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],S.prototype,"distance",void 0),Object(n.a)([Object(d.b)({type:y.a,json:{write:!0}})],S.prototype,"dynamicDataSource",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],S.prototype,"formatOf3DObjects",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],S.prototype,"gdbVersion",void 0),Object(n.a)([Object(d.b)({types:s.a,json:{read:g.a,write:!0}})],S.prototype,"geometry",void 0),Object(n.a)([Object(d.b)({type:Number,json:{write:!0}})],S.prototype,"geometryPrecision",void 0),Object(n.a)([Object(d.b)({type:[String],json:{write:!0}})],S.prototype,"groupByFieldsForStatistics",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],S.prototype,"having",void 0),Object(n.a)([Object(d.b)({type:Date})],S.prototype,"historicMoment",void 0),Object(n.a)([Object(b.a)("historicMoment")],S.prototype,"writeHistoricMoment",null),Object(n.a)([Object(d.b)({type:Number,json:{write:!0}})],S.prototype,"maxAllowableOffset",void 0),Object(n.a)([Object(d.b)({type:Number,cast:e=>e<1?1:e>i.MAX_MAX_RECORD_COUNT_FACTOR?i.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],S.prototype,"maxRecordCountFactor",void 0),Object(n.a)([Object(d.b)({type:["xyFootprint"],json:{write:!0}})],S.prototype,"multipatchOption",void 0),Object(n.a)([Object(d.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],S.prototype,"num",void 0),Object(n.a)([Object(d.b)({json:{write:!0}})],S.prototype,"objectIds",void 0),Object(n.a)([Object(d.b)({type:[String],json:{write:!0}})],S.prototype,"orderByFields",void 0),Object(n.a)([Object(d.b)({type:[String],json:{write:!0}})],S.prototype,"outFields",void 0),Object(n.a)([Object(d.b)({type:j.a,json:{name:"outSR",write:!0}})],S.prototype,"outSpatialReference",void 0),Object(n.a)([Object(d.b)({type:[O.a],json:{write:{enabled:!0,overridePolicy(){return{enabled:Object(u.j)(this.outStatistics)&&this.outStatistics.length>0}}}}})],S.prototype,"outStatistics",void 0),Object(n.a)([Object(d.b)({json:{write:!0}})],S.prototype,"parameterValues",void 0),Object(n.a)([Object(b.a)("parameterValues")],S.prototype,"writeParameterValues",null),Object(n.a)([Object(d.b)({type:_.a,json:{write:!0}})],S.prototype,"pixelSize",void 0),Object(n.a)([Object(d.b)({type:v.a,json:{write:!0}})],S.prototype,"quantizationParameters",void 0),Object(n.a)([Object(d.b)({type:[Object],json:{write:!0}})],S.prototype,"rangeValues",void 0),Object(n.a)([Object(d.b)({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],S.prototype,"relationParameter",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],S.prototype,"resultType",void 0),Object(n.a)([Object(d.b)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"returnCentroid",void 0),Object(n.a)([Object(d.b)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"returnDistinctValues",void 0),Object(n.a)([Object(d.b)({type:Boolean,json:{default:!0,write:!0}})],S.prototype,"returnExceededLimitFeatures",void 0),Object(n.a)([Object(d.b)({type:Boolean,json:{write:!0}})],S.prototype,"returnGeometry",void 0),Object(n.a)([Object(d.b)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"returnQueryGeometry",void 0),Object(n.a)([Object(d.b)({type:Boolean,json:{default:!1,write:!0}})],S.prototype,"returnM",void 0),Object(n.a)([Object(d.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],S.prototype,"returnZ",void 0),Object(n.a)([Object(d.b)({type:j.a,json:{write:!0}})],S.prototype,"sourceSpatialReference",void 0),Object(n.a)([Object(p.a)(w,{ignoreUnknown:!1,name:"spatialRel"})],S.prototype,"spatialRelationship",void 0),Object(n.a)([Object(d.b)({type:Number,json:{read:{source:"resultOffset"}}})],S.prototype,"start",void 0),Object(n.a)([Object(b.a)("start"),Object(b.a)("num")],S.prototype,"writeStart",null),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],S.prototype,"sqlFormat",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],S.prototype,"text",void 0),Object(n.a)([Object(d.b)({type:a.a,json:{write:!0}})],S.prototype,"timeExtent",void 0),Object(n.a)([Object(p.a)(x,{ignoreUnknown:!1}),Object(d.b)({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],S.prototype,"units",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:{overridePolicy(e){return{enabled:null!=e||this.start>0}}}}})],S.prototype,"where",void 0),Object(n.a)([Object(b.a)("where")],S.prototype,"writeWhere",null),S=i=Object(n.a)([Object(f.a)("esri.rest.support.Query")],S);var T=S;t.a=T},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return a}));r(113);var i=r(2),n=r(39);let s;async function a(){return s||(s=(async()=>{const e=await r.e(16).then(r.bind(null,693));return await e.arcade.load(),{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),s}const o=(e,t,r)=>u.create(e,t,r,null,["$feature"]),l=(e,t,r)=>u.create(e,t,r,null,["$feature","$view"]),c=(e,t,r,i)=>u.create(e,t,r,i,["$feature","$view"]);class u{constructor(e,t,r,i,n,s,a,o){this.script=e,this.evaluate=n;const l=Array.isArray(a)?a:a.fields;this.fields=l,this._syntaxTree=i,this._arcade=t,this._arcadeDictionary=r,this._arcadeFeature=s,this._spatialReference=o,this._referencesGeometry=t.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,t,r,s,o,l){const{arcade:c,Feature:d,Dictionary:h}=await a(),p=n.a.fromJSON(t),f=c.parseScript(e,l),b=o.reduce(((e,t)=>({...e,[t]:null})),{});let m=null;Object(i.j)(s)&&(m=new h(s),m.immutable=!0,b.$config=null);const g=c.scriptUsesGeometryEngine(f)&&c.enableGeometrySupport(),y=c.scriptUsesFeatureSet(f)&&c.enableFeatureSetSupport(),v=c.scriptIsAsync(f)&&c.enableAsyncSupport(),O={vars:b,spatialReference:p,useAsync:!!v},j=new h;j.immutable=!1,j.setField("scale",0);const _=c.compileScript(f,O);return await Promise.all([g,y,v]),new u(e,c,h,f,(e=>("$view"in e&&e.$view&&(j.setField("scale",e.$view.scale),e.$view=j),m&&(e.$config=m),_({vars:e,spatialReference:p}))),new d,r,p)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}repurposeAdapter(e){return this._arcadeFeature.repurposeFromAdapter(e,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(e){return this._arcade.referencesMember(this._syntaxTree,e)}referencesFunction(e){return this._arcade.referencesFunction(this._syntaxTree,e)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(e){return this._arcade.extractFieldLiterals(this._syntaxTree,e)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(2),n=r(417),s=r(223);class a{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Object(n.a)(e)}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=Object(s.e)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Object(n.c)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(i.t)(e.offset,0)}updateFeatureExpressionInfoContext(e,t,r){if(Object(i.i)(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&Object(i.j)(t)&&Object(i.j)(r)?(this._featureExpressionInfoContext=Object(s.a)(e),Object(s.g)(this._featureExpressionInfoContext,Object(s.d)(n.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new a;return Object(i.j)(e)&&t.setFromElevationInfo(e),t}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return $})),r.d(t,"d",(function(){return y})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return A})),r.d(t,"g",(function(){return O})),r.d(t,"h",(function(){return x})),r.d(t,"i",(function(){return D})),r.d(t,"j",(function(){return I})),r.d(t,"k",(function(){return R})),r.d(t,"l",(function(){return j}));r(8);var i=r(7),n=r(10),s=r(201),a=r(16),o=r(20),l=r(3),c=r(5),u=r(112),d=r(26),h=r(64),p=r(198),f=r(34);const b=i.a.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class m{constructor(){this.plane=Object(d.d)(),this.origin=Object(c.e)(),this.basis1=Object(c.e)(),this.basis2=Object(c.e)()}}function g(e=V){return{plane:Object(d.d)(e.plane),origin:Object(c.c)(e.origin),basis1:Object(c.c)(e.basis1),basis2:Object(c.c)(e.basis2)}}function y(e,t=g()){return O(e.origin,e.basis1,e.basis2,t)}function v(e,t){Object(l.m)(t.origin,e.origin),Object(l.m)(t.basis1,e.basis1),Object(l.m)(t.basis2,e.basis2),Object(d.c)(e.plane,t.plane)}function O(e,t,r,i=g()){return Object(l.m)(i.origin,e),Object(l.m)(i.basis1,t),Object(l.m)(i.basis2,r),j(i),function(e,t){Math.abs(Object(l.j)(e.basis1,e.basis2)/(Object(l.r)(e.basis1)*Object(l.r)(e.basis2)))>1e-6&&b.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(l.j)(e.basis1,D(e)))>1e-6&&b.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(l.j)(D(e),e.origin)-e.plane[3])>1e-6&&b.warn(t,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function j(e){Object(d.j)(e.basis2,e.basis1,e.origin,e.plane)}function _(e,t,r){e!==r&&y(e,r);const i=Object(l.g)(f.c.get(),D(e),t);return Object(l.h)(r.origin,r.origin,i),r.plane[3]-=t,r}function w(e,t=g()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return Object(l.y)(t.origin,e[0]+r,e[1]+i,0),Object(l.y)(t.basis1,r,0,0),Object(l.y)(t.basis2,0,i,0),Object(d.i)(0,0,1,0,t.plane),t}function x(e,t,r){return!!Object(d.m)(e.plane,t,r)&&F(e,r)}function S(e,t,r){const i=N.get();z(e,t,i,N.get());let s=Number.POSITIVE_INFINITY;for(const a of q){const o=k(e,a,U.get()),c=f.c.get();if(Object(d.k)(i,o,c)){const e=Object(l.x)(f.c.get(),t.origin,c),i=Math.abs(Object(n.b)(Object(l.j)(t.direction,e)));i<s&&(s=i,Object(l.m)(r,c))}}return s===Number.POSITIVE_INFINITY?T(e,t,r):r}function T(e,t,r){if(x(e,t,r))return r;const i=N.get(),n=N.get();z(e,t,i,n);let s=Number.POSITIVE_INFINITY;for(const a of q){const o=k(e,a,U.get()),c=f.c.get();if(Object(d.l)(i,o,c)){const e=Object(h.d)(t,c);if(!Object(d.o)(n,c))continue;e<s&&(s=e,Object(l.m)(r,c))}}return P(e,t.origin)<s&&C(e,t.origin,r),r}function C(e,t,r){const i=Object(d.t)(e.plane,t,f.c.get()),n=Object(u.g)(L(e,e.basis1),i,-1,1,f.c.get()),s=Object(u.g)(L(e,e.basis2),i,-1,1,f.c.get());return Object(l.l)(r,Object(l.h)(f.c.get(),n,s),e.origin),r}function M(e,t,r){const{origin:i,basis1:n,basis2:s}=e,a=Object(l.l)(f.c.get(),t,i),o=Object(p.c)(n,a),c=Object(p.c)(s,a),u=Object(p.c)(D(e),a);return Object(l.y)(r,o,c,u)}function P(e,t){const r=M(e,t,f.c.get()),{basis1:i,basis2:n}=e,s=Object(l.r)(i),a=Object(l.r)(n),o=Math.max(Math.abs(r[0])-s,0),c=Math.max(Math.abs(r[1])-a,0),u=r[2];return o*o+c*c+u*u}function A(e,t){return Object(d.o)(e.plane,t)&&F(e,t)}function E(e,t){const r=-e.plane[3];return Object(p.c)(D(e),t)-r}function R(e,t,r){return e!==r&&y(e,r),Object(a.a)(H,t),Object(a.e)(H,H),Object(l.s)(r.basis1,e.basis1,H),Object(l.s)(r.basis2,e.basis2,H),Object(l.s)(Object(d.s)(r.plane),Object(d.s)(e.plane),H),Object(l.s)(r.origin,e.origin,t),Object(d.v)(r.plane,r.origin,r.plane),r}function I(e,t,r,i){return e!==i&&y(e,i),Object(a.c)(W,Object(a.i)(W),t,r),Object(l.s)(i.basis1,e.basis1,W),Object(l.s)(i.basis2,e.basis2,W),j(i),i}function D(e){return Object(d.s)(e.plane)}function F(e,t){const r=Object(l.l)(f.c.get(),t,e.origin),i=Object(l.v)(e.basis1),n=Object(l.v)(e.basis2),s=Object(l.j)(e.basis1,r),a=Object(l.j)(e.basis2,r);return-s-i<0&&s-i<0&&-a-n<0&&a-n<0}function L(e,t){const r=U.get();return Object(l.m)(r.origin,e.origin),Object(l.m)(r.vector,t),r}function k(e,t,r){const{basis1:i,basis2:n,origin:s}=e,a=Object(l.g)(f.c.get(),i,t.origin[0]),o=Object(l.g)(f.c.get(),n,t.origin[1]);Object(l.h)(r.origin,a,o),Object(l.h)(r.origin,r.origin,s);const c=Object(l.g)(f.c.get(),i,t.direction[0]),u=Object(l.g)(f.c.get(),n,t.direction[1]);return Object(l.g)(r.vector,Object(l.h)(c,c,u),2),r}function z(e,t,r,i){const n=D(e);Object(d.j)(n,t.direction,t.origin,r),Object(d.j)(Object(d.s)(r),n,t.origin,i)}const V={plane:Object(d.d)(),origin:Object(c.g)(0,0,0),basis1:Object(c.g)(1,0,0),basis2:Object(c.g)(0,1,0)},N=new s.a(d.d),U=new s.a(u.c),B=Object(c.e)(),G=new s.a((()=>({origin:null,basis1:null,basis2:null,plane:null}))),q=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],H=Object(o.d)(),W=Object(o.d)();var $=Object.freeze({__proto__:null,BoundedPlaneClass:m,create:g,wrap:function(e,t,r){const i=G.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=Object(d.x)(0,0,0,0),j(i),i},copy:y,copyWithoutVerify:v,fromValues:O,updateUnboundedPlane:j,elevate:_,setExtent:function(e,t,r){return w(t,r),_(r,E(e,e.origin),r),r},fromAABoundingRect:w,intersectRay:x,intersectRayClosestSilhouette:function(e,t,r){if(x(e,t,r))return r;const i=S(e,t,f.c.get());return Object(l.h)(r,t.origin,Object(l.g)(f.c.get(),t.direction,Object(l.o)(t.origin,i)/Object(l.r)(t.direction))),r},closestPointOnSilhouette:S,closestPoint:T,projectPoint:C,projectPointLocal:M,distance2:P,distance:function(e,t){return Math.sqrt(P(e,t))},distanceToSilhouette:function(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of q){const n=k(e,i,U.get()),s=Object(u.d)(n,t);s>r&&(r=s)}return Math.sqrt(r)},extrusionContainsPoint:A,axisAt:function(e,t,r,i){return function(e,t,r){switch(t){case 0:Object(l.m)(r,e.basis1),Object(l.t)(r,r);break;case 1:Object(l.m)(r,e.basis2),Object(l.t)(r,r);break;case 2:Object(l.m)(r,D(e))}return r}(e,r,i)},altitudeAt:E,setAltitudeAt:function(e,t,r,i){const n=E(e,t),s=Object(l.g)(B,D(e),r-n);return Object(l.h)(i,t,s),i},equals:function(e,t){return Object(l.q)(e.basis1,t.basis1)&&Object(l.q)(e.basis2,t.basis2)&&Object(l.q)(e.origin,t.origin)},transform:R,rotate:I,normal:D,UP:V})},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(84);async function n(e,t){const{data:r}=await Object(i.default)(e,{responseType:"image",...t});return r}},function(e,t,r){"use strict";t.a=function(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(4)),l=r(29),c=r(50),u=r(146),d=r(41),h=r(39),p=r(500),f=r(156),b=r(224),m=r(478),g=r(444),y=r(46),v=r(300);function O(e){return!Array.isArray(e[0])}let j=i=class extends u.a{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),r=e.spatialReference;let n=!1,s=!1;t.map((e=>{e.hasZ&&(n=!0),e.hasM&&(s=!0)}));const a={rings:t.map((function(e){const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(n&&e.hasZ){const r=e.zmin+.5*(e.zmax-e.zmin);for(let e=0;e<t.length;e++)t[e].push(r)}if(s&&e.hasM){const r=e.mmin+.5*(e.mmax-e.mmin);for(let e=0;e<t.length;e++)t[e].push(r)}return t})),spatialReference:r};return n&&(a.hasZ=!0),s&&(a.hasM=!0),new i(a)}normalizeCtorArgs(e,t){let r,i,n=null,s=null;return e&&!Array.isArray(e)?(n=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),r=e.hasZ,i=e.hasM):n=e,n=n||[],t=t||h.a.WGS84,n.length&&n[0]&&null!=n[0][0]&&"number"==typeof n[0][0]&&(n=[n]),s=n[0]&&n[0][0],s&&(void 0===r&&void 0===i?(r=s.length>2,i=s.length>3):void 0===r?r=i?s.length>3:s.length>2:void 0===i&&(i=r?s.length>3:s.length>2)),{rings:n,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=Object(p.a)(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new d.a;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Object(m.b)(this);if(!t)return null;const r=new c.a(t);return r.spatialReference=e,r}get isSelfIntersecting(){return Object(g.c)(this.rings)}writeRings(e,t){t.rings=Object(s.a)(this.rings)}addRing(e){if(!e)return;const t=this.rings,r=t.length;if(O(e)){const i=[];for(let t=0,r=e.length;t<r;t++)i[t]=e[t].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new i;return e.spatialReference=this.spatialReference,e.rings=Object(s.a)(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}contains(e){return!!e&&(Object(y.a)(e,this.spatialReference)&&(e=Object(y.d)(e,this.spatialReference)),Object(f.g)(this,e))}isClockwise(e){let t;return t=O(e)?e.map((e=>this.hasZ?this.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])):e,Object(b.e)(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.rings[e][t],i=this.hasZ,n=this.hasM;return i&&!n?new d.a(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new d.a(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new d.a(r[0],r[1],r[2],r[3],this.spatialReference):new d.a(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(Object(v.a)(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e].splice(t,0,r),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new d.a(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],r=this.spatialReference,i=t.map((e=>new d.a(e,r)));return this.notifyChange("rings"),i}setPoint(e,t,r){return this._validateInputs(e,t)?(Object(v.a)(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e][t]=r,this.notifyChange("rings"),this):this}_validateInputs(e,t,r=!1){if(null==e||e<0||e>=this.rings.length)return!1;if(null!=t){const i=this.rings[e];if(r&&(t<0||t>i.length))return!1;if(!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write(null,e)}};Object(n.a)([Object(a.b)({readOnly:!0})],j.prototype,"cache",null),Object(n.a)([Object(a.b)({readOnly:!0})],j.prototype,"centroid",null),Object(n.a)([Object(a.b)({readOnly:!0})],j.prototype,"extent",null),Object(n.a)([Object(a.b)({readOnly:!0})],j.prototype,"isSelfIntersecting",null),Object(n.a)([Object(a.b)({type:[[[Number]]],json:{write:{isRequired:!0}}})],j.prototype,"rings",void 0),Object(n.a)([Object(l.a)("rings")],j.prototype,"writeRings",null),j=i=Object(n.a)([Object(o.a)("esri.geometry.Polygon")],j),j.prototype.toJSON.isDefaultToJSON=!0;var _=j;t.a=_},function(e,t,r){"use strict";r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return g}));var i=r(8),n=r(2),s=r(109);class a{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new Map;this._current.length<s.b.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,t){const r=++this._current[e];this._max[e]=Math.max(r,this._max[e])}decrement(e,t){--this._current[e]}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce(((e,t)=>e+t),0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let e=0;e<s.b.COUNT;++e){const t=this._current[e];t>0&&console.log(`${s.b[e]}: ${t}`)}}if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const e=new Map;this._allocations.forEach((t=>{var r;e.set(t,(null!=(r=e.get(t))?r:0)+1)})),e.forEach(((e,t)=>console.log(e," : ",t)))}}}var o=r(30),l=r(47),c=r(143);class u{constructor(e,t,r,i,n,s,a,o){this.createQuery=e,this.resultAvailable=t,this.getResult=r,this.disjoint=i,this.beginTimeElapsed=n,this.endTimeElapsed=s,this.createTimestamp=a,this.timestampBits=o}}function d(e,t){const r=t.disabledExtensions||{},i=t.debugWebGLExtensions||{};let n,s,a,o,l,d,p,f,b,m,g,y=null,v=null,O=null,j=null;return{get drawBuffers(){return g||(g=function(e,t){if(t.disjointTimerQuery)return null;if(Object(c.a)(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const r=e.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}(e,r)),g},get instancing(){return n||(n=function(e){if(Object(c.a)(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}(e)),n},get vao(){return s||(s=function(e,t){if(Object(c.a)(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const r=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}(e,r)),s},get compressedTextureETC(){return a||(a=function(e,t){if(t.compressedTextureETC)return null;const r=e.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(e,r)),a},get compressedTextureS3TC(){return o||(o=function(e,t){if(t.compressedTextureS3TC)return null;const r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(e,r)),o},get textureFilterAnisotropic(){return l||(l=function(e,t){if(t.textureFilterAnisotropic)return null;const r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}(e,r)),l},get disjointTimerQuery(){return d||(d=function(e,t){if(t.disjointTimerQuery)return null;let r=e.getExtension("EXT_disjoint_timer_query_webgl2");return r&&Object(c.a)(e)?new u((()=>e.createQuery()),(t=>e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)),(t=>e.getQueryParameter(t,e.QUERY_RESULT)),(()=>e.getParameter(r.GPU_DISJOINT_EXT)),(t=>e.beginQuery(r.TIME_ELAPSED_EXT,t)),(()=>e.endQuery(r.TIME_ELAPSED_EXT)),(e=>r.queryCounterEXT(e,r.TIMESTAMP_EXT)),(()=>e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT))):(r=e.getExtension("EXT_disjoint_timer_query"),r?new u((()=>r.createQueryEXT()),(e=>r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT)),(e=>r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)),(()=>e.getParameter(r.GPU_DISJOINT_EXT)),(e=>r.beginQueryEXT(r.TIME_ELAPSED_EXT,e)),(()=>r.endQueryEXT(r.TIME_ELAPSED_EXT)),(e=>r.queryCounterEXT(e,r.TIMESTAMP_EXT)),(()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT))):null)}(e,r)),d},get textureFloat(){return p||(p=function(e,t){if(Object(c.a)(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};if(e instanceof WebGLRenderingContext){const r=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}(e,r)),p},get colorBufferFloat(){return f||(f=function(e,t){if(Object(c.a)(e)){const r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}(e,r)),f},get blendMinMax(){return b||(b=function(e,t){if(Object(c.a)(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const t=e.getExtension("EXT_blend_minmax");return t?{MIN:t.MIN_EXT,MAX:t.MAX_EXT}:null}}(e,r)),b},get depthTexture(){return null===y&&(y=h(e,r,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),y},get standardDerivatives(){return null===v&&(v=h(e,r,"standardDerivatives",!0,["OES_standard_derivatives"])),v},get shaderTextureLOD(){return null===O&&(O=h(e,r,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),O},get fragDepth(){return null===j&&(j=h(e,r,"fragDepth",!0,["EXT_frag_depth"])),j},get loseContext(){return m||(m=function(e,t){const r=t.loseContext&&e.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}(e,i)),m},enable(e){return this[e]}}}function h(e,t,r,i,n){if(i&&Object(c.a)(e))return!0;if(t[r])return!1;for(const s of n)if(e.getExtension(s))return!0;return!1}function p(e,t,r,i){return t?i!==t&&e.bindBuffer(r,t.glName):e.bindBuffer(r,null),t}function f(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2;default:return 0}}const b=!!Object(i.a)("enable-feature:webgl-debug");function m(){return b}function g(){return b}t.a=class{constructor(e,t={}){this.gl=e,this.instanceCounter=new a,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap=new Array,this._numOfDrawCalls=0,this._numOfTriangles=0,this.webglVersion=Object(c.a)(e)?"webgl2":"webgl",e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=d(e,t),this._parameters=this._loadParameters(t);const r=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new o.a({setBlending:e=>{if(e){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(e.opRgb,e.opAlpha),this.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);const t=e.color;this.setBlendColor(t.r,t.g,t.b,t.a)}else this.setBlendingEnabled(!1)},setCulling:e=>{e?(this.setFaceCullingEnabled(!0),this.setCullFace(e.face),this.setFrontFace(e.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:e=>{e?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(e.factor,e.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:e=>{e?(this.setDepthTestEnabled(!0),this.setDepthFunction(e.func)):this.setDepthTestEnabled(!1)},setStencilTest:e=>{if(e){this.setStencilTestEnabled(!0);const t=e.function;this.setStencilFunction(t.func,t.ref,t.mask);const r=e.operation;this.setStencilOp(r.fail,r.zFail,r.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:e=>{e?(this.setDepthWriteEnabled(!0),this.setDepthRange(e.zNear,e.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:e=>{e?this.setColorMask(e.r,e.g,e.b,e.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:e=>{e?this.setStencilWriteMask(e.mask):this.setStencilWriteMask(0)}}),this.enforceState()}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap.length=0,m()&&this.instanceCounter.printResourceCount()}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e,this._stateTracker.invalidateBlending())}externalTextureUnitUpdate(e,t){for(let r=0;r<e.length;++r)this._textureUnitMap[e[r]]=null;t>=0&&(this._activeTextureUnit=t)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._activeVertexArrayObject=null),this._activeVertexBuffer=null,this._activeIndexBuffer=null}externalVertexBufferUpdate(){this._activeVertexBuffer=null}externalIndexBufferUpdate(){this._activeIndexBuffer=null}setBlendColor(e,t,r,i){e===this._blendColorState.r&&t===this._blendColorState.g&&r===this._blendColorState.b&&i===this._blendColorState.a||(this.gl.blendColor(e,t,r,i),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=r,this._blendColorState.a=i,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,r,i){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===r&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===i||(this.gl.blendFuncSeparate(e,t,r,i),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=r,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,r,i){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===r&&this._colorMaskState.a===i||(this.gl.colorMask(e,t,r,i),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=r,this._colorMaskState.a=i,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,r,i){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===r&&this._clearColor.a===i||(this.gl.clearColor(e,t,r,i),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=r,this._clearColor.a=i)}setFaceCullingEnabled(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)}setScissorRect(e,t,r,i){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===r&&this._scissorRect.height===i||(this.gl.scissor(e,t,r,i),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=r,this._scissorRect.height=i)}setDepthTestEnabled(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)}setDepthFunction(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)}setStencilFunction(e,t,r){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,r,i){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===r&&this._stencilFunction.mask===i||(this.gl.stencilFuncSeparate(e,t,r,i),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=r,this._stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,r){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,r,i){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===r&&this._stencilOperation.zPass===i||(this.gl.stencilOpSeparate(e,t,r,i),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=r,this._stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const r=this._activeTextureUnit;return e>=0&&(t||e!==this._activeTextureUnit)&&(this.gl.activeTexture(s.a+e),this._activeTextureUnit=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(16384&e&&this.setColorMask(!0,!0,!0,!0),256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,r){m()&&(this._numOfDrawCalls++,this._numOfTriangles+=f(e,r)),this.gl.drawArrays(e,t,r)}drawElements(e,t,r,i){m()&&(this._numOfDrawCalls++,this._numOfTriangles+=f(e,t)),this.gl.drawElements(e,t,r,i)}logIno(){m()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}get capabilities(){return this._capabilities}setViewport(e,t,r,i){r=Math.max(Math.round(r),1),i=Math.max(Math.round(i),1);const n=this._viewport;n.x===e&&n.y===t&&n.width===r&&n.height===i||(n.x=e,n.y=t,n.width=r,n.height=i,this.gl.viewport(e,t,r,i))}getViewport(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}}useProgram(e){var t,r;if(!e)return null==(r=this._activeShaderProgram)||r.stop(),this._activeShaderProgram=null,void this.gl.useProgram(null);this._activeShaderProgram!==e&&(null==(t=this._activeShaderProgram)||t.stop(),this._activeShaderProgram=e,this.gl.useProgram(e.glName))}bindTexture(e,t,r=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const i=this._textureUnitMap[t];return this.setActiveTexture(t,r),Object(n.i)(e)||null==e.glName?(Object(n.j)(i)&&this.gl.bindTexture(i.descriptor.target,null),this._textureUnitMap[t]=null,i):r||i!==e?(this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._textureUnitMap[t]=e,i):(e.applyChanges(),i)}unbindTextureAllUnits(e){for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._textureUnitMap[t]===e&&(this.bindTexture(null,t),this._textureUnitMap[t]=null)}bindFramebuffer(e,t=!1){if(Object(n.i)(e))return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);(t||this._activeFramebuffer!==e)&&(e.initializeAndBind(),this._activeFramebuffer=e)}bindBuffer(e){e&&(34962===e.bufferType?this._activeVertexBuffer=p(this.gl,e,e.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=p(this.gl,e,e.bufferType,this._activeIndexBuffer))}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)}unbindBuffer(e){34962===e?this._activeVertexBuffer=p(this.gl,null,e,this._activeVertexBuffer):this._activeIndexBuffer=p(this.gl,null,e,this._activeIndexBuffer)}bindVAO(e=null){Object(n.i)(e)?this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null):this._activeVertexArrayObject!==e&&(e.bind(),this._activeVertexArrayObject=e)}getBoundFramebufferObject(){return this._activeFramebuffer}getBoundVAO(){return this._activeVertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.gl,t=this.capabilities.vao;t&&t.bindVertexArray(null);for(let r=0;r<this.parameters.maxVertexAttributes;r++)e.disableVertexAttribArray(r);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){const e=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(e)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(1),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(let r=0;r<this.parameters.maxTextureImageUnits;r++){e.activeTexture(s.a+r),e.bindTexture(3553,null),Object(c.a)(e)&&e.bindTexture(32879,null);const t=this._textureUnitMap[r];Object(n.j)(t)&&e.bindTexture(t.descriptor.target,t.glName)}e.activeTexture(s.a+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),m()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}_loadParameters(e){var t;const r=this.capabilities.textureFilterAnisotropic,i=null!=(t=e.maxAnisotropy)?t:1/0,n={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:r?Math.min(this.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),i):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)};return l.a.TEXTURE_UNIT_FOR_UPDATES=n.maxTextureImageUnits-1,n}}},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(1),a=(r(8),r(9),r(7),r(32)),o=r(4),l=r(39);let c=class extends n.a{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=l.a.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof l.a)return e;if(null!=e){const r=new l.a;return r.read(e,t),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};Object(i.a)([Object(s.b)()],c.prototype,"type",void 0),Object(i.a)([Object(s.b)({readOnly:!0})],c.prototype,"cache",null),Object(i.a)([Object(s.b)({readOnly:!0})],c.prototype,"extent",null),Object(i.a)([Object(s.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],c.prototype,"hasM",void 0),Object(i.a)([Object(s.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],c.prototype,"hasZ",void 0),Object(i.a)([Object(s.b)({type:l.a,json:{write:!0}})],c.prototype,"spatialReference",void 0),Object(i.a)([Object(a.a)("spatialReference")],c.prototype,"readSpatialReference",null),c=Object(i.a)([Object(o.a)("esri.geometry.Geometry")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(29);let l=class extends n.a{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,r){e||(t[r]=e)}};Object(i.a)([Object(s.b)({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],l.prototype,"enabled",void 0),Object(i.a)([Object(o.a)("enabled")],l.prototype,"writeEnabled",null),Object(i.a)([Object(s.b)({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],l.prototype,"type",void 0),l=Object(i.a)([Object(a.a)("esri.symbols.Symbol3DLayer")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a}));var i=r(2),n=r(359);class s{constructor(e,t=null,r=0){this.array=e,this.spatialReference=t,this.offset=r}}function a(e){return"array"in e}function o(e,t,r="ground"){if(Object(n.a)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(a(t)){let n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,Object(i.t)(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var i=r(2),n=r(16),s=r(20),a=r(3),o=r(5),l=r(55),c=r(67),u=r(236),d=r(331),h=r(352),p=r(33),f=r(123);class b extends u.a{constructor(e={}){super(),this.type=1,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Object(s.d)(),this._bvObjectSpace=new g,this._bvWorldSpace=new g,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new m),this.transformation=Object(s.d)();const{geometries:t,materials:r,transformations:i,origins:n}=e;if(Array.isArray(t)){Object(p.a)(r.length===t.length,"Object3D: materials don't match geometries"),Object(p.a)(i.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=d.a.pool.acquire(t[e],r[e],Object(s.c)(i[e]),{highlights:null,occludees:null,visible:!0},n&&n[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){Object(n.d)(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Object(p.a)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}getNumGeometryRecords(){return this._geometryRecords.length}getGeometryRecord(e){return Object(p.a)(e>=0&&e<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this._geometryRecords[e]}addGeometry(e,t,r,n,a,o){r=r||s.a,this._geometries.push(e);const l=d.a.pool.acquire(e,t,r,n||{highlights:null,occludees:null,visible:!0},a,o);return this._geometryRecords.push(l),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(i.j)(l.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:l}),this._invalidateBoundingVolume(),l}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(i.j)(t.shaderTransformation)?this._geometryRecords.some((e=>Object(i.j)(e.shaderTransformation))):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:this._geometryRecords[e]}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){this._visible=e;for(const t of this._geometryRecords)t.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}maskOccludee(){const e=new h.a(1);for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(f.b)(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(f.g)(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new h.a(0);for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(f.b)(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(f.g)(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Object(n.m)(Object(i.t)(t,Object(s.d)()),this.transformation,e.getStaticTransformation())}getCombinedShaderTransformation(e,t){return t=t||Object(s.d)(),Object(n.m)(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let n=0;n<this._geometryRecords.length;++n){const e=this._geometries[n],t=this._geometryRecords[n],r=e.boundingInfo;Object(i.j)(r)&&(this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this.getCombinedShaderTransformation(t)))}Object(a.k)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(a.k)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=Object(o.e)(),t=Object(o.e)(),r=Object(c.i)(this.transformation);for(let n=0;n<this._geometryRecords.length;++n){const s=this._geometries[n].boundingInfo;if(Object(i.i)(s))continue;const o=this._geometryRecords[n].getShaderTransformation(),l=Object(c.i)(o);Object(a.s)(e,s.getCenter(),o);const u=Object(a.o)(e,this._bvObjectSpace.bounds),d=s.getBSRadius()*l;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],u+d),Object(a.s)(t,e,this.transformation);const h=Object(a.o)(t,this._bvWorldSpace.bounds),p=d*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,r){const i=e.getBBMin(),n=e.getBBMax(),s=Object(o.c)(i),l=Object(o.c)(n);Object(a.s)(s,s,r),Object(a.s)(l,l,r);for(let a=0;a<3;++a)t.min[a]=Math.min(t.min[a],s[a],l[a]),t.max[a]=Math.max(t.max[a],s[a],l[a]);for(let o=0;o<3;++o){Object(a.m)(s,i),Object(a.m)(l,n),s[o]=n[o],l[o]=i[o],Object(a.s)(s,s,r),Object(a.s)(l,l,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],s[e],l[e]),t.max[e]=Math.max(t.max[e],s[e],l[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,Object(i.j)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){Object(i.j)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.indexOf(t)>-1,getGeometryIndex:t=>e._geometries.indexOf(t)}}}class m{constructor(){this.min=Object(o.g)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(o.g)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class g extends m{constructor(){super(...arguments),this.bounds=Object(l.c)()}init(){Object(a.y)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(a.y)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(l.a)(this.bounds)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return s}));var i=r(2);const n=7;function s(e){switch(e){case"defaults":return 0;case"service":return 2;case"portal-item":return 3;case"web-scene":return 4;case"web-map":return 5;case"user":return 6}}function a(e){switch(e){case 0:return"defaults";case 2:return"service";case 3:return"portal-item";case 4:return"web-scene";case 5:return"web-map";case 6:return"user"}return Object(i.d)(void 0)}function o(e){return a(e)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c}));var i=r(2),n=r(125);const s={ar:"ar-u-nu-latn"};let a=new WeakMap,o={};function l(e={}){const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function c(e,t){return function(e){const t=e||o;if(!a.has(t)){const r=Object(n.b)(),i=s[Object(n.b)()]||r;a.set(t,new Intl.NumberFormat(i,e))}return Object(i.d)(a.get(t))}(t).format(e)}Object(n.a)((()=>{a=new WeakMap,o={}}))},function(e,t,r){"use strict";var i=r(0),n=r(44),s=r(13),a=r(17),o=r(1),l=(r(9),r(8),r(7),r(37)),c=r(4),u=r(121);let d=class extends u.a{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};Object(i.a)([Object(l.a)({esriSLS:"simple-line"},{readOnly:!0})],d.prototype,"type",void 0),Object(i.a)([Object(o.b)({type:Number,cast:a.j,json:{write:!0}})],d.prototype,"width",void 0),d=Object(i.a)([Object(c.a)("esri.symbols.LineSymbol")],d);var h,p=d,f=r(35),b=r(14),m=r(32),g=r(29);let y=h=class extends b.a{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,i){"web-map"===(null==i?void 0:i.origin)?t[r]="arrow":t[r]=e}set color(e){this._set("color",e)}readColor(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,i){"web-map"===(null==i?void 0:i.origin)||(t[r]=e)}clone(){return new h({color:Object(s.a)(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${null==(e=this.color)?void 0:e.hash()}.${this.style}`}};Object(i.a)([Object(o.b)({type:["begin","end","begin-end"],json:{write:!0}})],y.prototype,"placement",void 0),Object(i.a)([Object(l.a)({"line-marker":"line-marker"},{readOnly:!0}),Object(o.b)({json:{origins:{"web-map":{write:!1}}}})],y.prototype,"type",void 0),Object(i.a)([Object(o.b)({type:["arrow","circle","square","diamond","cross","x"]})],y.prototype,"style",void 0),Object(i.a)([Object(g.a)("style")],y.prototype,"writeStyle",null),Object(i.a)([Object(o.b)({type:f.a,value:null,json:{write:{allowNull:!0}}})],y.prototype,"color",null),Object(i.a)([Object(m.a)("color")],y.prototype,"readColor",null),Object(i.a)([Object(g.a)("color")],y.prototype,"writeColor",null),y=h=Object(i.a)([Object(c.a)("esri.symbols.LineSymbolMarker")],y);var v,O=y;const j=new n.a({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let _=v=class extends p{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,i,n,s){if(e&&"string"!=typeof e)return e;const o={};return null!=e&&(o.style=e),null!=t&&(o.color=t),null!=r&&(o.width=Object(a.j)(r)),null!=i&&(o.cap=i),null!=n&&(o.join=n),null!=s&&(o.miterLimit=Object(a.j)(s)),o}clone(){var e;return new v({color:Object(s.a)(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:null==(e=this.marker)?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${null==(e=this.color)?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${null==(t=this.marker)?void 0:t.hash()}`}};Object(i.a)([Object(l.a)({esriSLS:"simple-line"},{readOnly:!0})],_.prototype,"type",void 0),Object(i.a)([Object(o.b)({type:j.apiValues,json:{read:j.read,write:j.write}})],_.prototype,"style",void 0),Object(i.a)([Object(o.b)({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&(null==r||null==r.origin)})}}})],_.prototype,"cap",void 0),Object(i.a)([Object(o.b)({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&(null==r||null==r.origin)})}}})],_.prototype,"join",void 0),Object(i.a)([Object(o.b)({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":O}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],_.prototype,"marker",void 0),Object(i.a)([Object(o.b)({type:Number,json:{read:!1,write:!1}})],_.prototype,"miterLimit",void 0),_=v=Object(i.a)([Object(c.a)("esri.symbols.SimpleLineSymbol")],_);var w=_;t.a=w},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var i=r(38);function n(e,t,r=i.a){return t||(t=new r),t===e||(t.removeAll(),(n=e)&&(Array.isArray(n)||"items"in n&&Array.isArray(n.items))?t.addMany(e):e&&t.add(e)),t;var n}function s(e){return e}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(2),n=r(3),s=r(5),a=r(22),o=r(55),l=r(223),c=r(91);class u{constructor(e,t,r,i,n,s,a,o=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=r,this._uniqueMaterials=i,this._uniqueTextures=n,this.elevationAligner=s,this.elevationContext=a,this._edgeState=o,this.type="object3d",this.stageLayer=null,this.stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=e,this.stageObject=t}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(e,t){this.stageLayer=t,this.stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.addMany(this._uniqueTextures),e.add(this.stageObject)}destroy(){const e=this.stage;this.stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.removeMany(this._uniqueTextures)),e.remove(this.stageObject),this._addedToStage&&(this.stageLayer.remove(this.stageObject),this._addedToStage=!1);const t=this.stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)&&t.removeObject(this.stageObject),this.stageObject.dispose(),this._visible=!1,this.stageLayer=null,this.stage=null}layerOpacityChanged(e,t){if(Object(i.i)(this._edgeState))return;const r=d(this._edgeState.baseMaterial);let n=!1;for(const i of this._edgeState.edgeMaterials)i.objectTransparency!==r&&(i.objectTransparency=r,n=!0);n&&this.resetEdgeObject(t),this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,t){Object(i.i)(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:e},!t),this._edgeState.properties.slicePlaneEnabled=e)}setVisibility(e){if(null!=this.stage&&this._visible!==e&&(this._visible=e,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),Object(i.j)(this._edgeState))){const t=this.stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,e):e&&this.addOrUpdateEdgeObject(t,!1)}}get visible(){return this._visible}alignWithElevation(e,t,r,n){if(null==this.elevationAligner)return;Object(i.j)(r)&&Object(l.g)(this.elevationContext.featureExpressionInfoContext,r);const s=this.elevationAligner(this,this.elevationContext,e,t);null!=s&&(this.alignedSampledElevation=s),this.resetEdgeObject(n)}getCenterObjectSpace(e=Object(s.e)()){return Object(n.m)(e,Object(o.g)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=Object(a.h)()){const t=this.stageObject.boundingVolumeObjectSpace;return Object(a.D)(e,t.min),Object(a.C)(e,t.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++}else for(const t of this.stageObject.geometryRecords)t.computeAttachmentOrigin(f)&&(Object(n.s)(f,f,this.stageObject.transformation),Object(n.h)(e.render.origin,e.render.origin,f),e.render.num++)}async getProjectedBoundingBox(e,t,r,s,o){const l=this.getBoundingBoxObjectSpace(o),u=b,d=Object(a.x)(l)?1:u.length;for(let i=0;i<d;i++){const e=u[i];p[0]=l[e[0]],p[1]=l[e[1]],p[2]=l[e[2]],Object(n.s)(p,p,this.stageObject.transformation),h[3*i+0]=p[0],h[3*i+1]=p[1],h[3*i+2]=p[2]}if(!e(h,0,d))return null;Object(a.k)(l);let m=null;this.calculateRelativeScreenBounds&&(m=this.calculateRelativeScreenBounds());for(let i=0;i<3*d;i+=3){for(let e=0;e<3;e++)l[e]=Math.min(l[e],h[i+e]),l[e+3]=Math.max(l[e+3],h[i+e]);m&&r.push({location:h.slice(i,i+3),screenSpaceBoundingRect:m})}if(t&&t.service&&"absolute-height"!==this.elevationContext.mode){Object(a.e)(l,f);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let r=0;if(t.useViewElevation)r=Object(i.t)(t.service.getElevation(f[0],f[1],e),0);else try{const n=Object(c.d)(l,t);r=Object(i.t)(await t.service.queryElevation(f[0],f[1],s,n,e),0)}catch(g){}Object(a.z)(l,0,0,-this.alignedSampledElevation+r)}return l}addObjectState(e,t){0===e&&t.addObject(this.stageObject,this.stageObject.highlight()),1===e&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(Object(i.i)(this._edgeState))return;const t=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(t,e):t.removeObject(this.stageObject)}addOrUpdateEdgeObject(e,t){const r=this._edgeState;if(Object(i.i)(r))return;const n=d(r.baseMaterial);for(const i of r.edgeMaterials)i.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!t).then((()=>{var e;return null==(e=this.stageLayer)?void 0:e.sync()}))}}function d(e){return e.isVisible?e.params.transparent?1:2:0}const h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=Object(s.e)(),f=Object(s.e)(),b=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},function(e,t,r){"use strict";function i(e){return e&&("function"==typeof e.on||"function"==typeof e.addEventListener)}function n(e,t,r){if(!i(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,r);if(Array.isArray(t)){const i=t.slice();for(const t of i)e.addEventListener(t,r);return{remove(){for(const t of i)e.removeEventListener(t,r)}}}return e.addEventListener(t,r),{remove(){e.removeEventListener(t,r)}}}function s(e,t,r){if(!i(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,r);const s=n(e,t,(t=>{s.remove(),r.call(e,t)}));return{remove(){s.remove()}}}r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return s}));const a={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function o({key:e}){return a[e]||e}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return n})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return u}));const i=[0,0];function n(e,t){return c(e,t.x,t.y,t.z)}function s(e,t){if(!t.points||t.points.length)return!1;for(const r of t.points)if(!o(e,r))return!1;return!0}function a(e,t){const{xmin:r,ymin:i,zmin:n,xmax:s,ymax:a,zmax:o}=t;return e.hasZ&&t.hasZ?c(e,r,i,n)&&c(e,r,a,n)&&c(e,s,a,n)&&c(e,s,i,n)&&c(e,r,i,o)&&c(e,r,a,o)&&c(e,s,a,o)&&c(e,s,i,o):c(e,r,i)&&c(e,r,a)&&c(e,s,a)&&c(e,s,i)}function o(e,t){return c(e,t[0],t[1])}function l(e,t){return c(e,t[0],t[1],t[2])}function c(e,t,r,i){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax&&(null==i||!e.hasZ||i>=e.zmin&&i<=e.zmax)}function u(e,t){return i[1]=t.y,i[0]=t.x,d(e,i)}function d(e,t){return function(e,t){if(!e)return!1;if(function(e){return!Array.isArray(e[0][0])}(e))return h(!1,e,t);let r=!1;for(let i=0,n=e.length;i<n;i++)r=h(r,e[i],t);return r}(e.rings,t)}function h(e,t,r){const[i,n]=r;let s=e,a=0;for(let o=0,l=t.length;o<l;o++){a++,a===l&&(a=0);const[e,r]=t[o],[c,u]=t[a];(r<n&&u>=n||u<n&&r>=n)&&e+(n-r)/(u-r)*(c-e)<i&&(s=!s)}return s}},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(10),o=r(1),l=(r(8),r(45)),c=(r(7),r(32)),u=r(4),d=r(29),h=r(9),p=r(41),f=r(67);let b=i=class extends s.a{constructor(...e){super(...e),this.position=new p.a([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,r,i){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){const n={position:e};return null!=t&&(n.heading=t),null!=r&&(n.tilt=r),null!=i&&(n.fov=i),n}return e}writePosition(e,t,r,i){const n=e.clone();n.x=Object(h.i)(e.x||0),n.y=Object(h.i)(e.y||0),n.z=e.hasZ?Object(h.i)(e.z||0):e.z,t[r]=n.write(null,i)}readPosition(e,t){const r=new p.a;return r.read(e,t),r.x=Object(h.i)(r.x||0),r.y=Object(h.i)(r.y||0),r.z=r.hasZ?Object(h.i)(r.z||0):r.z,r}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}clone(){return new i({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})}};Object(n.a)([Object(o.b)({type:p.a,json:{write:{isRequired:!0}}})],b.prototype,"position",void 0),Object(n.a)([Object(d.a)("position")],b.prototype,"writePosition",null),Object(n.a)([Object(c.a)("position")],b.prototype,"readPosition",null),Object(n.a)([Object(o.b)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Object(l.a)((e=>f.e.normalize(Object(h.i)(e))))],b.prototype,"heading",void 0),Object(n.a)([Object(o.b)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Object(l.a)((e=>Object(a.e)(Object(h.i)(e),-180,180)))],b.prototype,"tilt",void 0),Object(n.a)([Object(o.b)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],b.prototype,"fov",void 0),b=i=Object(n.a)([Object(u.a)("esri.Camera")],b);var m=b;t.a=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return a})),r.d(t,"f",(function(){return o}));var i=r(129),n=r(94);const s=Object(n.a)().vec3f("position").u16("componentIndex").u16("u16padding"),a=Object(n.a)().vec2u8("sideness"),o=Object(i.a)(a),l=Object(n.a)().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("u8padding",{glPadding:!0}).u16("u16padding",{glPadding:!0}),c=l.clone().vec3f("normal"),u=l.clone().vec3f("normalA").vec3f("normalB"),d=new Map([["position0",0],["position1",1],["componentIndex",2],["variantOffset",3],["variantStroke",4],["variantExtension",5],["normal",6],["normalA",6],["normalB",7],["sideness",8]])},function(e,t,r){"use strict";var i=r(0),n=r(11),s=r(206),a=r(12),o=r(181),l=r(1),c=r(4);const u="loaded",d=e=>{let t=class extends e{constructor(...e){super(...e),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((e=>{const t=this.load.bind(this);this.load=r=>{const i=new Promise(((e,t)=>{const i=Object(a.t)(r,t);this.destroyed&&t(new n.a("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(e,t).finally((()=>{i&&i.remove()}))}));if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const e=this._loadController=Object(a.e)();t({signal:e.signal}),Object(a.s)(e.signal,(()=>{this._promiseProps.abort()}))}return e(),i}}))),this.when((()=>{this._set("loadStatus",u),this._loadController=null}),(e=>{this._set("loadStatus","failed"),this._set("loadError",e),this._loadController=null}))}get loaded(){return this.loadStatus===u}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var e;return this.isFulfilled()||(this._set("loadError",new n.a("load:cancelled","Cancelled")),null==(e=this._loadController)||e.abort()),this}};return Object(i.a)([Object(l.b)({readOnly:!0})],t.prototype,"loaded",null),Object(i.a)([Object(l.b)({readOnly:!0})],t.prototype,"loadError",void 0),Object(i.a)([Object(l.b)()],t.prototype,"loadStatus",void 0),Object(i.a)([Object(l.b)({type:[o.a],readOnly:!0})],t.prototype,"loadWarnings",null),t=Object(i.a)([Object(c.a)("esri.core.Loadable")],t),t};let h=class extends(d(s.a)){};var p;h=Object(i.a)([Object(c.a)("esri.core.Loadable")],h),(p=h||(h={})).LoadableMixin=d,p.isLoadable=function(e){return!(!e||!e.load)};var f=h;t.a=f},function(e,t,r){"use strict";var i,n,s=r(3),a=r(58),o=r(5),l=r(26),c=r(64);(n=i||(i={})).length=function(e,t){const r=e[t],i=e[t+1],n=e[t+2];return Math.sqrt(r*r+i*i+n*n)},n.normalize=function(e,t){const r=e[t],i=e[t+1],n=e[t+2],s=1/Math.sqrt(r*r+i*i+n*n);e[t]*=s,e[t+1]*=s,e[t+2]*=s},n.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},n.add=function(e,t,r,i,n,s=t){(n=n||e)[s]=e[t]+r[i],n[s+1]=e[t+1]+r[i+1],n[s+2]=e[t+2]+r[i+2]},n.subtract=function(e,t,r,i,n,s=t){(n=n||e)[s]=e[t]-r[i],n[s+1]=e[t+1]-r[i+1],n[s+2]=e[t+2]-r[i+2]};var u=r(100),d=r(136),h=r(33);const p=i;var f,b,m,g;!function(e){const t=.5,r=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],s=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),a=new Uint16Array(36);for(let l=0;l<6;l++)for(let e=0;e<6;e++)a[6*l+e]=l;const o=new Uint16Array(36);for(let l=0;l<6;l++)o[6*l+0]=0,o[6*l+1]=1,o[6*l+2]=2,o[6*l+3]=2,o[6*l+4]=3,o[6*l+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let i=0;i<8;i++)t[3*i]=r[i][0]*e[0],t[3*i+1]=r[i][1]*e[1],t[3*i+2]=r[i][2]*e[2];return new u.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}],["uv0",{size:2,data:n}]],[["position",s],["normal",a],["uv0",o]])}}(f||(f={})),function(e){const t=.5,r=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),s=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let i=0;i<6;i++)t[3*i]=r[i][0]*e[0],t[3*i+1]=r[i][1]*e[1],t[3*i+2]=r[i][2]*e[2];return new u.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}]],[["position",n],["normal",s]])}}(b||(b={})),function(e){const t=.5,r=Object(a.d)(-t,0,-t),i=Object(a.d)(t,0,-t),n=Object(a.d)(0,0,t),o=Object(a.d)(0,.5,0),l=Object(a.c)(),c=Object(a.c)(),d=Object(a.c)(),h=Object(a.c)(),p=Object(a.c)();Object(s.l)(l,r,o),Object(s.l)(c,r,i),Object(s.i)(d,l,c),Object(s.t)(d,d),Object(s.l)(l,i,o),Object(s.l)(c,i,n),Object(s.i)(h,l,c),Object(s.t)(h,h),Object(s.l)(l,n,o),Object(s.l)(c,n,r),Object(s.i)(p,l,c),Object(s.t)(p,p);const f=[r,i,n,o],b=[0,-1,0,d[0],d[1],d[2],h[0],h[1],h[2],p[0],p[1],p[2]],m=[0,1,2,3,1,0,3,2,1,3,0,2],g=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let r=0;r<4;r++)t[3*r]=f[r][0]*e[0],t[3*r+1]=f[r][1]*e[1],t[3*r+2]=f[r][2]*e[2];return new u.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:b}]],[["position",new Uint16Array(m)],["normal",new Uint16Array(g)]])}}(m||(m={})),function(e){e.createBoxGeometry=f.createGeometry,e.createDiamondGeometry=b.createGeometry,e.createTetrahedronGeometry=m.createGeometry,e.createSphereGeometry=function(e,t,r,i={uv:!0}){const n=-Math.PI,s=2*Math.PI,a=-Math.PI/2,o=Math.PI,l=Math.max(3,Math.floor(t)),c=Math.max(2,Math.floor(r)),d=(l+1)*(c+1),h=new Float32Array(3*d),p=new Float32Array(3*d),f=new Float32Array(2*d),b=[];let m=0;for(let u=0;u<=c;u++){const t=[],r=u/c,i=a+r*o,d=Math.cos(i);for(let a=0;a<=l;a++){const o=a/l,c=n+o*s,u=Math.cos(c)*d,b=Math.sin(i),g=-Math.sin(c)*d;h[3*m]=u*e,h[3*m+1]=b*e,h[3*m+2]=g*e,p[3*m]=u,p[3*m+1]=b,p[3*m+2]=g,f[2*m]=o,f[2*m+1]=r,t.push(m),++m}b.push(t)}const g=new Uint32Array(2*l*(c-1)*3);m=0;for(let u=0;u<c;u++)for(let e=0;e<l;e++){const t=b[u][e],r=b[u][e+1],i=b[u+1][e+1],n=b[u+1][e];0===u?(g[m++]=t,g[m++]=i,g[m++]=n):u===c-1?(g[m++]=t,g[m++]=r,g[m++]=i):(g[m++]=t,g[m++]=r,g[m++]=i,g[m++]=i,g[m++]=n,g[m++]=t)}const y=[["position",g],["normal",g]],v=[["position",{size:3,data:h,exclusive:!0}],["normal",{size:3,data:p,exclusive:!0}]];return i.uv&&(v.push(["uv0",{size:2,data:f,exclusive:!0}]),y.push(["uv0",g])),i.offset&&(y[0][0]="offset",v[0][0]="offset",y.push(["position",new Uint32Array(g.length)]),v.push(["position",{size:3,data:Float64Array.from(i.offset),exclusive:!0}])),new u.a(v,y)},e.createPolySphereGeometry=function(e,t,r){const i=e;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=i*(1+Math.sqrt(5))/2;n=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],s=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let u=0;u<n.length;u+=3)p.scale(n,u,e/p.length(n,u));let a={};function o(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(a[i])return a[i];let s=n.length;return n.length+=3,p.add(n,3*t,n,3*r,n,s),p.scale(n,s,e/p.length(n,s)),s/=3,a[i]=s,s}for(let u=0;u<t;u++){const e=s.length,t=new Uint32Array(4*e);for(let r=0;r<e;r+=3){const e=s[r],i=s[r+1],n=s[r+2],a=o(e,i),l=o(i,n),c=o(n,e),u=4*r;t[u]=e,t[u+1]=a,t[u+2]=c,t[u+3]=i,t[u+4]=l,t[u+5]=a,t[u+6]=n,t[u+7]=c,t[u+8]=l,t[u+9]=a,t[u+10]=l,t[u+11]=c}s=t,a={}}const l=new Float32Array(n);for(let u=0;u<l.length;u+=3)p.normalize(l,u);const c=[["position",s],["normal",s]],d=[["position",{size:3,data:new Float32Array(n),exclusive:!0}],["normal",{size:3,data:l,exclusive:!0}]];return new u.a(d,c)},e.createPointGeometry=function(e,t,r,i,n,s,a){const o=t?[t[0],t[1],t[2]]:[0,0,0],l=e?[e[0],e[1],e[2]]:[0,0,1];s=s||[0,0];const c=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],d=null!=i&&2===i.length?i:[1,1],h=[["position",{size:3,data:o,exclusive:!0}],["normal",{size:3,data:l,exclusive:!0}],["uv0",{size:s.length,data:s}],["color",{size:4,data:c,exclusive:!0}],["size",{size:2,data:d}]];if(null!=n){const e=new Float32Array([n[0],n[1],n[2],n[3]]);h.push(["auxpos1",{size:4,data:e}])}if(null!=a){const e=new Float32Array([a[0],a[1],a[2],a[3]]);h.push(["auxpos2",{size:4,data:e}])}return new u.a(h,null,1)},e.updatePointGeometry=function(e,t,r,i,n,s,a,o){if(null!=e){const{data:t}=o.getMutableAttribute("normal");t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=o.getMutableAttribute("position");e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=r){const{data:e}=o.getMutableAttribute("color");e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3]}if(null!=i){const{data:e}=o.getMutableAttribute("size");e[0]=i[0],e[1]=i[1]}if(null!=n){const{data:e}=o.getMutableAttribute("auxpos1");e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3]}if(null!=s){const{data:e}=o.getMutableAttribute("uv0");e[0]=s[0],e[1]=s[1]}if(null!=a){const{data:e}=o.getMutableAttribute("auxpos2");e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3]}},e.createPointArrayGeometry=function(e,t){const r=new Float32Array(3*e.length),i=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let a=0;a<e.length;a++)r[3*a]=e[a][0],r[3*a+1]=e[a][1],r[3*a+2]=e[a][2],t&&(i[3*a]=t[a][0],i[3*a+1]=t[a][1],i[3*a+2]=t[a][2]),n[a]=a,s[a]=0;return t||(i[0]=0,i[1]=1,i[2]=0),new u.a([["position",{size:3,data:r,exclusive:!0}],["normal",{size:3,data:i,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",n],["normal",t?n:s],["uv0",s]],1)},e.createTriangleGeometry=function(){const e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),r=new Uint16Array([0,0,0]);return new u.a([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",e],["normal",t],["uv0",r]])};const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function r(e,t,r,i,n){return!(Math.abs(Object(s.j)(t,e))>n)&&(Object(s.i)(r,e,t),Object(s.t)(r,r),Object(s.i)(i,r,e),Object(s.t)(i,i),!0)}function i(e,t,i,n,s,a,o){return r(e,t,s,a,o)||r(e,i,s,a,o)||r(e,n,s,a,o)}e.createSquareGeometry=function(e=t){const r=new Array(12);for(let t=0;t<4;t++)for(let i=0;i<3;i++)r[3*t+i]=e[t][i];const i=new Uint32Array([0,1,2,2,3,0]),n=new Uint32Array([0,0,0,0,0,0]);return new u.a([["position",{size:3,data:r,exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",i],["normal",n],["uv0",i],["color",n]])},e.createConeGeometry=function(e,t,r,i,n=!0,s=!0){let o=0;const l=t,c=e;let d=Object(a.d)(0,o,0),h=Object(a.d)(0,o+c,0),p=Object(a.d)(0,-1,0),f=Object(a.d)(0,1,0);i&&(o=c,h=Object(a.d)(0,0,0),d=Object(a.d)(0,o,0),p=Object(a.d)(0,1,0),f=Object(a.d)(0,-1,0));const b=[h,d],m=[p,f],g=r+2,y=Math.sqrt(c*c+l*l);if(i)for(let u=r-1;u>=0;u--){const e=u*(2*Math.PI/r),t=Object(a.d)(Math.cos(e)*l,o,Math.sin(e)*l);b.push(t);const i=Object(a.d)(c*Math.cos(e)/y,-l/y,c*Math.sin(e)/y);m.push(i)}else for(let u=0;u<r;u++){const e=u*(2*Math.PI/r),t=Object(a.d)(Math.cos(e)*l,o,Math.sin(e)*l);b.push(t);const i=Object(a.d)(c*Math.cos(e)/y,l/y,c*Math.sin(e)/y);m.push(i)}const v=new Uint32Array(2*(r+2)*3),O=new Uint32Array(2*(r+2)*3);let j=0,_=0;if(n){for(let e=3;e<b.length;e++)v[j++]=1,v[j++]=e-1,v[j++]=e,O[_++]=0,O[_++]=0,O[_++]=0;v[j++]=b.length-1,v[j++]=2,v[j++]=1,O[_++]=0,O[_++]=0,O[_++]=0}if(s){for(let e=3;e<b.length;e++)v[j++]=e,v[j++]=e-1,v[j++]=0,O[_++]=e,O[_++]=e-1,O[_++]=1;v[j++]=0,v[j++]=2,v[j++]=b.length-1,O[_++]=1,O[_++]=2,O[_++]=m.length-1}const w=new Float32Array(3*g);for(let a=0;a<g;a++)w[3*a]=b[a][0],w[3*a+1]=b[a][1],w[3*a+2]=b[a][2];const x=new Float32Array(3*g);for(let a=0;a<g;a++)x[3*a]=m[a][0],x[3*a+1]=m[a][1],x[3*a+2]=m[a][2];return new u.a([["position",{size:3,data:w,exclusive:!0}],["normal",{size:3,data:x,exclusive:!0}]],[["position",v],["normal",O]])},e.createCylinderGeometry=function(e,t,r,i,n,o){const l=i?Object(a.a)(i):Object(a.d)(1,0,0),c=n?Object(a.a)(n):Object(a.d)(0,0,0);o=null==o||o;const d=Object(a.c)();Object(s.t)(d,l);const h=Object(a.c)();Object(s.g)(h,d,Math.abs(e));const p=Object(a.c)();Object(s.g)(p,h,-.5),Object(s.h)(p,p,c);const f=Object(a.d)(0,1,0);Math.abs(1-Object(s.j)(d,f))<.2&&Object(s.y)(f,0,0,1);const b=Object(a.c)();Object(s.i)(b,d,f),Object(s.t)(b,b),Object(s.i)(f,b,d);const m=2*r+(o?2:0),g=r+(o?2:0),y=new Float32Array(3*m),v=new Float32Array(3*g),O=new Float32Array(2*m),j=new Uint32Array(3*r*(o?4:2)),_=new Uint32Array(3*r*(o?4:2));o&&(y[3*(m-2)+0]=p[0],y[3*(m-2)+1]=p[1],y[3*(m-2)+2]=p[2],O[2*(m-2)]=0,O[2*(m-2)+1]=0,y[3*(m-1)+0]=y[3*(m-2)+0]+h[0],y[3*(m-1)+1]=y[3*(m-2)+1]+h[1],y[3*(m-1)+2]=y[3*(m-2)+2]+h[2],O[2*(m-1)]=1,O[2*(m-1)+1]=1,v[3*(g-2)+0]=-d[0],v[3*(g-2)+1]=-d[1],v[3*(g-2)+2]=-d[2],v[3*(g-1)+0]=d[0],v[3*(g-1)+1]=d[1],v[3*(g-1)+2]=d[2]);const w=function(e,t,r){j[e]=t,_[e]=r};let x=0;const S=Object(a.c)(),T=Object(a.c)();for(let a=0;a<r;a++){const e=a*(2*Math.PI/r);Object(s.g)(S,f,Math.sin(e)),Object(s.g)(T,b,Math.cos(e)),Object(s.h)(S,S,T),v[3*a+0]=S[0],v[3*a+1]=S[1],v[3*a+2]=S[2],Object(s.g)(S,S,t),Object(s.h)(S,S,p),y[3*a+0]=S[0],y[3*a+1]=S[1],y[3*a+2]=S[2],O[2*a+0]=a/r,O[2*a+1]=0,y[3*(a+r)+0]=y[3*a+0]+h[0],y[3*(a+r)+1]=y[3*a+1]+h[1],y[3*(a+r)+2]=y[3*a+2]+h[2],O[2*(a+r)+0]=a/r,O[2*a+1]=1;const i=(a+1)%r;w(x++,a,a),w(x++,a+r,a),w(x++,i,i),w(x++,i,i),w(x++,a+r,a),w(x++,i+r,i)}if(o){for(let e=0;e<r;e++){const t=(e+1)%r;w(x++,m-2,g-2),w(x++,e,g-2),w(x++,t,g-2)}for(let e=0;e<r;e++){const t=(e+1)%r;w(x++,e+r,g-1),w(x++,m-1,g-1),w(x++,t+r,g-1)}}return new u.a([["position",{size:3,data:y,exclusive:!0}],["normal",{size:3,data:v,exclusive:!0}],["uv0",{size:2,data:O,exclusive:!0}]],[["position",j],["normal",_],["uv0",j]])},e.createTubeGeometry=function(t,r,i,n,s){i=i||10,n=null==n||n,Object(h.a)(t.length>1);const a=[],o=[];for(let e=0;e<i;e++){a.push([0,-e-1,-(e+1)%i-1]);const t=e/i*2*Math.PI;o.push([Math.cos(t)*r,Math.sin(t)*r])}return e.createPathExtrusionGeometry(o,t,[[0,0,0]],a,n,s)},e.createPathExtrusionGeometry=function(e,t,r,n,d,h=Object(a.d)(0,0,0)){const p=e.length,f=new Float32Array(t.length*p*3+(6*r.length||0)),b=new Float32Array(t.length*p*3+(r?6:0)),m=(t.length-1)*p*6+3*n.length*2,g=new Uint32Array(m),v=new Uint32Array(m);let O=0,j=0,_=0,w=0;const x=Object(a.c)(),S=Object(a.c)(),T=Object(a.c)(),C=Object(a.c)(),M=Object(a.c)(),P=Object(a.c)(),A=Object(a.c)(),E=Object(o.e)(),R=Object(a.c)(),I=Object(a.c)(),D=Object(a.c)(),F=Object(a.c)(),L=Object(a.c)(),k=Object(l.d)();Object(s.y)(R,0,1,0),Object(s.l)(S,t[1],t[0]),Object(s.t)(S,S),d?(Object(s.h)(E,t[0],h),Object(s.t)(T,E)):Object(s.y)(T,0,0,1),i(S,T,R,R,M,T,y),Object(s.m)(C,T),Object(s.m)(F,M);for(let i=0;i<r.length;i++)Object(s.g)(P,M,r[i][0]),Object(s.g)(E,T,r[i][2]),Object(s.h)(P,P,E),Object(s.h)(P,P,t[0]),f[O++]=P[0],f[O++]=P[1],f[O++]=P[2];b[j++]=-S[0],b[j++]=-S[1],b[j++]=-S[2];for(let i=0;i<n.length;i++)g[_++]=n[i][0]>0?n[i][0]:-n[i][0]-1+r.length,g[_++]=n[i][1]>0?n[i][1]:-n[i][1]-1+r.length,g[_++]=n[i][2]>0?n[i][2]:-n[i][2]-1+r.length,v[w++]=0,v[w++]=0,v[w++]=0;let z=r.length;const V=r.length-1;for(let a=0;a<t.length;a++){let r=!1;a>0&&(Object(s.m)(x,S),a<t.length-1?(Object(s.l)(S,t[a+1],t[a]),Object(s.t)(S,S)):r=!0,Object(s.h)(I,x,S),Object(s.t)(I,I),Object(s.h)(D,t[a-1],C),Object(l.h)(t[a],I,k),Object(l.m)(k,Object(c.g)(D,x),E)?(Object(s.l)(E,E,t[a]),Object(s.t)(T,E),Object(s.i)(M,I,T),Object(s.t)(M,M)):i(I,C,F,R,M,T,y),Object(s.m)(C,T),Object(s.m)(F,M)),d&&(Object(s.h)(E,t[a],h),Object(s.t)(L,E));for(let i=0;i<p;i++)if(Object(s.g)(P,M,e[i][0]),Object(s.g)(E,T,e[i][1]),Object(s.h)(P,P,E),Object(s.t)(A,P),b[j++]=A[0],b[j++]=A[1],b[j++]=A[2],Object(s.h)(P,P,t[a]),f[O++]=P[0],f[O++]=P[1],f[O++]=P[2],!r){const e=(i+1)%p;g[_++]=z+i,g[_++]=z+p+i,g[_++]=z+e,g[_++]=z+e,g[_++]=z+p+i,g[_++]=z+p+e;for(let t=0;t<6;t++)v[w++]=g[_-6+t]-V}z+=p}const N=t[t.length-1];for(let i=0;i<r.length;i++)Object(s.g)(P,M,r[i][0]),Object(s.g)(E,T,r[i][1]),Object(s.h)(P,P,E),Object(s.h)(P,P,N),f[O++]=P[0],f[O++]=P[1],f[O++]=P[2];const U=j/3;b[j++]=S[0],b[j++]=S[1],b[j++]=S[2];const B=z-p;for(let i=0;i<n.length;i++)g[_++]=n[i][0]>=0?z+n[i][0]:-n[i][0]-1+B,g[_++]=n[i][2]>=0?z+n[i][2]:-n[i][2]-1+B,g[_++]=n[i][1]>=0?z+n[i][1]:-n[i][1]-1+B,v[w++]=U,v[w++]=U,v[w++]=U;return new u.a([["position",{size:3,data:f,exclusive:!0}],["normal",{size:3,data:b,exclusive:!0}]],[["position",g],["normal",v]])},e.createPolylineGeometry=function(e,t,r){Object(h.a)(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(h.a)(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(h.a)(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(h.a)(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const i=new Float64Array(3*e.length),n=new Uint32Array(2*(e.length-1));let s=0,a=0;for(let c=0;c<e.length;c++){for(let t=0;t<3;t++)i[s++]=e[c][t];c>0&&(n[a++]=c-1,n[a++]=c)}const o=[],l=[];if(o.push(["position",n]),l.push(["position",{size:3,data:i,exclusive:!0}]),t){const r=new Float32Array(3*t.length);let i=0;for(let n=0;n<e.length;n++)for(let e=0;e<3;e++)r[i++]=t[n][e];o.push(["normal",n]),l.push(["normal",{size:3,data:r,exclusive:!0}])}return r&&(l.push(["color",{size:4,data:r}]),o.push(["color",Object(d.d)(r.length/4)])),new u.a(l,o,2)},e.createExtrudedTriangle=function(e,t,r,i,n=0){const s=new Array(18),a=[[-t,n,i/2],[r,n,i/2],[0,e+n,i/2],[-t,n,-i/2],[r,n,-i/2],[0,e+n,-i/2]],o=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let l=0;l<6;l++)s[3*l]=a[l][0],s[3*l+1]=a[l][1],s[3*l+2]=a[l][2];return new u.a([["position",{size:3,data:s,exclusive:!0}]],[["position",o]])},e.transformInPlace=function(e,t){const r=e.getMutableAttribute("position").data;for(let i=0;i<r.length;i+=3){const e=r[i],n=r[i+1],a=r[i+2];Object(s.y)(v,e,n,a),Object(s.s)(v,v,t),r[i]=v[0],r[i+1]=v[1],r[i+2]=v[2]}},e.cgToGIS=function(e,t=e){const r=e.vertexAttributes,i=r.get("position").data,n=r.get("normal").data;if(n){const e=t.getMutableAttribute("normal").data;for(let t=0;t<n.length;t+=3){const r=n[t+1];e[t+1]=-n[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute("position").data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}return t},e.makeOrthoBasisDirUp=r,e.makeOrthoBasisDirUpFallback=i}(g||(g={}));const y=.99619469809,v=Object(a.c)();var O=g;t.a=O},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return g}));var i=r(44),n=r(125);const s={year:"numeric",month:"numeric",day:"numeric"},a={year:"numeric",month:"long",day:"numeric"},o={year:"numeric",month:"short",day:"numeric"},l={year:"numeric",month:"long",weekday:"long",day:"numeric"},c={hour:"numeric",minute:"numeric"},u={...c,second:"numeric"},d={"short-date":s,"short-date-short-time":{...s,...c},"short-date-short-time-24":{...s,...c,hour12:!1},"short-date-long-time":{...s,...u},"short-date-long-time-24":{...s,...u,hour12:!1},"short-date-le":s,"short-date-le-short-time":{...s,...c},"short-date-le-short-time-24":{...s,...c,hour12:!1},"short-date-le-long-time":{...s,...u},"short-date-le-long-time-24":{...s,...u,hour12:!1},"long-month-day-year":a,"long-month-day-year-short-time":{...a,...c},"long-month-day-year-short-time-24":{...a,...c,hour12:!1},"long-month-day-year-long-time":{...a,...u},"long-month-day-year-long-time-24":{...a,...u,hour12:!1},"day-short-month-year":o,"day-short-month-year-short-time":{...o,...c},"day-short-month-year-short-time-24":{...o,...c,hour12:!1},"day-short-month-year-long-time":{...o,...u},"day-short-month-year-long-time-24":{...o,...u,hour12:!1},"long-date":l,"long-date-short-time":{...l,...c},"long-date-short-time-24":{...l,...c,hour12:!1},"long-date-long-time":{...l,...u},"long-date-long-time-24":{...l,...u,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":c,"long-time":u},h=Object(i.b)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),p=(h.apiValues,h.toJSON.bind(h),h.fromJSON.bind(h),{ar:"ar-u-nu-latn-ca-gregory"});let f=new WeakMap,b=d["short-date-short-time"];function m(e){return d[e]||null}function g(e,t){return function(e){const t=e||b;if(!f.has(t)){const e=Object(n.b)(),r=p[Object(n.b)()]||e;f.set(t,new Intl.DateTimeFormat(r,t))}return f.get(t)}(t).format(e)}Object(n.a)((()=>{f=new WeakMap,b=d["short-date-short-time"]}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u}));var i=r(2),n=r(3),s=r(5),a=r(53),o=r(28),l=r(131);function c(e,t,r,n){return Object(i.j)(e.renderCoordsHelper.fromRenderCoords(t.eye,f,n))&&Object(o.h)(r,f)}function u(e,t){return e.elevationProvider?Object(i.t)(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function d(e,t,r,i){const s=e.state.camera.clone();t&&(s.eye=t,s.center=r,s.up=i),function(e,t,r){let i=p[e.viewingMode];i||(i=new l.a(e.state.viewingMode),i.options.backfacesTerrain=!e.state.isGlobal,i.options.invisibleTerrain=!0,p[e.viewingMode]=i);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,i,r)||h(e,t.origin,r))||!(!e.renderCoordsHelper.intersectManifold(t,0,r)||h(e,t.origin,r))||!!s&&function(e,t,r){const i=Object(n.j)(e.origin,e.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return Object(n.g)(t,e.direction,s/Object(n.r)(e.direction)),Object(n.h)(t,t,e.origin),!0}(t,r,Object(a.e)(e.spatialReference).radius)}(e,s.ray,b)||Object(n.m)(b,s.center);const o=e.state.constraints,c=o.minimumPoiDistance;if(Object(n.n)(s.eye,b)<c){const t=o.collision.enabled;Object(n.m)(m,s.viewForward),Object(n.g)(m,m,c),t?s.eye=Object(n.l)(f,b,m):Object(n.h)(b,s.eye,m);const r=e.renderCoordsHelper,i=r.getAltitude(s.eye),a=o.collision.elevationMargin;t&&i<a&&(Object(n.l)(m,b,s.eye),s.eye=r.setAltitude(f,a,s.eye),Object(n.h)(b,s.eye,m))}return s.center=b,s}function h(e,t,r){if(!e.state.isGlobal)return!1;const i=u(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:a}=s.compute(t,r,e.dataExtent,i,g),o=a*a;return Object(n.n)(t,r)>o}const p={},f=Object(s.e)(),b=Object(s.e)(),m=Object(s.e)(),g={near:0,far:0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(69);function n(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:s(e[t])}}}function s(e){return function(t,...r){!function(e){const{type:t}=e;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}(t)?e.call(this,t,...r):Object(i.f)(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click())}}},function(e,t,r){"use strict";function i(e,t,r,i){return function(e){return"function"==typeof e}(e)?e(t,r,i):e}function n(e){return[e.r,e.g,e.b,e.a]}function s(e,t,r){const i=e=>{let t=e.length;for(;t--;)if(-1===" /-,\n".indexOf(e.charAt(t)))return!1;return!0},n=[];let s=0,o=-1;do{if(o=t.indexOf("[",s),o>=s){if(o>s){const e=t.substr(s,o-s);n.push([e,null,i(e)])}if(s=o+1,o=t.indexOf("]",s),o>=s){if(o>s){const r=e[t.substr(s,o-s)];r&&n.push([null,r,!1])}s=o+1}}}while(-1!==o);if(s<t.length-1){const e=t.substr(s);n.push([e,null,i(e)])}return e=>{let t="",i=null;for(const r of n){const[n,s,a]=r;if(n)a?i=n:(i&&(t+=i,i=null),t+=n);else{const r=e.attributes[s];r&&(i&&(t+=i,i=null),t+=r)}}return a(t,r)}}function a(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function o(e,t,r,i,n,s,a=!0){const o=t/n,l=r/s,c=Math.ceil(o/2),u=Math.ceil(l/2);for(let d=0;d<s;d++)for(let r=0;r<n;r++){const h=4*(r+(a?s-d-1:d)*n);let p=0,f=0,b=0,m=0,g=0,y=0,v=0;const O=(d+.5)*l;for(let i=Math.floor(d*l);i<(d+1)*l;i++){const n=Math.abs(O-(i+.5))/u,s=(r+.5)*o,a=n*n;for(let l=Math.floor(r*o);l<(r+1)*o;l++){let r=Math.abs(s-(l+.5))/c;const n=Math.sqrt(a+r*r);n>=-1&&n<=1&&(p=2*n*n*n-3*n*n+1,p>0&&(r=4*(l+i*t),v+=p*e[r+3],b+=p,e[r+3]<255&&(p=p*e[r+3]/250),m+=p*e[r],g+=p*e[r+1],y+=p*e[r+2],f+=p))}}i[h]=m/f,i[h+1]=g/f,i[h+2]=y/f,i[h+3]=v/b}}function l(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function c(e){var t;return null==(t=e.data)?void 0:t.symbol}function u(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function d(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function h(e){return"CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type}function p(e){return"CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type}r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return i})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return u})),r.d(t,"h",(function(){return p})),r.d(t,"i",(function(){return d})),r.d(t,"j",(function(){return o})),r.d(t,"k",(function(){return c}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return n})),r.d(t,"e",(function(){return a})),r.d(t,"f",(function(){return o})),r.d(t,"g",(function(){return l})),r.d(t,"h",(function(){return c}));var i=r(49);function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function s(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5];let l=r*s-i*n;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*o-s*a)*l,e[5]=(i*a-r*o)*l,e):null}function a(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=r[0],u=r[1],d=r[2],h=r[3],p=r[4],f=r[5];return e[0]=i*c+s*u,e[1]=n*c+a*u,e[2]=i*d+s*h,e[3]=n*d+a*h,e[4]=i*p+s*f+o,e[5]=n*p+a*f+l,e}function o(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=i*u+s*c,e[1]=n*u+a*c,e[2]=i*-c+s*u,e[3]=n*-c+a*u,e[4]=o,e[5]=l,e}function l(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i*c,e[1]=n*c,e[2]=s*u,e[3]=a*u,e[4]=o,e[5]=l,e}function c(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=i*c+s*u+o,e[5]=n*c+a*u+l,e}function u(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function d(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function h(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}const p=a,f=h;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:n,set:function(e,t,r,i,n,s,a){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e},invert:s,determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:a,rotate:o,scale:l,translate:c,fromRotation:u,fromScaling:d,fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},subtract:h,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){const r=e[0],n=e[1],s=e[2],a=e[3],o=e[4],l=e[5],c=t[0],u=t[1],d=t[2],h=t[3],p=t[4],f=t[5];return Math.abs(r-c)<=i.a*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=i.a*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-d)<=i.a*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-h)<=i.a*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-p)<=i.a*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-f)<=i.a*Math.max(1,Math.abs(l),Math.abs(f))},mul:p,sub:f})},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(4)),l=r(29),c=r(50),u=r(146),d=r(41),h=r(39),p=r(478),f=r(300);let b=i=class extends u.a{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let r,i,n=null,s=null;return e&&!Array.isArray(e)?(n=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),r=e.hasZ,i=e.hasM):n=e,n=n||[],t=t||h.a.WGS84,n.length&&n[0]&&null!=n[0][0]&&"number"==typeof n[0][0]&&(n=[n]),s=n[0]&&n[0][0],s&&(void 0===r&&void 0===i?(r=s.length>2,i=!1):void 0===r?r=!i&&s.length>3:void 0===i&&(i=!r&&s.length>3)),{paths:n,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=Object(p.c)(this);if(!t)return null;const r=new c.a(t);return r.spatialReference=e,r}writePaths(e,t){t.paths=Object(s.a)(this.paths)}addPath(e){if(!e)return;const t=this.paths,r=t.length;if(function(e){return!Array.isArray(e[0])}(e)){const i=[];for(let t=0,r=e.length;t<r;t++)i[t]=e[t].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new i;return e.spatialReference=this.spatialReference,e.paths=Object(s.a)(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.paths[e][t],i=this.hasZ,n=this.hasM;return i&&!n?new d.a(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new d.a(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new d.a(r[0],r[1],r[2],r[3],this.spatialReference):new d.a(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(Object(f.a)(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e].splice(t,0,r),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],r=this.spatialReference,i=t.map((e=>new d.a(e,r)));return this.notifyChange("paths"),i}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new d.a(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(e,t,r){return this._validateInputs(e,t)?(Object(f.a)(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e][t]=r,this.notifyChange("paths"),this):this}_validateInputs(e,t,r=!1){if(null==e||e<0||e>=this.paths.length)return!1;if(null!=t){const i=this.paths[e];if(r&&(t<0||t>i.length))return!1;if(!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write(null,e)}};Object(n.a)([Object(a.b)({readOnly:!0})],b.prototype,"cache",null),Object(n.a)([Object(a.b)({readOnly:!0})],b.prototype,"extent",null),Object(n.a)([Object(a.b)({type:[[[Number]]],json:{write:{isRequired:!0}}})],b.prototype,"paths",void 0),Object(n.a)([Object(l.a)("paths")],b.prototype,"writePaths",null),b=i=Object(n.a)([Object(o.a)("esri.geometry.Polyline")],b),b.prototype.toJSON.isDefaultToJSON=!0;var m=b;t.a=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.code.add(i.a`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return n}));var i=r(403);function n(e,t,r){if(e.count!==t.count)return void i.a.error("source and destination buffers need to have the same number of elements");const n=e.count,s=r[0],a=r[1],o=r[2],l=r[4],c=r[5],u=r[6],d=r[8],h=r[9],p=r[10],f=r[12],b=r[13],m=r[14],g=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,O=t.typedBufferStride;for(let i=0;i<n;i++){const e=i*y,t=i*O,r=v[t],n=v[t+1],j=v[t+2];g[e]=s*r+l*n+d*j+f,g[e+1]=a*r+c*n+h*j+b,g[e+2]=o*r+u*n+p*j+m}}function s(e,t,r){if(e.count!==t.count)return void i.a.error("source and destination buffers need to have the same number of elements");const n=e.count,s=r[0],a=r[1],o=r[2],l=r[3],c=r[4],u=r[5],d=r[6],h=r[7],p=r[8],f=e.typedBuffer,b=e.typedBufferStride,m=t.typedBuffer,g=t.typedBufferStride;for(let i=0;i<n;i++){const e=i*b,t=i*g,r=m[t],n=m[t+1],y=m[t+2];f[e]=s*r+l*n+d*y,f[e+1]=a*r+c*n+h*y,f[e+2]=o*r+u*n+p*y}}function a(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride;for(let l=0;l<i;l++){const e=l*s,t=l*o;n[e]=r*a[t],n[e+1]=r*a[t+1],n[e+2]=r*a[t+2]}}function o(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride;for(let o=0;o<r;o++){const e=o*n,t=o*a,r=s[t],l=s[t+1],c=s[t+2],u=Math.sqrt(r*r+l*l+c*c);if(u>0){const t=1/u;i[e]=t*r,i[e+1]=t*l,i[e+2]=t*c}}}function l(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride;for(let l=0;l<i;l++){const e=l*s,t=l*o;n[e]=a[t]>>r,n[e+1]=a[t+1]>>r,n[e+2]=a[t+2]>>r}}Object.freeze({__proto__:null,transformMat4:n,transformMat3:s,scale:a,normalize:o,shiftRight:l})},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return l}));var i=r(166),n=r(39),s=r(85);const a={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new i.a({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:n.a.WebMercator}),minus180Line:new i.a({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:n.a.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new i.a({paths:[[[180,-180],[180,180]]],spatialReference:n.a.WGS84}),minus180Line:new i.a({paths:[[[-180,-180],[-180,180]]],spatialReference:n.a.WGS84})}};function o(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const r=c(e);for(const i of r)for(const e of i)e[0]+=t;return e}function c(e){return Object(s.g)(e)?e.rings:e.paths}function u(e){const t=(null==e?void 0:e.isWebMercator)?102100:4326;return[a[t].minX,a[t].maxX]}},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(1),a=(r(8),r(9),r(7),r(4));let o=class extends n.a{constructor(e){super(e),this.type=null}};Object(i.a)([Object(s.b)({type:["attachments","custom","fields","media","text"],readOnly:!0,json:{read:!1,write:!0}})],o.prototype,"type",void 0),o=Object(i.a)([Object(a.a)("esri.popup.content.Content")],o);var l=o;t.a=l},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));let i=0;const n=0;function s(){return++i}},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return y})),r.d(t,"e",(function(){return _}));var i=r(2),n=r(52),s=r(83),a=r(16),o=r(20),l=r(182),c=r(185),u=r(3),d=r(58),h=r(5),p=r(31),f=r(55);class b{constructor(){this._transform=Object(o.d)(),this._transformInverse=new m({value:this._transform},a.a,o.d),this._transformInverseTranspose=new m(this._transformInverse,a.e,o.d),this._transformTranspose=new m({value:this._transform},a.e,o.d),this._transformInverseRotation=new m({value:this._transform},n.k,s.b)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Object(a.d)(this._transform,e)}multiplyTransform(e){Object(a.m)(this._transform,this._transform,e)}set(e){Object(a.d)(this._transform,e),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}class m{constructor(e,t,r){this.original=e,this.update=t,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}const g=new class{constructor(e=0){this.offset=e,this.sphere=Object(f.c)(),this.tmpVertex=Object(h.e)()}applyToVertex(e,t,r){const i=this.objectTransform.transform;let n=i[0]*e+i[4]*t+i[8]*r+i[12],s=i[1]*e+i[5]*t+i[9]*r+i[13],a=i[2]*e+i[6]*t+i[10]*r+i[14];const o=this.offset/Math.sqrt(n*n+s*s+a*a);n+=n*o,s+=s*o,a+=a*o;const l=this.objectTransform.inverse;return this.tmpVertex[0]=l[0]*n+l[4]*s+l[8]*a+l[12],this.tmpVertex[1]=l[1]*n+l[5]*s+l[9]*a+l[13],this.tmpVertex[2]=l[2]*n+l[6]*s+l[10]*a+l[14],this.tmpVertex}applyToMinMax(e,t){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/t;return this.sphere[0]=e[0]+e[0]*r,this.sphere[1]=e[1]+e[1]*r,this.sphere[2]=e[2]+e[2]*r,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function y(e){return Object(i.j)(e)?(g.offset=e,g):null}const v=new class{constructor(e=0){this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=Object(h.e)(),this.mbs=Object(p.e)(),this.obb={center:Object(h.e)(),halfSize:Object(d.c)(),quaternion:null}}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,r){const i=e,n=t,s=r+this.componentLocalOriginLength,a=this.offset/Math.sqrt(i*i+n*n+s*s);return this.tmpVertex[0]=e+i*a,this.tmpVertex[1]=t+n*a,this.tmpVertex[2]=r+s*a,this.tmpVertex}applyToAabb(e){const t=e[0],r=e[1],i=e[2]+this.componentLocalOriginLength,n=e[3],s=e[4],a=e[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(t*t+r*r+i*i);e[0]+=t*o,e[1]+=r*o,e[2]+=i*o;const l=this.offset/Math.sqrt(n*n+s*s+a*a);return e[3]+=n*l,e[4]+=s*l,e[5]+=a*l,e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/t;return this.mbs[0]=e[0]+e[0]*r,this.mbs[1]=e[1]+e[1]*r,this.mbs[2]=e[2]+e[2]*r,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}applyToObb(e){const t=e.center,r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*r,this.obb.center[1]=t[1]+t[1]*r,this.obb.center[2]=t[2]+t[2]*r,Object(u.w)(this.obb.halfSize,e.halfSize,e.quaternion),Object(u.h)(this.obb.halfSize,this.obb.halfSize,e.center);const i=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*i,this.obb.halfSize[1]+=this.obb.halfSize[1]*i,this.obb.halfSize[2]+=this.obb.halfSize[2]*i,Object(u.l)(this.obb.halfSize,this.obb.halfSize,e.center),Object(l.b)(x,e.quaternion),Object(u.w)(this.obb.halfSize,this.obb.halfSize,x),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}};function O(e){return Object(i.j)(e)?(v.offset=e,v):null}const j=new class{constructor(e=0){this.offset=e,this.tmpVertex=Object(h.e)()}applyToVertex(e,t,r){const i=e+this.localOrigin[0],n=t+this.localOrigin[1],s=r+this.localOrigin[2],a=this.offset/Math.sqrt(i*i+n*n+s*s);return this.tmpVertex[0]=e+i*a,this.tmpVertex[1]=t+n*a,this.tmpVertex[2]=r+s*a,this.tmpVertex}applyToAabb(e){const t=e[0]+this.localOrigin[0],r=e[1]+this.localOrigin[1],i=e[2]+this.localOrigin[2],n=e[3]+this.localOrigin[0],s=e[4]+this.localOrigin[1],a=e[5]+this.localOrigin[2],o=this.offset/Math.sqrt(t*t+r*r+i*i);e[0]+=t*o,e[1]+=r*o,e[2]+=i*o;const l=this.offset/Math.sqrt(n*n+s*s+a*a);return e[3]+=n*l,e[4]+=s*l,e[5]+=a*l,e}};function _(e){return Object(i.j)(e)?(j.offset=e,j):null}const w="terrain",x=Object(c.b)()},function(e,t,r){"use strict";var i=r(104);function n(e){e.length=0}class s{constructor(e=50,t=50){this._pool=new i.a(Array,void 0,n,t,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return a.acquire()}static release(e){return a.release(e)}static prune(){a.prune()}}const a=new s(100);t.a=s},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l}));var i=r(86),n=r(11),s=r(212),a=r(215),o=r(600);function l(e,t,r,i){const l=function(e,t,r){if(!e)return null;if(r&&"web-scene"===r.origin&&!(e instanceof s.a)&&!(e instanceof a.a)){const i="cim"!==e.type?Object(o.a)(e):{symbol:null,error:new n.a("symbol-conversion:unsupported-cim-symbol","CIM symbol is unsupported in web scenes",{symbol:e})};return i.symbol?i.symbol.write(t,r):(r.messages&&r.messages.push(new n.a("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:i.error})),null)}return r&&"web-map"===r.origin&&"web-style"===e.type?(r.messages&&r.messages.push(new n.a("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in webmaps. Use CIMSymbol instead when working with WebMap in MapView.`,{symbol:e,context:r})),null):e.write(t,r)}(e,{},i);l&&(t[r]=l)}function c(e,t){return Object(i.d)(e,null,t)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return m}));var i=r(2),n=r(20),s=r(5),a=r(36),o=r(22),l=r(224),c=r(191),u=r(51),d=r(91),h=r(149);const p=Object(s.e)();function f(e,t,r,s,l,c,d,f,b,m){const g=r?r.length:0,y=e.clippingExtent;if(Object(a.u)(t,p,e.elevationProvider.spatialReference),Object(i.j)(y)&&!Object(o.g)(y,p))return null;const v=e.renderCoordsHelper.spatialReference;Object(a.u)(t,p,v);const O=e.localOriginFactory.getOrigin(p),j=new h.a({castShadow:!1,metadata:{layerUid:f,graphicUid:b,usesVerticalDistanceToGround:!0}});for(let i=0;i<g;i++){const e=l?l[i]:n.a;j.addGeometry(r[i],s[i],e,c,O,m)}return{object:j,sampledElevation:Object(u.b)(j,t,e.elevationProvider,e.renderCoordsHelper,d)}}function b(e,t,r){const i=e.elevationContext,n=r.spatialReference;Object(a.u)(t,p,n),i.centerPointInElevationSR=Object(c.j)(p[0],p[1],t.hasZ?p[2]:0,n)}function m(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(d.a)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const r=Object(l.d)(t,Object(l.c)(t)/2);return Object(c.j)(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return o})),r.d(t,"g",(function(){return d})),r.d(t,"h",(function(){return u})),r.d(t,"i",(function(){return h})),r.d(t,"j",(function(){return f})),r.d(t,"k",(function(){return p}));r(93);var i=r(47);function n(e,t,r="nearest",n=!1){var s;const a=!(n&&"u8"===t.pixelType),o=a?5126:5121,l=null==t.pixels||0===t.pixels.length?null:a?t.getAsRGBAFloat():t.getAsRGBA(),c=null==(s=e.capabilities.textureFloat)?void 0:s.textureFloatLinear,u={width:t.width,height:t.height,target:3553,pixelFormat:6408,internalFormat:"webgl2"===e.webglVersion&&a?34836:6408,samplingMode:!c||"bilinear"!==r&&"cubic"!==r?9728:9729,dataType:o,wrapMode:33071,flipped:!1};return new i.a(e,u,l)}function s(e,t){const r=4*t.size[0],n=t.size[1],s={width:r,height:n,target:3553,pixelFormat:6408,internalFormat:"webgl2"===e.webglVersion?34836:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1},a=new Float32Array(r*n*4);let o=0;for(let i=0;i<t.coefficients.length;i++)a[o++]=t.coefficients[i],i%3==2&&(a[o++]=1);return new i.a(e,s,a)}function a(e,t){const r={width:t.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1};return new i.a(e,r,t)}function o(e,t,r,i=1,n=!0,s=!1){return{u_flipY:n,u_isFloatTexture:s,u_applyTransform:!!e,u_opacity:i,u_transformSpacing:e?e.spacing:null,u_transformGridSize:e?e.size:null,u_targetImageSize:t,u_srcImageSize:r}}function l(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:null}}function c(e,t){return{u_scale:e,u_offset:t}}function u(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function d(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function h(e,t){const r=e.gl,i=t.glName,n=r.getProgramParameter(i,r.ACTIVE_UNIFORMS),s=new Map;let a;for(let o=0;o<n;o++)a=r.getActiveUniform(i,o),a&&s.set(a.name,{location:r.getUniformLocation(i,a.name),info:a});return s}function p(e,t,r){Object.keys(r).forEach((i=>{const n=t.get(i)||t.get(i+"[0]");n&&function(e,t,r,i){if(null===i||null==r)return!1;const{info:n}=i;switch(n.type){case 5126:n.size>1?e.setUniform1fv(t,r):e.setUniform1f(t,r);break;case 35664:e.setUniform2fv(t,r);break;case 35665:e.setUniform3fv(t,r);break;case 35666:e.setUniform4fv(t,r);break;case 35675:e.setUniformMatrix3fv(t,r);break;case 35676:e.setUniformMatrix4fv(t,r);break;case 5124:n.size>1?e.setUniform1iv(t,r):e.setUniform1i(t,r);break;case 35670:e.setUniform1i(t,r?1:0);break;case 35667:case 35671:e.setUniform2iv(t,r);break;case 35668:case 35672:e.setUniform3iv(t,r);break;case 35669:case 35673:e.setUniform4iv(t,r);break;default:return!1}}(e,i,r[i],n)}))}function f(e,t,r,i){r.length===i.length&&(i.some((e=>null==e))||r.some((e=>null==e))||r.forEach(((r,n)=>{t.setUniform1i(r,n),e.bindTexture(i[n],n)})))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return j})),r.d(t,"h",(function(){return m})),r.d(t,"i",(function(){return g})),r.d(t,"j",(function(){return u})),r.d(t,"k",(function(){return b})),r.d(t,"l",(function(){return v})),r.d(t,"m",(function(){return c})),r.d(t,"n",(function(){return h}));var i=r(221),n=r(50),s=r(39),a=r(115),o=r(579),l=r(200);const c={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},u={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},d={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},h={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:a.f}}},p={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},f={value:null,type:o.a,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function b(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const m={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0},"portal-item":{write:!0}}}},g={...m,json:{...m.json,origins:{"web-document":{...m.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?Object(l.b)(t.layerDefinition.drawingInfo.transparency):void 0:Object(l.b)(t.drawingInfo.transparency)}}},y={type:i.a,readOnly:!0,get(){var e,t;if(null==(e=this.layer)||!e.timeInfo)return null;const r=null==(t=this.view)?void 0:t.timeExtent,i=this.layer.timeExtent,n=this.layer.useViewTime?r&&i?r.intersection(i):r||i:i;if(!n||n.isEmpty)return n;const s=this.layer.timeOffset,a=s?n.offset(-s.value,s.unit):n,o=this._get("timeExtent");return a.equals(o)?o:a}},v={type:n.a,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const r=n.a.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(r.spatialReference=s.a.fromJSON(t.spatialReference)),r}}}},read:!1}},O={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},j={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},_={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c}));var i=r(0),n=r(19),s=r(42),a=r(1),o=r(4),l=r(229);const c=e=>{let t=class extends e{destroy(){this.destroyed||(this.handles.destroy(),this.updatingHandles.destroy())}get handles(){return this._get("handles")||new s.a}get updatingHandles(){return this._get("updatingHandles")||new l.a}};return Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"handles",null),Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"updatingHandles",null),t=Object(i.a)([Object(o.a)("esri.core.HandleOwner")],t),t};let u=class extends(c(n.a)){};u=Object(i.a)([Object(o.a)("esri.core.HandleOwner")],u)},function(e,t,r){"use strict";var i=r(0),n=r(44),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(4)),l=r(664);const c=new n.a({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary"},{ignoreUnknown:!0});let u=class extends s.a{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};Object(i.a)([Object(a.b)({type:l.a,json:{write:!0}})],u.prototype,"authoringInfo",void 0),Object(i.a)([Object(a.b)({type:c.apiValues,readOnly:!0,json:{type:c.jsonValues,read:!1,write:{writer:c.write,ignoreOrigin:!0}}})],u.prototype,"type",void 0),u=Object(i.a)([Object(o.a)("esri.renderers.Renderer")],u);var d=u;t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));var i=r(2);function n(e){return s((()=>e.forEach((e=>Object(i.j)(e)&&e.remove()))))}function s(e){return{remove:()=>{e&&(e(),e=void 0)}}}function a(e,t){const r=setTimeout(e,t);return s((()=>clearTimeout(r)))}},function(e,t,r){"use strict";var i=r(494);class n extends i.a{constructor(e,t,r){if(super(e,t,r),!(this instanceof n))return new n(e,t,r)}}n.prototype.type="warning",t.a=n},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return M})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return A})),r.d(t,"h",(function(){return c}));var i=r(83),n=r(185),s=r(5),a=r(49),o=r(3),l=r(40);function c(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function u(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>a.a?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function d(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+a*o+n*c-s*l,e[1]=n*u+a*l+s*o-i*c,e[2]=s*u+a*c+i*l-n*o,e[3]=a*u-i*o-n*l-s*c,e}function h(e,t,r,i){const n=t[0],s=t[1],o=t[2],l=t[3];let c,u,d,h,p,f=r[0],b=r[1],m=r[2],g=r[3];return u=n*f+s*b+o*m+l*g,u<0&&(u=-u,f=-f,b=-b,m=-m,g=-g),1-u>a.a?(c=Math.acos(u),d=Math.sin(c),h=Math.sin((1-i)*c)/d,p=Math.sin(i*c)/d):(h=1-i,p=i),e[0]=h*n+p*f,e[1]=h*s+p*b,e[2]=h*o+p*m,e[3]=h*l+p*g,e}function p(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function f(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*n+n]-t[3*s+s]+1),e[r]=.5*i,i=.5/i,e[3]=(t[3*n+s]-t[3*s+n])*i,e[n]=(t[3*n+r]+t[3*r+n])*i,e[s]=(t[3*s+r]+t[3*r+s])*i}return e}function b(e,t,r,i){const n=.5*Math.PI/180;t*=n,r*=n,i*=n;const s=Math.sin(t),a=Math.cos(t),o=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=s*l*u-a*o*c,e[1]=a*o*u+s*l*c,e[2]=a*l*c-s*o*u,e[3]=a*l*u+s*o*c,e}const m=l.c,g=l.l,y=l.a,v=d,O=l.b,j=l.d,_=l.j,w=l.e,x=w,S=l.f,T=S,C=l.k,M=l.g,P=l.h;function A(e,t,r){const i=Object(o.j)(t,r);return i<-.999999?(Object(o.i)(E,R,t),Object(o.A)(E)<1e-6&&Object(o.i)(E,I,t),Object(o.t)(E,E),c(e,E,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Object(o.i)(E,t,r),e[0]=E[0],e[1]=E[1],e[2]=E[2],e[3]=1+i,C(e,e))}const E=Object(s.e)(),R=Object(s.g)(1,0,0),I=Object(s.g)(0,1,0);const D=Object(n.b)(),F=Object(n.b)();const L=Object(i.b)();Object.freeze({__proto__:null,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:c,getAxisAngle:u,multiply:d,rotateX:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*o,e[1]=n*l+s*o,e[2]=s*l-n*o,e[3]=a*l-i*o,e},rotateY:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*o,e[1]=n*l+a*o,e[2]=s*l+i*o,e[3]=a*l-n*o,e},rotateZ:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*o,e[1]=n*l-i*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e},calculateW:function(e,t){const r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},slerp:h,random:function(e){const t=Object(a.b)(),r=Object(a.b)(),i=Object(a.b)(),n=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=s*Math.sin(2*Math.PI*i),e[3]=s*Math.cos(2*Math.PI*i),e},invert:function(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s,o=a?1/a:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=s*o,e},conjugate:p,fromMat3:f,fromEuler:b,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},copy:m,set:g,add:y,mul:v,scale:O,dot:j,lerp:_,length:w,len:x,squaredLength:S,sqrLen:T,normalize:C,exactEquals:M,equals:P,rotationTo:A,sqlerp:function(e,t,r,i,n,s){return h(D,t,n,s),h(F,r,i,s),h(e,D,F,2*s*(1-s)),e},setAxes:function(e,t,r,i){const n=L;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],C(e,f(e,n))}})},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.code.add(i.a`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},function(e,t,r){"use strict";var i=r(106);class n extends i.a{constructor(e){super(),this._material=e.material,this._techniqueRep=e.techniqueRep,this._output=e.output}get technique(){return this._technique}getPipelineState(e,t){return this.technique.pipeline}ensureResources(e){return 2}ensureParameters(e){}}t.a=n},function(e,t,r){"use strict";function i(){return[0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3]]}function s(e,t){return new Float64Array(e,t,4)}r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return s}));const a=[0,0,0,1];Object.freeze({__proto__:null,create:i,clone:n,fromValues:function(e,t,r,i){return[e,t,r,i]},createView:s,IDENTITY:a})},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return a}));var i=r(6);function n(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(i.a`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),e.vertex.code.add(i.a`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.vvInstancingEnabled?i.a`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):e.vertex.code.add(i.a`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(i.a`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.vvInstancingEnabled?i.a`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):e.vertex.code.add(i.a`vec4 vvColor() { return vec4(1.0); }`)}function s(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function a(e,t){s(e,t),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}function o(e,t){s(e,t),t.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix))}},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(2),o=r(1),l=(r(8),r(9),r(7),r(4)),c=r(116);let u=i=class extends s.a{constructor(){super(...arguments),this.color=null}clone(){return new i({color:Object(a.j)(this.color)?this.color.clone():null})}};Object(n.a)([Object(o.b)(c.a)],u.prototype,"color",void 0),u=i=Object(n.a)([Object(l.a)("esri.symbols.support.Symbol3DMaterial")],u);var d=u;t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return p}));var i=r(2),n=r(16),s=r(20),a=r(3),o=r(5),l=r(36),c=r(51),u=r(91),d=r(70),h=r(148);function p(e,t,r,i){const n=e.stageObject,s=r.spatialReference,a=n.geometryRecords,o=a.length,u="absolute-height"!==t.mode;let p=0;for(let f=0;f<o;f++){const e=a[f].geometry,o=a[f].getShaderTransformation();v[0]=o[12],v[1]=o[13],v[2]=o[14],e.invalidateBoundingInfo();const b=e.getMutableAttribute("position"),m=b.data,j=e.vertexAttributes.get("mapPos").data,_=b.size,x=m.length/_,S=new h.a(j,s);let T=0,C=!1,M=0;for(let n=0;n<x;n++){O[0]=m[T],O[1]=m[T+1],O[2]=m[T+2];const e=Object(c.e)(S,r,t,i,u?w:null);if(u&&(M+=w.sampledElevation),d.a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(m[T]=S.array[S.offset],m[T+1]=S.array[S.offset+1],m[T+2]=e,Object(l.q)(m,s,T,m,i.spatialReference,T,1),m[T]-=v[0],m[T+1]-=v[1],m[T+2]-=v[2]):(y[0]=m[T]+v[0],y[1]=m[T+1]+v[1],y[2]=m[T+2]+v[2],i.setAltitude(y,e),m[T]=y[0]-v[0],m[T+1]=y[1]-v[1],m[T+2]=y[2]-v[2]),d.a.TESTS_DISABLE_UPDATE_THRESHOLDS)C=!0;else{const e=g/i.unitInMeters;(Math.abs(O[0]-m[T])>=e||Math.abs(O[1]-m[T+1])>=e||Math.abs(O[2]-m[T+2])>=e)&&(C=!0)}T+=_,S.offset+=3}p+=M/x,C&&n.geometryVertexAttrsUpdated(f)}return p/o}function f(e,t,r,i){const s=e.stageObject,o=t.centerPointInElevationSR;let h=0,p=0;if(s.metadata.usesVerticalDistanceToGround)h=Object(c.e)(o,r,t,i,w),Object(u.j)(s,w.verticalDistanceToGround),p=w.sampledElevation;else{const e="absolute-height"!==t.mode;h=Object(c.e)(o,r,t,i,e?w:null),e&&(p=w.sampledElevation)}const f=Object(n.d)(b,s.transformation),m=Object(a.y)(_,f[12],f[13],f[14]);d.a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(y[0]=o.x,y[1]=o.y,y[2]=h,Object(l.d)(o.spatialReference,y,f,i.spatialReference)&&(s.transformation=f)):i.setAltitudeOfTransformation(h,f);const v=g/i.unitInMeters;return(Math.abs(f[12]-m[0])>=v||Math.abs(f[13]-m[1])>=v||Math.abs(f[14]-m[2])>=v)&&(s.transformation=f),p}const b=Object(s.d)();function m(e,t,r,n){const s=e.graphics3DSymbolLayer.lodRenderer;if(Object(i.i)(s))return 0;const o=t.centerPointInElevationSR;let u=0,h=0;const p="absolute-height"!==t.mode;u=Object(c.e)(o,r,t,n,p?w:null),p&&(h=w.sampledElevation);const f=s.instanceData,b=e.instanceIndex,m=j;f.getGlobalTransform(b,m);const v=Object(a.y)(_,m[12],m[13],m[14]);d.a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(y[0]=o.x,y[1]=o.y,y[2]=u,Object(l.d)(o.spatialReference,y,m,n.spatialReference)&&f.setGlobalTransform(b,m)):n.setAltitudeOfTransformation(u,m);const O=g/n.unitInMeters;return(d.a.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(m[12]-v[0])>=O||Math.abs(m[13]-v[1])>=O||Math.abs(m[14]-v[2])>=O)&&f.setGlobalTransform(b,m),h}const g=.01,y=Object(o.e)(),v=Object(o.e)(),O=Object(o.e)(),j=Object(s.d)(),_=Object(o.e)(),w={verticalDistanceToGround:0,sampledElevation:0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a}));var i=r(101);function n(e,t){const r="?"===e[e.length-1]?e.slice(0,-1):e;if(null!=t.getItemAt||Array.isArray(t)){const e=parseInt(r,10);if(!isNaN(e))return Array.isArray(t)?t[e]:t.getItemAt(e)}const n=Object(i.a)(t);return Object(i.b)(n,r)?n.get(r):t[r]}function s(e,t,r){if(null==e)return e;const i=n(t[r],e);return!i&&r<t.length-1?void 0:r===t.length-1?i:s(i,t,r+1)}function a(e,t,r=0){return"string"==typeof t&&-1===t.indexOf(".")?n(t,e):s(e,Object(i.f)(t),r)}function o(e,t){return a(e,t)}function l(e,t){return void 0!==a(t,e)}},function(e,t,r){"use strict";var i,n=r(0),s=r(7),a=r(2),o=r(25),l=r(1),c=(r(8),r(9),r(37)),u=r(4),d=r(147),h=r(285),p=r(480),f=r(116),b=r(554),m=r(187),g=r(429);const y=s.a.getLogger("esri.symbols.IconSymbol3DLayer");let v=i=class extends d.a{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new i({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:Object(a.j)(this.material)?this.material.clone():null,outline:Object(a.j)(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||h.c,r=O(e),n=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||h.c).clone()}:null;return new i({size:e.size,resource:{primitive:w(e.style)},material:{color:t},outline:n,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(e){const t=!e.color||Object(h.a)(e.color)?h.c:e.color,r=O(e);return new i({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new i({resource:{href:Object(o.B)({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function O(e){const t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,i=j(e.xoffset),n=j(e.yoffset);return(i||n)&&t&&r?{x:-i/t,y:n/r}:null}function j(e){return isFinite(e)?e:0}Object(n.a)([Object(l.b)({type:m.a,json:{write:!0}})],v.prototype,"material",void 0),Object(n.a)([Object(l.b)({type:p.a,json:{write:!0}})],v.prototype,"resource",void 0),Object(n.a)([Object(c.a)({Icon:"icon"},{readOnly:!0})],v.prototype,"type",void 0),Object(n.a)([Object(l.b)(f.b)],v.prototype,"size",void 0),Object(n.a)([Object(c.a)({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),Object(l.b)({json:{default:"center"}})],v.prototype,"anchor",void 0),Object(n.a)([Object(l.b)({type:b.a,json:{type:[Number],read:{reader:e=>new b.a({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],v.prototype,"anchorPosition",void 0),Object(n.a)([Object(l.b)({type:g.a,json:{write:!0}})],v.prototype,"outline",void 0),v=i=Object(n.a)([Object(u.a)("esri.symbols.IconSymbol3DLayer")],v);const _={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function w(e){return _[e]||(y.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}var x=v;t.a=x},function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return m})),r.d(t,"g",(function(){return x})),r.d(t,"h",(function(){return f})),r.d(t,"i",(function(){return j})),r.d(t,"j",(function(){return y})),r.d(t,"k",(function(){return O}));var i=r(457),n=(r(8),r(2)),s=r(81),a=r(171),o=r(39),l=r(22),c=r(28),u=r(280),d=r(230),h=r(304);r(578);class p{constructor(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function f(e){return Object(n.j)(e.geometry)}class b{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function m(e){const t=d.a.fromJSON(e.geometryType),r=o.a.fromJSON(e.spatialReference),i=e.transform,s=e.features.map((s=>{const o=function(e,t,r,i){return{uid:Object(a.b)(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:g(e.geometry,t,r),visible:!0}}(s,t,r,e.objectIdFieldName),l=o.geometry;if(Object(n.j)(l)&&i)switch(l.type){case"point":o.geometry=Object(u.c)(i,l,l,l.hasZ,l.hasM);break;case"multipoint":o.geometry=Object(u.b)(i,l,l,l.hasZ,l.hasM);break;case"polygon":o.geometry=Object(u.d)(i,l,l,l.hasZ,l.hasM);break;case"polyline":o.geometry=Object(u.e)(i,l,l,l.hasZ,l.hasM);break;case"extent":case"mesh":o.geometry=l}return o}));return{geometryType:t,features:s,spatialReference:r,fields:e.fields?e.fields.map((e=>h.a.fromJSON(e))):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function g(e,t,r){if(!e)return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:r}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:r}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:r}}}}function y(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}}function v(e){let t=32;return t+=Object(i.a)(e.attributes),t+=3,t+=8+function(e){if(Object(n.i)(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),n="polyline"===e.type?e.paths:e.rings;for(const e of n)r+=e.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32*(n.length+1);break}case"multipoint":{const r=2+(e.hasZ?1:0)+(e.hasM?1:0),i=e.points.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=Object(s.a)(e.vertexAttributes.position),t+=Object(s.a)(e.vertexAttributes.normal),t+=Object(s.a)(e.vertexAttributes.uv),t+=Object(s.a)(e.vertexAttributes.tangent)}return t}(e.geometry),t}function O(e){if(Object(n.i)(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function j(e){if(Object(n.i)(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function _(e,t){switch(Object(l.k)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)Object(l.o)(t,e.paths[r],e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)Object(l.o)(t,e.rings[r],e.hasZ);break;case"multipoint":Object(l.o)(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function w(e,t){switch(Object(c.m)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)Object(c.q)(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)Object(c.q)(t,e.rings[r]);break;case"multipoint":Object(c.q)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function x(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(l.h)(),Object(c.k)()},function(e,t,r){"use strict";function i(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,r,i){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function a(){return i()}function o(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function u(){return s(0,0,1,0)}function d(){return s(0,0,0,1)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return s}));const h=a(),p=o(),f=l(),b=c(),m=u(),g=d();Object.freeze({__proto__:null,create:i,clone:n,fromValues:s,createView:function(e,t){return new Float32Array(e,t,4)},zeros:a,ones:o,unitX:l,unitY:c,unitZ:u,unitW:d,ZEROS:h,ONES:p,UNIT_X:f,UNIT_Y:b,UNIT_Z:m,UNIT_W:g})},function(e,t,r){"use strict";r.d(t,"a",(function(){return A}));var i=r(120),n=r(11),s=r(68),a=r(10),o=r(2),l=r(12),c=r(81),u=r(25),d=r(142),h=r(499),p=r(423),f=r(236),b=r(7),m=r(47);const g=b.a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),y=542327876,v=131072;function O(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const j=O("DXT1"),_=O("DXT3"),w=O("DXT5");function x(e,t,r){const{textureData:i,internalFormat:n,width:s,height:o}=function(e,t){const r=new Int32Array(e,0,31);if(r[0]!==y)return g.error("Invalid magic number in DDS header"),null;if(!(4&r[20]))return g.error("Unsupported format, must contain a FourCC code"),null;const i=r[21];let n,s;switch(i){case j:n=8,s=33776;break;case _:n=16,s=33778;break;case w:n=16,s=33779;break;default:return g.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(i)),null}let o=1,l=r[4],c=r[3];0==(3&l)&&0==(3&c)||(g.warn("Rounding up compressed texture size to nearest multiple of 4."),l=l+3&-4,c=c+3&-4);const u=l,d=c;let h,p;r[2]&v&&!1!==t&&(o=Math.max(1,r[7])),1===o||Object(a.l)(l)&&Object(a.l)(c)||(g.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let f=r[1]+4;const b=[];for(let a=0;a<o;++a)p=(l+3>>2)*(c+3>>2)*n,h=new Uint8Array(e,f,p),b.push(h),f+=p,l=Math.max(1,l>>1),c=Math.max(1,c>>1);return{textureData:{type:"compressed",levels:b},internalFormat:s,width:u,height:d}}(r,t.hasMipmap);return t.samplingMode=i.levels.length>1?9987:9729,t.hasMipmap=i.levels.length>1,t.internalFormat=n,t.width=s,t.height=o,new m.a(e,t,i)}var S=r(111),T=r(33),C=r(93),M=r(78),P=r(143);class A extends f.a{constructor(e,t){super(),this.data=e,this.type=4,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new s.a,this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=A.estimateTexMemRequired(this.data,this.params),this.startPreload()}startPreload(){const e=this.data;Object(o.i)(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))}startPreloadVideoElement(e){Object(u.t)(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}startPreloadImageElement(e){Object(u.u)(e.src)||Object(u.t)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static estimateTexMemRequired(e,t){if(Object(o.i)(e))return 0;if(Object(c.c)(e)||Object(c.k)(e))return t.encoding===A.KTX2_ENCODING?Object(p.d)(e,t.mipmap):t.encoding===A.BASIS_ENCODING?Object(p.c)(e,t.mipmap):e.byteLength;const{width:r,height:i}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?A.getDataDimensions(e):t;return(t.mipmap?4/3:1)*r*i*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}createDescriptor(e){var t;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}load(e,t){if(Object(o.j)(this.glTexture))return this.glTexture;if(Object(o.j)(this.loadingPromise))return this.loadingPromise;const r=this.data;return Object(o.i)(r)?(this.glTexture=new m.a(e,this.createDescriptor(e),null),this.glTexture):"string"==typeof r?this.loadFromURL(e,t,r):r instanceof Image?this.loadFromImageElement(e,t,r):r instanceof HTMLVideoElement?this.loadFromVideoElement(e,t,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this.loadFromImage(e,r,t):(Object(c.c)(r)||Object(c.k)(r))&&this.params.encoding===A.DDS_ENCODING?this.loadFromDDSData(e,r):(Object(c.c)(r)||Object(c.k)(r))&&this.params.encoding===A.KTX2_ENCODING?this.loadFromKTX2(e,r):(Object(c.c)(r)||Object(c.k)(r))&&this.params.encoding===A.BASIS_ENCODING?this.loadFromBasis(e,r):Object(c.k)(r)?this.loadFromPixelData(e,r):Object(c.c)(r)?this.loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,r){if(!(this.data instanceof HTMLVideoElement)||Object(o.i)(this.glTexture))return r;if(this.data.readyState<2||r===this.data.currentTime)return r;if(Object(o.j)(this.powerOfTwoStretchInfo)){const{framebuffer:r,vao:i,sourceTexture:n}=this.powerOfTwoStretchInfo;n.setData(this.data),this.drawStretchedTexture(e,t,r,i,n,this.glTexture)}else{const{width:e,height:t}=this.data,{width:r,height:i}=this.glTexture.descriptor;e!==r||t!==i?this.glTexture.updateData(0,0,0,Math.min(e,r),Math.min(t,i),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime}loadFromDDSData(e,t){return this.glTexture=x(e,this.createDescriptor(e),t),this.glTexture}loadFromKTX2(e,t){return this.loadAsync((()=>Object(p.b)(e,this.createDescriptor(e),t).then((e=>(this.glTexture=e,e)))))}loadFromBasis(e,t){return this.loadAsync((()=>Object(p.a)(e,this.createDescriptor(e),t).then((e=>(this.glTexture=e,e)))))}loadFromPixelData(e,t){Object(T.a)(this.params.width>0&&this.params.height>0);const r=this.createDescriptor(e);return r.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,r.width=this.params.width,r.height=this.params.height,this.glTexture=new m.a(e,r,t),this.glTexture}loadAsync(e){const t=Object(l.e)();this.loadingController=t;const r=e(t.signal);this.loadingPromise=r;const i=()=>{this.loadingController===t&&(this.loadingController=null),this.loadingPromise===r&&(this.loadingPromise=null)};return r.then(i,i),r}loadFromURL(e,t,r){return this.loadAsync((async i=>{const n=await Object(d.a)(r,{signal:i});return this.loadFromImage(e,n,t)}))}loadFromImageElement(e,t,r){return r.complete?this.loadFromImage(e,r,t):this.loadAsync((async i=>{const n=await Object(h.a)(r,r.src,!1,i);return this.loadFromImage(e,n,t)}))}loadFromVideoElement(e,t,r){return r.readyState>=2?this.loadFromImage(e,r,t):this.loadFromVideoElementAsync(e,t,r)}loadFromVideoElementAsync(e,t,r){return this.loadAsync((i=>new Promise(((s,a)=>{const c=()=>{r.removeEventListener("loadeddata",u),r.removeEventListener("error",d),Object(o.j)(h)&&h.remove()},u=()=>{r.readyState>=2&&(c(),s(this.loadFromImage(e,r,t)))},d=e=>{c(),a(e||new n.a("Failed to load video"))};r.addEventListener("loadeddata",u),r.addEventListener("error",d);const h=Object(l.s)(i,(()=>d(Object(l.f)())))}))))}loadFromImage(e,t,r){const i=A.getDataDimensions(t);this.params.width=i.width,this.params.height=i.height;const n=this.createDescriptor(e);return n.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(e,n)||Object(a.l)(i.width)&&Object(a.l)(i.height)?(n.width=i.width,n.height=i.height,this.glTexture=new m.a(e,n,t),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(e,t,i,n,r),this.glTexture)}requiresPowerOfTwo(e,t){const r=33071,i="number"==typeof t.wrapMode?t.wrapMode===r:t.wrapMode.s===r&&t.wrapMode.t===r;return!Object(P.a)(e.gl)&&(t.hasMipmap||!i)}makePowerOfTwoTexture(e,t,r,n,s){const{width:o,height:l}=r,c=Object(a.p)(o),u=Object(a.p)(l);let d;switch(n.width=c,n.height=u,this.params.powerOfTwoResizeMode){case 2:n.textureCoordinateScaleFactor=[o/c,l/u],d=new m.a(e,n),d.updateData(0,0,0,o,l,t);break;case 1:case null:case void 0:d=this.stretchToPowerOfTwo(e,t,n,s);break;default:Object(i.a)(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&d.generateMipmap(),d}stretchToPowerOfTwo(e,t,r,i){const n=new m.a(e,r),s=new C.a(e,{colorTarget:0,depthStencilTarget:0},n),a=new m.a(e,{target:3553,pixelFormat:r.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t),o=Object(S.d)(e);return this.drawStretchedTexture(e,i,s,o,a,n),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:o,sourceTexture:a,framebuffer:s}:(o.dispose(!0),a.dispose(),s.detachColorTexture(),e.bindFramebuffer(null),s.dispose()),n}drawStretchedTexture(e,t,r,i,n,s){e.bindFramebuffer(r);const a=e.getViewport();e.setViewport(0,0,s.descriptor.width,s.descriptor.height);const o=t.program;e.useProgram(o),o.setUniform4f("color",1,1,1,1),o.bindTexture(n,"tex"),e.bindVAO(i),e.setPipelineState(t.pipeline),e.drawArrays(5,0,Object(M.f)(i,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height)}unload(){if(Object(o.j)(this.powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:r}=this.powerOfTwoStretchInfo;t.dispose(!0),r.dispose(),e.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(Object(o.j)(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),Object(o.j)(this.loadingController)){const e=this.loadingController;this.loadingController=null,this.loadingPromise=null,e.abort()}this.events.emit("unloaded")}}A.DDS_ENCODING="image/vnd-ms.dds",A.KTX2_ENCODING="image/ktx2",A.BASIS_ENCODING="image/x.basis"},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u}));var i=r(13),n=r(2),s=r(101);class a{constructor(e){this.autoDestroy=!1,this.properties=e}}function o(e){let t=e.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!r){const r=Object.create(t.properties),n=t.autoDestroy;for(const e in r)r[e]=Object(i.a)(r[e]);t=new a(r),t.autoDestroy=n,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new a({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return Object(n.d)(e.constructor.__accessorMetadata__)}function l(e){return o(e).properties}function c(e,t){const r=l(e);let i=r[t];return i||(i=r[t]={}),i}function u(e,t){return Object(s.c)(e,t,h)}const d=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function h(e){return d.test(e)?"replace":"merge"}},function(e,t,r){"use strict";var i=r(11),n=r(10),s=r(2),a=r(54),o=r(50),l=r(36),c=r(39),u=r(28),d=r(43),h=r(46),p=r(410);class f{constructor(e){const t=f.checkUnsupported(e);if(t)throw t;this.spatialReference=e.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Object(l.a)(this.spatialReference)||Object(d.h)(this.spatialReference)||Object(d.i)(this.spatialReference),this.origin=[e.origin.x,e.origin.y],this.pixelSize=e.size[0],this.dpi=e.dpi;const r=e.lods.reduce((function(e,t,r){return t.level<e.min&&(e.min=t.level,e.minIndex=r),e.max=Math.max(e.max,t.level),e}),{min:1/0,minIndex:0,max:-1/0}),i=e.lods[r.minIndex],n=2**i.level;let s=i.resolution*n,a=i.scale*n;this.levels=new Array(r.max+1);for(let o=0;o<this.levels.length;o++)this.levels[o]={resolution:s,scale:a,tileSize:[s*e.size[0],s*e.size[1]]},s/=2,a/=2}clone(){return new f(this.toTileInfo())}toTileInfo(){return new p.a({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,t)=>({level:t,scale:e.scale,resolution:e.resolution})))})}getExtent(e,t,r,i){const n=this.levels[e],s=n.tileSize[0],a=n.tileSize[1];i[0]=this.origin[0]+r*s,i[2]=i[0]+s,i[3]=this.origin[1]-t*a,i[1]=i[3]-a}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=Object(h.f)(e[0]),t[1]=Object(h.h)(e[1]),t[2]=Object(h.f)(e[2]),t[3]=Object(h.h)(e[3])):this._isGCS&&(t[0]=Object(n.g)(e[0]),t[1]=Object(n.g)(e[1]),t[2]=Object(n.g)(e[2]),t[3]=Object(n.g)(e[3]))}getExtentGeometry(e,t,r,i=new o.a){return this.getExtent(e,t,r,b),i.spatialReference=this.spatialReference,i.xmin=b[0],i.ymin=b[1],i.xmax=b[2],i.ymax=b[3],i.zmin=void 0,i.zmax=void 0,i}ensureMaxLod(e){if(null==e)return!1;let t=!1;for(;this.levels.length<=e;){const e=this.levels[this.levels.length-1],r=e.resolution/2;this.levels.push({resolution:r,scale:e.scale/2,tileSize:[r*this.pixelSize,r*this.pixelSize]}),t=!0}return t}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof f)){if(f.checkUnsupported(e))return!1;e=new f(e)}if(!e.spatialReference.equals(this.spatialReference))return!1;if(e.pixelSize!==this.pixelSize)return!1;const t=Math.min(this.levels.length,e.levels.length)-1,r=this.levels[t].resolution;let i=.5*r;return!(!Object(n.h)(e.origin[0],this.origin[0],i)||!Object(n.h)(e.origin[1],this.origin[1],i))&&(i=.5*r/2**t/this.pixelSize*12,Object(n.h)(r,e.levels[t].resolution,i))}rootTilesInExtent(e,t=null,r=1/0){const i=this.levels[0].tileSize;if(0===i[0]||0===i[1])return[];f.computeRowColExtent(e,i,this.origin,b);let n=b[1],a=b[3],o=b[0],l=b[2];const c=l-o,u=a-n;if(c*u>r){const e=Math.floor(Math.sqrt(r));u>e&&(n=n+Math.floor(.5*u)-Math.floor(.5*e),a=n+e),c>e&&(o=o+Math.floor(.5*c)-Math.floor(.5*e),l=o+e)}const d=[];for(let s=n;s<a;s++)for(let e=o;e<l;e++)d.push([0,s,e]);return Object(s.j)(t)&&(t[0]=this.origin[0]+o*i[0],t[1]=this.origin[1]-a*i[1],t[2]=this.origin[0]+l*i[0],t[3]=this.origin[1]-n*i[1]),d}static computeRowColExtent(e,t,r,i){const n=.001*(e[2]-e[0]+(e[3]-e[1]));i[0]=Math.max(0,Math.floor((e[0]+n-r[0])/t[0])),i[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/t[0])),i[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/t[1])),i[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/t[1]))}static isPowerOfTwo(e){const t=e.lods,r=t[0].resolution*2**t[0].level;return!t.some((function(e){return!Object(n.i)(e.resolution,r/2**e.level)}))}static hasGapInLevels(e){const t=e.lods.map((function(e){return e.level}));t.sort((function(e,t){return e-t}));for(let r=1;r<t.length;r++)if(t[r]!==t[0]+r)return!0;return!1}static tileSizeSupported(e){const t=e.size[1];return t===e.size[0]&&0==(t&t-1)&&t>=128&&t<=512}static checkUnsupported(e){return e?e.lods.length<1?new i.a("tilingscheme:generic","Tiling scheme must have at least one level"):f.isPowerOfTwo(e)?f.hasGapInLevels(e)?new i.a("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):f.tileSizeSupported(e)?null:new i.a("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new i.a("tilingscheme:power-of-two","Tiling scheme must be power of two"):new i.a("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static fromExtent(e,t){const r=e[2]-e[0],i=e[3]-e[1],n=Object(a.f)(t),s=1.2*Math.max(r,i),o=256,l=new f(new p.a({size:[o,o],origin:{x:e[0]-.5*(s-r),y:e[3]+.5*(s-i)},lods:[{level:0,resolution:s/o,scale:1/(o/96*.0254/(s*n))}],spatialReference:t}));return l.ensureMaxLod(20),l}static makeWebMercatorAuxiliarySphere(e){const t=new f(f.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(e),t}static makeGCSWithTileSize(e,t=256,r=16){const i=256/t,n=new f(new p.a({size:[t,t],origin:{x:-180,y:90,spatialReference:e},spatialReference:e,lods:[{level:0,resolution:.703125*i,scale:295497598.570834*i}]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}f.WebMercatorAuxiliarySphereTileInfo=new p.a({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:c.a.WebMercator},spatialReference:c.a.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),f.WebMercatorAuxiliarySphere=f.makeWebMercatorAuxiliarySphere(19);const b=Object(u.k)();t.a=f},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return d}));var i=r(2),n=r(17),s=r(18),a=r(3),o=r(64),l=r(34);function c(e,t,r=Object(o.c)()){return u(e,e.screenToRender(t,Object(n.b)(l.c.get())),r)}function u(e,t,r=Object(o.c)()){const c=Object(n.b)(Object(s.c)(l.c.get(),t));if(c[2]=0,!e.unprojectFromRenderScreen(c,r.origin))return null;const u=Object(n.b)(Object(s.c)(l.c.get(),t));u[2]=1;const d=e.unprojectFromRenderScreen(u,l.c.get());return Object(i.i)(d)?null:(Object(a.l)(r.direction,d,r.origin),r)}function d(e,t,r=Object(o.c)()){return h(e,e.screenToRender(t,Object(n.b)(l.c.get())),r)}function h(e,t,r=Object(o.c)()){Object(a.m)(r.origin,e.eye);const n=Object(a.y)(l.c.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(n,l.c.get());return Object(i.i)(s)?null:(Object(a.l)(r.direction,s,r.origin),r)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(497),n=r(298);class s{constructor(e,t){this.owner=t,this.properties={},this.afterDispatchHandle=null;for(const r in e){const t=e[r],n=new i.a(t,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=Object(n.a)((()=>this.release()))}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const e in this.properties){const t=this.properties[e];for(const e of t.acquired)Object(n.b)(e)||t.pool.release(e);t.pool.destroy(),t.pool=null,t.acquired=null}this.properties=null,this.owner=null}get(e){const t=this.owner._get(e),r=this.properties[e];let i=r.pool.acquire();for(r.acquired.push(i);i===t;)r.acquired.push(i),i=r.pool.acquire();return i}release(){for(const e in this.properties){const t=this.properties[e];let r=0;for(const e of t.acquired)Object(n.b)(e)?t.acquired[r++]=e:t.pool.release(e);t.acquired.length=r}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return a}));var i=r(10),n=r(3),s=r(5);function a(e,t){return Object(n.j)(e,t)/Object(n.r)(e)}function o(e,t){const r=Object(n.j)(e,t)/(Object(n.r)(e)*Object(n.r)(t));return-Object(i.b)(r)}function l(e,t,r){Object(n.t)(c,e),Object(n.t)(u,t);const s=Object(n.j)(c,u),a=Object(i.b)(s),o=Object(n.i)(c,c,u);return Object(n.j)(o,r)<0?2*Math.PI-a:a}const c=Object(s.e)(),u=Object(s.e)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return z}));var i=r(83),n=r(3),s=r(5),a=r(94),o=r(95),l=r(456),c=r(103),u=r(75),d=r(172),h=r(137),p=r(88),f=r(0),b=r(61),m=r(383),g=r(269),y=r(96),v=r(98),O=r(262),j=r(135),_=r(186),w=r(216),x=r(92),S=r(77),T=r(82),C=r(15),M=r(62),P=r(74),A=r(97),E=r(610),R=r(30);class I extends T.a{initializeProgram(e){const t=I.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,pbrMode:r.usePBR?r.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:r.normalsTypeDerivate?3:0,doubleSidedMode:r.doubleSidedMode,vertexTangents:r.vertexTangents,attributeTextureCoordinates:r.hasMetalnessAndRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture||r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(w.b)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new P.a(e.rctx,i,M.a)}bindPass(e,t){var r,i;Object(x.c)(this.program,t.camera.projectionMatrix);const n=this.configuration.output;(1===this.configuration.output||t.multipassTerrainEnabled||3===n)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(v.a)(this.program,t)),7===n&&(this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",p.b[e.colorMixMode])),0===n?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",p.b[e.colorMixMode]),this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.configuration.usePBR&&Object(O.c)(this.program,e,this.configuration.isSchematic)):4===n&&Object(y.b)(this.program,t),Object(_.c)(this.program,e),Object(g.b)(this.program,e,t),Object(p.a)(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==e.textureAlphaMode&&3!==e.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff),null==(r=t.shadowMap)||r.bind(this.program),null==(i=t.ssaoHelper)||i.bind(this.program)}bindDraw(e){const t=this.configuration.instancedDoublePrecision?Object(s.g)(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;Object(x.e)(this.program,t,e.camera.viewMatrix),this.program.rebindTextures(),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&Object(x.a)(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&m.a.bindCustomOrigin(this.program,t),Object(b.b)(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&Object(j.d)(this.program,e,t)}setPipeline(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(R.g)({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?u.f:Object(u.a)(e),culling:D(r)&&Object(R.c)(r.cullFace),depthTest:{func:Object(u.b)(e)},depthWrite:i||n?r.writeDepth&&R.e:null,colorWrite:R.d,stencilWrite:r.sceneHasOcludees?A.j:null,stencilTest:r.sceneHasOcludees?t?A.f:A.e:null,polygonOffset:i||n?null:Object(u.g)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}function D(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}I.shader=new S.a(E.a,(()=>r.e(189).then(r.bind(null,1050))));class F extends C.a{constructor(){super(...arguments),this.output=0,this.alphaDiscardMode=1,this.doubleSidedMode=0,this.isSchematic=!1,this.vertexColors=!1,this.offsetBackfaces=!1,this.symbolColors=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.receiveAmbientOcclusion=!1,this.screenSizePerspective=!1,this.textureAlphaPremultiplied=!1,this.hasColorTexture=!1,this.usePBR=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.vertexTangents=!1,this.normalsTypeDerivate=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparent=!1,this.enableOffset=!0,this.cullFace=0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(f.a)([Object(C.b)({count:8})],F.prototype,"output",void 0),Object(f.a)([Object(C.b)({count:4})],F.prototype,"alphaDiscardMode",void 0),Object(f.a)([Object(C.b)({count:3})],F.prototype,"doubleSidedMode",void 0),Object(f.a)([Object(C.b)()],F.prototype,"isSchematic",void 0),Object(f.a)([Object(C.b)()],F.prototype,"vertexColors",void 0),Object(f.a)([Object(C.b)()],F.prototype,"offsetBackfaces",void 0),Object(f.a)([Object(C.b)()],F.prototype,"symbolColors",void 0),Object(f.a)([Object(C.b)()],F.prototype,"vvSize",void 0),Object(f.a)([Object(C.b)()],F.prototype,"vvColor",void 0),Object(f.a)([Object(C.b)()],F.prototype,"verticalOffset",void 0),Object(f.a)([Object(C.b)()],F.prototype,"receiveShadows",void 0),Object(f.a)([Object(C.b)()],F.prototype,"slicePlaneEnabled",void 0),Object(f.a)([Object(C.b)()],F.prototype,"sliceHighlightDisabled",void 0),Object(f.a)([Object(C.b)()],F.prototype,"receiveAmbientOcclusion",void 0),Object(f.a)([Object(C.b)()],F.prototype,"screenSizePerspective",void 0),Object(f.a)([Object(C.b)()],F.prototype,"textureAlphaPremultiplied",void 0),Object(f.a)([Object(C.b)()],F.prototype,"hasColorTexture",void 0),Object(f.a)([Object(C.b)()],F.prototype,"usePBR",void 0),Object(f.a)([Object(C.b)()],F.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(f.a)([Object(C.b)()],F.prototype,"hasEmissionTexture",void 0),Object(f.a)([Object(C.b)()],F.prototype,"hasOcclusionTexture",void 0),Object(f.a)([Object(C.b)()],F.prototype,"hasNormalTexture",void 0),Object(f.a)([Object(C.b)()],F.prototype,"instanced",void 0),Object(f.a)([Object(C.b)()],F.prototype,"instancedColor",void 0),Object(f.a)([Object(C.b)()],F.prototype,"instancedDoublePrecision",void 0),Object(f.a)([Object(C.b)()],F.prototype,"vertexTangents",void 0),Object(f.a)([Object(C.b)()],F.prototype,"normalsTypeDerivate",void 0),Object(f.a)([Object(C.b)()],F.prototype,"writeDepth",void 0),Object(f.a)([Object(C.b)()],F.prototype,"sceneHasOcludees",void 0),Object(f.a)([Object(C.b)()],F.prototype,"transparent",void 0),Object(f.a)([Object(C.b)()],F.prototype,"enableOffset",void 0),Object(f.a)([Object(C.b)({count:3})],F.prototype,"cullFace",void 0),Object(f.a)([Object(C.b)({count:4})],F.prototype,"transparencyPassType",void 0),Object(f.a)([Object(C.b)()],F.prototype,"multipassTerrainEnabled",void 0),Object(f.a)([Object(C.b)()],F.prototype,"cullAboveGround",void 0);var L=r(611);class k extends I{initializeProgram(e){const t=k.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,pbrMode:r.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangents:!1,attributeTextureCoordinates:r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(w.b)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new P.a(e.rctx,i,M.a)}}k.shader=new S.a(L.a,(()=>r.e(179).then(r.bind(null,1051))));class z extends c.a{constructor(e){super(e,N),this.supportsEdges=!0,this.techniqueConfig=new F,this.vertexBufferLayout=z.getVertexBufferLayout(this.params),this.instanceBufferLayout=e.instanced?z.getInstanceBufferLayout(this.params):null}isVisibleInPass(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}isVisible(){const e=this.params;if(!super.isVisible()||0===e.layerOpacity)return!1;const t=e.instanced,r=e.vertexColors,i=e.symbolColors,n=!!t&&t.indexOf("color")>-1,s=e.vvColorEnabled,a="replace"===e.colorMixMode,o=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0;return r&&(n||s||i)?!!a||o:r?a?l:o:n||s||i?!!a||o:a?l:o}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.params.textureId,this.techniqueConfig.vertexTangents=this.params.vertexTangents,this.techniqueConfig.instanced=!!this.params.instanced,this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.cullFace=this.params.slicePlaneEnabled?0:this.params.cullFace,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&this.params.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<u.e),this.techniqueConfig}intersect(e,t,r,i,s,a,o){if(null!==this.params.verticalOffset){const e=i.camera;Object(n.y)($,r[12],r[13],r[14]);let t=null;switch(i.viewingMode){case 1:t=Object(n.t)(H,$);break;case 2:t=Object(n.m)(H,q)}let o=0;if(null!==this.params.verticalOffset){const r=Object(n.l)(Q,$,e.eye),i=Object(n.r)(r),s=Object(n.g)(r,r,1/i);let a=null;this.params.screenSizePerspective&&(a=Object(n.j)(t,s)),o+=Object(p.l)(e,i,this.params.verticalOffset,a,this.params.screenSizePerspective)}Object(n.g)(t,t,o),Object(n.z)(W,t,i.transform.inverseRotation),s=Object(n.l)(B,s,W),a=Object(n.l)(G,a,W)}Object(p.i)(e,t,i,s,a,Object(d.d)(i.verticalOffset),o)}getGLMaterial(e){if(0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output)return new V(e)}createBufferWriter(){return new U(this.vertexBufferLayout,this.instanceBufferLayout)}static getVertexBufferLayout(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,r=Object(a.a)().vec3f("position").vec3f("normal");return e.vertexTangents&&r.vec4f("tangent"),t&&r.vec2f("uv0"),e.vertexColors&&r.vec4u8("color"),e.symbolColors&&r.vec4u8("symbolColor"),r}static getInstanceBufferLayout(e){let t=Object(a.a)();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}}class V extends l.a{constructor(e){const t=e.material;super({...e,...t.params}),this.updateParameters()}updateParameters(e){const t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(t.treeRendering?k:I,this._material.getTechniqueConfig(this._output,e),this._technique)}selectPipelines(){}_updateShadowState(e){e.shadowMappingEnabled!==this._material.params.shadowMappingEnabled&&this._material.setParameterValues({shadowMappingEnabled:e.shadowMappingEnabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.params,e),this.bindTextures(this._technique.program)}beginSlot(e){return e===(this._material.params.transparent?this._material.params.writeDepth?5:8:3)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const N={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(i.b)(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:o.b,textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...c.b};class U{constructor(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){Object(h.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}const B=Object(s.e)(),G=Object(s.e)(),q=Object(s.g)(0,0,1),H=Object(s.e)(),W=Object(s.e)(),$=Object(s.e)(),Q=Object(s.e)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var i=r(9);function n(e){const t=Object(i.e)(100*(1-e));return Math.max(0,Math.min(t,100))}function s(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(2),n=r(299);class s{constructor(e){this.allocator=e,this.items=[],this.itemsPtr=0,this.tickHandle=n.a.before((()=>this.reset())),this.grow()}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=Object(i.p)(this.tickHandle)),this.items=Object(i.p)(this.items)}get(){return 0===this.itemsPtr&&Object(n.a)((()=>{})),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]}reset(){const e=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*a);this.items.length=Math.min(e,this.items.length),this.itemsPtr=0}grow(){for(let e=0;e<Math.max(8,Math.min(this.items.length,a));e++)this.items.push(this.allocator())}}const a=1024},function(e,t,r){"use strict";function i(e){return"string"==typeof e?document.getElementById(e):e}function n(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function s(e,t){const r=t.parentNode;r&&r.insertBefore(e,t)}function a(e,t){for(;;){const r=e.firstChild;if(!r)break;t.appendChild(r)}}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return a}));(()=>{if("function"==typeof Element.prototype.closest)return(e,t)=>e.closest(t);const e=Element.prototype.matches||Element.prototype.msMatchesSelector})()},function(e,t,r){"use strict";function i(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function n(e){return null!=e&&!isNaN(e)&&isFinite(e)}function s(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}function a(e,t){const r=t||s(e),i=e.valueUnit||"unknown";return"unknown"===r?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===i?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return n}))},function(e,t,r){"use strict";r.r(t);var i=r(0),n=r(113),s=r(124),a=r(44),o=r(14),l=r(2),c=r(1),u=(r(8),r(9),r(7),r(32)),d=r(4),h=r(29),p=r(39),f=r(85),b=r(304);const m=new a.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let g=class extends o.a{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const r=p.a.fromJSON(t.spatialReference),i=[];for(let n=0;n<e.length;n++){const t=e[n],a=s.a.fromJSON(t),o=t.geometry&&t.geometry.spatialReference;Object(l.j)(a.geometry)&&!o&&(a.geometry.spatialReference=r),i.push(a)}return i}writeGeometryType(e,t,r,i){if(e)return void m.write(e,t,r,i);const{features:n}=this;if(n)for(const s of n)if(s&&Object(l.j)(s.geometry))return void m.write(s.geometry.type,t,r,i)}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,i=Object(f.a)(e);return!r&&t.spatialReference&&(i.spatialReference=p.a.fromJSON(t.spatialReference)),i}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r)for(const i of r)if(i&&Object(l.j)(i.geometry)&&i.geometry.spatialReference)return void(t.spatialReference=i.geometry.spatialReference.toJSON())}toJSON(e){const t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const i=t.features[r];if(i.geometry){const t=e&&e[r];i.geometry=t&&t.toJSON()||i.geometry}}return t}quantize(e){const{scale:[t,r],translate:[i,n]}=e,s=this.features,a=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-i)/t)),(e=>Math.round((n-e)/r)));for(let o=0,c=s.length;o<c;o++)a(Object(l.s)(s[o].geometry))||(s.splice(o,1),o--,c--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[i,n],scale:[s,a]}=r,o=this._getHydrationFunction(e,(e=>e*s+i),(e=>n-e*a));for(const{geometry:c}of t)Object(l.j)(c)&&o(c);return this.transform=null,this}_quantizePoints(e,t,r){let i,n;const s=[];for(let a=0,o=e.length;a<o;a++){const o=e[a];if(a>0){const e=t(o[0]),a=r(o[1]);e===i&&a===n||(s.push([e-i,a-n]),i=e,n=a)}else i=t(o[0]),n=r(o[1]),s.push([i,n])}return s.length>0?s:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{const i=Object(f.g)(e)?e.rings:e.paths,n=[];for(let s=0,a=i.length;s<a;s++){const e=i[s],a=this._quantizePoints(e,t,r);a&&n.push(a)}return n.length>0?(Object(f.g)(e)?e.rings=n:e.paths=n,e):null}:"multipoint"===e?e=>{const i=this._quantizePoints(e.points,t,r);return i.length>0?(e.points=i,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?e=>{const i=Object(f.g)(e)?e.rings:e.paths;let n,s;for(let a=0,o=i.length;a<o;a++){const e=i[a];for(let i=0,a=e.length;i<a;i++){const a=e[i];i>0?(n+=a[0],s+=a[1]):(n=a[0],s=a[1]),a[0]=t(n),a[1]=r(s)}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?e=>{const i=e.points;let n,s;for(let a=0,o=i.length;a<o;a++){const e=i[a];a>0?(n+=e[0],s+=e[1]):(n=e[0],s=e[1]),e[0]=t(n),e[1]=r(s)}}:void 0}};Object(i.a)([Object(c.b)({type:String,json:{write:!0}})],g.prototype,"displayFieldName",void 0),Object(i.a)([Object(c.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],g.prototype,"exceededTransferLimit",void 0),Object(i.a)([Object(c.b)({type:[s.a],json:{write:!0}})],g.prototype,"features",void 0),Object(i.a)([Object(u.a)("features")],g.prototype,"readFeatures",null),Object(i.a)([Object(c.b)({type:[b.a],json:{write:!0}})],g.prototype,"fields",void 0),Object(i.a)([Object(c.b)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:m.read}}})],g.prototype,"geometryType",void 0),Object(i.a)([Object(h.a)("geometryType")],g.prototype,"writeGeometryType",null),Object(i.a)([Object(c.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],g.prototype,"hasM",void 0),Object(i.a)([Object(c.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],g.prototype,"hasZ",void 0),Object(i.a)([Object(c.b)({types:n.a,json:{write:!0}})],g.prototype,"queryGeometry",void 0),Object(i.a)([Object(u.a)("queryGeometry")],g.prototype,"readQueryGeometry",null),Object(i.a)([Object(c.b)({type:p.a,json:{write:!0}})],g.prototype,"spatialReference",void 0),Object(i.a)([Object(h.a)("spatialReference")],g.prototype,"writeSpatialReference",null),Object(i.a)([Object(c.b)({json:{write:!0}})],g.prototype,"transform",void 0),g=Object(i.a)([Object(d.a)("esri.rest.support.FeatureSet")],g),g.prototype.toJSON.isDefaultToJSON=!0,g||(g={});var y=g;t.default=y},function(e,t,r){"use strict";class i{constructor(e=[],t=[],r=!1){this.lengths=null!=e?e:[],this.coords=null!=t?t:[],this.hasIndeterminateRingOrder=r}get isPoint(){return 0===this.lengths.length}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}clone(){return new i(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}t.a=i},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c}));var i=r(0),n=r(19),s=r(2),a=r(12),o=r(4);class l{constructor(e){this.instance=e,this._resolver=Object(a.g)(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=1,this._cleanUp()}),(()=>{this._status=2,this._cleanUp()}))}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return 1===this._status}isRejected(){return 2===this._status}isFulfilled(){return 0!==this._status}abort(){this._resolver.reject(Object(a.f)())}when(e,t){return this._resolver.promise.then(e,t)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const e=Object(a.g)(),t=[...this._resolvingPromises,Object(s.d)(e.promise)],r=this._allPromise=Promise.all(t);r.then((()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)}),(e=>{this.isFulfilled()||this._allPromise!==r||Object(a.n)(e)||this._resolver.reject(e)})),e.resolve()}}const c=e=>{let t=class extends e{constructor(...e){super(...e),this._promiseProps=new l(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(e,t){return new Promise(((e,t)=>{this._promiseProps.when(e,t)})).then(e,t)}catch(e){return this.when(null,e)}addResolvingPromise(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)}};return t=Object(i.a)([Object(o.a)("esri.core.Promise")],t),t};let u=class extends(c(n.a)){};u=Object(i.a)([Object(o.a)("esri.core.Promise")],u)},function(e,t,r){"use strict";var i,n=r(0),s=r(38),a=r(11),o=r(13),l=r(1),c=(r(9),r(8),r(7),r(37)),u=r(4),d=r(29),h=r(190),p=r(279),f=r(212),b=r(208),m=r(218),g=r(389);const y=s.a.ofType({base:null,key:"type",typeMap:{icon:h.a,object:p.a,text:b.a}}),v=s.a.ofType({base:null,key:"type",typeMap:{icon:h.a,object:p.a}});let O=i=class extends f.a{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new y,this.type="point-3d"}writeSymbolLayers(e,t,r,i){const n=e.filter((e=>"text"!==e.type));if(i&&i.messages&&n.length<e.length){const t=e.find((e=>"text"===e.type));i.messages.push(new a.a("symbol-layer:unsupported","Symbol layers of type 'text' cannot be persisted in PointSymbol3D",{symbolLayer:t}))}t[r]=n.map((e=>e.write({},i))).toArray()}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Object(m.b)(this)}hasVisibleVerticalOffset(){return Object(m.c)(this)}clone(){return new i({verticalOffset:Object(o.a)(this.verticalOffset),callout:Object(o.a)(this.callout),styleOrigin:Object(o.a)(this.styleOrigin),symbolLayers:Object(o.a)(this.symbolLayers),thumbnail:Object(o.a)(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new i({symbolLayers:[h.a.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new i({symbolLayers:[h.a.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){if(e.data&&e.data.symbol){const t=e.data.symbol;if("CIMPointSymbol"===t.type&&t.callout)return new i({symbolLayers:[h.a.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}})}return new i({symbolLayers:[h.a.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new i({symbolLayers:[b.a.fromTextSymbol(e)]})}};Object(n.a)([Object(l.b)({type:g.a,json:{write:!0}})],O.prototype,"verticalOffset",void 0),Object(n.a)([Object(l.b)(m.a)],O.prototype,"callout",void 0),Object(n.a)([Object(l.b)({type:y,json:{type:v,origins:{"web-scene":{type:v}}}})],O.prototype,"symbolLayers",void 0),Object(n.a)([Object(d.a)("web-scene","symbolLayers")],O.prototype,"writeSymbolLayers",null),Object(n.a)([Object(c.a)({PointSymbol3D:"point-3d"},{readOnly:!0})],O.prototype,"type",void 0),O=i=Object(n.a)([Object(u.a)("esri.symbols.PointSymbol3D")],O);var j=O;t.a=j},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(2),o=r(1),l=(r(9),r(8),r(7),r(37)),c=r(4),u=r(29),d=r(323),h=r(147),p=r(116),f=r(35),b=r(14);let m=i=class extends b.a{constructor(){super(...arguments),this.color=new f.a([0,0,0,1]),this.size=0}clone(){return new i({color:Object(s.a)(this.color),size:this.size})}};Object(n.a)([Object(o.b)(p.a)],m.prototype,"color",void 0),Object(n.a)([Object(o.b)(p.b)],m.prototype,"size",void 0),m=i=Object(n.a)([Object(c.a)("esri.symbols.support.Symbol3DHalo")],m);var g,y=m,v=r(187);let O=g=class extends h.a{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.material=null,this.text=void 0,this.type="text"}get font(){return this._get("font")||null}set font(e){e&&this._userSize&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,r,i){const n={...i,textSymbol3D:!0};t.font=e.write({},n),delete t.font.size}get size(){return null!=this._userSize?this._userSize:this.font&&null!=this.font.size?this.font.size:9}set size(e){this._userSize=e,this.font&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){return new g({enabled:this.enabled,font:this.font&&Object(s.a)(this.font),halo:this.halo&&Object(s.a)(this.halo),material:Object(a.j)(this.material)?this.material.clone():null,size:this.size,text:this.text})}static fromTextSymbol(e){const t=function(e,t){return e&&t>0?{color:Object(s.a)(e),size:t}:null}(e.haloColor,e.haloSize),r=e.font?e.font.clone():new d.a;return new g({size:r.size,font:r,halo:t,material:e.color?{color:e.color.clone()}:null,text:e.text})}};Object(n.a)([Object(o.b)({type:d.a,json:{write:!0}})],O.prototype,"font",null),Object(n.a)([Object(u.a)("font")],O.prototype,"writeFont",null),Object(n.a)([Object(o.b)({type:y,json:{write:!0}})],O.prototype,"halo",void 0),Object(n.a)([Object(o.b)({type:v.a,json:{write:!0}})],O.prototype,"material",void 0),Object(n.a)([Object(o.b)(p.b),Object(o.b)()],O.prototype,"size",null),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],O.prototype,"text",void 0),Object(n.a)([Object(l.a)({Text:"text"},{readOnly:!0})],O.prototype,"type",void 0),O=g=Object(n.a)([Object(c.a)("esri.symbols.TextSymbol3DLayer")],O);var j=O;t.a=j},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(183),n=r(6);function s(e,t){e.fragment.include(i.a),3===t.output?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(n.a`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):1===t.output&&e.fragment.code.add(n.a`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(i.a`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(i.a`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(i.a`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(44),o=r(13),l=r(1),c=(r(9),r(8),r(7),r(37)),u=r(4),d=r(387),h=r(152);const p=new a.a({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let f=i=class extends d.a{constructor(...e){super(...e),this.color=new s.a([0,0,0,.25]),this.outline=new h.a,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const i={};return e&&(i.style=e),t&&(i.outline=t),r&&(i.color=r),i}clone(){return new i({color:Object(o.a)(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};Object(n.a)([Object(l.b)()],f.prototype,"color",void 0),Object(n.a)([Object(l.b)()],f.prototype,"outline",void 0),Object(n.a)([Object(c.a)({esriSFS:"simple-fill"},{readOnly:!0})],f.prototype,"type",void 0),Object(n.a)([Object(l.b)({type:p.apiValues,json:{read:p.read,write:p.write}})],f.prototype,"style",void 0),f=i=Object(n.a)([Object(u.a)("esri.symbols.SimpleFillSymbol")],f);var b=f;t.a=b},function(e,t,r){"use strict";var i=r(0),n=r(38),s=r(153),a=r(7),o=r(25),l=r(181),c=r(1),u=(r(8),r(45)),d=r(32),h=r(4),p=r(29),f=r(118),b=r(115),m=r(348),g=r(263),y=r(190),v=r(253),O=r(279),j=r(349),_=r(121),w=r(147),x=r(208),S=r(350),T=r(365),C=r(356);const M={icon:y.a,object:O.a,line:v.a,path:j.a,fill:g.a,extrude:m.a,text:x.a,water:S.a},P=n.a.ofType({base:w.a,key:"type",typeMap:M,errorContext:"symbol-layer"}),A=a.a.getLogger("esri.symbols.Symbol3D");let E=class extends _.a{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=t&&t.type||n.a;this._set("symbolLayers",new r)}get color(){return null}set color(e){A.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Object(s.b)(e,this._get("symbolLayers"))}readStyleOrigin(e,t,r){if(e.styleUrl&&e.name){const t=Object(b.a)(e.styleUrl,r);return new T.a({styleUrl:t,name:e.name})}if(e.styleName&&e.name)return new T.a({portal:r&&r.portal||f.a.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new l.a("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,t,r,i){if(e.styleUrl&&e.name){let r=Object(b.e)(e.styleUrl,i);Object(o.s)(r)&&(r=Object(o.D)(r)),t.styleOrigin={styleUrl:r,name:e.name}}else e.styleName&&e.name&&(e.portal&&i&&i.portal&&!Object(o.r)(e.portal.restUrl,i.portal.restUrl)?i&&i.messages&&i.messages.push(new l.a("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof w.a||e&&M[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};Object(i.a)([Object(c.b)({json:{read:!1,write:!1}})],E.prototype,"color",null),Object(i.a)([Object(c.b)({type:P,nonNullable:!0,json:{write:!0}}),Object(u.a)(s.a)],E.prototype,"symbolLayers",null),Object(i.a)([Object(c.b)({type:T.a})],E.prototype,"styleOrigin",void 0),Object(i.a)([Object(d.a)("styleOrigin")],E.prototype,"readStyleOrigin",null),Object(i.a)([Object(p.a)("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],E.prototype,"writeStyleOrigin",null),Object(i.a)([Object(c.b)({type:C.a,json:{read:!1}})],E.prototype,"thumbnail",void 0),Object(i.a)([Object(c.b)({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],E.prototype,"type",void 0),E=Object(i.a)([Object(h.a)("esri.symbols.Symbol3D")],E);var R=E;t.a=R},function(e,t,r){"use strict";function i(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function n(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function s(e,t,r,i,n,s,a,o,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=a,c[7]=o,c[8]=l,c}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return s}));Object.freeze({__proto__:null,create:i,clone:n,fromValues:s,createView:function(e,t){return new Float32Array(e,t,9)}})},function(e,t,r){"use strict";function i(e){return e&&"base-tile"===e.type||"tile"===e.type||"elevation"===e.type||"imagery-tile"===e.type||"base-elevation"===e.type||"open-street-map"===e.type||"wcs"===e.type||"web-tile"===e.type||"wmts"===e.type||"vector-tile"===e.type}function n(e){return e.parent&&"esri.Basemap"===e.parent.declaredClass&&e.parent.baseLayers.indexOf(e)>-1}function s(e){return!0===e.labelsVisible&&null!=e.labelingInfo&&e.labelingInfo.length>0}r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return i}))},function(e,t,r){"use strict";var i,n=r(0),s=r(7),a=r(12),o=r(1),l=(r(8),r(9),r(37)),c=r(4),u=r(118),d=r(115),h=r(121),p=r(356);const f=s.a.getLogger("esri.symbols.WebStyleSymbol");let b=i=class extends h.a{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new i({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=await Promise.resolve().then(r.bind(null,552));Object(a.x)(t);const n=i.resolveWebStyleSymbol(this,{portal:this.portal},e,t);return n.catch((e=>{f.error("#fetchSymbol()","Failed to create symbol from style",e)})),n}};Object(n.a)([Object(o.b)({json:{write:!1}})],b.prototype,"color",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],b.prototype,"styleName",void 0),Object(n.a)([Object(o.b)({type:u.a,json:{write:!1}})],b.prototype,"portal",void 0),Object(n.a)([Object(o.b)({type:String,json:{read:d.d,write:d.f}})],b.prototype,"styleUrl",void 0),Object(n.a)([Object(o.b)({type:p.a,json:{read:!1}})],b.prototype,"thumbnail",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],b.prototype,"name",void 0),Object(n.a)([Object(l.a)({styleSymbolReference:"web-style"},{readOnly:!0})],b.prototype,"type",void 0),b=i=Object(n.a)([Object(c.a)("esri.symbols.WebStyleSymbol")],b);var m=b;t.a=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o}));var i=r(8),n=r(6),s=r(297);function a({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(n.a`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(n.a`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function o(e){return!!Object(i.a)("force-double-precision-obfuscation")||Object(s.b)(e).doublePrecisionRequiresObfuscation}},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(32)),l=r(4),c=r(29);let u=i=class extends s.a{constructor(e){super(e),this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return null!=t.datetime&&new Date(t.datetime)||null}writeDate(e,t,r){t[r]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,r){e&&(t[r]=e)}writeDisplayUTCOffset(e,t){null!=e&&(t.displayUTCOffset=e)}clone(){return new i(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(e.date=new Date(this.date.getTime())),e}};Object(n.a)([Object(a.b)({type:Date,json:{type:Number,write:{target:"datetime"}}})],u.prototype,"date",void 0),Object(n.a)([Object(o.a)("date",["datetime"])],u.prototype,"readDate",null),Object(n.a)([Object(c.a)("date")],u.prototype,"writeDate",null),Object(n.a)([Object(a.b)({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],u.prototype,"directShadowsEnabled",void 0),Object(n.a)([Object(o.a)("directShadowsEnabled",["directShadows"])],u.prototype,"readDirectShadowsEnabled",null),Object(n.a)([Object(c.a)("directShadowsEnabled")],u.prototype,"writedirectShadowsEnabled",null),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],u.prototype,"displayUTCOffset",void 0),Object(n.a)([Object(c.a)("displayUTCOffset")],u.prototype,"writeDisplayUTCOffset",null),u=i=Object(n.a)([Object(l.a)("esri.webscene.Lighting")],u);var d=u;t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return o}));var i=r(511),n=r(481);function s(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function a(e){if(!e)return!1;if(!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!s(e)}function o(e){return"point-3d"===e.type||"label-3d"===e.type}const l={types:{key:"type",base:i.a,typeMap:{line:n.a}},json:{write:!0}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return n})),r.d(t,"e",(function(){return c})),r.d(t,"f",(function(){return d}));var i=r(10);function n(e,t){return new h(e,p,t)}function s(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:n}=p;return new h(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:f.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:f.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:n,minPixelSize:f.minPixelSize},t)}function a(e,t,r){const i=r.parameters,n=r.paddingPixelsOverride;return b.scale=Math.min(i.divisor/(t-i.offset),1),b.factor=function(e){return Math.abs(e*e*e)}(e),b.minPixelSize=i.minPixelSize,b.paddingPixels=n,b}function o(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function l(e,t){return Math.max(Object(i.m)(e*t.scale,e,t.factor),o(e,t))}function c(e,t,r,i){i.scale=function(e,t,r){const i=a(e,t,r);return i.minPixelSize=0,i.paddingPixels=0,l(1,i)}(e,t,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function u(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,o(e[1],t)/e[1]),1);return r[0]=e[0]*i,r[1]=e[1]*i,r}function d(e,t,r,i){return l(e,a(t,r,i))}class h{constructor(e,t,r,i={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},n){this.viewingMode=e,this.description=t,this.ellipsoidRadius=r,this.parameters=i,this._paddingPixelsOverride=n,2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this.calculateParameters(e,this.ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new h(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,e):this}calculateParameters(e,t,r){const{scaleStart:i,scaleFallOffRange:n,minPixelSize:s}=this.description,{fovY:a,distance:o}=e,l=this.calculateCurvatureDependentParameters(e,t),c=this.coverageCompensation(e,t,l),{tiltAngle:u,scaleFallOffFactor:d}=l,h=Math.sin(u)*o,p=.5*Math.PI-u-a*(.5-i*c),f=h/Math.cos(p),b=p+a*n*c,m=(f-d*(h/Math.cos(b)))/(1-d);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=m,r.divisor=f-m,r.minPixelSize=s,r}calculateCurvatureDependentParametersLocal(e,t,r=m){return r.tiltAngle=this.description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,r}calculateCurvatureDependentParametersGlobal(e,t,r=m){const n=this.description.curvatureDependent,s=1+e.distance/t,a=Math.sqrt(s*s-1),[o,l]=[n.min.curvature,n.max.curvature],c=Object(i.e)((a-o)/(l-o),0,1),[u,d]=[n.min,n.max];return r.tiltAngle=Object(i.m)(u.tiltAngle,d.tiltAngle,c),r.scaleFallOffFactor=Object(i.m)(u.scaleFallOffFactor,d.scaleFallOffFactor,c),r}surfaceCoverageCompensationLocal(e,t,r){return(e.fovY-r.tiltAngle)/e.fovY}surfaceCoverageCompensationGlobal(e,t,r){const i=t*t,n=r.tiltAngle+.5*Math.PI,{fovY:s,distance:a}=e,o=a*a+i-2*Math.cos(n)*a*t,l=Math.sqrt(o),c=Math.sqrt(o-i);return(Math.acos(c/l)-Math.asin(t/(l/Math.sin(n)))+.5*s)/s}}const p={curvatureDependent:{min:{curvature:Object(i.g)(10),tiltAngle:Object(i.g)(12),scaleFallOffFactor:.5},max:{curvature:Object(i.g)(70),tiltAngle:Object(i.g)(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},f={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};const b={scale:0,factor:0,minPixelSize:0,paddingPixels:0},m={tiltAngle:0,scaleFallOffFactor:0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return o}));var i=r(5);class n{constructor(e=Object(i.e)()){this.intensity=e}}class s{constructor(e=Object(i.e)(),t=Object(i.g)(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class a{constructor(e=Object(i.e)(),t=Object(i.g)(.57735,.57735,.57735),r=!0){this.intensity=e,this.direction=t,this.castShadows=r}}class o{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(2),o=r(337),l=r(1),c=(r(8),r(9),r(7),r(32)),u=r(4),d=r(29);let h=i=class extends s.a{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return p}static get empty(){return f}readEnd(e,t){return null!=t.end?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(i.allTime)}get isEmpty(){return this.equals(i.empty)}readStart(e,t){return null!=t.start?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new i({end:this.end,start:this.start})}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=Object(a.b)(this.start,(t=>Object(o.c)(t,e))),r=Object(a.b)(this.end,(t=>Object(o.b)(Object(o.c)(t,e),1,e)));return new i({start:t,end:r})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return i.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=Object(a.m)(this.start,-1/0,(e=>e.getTime())),r=Object(a.m)(this.end,1/0,(e=>e.getTime())),n=Object(a.m)(e.start,-1/0,(e=>e.getTime())),s=Object(a.m)(e.end,1/0,(e=>e.getTime()));let o,l;if(n>=t&&n<=r?o=n:t>=n&&t<=s&&(o=t),r>=n&&r<=s?l=r:s>=t&&s<=r&&(l=s),!isNaN(o)&&!isNaN(l)){const e=new i;return e.start=o===-1/0?null:new Date(o),e.end=l===1/0?null:new Date(l),e}return i.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const r=new i,{start:n,end:s}=this;return Object(a.j)(n)&&(r.start=Object(o.b)(n,e,t)),Object(a.j)(s)&&(r.end=Object(o.b)(s,e,t)),r}equals(e){if(!e)return!1;const t=Object(a.j)(this.start)?this.start.getTime():this.start,r=Object(a.j)(this.end)?this.end.getTime():this.end,i=Object(a.j)(e.start)?e.start.getTime():e.start,n=Object(a.j)(e.end)?e.end.getTime():e.end;return t===i&&r===n}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return p.clone();const t=Object(a.j)(this.start)&&Object(a.j)(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=Object(a.j)(this.end)&&Object(a.j)(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new i({start:t,end:r})}};Object(n.a)([Object(l.b)({type:Date,json:{write:{allowNull:!0}}})],h.prototype,"end",void 0),Object(n.a)([Object(c.a)("end")],h.prototype,"readEnd",null),Object(n.a)([Object(d.a)("end")],h.prototype,"writeEnd",null),Object(n.a)([Object(l.b)({readOnly:!0,json:{read:!1}})],h.prototype,"isAllTime",null),Object(n.a)([Object(l.b)({readOnly:!0,json:{read:!1}})],h.prototype,"isEmpty",null),Object(n.a)([Object(l.b)({type:Date,json:{write:{allowNull:!0}}})],h.prototype,"start",void 0),Object(n.a)([Object(c.a)("start")],h.prototype,"readStart",null),Object(n.a)([Object(d.a)("start")],h.prototype,"writeStart",null),h=i=Object(n.a)([Object(u.a)("esri.TimeExtent")],h);const p=new h,f=new h({start:void 0,end:void 0});var b=h;t.a=b},function(e,t,r){"use strict";var i,n=r(0),s=r(87),a=r(44),o=r(14),l=r(54),c=r(181),u=r(1),d=(r(8),r(9),r(7),r(32)),h=r(4),p=r(29);const f=Object(a.b)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),b=f.jsonValues.slice();Object(s.k)(b,"orthometric");const m=Object(a.b)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let g=i=class extends o.a{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return f.write(e,t,r)}readHeightModel(e,t,r){return f.read(e)||(r&&r.messages&&r.messages.push(function(e,t){return new c.a("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:r})),null)}readHeightUnit(e,t,r){return m.read(e)||(r&&r.messages&&r.messages.push(y(e,{context:r})),null)}readHeightUnitService(e,t,r){return Object(l.u)(e)||m.read(e)||(r&&r.messages&&r.messages.push(y(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new i({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=Object(l.i)(t);return new i({heightModel:e.heightModel,heightUnit:r,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new i;return t.read(e,{origin:"web-scene"}),t}};function y(e,t){return new c.a("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}Object(n.a)([Object(u.b)({type:f.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:b,default:"ellipsoidal"}}}})],g.prototype,"heightModel",void 0),Object(n.a)([Object(p.a)("web-scene","heightModel")],g.prototype,"writeHeightModel",null),Object(n.a)([Object(d.a)(["web-scene","service"],"heightModel")],g.prototype,"readHeightModel",null),Object(n.a)([Object(u.b)({type:m.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:m.jsonValues,write:m.write}}}})],g.prototype,"heightUnit",void 0),Object(n.a)([Object(d.a)("web-scene","heightUnit")],g.prototype,"readHeightUnit",null),Object(n.a)([Object(d.a)("service","heightUnit")],g.prototype,"readHeightUnitService",null),Object(n.a)([Object(u.b)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],g.prototype,"vertCRS",void 0),Object(n.a)([Object(d.a)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],g.prototype,"readVertCRS",null),g=i=Object(n.a)([Object(h.a)("esri.geometry.HeightModelInfo")],g);var v=g;t.a=v},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return p})),r.d(t,"g",(function(){return d})),r.d(t,"h",(function(){return f}));var i=r(7),n=r(339),s=r(139);const a=i.a.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function o(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function l(e){const t=e&&e.expression;if("string"==typeof t){const e=m(t);if(null!=e)return{cachedResult:e}}return null}async function c(e,t,r){const i=e&&e.expression;if("string"!=typeof i)return null;const n=m(i);if(null!=n)return{cachedResult:n};const a=await Object(s.e)(),o=a.arcadeUtils,l=o.createSyntaxTree(i);return o.dependsOnView(l)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(l),context:o.createExecContext(null,{sr:t}),modules:a}}}function u(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function d(e,t){if(null!=e&&!b(e)){if(!t||!e.arcade)return void a.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=Object(n.b)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function h(e){if(null!=e){if(b(e))return e.cachedResult;const t=e.arcade;let r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function p(e,t=!1){let r=e&&e.featureExpressionInfo;const i=r&&r.expression;return t||"0"===i||(r=null),r}const f={cachedResult:0};function b(e){return null!=e.cachedResult}function m(e){return"0"===e?0:null}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return l}));r(43);function i(e,t){const r=t[0]-e[0],i=t[1]-e[1];if(e.length>2&&t.length>2){const n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}return Math.sqrt(r*r+i*i)}function n(e,t,r){const i=e[0]+r*(t[0]-e[0]),n=e[1]+r*(t[1]-e[1]);return e.length>2&&t.length>2?[i,n,e[2]+r*(t[2]-e[2])]:[i,n]}function s(e,t){return n(e,t,.5)}function a(e){const t=e.length;let r=0;for(let n=0;n<t-1;++n)r+=i(e[n],e[n+1]);return r}function o(e,t){if(t<=0)return e[0];const r=e.length;let s=0;for(let a=0;a<r-1;++a){const r=i(e[a],e[a+1]);if(t-s<r){const i=(t-s)/r;return n(e[a],e[a+1],i)}s+=r}return e[r-1]}function l(e,t,r){const i=e.length;let n=0,s=0,a=0;for(let o=0;o<i;o++){const l=e[o],c=e[(o+1)%i];let u=2;n+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(s+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&t&&(a+=l[0]*c[u]-c[0]*l[u])}return n<=0&&s<=0&&a<=0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r(7),n=r(99),s=r(134),a=r(161),o=r(151);const l=i.a.getLogger("esri.intl");function c(e,t,r={}){const{format:i={}}=r;return Object(s.c)(e,(e=>function(e,t,r){let i,s;const a=e.indexOf(":");if(-1===a?i=e.trim():(i=e.slice(0,a).trim(),s=e.slice(a+1).trim()),!i)return"";const o=Object(n.b)(i,t);if(null==o)return"";const l=r[s]||r[i];return l?u(o,l):s?d(o,s):h(o)}(e,t,i)))}function u(e,t){switch(t.type){case"date":return Object(a.b)(e,t.intlOptions);case"number":return Object(o.b)(e,t.intlOptions);default:return l.warn("missing format descriptor for key {key}"),h(e)}}function d(e,t){switch(t.toLowerCase()){case"dateformat":return Object(a.b)(e);case"numberformat":return Object(o.b)(e);default:return l.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Object(a.b)(e):/^numberformat/i.test(t)?Object(o.b)(e):h(e)}}function h(e){switch(typeof e){case"string":return e;case"number":return Object(o.b)(e);case"boolean":return""+e;default:return e instanceof Date?Object(a.b)(e):""}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return w})),r.d(t,"b",(function(){return C})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return _}));var i=r(69);const n="http://www.w3.org/",s=`${n}2000/svg`,a=`${n}1999/xlink`;let o,l=[],c=(e,t)=>{let r={};return Object.keys(e).forEach((t=>{r[t]=e[t]})),t&&Object.keys(t).forEach((e=>{r[e]=t[e]})),r},u=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),d=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},h=(e,t,r)=>{if(""!==t.vnodeSelector)for(let i=r;i<e.length;i++)if(u(e[i],t))return i;return-1},p=(e,t,r,i)=>{let n=e[t];if(""===n.vnodeSelector)return;let s=n.properties;if(!(s?void 0===s.key?s.bind:s.key:void 0))for(let a=0;a<e.length;a++)if(a!==t){let t=e[a];if(u(t,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${"added"===i?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},f=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},b=[],m=!1,g=e=>{(e.children||[]).forEach(g),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},y=()=>{m=!1,b.forEach(g),b.length=0},v=e=>{b.push(e),m||(m=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(y,{timeout:16}):setTimeout(y,16))},O=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r){t.style.pointerEvents="none";let i=()=>{t.parentNode&&(t.parentNode.removeChild(t),v(e))};return void r(t,i,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),v(e))},j=(e,t,r)=>{if(!t)return;let n=r.eventHandlerInterceptor,o=Object.keys(t),l=o.length;for(let c=0;c<l;c++){let l=o[c],u=t[l];if("className"===l)throw new Error('Property "className" is not supported, use "class".');if("class"===l)x(e,u,!0);else if("classes"===l){let t=Object.keys(u),r=t.length;for(let i=0;i<r;i++){let r=t[i];u[r]&&e.classList.add(r)}}else if("styles"===l){let t=Object.keys(u),i=t.length;for(let n=0;n<i;n++){let i=t[n],s=u[i];s&&(d(s),r.styleApplyer(e,i,s))}}else if("key"!==l&&null!=u){let o=typeof u;"function"===o?(0===l.lastIndexOf("on",0)&&(n&&(u=n(l,u,e,t)),"oninput"===l&&function(){let e=u;u=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}()),e[l]=u):r.namespace===s?"href"===l?e.setAttributeNS(a,l,u):e.setAttribute(l,u):"string"===o&&"value"!==l?"innerHTML"===l?e[l]=i.i.sanitize(u):e.setAttribute(l,u):e[l]=u}}},_=(e,t,r)=>{((e,t,r)=>{if(t)for(let i of t)w(i,e,void 0,r)})(e,t.children,r),t.text&&(e.textContent=t.text),j(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},w=(e,t,r,i)=>{let n,a=0,o=e.vnodeSelector,l=t.ownerDocument;if(""===o)n=e.domNode=l.createTextNode(e.text),void 0!==r?t.insertBefore(n,r):t.appendChild(n);else{for(let u=0;u<=o.length;++u){let d=o.charAt(u);if(u===o.length||"."===d||"#"===d){let d=o.charAt(a-1),h=o.slice(a,u);"."===d?n.classList.add(h):"#"===d?n.id=h:("svg"===h&&(i=c(i,{namespace:s})),void 0!==i.namespace?n=e.domNode=l.createElementNS(i.namespace,h):(n=e.domNode=e.domNode||l.createElement(h),"input"===h&&e.properties&&void 0!==e.properties.type&&n.setAttribute("type",e.properties.type)),void 0!==r?t.insertBefore(n,r):n.parentNode!==t&&t.appendChild(n)),a=u+1}}_(n,e,i)}},x=(e,t,r)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,r)}))},S=(e,t,r,n)=>{if(!r)return;let o=!1,l=Object.keys(r),c=l.length;for(let u=0;u<c;u++){let c=l[u],h=r[c],p=t[c];if("class"===c)p!==h&&(x(e,p,!1),x(e,h,!0));else if("classes"===c){let t=e.classList,r=Object.keys(h),i=r.length;for(let e=0;e<i;e++){let i=r[e],n=!!h[i];n!==!!p[i]&&(o=!0,n?t.add(i):t.remove(i))}}else if("styles"===c){let t=Object.keys(h),r=t.length;for(let i=0;i<r;i++){let r=t[i],s=h[r];s!==p[r]&&(o=!0,s?(d(s),n.styleApplyer(e,r,s)):n.styleApplyer(e,r,""))}}else if(h||"string"!=typeof p||(h=""),"value"===c){let t=e[c];t!==h&&(e["oninput-value"]?t===e["oninput-value"]:h!==p)&&(e[c]=h,e["oninput-value"]=void 0),h!==p&&(o=!0)}else if(h!==p){let t=typeof h;"function"===t&&n.eventHandlerInterceptor||(n.namespace===s?"href"===c?e.setAttributeNS(a,c,h):e.setAttribute(c,h):"string"===t?"innerHTML"===c?e[c]=i.i.sanitize(h):"role"===c&&""===h?e.removeAttribute(c):e.setAttribute(c,h):e[c]!==h&&(e[c]=h),o=!0)}}return o},T=(e,t,r,i,n)=>{if(r===i)return!1;i=i||l;let s,a=(r=r||l).length,c=i.length,d=0,b=0,m=!1;for(;b<c;){let l=d<a?r[d]:void 0,c=i[b];if(void 0!==l&&u(l,c))m=o(l,c,n)||m,d++;else{let l=h(r,c,d+1);if(l>=0){for(s=d;s<l;s++)O(r[s]),p(r,s,e,"removed");m=o(r[l],c,n)||m,d=l+1}else w(c,t,d<a?r[d].domNode:void 0,n),f(c),p(i,b,e,"added")}b++}if(a>d)for(s=d;s<a;s++)O(r[s]),p(r,s,e,"removed");return m};o=(e,t,r)=>{let i=e.domNode,n=!1;if(e===t)return!1;let a=!1;if(""===t.vnodeSelector){if(t.text!==e.text){let e=i.ownerDocument.createTextNode(t.text);return i.parentNode.replaceChild(e,i),t.domNode=e,n=!0,n}t.domNode=i}else 0===t.vnodeSelector.lastIndexOf("svg",0)&&(r=c(r,{namespace:s})),e.text!==t.text&&(a=!0,void 0===t.text?i.removeChild(i.firstChild):i.textContent=t.text),t.domNode=i,a=T(t,i,e.children,t.children,r)||a,a=S(i,e.properties,t.properties,r)||a,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[i,r,t.vnodeSelector,t.properties,t.children]);return a&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(i,t.properties,e.properties),n};let C=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=e;e=r,o(i,r,t)},domNode:e.domNode})},function(e,t,r){"use strict";var i,n=r(0),s=r(113),a=r(221),o=r(44),l=r(14),c=r(13),u=r(1),d=r(9),h=(r(8),r(7),r(4)),p=r(29),f=r(85);let b=i=class extends l.a{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new i({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};Object(n.a)([Object(u.b)({type:[String],json:{write:!0}})],b.prototype,"groupByFields",void 0),Object(n.a)([Object(u.b)({type:Number,json:{write:!0}})],b.prototype,"topCount",void 0),Object(n.a)([Object(u.b)({type:[String],json:{write:!0}})],b.prototype,"orderByFields",void 0),b=i=Object(n.a)([Object(h.a)("esri.rest.support.TopFilter")],b);var m,g=b,y=r(39);const v=new o.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),O=new o.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let j=m=class extends l.a{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new m(Object(c.a)({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};Object(n.a)([Object(u.b)({type:Boolean,json:{write:!0}})],j.prototype,"cacheHint",void 0),Object(n.a)([Object(u.b)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],j.prototype,"distance",void 0),Object(n.a)([Object(u.b)({types:s.a,json:{read:f.a,write:!0}})],j.prototype,"geometry",void 0),Object(n.a)([Object(u.b)({type:Number,json:{write:!0}})],j.prototype,"geometryPrecision",void 0),Object(n.a)([Object(u.b)({type:Number,json:{write:!0}})],j.prototype,"maxAllowableOffset",void 0),Object(n.a)([Object(u.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],j.prototype,"num",void 0),Object(n.a)([Object(u.b)({json:{write:!0}})],j.prototype,"objectIds",void 0),Object(n.a)([Object(u.b)({type:[String],json:{write:!0}})],j.prototype,"orderByFields",void 0),Object(n.a)([Object(u.b)({type:[String],json:{write:!0}})],j.prototype,"outFields",void 0),Object(n.a)([Object(u.b)({type:y.a,json:{read:{source:"outSR"},write:{target:"outSR"}}})],j.prototype,"outSpatialReference",void 0),Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],j.prototype,"resultType",void 0),Object(n.a)([Object(u.b)({json:{write:!0}})],j.prototype,"returnGeometry",void 0),Object(n.a)([Object(u.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],j.prototype,"returnM",void 0),Object(n.a)([Object(u.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],j.prototype,"returnZ",void 0),Object(n.a)([Object(u.b)({type:Number,json:{read:{source:"resultOffset"}}})],j.prototype,"start",void 0),Object(n.a)([Object(p.a)("start"),Object(p.a)("num")],j.prototype,"writeStart",null),Object(n.a)([Object(u.b)({type:String,json:{read:{source:"spatialRel",reader:v.read},write:{target:"spatialRel",writer:v.write}}})],j.prototype,"spatialRelationship",void 0),Object(n.a)([Object(u.b)({type:a.a,json:{write:!0}})],j.prototype,"timeExtent",void 0),Object(n.a)([Object(u.b)({type:g,json:{write:!0}})],j.prototype,"topFilter",void 0),Object(n.a)([Object(u.b)({type:String,json:{read:O.read,write:{writer:O.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],j.prototype,"units",void 0),Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],j.prototype,"where",void 0),j=m=Object(n.a)([Object(h.a)("esri.rest.support.TopFeaturesQuery")],j),j.from=Object(d.m)(j);var _=j;t.a=_},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return l}));var i,n={exports:{}};void 0!==(i=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(n.exports=i);var s,a=n.exports,o={exports:{}};s=o,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];void 0!==t&&(s.exports=t)}();var l=o.exports,c={exports:{}};!function(e){!function(t){var r=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"];void 0!==r&&(e.exports=r)}()}(c);var u=c.exports},function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var i=r(0),n=r(19),s=r(42),a=r(2),o=r(128),l=r(23),c=r(189),u=r(289),d=r(1),h=r(4);let p=class extends n.a{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new s.a,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,r,i=0){const n=0!=(1&i),s=++this.handleId;n||this.installSyncUpdatingWatch(e,t,s);const a=0!=(2&i)?Object(l.a)(e,t,r,n):e.watch(t,r,n);return this.handles.add(a,s),{remove:()=>this.handles.remove(s)}}addOnCollectionPropertyChange(e,t,r,i=0){const n=0!=(2&i),s=++this.handleId;return this.handles.add([Object(l.b)(e,t,"after-changes",this.createSyncUpdatingCallback()),Object(l.b)(e,t,"change",r,n?e=>{r({added:e.items,removed:[],moved:[],target:e})}:void 0)],s),{remove:()=>{this.handles.remove(s)}}}addOnCollectionChange(e,t,r=0){const i=0!=(2&r),n=++this.handleId;return this.handles.add([e.on("after-changes",this.createSyncUpdatingCallback()),e.on("change",t)],n),i&&t({added:e.items,removed:[],moved:[],target:e}),{remove:()=>{this.handles.remove(n)}}}addPromise(e){if(Object(a.i)(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(0!==this.pendingPromises.size||this.handles.has(f)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const r=()=>this.handles.remove(t);return e.then(r,r),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}installSyncUpdatingWatch(e,t,r){const i=this.createSyncUpdatingCallback(),n=Object(u.b)((()=>Object(c.c)(e,t)),i);return this.handles.add(n,r),n}createSyncUpdatingCallback(){return()=>{this.handles.remove(f),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(Object(o.b)((()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(f))})),f)}}};Object(i.a)([Object(d.b)({readOnly:!0})],p.prototype,"updating",void 0),p=Object(i.a)([Object(h.a)("esri.views.support.WatchUpdatingTracking")],p);const f=-42},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a}));var i=r(44);function n(e){return"point"===e||"multipoint"===e||"polyline"===e||"polygon"===e}const s=Object(i.b)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),a=Object(i.b)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"})},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return a}));var i=r(94),n=r(137);const s=Object(i.a)().vec3f("position"),a=Object(i.a)().vec3f("position").vec2f("uv0"),o=Object(i.a)().vec3f("position").vec4u8("color");class l{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){Object(n.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return h}));var i=r(11),n=r(12),s=r(125);const a=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,o={ar:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function l(e){var t;return null!=(t=o[e])&&t}const c=[],u=new Map;function d(e){for(const t of u.keys())b(e.pattern,t)&&u.delete(t)}function h(e){return c.includes(e)||(d(e),c.unshift(e)),{remove(){const t=c.indexOf(e);t>-1&&(c.splice(t,1),d(e))}}}async function p(e){const t=Object(s.b)();u.has(e)||u.set(e,async function(e,t){const r=[];for(const i of c)if(b(i.pattern,e))try{return await i.fetchMessageBundle(e,t)}catch(a){r.push(a)}if(r.length)throw new i.a("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r});throw new i.a("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,t));const r=u.get(e);return await m.add(r),r}function f(e){if(!a.test(e))return null;const[,t,r]=a.exec(e),i=t+(r?"-"+r.toUpperCase():"");return l(i)?i:l(t)?t:null}function b(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}Object(s.a)((()=>{u.clear()}));const m=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Object(n.g)())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return h}));var i=r(16),n=r(20),s=r(3),a=r(5),o=r(40),l=r(31),c=r(141),u=r(64),d=r(149);function h(e){return(t,r,i)=>(Object(s.k)(b,t,r,i),!Object(c.f)(e,b))}class p{constructor(){this.min=new f,this.max=new f,this.hud=new f,this.ground=new f}init(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}class f{constructor(e){this.normal=Object(a.e)(),this.transformation=Object(n.d)(),this._ray=Object(u.c)(),this.init(e)}get ray(){return this._ray}get hasIntersectionPoint(){return null!=this.dist}get distanceInRenderSpace(){if(null!=this.dist)return Object(s.g)(m,this.ray.direction,this.dist),Object(s.r)(m)}getIntersectionPoint(e){return!!this.hasIntersectionPoint&&(Object(s.g)(m,this.ray.direction,this.dist),Object(s.h)(e,this.ray.origin,m),!0)}getTransformedNormal(e){return Object(s.m)(g,this.normal),g[3]=0,Object(o.m)(g,g,this.transformation),Object(s.m)(e,g),Object(s.t)(e,e),e}init(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?Object(u.b)(e,this._ray):this._ray=Object(u.c)()}set(e,t,r,n,o,l,c,u,h,p){e instanceof d.a&&(e={type:"stage",obj:e}),this.dist=r,Object(s.m)(this.normal,n),Object(i.d)(this.transformation,o),this.target=e,this.name=t,this.drapedLayerOrder=l,this.center=c?Object(a.c)(c):null,this.geometryId=u,this.triangleNr=h,this.drapedLayerGraphicOrder=p}copyFrom(e){Object(u.b)(e.ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(a.c)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s.m)(this.normal,e.normal),Object(i.d)(this.transformation,e.transformation)}}const b=Object(a.e)(),m=Object(a.e)(),g=Object(l.e)()},function(e,t,r){"use strict";function i(){return new Float32Array(2)}function n(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function s(){return i()}function a(){return n(1,1)}function o(){return n(1,0)}function l(){return n(0,1)}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));const c=s(),u=a(),d=o(),h=l();Object.freeze({__proto__:null,create:i,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:n,createView:function(e,t){return new Float32Array(e,t,2)},zeros:s,ones:a,unitX:o,unitY:l,ZEROS:c,ONES:u,UNIT_X:d,UNIT_Y:h})},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(i.a`void forwardTextureCoordinates() {
vuv0 = uv0;
}`)),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(i.a`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`)),0===t.attributeTextureCoordinates&&e.vertex.code.add(i.a`void forwardTextureCoordinates() {}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(171);class n{constructor(){this.id=Object(i.b)()}unload(){}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return c}));r(8);var i,n,s=r(342),a=r(272),o=r(346),l=r(347);function c(e,t){switch(e.type){case"range":{const r="range"in e?e.range[0]:e.minValue,n="range"in e?e.range[1]:e.maxValue;if(+t<r||+t>n)return i.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==e.codedValues||e.codedValues.every((e=>null==e||e.code!==t)))return i.INVALID_CODED_VALUE}return null}(n=i||(i={})).VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",n.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value";const u={key:"type",base:a.a,typeMap:{range:l.a,"coded-value":s.a,inherited:o.a}};function d(e){if(e&&"range"===e.type)return{min:"range"in e?e.range[0]:e.minValue,max:"range"in e?e.range[1]:e.maxValue}}function h(e){if(!e||!e.type)return null;switch(e.type){case"range":return l.a.fromJSON(e);case"codedValue":return s.a.fromJSON(e);case"inherited":return o.a.fromJSON(e)}return null}},function(e,t,r){"use strict";var i,n=r(0),s=r(19),a=r(44),o=r(13),l=r(1),c=(r(9),r(8),r(7),r(4)),u=r(50),d=r(39),h=r(46);const p=new a.a({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let f=i=class extends s.a{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){"asc"!==e&&"desc"!==e||this._set("sortOrder",e)}clone(){return new i({categories:this.categories?Object(o.a)(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let r,i;if(this.categories&&(r=this.categories.map((e=>Array.isArray(e)?JSON.stringify(e):e))),this.extent){const e=Object(h.d)(this.extent,d.a.WGS84);e&&(i=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`)}let n=this.query;!this.disableExtraQuery&&e.extraQuery&&(n="("+n+")"+e.extraQuery);const s={categories:r,bbox:i,q:n,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map((e=>p.toJSON(e.trim()))).join(","),s.sortOrder=this.sortOrder),{query:{...t,...s}}}};Object(n.a)([Object(l.b)()],f.prototype,"categories",void 0),Object(n.a)([Object(l.b)()],f.prototype,"disableExtraQuery",void 0),Object(n.a)([Object(l.b)({type:u.a})],f.prototype,"extent",void 0),Object(n.a)([Object(l.b)()],f.prototype,"num",void 0),Object(n.a)([Object(l.b)()],f.prototype,"query",void 0),Object(n.a)([Object(l.b)()],f.prototype,"sortField",void 0),Object(n.a)([Object(l.b)()],f.prototype,"sortOrder",null),Object(n.a)([Object(l.b)()],f.prototype,"start",void 0),f=i=Object(n.a)([Object(c.a)("esri.portal.PortalQueryParams")],f);var b=f;t.a=b},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return d}));var i=r(134);const n="__begin__",s="__end__",a=new RegExp(n,"ig"),o=new RegExp(s,"ig"),l=new RegExp("^"+n,"i"),c=new RegExp(s+"$","i"),u='"';function d(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function h(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(e.labelExpression),t.type="conventional"),t}function p(e){const t=h(e);if(!t)return null;switch(t.type){case"conventional":return b(t.expression);case"arcade":return t.expression}return null}function f(e){const t=h(e);if(!t)return null;switch(t.type){case"conventional":return function(e){const t=e.match(m);return t&&t[1].trim()||null}(t.expression);case"arcade":return O(t.expression)}return null}function b(e){let t;return e?(t=Object(i.c)(e,(e=>n+'$feature["'+e+'"]'+s)),t=l.test(t)?t.replace(l,""):u+t,t=c.test(t)?t.replace(c,""):t+u,t=t.replace(a,'" + ').replace(o,' + "')):t='""',t}const m=/^\s*\{([^}]+)\}\s*$/i;const g=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,y=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,v=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function O(e){if(!e)return null;let t=g.exec(e)||y.exec(e);return t?t[1]||t[3]:(t=v.exec(e),t?t[2]:null)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return n})),r.d(t,"e",(function(){return s}));var i=r(87);function n(e){const t=[];return e.levels.forEach((e=>{e.components.forEach((e=>{t.push(e.material)}))})),Object(i.o)(t)}function s(e){const t=[];return e.levels.forEach((e=>{e.components.forEach((e=>{e.textures&&t.push(...e.textures)}))})),Object(i.o)(t)}function a(e){const t=[];return e.components.forEach((e=>{t.push(e.geometry)})),Object(i.o)(t)}function o(e){const t=[];return e.levels.forEach((e=>{e.components.forEach((e=>{t.push(e.geometry)}))})),Object(i.o)(t)}function l(e){return a(e).reduce(((e,t)=>e+t.indexCount/3),0)}},function(e,t,r){"use strict";t.a=class{constructor(e){this._texture=e,this._refCount=1}retain(){++this._refCount}release(){--this._refCount,0===this._refCount&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}},function(e,t,r){"use strict";e.exports=r(684)},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(4)),l=r(29),c=r(50),u=r(146),d=r(41),h=r(300);function p(e){return(t,r)=>null==t?r:null==r?t:e(t,r)}let f=i=class extends u.a{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const r={};Array.isArray(e)?(r.points=e,r.spatialReference=t):function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?r.spatialReference=e:(e.points&&(r.points=e.points),e.spatialReference&&(r.spatialReference=e.spatialReference),e.hasZ&&(r.hasZ=e.hasZ),e.hasM&&(r.hasM=e.hasM));const i=r.points&&r.points[0];return i&&(void 0===r.hasZ&&void 0===r.hasM?(r.hasZ=i.length>2,r.hasM=!1):void 0===r.hasZ?r.hasZ=i.length>3:void 0===r.hasM&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new c.a,r=this.hasZ,i=this.hasM,n=r?3:2,s=e[0],a=p(Math.min),o=p(Math.max);let l,u,d,h,[f,b]=s,[m,g]=s;for(let c=0,p=e.length;c<p;c++){const t=e[c],[s,p]=t;if(f=a(f,s),b=a(b,p),m=o(m,s),g=o(g,p),r&&t.length>2){const e=t[2];l=a(l,e),d=o(d,e)}if(i&&t.length>n){const e=t[n];u=a(u,e),h=o(h,e)}}return t.xmin=f,t.ymin=b,t.xmax=m,t.ymax=g,t.spatialReference=this.spatialReference,r?(t.zmin=l,t.zmax=d):(t.zmin=null,t.zmax=null),i?(t.mmin=u,t.mmax=h):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=Object(s.a)(this.points)}addPoint(e){return Object(h.a)(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:Object(s.a)(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new i(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],r={x:t[0],y:t[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=t[2],i=3),this.hasM&&(r.m=t[i]),new d.a(r)}removePoint(e){if(!this._validateInputs(e))return null;const t=new d.a(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(Object(h.a)(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write(null,e)}_validateInputs(e){return null!=e&&e>=0&&e<this.points.length}};Object(n.a)([Object(a.b)({readOnly:!0})],f.prototype,"cache",null),Object(n.a)([Object(a.b)()],f.prototype,"extent",null),Object(n.a)([Object(a.b)({type:[[Number]],json:{write:{isRequired:!0}}})],f.prototype,"points",void 0),Object(n.a)([Object(l.a)("points")],f.prototype,"writePoints",null),f=i=Object(n.a)([Object(o.a)("esri.geometry.Multipoint")],f),f.prototype.toJSON.isDefaultToJSON=!0;var b=f;t.a=b},function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return v})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return m})),r.d(t,"h",(function(){return g})),r.d(t,"i",(function(){return f})),r.d(t,"j",(function(){return y}));var i=r(2),n=r(25),s=r(115);const a=["MapServer","ImageServer","FeatureServer","SceneServer","StreamServer","VectorTileServer"],o=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),c=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function u(e){return!!o.test(e)}function d(e){const t=Object(n.K)(e),r=t.path.match(o)||t.path.match(l);if(!r)return null;const[,i,s,a,c]=r,u=s.indexOf("/");return{title:p(-1!==u?s.slice(u+1):s),serverType:a,sublayer:null!=c&&""!==c?parseInt(c,10):null,url:{path:i}}}function h(e){const t=Object(n.K)(e).path.match(c);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function p(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function f(e,t){const r=[];if(e){const t=d(e);Object(i.j)(t)&&t.title&&r.push(t.title)}if(t){const e=p(t);r.push(e)}if(2===r.length){if(-1!==r[0].toLowerCase().indexOf(r[1].toLowerCase()))return r[0];if(-1!==r[1].toLowerCase().indexOf(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function b(e){if(!e)return!1;const t=-1!==(e=e.toLowerCase()).indexOf(".arcgis.com/"),r=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features");return t&&r}function m(e,t){return e?Object(n.I)(Object(n.H)(e,t)):e}function g(e){let{url:t}=e;if(!t)return{url:t};t=Object(n.H)(t,e.logger);const r=Object(n.K)(t),s=d(r.path);let a;if(Object(i.j)(s))null!=s.sublayer&&null==e.layer.layerId&&(a=s.sublayer),t=s.url.path;else if(e.nonStandardUrlAllowed){const e=h(r.path);Object(i.j)(e)&&(t=e.serviceUrl,a=e.sublayerId)}return{url:Object(n.I)(t),layerId:a}}function y(e,t,r,i,a){Object(s.f)(t,i,"url",a),i.url&&null!=e.layerId&&(i.url=Object(n.z)(i.url,r,e.layerId.toString()))}function v(e){if(!e)return!1;const t=e.toLowerCase(),r=-1!==t.indexOf("/services/"),i=-1!==t.indexOf("/mapserver/wmsserver"),n=-1!==t.indexOf("/imageserver/wmsserver"),s=-1!==t.indexOf("/wmsserver");return r&&(i||n||s)}},function(e,t,r){"use strict";var i,n=r(0),s=r(38),a=r(11),o=r(13),l=r(2),c=r(1),u=(r(9),r(8),r(7),r(37)),d=r(4),h=r(29),p=r(348),f=r(263),b=r(190),m=r(253),g=r(279),y=r(212),v=r(208),O=r(350);const j=s.a.ofType({base:null,key:"type",typeMap:{extrude:p.a,fill:f.a,icon:b.a,line:m.a,object:g.a,text:v.a,water:O.a}}),_=s.a.ofType({base:null,key:"type",typeMap:{extrude:p.a,fill:f.a,icon:b.a,line:m.a,object:g.a,water:O.a}});let w=i=class extends y.a{constructor(e){super(e),this.symbolLayers=new j,this.type="polygon-3d"}writeSymbolLayers(e,t,r,i){const n=e.filter((e=>"text"!==e.type));if(i&&i.messages&&n.length<e.length){const t=e.find((e=>"text"===e.type));i.messages.push(new a.a("symbol-layer:unsupported","Symbol layers of type 'text' cannot be persisted in PolygonSymbol3D",{symbolLayer:t}))}t[r]=n.map((e=>e.write({},i))).toArray()}clone(){return new i({styleOrigin:Object(o.a)(this.styleOrigin),symbolLayers:Object(o.a)(this.symbolLayers),thumbnail:Object(o.a)(this.thumbnail)})}static fromJSON(e){const t=new i;if(t.read(e),2===t.symbolLayers.length&&"fill"===t.symbolLayers.getItemAt(0).type&&"line"===t.symbolLayers.getItemAt(1).type){const r=t.symbolLayers.getItemAt(0),i=t.symbolLayers.getItemAt(1);!i.enabled||e.symbolLayers&&e.symbolLayers[1]&&!1===e.symbolLayers[1].enable||(r.outline={size:i.size,color:Object(l.j)(i.material)?i.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new i({symbolLayers:[f.a.fromSimpleFillSymbol(e)]})}};Object(n.a)([Object(c.b)({type:j,json:{type:_}})],w.prototype,"symbolLayers",void 0),Object(n.a)([Object(h.a)("web-scene","symbolLayers")],w.prototype,"writeSymbolLayers",null),Object(n.a)([Object(u.a)({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],w.prototype,"type",void 0),w=i=Object(n.a)([Object(d.a)("esri.symbols.PolygonSymbol3D")],w);var x=w;t.a=x},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u}));var i=r(7),n=r(99),s=r(181),a=r(194),o=r(498);const l=i.a.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function c(e,t,r){var i,s;e&&(!r&&!t.read||null!=(i=t.read)&&i.reader||!1===(null==(s=t.read)?void 0:s.enabled)||function(e){return"types"in e?m(e.types):b(e.type)}(e)&&Object(n.c)("read.reader",u(e),t))}function u(e){var t;const r=null!=(t=e.ndimArray)?t:0;if(r>1)return function(e){var t;const r=d(e),i=h.bind(null,r),n=null!=(t=e.ndimArray)?t:0;return(e,t,r)=>{if(null==e)return e;e=i(e,r,n);let s=n,a=e;for(;s>0&&Array.isArray(a);)s--,a=a[0];if(void 0!==a)for(let i=0;i<s;i++)e=[e];return e}}(e);if(1===r)return p(e);if("type"in e&&f(e.type)){var i,n;const t=null==(i=e.type.prototype)||null==(n=i.itemType)?void 0:n.Type,r=p("function"==typeof t?{type:t}:{types:t});return(t,i,n)=>{const s=r(t,i,n);return s?new e.type(s):s}}return d(e)}function d(e){return"type"in e?function(e){return e.prototype.read?(t,r,i)=>{if(null==t)return t;const n=typeof t;if("object"!==n)return void l.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${n}'`);const s=new e;return s.read(t,i),s}:e.fromJSON}(e.type):function(e){var t;let r=null;const i=null!=(t=e.errorContext)?t:"type";return(t,n,o)=>{if(null==t)return t;const c=typeof t;if("object"!==c)return void l.error(`Expected JSON value of type 'object' to deserialize, but got '${c}'`);r||(r=function(e){const t={};for(const n in e.typeMap){var r,i;const s=e.typeMap[n],o=Object(a.a)(s.prototype);if("function"==typeof e.key)continue;const l=o.properties[e.key];if(!l)continue;null!=(r=l.json)&&r.type&&Array.isArray(l.json.type)&&1===l.json.type.length&&"string"==typeof l.json.type[0]&&(t[l.json.type[0]]=s);const c=null==(i=l.json)?void 0:i.write;if(!c||!c.writer){t[n]=s;continue}const u=c.target,d="string"==typeof u?u:e.key,h={};c.writer(n,h,d),h[d]&&(t[h[d]]=s)}return t}(e));const u=e.key;if("string"!=typeof u)return;const d=t[u],h=d?r[d]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const e=`Type '${d||"unknown"}' is not supported`;return o&&o.messages&&t&&o.messages.push(new s.a(`${i}:unsupported`,e,{definition:t,context:o})),void l.error(e)}const p=new h;return p.read(t,o),p}}(e.types)}function h(e,t,r,i){return 0!==i&&Array.isArray(t)?t.map((t=>h(e,t,r,i-1))):e(t,void 0,r)}function p(e){const t=d(e);return(e,r,i)=>{if(null==e)return e;if(Array.isArray(e)){const r=[];for(const n of e){const e=t(n,void 0,i);void 0!==e&&r.push(e)}return r}const n=t(e,void 0,i);return void 0!==n?[n]:void 0}}function f(e){if(!Object(o.a)(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&("function"==typeof t.Type?b(t.Type):m(t.Type))}function b(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||f(e))}function m(e){for(const t in e.typeMap)if(!b(e.typeMap[t]))return!1;return!0}},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(13),o=r(17),l=r(1),c=r(45),u=(r(8),r(7),r(37)),d=r(4),h=r(29),p=r(323),f=r(121);let b=i=class extends f.a{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new p.a,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment=null,this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const i={};return e&&(i.text=e),t&&(i.font=t),r&&(i.color=r),i}writeLineWidth(e,t,r,i){i&&"string"!=typeof i?i.origin:t[r]=e}castLineWidth(e){return Object(o.j)(e)}writeLineHeight(e,t,r,i){i&&"string"!=typeof i?i.origin:t[r]=e}clone(){return new i({angle:this.angle,backgroundColor:Object(a.a)(this.backgroundColor),borderLineColor:Object(a.a)(this.borderLineColor),borderLineSize:this.borderLineSize,color:Object(a.a)(this.color),font:this.font&&this.font.clone(),haloColor:Object(a.a)(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};Object(n.a)([Object(l.b)({type:s.a,json:{write:!0}})],b.prototype,"backgroundColor",void 0),Object(n.a)([Object(l.b)({type:s.a,json:{write:!0}})],b.prototype,"borderLineColor",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],b.prototype,"borderLineSize",void 0),Object(n.a)([Object(l.b)({type:p.a,json:{write:!0}})],b.prototype,"font",void 0),Object(n.a)([Object(l.b)({type:["left","right","center","justify"],json:{write:!0}})],b.prototype,"horizontalAlignment",void 0),Object(n.a)([Object(l.b)({type:Boolean,json:{write:!0}})],b.prototype,"kerning",void 0),Object(n.a)([Object(l.b)({type:s.a,json:{write:!0}})],b.prototype,"haloColor",void 0),Object(n.a)([Object(l.b)({type:Number,cast:o.j,json:{write:!0}})],b.prototype,"haloSize",void 0),Object(n.a)([Object(l.b)({type:Boolean,json:{write:!0}})],b.prototype,"rightToLeft",void 0),Object(n.a)([Object(l.b)({type:Boolean,json:{write:!0}})],b.prototype,"rotated",void 0),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],b.prototype,"text",void 0),Object(n.a)([Object(u.a)({esriTS:"text"},{readOnly:!0})],b.prototype,"type",void 0),Object(n.a)([Object(l.b)({type:["baseline","top","middle","bottom"],json:{write:!0}})],b.prototype,"verticalAlignment",void 0),Object(n.a)([Object(l.b)({type:Number,cast:o.j,json:{write:!0}})],b.prototype,"xoffset",void 0),Object(n.a)([Object(l.b)({type:Number,cast:o.j,json:{write:!0}})],b.prototype,"yoffset",void 0),Object(n.a)([Object(l.b)({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],b.prototype,"angle",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],b.prototype,"width",void 0),Object(n.a)([Object(l.b)({type:Number})],b.prototype,"lineWidth",void 0),Object(n.a)([Object(h.a)("lineWidth")],b.prototype,"writeLineWidth",null),Object(n.a)([Object(c.a)("lineWidth")],b.prototype,"castLineWidth",null),Object(n.a)([Object(l.b)({type:Number})],b.prototype,"lineHeight",void 0),Object(n.a)([Object(h.a)("lineHeight")],b.prototype,"writeLineHeight",null),b=i=Object(n.a)([Object(d.a)("esri.symbols.TextSymbol")],b);var m=b;t.a=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var i=r(2),n=r(171),s=r(16),a=r(20),o=r(3),l=r(31),c=r(67),u=r(136),d=r(352),h=r(123);class p{constructor(e,t,r=null,i=null,s=Object(n.b)(),o=null,c=null,u=!1){this.data=e,this.material=t,this.layerUid=r,this.graphicUid=i,this.id=s,this.boundingInfo=o,this.calculateShaderTransformation=c,this.castShadow=u,this.boundingSphere=Object(l.e)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this._transformation=Object(a.d)(),this._shaderTransformationDirty=!0}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,r=Object(c.i)(e)){Object(i.i)(this.boundingInfo)||(Object(o.s)(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return Object(i.j)(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(i.i)(this.calculateShaderTransformation)?Object(i.t)(this.transformation,a.a):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(a.d)()),Object(s.d)(this._shaderTransformation,this.calculateShaderTransformation(Object(i.t)(this.transformation,a.a))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(i.j)(this._transformation)&&Object(o.s)(e,e,this._transformation),!0);const t=this.indices.get("position"),r=this.vertexAttributes.get("position");return!!Object(u.c)(r,t,e)&&(Object(i.j)(this._transformation)&&Object(o.s)(e,e,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new d.a(0),t=this.instanceParameters;return t.highlights=Object(h.b)(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(h.g)(t.highlights,e)}}},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(44),o=r(13),l=r(17),c=r(1),u=(r(9),r(8),r(7),r(37)),d=r(4),h=r(29),p=r(390),f=r(152);const b=new a.a({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let m=i=class extends p.a{constructor(...e){super(...e),this.color=new s.a([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new f.a}normalizeCtorArgs(e,t,r,i){if(e&&"string"!=typeof e)return e;const n={};return e&&(n.style=e),null!=t&&(n.size=Object(l.j)(t)),r&&(n.outline=r),i&&(n.color=i),n}writeColor(e,t){e&&"x"!==this.style&&"cross"!==this.style&&(t.color=e.toJSON()),null===e&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new i({angle:this.angle,color:Object(o.a)(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${null==(e=this.outline)?void 0:e.hash()}`}};Object(n.a)([Object(c.b)()],m.prototype,"color",void 0),Object(n.a)([Object(h.a)("color")],m.prototype,"writeColor",null),Object(n.a)([Object(u.a)({esriSMS:"simple-marker"},{readOnly:!0})],m.prototype,"type",void 0),Object(n.a)([Object(c.b)()],m.prototype,"size",void 0),Object(n.a)([Object(c.b)({type:b.apiValues,json:{read:b.read,write:b.write}})],m.prototype,"style",void 0),Object(n.a)([Object(c.b)({type:String,json:{write:!0}})],m.prototype,"path",null),Object(n.a)([Object(c.b)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":f.a}},json:{default:null,write:!0}})],m.prototype,"outline",void 0),m=i=Object(n.a)([Object(d.a)("esri.symbols.SimpleMarkerSymbol")],m);var g=m;t.a=g},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(170);let l=i=class extends o.a{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new i({text:this.text})}};Object(n.a)([Object(s.b)({type:String,json:{write:!0}})],l.prototype,"text",void 0),Object(n.a)([Object(s.b)({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"type",void 0),l=i=Object(n.a)([Object(a.a)("esri.popup.content.TextContent")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){1===t.viewingMode?e.vertex.code.add(i.a`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(i.a`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),1===t.viewingMode?e.vertex.code.add(i.a`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(i.a`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(4)),l=r(29),c=r(276),u=r(170);let d=i=class extends u.a{constructor(e){super(e),this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map((e=>e.toJSON()))}clone(){return new i({description:this.description,fieldInfos:Array.isArray(this.fieldInfos)?Object(s.a)(this.fieldInfos):null,title:this.title})}};Object(n.a)([Object(a.b)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],d.prototype,"description",void 0),Object(n.a)([Object(a.b)({type:[c.a]})],d.prototype,"fieldInfos",void 0),Object(n.a)([Object(l.a)("fieldInfos")],d.prototype,"writeFieldInfos",null),Object(n.a)([Object(a.b)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],d.prototype,"title",void 0),Object(n.a)([Object(a.b)({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],d.prototype,"type",void 0),d=i=Object(n.a)([Object(o.a)("esri.popup.content.FieldsContent")],d);var h=d;t.a=h},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(2),o=r(17),l=r(1),c=(r(8),r(9),r(7),r(37)),u=r(4),d=r(147),h=r(285),p=r(116),f=r(187);let b=i=class extends d.a{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Object(o.h)(1),this.stipplePattern=null,this.stippleOffColor=null}clone(){return new i({enabled:this.enabled,material:Object(a.j)(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,stipplePattern:this.stipplePattern?this.stipplePattern.slice():null,stippleOffColor:this.stippleOffColor?this.stippleOffColor.clone():null})}static fromSimpleLineSymbol(e){return new i({size:e.width||1,cap:e.cap||"butt",join:e.join||"miter",material:{color:(e.color||h.c).clone()}})}};Object(n.a)([Object(l.b)({type:f.a,json:{write:!0}})],b.prototype,"material",void 0),Object(n.a)([Object(c.a)({Line:"line"},{readOnly:!0})],b.prototype,"type",void 0),Object(n.a)([Object(l.b)({type:["miter","bevel","round"],json:{write:!0,default:"miter"}})],b.prototype,"join",void 0),Object(n.a)([Object(l.b)({type:["butt","square","round"],json:{write:!0,default:"butt"}})],b.prototype,"cap",void 0),Object(n.a)([Object(l.b)(p.b)],b.prototype,"size",void 0),Object(n.a)([Object(l.b)(p.c)],b.prototype,"stipplePattern",void 0),Object(n.a)([Object(l.b)({type:s.a})],b.prototype,"stippleOffColor",void 0),b=i=Object(n.a)([Object(u.a)("esri.symbols.LineSymbol3DLayer")],b);var m=b;t.a=m},function(e,t,r){"use strict";var i,n=r(0),s=(r(113),r(14)),a=r(13),o=r(1),l=r(9),c=(r(8),r(7),r(4)),u=r(29),d=r(294),h=r(39);let p=i=class extends s.a{constructor(e){super(e),this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}clone(){return new i(Object(a.a)({dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};Object(n.a)([Object(o.b)({type:d.a,json:{write:!0}})],p.prototype,"dynamicDataSource",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],p.prototype,"gdbVersion",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],p.prototype,"geometryPrecision",void 0),Object(n.a)([Object(o.b)({type:Date})],p.prototype,"historicMoment",void 0),Object(n.a)([Object(u.a)("historicMoment")],p.prototype,"_writeHistoricMoment",null),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],p.prototype,"maxAllowableOffset",void 0),Object(n.a)([Object(o.b)({type:[Number],json:{write:!0}})],p.prototype,"objectIds",void 0),Object(n.a)([Object(o.b)({type:[String],json:{write:!0}})],p.prototype,"orderByFields",void 0),Object(n.a)([Object(o.b)({type:[String],json:{write:!0}})],p.prototype,"outFields",void 0),Object(n.a)([Object(o.b)({type:h.a,json:{read:{source:"outSR"},write:{target:"outSR"}}})],p.prototype,"outSpatialReference",void 0),Object(n.a)([Object(o.b)({json:{write:!0}})],p.prototype,"relationshipId",void 0),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"resultOffset"}}})],p.prototype,"start",void 0),Object(n.a)([Object(u.a)("start"),Object(u.a)("num")],p.prototype,"writeStart",null),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],p.prototype,"num",void 0),Object(n.a)([Object(o.b)({json:{write:!0}})],p.prototype,"returnGeometry",void 0),Object(n.a)([Object(o.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnM",void 0),Object(n.a)([Object(o.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnZ",void 0),Object(n.a)([Object(o.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],p.prototype,"where",void 0),p=i=Object(n.a)([Object(c.a)("esri.rest.support.RelationshipQuery")],p),p.from=Object(l.m)(p);var f=p;t.a=f},function(e,t,r){"use strict";r.d(t,"a",(function(){return Y})),r.d(t,"b",(function(){return W})),r.d(t,"c",(function(){return K}));var i=r(0),n=r(19),s=r(42),a=r(7),o=r(108),l=r(2),c=r(59),u=r(453),d=r(23),h=r(1),p=(r(8),r(9),r(4)),f=r(16),b=r(27),m=r(5),g=r(70),y=r(434),v=r(234),O=(r(66),r(93)),j=(r(109),r(145),r(228),r(47));r(90);class _{constructor(e,t){this.size=Object(v.a)(),this._fbo=null,this._fbo=new O.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Object(l.f)(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var e;null==(e=this._fbo)||e.resize(0,0)}get gpuMemoryUsage(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}class w{constructor(e){this.renderTargets=null;const t=(t,r,i=!0)=>({type:r,fbo:new _(e,i),renderPass:t,valid:!1,lastUsed:1/0});this.renderTargets=[t(0,0),t(0,1),t(5,2,!1),t(3,3),t(0,4)]}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,r){if(e)t.lastUsed=r;else if(r-t.lastUsed>x)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce(((e,t)=>e+t.fbo.gpuMemoryUsage),0)}}const x=1e3;var S=r(516),T=r(106),C=r(72),M=r(535),P=r(111),A=r(485),E=r(233),R=r(519),I=r(397),D=r(103),F=r(520),L=r(532);let k=class extends n.a{constructor(){super(...arguments),this._pending=new z,this._changes=new I.a,this._materialRenderers=new Map,this._sortedMaterialRenderers=new c.a,this._hasHighlights=!1,this._hasWater=!1}dispose(){this._changes.prune(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Object(o.b)(this._materialRenderers,(e=>e.rendersOccluded))}stopAnimationsAtTime(e){this._sortedMaterialRenderers.forAll((t=>Object(l.c)(t.material.animation,(t=>t.stopAtTime(e)))))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Object(F.a)(this._changes);let t=!1,r=!1,i=!1;return e.forEach(((e,n)=>{let s=this._materialRenderers.get(n);if(!s&&e.adds.length>0&&(s=new L.a(this.rctx,this.materialRepository,n),this._materialRenderers.set(n,s),t=!0,r=!0,i=!0),!s)return;const a=r||s.hasHighlights,o=i||s.hasWater;s.modify(e),r=r||a!==s.hasHighlights,i=i||o!==s.hasWater,s.isEmpty&&(this._materialRenderers.delete(n),s.dispose(),t=!0)})),this._changes.clear(),t&&this.updateSortedMaterialRenderers(),r&&(this._hasHighlights=Object(o.b)(this._materialRenderers,(e=>e.hasHighlights))),i&&(this._hasWater=Object(o.b)(this._materialRenderers,(e=>e.hasWater))),this.notifyChange("updating"),!0}add(e){if(0===e.length)return;const t=this._pending.empty;for(const r of e)this._pending.adds.add(r);t&&this.notifyChange("updating")}remove(e){const t=this._pending.empty;for(const r of e)this._pending.adds.has(r)?(this._pending.removed.add(r),this._pending.adds.delete(r)):this._pending.removed.has(r)||this._pending.removes.add(r);t&&!this._pending.empty&&this.notifyChange("updating")}modify(e,t){const r=0===this._changes.updates.length;for(const i of e){const e=this._changes.updates.pushNew();e.renderGeometry=i,e.updateType=t}r&&this._changes.updates.length>0&&this.notifyChange("updating")}updateLogic(e){let t=!1;return this._sortedMaterialRenderers.forAll((({materialRenderer:r})=>{r.updateLogic&&r.updateLogic(e)&&(t=!0)})),t}render(e,t){for(let r=0;r<this._sortedMaterialRenderers.length;r++){const i=this._sortedMaterialRenderers.data[r];Object(D.c)(i.material,e)&&i.materialRenderer.render(null,e.pass,t,null)}}updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach(((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push({material:r,materialRenderer:t})})),this._sortedMaterialRenderers.sort(((e,t)=>{const r=t.material.renderPriority-e.material.renderPriority;return 0!==r?r:e.material.insertOrder-t.material.insertOrder}))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};Object(i.a)([Object(h.b)()],k.prototype,"rctx",void 0),Object(i.a)([Object(h.b)()],k.prototype,"materialRepository",void 0),Object(i.a)([Object(h.b)()],k.prototype,"updating",null),k=Object(i.a)([Object(p.a)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],k);class z{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}var V=r(404),N=r(220),U=r(533),B=r(524),G=r(80),q=r(78);const H=a.a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");let W=class extends(Object(T.b)(n.a)){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._lighting=new U.a,this._handles=new s.a,this._layerRenderers=new Map,this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers=new c.a,this._geometries=new Map,this.globalUnitScale=1,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext,this._renderContext=new R.a(this._rctx);const t=e.waterTextureRepository;this._stippleTextureRepository=new B.a(e.renderingContext),this._shaderTechniqueRepository=new S.a({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._handles.add([Object(d.a)(t,"loadingState",(()=>this.emitContentChanged())),Object(d.a)(this,"spatialReference",(e=>this._localOrigins=new A.a(e)))]),this._materialRepository=new M.a(e.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=e=>{(e.renderOccluded&K)>0!==this._rendersOccluded&&this.updateRendersOccluded(),this.emitContentChanged(),this.notifyChange("updating")},this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new N.a(Object(m.g)(1,1,1))]),this._bindParameters={slot:null,highlightDepthTexture:Object(P.b)(this._rctx),camera:Z,inverseViewport:Object(b.b)(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null},this._handles.add(this.view.resourceController.scheduler.registerTask(G.b.STAGE,this))}dispose(){this._handles.destroy(),this._layerRenderers.forEach((e=>e.dispose())),this._layerRenderers.clear(),this._debugTextureTechnique=Object(l.q)(this._debugTextureTechnique),this._debugPatternTexture=Object(l.f)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(l.f)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(l.f)(this._shaderTechniqueRepository),this._temporaryFBO=Object(l.f)(this._temporaryFBO),this._quadVAO=Object(l.f)(this._quadVAO),this._overlayRenderTarget=Object(l.f)(this._overlayRenderTarget)}get updating(){return this._sortedLayerRenderersDirty||Object(o.b)(this._layerRenderers,(e=>e.updating))}get hasOverlays(){return Object(l.j)(this._overlays)&&Object(l.j)(this._overlayRenderTarget)}get gpuMemoryUsage(){return Object(l.j)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}collectUnusedRenderTargetMemory(e){let t=!1;if(Object(l.j)(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const i=this.overlays[0].validTargets[r.type]||!this.overlays[1].validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(i,r,e)||t}return t}get overlays(){return Object(l.t)(this._overlays,[])}ensureDrapeTargets(e){Object(l.j)(this._overlays)&&this._overlays.forEach((t=>{t.hasTargetWithoutRasterImage=Object(u.a)(e,(e=>1===e.drapeTargetType))}))}ensureDrapeSources(e){Object(l.j)(this._overlays)&&this._overlays.forEach((t=>{t.hasDrapedFeatureSource=Object(o.b)(e,((e,t)=>1===t.drapeSourceType)),t.hasDrapedRasterSource=Object(o.b)(e,((e,t)=>0===t.drapeSourceType))}))}ensureOverlays(e,t){Object(l.i)(this._overlays)&&(this._overlayRenderTarget=new w(this._rctx),this._overlays=[new y.a(0,this._overlayRenderTarget),new y.a(1,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){Object(l.j)(this._overlayRenderTarget)&&this._overlayRenderTarget.disposeRenderTargetMemory()}get running(){return this.updating}runTask(e,t=(()=>!0)){let r=!1;for(const[i,n]of this._layerRenderers){if(e.done)break;t(i)&&(n.commitChanges()&&(r=!0,e.madeProgress()),n.isEmpty&&(this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(i),this._handles.remove(i)))}this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),r=!0),r&&(Object(l.j)(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}processSyncLayers(){this.runTask(G.d,(e=>1===e.updatePolicy))}addGeometries(e,t,r){for(const i of e)Object(l.i)(i.origin)&&(i.origin=this._localOrigins.getOrigin(i.boundingSphere)),this._geometries.set(i.id,i);this.ensureLayerRenderer(t).add(e),2===r&&this.notifyGraphicGeometryChanged(e,t)}removeGeometries(e,t,r){for(const n of e)this._geometries.delete(Object(l.s)(n.id));const i=this._layerRenderers.get(t);i&&(i.remove(e),2===r&&this.notifyGraphicGeometryChanged(e,t))}updateGeometries(e,t,r){const i=this._layerRenderers.get(t);if(i)switch(i.modify(e,r),r){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else H.warn("Attempted to update geometry for nonexistent layer")}notifyGraphicGeometryChanged(e,t){if(Object(l.i)(t.notifyGraphicGeometryChanged))return;let r;for(const i of e){const e=i.graphicUid;Object(l.j)(e)&&e!==r&&(t.notifyGraphicGeometryChanged(e),r=e)}}notifyGraphicVisibilityChanged(e,t){if(Object(l.i)(t.notifyGraphicVisibilityChanged))return;let r;for(const i of e){const e=i.graphicUid;Object(l.j)(e)&&e!==r&&(t.notifyGraphicVisibilityChanged(e),r=e)}}updateHighlights(e,t){const r=this._layerRenderers.get(t);r?r.modify(e,8):H.warn("Attempted to update highlights for nonexistent layer")}isEmpty(){return 0===this._geometries.size&&!g.a.OVERLAY_DRAW_DEBUG_TEXTURE}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateLogic(e){let t=!1;return this._layerRenderers.forEach((r=>{r.updateLogic(e)&&(t=!0)})),t}updateLayerOrder(){this._sortedLayerRenderersDirty=!0}drawTarget(e,t,r){const i=e.canvasGeometries;if(0===i.numViews)return!1;const n=e.pixelRatio*r;this._screenToWorldRatio=n*Math.abs(i.extents[0][2]-i.extents[0][0])/Math.abs(e.viewport[2]-e.viewport[0]);const s=t.renderPass;if(this.isEmpty()||5===s&&!this.hasHighlights||3===s&&!this.hasWater)return!1;if(!e.hasSomeSizedView())return!1;const a=t.fbo,o=2*e.resolution,c=e.resolution,u=1===t.type?2:4===t.type?1:0;if(!a.isValid())return!1;a.resize(o,c);const d=this._rctx;if(Z.pixelRatio=n||1,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale,e.applyViewport(this._rctx),a.bind(d),0===e.index&&(d.setClearColor(0,0,0,0),d.clearSafe(16384)),1===u&&(this._renderContext.renderOccludedMask=K),g.a.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==u)for(let l=0;l<i.numViews;l++)this.setViewParameters(i.extents[l],e,Z),this.drawDebugTexture(e.resolution,Q[e.index%Q.length]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll((({layerView:t,renderer:r})=>{if(2===u&&Object(l.j)(t)&&0===t.drapeSourceType)return;const n=Object(l.j)(t)&&Object(l.j)(t.fullOpacity)&&t.fullOpacity<1&&0===s;n&&(this.bindTemporaryFramebuffer(this._rctx,o,c),d.clearSafe(16384));for(let s=0;s<i.numViews;s++)this.setViewParameters(i.extents[s],e,Z),r.render(this._renderContext,this._bindParameters);n&&Object(l.j)(this._temporaryFBO)&&(a.bind(d),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),2,Object(l.s)(Object(l.s)(t).fullOpacity),3,e.index))})),d.bindFramebuffer(null),a.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){Object(l.i)(this._temporaryFBO)&&(this._temporaryFBO=new _(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.hotReload()}intersect(e,t,r){let i=0;this._geometries.forEach((n=>{if(r&&!r(n))return;this.intersectRenderGeometry(n,t,0,e,i);const s=this.longitudeCyclical;s&&(n.boundingSphere[0]-n.boundingSphere[3]<s.min&&this.intersectRenderGeometry(n,t,s.range,e,i),n.boundingSphere[0]+n.boundingSphere[3]>s.max&&this.intersectRenderGeometry(n,t,-s.range,e,i)),i++}))}intersectRenderGeometry(e,t,r,i,n){if(!e.instanceParameters.visible)return;let s=0;Object(l.j)(e.transformation)&&(r+=e.transformation[12],s=e.transformation[13]),X[0]=t[0]-r,X[1]=t[1]-s,X[2]=1,J[0]=t[0]-r,J[1]=t[1]-s,J[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),i,X,J,((t,r,s)=>{this.addIntersectionResult(s,e.material.renderPriority,n,i,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,!0)}addIntersectionResult(e,t,r,i,n,s){const a={type:"external",metadata:{layerUid:n,graphicUid:s}},o=n=>{n.set(a,null,i.results.ground.dist,i.results.ground.normal,i.results.ground.transformation,t,null,null,e,r),n.intersector="OverlayRenderer"};if((null==i.results.min.drapedLayerOrder||t>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&o(i.results.min),0!==i.options.store&&(null==i.results.max.drapedLayerOrder||t<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&o(i.results.max),2===i.options.store){const e=new E.a(i.ray);o(e),i.results.all.push(e)}}stopAnimationsAtTime(e){this._sortedLayerRenderers.forAll((t=>t.renderer.stopAnimationsAtTime(e)))}ensureLayerRenderer(e){let t=this._layerRenderers.get(e);return t||(t=new k({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,t),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",(()=>this.emitContentChanged())),e),this._handles.add(Object(d.a)(t,"updating",(()=>this.notifyChange("updating"))),e)),t}updateSortedLayerRenderers(){if(!this._sortedLayerRenderersDirty)return;if(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0===this._layerRenderers.size)return;const e=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach((t=>{const r=t,i=this._layerRenderers.get(r);i&&(this._sortedLayerRenderers.push(new $(r,i)),e.delete(i))})),e.forEach((e=>this._sortedLayerRenderers.push(new $(null,e))))}setViewParameters(e,t,r){r.viewport=t.viewport,Object(f.o)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),Object(f.i)(r.viewMatrix),Object(f.t)(r.viewMatrix,r.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=r,this._bindParameters.camera=r,this._bindParameters.inverseViewport[0]=1/r.fullViewport[2],this._bindParameters.inverseViewport[1]=1/r.fullViewport[3]}emitContentChanged(){this.onContentChanged&&this.onContentChanged()}updateHasWater(){const e=Object(o.b)(this._layerRenderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.onHasWaterChanged&&this.onHasWaterChanged(e))}updateHasHighlights(){const e=Object(o.b)(this._layerRenderers,(e=>e.hasHighlights));e!==this._hasHighlights&&(this._hasHighlights=e,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this._hasHighlights))}updateRendersOccluded(){const e=Object(o.b)(this._layerRenderers,(e=>e.rendersOccluded));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.onRendersOccludedChanged&&this.onRendersOccludedChanged(this.rendersOccluded))}drawDebugTexture(e,t){const r=this._rctx;this.ensureDebugPatternResources(e,e);const i=this._debugTextureTechnique.program;r.useProgram(i),r.setPipelineState(this._debugTextureTechnique.pipeline),i.setUniform4f("color",t[0],t[1],t[2],1),i.bindTexture(this._debugPatternTexture,"tex"),r.bindVAO(this._quadVAO),r.drawArrays(5,0,Object(q.f)(this._quadVAO,"geometry"))}ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const r=new Uint8Array(e*t*4);let i=0;for(let s=0;s<t;s++)for(let n=0;n<e;n++){const a=Math.floor(n/10),o=Math.floor(s/10);a<2||o<2||10*a>e-20||10*o>t-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&a&&1&o?1&n^1&s?0:255:1&a^1&o?0:128)}this._debugPatternTexture=new j.a(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},r);const n=new V.b;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(V.a,n),this._quadVAO=Object(P.d)(this._rctx)}get test(){return{layerRenderers:this._layerRenderers}}};Object(i.a)([Object(T.c)()],W.prototype,"_shaderTechniqueRepository",void 0),Object(i.a)([Object(T.c)()],W.prototype,"_stippleTextureRepository",void 0),Object(i.a)([Object(h.b)({constructOnly:!0})],W.prototype,"view",void 0),Object(i.a)([Object(h.b)()],W.prototype,"globalUnitScale",void 0),Object(i.a)([Object(h.b)()],W.prototype,"spatialReference",void 0),Object(i.a)([Object(h.b)({type:Boolean,readOnly:!0})],W.prototype,"updating",null),W=Object(i.a)([Object(p.a)("esri.views.3d.terrain.OverlayRenderer")],W);class ${constructor(e,t){this.layerView=e,this.renderer=t}}const Q=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],Z=new C.a;Z.near=1,Z.far=1e4,Z.relativeElevation=null;const X=Object(m.e)(),J=Object(m.e)(),Y=-2,K=4},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return j})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return p})),r.d(t,"g",(function(){return h}));var i=r(35),n=r(86),s=r(102),a=r(8),o=r(2),l=(r(17),r(5)),c=(r(602),r(187));const u=/\/resource\/(.*?)\.svg$/,d=new i.a("white");function h(e){if(Object(o.i)(e)||!("symbolLayers"in e)||Object(o.i)(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function p(e,t){const r=t.resource.href;return!Object(a.a)("esri-canvas-svg-support")&&e.styleOrigin&&u.test(r)?r.replace(u,"/resource/png/$1.png"):r}function f(e,t){if(!e)return null;let r=null;return Object(n.c)(e)?r=function(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach((e=>{"object"===e.type&&null!=e.resource.href||(r="water"===e.type?Object(o.s)(e.color):Object(o.j)(e.material)?Object(o.s)(e.material.color):null)})),r?new i.a(r):null}(e):Object(n.b)(e)&&(r=e.color?new i.a(e.color):null),r?b(r,t):null}function b(e,t){if(null==t)return e;const r=e.toRgba();return r[3]=r[3]*t,new i.a(r)}function m(e,t,r){var s,a,l;e&&(t||null!=r)&&(t&&(t=new i.a(t)),Object(n.c)(e)?function(e,t,r){const i=e.symbolLayers;if(!i)return;const n=e=>{const i=Object(o.j)(e)?e:null;return b(t=t||i||null!=r&&d,r)};i.forEach((e=>{if("object"!==e.type||null==e.resource.href||t)if("water"===e.type)e.color=n(e.color);else{const t=Object(o.j)(e.material)?e.material.color:null,i=n(t);Object(o.i)(e.material)?e.material=new c.a({color:i}):e.material.color=i,null!=r&&"outline"in e&&Object(o.j)(e.outline)&&Object(o.j)(e.outline.color)&&(e.outline.color=b(e.outline.color,r))}}))}(e,t,r):Object(n.b)(e)&&(s=e,l=r,(a=(a=t)||s.color)&&(s.color=b(a,l)),null!=l&&"outline"in s&&s.outline&&s.outline.color&&(s.outline.color=b(s.outline.color,l))))}async function g(e,t){const i=e.symbolLayers;i&&await Object(s.b)(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const r=y(t);Object(o.j)(r)&&(e.size=r)}(e,t);break;case"path":!function(e,t){const r=v(t,l.a,[e.width,void 0,e.height]);e.width=O(t[0],e.width,1,r),e.height=O(t[2],e.height,1,r)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:n}=await async function(e){const t=await r.e(169).then(r.bind(null,690)),i=await t.computeObjectLayerResourceSize(e,10),{width:n,height:s,depth:a}=e,o=[n,a,s];let l=1;for(let r=0;r<3;r++)if(null!=o[r]){l=o[r]/i[r];break}for(let r=0;r<3;r++)null==o[r]&&(o[r]=i[r]*l);return{resourceSize:i,symbolSize:o}}(e),s=v(t,i,n);e.width=O(t[0],n[0],i[0],s),e.depth=O(t[1],n[1],i[1],s),e.height=O(t[2],n[2],i[2],s)}(e,t)}}(e,t)))}function y(e){for(const t of e)if("number"==typeof t)return t;return null}function v(e,t,r){for(let i=0;i<3;i++){const n=e[i];switch(n){case"symbol-value":return null!=r[i]?r[i]/t[i]:1;case"proportional":break;default:if(n&&t[i])return n/t[i]}}return 1}function O(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return null!=t?t:r;default:return e}}async function j(e,t){if(e&&t)return Object(n.c)(e)?g(e,t):void(Object(n.b)(e)&&function(e,t){const r=y(t);if(!Object(o.i)(r))switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=r,e.height=r*t):(e.width=r*t,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}(e,t))}function _(e,t,r){if(e&&null!=t)if(Object(n.c)(e)){const i=e.symbolLayers;i&&i.forEach((e=>{if(e&&"object"===e.type)switch(r){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else Object(n.b)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));const i=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],n=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]},function(e,t,r){"use strict";t.a=class{constructor(e,t=29){this.name=e,this._counter=0,this._items=new Array(t)}record(e){this._items[++this._counter%this._items.length]=e}get median(){return this._items.slice().sort()[Math.floor(this._items.length/2)]}get average(){return this._items.reduce(((e,t)=>e+t),0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return s})),r.d(t,"f",(function(){return l}));r(8);var i=r(10);function n(e,t){const{format:r,quality:n,rotation:s,disableDecorations:a}=e||{},o=f(e,t.padding),l=function(e,t){const r={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){null!=e.area.x&&(r.x=Math.floor(e.area.x)),null!=e.area.y&&(r.y=Math.floor(e.area.y));const i=null!=e.area.width?Math.floor(e.area.width):null,n=null!=e.area.height?Math.floor(e.area.height):null;if(r.width=t.width-r.x,r.height=t.height-r.y,null!=i&&null!=n)r.width=Math.min(r.width,i),r.height=Math.min(r.height,n);else if(null==i&&null!=n){const e=Math.min(r.width,i);r.height=e/r.width*r.height,r.width=e}else if(null!=i&&null==n){const e=Math.min(r.height,n);r.width=e/r.height*r.width,r.height=e}}return function(e,t){const r=Math.floor(Math.max(e.x,0)),i=Math.floor(Math.max(e.y,0)),n={x:r,y:i,width:Math.floor(Math.min(e.width,t.width-r)),height:Math.floor(Math.min(e.height,t.height-i))},s=n.width/n.height,a=e.width/e.height;if(a===s)return n;if(a>s){const e=Math.floor(n.width/a),t=n.height-e;return{x:n.x,y:Math.floor(n.y+t/2),width:n.width,height:e}}const o=Math.floor(n.height*a),l=n.width-o;return{x:Math.floor(n.x+l/2),y:n.y,width:o,height:n.height}}(function(e,t){if(!t||null==t.width||null==t.height)return e;const r=t.width/t.height,i=e.width/e.height;if(i===r)return e;if(i<r){const t=Math.floor(e.height*r);return e.x-=(t-e.width)/2,e.width=t,e}const n=Math.floor(e.width/r);return e.y-=(n-e.height)/2,e.height=n,e}(r,e),t)}(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:c,height:u}=function(e,t){if(!e)return t;const r=e.width,i=e.height;if(null!=r&&null!=i)return{width:Math.floor(r),height:Math.floor(i)};if(null==r&&null==i)return t;const n=t.width/t.height;return null==i?{width:Math.floor(r),height:Math.floor(r/n)}:{width:Math.floor(i*n),height:Math.floor(i)}}(e,l),d=function(e){switch(e){case"png":case"jpg":case"jpeg":return e;case null:case void 0:default:return m}}(r),h=g[d];return{format:d,quality:Object(i.e)(null!=n?n:h,0,100),area:l,width:c,height:u,rotation:s,disableDecorations:!!a,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function s(e,t){const r=n(e,t),i=r.area,s=r.width/i.width,a=f(r,t.padding),o=a.left+a.right,l=a.top+a.bottom,c=t.width-o,u=t.height-l,d=Math.floor(c*s+o),h=Math.floor(u*s+l),p=e&&e.layers?e.layers:[],b=r.ignoreBackground,m=r.ignorePadding;return{framebufferWidth:d,framebufferHeight:h,region:{x:Math.floor(i.x*s)+a.left,y:Math.floor(i.y*s)+a.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:b,ignorePadding:m}}function a(e,t,r,i){i.premultipliedAlpha&&function(e){const t=e.data,r=t.length;for(let i=0;i<r;i+=4){const e=t[i+3];if(e>0){const r=e/255;t[i+0]=t[i+0]/r,t[i+1]=t[i+1]/r,t[i+2]=t[i+2]/r}}}(e),r.width=e.width,r.height=e.height;const n=r.getContext("2d");n.putImageData(e,0,0),i.flipY&&function(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}(n);const s=n.getImageData(0,0,e.width,e.height),a=function(e,t){const r=b[t.format],i=t.quality/100;return e.toDataURL(r,i)}(r,t);return r.width=0,r.height=0,{dataUrl:a,data:s}}function o(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(p)try{return new ImageData(e,t)}catch(i){p=!1}return d(e,t,r)}function l(e,t,r,i){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(p)try{return new ImageData(e,t,r)}catch(s){p=!1}const n=d(t,r,i);return n.data.set(e,0),n}function c(e,t,r,i=0,n=0,s=e.width-i,a=e.height-n,o=!1){const{data:l}=e,{width:c,height:u,data:d}=t,h=s/c,p=a/u,f=Math.ceil(h/2),b=Math.ceil(p/2),m=e.width;for(let g=0;g<u;g++)for(let e=0;e<c;e++){const t=4*(e+(o?u-g-1:g)*c);let s=0,a=0,y=0,v=0,O=0,j=0;const _=(g+.5)*p;for(let o=Math.floor(g*p);o<(g+1)*p;o++){const t=Math.abs(_-(o+.5))/b,c=(e+.5)*h,u=t*t;for(let d=Math.floor(e*h);d<(e+1)*h;d++){const e=Math.abs(c-(d+.5))/f,t=Math.sqrt(u+e*e);if(t>=1)continue;let h=2*t*t*t-3*t*t+1;const p=4*(i+d+(n+o)*m);j+=h*l[p+3],a+=h,!r&&l[p+3]<255&&(h=h*l[p+3]/255),y+=h*l[p],v+=h*l[p+1],O+=h*l[p+2],s+=h}}d[t]=y/s,d[t+1]=v/s,d[t+2]=O/s,d[t+3]=j/a}return t}function u(e,t,r){if(!t)return e;const{framebufferWidth:i,framebufferHeight:n,pixelRatio:s,region:a}=e,o=f(e,r),l=o.left+o.right,c=o.top+o.bottom,u=i-l,d=n-c,h=Math.min(8,Math.min((2048-l)/u,(2048-c)/d));return h<1.5?e:{...e,framebufferWidth:Math.round(u*h)+l,framebufferHeight:Math.round(d*h)+c,pixelRatio:s*h,resample:{region:{x:Math.round((a.x-o.left)*h)+o.left,y:Math.round((a.y-o.top)*h)+o.top,width:Math.round(a.width*h),height:Math.round(a.height*h)},width:i,height:n}}}function d(e,t,r){return r||(h||(h=document.createElement("canvas"),h.width=1,h.height=1),r=h),r.getContext("2d").createImageData(e,t)}let h=null,p=!0;function f(e,t){return!t||e&&e.ignorePadding?y:t}const b={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},m="png",g={png:100,jpg:98,jpeg:98},y={top:0,right:0,bottom:0,left:0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r(226);const n={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{"-"===t.charAt(0)?e.style.setProperty(t,r):e.style[t]=r}};let s=e=>Object(i.c)(n,e),a={create:(e,t)=>(t=s(t),Object(i.a)(e,document.createElement("div"),void 0,t),Object(i.b)(e,t)),append:(e,t,r)=>(r=s(r),Object(i.a)(t,e,void 0,r),Object(i.b)(t,r)),insertBefore:(e,t,r)=>(r=s(r),Object(i.a)(t,e.parentNode,e,r),Object(i.b)(t,r)),merge:(e,t,r)=>(r=s(r),t.domNode=e,Object(i.d)(e,t,r),Object(i.b)(t,r)),replace:(e,t,r)=>(r=s(r),Object(i.a)(t,e.parentNode,e,r),e.parentNode.removeChild(e),Object(i.b)(t,r))}},function(e,t,r){"use strict";r.r(t),r.d(t,"executeQuery",(function(){return p})),r.d(t,"executeQueryForCount",(function(){return g})),r.d(t,"executeQueryForExtent",(function(){return y})),r.d(t,"executeQueryForIds",(function(){return m})),r.d(t,"executeQueryPBF",(function(){return f})),r.d(t,"executeQueryPBFBuffer",(function(){return b})),r.d(t,"queryToQueryStringParameters",(function(){return h})),r.d(t,"runQuery",(function(){return v}));var i=r(84),n=r(2),s=r(25),a=r(85),o=r(446),l=r(635),c=r(361),u=r(325);const d="Layer does not support extent calculation.";function h(e,t){const r=e.geometry,i=e.toJSON(),s=i;if(Object(n.j)(r)&&(s.geometry=JSON.stringify(r),s.geometryType=Object(a.c)(r),s.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(s.objectIds=i.objectIds.join(",")),i.orderByFields&&(s.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&(null!=t&&t.returnCountOnly||null!=t&&t.returnExtentOnly||null!=t&&t.returnIdsOnly)?delete s.outFields:-1!==i.outFields.indexOf("*")?s.outFields="*":s.outFields=i.outFields.join(","),i.outSR?s.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(s.outSR=s.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(s.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(s.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(s.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(s.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(s.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(s.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const e=i.timeExtent,{start:t,end:r}=e;null==t&&null==r||(s.time=t===r?t:`${null==t?"null":t},${null==r?"null":r}`),delete i.timeExtent}return s}async function p(e,t,r,i){const s=Object(n.j)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await v(e,t,"json",i);return Object(c.a)(t,r,s.data),s}async function f(e,t,r,i){if(Object(n.j)(t.timeExtent)&&t.timeExtent.isEmpty)return Promise.resolve({data:r.createFeatureResult()});const s=await b(e,t,i),a=s;return a.data=Object(l.a)(s.data,r),a}function b(e,t,r){return v(e,t,"pbf",r)}function m(e,t,r){return Object(n.j)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):v(e,t,"json",r,{returnIdsOnly:!0})}function g(e,t,r){return Object(n.j)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):v(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function y(e,t,r){return Object(n.j)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):v(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((e=>{const t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(d);if(t.hasOwnProperty("count"))throw new Error(d);return e}))}function v(e,t,r,a={},l={}){const c="string"==typeof e?Object(s.K)(e):e,d=t.geometry?[t.geometry]:[];return a.responseType="pbf"===r?"array-buffer":"json",Object(o.a)(d,null,a).then((e=>{const o=e&&e[0];Object(n.j)(o)&&((t=t.clone()).geometry=o);const d=Object(u.a)({...c.query,f:r,...l,...h(t,l)});return Object(i.default)(Object(s.z)(c.path,"query"),{...a,query:{...d,...a.query}})}))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return l}));var i=r(58),n=r(398),s=r(6);const a=Object(i.d)(0,.6,.2);function o(e,t){const r=e.fragment,i=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&i&&e.include(n.a,t),2!==t.pbrMode?(0===t.pbrMode&&r.code.add(s.a`float getBakedOcclusion() { return 1.0; }`),1===t.pbrMode&&(r.uniforms.add("emissionFactor","vec3"),r.uniforms.add("mrrFactors","vec3"),r.code.add(s.a`vec3 mrr;
vec3 emission;
float occlusion;`),t.hasMetalnessAndRoughnessTexture&&(r.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&r.uniforms.add("texMetallicRoughnessSize","vec2"),r.code.add(s.a`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(r.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&r.uniforms.add("texEmissionSize","vec2"),r.code.add(s.a`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(r.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&r.uniforms.add("texOcclusionSize","vec2"),r.code.add(s.a`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(s.a`float getBakedOcclusion() { return 1.0; }`),r.code.add(s.a`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${i?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `))):r.code.add(s.a`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function l(e,t,r=!1){r||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},function(e,t,r){"use strict";var i=r(0),n=r(2),s=r(1),a=(r(8),r(9),r(7),r(37)),o=r(4),l=r(147),c=r(490),u=r(14);let d=class extends u.a{constructor(e){super(e)}clone(){}};Object(i.a)([Object(s.b)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],d.prototype,"type",void 0),d=Object(i.a)([Object(o.a)("esri.symbols.patterns.Pattern3D")],d);var h,p=d,f=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];let b=h=class extends p{constructor(e){super(e),this.type="style",this.style="solid"}clone(){return new h({style:this.style})}};Object(i.a)([Object(s.b)({type:["style"]})],b.prototype,"type",void 0),Object(i.a)([Object(s.b)({type:f,json:{read:!0,write:!0}})],b.prototype,"style",void 0),b=h=Object(i.a)([Object(o.a)("esri.symbols.patterns.StylePattern3D")],b);var m=b;const g={types:{key:"type",base:p,typeMap:{style:m}},json:{read:function(e,t,r){if(!e)return e;switch(e.type){case"style":{const t=new m;return t.read(e,r),t}}},write:!0}};var y,v=r(285),O=r(187);let j=y=class extends O.a{clone(){return new y({color:Object(n.j)(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode})}};Object(i.a)([Object(a.a)({multiply:"multiply",replace:"replace",tint:"tint"})],j.prototype,"colorMixMode",void 0),j=y=Object(i.a)([Object(o.a)("esri.symbols.support.Symbol3DFillMaterial")],j);var _,w=j,x=r(429);let S=_=class extends l.a{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){return new _({edges:Object(n.j)(this.edges)?this.edges.clone():null,enabled:this.enabled,material:Object(n.j)(this.material)?this.material.clone():null,pattern:Object(n.j)(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:Object(n.j)(this.outline)?this.outline.clone():null})}static fromSimpleFillSymbol(e){return new _({material:{color:(e.color||v.b).clone()},pattern:e.style&&"solid"!==e.style?new m({style:e.style}):null,outline:e.outline?new x.a({size:e.outline.width||0,color:(e.outline.color||v.c).clone()}):null})}};Object(i.a)([Object(a.a)({Fill:"fill"},{readOnly:!0})],S.prototype,"type",void 0),Object(i.a)([Object(s.b)({type:w,json:{write:!0}})],S.prototype,"material",void 0),Object(i.a)([Object(s.b)(g)],S.prototype,"pattern",void 0),Object(i.a)([Object(s.b)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],S.prototype,"castShadows",void 0),Object(i.a)([Object(s.b)({type:x.a,json:{write:!0}})],S.prototype,"outline",void 0),Object(i.a)([Object(s.b)(c.a)],S.prototype,"edges",void 0),S=_=Object(i.a)([Object(o.a)("esri.symbols.FillSymbol3DLayer")],S);var T=S;t.a=T},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(i.a`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(i.a`void forwardLinearDepth() {
linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);
}`)):e.vertex.code.add(i.a`void forwardLinearDepth() {}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(i.a`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(6);function n(e,t){const r=e.fragment,n=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===n?(r.uniforms.add("lightingAmbientSH0","vec3"),r.code.add(i.a`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===n?(r.uniforms.add("lightingAmbientSH_R","vec4"),r.uniforms.add("lightingAmbientSH_G","vec4"),r.uniforms.add("lightingAmbientSH_B","vec4"),r.code.add(i.a`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===n&&(r.uniforms.add("lightingAmbientSH0","vec3"),r.uniforms.add("lightingAmbientSH_R1","vec4"),r.uniforms.add("lightingAmbientSH_G1","vec4"),r.uniforms.add("lightingAmbientSH_B1","vec4"),r.uniforms.add("lightingAmbientSH_R2","vec4"),r.uniforms.add("lightingAmbientSH_G2","vec4"),r.uniforms.add("lightingAmbientSH_B2","vec4"),r.code.add(i.a`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),1!==t.pbrMode&&2!==t.pbrMode||r.code.add(i.a`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}var s=r(308),a=r(527),o=r(312),l=r(391),c=r(135);function u(e,t){const r=e.fragment;e.include(a.a),e.include(s.a,t),0!==t.pbrMode&&e.include(o.a,t),e.include(n,t),t.receiveShadows&&e.include(c.a,t),r.uniforms.add("lightingGlobalFactor","float"),r.uniforms.add("ambientBoostFactor","float"),e.include(l.a),r.code.add(i.a`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),r.code.add(i.a`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${1===t.viewingMode?i.a`normalize(vPosWorld)`:i.a`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),r.code.add(i.a`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),0===t.pbrMode||4===t.pbrMode?r.code.add(i.a`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`):1!==t.pbrMode&&2!==t.pbrMode||(r.code.add(i.a`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(i.a`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),r.code.add(i.a`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = abs(dot(normal, ambientDir));
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.code.add(i.a`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(i.a`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${2===t.pbrMode?i.a`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:i.a`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return d}));var i=r(68),n=r(42),s=r(2),a=r(59),o=r(236);const l=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var c=r(517);class u extends o.a{constructor(e,t=""){var r,s,o;super(),this.apiLayerUid=t,this.type=0,this.events=new i.a,this.isSliceable=!1,this._objects=new a.a,this._stageHandles=new n.a,this.apiLayerUid=t,this.isVisible=null==(r=null==e?void 0:e.isVisible)||r,this.isPickable=null==(s=null==e?void 0:e.isPickable)||s,this.updatePolicy=null!=(o=null==e?void 0:e.updatePolicy)?o:0}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of l)this._stageHandles.add(this.events.on(t,(r=>e.handleEvent(t,r))))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(s.j)(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(s.j)(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(s.j)(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(s.j)(this._octree)&&this._octree.remove(t)}}sync(){Object(s.j)(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){Object(s.j)(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return Object(s.i)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Object(s.e)(this._octree)}_createOctree(){this._octree=new c.a((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)}}function d(e){return Object(s.j)(e)&&0===e.type}},function(e,t,r){"use strict";var i=r(0),n=r(38),s=r(178),a=r(2),o=r(1),l=(r(8),r(9),r(7),r(4)),c=r(289);let u=class extends(Object(s.b)(n.a)){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(Object(c.a)((()=>this.refresh())))}destroy(){this.getCollections=null}refresh(){const e=Object(a.j)(this.getCollections)?this.getCollections():null;if(Object(a.i)(e))return void this.removeAll();let t=0;for(const r of e)Object(a.j)(r)&&(t=this._processCollection(t,r));this.splice(t,this.length)}_createNewInstance(e){return new n.a(e)}_processCollection(e,t){if(!t)return e;const r=this.itemFilterFunction?this.itemFilterFunction:e=>!!e;for(const i of t)if(i){if(r(i)){const t=this.indexOf(i,e);t>=0?t!==e&&this.reorder(i,e):this.add(i,e),++e}if(this.getChildrenFunction){const t=this.getChildrenFunction(i);if(Array.isArray(t))for(const r of t)e=this._processCollection(e,r);else e=this._processCollection(e,t)}}return e}};Object(i.a)([Object(o.b)()],u.prototype,"getCollections",void 0),Object(i.a)([Object(o.b)()],u.prototype,"getChildrenFunction",void 0),Object(i.a)([Object(o.b)()],u.prototype,"itemFilterFunction",void 0),u=Object(i.a)([Object(l.a)("esri.core.CollectionFlattener")],u);var d=u;t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r(315),n=r(6);function s(e,t){const r=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(i.a),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),r.add(n.a`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===t.viewingMode?n.a`vec3 worldNormal = normalize(worldPos + localOrigin);`:n.a`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${t.screenSizePerspectiveEnabled?n.a`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:n.a`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):r.add(n.a`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}function a(e,t,r){if(!t.verticalOffset)return;const i=o(t.verticalOffset,r.camera.fovY,r.camera.fullViewport[3]),n=r.camera.pixelRatio||1;e.setUniform4f("verticalOffset",i.screenLength*n,i.perDistance,i.minWorldLength,i.maxWorldLength)}function o(e,t,r,i=l){return i.screenLength=e.screenLength,i.perDistance=Math.tan(.5*t)/(.5*r),i.minWorldLength=e.minWorldLength,i.maxWorldLength=e.maxWorldLength,i}const l={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i,n,s={exports:{}};i=s,void 0!==(n=function(){function e(e,r,n){n=n||2;var s,a,o,c,u,d,h,p=r&&r.length,f=p?r[0]*n:e.length,b=t(e,0,f,n,!0),m=[];if(!b||b.next===b.prev)return m;if(p&&(b=l(e,r,b,n)),e.length>80*n){s=o=e[0],a=c=e[1];for(var g=n;g<f;g+=n)(u=e[g])<s&&(s=u),(d=e[g+1])<a&&(a=d),u>o&&(o=u),d>c&&(c=d);h=0!==(h=Math.max(o-s,c-a))?1/h:0}return i(b,m,n,s,a,h),m}function t(e,t,r,i,n){var s,a;if(n===C(e,t,r,i)>0)for(s=t;s<r;s+=i)a=x(s,e[s],e[s+1],a);else for(s=r-i;s>=t;s-=i)a=x(s,e[s],e[s+1],a);return a&&y(a,a.next)&&(S(a),a=a.next),a}function r(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!y(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(S(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function i(e,t,l,c,u,d,p){if(e){!p&&d&&h(e,c,u,d);for(var f,b,m=e;e.prev!==e.next;)if(f=e.prev,b=e.next,d?s(e,c,u,d):n(e))t.push(f.i/l),t.push(e.i/l),t.push(b.i/l),S(e),e=b.next,m=b.next;else if((e=b)===m){p?1===p?i(e=a(r(e),t,l),t,l,c,u,d,2):2===p&&o(e,t,l,c,u,d):i(r(e),t,l,c,u,d,1);break}}}function n(e){var t=e.prev,r=e,i=e.next;if(g(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(b(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&g(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function s(e,t,r,i){var n=e.prev,s=e,a=e.next;if(g(n,s,a)>=0)return!1;for(var o=n.x<s.x?n.x<a.x?n.x:a.x:s.x<a.x?s.x:a.x,l=n.y<s.y?n.y<a.y?n.y:a.y:s.y<a.y?s.y:a.y,c=n.x>s.x?n.x>a.x?n.x:a.x:s.x>a.x?s.x:a.x,u=n.y>s.y?n.y>a.y?n.y:a.y:s.y>a.y?s.y:a.y,d=p(o,l,t,r,i),h=p(c,u,t,r,i),f=e.prevZ,m=e.nextZ;f&&f.z>=d&&m&&m.z<=h;){if(f!==e.prev&&f!==e.next&&b(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,m!==e.prev&&m!==e.next&&b(n.x,n.y,s.x,s.y,a.x,a.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&b(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;m&&m.z<=h;){if(m!==e.prev&&m!==e.next&&b(n.x,n.y,s.x,s.y,a.x,a.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function a(e,t,i){var n=e;do{var s=n.prev,a=n.next.next;!y(s,a)&&v(s,n,n.next,a)&&_(s,a)&&_(a,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(a.i/i),S(n),S(n.next),n=e=a),n=n.next}while(n!==e);return r(n)}function o(e,t,n,s,a,o){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=w(l,c);return l=r(l,l.next),u=r(u,u.next),i(l,t,n,s,a,o),void i(u,t,n,s,a,o)}c=c.next}l=l.next}while(l!==e)}function l(e,i,n,s){var a,o,l,d=[];for(a=0,o=i.length;a<o;a++)(l=t(e,i[a]*s,a<o-1?i[a+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),d.push(f(l));for(d.sort(c),a=0;a<d.length;a++)n=r(n=u(d[a],n),n.next);return n}function c(e,t){return e.x-t.x}function u(e,t){var i=function(e,t){var r,i=t,n=e.x,s=e.y,a=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var o=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>a){if(a=o,o===n){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===a)return r;var l,c=r,u=r.x,h=r.y,p=1/0;i=r;do{n>=i.x&&i.x>=u&&n!==i.x&&b(s<h?n:a,s,u,h,s<h?a:n,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(n-i.x),_(i,e)&&(l<p||l===p&&(i.x>r.x||i.x===r.x&&d(r,i)))&&(r=i,p=l)),i=i.next}while(i!==c);return r}(e,t);if(!i)return t;var n=w(i,e),s=r(i,i.next);return r(n,n.next),t===i?s:t}function d(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function h(e,t,r,i){var n=e;do{if(null===n.z&&(n.z=p(n.x,n.y,t,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,h(e,t,r,i);n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,s,a,o,l,c=1;do{for(r=e,e=null,s=null,a=0;r;){for(a++,i=r,o=0,t=0;t<c&&(o++,i=i.nextZ);t++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=i}s.nextZ=null,c*=2}while(a>1)}(n)}function p(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function b(e,t,r,i,n,s,a,o){return(n-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(i-o)-(r-a)*(t-o)>=0&&(r-a)*(s-o)-(n-a)*(i-o)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&v(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(_(e,t)&&_(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||y(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function v(e,t,r,i){var n=j(g(e,t,r)),s=j(g(e,t,i)),a=j(g(r,i,e)),o=j(g(r,i,t));return n!==s&&a!==o||!(0!==n||!O(e,r,t))||!(0!==s||!O(e,i,t))||!(0!==a||!O(r,e,i))||!(0!==o||!O(r,t,i))}function O(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function j(e){return e>0?1:e<0?-1:0}function _(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function w(e,t){var r=new T(e.i,e.x,e.y),i=new T(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function x(e,t,r,i){var n=new T(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,r,i){for(var n=0,s=t,a=r-i;s<r;s+=i)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}return e.deviation=function(e,t,r,i){var n=t&&t.length,s=n?t[0]*r:e.length,a=Math.abs(C(e,0,s,r));if(n)for(var o=0,l=t.length;o<l;o++){var c=t[o]*r,u=o<l-1?t[o+1]*r:e.length;a-=Math.abs(C(e,c,u,r))}var d=0;for(o=0;o<i.length;o+=3){var h=i[o]*r,p=i[o+1]*r,f=i[o+2]*r;d+=Math.abs((e[h]-e[f])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[f+1]-e[h+1]))}return 0===a&&0===d?0:Math.abs((d-a)/a)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var a=0;a<t;a++)r.vertices.push(e[n][s][a]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r},e}())&&(i.exports=n);var a=s.exports},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(313),n=r(132),s=r(6);function a(e,t){0===t.normalType||1===t.normalType?(e.include(i.a,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(s.a`void forwardNormal() {
vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();
vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;
}`)):2===t.normalType?(e.include(n.a,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(s.a`
    void forwardNormal() {
      vNormalWorld = ${1===t.viewingMode?s.a`normalize(vPositionWorldCameraRelative);`:s.a`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(s.a`void forwardNormal() {}`)}(a||(a={})).bindUniforms=function(e,t){e.setUniformMatrix4fv("viewNormal",t)}},function(e,t,r){"use strict";var i=r(0),n=r(44),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(37)),l=r(4);const c=new n.a({inherited:"inherited",codedValue:"coded-value",range:"range"});let u=class extends s.a{constructor(e){super(e),this.name=null,this.type=null}};Object(i.a)([Object(a.b)({type:String,json:{write:!0}})],u.prototype,"name",void 0),Object(i.a)([Object(o.a)(c)],u.prototype,"type",void 0),u=Object(i.a)([Object(l.a)("esri.layers.support.Domain")],u);var d=u;t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return c})),r.d(t,"f",(function(){return d}));var i=r(120),n=r(2),s=r(388),a=r(433),o=r(382),l=r(240);const c={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function u(e){return"web-style"===e.type?c:d(e.symbolLayers.toArray().map((t=>f(e,t))))}function d(e){let t=0,r=0,i=0,s=!1,a=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const l of e)Object(n.i)(l)||(t+=l.primitivesPerFeature,r+=l.primitivesPerCoordinate,i+=l.drawCallsPerFeature,o.bytesPerFeature+=l.memory.bytesPerFeature,o.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=l.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=l.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=l.memory.bytesPerCoordinate,s=s||l.estimated,++a);return{primitivesPerFeature:t,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:a}}function h(e){const t=d(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const p={};function f(e,t){const r=b(e,t),a=Object(o.d)(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:a,estimated:!1,memory:r};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:a,estimated:!1,memory:r}:Object(n.j)(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...m(t.resource&&t.resource.primitive||s.b),memory:r};case"path":{const e=3,n=3,s=10;let a=0,o=0;switch(t.profile){case"circle":a=s;break;case"quad":a=4;break;default:return void Object(i.a)(t.profile)}switch(t.join){case"round":o=e;break;case"miter":case"bevel":o=1;break;default:return void Object(i.a)(t.join)}const l=2*a,c=a*o*2;let u=-2*c-l;switch(t.cap){case"none":break;case"butt":case"square":u+=2*(a-1);break;case"round":u+=2*(a*(n-1)*2+a);break;default:return}return{primitivesPerFeature:u,primitivesPerCoordinate:c+l,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function b(e,t){const r="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?g.EXTRUDE_EDGES:g.EXTRUDE;case"fill":return Object(n.j)(t.outline)&&t.outline.size>0?g.FILL_OUTLINE:g.FILL;case"water":return g.FILL;case"line":return"round"===t.join?g.LINE_ROUND:g.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return g.PATH_ROUND_CIRCLE;case"quad":return g.PATH_ROUND_QUAD;default:return void Object(i.a)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return g.PATH_MITER_CIRCLE;case"quad":return g.PATH_MITER_QUAD;default:return void Object(i.a)(t.profile)}default:return void Object(i.a)(t.join)}case"object":return r?g.OBJECT_POINT:g.OBJECT_POLYGON;case"icon":case"text":return r?g.ICON_POINT:g.ICON_POLYGON;default:return}}function m(e){let t=p[e];if(t)return t;const r=Object(a.b)(e,null);return t={primitivesPerFeature:Object(l.b)(r.levels[0]).reduce(((e,t)=>e+t.indices.get("position").length/3),0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},p[e]=t,t}const g={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return L}));var i,n=r(0),s=r(1),a=(r(8),r(9)),o=r(7),l=r(32),c=r(4),u=r(29),d=r(89),h=r(278),p=r(591);let f=i=class extends h.a{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new i({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};Object(n.a)([Object(s.b)({readOnly:!0})],f.prototype,"cache",null),Object(n.a)([Object(s.b)({type:["color"],json:{type:["colorInfo"]}})],f.prototype,"type",void 0),Object(n.a)([Object(s.b)({type:String,json:{write:!0}})],f.prototype,"normalizationField",void 0),Object(n.a)([Object(s.b)({type:[p.a],json:{write:!0}})],f.prototype,"stops",null),f=i=Object(n.a)([Object(c.a)("esri.renderers.visualVariables.ColorVariable")],f);var b,m=f,g=r(14),y=r(200);let v=b=class extends g.a{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return Object(y.b)(t.transparency)}writeOpacity(e,t,r){t[r]=Object(y.a)(e)}clone(){return new b({label:this.label,opacity:this.opacity,value:this.value})}};Object(n.a)([Object(s.b)({type:String,json:{write:!0}})],v.prototype,"label",void 0),Object(n.a)([Object(s.b)({type:Number,json:{type:a.a,write:{target:"transparency"}}})],v.prototype,"opacity",void 0),Object(n.a)([Object(l.a)("opacity",["transparency"])],v.prototype,"readOpacity",null),Object(n.a)([Object(u.a)("opacity")],v.prototype,"writeOpacity",null),Object(n.a)([Object(s.b)({type:Number,json:{write:!0}})],v.prototype,"value",void 0),v=b=Object(n.a)([Object(c.a)("esri.renderers.visualVariables.support.OpacityStop")],v);var O,j=v;let _=O=class extends h.a{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new O({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};Object(n.a)([Object(s.b)({readOnly:!0})],_.prototype,"cache",null),Object(n.a)([Object(s.b)({type:["opacity"],json:{type:["transparencyInfo"]}})],_.prototype,"type",void 0),Object(n.a)([Object(s.b)({type:String,json:{write:!0}})],_.prototype,"normalizationField",void 0),Object(n.a)([Object(s.b)({type:[j],json:{write:!0}})],_.prototype,"stops",null),_=O=Object(n.a)([Object(c.a)("esri.renderers.visualVariables.OpacityVariable")],_);var w=_,x=r(483),S=r(458),T=r(19),C=r(44),M=r(181);const P=o.a.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),A={color:m,size:S.a,opacity:w,rotation:x.a},E=new C.a({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),R=/^\[([^\]]+)\]$/i;let I=class extends T.a{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter((e=>!!e)))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,t)=>{let r=null;return r=e.target===t.target?0:e.target?1:-1,r}));for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:i,rotationType:n}=t,s=i&&i.match(R),a=s&&s[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map((e=>{const t=E.read(e.type),i=A[t];i||(P.warn(`Unknown variable type: ${t}`),r&&r.messages&&r.messages.push(new M.a("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:r})));const n=new i;return n.read(e,r),n}))}writeVariables(e,t){const r=[];for(const i of e){const e=i.toJSON(t);e&&r.push(e)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};Object(n.a)([Object(s.b)()],I.prototype,"visualVariables",null),I=Object(n.a)([Object(c.a)("esri.renderers.visualVariables.VisualVariableFactory")],I);var D=I;const F={base:h.a,key:"type",typeMap:{opacity:w,color:m,rotation:x.a,size:S.a}},L=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new D}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,r){return this._vvFactory.readVariables(e,t,r)}writeVisualVariables(e,t,r,i){t[r]=this._vvFactory.writeVariables(e,i)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const e of this.visualVariables)if(e.arcadeRequired)return!0;return!1}hasVisualVariables(e,t){return e?!!this.getVisualVariablesForType(e,t):!!(this.getVisualVariablesForType("size",t)||this.getVisualVariablesForType("color",t)||this.getVisualVariablesForType("opacity",t)||this.getVisualVariablesForType("rotation",t))}getVisualVariablesForType(e,t){const r=this.visualVariables;if(!r)return;const i=r.filter((r=>r.type===e&&("string"==typeof t?r.target===t:!1!==t||!r.target)));return i&&0===i.length?void 0:i}async collectVVRequiredFields(e,t){let r=[];this.visualVariables&&(r=r.concat(this.visualVariables));for(const i of r)i&&(i.field&&Object(d.d)(e,t,i.field),i.normalizationField&&Object(d.d)(e,t,i.normalizationField),i.valueExpression&&await Object(d.a)(e,t,i.valueExpression))}};return Object(n.a)([Object(s.b)({types:[F],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),Object(n.a)([Object(l.a)("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),Object(n.a)([Object(u.a)("visualVariables")],t.prototype,"writeVisualVariables",null),t=Object(n.a)([Object(c.a)("esri.renderers.mixins.VisualVariablesMixin")],t),t}},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(170);let l=i=class extends o.a{constructor(e){super(e),this.description=null,this.displayType=null,this.title=null,this.type="attachments"}clone(){return new i({description:this.description,displayType:this.displayType,title:this.title})}};Object(n.a)([Object(s.b)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],l.prototype,"description",void 0),Object(n.a)([Object(s.b)({type:["preview","list"],json:{write:!0}})],l.prototype,"displayType",void 0),Object(n.a)([Object(s.b)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],l.prototype,"title",void 0),Object(n.a)([Object(s.b)({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"type",void 0),l=i=Object(n.a)([Object(a.a)("esri.popup.content.AttachmentsContent")],l);var c=l;t.a=c},function(e,t,r){"use strict";var i,n=r(0),s=r(44),a=r(14),o=r(13),l=r(1),c=(r(9),r(8),r(7),r(37)),u=r(4),d=r(335);let h=i=class extends a.a{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new i({fieldName:this.fieldName,format:this.format?Object(o.a)(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],h.prototype,"fieldName",void 0),Object(n.a)([Object(l.b)({type:d.a,json:{write:!0}})],h.prototype,"format",void 0),Object(n.a)([Object(l.b)({type:Boolean,json:{write:!0,default:!1}})],h.prototype,"isEditable",void 0),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],h.prototype,"label",void 0),Object(n.a)([Object(c.a)(new s.a({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],h.prototype,"stringFieldOption",void 0),Object(n.a)([Object(l.b)({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],h.prototype,"statisticType",void 0),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],h.prototype,"tooltip",void 0),Object(n.a)([Object(l.b)({type:Boolean,json:{write:!0}})],h.prototype,"visible",void 0),h=i=Object(n.a)([Object(u.a)("esri.popup.FieldInfo")],h);var p=h;t.a=p},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(134),o=r(1),l=(r(9),r(8),r(7),r(37)),c=r(32),u=r(4),d=r(29),h=r(89),p=r(121);let f=i=class extends p.a{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const r in e)t[r]=e[r]}async collectRequiredFields(e,t){if("CIMSymbolReference"===this.data.type){const r=this.data.primitiveOverrides;if(r){const i=r.map((r=>{const i=r.valueExpressionInfo;return Object(h.a)(e,t,i.expression)}));await Promise.all(i)}}}clone(){return new i({data:Object(s.a)(this.data)})}hash(){return Object(a.b)(JSON.stringify(this.data)).toString()}};Object(n.a)([Object(o.b)({json:{write:!1}})],f.prototype,"color",void 0),Object(n.a)([Object(o.b)({json:{write:!0}})],f.prototype,"data",void 0),Object(n.a)([Object(c.a)("data",["symbol"])],f.prototype,"readData",null),Object(n.a)([Object(d.a)("data")],f.prototype,"writeData",null),Object(n.a)([Object(l.a)({CIMSymbolReference:"cim"},{readOnly:!0})],f.prototype,"type",void 0),f=i=Object(n.a)([Object(u.a)("esri.symbols.CIMSymbol")],f);var b=f;t.a=b},function(e,t,r){"use strict";var i=r(0),n=r(44),s=r(14),a=r(7),o=r(1),l=(r(8),r(45)),c=r(4),u=r(9),d=r(512);const h=a.a.getLogger("esri.renderers.visualVariables.VisualVariable"),p=new n.a({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let f=class extends s.a{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(h.error(".field: field must be a string value"),null):Object(u.l)(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};Object(i.a)([Object(o.b)()],f.prototype,"index",void 0),Object(i.a)([Object(o.b)({type:p.apiValues,readOnly:!0,json:{read:p.read,write:p.write}})],f.prototype,"type",void 0),Object(i.a)([Object(o.b)({type:String,json:{write:!0}})],f.prototype,"field",void 0),Object(i.a)([Object(l.a)("field")],f.prototype,"castField",null),Object(i.a)([Object(o.b)({type:String,json:{write:!0}})],f.prototype,"valueExpression",void 0),Object(i.a)([Object(o.b)({type:String,json:{write:!0}})],f.prototype,"valueExpressionTitle",void 0),Object(i.a)([Object(o.b)({readOnly:!0})],f.prototype,"arcadeRequired",null),Object(i.a)([Object(o.b)({type:d.a,json:{write:!0}})],f.prototype,"legendOptions",void 0),f=Object(i.a)([Object(c.a)("esri.renderers.visualVariables.VisualVariable")],f);var b=f;t.a=b},function(e,t,r){"use strict";var i,n=r(0),s=r(2),a=r(1),o=(r(8),r(9),r(7),r(37)),l=r(4),c=r(147),u=r(388),d=r(19);let h=i=class extends d.a{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new i({x:this.x,y:this.y,z:this.z})}};Object(n.a)([Object(a.b)({type:Number})],h.prototype,"x",void 0),Object(n.a)([Object(a.b)({type:Number})],h.prototype,"y",void 0),Object(n.a)([Object(a.b)({type:Number})],h.prototype,"z",void 0),h=i=Object(n.a)([Object(l.a)("esri.symbols.support.Symbol3DAnchorPosition3D")],h);var p,f=r(187);let b=p=class extends c.a{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new p({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:Object(s.j)(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}};Object(n.a)([Object(a.b)({type:f.a,json:{write:!0}})],b.prototype,"material",void 0),Object(n.a)([Object(a.b)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],b.prototype,"castShadows",void 0),Object(n.a)([Object(a.b)({type:u.a,json:{write:!0}})],b.prototype,"resource",void 0),Object(n.a)([Object(o.a)({Object:"object"},{readOnly:!0})],b.prototype,"type",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],b.prototype,"width",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],b.prototype,"height",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],b.prototype,"depth",void 0),Object(n.a)([Object(o.a)({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),Object(a.b)({json:{default:"origin"}})],b.prototype,"anchor",void 0),Object(n.a)([Object(a.b)({type:h,json:{type:[Number],read:{reader:e=>new h({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],b.prototype,"anchorPosition",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],b.prototype,"heading",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],b.prototype,"tilt",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],b.prototype,"roll",void 0),Object(n.a)([Object(a.b)({readOnly:!0})],b.prototype,"isPrimitive",null),b=p=Object(n.a)([Object(l.a)("esri.symbols.ObjectSymbol3DLayer")],b);var m=b;t.a=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return f}));r(85);const i=(e,t,r)=>[t,r],n=(e,t,r)=>[t,r,e[2]],s=(e,t,r)=>[t,r,e[2],e[3]];function a(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function o({scale:e,translate:t},r){return r*e[0]+t[0]}function l({scale:e,translate:t},r){return t[1]-r*e[1]}function c(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=e.scale;let a=o(e,r[0][0]),c=l(e,r[0][1]);i[0]=t(r[0],a,c);for(let o=1;o<r.length;o++){const e=r[o];a+=e[0]*n,c-=e[1]*s,i[o]=t(e,a,c)}return i}function u(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=c(e,t,r[n]);return i}function d(e,t,r,a,o){return t.points=function(e,t,r,a){return c(e,r?a?s:n:a?n:i,t)}(e,r.points,a,o),t}function h(e,t,r,i,n){return t.x=o(e,r.x),t.y=l(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function p(e,t,r,a,o){return t.rings=function(e,t,r,a){return u(e,r?a?s:n:a?n:i,t)}(e,r.rings,a,o),t}function f(e,t,r,a,o){return t.paths=function(e,t,r,a){return u(e,r?a?s:n:a?n:i,t)}(e,r.paths,a,o),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(5);class n{constructor(e,t){this.vec3=e,this.id=t}}function s(e,t,r,s){return new n(Object(i.g)(e,t,r),s)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return $}));var i=r(10),n=r(2),s=r(17),a=r(52),o=r(83),l=r(16),c=r(20),u=r(18),d=r(27),h=r(3),p=r(5);function f(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}var b=r(28),m=r(94),g=r(136),y=r(456),v=r(103),O=r(219),j=r(33),_=r(137),w=r(88),x=r(123),S=r(379),T=r(0),C=r(61),M=r(269),P=r(310),A=r(96),E=r(316),R=r(98),I=r(186),D=r(315),F=r(92),L=r(77),k=r(82),z=r(15),V=r(62),N=r(75),U=r(74),B=r(30);class G extends k.a{initializeProgram(e){const t=G.shader.get(),r=this.configuration,i=t.build({output:r.output,FrontFacePass:2===r.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:r.occlusionTestEnabled,signedDistanceFieldEnabled:r.sdf,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:r.debugDrawBorder,binaryHighlightOcclusionEnabled:r.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,pixelSnappingEnabled:r.pixelSnappingEnabled,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!1,isDraped:r.isDraped,multipassGeometryEnabled:r.multipassGeometryEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new U.a(e.rctx,i,V.a)}bindPass(e,t){Object(F.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(M.b)(this.program,e,t),Object(D.b)(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),Object(F.f)(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(E.a)(this.program,t),Object(R.a)(this.program,t)):(Object(P.b)(this.program,t),Object(S.c)(this.program,e,t.camera.pixelRatio||1),Object(I.b)(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&Object(A.b)(this.program,t)}bindDraw(e){Object(F.d)(this.program,e),Object(F.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(C.c)(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e){const t=this.configuration,r=3===e,i=2===e,n=this.configuration.polygonOffsetEnabled&&q,s=(r||i)&&4!==t.output?(t.depthEnabled||6===t.output)&&B.e:null;return Object(B.g)({blending:0===t.output||7===t.output||4===t.output?r?H:Object(N.a)(e):null,depthTest:{func:515},depthWrite:s,colorWrite:B.d,polygonOffset:n})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return 6===this.configuration.output?0:4}}G.shader=new L.a(S.a,(()=>r.e(190).then(r.bind(null,1047))));const q={factor:0,units:-4},H=Object(B.i)(1,771);class W extends z.a{constructor(){super(...arguments),this.output=0,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=0,this.debugDrawBorder=!0,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=3,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(T.a)([Object(z.b)({count:8})],W.prototype,"output",void 0),Object(T.a)([Object(z.b)()],W.prototype,"occlusionTestEnabled",void 0),Object(T.a)([Object(z.b)()],W.prototype,"sdf",void 0),Object(T.a)([Object(z.b)()],W.prototype,"vvSize",void 0),Object(T.a)([Object(z.b)()],W.prototype,"vvColor",void 0),Object(T.a)([Object(z.b)()],W.prototype,"verticalOffset",void 0),Object(T.a)([Object(z.b)()],W.prototype,"screenSizePerspective",void 0),Object(T.a)([Object(z.b)({count:2})],W.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(T.a)([Object(z.b)()],W.prototype,"debugDrawBorder",void 0),Object(T.a)([Object(z.b)()],W.prototype,"binaryHighlightOcclusion",void 0),Object(T.a)([Object(z.b)()],W.prototype,"slicePlaneEnabled",void 0),Object(T.a)([Object(z.b)()],W.prototype,"polygonOffsetEnabled",void 0),Object(T.a)([Object(z.b)()],W.prototype,"depthEnabled",void 0),Object(T.a)([Object(z.b)({count:4})],W.prototype,"transparencyPassType",void 0),Object(T.a)([Object(z.b)()],W.prototype,"pixelSnappingEnabled",void 0),Object(T.a)([Object(z.b)()],W.prototype,"isDraped",void 0),Object(T.a)([Object(z.b)()],W.prototype,"multipassGeometryEnabled",void 0),Object(T.a)([Object(z.b)()],W.prototype,"multipassTerrainEnabled",void 0),Object(T.a)([Object(z.b)()],W.prototype,"cullAboveGround",void 0);class $ extends v.a{constructor(e){super(e,be),this.techniqueConfig=new W}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,r,i,n,s,a,o,l){l?this.intersectDrapedHudGeometry(e,s,a,o):this.intersectHudGeometry(e,t,r,i,a,o)}intersectDrapedHudGeometry(e,t,r,i){const s=e.vertexAttributes.get("position"),a=e.vertexAttributes.get("size"),o=this.params,l=Object(S.d)(o);let c=1,u=1;if(Object(n.j)(i)){const e=i(ue);c=e[0],u=e[5]}c*=e.screenToWorldRatio,u*=e.screenToWorldRatio;const d=he*e.screenToWorldRatio;for(let n=0;n<s.data.length/s.size;n++){const i=n*s.size,h=s.data[i],p=s.data[i+1],f=n*a.size;let b;pe[0]=a.data[f]*c,pe[1]=a.data[f+1]*u,o.textureIsSignedDistanceField&&(b=o.outlineSize*e.screenToWorldRatio/2),J(t,h,p,pe,d,b,o,l)&&r()}}intersectHudGeometry(e,t,r,i,s,o){if(!i.options.selectionMode||!i.options.hud)return;if(Object(x.e)(t))return;const c=this.params;let u=1,d=1;if(Object(a.f)(se,r),Object(n.j)(o)){const e=o(ue);u=e[0],d=e[5],function(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+i*i),d=1/Math.sqrt(n*n+s*s+a*a),h=1/Math.sqrt(o*o+l*l+c*c);e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=n*d,e[4]=s*d,e[5]=a*d,e[6]=o*h,e[7]=l*h,e[8]=c*h}(se)}const f=e.vertexAttributes.get("position"),b=e.vertexAttributes.get("size"),m=e.vertexAttributes.get("normal"),g=e.vertexAttributes.get("auxpos1");Object(j.a)(f.size>=3);const y=i.point,v=i.camera,_=Object(S.d)(c);u*=v.pixelRatio,d*=v.pixelRatio;const w="screen"===this.params.centerOffsetUnits;for(let n=0;n<f.data.length/f.size;n++){const e=n*f.size;Object(h.y)(ee,f.data[e],f.data[e+1],f.data[e+2]),Object(h.s)(ee,ee,r);const t=n*b.size;pe[0]=b.data[t]*u,pe[1]=b.data[t+1]*d,Object(h.s)(ee,ee,v.viewMatrix);const a=n*g.size;if(Object(h.y)(le,g.data[a+0],g.data[a+1],g.data[a+2]),!w&&(ee[0]+=le[0],ee[1]+=le[1],0!==le[2])){const e=le[2];Object(h.t)(le,ee),Object(h.l)(ee,ee,Object(h.g)(le,le,e))}const o=n*m.size;if(Object(h.y)(te,m.data[o],m.data[o+1],m.data[o+2]),this.normalAndViewAngle(te,se,v,ce),this.applyVerticalOffsetTransformationView(ee,ce,v,Y),v.applyProjection(ee,re),re[0]>-1){let e=Math.floor(re[0])+this.params.screenOffset[0],t=Math.floor(re[1])+this.params.screenOffset[1];w&&(e+=le[0],0!==le[1]&&(t+=Object(O.b)(le[1],Y.factorAlignment))),Object(O.a)(pe,Y.factor,pe);const r=de*v.pixelRatio;let n;if(c.textureIsSignedDistanceField&&(n=c.outlineSize*v.pixelRatio/2),J(y,e,t,pe,r,n,c,_)){const e=i.ray;if(Object(h.s)(ne,ee,Object(l.a)(oe,v.viewMatrix)),re[0]=y[0],re[1]=y[1],v.unprojectFromRenderScreen(re,ee)){const t=Object(p.e)();Object(h.m)(t,e.direction);const r=1/Object(h.r)(t);Object(h.g)(t,t,r),s(Object(h.o)(e.origin,ee)*r,t,-1,1,!0,ne)}}}}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return!1;const i=r.get("position"),n=e.indices.get("position");return Object(g.b)(i,n,t)}createBufferWriter(){return new ge(this)}normalAndViewAngle(e,t,r,i){return f(t)&&(t=Object(a.f)(ae,t)),Object(h.z)(i.normal,e,t),Object(h.s)(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=Object(h.j)(ie,fe),i}updateScaleInfo(e,t,r){const i=this.params;i.screenSizePerspective?Object(O.e)(r,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?Object(O.e)(r,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,r,i,n,s,a){const o=this.normalAndViewAngle(t,r,n,ce);return this.applyVerticalGroundOffsetView(e,o,n,a),this.applyVerticalOffsetTransformationView(a,o,n,s),this.applyPolygonOffsetView(a,o,i[3],n,a),this.applyCenterOffsetView(a,i,a),a}applyShaderOffsetsNDC(e,t,r,i,s){return this.applyCenterOffsetNDC(e,t,r,i),Object(n.j)(s)&&Object(h.m)(s,i),this.applyPolygonOffsetNDC(i,t,r,i),i}applyPolygonOffsetView(e,t,r,n,s){const a=n.aboveGround?1:-1;let o=Object(i.t)(r);0===o&&(o=a);const l=a*o;if(this.params.shaderPolygonOffset<=0)return Object(h.m)(s,e);const c=Object(i.e)(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return Object(h.g)(s,e,l>0?u:1/u),s}applyVerticalGroundOffsetView(e,t,r,i){const n=Object(h.r)(e),s=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),o=Object(h.g)(ee,t.normal,s*a);return Object(h.h)(i,e,o),i}applyVerticalOffsetTransformationView(e,t,r,i){const n=this.params;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const r=Object(h.r)(e);this.updateScaleInfo(i,r,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const s=Object(h.r)(e),a=n.screenSizePerspectiveAlignment||n.screenSizePerspective,o=Object(w.l)(r,s,n.verticalOffset,t.cosAngle,a);return this.updateScaleInfo(i,s,t.cosAngle),Object(h.g)(t.normal,t.normal,o),Object(h.h)(e,e,t.normal)}applyCenterOffsetView(e,t,r){const i="screen"!==this.params.centerOffsetUnits;return r!==e&&Object(h.m)(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(Object(h.t)(te,r),Object(h.h)(r,r,Object(h.g)(te,te,t[2])))),r}applyCenterOffsetNDC(e,t,r,i){const n="screen"!==this.params.centerOffsetUnits;return i!==e&&Object(h.m)(i,e),n||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}applyPolygonOffsetNDC(e,t,r,n){const s=this.params.shaderPolygonOffset;if(e!==n&&Object(h.m)(n,e),s){const e=r.aboveGround?1:-1,a=e*Object(i.t)(t[3]);n[2]-=(a||e)*s}return n}getGLMaterial(e){return 0===e.output||7===e.output?new Z(e):4===e.output?new X(e):void 0}calculateRelativeScreenBounds(e,t,r=Object(b.k)()){return function(e,t,r,i=K){Object(u.c)(i,e.anchorPos),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r}(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}}class Q extends y.a{constructor(e){super({...e,...e.material.params}),this.updateParameters()}beginSlot(e){return e===(this._material.params.drawInSecondSlot?19:18)}updateParameters(e){this.updateTexture(this._material.params.textureId),this.selectProgram(e)}selectProgram(e){this._technique=this._techniqueRep.releaseAndAcquire(G,this._material.getTechniqueConfig(this._output,e),this._technique)}ensureParameters(e){this.updateParameters(e)}bind(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}}class Z extends Q{constructor(e){super(e),this._isOcclusionSlot=!1}beginSlot(e){const t=this._material.params.drawInSecondSlot?19:18;return this._material.params.occlusionTest?(this._isOcclusionSlot=12===e,12===e||e===t):(this._isOcclusionSlot=!1,e===t)}get technique(){return this._isOcclusionSlot?this._occlusionTechnique:this._technique}selectProgram(e){this._technique=this._techniqueRep.releaseAndAcquire(G,this._material.getTechniqueConfig(this._output,e),this._technique),this._occlusionTechnique=this._techniqueRep.releaseAndAcquire(G,this._material.getTechniqueConfig(6,e),this._occlusionTechnique)}bind(e){const t=this.technique;this._isOcclusionSlot||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.params,e)}}class X extends Q{constructor(e){super({...e,output:4})}}function J(e,t,r,i,n,s,a,o){let l=t-n-(o[0]>0?i[0]*o[0]:0),c=l+i[0]+2*n,u=r-n-(o[1]>0?i[1]*o[1]:0),d=u+i[1]+2*n;if(a.textureIsSignedDistanceField){const e=a.distanceFieldBoundingBox;l+=i[0]*e[0],u+=i[1]*e[1],c-=i[0]*(1-e[2]),d-=i[1]*(1-e[3]),l-=s,c+=s,u-=s,d+=s}return e[0]>l&&e[0]<c&&e[1]>u&&e[1]<d}const Y={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},K=Object(d.b)(),ee=Object(p.e)(),te=Object(p.e)(),re=Object(s.d)(),ie=Object(p.e)(),ne=Object(p.e)(),se=Object(o.b)(),ae=Object(o.b)(),oe=Object(c.d)(),le=Object(p.e)(),ce={normal:ie,cosAngle:0},ue=Object(c.d)(),de=1,he=2,pe=[0,0],fe=Object(p.g)(0,0,1),be={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(d.f)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...v.b},me=Object(m.a)().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");class ge{constructor(e){this.material=e,this.vertexBufferLayout=me}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,r,i){Object(_.e)(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,r.position,i,6),Object(_.d)(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,r.normal,i,6);{const e=t.vertexAttributes.get("uv0").data;let n,s,a,o;if(null==e||e.length<4){const e=this.material.params;n=0,s=0,a=e.texCoordScale[0],o=e.texCoordScale[1]}else n=e[0],s=e[1],a=e[2],o=e[3];a=Math.min(1.99999,a+1),o=Math.min(1.99999,o+1);const l=t.indices.get("position").length,c=r.uv0;let u=i;for(let t=0;t<l;++t)c.set(u,0,n),c.set(u,1,s),u+=1,c.set(u,0,a),c.set(u,1,s),u+=1,c.set(u,0,a),c.set(u,1,o),u+=1,c.set(u,0,a),c.set(u,1,o),u+=1,c.set(u,0,n),c.set(u,1,o),u+=1,c.set(u,0,n),c.set(u,1,s),u+=1}Object(_.b)(t.indices.get("color"),t.vertexAttributes.get("color").data,4,r.color,i,6);{const e=t.indices.get("size"),n=t.vertexAttributes.get("size").data,s=e.length,a=r.size;let o=i;for(let t=0;t<s;++t){const r=n[2*e[t]],i=n[2*e[t]+1];for(let e=0;e<6;++e)a.set(o,0,r),a.set(o,1,i),o+=1}}t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&Object(_.a)(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,r.auxpos1,i,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&Object(_.a)(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,r.auxpos2,i,6)}}},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(38),o=r(153),l=r(120),c=r(11),u=r(14),d=r(13),h=r(159),p=r(372),f=r(7),b=r(12),m=r(1),g=r(9),y=(r(8),r(4)),v=r(29),O=r(37);let j=i=class extends u.a{constructor(e){super(e),this.type="none"}clone(){return new i({type:this.type})}};Object(n.a)([Object(O.a)({none:"none",stayAbove:"stay-above"})],j.prototype,"type",void 0),j=i=Object(n.a)([Object(y.a)("esri.ground.NavigationConstraint")],j);var _,w=r(200);const x=f.a.getLogger("esri.Ground");let S=_=class extends(Object(u.b)(h.a)){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new a.a;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"!==e.type&&"base-elevation"!==e.type&&x.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>(e=>{e.parent=null})(e.item)))}initialize(){this.when().catch((e=>{x.error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",Object(o.b)(e,this._get("layers")))}writeLayers(e,t,r,i){const n=[];e?(i={...i,layerContainerType:"ground"},e.forEach((e=>{if("write"in e){const t={};Object(l.b)(e)().write(t,i)&&n.push(t)}else i&&i.messages&&i.messages.push(new c.a("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in the ground`,{layer:e}))})),t.layers=n):t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Object(p.a)(this,(e=>{e(this.layers)}))}async queryElevation(e,t){await this.load({signal:null==t?void 0:t.signal});const{ElevationQuery:i}=await r.e(8).then(r.bind(null,967));Object(b.x)(t);const n=new i,s=this.layers.filter(T).toArray();return n.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:null==t?void 0:t.signal});const{ElevationQuery:i}=await r.e(8).then(r.bind(null,967));Object(b.x)(t);const n=new i,s=this.layers.filter(T).toArray();return n.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:Object(d.a)(this.surfaceColor),navigationConstraint:Object(d.a)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new _({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const n=t&&t.origin||"web-scene",s=t&&t.portal||null,a=t&&t.url||null;return r.e(11).then(r.bind(null,695)).then((({populateOperationalLayers:t})=>{Object(b.x)(i);const r=[];if(e.layers&&Array.isArray(e.layers)){const i={context:{origin:n,url:a,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};r.push(t(this.layers,e.layers,i))}return Object(b.k)(r)})).then((()=>{}))}};function T(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}Object(n.a)([Object(m.b)({json:{read:!1}})],S.prototype,"layers",null),Object(n.a)([Object(v.a)("layers")],S.prototype,"writeLayers",null),Object(n.a)([Object(m.b)({readOnly:!0})],S.prototype,"resourceInfo",void 0),Object(n.a)([Object(m.b)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:g.a,read:{reader:w.b,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Object(w.a)(e)},target:"transparency"}}})],S.prototype,"opacity",void 0),Object(n.a)([Object(m.b)({type:s.a,json:{type:[g.a],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],S.prototype,"surfaceColor",void 0),Object(n.a)([Object(m.b)({type:j,json:{write:!0}})],S.prototype,"navigationConstraint",void 0),S=_=Object(n.a)([Object(y.a)("esri.Ground")],S);var C=S;t.a=C},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(4)),l=r(217),c=r(501),u=r(502);const d={base:c.a,key:"type",typeMap:{color:u.a}};const h={types:d,json:{read:(p=d,(e,t,r)=>{if(!e)return e;for(const i in p.typeMap)if(e.type===i){const t=new p.typeMap[i];return t.read(e,r),t}}),write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.isPresentation})}}};var p,f;const b=(e,t,r)=>({enabled:!r||!r.isPresentation});let m=f=class extends n.a{constructor(e){super(e),this.lighting=new l.a,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}clone(){return new f(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:l.a.prototype.clone.call(this.lighting),background:Object(s.a)(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}}};Object(i.a)([Object(a.b)({type:l.a,json:{write:!0}})],m.prototype,"lighting",void 0),Object(i.a)([Object(a.b)(h)],m.prototype,"background",void 0),Object(i.a)([Object(a.b)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:b}}})],m.prototype,"atmosphereEnabled",void 0),Object(i.a)([Object(a.b)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:b}}})],m.prototype,"starsEnabled",void 0),m=f=Object(i.a)([Object(o.a)("esri.webscene.Environment")],m);var g=m;t.a=g},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return n}));var i=r(35);const n=new i.a("white"),s=(new i.a("black"),new i.a([255,255,255,0]));function a(e){return 0===e.r&&0===e.g&&0===e.b}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(44);const n=Object(i.b)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return u}));var i=r(9);var n=r(246);function s(e){e.name&&(e.read&&"object"==typeof e.read?void 0===e.read.source&&(e.read.source=e.name):e.read={source:e.name},e.write&&"object"==typeof e.write?void 0===e.write.target&&(e.write.target=e.name):e.write={target:e.name})}function a(e){"boolean"==typeof e.read?e.read={enabled:e.read}:"function"==typeof e.read?e.read={enabled:!0,reader:e.read}:e.read&&"object"==typeof e.read&&void 0===e.read.enabled&&(e.read.enabled=!0)}function o(e){"boolean"==typeof e.write?e.write={enabled:e.write}:"function"==typeof e.write?e.write={enabled:!0,writer:e.write}:e.write&&"object"==typeof e.write&&void 0===e.write.enabled&&(e.write.enabled=!0)}var l=r(364);function c(e,t){return d(e,"read",t)}function u(e,t){return d(e,"write",t)}function d(e,t,r){let i=e&&e.json;if(e&&e.json&&e.json.origins&&r){const n=e.json.origins[r.origin];n&&("any"===t||t in n)&&(i=n)}return i}function h(e){const t=function(e){return e.type?function(e){if(!e.type)return;let t=0,r=e.type;for(;Array.isArray(r)&&!Object(i.o)(r);)r=r[0],t++;return{type:r,ndimArray:t}}(e):function(e){if(!e.types)return;let t=0,r=e.types;for(;Array.isArray(r);)r=r[0],t++;return{types:r,ndimArray:t}}(e)}(e);if(e.json.origins)for(const r in e.json.origins){const i=e.json.origins[r];Object(n.a)(t,i,!1),Object(l.a)(t,i)}Object(n.a)(t,e.json,!0),Object(l.a)(t,e.json)}const p={processPrototypePropertyMetadata(e,t){(function(e){if(e.json||(e.json={}),a(e.json),o(e.json),s(e.json),e.json.origins)for(const t in e.json.origins)a(e.json.origins[t]),o(e.json.origins[t]),s(e.json.origins[t]);return!0})(t)&&(function(e){if(e.json&&e.json.origins){const t=e.json.origins,r={"web-document":["web-scene","web-map"]};for(const e in r)if(t[e]){const i=t[e];r[e].forEach((e=>{t[e]=i})),delete t[e]}}}(t),h(t))}}},function(e,t,r){"use strict";class i{constructor(e=null,t={},r,i){this.displayId=0,this.geohashX=0,this.geohashY=0,this.geometry=e,t&&(this.attributes=t),r&&(this.centroid=r),null!=i&&(this.objectId=i)}get hasGeometry(){return!(!this.geometry||!this.geometry.coords||!this.geometry.coords.length)}weakClone(){const e=new i(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}t.a=i},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return l}));var i=r(65),n=r(385);let s=!1;const a=[];function o(e,t,r={runImmediately:!1}){let a=new n.a((function r(){if(!a||l)return;if(s)return void d(r);const n=o;a.clear(),s=!0,l=!0,o=Object(i.b)(a,e),l=!1,s=!1,t(o,n),h()})),o=null,l=!1;return l=!0,o=Object(i.b)(a,e),l=!1,r.runImmediately&&t(o,o),{remove:function(){a&&(a.destroy(),a=null,o=null)}}}function l(e,t){return o(e,t,{runImmediately:!0})}function c(e,t){let r=new n.a((function(){t(s,a)})),s=null;function a(){return r?(r.clear(),s=Object(i.b)(r,e),s):null}return a(),{remove:function(){r&&(r.destroy(),r=null),s=null}}}function u(e){let t=new n.a((function n(){t&&!r&&(s?d(n):(t.clear(),s=!0,r=!0,Object(i.b)(t,e),r=!1,s=!1,h()))})),r=!1;return r=!0,Object(i.b)(t,e),r=!1,{remove:function(){t&&(t.destroy(),t=null)}}}function d(e){a.includes(e)||a.unshift(e)}function h(){for(;a.length;)a.pop()()}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));const i="20210707",n="17f9314e751fd1e720022ff5819d4e40def1f79a"},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(32)),l=r(4),c=r(29),u=r(503),d=r(505),h=r(170),p=r(536),f=r(506),b=r(507),m=r(508);let g=i=class extends h.a{constructor(e){super(e),this.activeMediaInfoIndex=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map((e=>"image"===e.type?p.a.fromJSON(e):"barchart"===e.type?u.a.fromJSON(e):"columnchart"===e.type?d.a.fromJSON(e):"linechart"===e.type?f.a.fromJSON(e):"piechart"===e.type?b.a.fromJSON(e):void 0)).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map((e=>e.toJSON()))}clone(){return new i({activeMediaInfoIndex:this.activeMediaInfoIndex,description:this.description,mediaInfos:this.mediaInfos?Object(s.a)(this.mediaInfos):null,title:this.title})}};Object(n.a)([Object(a.b)()],g.prototype,"activeMediaInfoIndex",void 0),Object(n.a)([Object(a.b)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],g.prototype,"description",void 0),Object(n.a)([Object(a.b)({types:[m.a]})],g.prototype,"mediaInfos",void 0),Object(n.a)([Object(o.a)("mediaInfos")],g.prototype,"readMediaInfos",null),Object(n.a)([Object(c.a)("mediaInfos")],g.prototype,"writeMediaInfos",null),Object(n.a)([Object(a.b)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],g.prototype,"title",void 0),Object(n.a)([Object(a.b)({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],g.prototype,"type",void 0),g=i=Object(n.a)([Object(l.a)("esri.popup.content.MediaContent")],g);var y=g;t.a=y},function(e,t,r){"use strict";var i,n=r(0),s=r(38),a=r(13),o=r(1),l=(r(9),r(8),r(7),r(37)),c=r(4),u=r(212),d=r(208),h=r(218),p=r(389);const f=s.a.ofType({base:null,key:"type",typeMap:{text:d.a}});let b=i=class extends u.a{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new f,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Object(h.b)(this)}hasVisibleVerticalOffset(){return Object(h.c)(this)}clone(){return new i({styleOrigin:Object(a.a)(this.styleOrigin),symbolLayers:Object(a.a)(this.symbolLayers),thumbnail:Object(a.a)(this.thumbnail),callout:Object(a.a)(this.callout),verticalOffset:Object(a.a)(this.verticalOffset)})}static fromTextSymbol(e){return new i({symbolLayers:[d.a.fromTextSymbol(e)]})}};Object(n.a)([Object(o.b)({type:p.a,json:{write:!0}})],b.prototype,"verticalOffset",void 0),Object(n.a)([Object(o.b)(h.a)],b.prototype,"callout",void 0),Object(n.a)([Object(o.b)({json:{read:!1,write:!1}})],b.prototype,"styleOrigin",void 0),Object(n.a)([Object(o.b)({type:f})],b.prototype,"symbolLayers",void 0),Object(n.a)([Object(l.a)({LabelSymbol3D:"label-3d"},{readOnly:!0})],b.prototype,"type",void 0),b=i=Object(n.a)([Object(c.a)("esri.symbols.LabelSymbol3D")],b);var m=b;t.a=m},function(e,t,r){"use strict";var i,n=r(0),s=r(38),a=r(13),o=r(1),l=(r(9),r(8),r(7),r(37)),c=r(4),u=r(253),d=r(349),h=r(212);const p=s.a.ofType({base:null,key:"type",typeMap:{line:u.a,path:d.a}}),f=s.a.ofType({base:null,key:"type",typeMap:{line:u.a,path:d.a}});let b=i=class extends h.a{constructor(e){super(e),this.symbolLayers=new p,this.type="line-3d"}clone(){return new i({styleOrigin:Object(a.a)(this.styleOrigin),symbolLayers:Object(a.a)(this.symbolLayers),thumbnail:Object(a.a)(this.thumbnail)})}static fromSimpleLineSymbol(e){return new i({symbolLayers:[u.a.fromSimpleLineSymbol(e)]})}};Object(n.a)([Object(o.b)({type:p,json:{type:f}})],b.prototype,"symbolLayers",void 0),Object(n.a)([Object(l.a)({LineSymbol3D:"line-3d"},{readOnly:!0})],b.prototype,"type",void 0),b=i=Object(n.a)([Object(c.a)("esri.symbols.LineSymbol3D")],b);var m=b;t.a=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return R}));var i,n=r(0),s=r(44),a=r(14),o=r(1),l=(r(8),r(45)),c=(r(7),r(37)),u=r(32),d=r(4),h=r(9),p=r(246),f=r(304),b=r(634),m=(r(113),r(39)),g=r(230);let y=i=class extends a.a{constructor(e){super(e),this.type="query-table"}clone(){var e;const{workspaceId:t,query:r,oidFields:n,spatialReference:s,geometryType:a}=this,o={workspaceId:t,query:r,oidFields:n,spatialReference:null!=(e=null==s?void 0:s.clone())?e:void 0,geometryType:a};return new i(o)}};var v;Object(n.a)([Object(c.a)({queryTable:"query-table"})],y.prototype,"type",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],y.prototype,"workspaceId",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],y.prototype,"query",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],y.prototype,"oidFields",void 0),Object(n.a)([Object(o.b)({type:m.a,json:{write:!0}})],y.prototype,"spatialReference",void 0),Object(n.a)([Object(c.a)(g.a)],y.prototype,"geometryType",void 0),y=i=Object(n.a)([Object(d.a)("esri.layers.support.source.QueryTableDataSource")],y);let O=v=class extends a.a{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new v({workspaceId:e,dataSourceName:t})}};var j;Object(n.a)([Object(c.a)({raster:"raster"})],O.prototype,"type",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],O.prototype,"dataSourceName",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],O.prototype,"workspaceId",void 0),O=v=Object(n.a)([Object(d.a)("esri.layers.support.source.RasterDataSource")],O);let _=j=class extends a.a{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:r}=this;return new j({workspaceId:e,gdbVersion:t,dataSourceName:r})}};var w,x;Object(n.a)([Object(c.a)({table:"table"})],_.prototype,"type",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],_.prototype,"workspaceId",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],_.prototype,"gdbVersion",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],_.prototype,"dataSourceName",void 0),_=j=Object(n.a)([Object(d.a)("esri.layers.support.source.TableDataSource")],_);const S=Object(s.b)()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let T=w=class extends a.a{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,r){return M()(e,t,r)}castLeftTableSource(e){return Object(h.k)(A(),e)}readRightTableSource(e,t,r){return M()(e,t,r)}castRightTableSource(e){return Object(h.k)(A(),e)}clone(){var e,t;const{leftTableKey:r,rightTableKey:i,leftTableSource:n,rightTableSource:s,joinType:a}=this,o={leftTableKey:r,rightTableKey:i,leftTableSource:null!=(e=null==n?void 0:n.clone())?e:void 0,rightTableSource:null!=(t=null==s?void 0:s.clone())?t:void 0,joinType:a};return new w(o)}};Object(n.a)([Object(c.a)({joinTable:"join-table"})],T.prototype,"type",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],T.prototype,"leftTableKey",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],T.prototype,"rightTableKey",void 0),Object(n.a)([Object(o.b)({json:{write:!0}})],T.prototype,"leftTableSource",void 0),Object(n.a)([Object(u.a)("leftTableSource")],T.prototype,"readLeftTableSource",null),Object(n.a)([Object(l.a)("leftTableSource")],T.prototype,"castLeftTableSource",null),Object(n.a)([Object(o.b)({json:{write:!0}})],T.prototype,"rightTableSource",void 0),Object(n.a)([Object(u.a)("rightTableSource")],T.prototype,"readRightTableSource",null),Object(n.a)([Object(l.a)("rightTableSource")],T.prototype,"castRightTableSource",null),Object(n.a)([Object(c.a)(S)],T.prototype,"joinType",void 0),T=w=Object(n.a)([Object(d.a)("esri.layers.support.source.JoinTableDataSource")],T);let C=null;function M(){return C||(C=Object(p.b)({types:A()})),C}let P=null;function A(){return P||(P={key:"type",base:null,typeMap:{"data-layer":R,"map-layer":b.a}}),P}const E={key:"type",base:null,typeMap:{"join-table":T,"query-table":y,raster:O,table:_}};let R=x=class extends a.a{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new x({fields:e,dataSource:t})}};Object(n.a)([Object(c.a)({dataLayer:"data-layer"})],R.prototype,"type",void 0),Object(n.a)([Object(o.b)({type:[f.a],json:{write:!0}})],R.prototype,"fields",void 0),Object(n.a)([Object(o.b)({types:E,json:{write:!0}})],R.prototype,"dataSource",void 0),R=x=Object(n.a)([Object(d.a)("esri.layers.support.source.DataLayerSource")],R),R.from=Object(h.m)(R)},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var i=r(8);const n=new Set;function s(e,t,r=!1){r&&n.has(t)||(r&&n.add(t),e.warn(`\ud83d\uded1 DEPRECATED - ${t}`))}function a(e,t,r={}){if(Object(i.a)("esri-deprecation-warnings")){const{moduleName:i}=r;o(e,"Function: "+((i?i+"::":"")+t+"()"),r)}}function o(e,t,r={}){if(Object(i.a)("esri-deprecation-warnings")){const{replacement:i,version:n,see:a,warnOnce:o}=r;let l=t;i&&(l+=`\n\t\ud83d\udee0\ufe0f Replacement: ${i}`),n&&(l+=`\n\t\u2699\ufe0f Version: ${n}`),a&&(l+=`\n\t\ud83d\udd17 See ${a} for more details.`),s(e,l,o)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var i=r(0),n=r(84),s=r(19),a=r(87),o=r(11),l=r(13),c=r(2),u=r(12),d=r(1),h=(r(9),r(8),r(7),r(4)),p=r(33);class f{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new b}}class b{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class m{constructor(e,t,r,i){this._workerFunc=e,this._callbackFunc=t,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=i.map((e=>new f(e)))}hasQuota(e){const t=this._clients[e];return!!t&&(this._totalNumWorkers<this._maxTotalNumWorkers||t.numWorkers+t.tasks.length<t.typeWorkerQuota)}push(e){const t=this._clients[e.client];t&&(this._totalNumWorkers<this._maxTotalNumWorkers?(t.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,((e,t)=>this._taskCallback(e,t)))):t.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(e){const t=this._clients[e.client];this._totalNumWorkers--,t.numWorkers--,t.statistics.requests++,t.statistics.size+=e.size||0,t.statistics.duration+=e.duration||0,t.statistics.speed=t.statistics.duration>0?t.statistics.size/t.statistics.duration:0,Object(p.a)(t.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),((e,t)=>this._taskCallback(e,t))))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,t){e._cancelled||(this._callbackFunc(e,t),this._taskFinished(e))}getStatsForType(e){const t=this._clients[e];return t?{quota:t.typeWorkerQuota,workers:t.numWorkers,queueSize:t.tasks.length,requestStats:t.statistics}:null}get test(){const e=this;return{set workerFunc(t){e._workerFunc=t}}}}var g=class extends class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}}{constructor(e,t,r,i,n){super(i),this.url=e,this.options=t,this.docType=r,this.key=n,this.result=null,this.status=1,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0}},y=r(80);let v=class extends s.a{constructor(){super(...arguments),this.tasks=new Map,this.onLoadQueue=new Array,this.doneQueue=new Array,this.updating=!1}setup(e,t,r){this.loadQueue=new m(((e,t)=>this.startLoading(e,t)),((e,t)=>this.doneLoadingCallback(e,t)),e,t),r&&(this.taskHandle=r.registerTask(y.b.STREAM_DATA_LOADER,this))}destroy(){this.taskHandle=Object(c.r)(this.taskHandle),this.tasks.forEach((e=>{e.abortController&&e.abortController.abort()})),this.loadQueue.destroy(),this.loadQueue=null,this.onLoadQueue=null,this.doneQueue=null,this.tasks=null}hasDownloadSlots(e){return this.loadQueue.hasQuota(e)}request(e,t,r,i={}){const n=Object(u.h)();n.__signal=Object(c.j)(i)?i.signal:null;const s=this.createOrUpdateTask(e,t,r,i,n);return Object(u.s)(i,(()=>this.cancelRequest(s,n))),n.promise}createTask(e,t,r,i,n,s){const a=new g(e,t,r,i,n);return this.updateTask(a,s),this.tasks.set(n,a),1===this.tasks.size&&this._set("updating",!0),this.loadQueue.push(a),a}cancelRequest(e,t){Object(a.k)(e.resolvers,t),t.reject(Object(u.f)()),0===e.resolvers.length&&(2===e.status&&(e.status=4,this.loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=4,this.tasks.delete(e.key),0===this.tasks.size&&this._set("updating",!1))}taskKey(e,t,r){return`${e}:${t}:${r}`}updateTask(e,t){e.resolvers.push(t)}createOrUpdateTask(e,t,r,i,n){const s=Object(c.j)(i)&&i.uid||e,a=this.taskKey(s,t,r),o=this.tasks.get(a);return o?(this.updateTask(o,n),o):this.createTask(e,i,t,r,a,n)}doneLoadingCallback(e,t){this.loadQueue&&(Object(p.a)(2===e.status),e.status=3,this.taskHandle?this.doneQueue.push({task:e,err:t}):this.doneLoading(e,t))}get running(){return this.doneQueue.length>0||this.onLoadQueue.length>0}runTask(e){for(;!e.done&&this.onLoadQueue.length>0;){const t=this.onLoadQueue.shift();Object(u.x)(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this.doneQueue.length>0;){const t=this.doneQueue.shift();3!==t.task.status&&(t.err=t.err||Object(u.f)()),this.doneLoading(t.task,t.err),e.madeProgress()}}doneLoading(e,t){let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const i of e.resolvers)if(t)Object(u.n)(t)?i.reject(t):i.reject(new o.a("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--r;const t=r<=0?e.result:Object(l.a)(e.result);i.resolve(t)}this.tasks.delete(e.key),0===this.tasks.size&&this._set("updating",!1)}startLoading(e,t){if(4===e.status)return!1;let r,i;switch(e.startTime=performance.now(),e.status=2,e.docType){case"binary":i="array-buffer",r=0;break;case"image":i="image";break;case"image+type":i="array-buffer";break;default:i="json"}e.abortController=Object(u.e)();const s=e.abortController.signal;e.request=Object(n.default)(e.url,{...e.options,responseType:i,timeout:r,signal:s});let a=()=>{};const o=r=>{e.duration=performance.now()-e.startTime,e.size=r instanceof ArrayBuffer?r.byteLength:e.size||0,e.result=r,this.taskHandle?this.onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},l=r=>{2===e.status&&t(e,r),a()};return"image+type"!==e.docType?(e.request.then((e=>o(e.data)),l),!0):(e.request.then((t=>{const c=t.data,u=function(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return 137===t[0]&&80===t[1]?"image/png":71===t[0]&&73===t[1]?"image/gif":66===t[0]&&77===t[1]?"image/bmp":255===t[0]&&216===t[1]?"image/jpeg":"unknown"}(c);if(i="image",e.size=c.byteLength,"unknown"===u)return e.request=Object(n.default)(e.url,{responseType:i,timeout:r,signal:s}),void e.request.then((e=>o(e.data)),l);const d=new Blob([c],{type:u}),h=window.URL.createObjectURL(d);a=()=>window.URL.revokeObjectURL(h),e.request=Object(n.default)(h,{responseType:i,timeout:r,signal:s}),e.request.then((e=>o(new O(e.data,u,a))),l)}),l),!0)}get test(){return{loadQueue:this.loadQueue}}};Object(i.a)([Object(d.b)({readOnly:!0})],v.prototype,"updating",void 0),v=Object(i.a)([Object(h.a)("esri.views.3d.support.StreamDataLoader")],v);class O{constructor(e,t,r){this.image=e,this.type=t,this.release=r}get isOpaque(){return"image/jpeg"===this.type}}var j=v;t.b=j},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return f}));var i=r(2),n=r(5),s=r(66),a=r(93),o=r(384),l=(r(109),r(145),r(47)),c=r(90),u=r(357),d=r(33);class h{constructor(e){this.context=e,this.svgAlwaysPremultipliesAlpha=!1,this._doublePrecisionRequiresObfuscation=null,async function(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const r=new a.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),i=s.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),n=new c.a(e,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:i}),u=new o.a(e,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));e.useProgram(u);const d=new l.a(e,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},t);e.bindTexture(d,0),u.setUniform1i("u_texture",0);const h=e.getBoundFramebufferObject(),{x:p,y:f,width:b,height:m}=e.getViewport();e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(5,0,4);const g=new Uint8Array(4);return r.readPixels(0,0,1,1,6408,5121,g),u.dispose(),n.dispose(!1),i.dispose(),r.dispose(),d.dispose(),e.setViewport(p,f,b,m),e.bindFramebuffer(h),t.src="",255===g[0]}(e).then((e=>this.svgAlwaysPremultipliesAlpha=!e))}get doublePrecisionRequiresObfuscation(){if(Object(i.i)(this._doublePrecisionRequiresObfuscation)){const e=m(this.context,!1),t=m(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}}let p=null;function f(e){return(Object(i.i)(p)||p.context!==e)&&(p=new h(e)),p}function b(e){Object(i.j)(p)&&p.context===e&&(p=null)}function m(e,t){const r=new a.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});const i=s.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),l=new c.a(e,new Map([["position",0]]),{geometry:[{name:"position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:i}),h=Object(n.g)(5633261.287538229,2626832.878767164,1434988.0495278358),p=Object(n.g)(5633271.46742708,2626873.6381334523,1434963.231608387),f=function(r,i){const n=new o.a(e,`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),s=new Float32Array(6);Object(u.a)(r,s,3);const a=new Float32Array(6);return Object(u.a)(i,a,3),e.useProgram(n),n.setUniform3f("u_highA",s[0],s[2],s[4]),n.setUniform3f("u_lowA",s[1],s[3],s[5]),n.setUniform3f("u_highB",a[0],a[2],a[4]),n.setUniform3f("u_lowB",a[1],a[3],a[5]),n}(h,p),b=e.getBoundFramebufferObject(),{x:m,y:g,width:y,height:v}=e.getViewport();e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.bindVAO(l),e.drawArrays(5,0,4);const O=new Uint8Array(4);r.readPixels(0,0,1,1,6408,5121,O),f.dispose(),l.dispose(!1),i.dispose(),r.dispose(),e.setViewport(m,g,y,v),e.bindFramebuffer(b);const j=(h[2]-p[2])/25,_=Object(d.n)(O);return Math.abs(j-_)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return w}));var i=r(173),n=r(13),s=r(497),a=r(128),o=r(453),l=r(189),c=r(289),u=r(101);class d{constructor(){this.uid=0,this.target=null,this.path=null,this.oldValue=null,this.callback=null,this.getValue=null,this.removed=!1,this.propertyPath=null}acquire(e,t,r,i,n){this.target=e,this.path=t,this.oldValue=r,this.callback=i,this.getValue=n,this.propertyPath=Object(u.g)(t),this.uid=++d.uid,this.removed=!1}release(){this.target=this.path=this.propertyPath=this.callback=this.oldValue=null,this.uid=++d.uid,this.removed=!0}}d.pool=new s.a(d),d.uid=0;const h=new i.a,p=new Set;let f;function b(e){p.delete(e),p.add(e),f||(f=Object(a.b)(v))}function m(e){if(e.removed)return;const{callback:t,path:r,oldValue:i,target:n}=e,s=e.getValue();g(i,s)&&(e.oldValue=s,t.call(n,s,i,r,n))}function g(e,t){return!Object(n.b)(e,t)}function y(e){for(const t of p.values())t.target===e&&(t.removed=!0)}function v(){let e=10;for(;f&&e--;){f=null;const e=O(),t=h.acquire();for(const r of e){const e=r.uid;m(r),e===r.uid&&r.removed&&t.push(r)}for(const r of p)r.removed&&(t.push(r),p.delete(r));for(let r=0;r<t.length;r++)d.pool.release(t[r]);h.release(t),h.release(e),j.forEach((e=>e()))}}function O(){const e=h.acquire();e.length=p.size;let t=0;for(const r of p)e[t]=r,++t;return p.clear(),e}const j=new Set;function _(e){return j.add(e),{remove(){j.delete(e)}}}function w(e,t,r,i=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:i?function(e,t,r){const i=Object(u.e)(e,t,r,((e,t,r)=>{let n=!1;return Object(c.b)((()=>Object(l.c)(e,t)),((s,a)=>{e.__accessor__.destroyed?i.remove():n||(n=!0,g(a,s)&&r.call(e,s,a,t,e),n=!1)}))}));return i}(e,t,r):function(e,t,r){let i=Object(u.e)(e,t,r,((e,t,r)=>{let n,s,a=Object(c.c)((()=>Object(l.c)(e,t)),((a,o)=>{e.__accessor__.destroyed||n&&n.uid!==s?i.remove():(n||(n=d.pool.acquire(e,t,a,r,o),s=n.uid),b(n))}));return{remove:Object(u.d)((function(){a.remove(),n&&(n.uid!==s||n.removed||(n.removed=!0,b(n)),n=null),i=a=null}))}}));return i}(e,t,r)}function x(e){return Object(o.a)(p,(t=>t.oldValue===e))}},function(e,t,r){"use strict";var i=r(56);const n=i.a.queueMicrotask?i.a.queueMicrotask:e=>{i.a.Promise.resolve().then(e)},s=[];let a=[];function o(e){s.push(e),1===s.length&&n((()=>{for(const t of a)t();const e=s.slice();s.length=0;for(const t of e)t()}))}(o||(o={})).before=function(e){return a.push(e),{remove(){a=a.filter((t=>t!==e))}}};var l=o;t.a=l},function(e,t,r){"use strict";function i(e,t,r=!1){let{hasM:i,hasZ:n}=e;Array.isArray(t)?4!==t.length||i||n?3===t.length&&r&&!i?(n=!0,i=!1):3===t.length&&i&&n&&(i=!1,n=!1):(i=!0,n=!0):(n=!n&&t.hasZ&&(!i||t.hasM),i=!i&&t.hasM&&(!n||t.hasZ)),e.hasZ=n,e.hasM=i}r.d(t,"a",(function(){return i}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(54),n=r(57);const s={inches:Object(i.c)(1,"meters","inches"),feet:Object(i.c)(1,"meters","feet"),"us-feet":Object(i.c)(1,"meters","us-feet"),yards:Object(i.c)(1,"meters","yards"),miles:Object(i.c)(1,"meters","miles"),"nautical-miles":Object(i.c)(1,"meters","nautical-miles"),millimeters:Object(i.c)(1,"meters","millimeters"),centimeters:Object(i.c)(1,"meters","centimeters"),decimeters:Object(i.c)(1,"meters","decimeters"),meters:Object(i.c)(1,"meters","meters"),kilometers:Object(i.c)(1,"meters","kilometers"),"decimal-degrees":1/Object(i.l)(1,"meters",n.a.radius)}},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(322);let l=i=class extends o.a{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new i({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};Object(n.a)([Object(s.b)()],l.prototype,"image",void 0),l=i=Object(n.a)([Object(a.a)("esri.support.Action.ActionButton")],l);var c=l;t.a=c},function(e,t,r){"use strict";var i=r(0),n=r(114),s=(r(113),r(84)),a=r(11),o=r(68),l=r(371),c=r(159),u=r(7),d=r(12),h=r(25),p=r(1),f=(r(8),r(9),r(4)),b=r(50),m=r(39);let g=0;const y=u.a.getLogger("esri.layers.Layer");let v=class extends(o.a.EventedMixin(Object(l.a)(c.a))){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new b.a(-180,-90,180,90,m.a.WGS84),this.id=Date.now().toString(16)+"-layer-"+g++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=m.a.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t="string"==typeof e?{url:e}:e,i=await r.e(138).then(r.bind(null,689));try{return await i.fromUrl(t)}catch(n){throw y.error("#fromArcGISServerUrl({ url: '"+t.url+"'})","Failed to create layer from arcgis server url",n),n}}static async fromPortalItem(e){const t="portalItem"in e?e:{portalItem:e},i=await r.e(72).then(r.bind(null,687));try{return await i.fromItem(t)}catch(s){const e=t&&t.portalItem,r=e&&e.id||"unset",i=e&&e.portal&&e.portal.url||n.a.portalUrl;throw y.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+i+"', id: '"+r+"')",s),s}}initialize(){this.when().catch((e=>{var t,r;Object(d.n)(e)||u.a.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${null!=(t=this.title)?t:"no title"}', id: '${null!=(r=this.id)?r:"no id"}')`,{error:e})}))}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return null!=this.attributionDataUrl}get parsedUrl(){const e=this.url;return e?Object(h.K)(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Object(s.default)(e,{query:{f:"json"},responseType:"json"})).data;throw new a.a("layer:no-attribution-data","Layer does not have attribution data")}};Object(i.a)([Object(p.b)({type:String})],v.prototype,"attributionDataUrl",void 0),Object(i.a)([Object(p.b)({type:b.a})],v.prototype,"fullExtent",void 0),Object(i.a)([Object(p.b)({readOnly:!0})],v.prototype,"hasAttributionData",null),Object(i.a)([Object(p.b)({type:String})],v.prototype,"id",void 0),Object(i.a)([Object(p.b)({type:Boolean,nonNullable:!0})],v.prototype,"legendEnabled",void 0),Object(i.a)([Object(p.b)({type:["show","hide","hide-children"]})],v.prototype,"listMode",void 0),Object(i.a)([Object(p.b)({type:Number,range:{min:0,max:1},nonNullable:!0})],v.prototype,"opacity",void 0),Object(i.a)([Object(p.b)()],v.prototype,"parent",void 0),Object(i.a)([Object(p.b)({readOnly:!0})],v.prototype,"parsedUrl",null),Object(i.a)([Object(p.b)({type:Boolean})],v.prototype,"popupEnabled",void 0),Object(i.a)([Object(p.b)({type:Boolean})],v.prototype,"attributionVisible",void 0),Object(i.a)([Object(p.b)({type:m.a})],v.prototype,"spatialReference",void 0),Object(i.a)([Object(p.b)({type:String})],v.prototype,"title",void 0),Object(i.a)([Object(p.b)({type:String,readOnly:!0,json:{read:!1}})],v.prototype,"type",void 0),Object(i.a)([Object(p.b)()],v.prototype,"url",void 0),Object(i.a)([Object(p.b)({type:Boolean,nonNullable:!0})],v.prototype,"visible",void 0),v=Object(i.a)([Object(f.a)("esri.layers.Layer")],v);var O=v;t.a=O},function(e,t,r){"use strict";var i,n=r(0),s=r(44),a=r(14),o=r(1),l=(r(8),r(9)),c=(r(7),r(37)),u=r(32),d=r(4),h=r(237),p=r(375);const f=new s.a({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let b=i=class extends a.a{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let r;try{r=JSON.parse(t)}catch(i){}return r?r.value:null}readValueType(e,{description:t}){let r;try{r=JSON.parse(t)}catch(i){}return r?f.fromJSON(r.fieldValueType):null}clone(){return new i({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],b.prototype,"alias",void 0),Object(n.a)([Object(o.b)({type:[String,Number],json:{write:{allowNull:!0}}})],b.prototype,"defaultValue",void 0),Object(n.a)([Object(o.b)()],b.prototype,"description",void 0),Object(n.a)([Object(u.a)("description")],b.prototype,"readDescription",null),Object(n.a)([Object(o.b)({types:h.d,json:{read:{reader:h.b},write:!0}})],b.prototype,"domain",void 0),Object(n.a)([Object(o.b)({type:Boolean,json:{write:!0}})],b.prototype,"editable",void 0),Object(n.a)([Object(o.b)({type:l.a,json:{write:!0}})],b.prototype,"length",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],b.prototype,"name",void 0),Object(n.a)([Object(o.b)({type:Boolean,json:{write:!0}})],b.prototype,"nullable",void 0),Object(n.a)([Object(c.a)(p.a)],b.prototype,"type",void 0),Object(n.a)([Object(o.b)()],b.prototype,"valueType",void 0),Object(n.a)([Object(u.a)("valueType",["description"])],b.prototype,"readValueType",null),b=i=Object(n.a)([Object(d.a)("esri.layers.support.Field")],b);var m=b;t.a=m},function(e,t,r){"use strict";var i=r(0),n=r(38),s=r(14),a=r(13),o=r(7),l=r(12),c=r(1),u=r(45),d=(r(8),r(32)),h=r(4),p=r(29),f=r(9),b=r(89),m=r(275),g=r(170),y=r(419),v=r(252),O=r(291),j=r(250);const _={base:null,key:"type",typeMap:{attachment:m.a,media:O.a,text:j.a,field:v.a}};var w,x=r(479),S=r(276);let T=w=class extends s.a{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new w({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};Object(i.a)([Object(c.b)({type:Boolean,json:{write:!0}})],T.prototype,"returnTopmostRaster",void 0),Object(i.a)([Object(c.b)({type:Boolean,json:{write:!0}})],T.prototype,"showNoDataRecords",void 0),T=w=Object(i.a)([Object(h.a)("esri.popup.LayerOptions")],T);var C,M=T,P=r(509);let A=C=class extends s.a{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new C({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Object(a.a)(this.orderByFields):null})}};Object(i.a)([Object(c.b)({type:Boolean,json:{write:!0}})],A.prototype,"showRelatedRecords",void 0),Object(i.a)([Object(c.b)({type:[P.a],json:{write:!0}})],A.prototype,"orderByFields",void 0),A=C=Object(i.a)([Object(h.a)("esri.popup.RelatedRecordsInfo")],A);var E,R=A,I=r(508),D=r(322),F=r(302),L=r(510);const k=n.a.ofType({key:"type",defaultKeyValue:"button",base:D.a,typeMap:{button:F.a,toggle:L.a}}),z={base:g.a,key:"type",typeMap:{media:O.a,custom:y.a,text:j.a,attachments:m.a,fields:v.a}},V="esri.PopupTemplate",N=o.a.getLogger(V),U=["attachments","fields","media","text"];let B=E=class extends s.a{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map((e=>Object(f.k)(z,e))):"string"==typeof e||"function"==typeof e||e instanceof HTMLElement||Object(l.q)(e)?e:(N.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:r}=t;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,r,i){"string"!=typeof e?Array.isArray(e)&&(t.popupElements=e.filter((e=>-1!==U.indexOf(e.type))).map((e=>e&&e.toJSON(i))),t.popupElements.forEach((e=>{"attachments"===e.type?this._writeAttachmentContent(t):"media"===e.type?this._writeMediaContent(e,t):"text"===e.type&&this._writeTextContent(e,t)}))):t.description=e}writeFieldInfos(e,t,r,i){const{content:n}=this,s=Array.isArray(n)?n:null;if(e){const r=s?s.filter((e=>"fields"===e.type)):[],n=r.length&&r.every((e=>{var t;return null==(t=e.fieldInfos)?void 0:t.length}));t.fieldInfos=e.filter(Boolean).map((e=>{const t=e.toJSON(i);return n&&(t.visible=!1),t}))}if(s)for(const a of s)"fields"===a.type&&this._writeFieldsContent(a,t)}writeLayerOptions(e,t,r,i){t[r]=!e||null===e.showNoDataRecords&&null===e.returnTopmostRaster?null:e.toJSON(i)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?Object(a.a)(e.toArray()):[];return new E({actions:t,content:Array.isArray(this.content)?Object(a.a)(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?Object(a.a)(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?Object(a.a)(this.fieldInfos):null,layerOptions:this.layerOptions?Object(a.a)(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?Object(a.a)(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?Object(a.a)(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){await this._collectExpressionInfoFields(e,t,this.expressionInfos),Object(b.e)(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=Object(a.a)(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach((e=>{const r=t.fieldInfos.find((t=>t.fieldName.toLowerCase()===e.fieldName.toLowerCase()));r?r.visible=!0:t.fieldInfos.push(e)})):t.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=Object(a.a)(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...r]:t.mediaInfos=r}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:r}){const i={description:!1,mediaInfos:!1};return r.map((r=>"media"===r.type?(r.mediaInfos||!t||i.mediaInfos||(r.mediaInfos=t,i.mediaInfos=!0),O.a.fromJSON(r)):"text"===r.type?(r.text||!e||i.description||(r.text=e,i.description=!0),j.a.fromJSON(r)):"attachments"===r.type?m.a.fromJSON(r):"fields"===r.type?v.a.fromJSON(r):void 0)).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:r}){const i=[];return e?i.push(new j.a({text:e})):i.push(new v.a),Array.isArray(t)&&t.length&&i.push(O.a.fromJSON({mediaInfos:t})),r&&i.push(m.a.fromJSON({displayType:"list"})),i.length?i:e}_getContentElementFields(e){return e&&"attachments"!==e.type?"custom"===e.type?e.outFields||[]:"fields"===e.type?this._getFieldInfoFields(e.fieldInfos||this.fieldInfos):"media"===e.type?(e.mediaInfos||[]).reduce(((e,t)=>[...e,...this._getMediaInfoFields(t)]),[]):"text"===e.type?this._extractFieldNames(e.text):void 0:[]}_getMediaInfoFields(e){const{caption:t,title:r,value:i}=e,n=i||{},{fields:s=[],normalizeField:a,tooltipField:o,sourceURL:l,linkURL:c}=n,u=[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...s];return a&&u.push(a),o&&u.push(o),u}_getContentFields(e){return"string"==typeof e?this._extractFieldNames(e):Array.isArray(e)?e.reduce(((e,t)=>[...e,...this._getContentElementFields(t)]),[]):[]}async _collectExpressionInfoFields(e,t,r){r&&await Promise.all(r.map((r=>Object(b.a)(e,t,r.expression))))}_getFieldInfoFields(e){return e?e.filter((e=>void 0===e.visible||!!e.visible)).map((e=>e.fieldName)).filter((e=>-1===e.indexOf("relationships/")&&-1===e.indexOf("expression/"))):[]}_getActionsFields(e){return e?e.toArray().reduce(((e,t)=>[...e,...this._getActionFields(t)]),[]):[]}_getActionFields(e){const{className:t,title:r,type:i}=e,n="button"===i||"toggle"===i?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(n)]}_getTitleFields(e){return"string"==typeof e?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||"string"!=typeof e)return[];const t=e.match(/{[^}]*}/g);if(!t)return[];const r=/\{(\w+):.+\}/,i=t.filter((e=>!(0===e.indexOf("{relationships/")||0===e.indexOf("{expression/")))).map((e=>e.replace(r,"{$1}")));return i?i.map((e=>e.slice(1,-1))):[]}};Object(i.a)([Object(c.b)({type:k})],B.prototype,"actions",void 0),Object(i.a)([Object(c.b)()],B.prototype,"content",void 0),Object(i.a)([Object(u.a)("content")],B.prototype,"castContent",null),Object(i.a)([Object(d.a)("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],B.prototype,"readContent",null),Object(i.a)([Object(p.a)("content",{popupElements:{type:n.a.ofType(_)},showAttachments:{type:Boolean},mediaInfos:{type:n.a.ofType(I.a)},description:{type:String}})],B.prototype,"writeContent",null),Object(i.a)([Object(c.b)({type:[x.a],json:{write:!0}})],B.prototype,"expressionInfos",void 0),Object(i.a)([Object(c.b)({type:[S.a]})],B.prototype,"fieldInfos",void 0),Object(i.a)([Object(p.a)("fieldInfos")],B.prototype,"writeFieldInfos",null),Object(i.a)([Object(c.b)({type:M})],B.prototype,"layerOptions",void 0),Object(i.a)([Object(p.a)("layerOptions")],B.prototype,"writeLayerOptions",null),Object(i.a)([Object(c.b)({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],B.prototype,"lastEditInfoEnabled",void 0),Object(i.a)([Object(c.b)()],B.prototype,"outFields",void 0),Object(i.a)([Object(c.b)()],B.prototype,"overwriteActions",void 0),Object(i.a)([Object(c.b)()],B.prototype,"returnGeometry",void 0),Object(i.a)([Object(c.b)({json:{type:String}})],B.prototype,"title",void 0),Object(i.a)([Object(p.a)("title")],B.prototype,"writeTitle",null),Object(i.a)([Object(c.b)({type:R,json:{write:!0}})],B.prototype,"relatedRecordsInfo",void 0),B=E=Object(i.a)([Object(h.a)(V)],B);var G=B;t.a=G},function(e,t,r){"use strict";r.r(t);var i=r(0),n=r(79),s=r(11),a=r(14),o=r(13),l=r(159),c=r(2),u=r(25),d=r(1),h=r(9),p=(r(8),r(7)),f=r(32),b=r(4),m=r(50),g=r(118),y=r(19),v=r(45);const O=p.a.getLogger("esri.portal.PortalItemResource");let j=class extends y.a{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this.normalizePath(e.path,e.portalItem)}:e}set path(e){Object(c.j)(e)&&Object(u.s)(e)?O.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this.normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.url;if(Object(c.i)(r))throw new s.a("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:Object(c.h)(t,"signal")})}async update(e,t){return(await Promise.resolve().then(r.bind(null,668))).addOrUpdateResource(this,"update",e,t)}hasPath(){return Object(c.j)(this.path)}normalizePath(e,t){return Object(c.i)(e)?e:(e=e.replace(/^\/+/,""),Object(c.j)(t)&&Object(u.s)(e)&&(e=Object(u.C)(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};Object(i.a)([Object(d.b)()],j.prototype,"portalItem",void 0),Object(i.a)([Object(d.b)({type:String,value:null})],j.prototype,"path",null),Object(i.a)([Object(v.a)("path")],j.prototype,"_castPath",null),Object(i.a)([Object(d.b)({type:String,readOnly:!0})],j.prototype,"url",null),Object(i.a)([Object(d.b)({type:String,readOnly:!0})],j.prototype,"itemRelativeUrl",null),j=Object(i.a)([Object(b.a)("esri.portal.PortalItemResource")],j);var _=j;let w=class extends y.a{constructor(e){super(e),this.created=null,this.rating=null}};Object(i.a)([Object(d.b)()],w.prototype,"created",void 0),Object(i.a)([Object(d.b)()],w.prototype,"rating",void 0),w=Object(i.a)([Object(b.a)("esri.portal.PortalRating")],w);var x,S=w;let T=x=class extends(Object(a.b)(l.a)){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return Object(h.d)(x,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return"Feature Service"===e||"Feature Collection"===e?r=t.indexOf("Table")>-1?"Table":t.indexOf("Route Layer")>-1?"Route Layer":t.indexOf("Markup")>-1?"Markup":"Feature Layer":"Image Service"===e?r=t.indexOf("Elevation 3D Layer")>-1?"Elevation Layer":t.indexOf("Tiled Imagery")>-1?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?r="Scene Layer":"Scene Package"===e?r="Scene Layer Package":"Stream Service"===e?r="Feature Layer":"Geoprocessing Service"===e&&this.portal&&this.portal.isPortal?r=t.indexOf("Web Tool")>-1?"Tool":"Geoprocessing Service":"Geocoding Service"===e?r="Locator":"Geoenrichment Service"===e?r="GeoEnrichment Service":"Microsoft Powerpoint"===e?r="Microsoft PowerPoint":"GeoJson"===e?r="GeoJSON":"Globe Service"===e?r="Globe Layer":"Vector Tile Service"===e?r="Tile Layer":"netCDF"===e?r="NetCDF":"Map Service"===e?r=-1===t.indexOf("Spatiotemporal")&&(t.indexOf("Hosted Service")>-1||t.indexOf("Tiled")>-1)&&-1===t.indexOf("Relational")?"Tile Layer":"Map Image Layer":e&&e.toLowerCase().indexOf("add in")>-1?r=e.replace(/(add in)/gi,"Add-In"):"datastore catalog service"===e?r="Big Data File Share":"Compact Tile Package"===e?r="Tile Package (tpkx)":"OGCFeatureServer"===e&&(r="OGC Feature Layer"),r}readExtent(e){return e&&e.length?new m.a(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[];let r,i=!1,s=!1,a=!1,o=!1,l=!1,c=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(i=t.indexOf("Hosted Service")>-1,"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(s=t.indexOf("Table")>-1,a=t.indexOf("Route Layer")>-1,o=t.indexOf("Markup")>-1,l=-1!==t.indexOf("Spatiotemporal"),c=-1!==t.indexOf("UtilityNetwork"),r=l&&s?"spatiotemporaltable":s?"table":a?"routelayer":o?"markup":l?"spatiotemporal":i?"featureshosted":c?"utilitynetwork":"features"):r="map service"===e||"wms"===e||"wmts"===e?i||t.indexOf("Tiled")>-1||"wmts"===e?"maptiles":"mapimages":"scene service"===e?t.indexOf("Line")>-1?"sceneweblayerline":t.indexOf("3DObject")>-1?"sceneweblayermultipatch":t.indexOf("Point")>-1?"sceneweblayerpoint":t.indexOf("IntegratedMesh")>-1?"sceneweblayermesh":t.indexOf("PointCloud")>-1?"sceneweblayerpointcloud":t.indexOf("Polygon")>-1?"sceneweblayerpolygon":t.indexOf("Building")>-1?"sceneweblayerbuilding":t.indexOf("Voxel")>-1?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.indexOf("Elevation 3D Layer")>-1?"elevationlayer":t.indexOf("Tiled Imagery")>-1?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"geoprocessing service"===e&&t.indexOf("Web Tool")>-1&&this.portal&&this.portal.isPortal?"tool":"layers"):r="web map"===e||"cityengine web scene"===e?"maps":"web scene"===e?t.indexOf("ViewingMode-Local")>-1?"webscenelocal":"websceneglobal":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?"apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.indexOf("ArcGIS Pro")>-1||"explorer map"===e&&t.indexOf("Explorer Document")?"mapsgray":"service definition"===e||"csv"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"360 vr experience"===e||"netcdf"===e||"administrative report"===e?"datafiles":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?"appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?"addindesktop":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"form"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"image"===e||"workflow manager package"===e||"explorer map"===e&&t.indexOf("Explorer Mapping Application")>-1||t.indexOf("Document")>-1?"datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?"toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?"layersgray":"scene package"===e?"scenepackage":"mobile scene package"===e?"mobilescenepackage":"tile package"===e||"compact tile package"===e?"tilepackage":"task file"===e?"taskfile":"report template"===e?"report-template":"statistical data collection"===e?"statisticaldatacollection":"insights workbook"===e?"workbook":"insights model"===e?"insightsmodel":"insights page"===e?"insightspage":"insights theme"===e?"insightstheme":"hub initiative"===e?"hubinitiative":"hubpage"===e?"hubpage":"hub event"===e?"hubevent":"hub site application"===e?"hubsite":"relational database connection"===e?"relationaldatabaseconnection":"big data file share"===e?"datastorecollection":"image collection"===e?"imagecollection":"style"===e?"style":"desktop style"===e?"desktopstyle":"dashboard"===e?"dashboard":"raster function template"===e?"rasterprocessingtemplate":"vector tile package"===e?"vectortilepackage":"ortho mapping project"===e?"orthomappingproject":"ortho mapping template"===e?"orthomappingtemplate":"solution"===e?"solutions":"geopackage"===e?"geopackage":"deep learning package"===e?"deeplearningpackage":"real time analytic"===e?"realtimeanalytics":"big data analytic"===e?"bigdataanalytics":"feed"===e?"feed":"excalibur imagery project"===e?"excaliburimageryproject":"notebook"===e?"notebook":"storymap"===e?"storymap":"survey123 add in"===e?"survey123addin":"mission"===e?"mission":"mission report"===e?"missionreport":"quickcapture project"===e?"quickcaptureproject":"pro report"===e?"proreport":"urban model"===e?"urbanmodel":"web experience"===e?"experiencebuilder":"web experience template"===e?"webexperiencetemplate":"workflow"===e?"workflow":"insights script"===e?"insightsscript":"kernel gateway connection"===e?"kernelgatewayconnection":"hub initiative template"===e?"hubinitiativetemplate":"storymap theme"===e?"storymaptheme":"knowledge graph"===e?"knowledgegraph":"native application"===e?"nativeapp":"native application installer"===e?"nativeappinstaller":"link chart"===e?"linkchart":"investigation"===e?"investigation":"ogcfeatureserver"===e?"features":"pro project"===e?"proproject":"insights workbook package"===e?"insightsworkbookpackage":"maps",r?Object(n.b)("esri/images/portal/"+r+"16.png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].indexOf(this.type)>-1}get itemUrl(){const e=this.get("portal.restUrl");return e?e+"/content/items/"+this.id:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=g.a.getDefault());const t=this.portal.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:Object(c.j)(e)?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof S&&(e=e.rating),isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then((()=>new S({rating:e,created:new Date})))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:Object(o.a)(this.applicationProxies),avgRating:this.avgRating,categories:Object(o.a)(this.categories),created:Object(o.a)(this.created),culture:this.culture,description:this.description,extent:Object(o.a)(this.extent),groupCategories:Object(o.a)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Object(o.a)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Object(o.a)(this.screenshots),size:this.size,snippet:this.snippet,tags:Object(o.a)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Object(o.a)(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new x({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then((()=>{}))}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e}).then((e=>null!=e.rating?(e.created=new Date(e.created),new S(e)):null))}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},x)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal._signIn())).then((()=>{const t=e&&e.data,r={method:"post"};r.query=this.createPostQuery();for(const e in r.query)null===r.query[e]&&(r.query[e]="");return r.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?r.query.text=t:"object"==typeof t&&(r.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,r).then((()=>this.reload()))})):Promise.reject(new s.a("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then((()=>this.portal._signIn())).then((()=>{const t=e.thumbnail,r=e.filename,i={method:"post"};if("string"==typeof t)Object(u.u)(t)?i.query={data:t}:i.query={url:Object(u.A)(t)},Object(c.j)(r)&&(i.query.filename=r);else{const e=new FormData;Object(c.j)(r)?e.append("file",t,r):e.append("file",t),i.body=e}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,i).then((()=>this.reload()))})):Promise.reject(new s.a("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await Promise.resolve().then(r.bind(null,668))).fetchResources(this,e,t)}async addResource(e,t,i){const n=await Promise.resolve().then(r.bind(null,668));return e.portalItem=this,n.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await Promise.resolve().then(r.bind(null,668));if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new s.a("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await Promise.resolve().then(r.bind(null,668))).removeAllResources(this,e)}resourceFromPath(e){return new _({portalItem:this,path:e})}toJSON(){const e=this.extent,t={created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,tags:this.tags,thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:this.typeKeywords,url:this.url};return Object(o.c)(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new x({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};Object(i.a)([Object(d.b)({type:["private","shared","org","public"]})],T.prototype,"access",void 0),Object(i.a)([Object(d.b)()],T.prototype,"accessInformation",void 0),Object(i.a)([Object(d.b)({type:String})],T.prototype,"apiKey",void 0),Object(i.a)([Object(d.b)({json:{read:{source:"appProxies"}}})],T.prototype,"applicationProxies",void 0),Object(i.a)([Object(d.b)()],T.prototype,"avgRating",void 0),Object(i.a)([Object(d.b)()],T.prototype,"categories",void 0),Object(i.a)([Object(d.b)({type:Date})],T.prototype,"created",void 0),Object(i.a)([Object(d.b)()],T.prototype,"culture",void 0),Object(i.a)([Object(d.b)()],T.prototype,"description",void 0),Object(i.a)([Object(d.b)({readOnly:!0})],T.prototype,"displayName",null),Object(i.a)([Object(d.b)({type:m.a})],T.prototype,"extent",void 0),Object(i.a)([Object(f.a)("extent")],T.prototype,"readExtent",null),Object(i.a)([Object(d.b)()],T.prototype,"groupCategories",void 0),Object(i.a)([Object(d.b)({readOnly:!0})],T.prototype,"iconUrl",null),Object(i.a)([Object(d.b)()],T.prototype,"id",void 0),Object(i.a)([Object(d.b)({readOnly:!0})],T.prototype,"isLayer",null),Object(i.a)([Object(d.b)()],T.prototype,"itemControl",void 0),Object(i.a)([Object(d.b)({readOnly:!0})],T.prototype,"itemUrl",null),Object(i.a)([Object(d.b)()],T.prototype,"licenseInfo",void 0),Object(i.a)([Object(d.b)({type:Date})],T.prototype,"modified",void 0),Object(i.a)([Object(d.b)()],T.prototype,"name",void 0),Object(i.a)([Object(d.b)()],T.prototype,"numComments",void 0),Object(i.a)([Object(d.b)()],T.prototype,"numRatings",void 0),Object(i.a)([Object(d.b)()],T.prototype,"numViews",void 0),Object(i.a)([Object(d.b)()],T.prototype,"owner",void 0),Object(i.a)([Object(d.b)()],T.prototype,"ownerFolder",void 0),Object(i.a)([Object(d.b)({type:g.a})],T.prototype,"portal",void 0),Object(i.a)([Object(d.b)()],T.prototype,"screenshots",void 0),Object(i.a)([Object(d.b)()],T.prototype,"size",void 0),Object(i.a)([Object(d.b)()],T.prototype,"snippet",void 0),Object(i.a)([Object(d.b)()],T.prototype,"sourceJSON",void 0),Object(i.a)([Object(d.b)()],T.prototype,"tags",void 0),Object(i.a)([Object(d.b)()],T.prototype,"thumbnail",void 0),Object(i.a)([Object(d.b)({readOnly:!0})],T.prototype,"thumbnailUrl",null),Object(i.a)([Object(d.b)()],T.prototype,"title",void 0),Object(i.a)([Object(d.b)()],T.prototype,"type",void 0),Object(i.a)([Object(d.b)()],T.prototype,"typeKeywords",void 0),Object(i.a)([Object(d.b)()],T.prototype,"url",void 0),Object(i.a)([Object(d.b)({readOnly:!0})],T.prototype,"userItemUrl",null),T=x=Object(i.a)([Object(b.a)("esri.portal.PortalItem")],T);var C=T;t.default=C},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return a})),r.d(t,"f",(function(){return l})),r.d(t,"g",(function(){return c})),r.d(t,"h",(function(){return d})),r.d(t,"i",(function(){return u}));const i=[252,146,31,255],n=[153,153,153,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:i,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},a={type:"esriSLS",style:"esriSLSSolid",width:.75,color:i},o={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},c={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},d={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add("ssaoTex","sampler2D"),r.uniforms.add("viewportPixelSz","vec4"),r.code.add(i.a`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
}`)):r.code.add(i.a`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(17),o=r(1),l=(r(9),r(8),r(7),r(37)),c=r(32),u=r(4),d=r(390),h=r(400);let p=i=class extends d.a{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e&&null==e.imageData)return e;const i={};return e&&(i.url=e),null!=t&&(i.width=Object(a.j)(t)),null!=r&&(i.height=Object(a.j)(r)),i}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new i({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",Object(s.a)(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};Object(n.a)([Object(o.b)({json:{write:!1}})],p.prototype,"color",void 0),Object(n.a)([Object(l.a)({esriPMS:"picture-marker"},{readOnly:!0})],p.prototype,"type",void 0),Object(n.a)([Object(o.b)(h.b)],p.prototype,"url",void 0),Object(n.a)([Object(o.b)(h.a)],p.prototype,"source",void 0),Object(n.a)([Object(o.b)({type:Number,cast:a.j,json:{write:!0}})],p.prototype,"height",void 0),Object(n.a)([Object(c.a)("height",["height","size"])],p.prototype,"readHeight",null),Object(n.a)([Object(o.b)({type:Number,cast:a.j,json:{write:!0}})],p.prototype,"width",void 0),Object(n.a)([Object(o.b)({json:{write:!1}})],p.prototype,"size",void 0),p=i=Object(n.a)([Object(u.a)("esri.symbols.PictureMarkerSymbol")],p);var f=p;t.a=f},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r(315),n=r(6);function s(e,t){const r=e;r.include(i.a),r.attributes.add("position","vec3"),r.attributes.add("normal","vec3"),r.attributes.add("auxpos1","vec4"),r.vertex.uniforms.add("proj","mat4"),r.vertex.uniforms.add("view","mat4"),r.vertex.uniforms.add("viewNormal","mat4"),r.vertex.uniforms.add("viewport","vec4"),r.vertex.uniforms.add("camPos","vec3"),r.vertex.uniforms.add("polygonOffset","float"),r.vertex.uniforms.add("cameraGroundRelative","float"),r.vertex.uniforms.add("pixelRatio","float"),r.vertex.uniforms.add("perDistancePixelRatio","float"),r.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&r.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&r.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),r.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),r.vertex.constants.add("smallOffsetAngle","float",.984807753012208),r.vertex.code.add(n.a`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.vertex.code.add(n.a`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped||r.vertex.code.add(n.a`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`),r.vertex.code.add(n.a`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?n.a`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?n.a`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.vertex.code.add(n.a`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (uRenderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function a(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.attributes.add("position","vec3"),e.vertex.code.add(i.a`vec3 positionModel() { return position; }`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(6);function n(e){const t=e.fragment.code;t.add(i.a`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(i.a`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(i.a`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var s=r(391);function a(e,t){const r=e.fragment.code;e.include(s.a),3===t.pbrMode||4===t.pbrMode?(r.add(i.a`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),r.add(i.a`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(i.a`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(i.a`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(i.a`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):1!==t.pbrMode&&2!==t.pbrMode||(e.include(n),r.add(i.a`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(i.a`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(i.a`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),r.add(i.a`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(i.a`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(i.a`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(6);function n(e){const t=i.a`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function s(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(i.a`vec3 normalModel() {
return normal;
}`)),1===t.normalType&&(e.include(n),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(i.a`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(i.a`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n}));var i=r(8);const n=()=>!!Object(i.a)("enable-feature:force-wosr"),s=()=>!!Object(i.a)("enable-feature:disable-context-navigation"),a=()=>!!Object(i.a)("enable-feature:direct-3d-object-feature-layer-display")},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r(6),n=r(88);function s(e){e.vertex.code.add(i.a`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(i.a`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(i.a`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(i.a`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(i.a`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(i.a`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
}`),e.vertex.code.add(i.a`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function a(e,t){if(t.screenSizePerspective){Object(n.a)(t.screenSizePerspective,e,"screenSizePerspective");const r=t.screenSizePerspectiveAlignment||t.screenSizePerspective;Object(n.a)(r,e,"screenSizePerspectiveAlignment")}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r(107),n=r(6);function s(e){e.include(i.a),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(n.a`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}function a(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(167),n=r(6);function s(e){e.include(i.a),e.code.add(n.a`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${n.a.int(1)}) {
        return allMixed;
      }
      else if (mode == ${n.a.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${n.a.int(3)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${n.a.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${n.a.int(3)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i,n=r(216),s=r(6);function a(e,t){const r=e.vertex;r.uniforms.add("uDistanceFalloffFactor","float"),r.code.add(s.a`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add("uComponentDataTex","sampler2D"),r.uniforms.add("uComponentDataTexInvDim","vec2"),e.attributes.add("componentIndex","float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentFieldCount","float",2),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("componentTexWidth","float",4096),r.code.add(s.a`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * uComponentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec4 colorValue = texture2D(uComponentDataTex, colorIndex);
vec4 otherValue = texture2D(uComponentDataTex, otherIndex);
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5
);
}`),t.legacy?r.code.add(s.a`vec3 _modelToWorldNormal(vec3 normal) {
return (uModel * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (uView * uModel * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),r.code.add(s.a`vec3 _modelToWorldNormal(vec3 normal) {
return uTransformNormal_GlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add("normalA","vec3"),e.attributes.add("normalB","vec3"),r.code.add(s.a`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add("normal","vec3"),r.code.add(s.a`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?r.code.add(s.a`vec3 worldFromModelPosition(vec3 position) {
return (uModel * vec4(position, 1.0)).xyz;
}
vec3 viewFromModelPosition(vec3 position) {
return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;
}
vec4 projFromViewPosition(vec3 position) {
return uProj * vec4(position, 1.0);
}`):(e.vertex.include(n.a,t),r.code.add(s.a`vec3 worldFromModelPosition(vec3 position) {
vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
uTransform_WorldFromModel_TL,
uTransform_WorldFromModel_TH,
-uTransform_WorldFromView_TL,
-uTransform_WorldFromView_TH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 viewFromModelPosition(vec3 position) {
return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);
}
vec4 projFromViewPosition(vec3 position) {
return uTransform_ProjFromView * vec4(position, 1.0);
}`)),r.code.add(s.a`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}(i=a||(a={})).usesSketchLogic=function(e){return 1===e.mode||2===e.mode},i.usesSolidLogic=function(e){return 0===e.mode||2===e.mode}},function(e,t,r){"use strict";var i=r(56);var n,s=(n=i.a,{setTimeout:(e,t)=>{const r=n.setTimeout(e,t);return{remove:()=>n.clearTimeout(r)}}});t.a=s},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return d}));var i=r(189),n=r(101),s=r(287);function a(e,t,r){if(!e||!e.read||!1===e.read.enabled||!e.read.source)return!1;const n=e.read.source;if("string"==typeof n){if(n===t)return!0;if(n.indexOf(".")>-1&&0===n.indexOf(t)&&Object(i.a)(n,r))return!0}else for(const s of n){if(s===t)return!0;if(s.indexOf(".")>-1&&0===s.indexOf(t)&&Object(i.a)(s,r))return!0}return!1}function o(e,t,r,i,n){let o=Object(s.c)(t[r],n);(function(e){return e&&(!e.read||!1!==e.read.enabled&&!e.read.source)})(o)&&(e[r]=!0);for(const l of Object.getOwnPropertyNames(t))o=Object(s.c)(t[l],n),a(o,r,i)&&(e[l]=!0)}function l(e,t,r,i){const n=r.metadatas,a=Object(s.b)(n[t],"any",i),o=a&&a.default;if(void 0===o)return;const l="function"==typeof o?o.call(e,t,i):o;void 0!==l&&r.set(t,l)}const c={origin:"service"};function u(e,t,r=c){if(!t||"object"!=typeof t)return;const a=Object(n.a)(e),u=a.metadatas,d={};for(const i of Object.getOwnPropertyNames(t))o(d,u,i,t,r);a.setDefaultOrigin(r.origin);for(const n of Object.getOwnPropertyNames(d)){const o=Object(s.c)(u[n],r).read,l=o&&o.source;let c;c=l&&"string"==typeof l?Object(i.c)(t,l):t[n],o&&o.reader&&(c=o.reader.call(e,c,t,r)),void 0!==c&&a.set(n,c)}if(!r||!r.ignoreDefaults)for(const i of Object.getOwnPropertyNames(u))d[i]||l(e,i,a,r);a.setDefaultOrigin("user")}function d(e,t,r,i=c){var n;const s={...i,messages:[]};r(s),null==(n=s.messages)||n.forEach((t=>{"warning"!==t.type||e.loaded?i&&i.messages&&i.messages.push(t):e.loadWarnings.push(t)}))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(44);const n=Object(i.b)()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"})},function(e,t,r){"use strict";var i,n=r(0),s=r(19),a=r(371),o=r(1),l=(r(8),r(9),r(7),r(4));let c=i=class extends(Object(a.a)(s.a)){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new i({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};Object(n.a)([Object(o.b)()],c.prototype,"active",void 0),Object(n.a)([Object(o.b)()],c.prototype,"className",void 0),Object(n.a)([Object(o.b)()],c.prototype,"disabled",void 0),Object(n.a)([Object(o.b)()],c.prototype,"id",void 0),Object(n.a)([Object(o.b)()],c.prototype,"indicator",void 0),Object(n.a)([Object(o.b)()],c.prototype,"title",void 0),Object(n.a)([Object(o.b)()],c.prototype,"type",void 0),Object(n.a)([Object(o.b)()],c.prototype,"visible",void 0),c=i=Object(n.a)([Object(l.a)("esri.support.actions.ActionBase")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(17),o=r(1),l=(r(8),r(45)),c=(r(7),r(4));let u=i=class extends s.a{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return Object(a.j)(e)}clone(){return new i({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};Object(n.a)([Object(o.b)({type:["underline","line-through","none"],json:{default:"none",write:!0}})],u.prototype,"decoration",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],u.prototype,"family",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],u.prototype,"size",void 0),Object(n.a)([Object(l.a)("size")],u.prototype,"castSize",null),Object(n.a)([Object(o.b)({type:["normal","italic","oblique"],json:{default:"normal",write:!0}})],u.prototype,"style",void 0),Object(n.a)([Object(o.b)({type:["normal","bold","bolder","lighter"],json:{default:"normal",write:!0}})],u.prototype,"weight",void 0),u=i=Object(n.a)([Object(c.a)("esri.symbols.Font")],u);var d=u;t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(11);class n{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",r=this._context&&this._context+" ";throw new i.a(t+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new n(this.major,this.minor,this._context)}static parse(e,t=""){const[r,s]=e.split("."),a=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(a))throw new i.a((t&&t+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!s.match(a))throw new i.a((t&&t+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),l=parseInt(s,10);return new n(o,l,t)}}},function(e,t,r){"use strict";function i(e){const t={};for(const r in e){if("declaredClass"===r)continue;const n=e[r];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){t[r]=[];for(let e=0;e<n.length;e++)t[r][e]=i(n[e])}else"object"==typeof n?n.toJSON&&(t[r]=JSON.stringify(n)):t[r]=n}return t}r.d(t,"a",(function(){return i}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o}));var i=r(107),n=r(6);function s(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(n.a`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)}function a(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(i.a),e.include(s),e.fragment.code.add(n.a`
  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function o(e,t){var r,i;t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),i=t,(r=e).bindTexture(i.lastFrameColorTexture,"lastFrameColorMap"),r.setUniformMatrix4fv("reprojectionMat",i.reprojectionMat),r.setUniformMatrix4fv("rpProjectionMat",i.camera.projectionMatrix))}},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(393),l=r(14),c=r(13),u=r(504);let d=i=class extends l.a{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new i({fields:Object(c.a)(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};Object(n.a)([Object(s.b)({type:[String],json:{write:!0}})],d.prototype,"fields",void 0),Object(n.a)([Object(s.b)({type:String,json:{write:!0}})],d.prototype,"normalizeField",void 0),Object(n.a)([Object(s.b)({type:[u.a],json:{read:!1}})],d.prototype,"series",void 0),Object(n.a)([Object(s.b)({type:String,json:{write:!0}})],d.prototype,"tooltipField",void 0),d=i=Object(n.a)([Object(a.a)("esri.popup.content.support.ChartMediaInfoValue")],d);var h=d;let p=class extends o.a{constructor(e){super(e),this.type=null,this.value=null}};Object(n.a)([Object(s.b)({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],p.prototype,"type",void 0),Object(n.a)([Object(s.b)({type:h,json:{write:!0}})],p.prototype,"value",void 0),p=Object(n.a)([Object(a.a)("esri.popup.content.mixins.ChartMediaInfo")],p);var f=p;t.a=f},function(e,t,r){"use strict";r.r(t);var i,n=r(0),s=r(38),a=r(153),o=r(14),l=r(13),c=r(159),u=r(372),d=r(7),h=r(2),p=r(12),f=r(25),b=r(1),m=(r(9),r(8),r(4)),g=r(29),y=r(39),v=r(118),O=r(306),j=r(336),_=r(553);let w=0;const x=d.a.getLogger("esri.Basemap");let S=i=class extends(Object(o.b)(c.a)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+w++,this.baseLayers=new s.a,this.referenceLayers=new s.a;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&x.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=e=>{e.parent=null};this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>r(e.item))),this.referenceLayers.on("after-remove",(e=>r(e.item)))}initialize(){this.when().catch((e=>{x.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var e;const t=this.baseLayers.removeAll();for(const i of t)i.destroy();const r=this.referenceLayers.removeAll();for(const i of r)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),null==(e=this.portalItem)||e.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Object(a.b)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const i=[];e?(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=Object(_.a)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);Object(h.j)(t)&&i.push(t)})),this.referenceLayers.forEach((e=>{const t=Object(_.a)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);Object(h.j)(t)&&(t.isReference=!0,i.push(t))})),t.baseMapLayers=i):t.baseMapLayers=i}set referenceLayers(e){this._set("referenceLayers",Object(a.b)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Object(u.a)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new i({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=Object(l.a)(e);return t.url&&Object(f.w)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&Object(f.w)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r}=this;Object(p.x)(e);const i=[];if(t){const r=t.context?t.context.url:null;if(i.push(this._loadLayersFromJSON(t.data,r,e)),t.data.id&&!t.data.title){const e=t.data.id;i.push(Object(j.b)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else r&&i.push(this._loadFromItem(r,e));await Promise.all(i)}async _loadLayersFromJSON(e,t,i){const n=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||n&&n.portal||null,a=n&&"web-scene"===n.origin?"web-scene":"web-map",{populateOperationalLayers:o}=await r.e(11).then(r.bind(null,695)),l=[];if(Object(p.x)(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const r={context:{origin:a,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},i=o(this.baseLayers,e.baseMapLayers.filter((e=>!e.isReference)),r);l.push(i);const n=o(this.referenceLayers,e.baseMapLayers.filter((e=>e.isReference)),r);l.push(n)}await Object(p.k)(l)}async _loadFromItem(e,t){const r=await e.load(t),i=await r.fetchData("json",t),n=Object(f.K)(e.itemUrl);return this._set("resourceInfo",{data:i.baseMap,context:{origin:"web-map",portal:e.portal||v.a.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||v.a.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,t)}static fromId(e){const t=j.a[e];return t?i.fromJSON(t):null}};Object(n.a)([Object(b.b)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,i){this._writeBaseLayers(e,t,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:s.a}},writer(e,t,r,i){this._writeBaseLayers(e,t,i)}}}}}})],S.prototype,"baseLayers",null),Object(n.a)([Object(b.b)({type:String,json:{origins:{"web-scene":{write:!0}}}})],S.prototype,"id",void 0),Object(n.a)([Object(b.b)({type:O.default})],S.prototype,"portalItem",void 0),Object(n.a)([Object(b.b)()],S.prototype,"referenceLayers",null),Object(n.a)([Object(b.b)({readOnly:!0})],S.prototype,"resourceInfo",void 0),Object(n.a)([Object(b.b)({type:y.a})],S.prototype,"spatialReference",void 0),Object(n.a)([Object(b.b)()],S.prototype,"thumbnailUrl",void 0),Object(n.a)([Object(b.b)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],S.prototype,"title",void 0),Object(n.a)([Object(g.a)("title")],S.prototype,"writeTitle",null),S=i=Object(n.a)([Object(m.a)("esri.Basemap")],S);var T=S;t.default=T},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return o}));r(8);var i=r(11),n=r(2),s=r(222),a=r(244);function o(e,t){if(!e)return null;if(!u(e))return new i.a("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});const r=e.heightUnit,n=s.a.deriveUnitFromSR(e,t).heightUnit;return r!==n?new i.a("webscene:incompatible-height-unit",`The vertical units of the scene (${r}) must match the horizontal units of the scene (${n})`,{verticalUnit:r,horizontalUnit:n}):null}function l(e,t,r){const n=d(e),a=t,o=c(n,a,r);{let t=null;if(n){const a=s.a.deriveUnitFromSR(n,e.spatialReference).heightUnit;r||a===n.heightUnit||(t=new i.a("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${a})`,{horizontalUnit:a}))}if(!("heightModelInfo"in(l=e)&&null!=l.heightModelInfo||null!=l.spatialReference)&&f(l)||4===o||t)return new i.a("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:n,error:t})}var l;{let e=null;switch(o){case 1:{const t=n.heightUnit||"unknown",r=a.heightUnit||"unknown";e=new i.a("layerview:incompatible-height-unit",`The vertical units of the layer (${t}) must match the vertical units of the scene (${r})`,{layerUnit:t,sceneUnit:r});break}case 2:{const t=n.heightModel||"unknown",r=a.heightModel||"unknown";e=new i.a("layerview:incompatible-height-model",`The height model of the layer (${t}) must match the height model of the scene (${r})`,{layerHeightModel:t,sceneHeightModel:r});break}case 3:{const t=n.vertCRS||"unknown",r=a.vertCRS||"unknown";e=new i.a("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${t}) must match the vertical datum of the scene (${r})`,{layerDatum:t,sceneDatum:r});break}}if(e)return new i.a("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:n,sceneHeightModelInfo:a,error:e})}return null}function c(e,t,r){if(!u(e)||!u(t))return 4;if(null==e||null==t)return 0;if(!r&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===t.vertCRS?0:3;default:return 4}}function u(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function d(e){const t=e.url&&Object(a.e)(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&Object(n.j)(t)&&"ImageServer"===t.serverType||!h(e)||!e.heightModelInfo?f(e)?s.a.deriveUnitFromSR(g,e.spatialReference):null:e.heightModelInfo}function h(e){return"heightModelInfo"in e}function p(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;case"imagery":case"map-image":case"map-notes":case"tile":case"vector-tile":case"scene":case null:default:return!1}}function f(e){return p(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):m(e)}function b(e){return null!=e.layers||m(e)||p(e)||h(e)}function m(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":case"slice":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"direct-line-measurement":case"area-measurement":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"line-of-sight":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}const g=new s.a({heightModel:"gravity-related-height"})},function(e,t,r){"use strict";function i(e,t){return null!=e&&("2d"===t||("local"===t?!e.isGeographic:e.isWebMercator||e.isWGS84||4490===e.wkid||104971===e.wkid||104905===e.wkid||104903===e.wkid))}r.d(t,"a",(function(){return i}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(2),n=r(104),s=r(171),a=r(3);class o{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,r,i,n,a){this.id=Object(s.b)(),this.geometry=e,this.material=t,this.transformation=r,this.instanceParameters=i,this.origin=n,this._shaderTransformation=a,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return Object(i.j)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(a.s)(e,e,this.getStaticTransformation()),!0)}}o.pool=new n.a(o)},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c}));var i=r(10),n=r(3),s=r(5);const a=Object(s.e)(),o=Object(s.e)();function l(){return{direction:Object(s.e)(),up:Object(s.e)()}}function c(e,t,r,s,l){let c=Object(n.t)(a,e),u=Object(n.j)(c,s);const d=u>0;u=Math.abs(u),u>.99&&(u=Math.abs(Object(n.j)(t,s)),u<.99?(Object(n.m)(c,t),d&&Object(n.g)(c,c,-1)):c=null);let h=0;if(c){Object(n.g)(o,s,Object(n.j)(s,c)),Object(n.l)(c,c,o);const e=Object(n.j)(c,l)/(Object(n.r)(c)*Object(n.r)(l));Object(n.i)(o,c,l),h=(Object(n.j)(o,s)>0?1:-1)*Object(i.r)(Object(i.b)(e))}const p=Object(i.r)(Object(i.b)(-Object(n.j)(s,e)/Object(n.r)(e)));return r?(r.heading=h,r.tilt=p,r):{heading:h,tilt:p}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return o}));var i=r(86),n=r(174),s=r(121),a=r(245);const o={types:i.i,json:{write:{writer:n.b},origins:{"web-scene":{types:i.j,write:{writer:n.b}}}}},l={types:{base:s.a,key:"type",typeMap:{"simple-fill":i.e.typeMap["simple-fill"],"picture-fill":i.e.typeMap["picture-fill"],"polygon-3d":i.e.typeMap["polygon-3d"]}},json:{write:{writer:n.b},origins:{"web-scene":{type:a.a,write:{writer:n.b}}}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return a}));r(8);function i(e){switch(e){case"u8":return 1;case"u16":return 2;case"u32":return 4;case"i8":return 1;case"i16":return 2;case"i32":case"f32":return 4;case"f64":return 8;default:return}}function n(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function s(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function a(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}},function(e,t,r){"use strict";var i=r(0),n=r(44);const s=Object(n.b)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});s.toJSON.bind(s),s.fromJSON.bind(s);var a,o=r(14),l=r(1),c=(r(8),r(9)),u=(r(7),r(37)),d=r(4),h=r(161),p=r(151);let f=a=class extends o.a{constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}clone(){return new a({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Object(h.b)(e,Object(h.a)(this.dateFormat)):Object(p.b)(e,Object(p.a)(this))}};Object(i.a)([Object(u.a)(s)],f.prototype,"dateFormat",void 0),Object(i.a)([Object(l.b)({type:Boolean,json:{write:!0}})],f.prototype,"digitSeparator",void 0),Object(i.a)([Object(l.b)({type:c.a,json:{write:!0}})],f.prototype,"places",void 0),f=a=Object(i.a)([Object(d.a)("esri.popup.support.FieldInfoFormat")],f);var b=f;t.a=b},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r(79),n=r(232);async function s(e){if(!e)return;const t=e.indexOf("-vector")>-1?e.slice(0,e.indexOf("-vector")):e,r=await Object(n.a)("esri/t9n/basemaps");return r[e]||r[t]}const a={streets:{id:"streets",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Boundaries and Places",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",get thumbnailUrl(){return Object(i.b)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Object(i.b)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));r(8);const i={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},n={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function s(e,t,r){const i=new Date(e.getTime());if(t&&r){const e=n[r],{getter:s,setter:a,multiplier:o}=e;i[a](i[s]()+t*o)}return i}function a(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function o(e,t,r){return 0===e?0:e*i[t]/i[r]}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(334);Object.freeze({__proto__:null,copy:function(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u){for(let e=0;e<9;++e)i[l+e]=s[c+e];l+=n,c+=a}}});Object.freeze({__proto__:null,copy:function(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u){for(let e=0;e<16;++e)i[l+e]=s[c+e];l+=n,c+=a}}}),r(399),r(475),r(376),r(421);function n(e,t){return new e(new ArrayBuffer(t*e.ElementCount*Object(i.a)(e.ElementType)))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return c}));var i=r(124),n=(r(8),r(13)),s=r(2),a=r(81),o=r(85),l=r(191);function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function d(e,t){if(!e)return null;if("declaredClass"in e)return e;const r=new i.a({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=Object(n.a)(e.symbol),r.attributes=Object(n.a)(e.attributes),r.geometry=h(e.geometry),r}function h(e){return Object(s.i)(e)?null:c(e)?e:Object(o.a)(function(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:r,y:i,z:n,m:s}=e;return{x:r,y:i,z:n,m:s,spatialReference:t}}case"polygon":{const{rings:r,hasZ:i,hasM:n}=e;return{rings:p(r),hasZ:i,hasM:n,spatialReference:t}}case"polyline":{const{paths:r,hasZ:i,hasM:n}=e;return{paths:p(r),hasZ:i,hasM:n,spatialReference:t}}case"extent":{const{xmin:r,xmax:i,ymin:n,ymax:s,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:u,hasM:d}=e;return{xmin:r,xmax:i,ymin:n,ymax:s,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:u,hasM:d,spatialReference:t}}case"multipoint":{const{points:r,hasZ:i,hasM:n}=e;return{points:b(r)?f(r):r,hasZ:i,hasM:n,spatialReference:t}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return b(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>Object(a.n)(e)))}function b(e){return e.length&&(Object(a.d)(e[0])||Object(a.e)(e[0]))}function m(e,t){if(!e)return null;let r;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=Object(l.j)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}},function(e,t,r){"use strict";r(161),r(151),r(225),r(125);var i=r(232),n=r(84),s=r(11),a=r(56),o=r(2);async function l(e){if(Object(o.j)(u.fetchBundleAsset))return u.fetchBundleAsset(e);const t=await Object(n.default)(e,{responseType:"text"});return JSON.parse(t.data)}class c{constructor({base:e="",pattern:t,location:r=new URL(window.location.href)}){let i;i="string"==typeof r?e=>new URL(e,new URL(r,a.a.location)).href:r instanceof URL?e=>new URL(e,r).href:r,this.pattern="string"==typeof t?new RegExp(`^${t}`):t,this.getAssetUrl=i,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,t){return async function(e,t,r,n){const a=t.exec(r);if(!a)throw new s.a("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const o=a[1]?`${a[1]}/`:"",c=a[2],u=Object(i.b)(n),d=`${o}${c}.json`,h=u?`${o}${c}_${u}.json`:d;let p;try{p=await l(e(h))}catch(f){if(h===d)throw new s.a("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f});try{p=await l(e(d))}catch(f){throw new s.a("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return p}(this.getAssetUrl,this.matcher,e,t)}}const u={};var d,h=r(79);Object(i.c)((d={pattern:"esri/",location:h.b},new c(d)))},function(e,t,r){"use strict";r.d(t,"a",(function(){return z}));var i=r(7),n=r(10),s=r(2),a=r(17),o=r(18),l=r(3),c=r(5),u=r(112),d=r(26),h=r(94),p=r(136),f=r(184),b=r(103),m=r(33),g=r(518),y=r(123),v=r(0),O=r(61),j=r(96),_=r(98),w=r(186),x=r(92),S=r(77),T=r(82),C=r(15),M=r(75),P=r(74),A=r(97),E=r(607),R=r(30);const I=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]);class D extends T.a{constructor(e,t,r){super(e,t,r),this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=D.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:r.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleUVMaxEnabled:r.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:r.stippleIntegerRepeatsEnabled,roundCaps:r.roundCaps,roundJoins:r.roundJoins,vvColor:r.vvColor,vvSize:r.vvSize,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,falloffEnabled:r.falloffEnabled,innerColorEnabled:r.innerColorEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new P.a(e.rctx,i,I)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(x.c)(this.program,t.camera.projectionMatrix),4===this.configuration.output&&Object(j.b)(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(_.a)(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),Object(w.d)(this.program,e),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.configuration.stippleEnabled){const r=Object(s.j)(this.stippleTextureBind)?this.stippleTextureBind(this.program)*t.camera.pixelRatio:1;if(this.program.setUniform1f("stipplePatternPixelSizeInv",1/r),this.configuration.stippleOffColorEnabled){const t=Object(s.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Object(s.t)(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}bindDraw(e){Object(x.d)(this.program,e),Object(O.c)(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(R.g)({blending:0===r.output||7===r.output?i?M.f:Object(M.a)(e):null,depthTest:{func:Object(M.b)(e)},depthWrite:i?!r.transparent&&r.writeDepth&&R.e:Object(M.c)(e),colorWrite:R.d,stencilWrite:r.sceneHasOcludees?A.j:null,stencilTest:r.sceneHasOcludees?t?A.f:A.e:null,polygonOffset:i||n?r.polygonOffset&&F:M.d})}initializePipeline(){const e=this.configuration,t=e.polygonOffset&&F;return e.occluder&&(this._occluderPipelineTransparent=Object(R.g)({blending:M.f,polygonOffset:t,depthTest:A.a,depthWrite:null,colorWrite:R.d,stencilWrite:null,stencilTest:A.h}),this._occluderPipelineOpaque=Object(R.g)({blending:M.f,polygonOffset:t,depthTest:A.a,depthWrite:null,colorWrite:R.d,stencilWrite:A.i,stencilTest:A.g}),this._occluderPipelineMaskWrite=Object(R.g)({blending:null,polygonOffset:t,depthTest:A.b,depthWrite:null,colorWrite:null,stencilWrite:A.j,stencilTest:A.f})),this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return 5}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?11===e?this._occluderPipelineTransparent:10===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline}}D.shader=new S.a(E.a,(()=>r.e(199).then(r.bind(null,1049))));const F={factor:0,units:-4};class L extends C.a{constructor(){super(...arguments),this.output=0,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.roundCaps=!1,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(v.a)([Object(C.b)({count:8})],L.prototype,"output",void 0),Object(v.a)([Object(C.b)()],L.prototype,"occluder",void 0),Object(v.a)([Object(C.b)()],L.prototype,"slicePlaneEnabled",void 0),Object(v.a)([Object(C.b)()],L.prototype,"transparent",void 0),Object(v.a)([Object(C.b)()],L.prototype,"polygonOffset",void 0),Object(v.a)([Object(C.b)()],L.prototype,"writeDepth",void 0),Object(v.a)([Object(C.b)()],L.prototype,"stippleEnabled",void 0),Object(v.a)([Object(C.b)()],L.prototype,"stippleOffColorEnabled",void 0),Object(v.a)([Object(C.b)()],L.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(v.a)([Object(C.b)()],L.prototype,"roundCaps",void 0),Object(v.a)([Object(C.b)()],L.prototype,"roundJoins",void 0),Object(v.a)([Object(C.b)()],L.prototype,"vvSize",void 0),Object(v.a)([Object(C.b)()],L.prototype,"vvColor",void 0),Object(v.a)([Object(C.b)()],L.prototype,"vvOpacity",void 0),Object(v.a)([Object(C.b)()],L.prototype,"falloffEnabled",void 0),Object(v.a)([Object(C.b)()],L.prototype,"innerColorEnabled",void 0),Object(v.a)([Object(C.b)()],L.prototype,"sceneHasOcludees",void 0),Object(v.a)([Object(C.b)({count:4})],L.prototype,"transparencyPassType",void 0),Object(v.a)([Object(C.b)()],L.prototype,"multipassTerrainEnabled",void 0),Object(v.a)([Object(C.b)()],L.prototype,"cullAboveGround",void 0);const k=i.a.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");class z extends b.a{constructor(e){super(e,N),this._vertexAttributeLocations=I,this.techniqueConfig=new L,this.layout=this.createLayout()}isClosed(e,t){return q(this.params,e,t)}dispose(){}getPassParameters(){return this.params}getTechniqueConfig(e,t){this.techniqueConfig.output=e;const r=Object(s.j)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleIntegerRepeatsEnabled=r&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=r&&Object(s.j)(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&Object(s.j)(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.params.renderOccluded,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,r,i,n,s,a,o,l){l?this.intersectDrapedLineGeometry(e,i,s,a):this.intersectLineGeometry(e,t,r,i,this.params.width,a)}intersectDrapedLineGeometry(e,t,r,i){if(!t.options.selectionMode)return;const s=e.vertexAttributes.get("position").data,a=e.vertexAttributes.get("size");let o=this.params.width;if(this.params.vvSizeEnabled){const t=e.vertexAttributes.get("sizeFeatureAttribute").data[0];o*=Object(n.e)(this.params.vvSizeOffset[0]+t*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else a&&(o*=a.data[0]);const l=r[0],c=r[1],u=(o/2+4)*e.screenToWorldRatio;let d=Number.MAX_VALUE;for(let h=0;h<s.length-5;h+=3){const e=s[h],t=s[h+1],r=l-e,i=c-t,a=s[h+3]-e,o=s[h+4]-t,u=Object(n.e)((a*r+o*i)/(a*a+o*o),0,1),p=a*u-r,f=o*u-i,b=p*p+f*f;b<d&&(d=b)}d<u*u&&i()}intersectLineGeometry(e,t,r,i,s,a){if(!i.options.selectionMode||Object(y.e)(t))return;if(!Object(m.g)(r))return void k.error("intersection assumes a translation-only matrix");const c=e.vertexAttributes,h=c.get("position").data;let p=s;if(this.params.vvSizeEnabled){const e=c.get("sizeFeatureAttribute").data[0];p*=Object(n.e)(this.params.vvSizeOffset[0]+e*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else c.has("size")&&(p*=c.get("size").data[0]);const f=i.camera,b=J;Object(o.c)(b,i.point);const g=p*f.pixelRatio/2+4*f.pixelRatio;Object(l.y)(oe[0],b[0]-g,b[1]+g,0),Object(l.y)(oe[1],b[0]+g,b[1]+g,0),Object(l.y)(oe[2],b[0]+g,b[1]-g,0),Object(l.y)(oe[3],b[0]-g,b[1]-g,0);for(let n=0;n<4;n++)if(!f.unprojectFromRenderScreen(oe[n],le[n]))return;Object(d.g)(f.eye,le[0],le[1],ce),Object(d.g)(f.eye,le[1],le[2],ue),Object(d.g)(f.eye,le[2],le[3],de),Object(d.g)(f.eye,le[3],le[0],he);let v=Number.MAX_VALUE;const O=G(this.params,c,e.indices)?h.length-2:h.length-5;for(let n=0;n<O;n+=3){$[0]=h[n]+r[12],$[1]=h[n+1]+r[13],$[2]=h[n+2]+r[14];const e=(n+3)%h.length;if(Q[0]=h[e]+r[12],Q[1]=h[e+1]+r[13],Q[2]=h[e+2]+r[14],Object(d.w)(ce,$)<0&&Object(d.w)(ce,Q)<0||Object(d.w)(ue,$)<0&&Object(d.w)(ue,Q)<0||Object(d.w)(de,$)<0&&Object(d.w)(de,Q)<0||Object(d.w)(he,$)<0&&Object(d.w)(he,Q)<0)continue;if(f.projectToRenderScreen($,Y),f.projectToRenderScreen(Q,K),Y[2]<0&&K[2]>0){Object(l.l)(Z,$,Q);const e=f.frustum,t=-Object(d.w)(e[4],$)/Object(l.j)(Z,Object(d.s)(e[4]));Object(l.g)(Z,Z,t),Object(l.h)($,$,Z),f.projectToRenderScreen($,Y)}else if(Y[2]>0&&K[2]<0){Object(l.l)(Z,Q,$);const e=f.frustum,t=-Object(d.w)(e[4],Q)/Object(l.j)(Z,Object(d.s)(e[4]));Object(l.g)(Z,Z,t),Object(l.h)(Q,Q,Z),f.projectToRenderScreen(Q,K)}else if(Y[2]<0&&K[2]<0)continue;Y[2]=0,K[2]=0;const t=Object(u.d)(Object(u.e)(Y,K,re),b);t<v&&(v=t,Object(l.m)(ee,$),Object(l.m)(te,Q))}const j=i.rayBeginPoint,_=i.rayEndPoint;if(v<g*g){let e=Number.MAX_VALUE;if(Object(u.a)(Object(u.e)(ee,te,re),Object(u.e)(j,_,ie),X)){Object(l.l)(X,X,j);const t=Object(l.r)(X);Object(l.g)(X,X,1/t),e=t/Object(l.o)(j,_)}a(e,X)}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return null;const i=e.indices,n=r.get("position");return Object(p.a)(n,i?i.get("position"):null,i&&G(this.params,r,i),t)}createLayout(){const e=Object(h.a)().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.params.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.params.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.params.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}createBufferWriter(){return new U(this.layout,this.params)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new V(e):void 0}validateParameterValues(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}requiresTransparent(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}colorRequiresTransparent(e){return Object(s.j)(e)&&e[3]<1&&e[3]>0}}class V extends f.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(D,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return this._technique.configuration.occluder?3===e||10===e||11===e:0===this._output||7===this._output?(this.targetSlot=this._technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(e,t)}}const N={width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...b.b,...g.a.Default};class U{constructor(e,t){switch(this.params=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e,this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=t.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=W}}isClosed(e){return G(this.params,e.vertexAttributes,e.indices)}numCapSubdivisions(e){if(this.isClosed(e))return 0;switch(this.params.cap){case"butt":return 0;case"square":return 1;case"round":return H}}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2*this.numCapSubdivisions(e)+2,r=e.indices.get("position").length/2+1,i=this.isClosed(e);let n=i?2:2*t;const s=i?0:1,a=i?r:r-1;if(e.vertexAttributes.has("subdivisions")){const t=e.vertexAttributes.get("subdivisions").data;for(let e=s;e<a;++e)n+=4+2*t[e]}else n+=(a-s)*(2*this.numJoinSubdivisions+4);return n+=2,n}write(e,t,r,i){const n=ne,s=se,a=ae,o=t.vertexAttributes.get("position").data,c=t.indices&&t.indices.get("position"),u=this.numCapSubdivisions(t);c&&c.length!==2*(o.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let d=null;t.vertexAttributes.has("subdivisions")&&(d=t.vertexAttributes.get("subdivisions").data);let h=1,p=0;this.params.vvSizeEnabled?p=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(h=t.vertexAttributes.get("size").data[0]);let f=[1,1,1,1],b=0;this.params.vvColorEnabled?b=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(f=t.vertexAttributes.get("color").data);let m=0;this.params.vvOpacityEnabled&&(m=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);const g=o.length/3,y=e.transformation,v=new Float32Array(r.buffer),O=this.vertexBufferLayout.stride/4;let j=i*O;const _=j,w=(e,t,r,i,n,s,a)=>{if(v[j++]=t[0],v[j++]=t[1],v[j++]=t[2],v[j++]=i,v[j++]=n,v[j++]=s,v[j++]=e[0],v[j++]=e[1],v[j++]=e[2],v[j++]=r[0],v[j++]=r[1],v[j++]=r[2],this.params.vvSizeEnabled?v[j++]=p:v[j++]=h,this.params.vvColorEnabled)v[j++]=b;else{const e=Math.min(4*a,f.length-4);v[j++]=f[e+0],v[j++]=f[e+1],v[j++]=f[e+2],v[j++]=f[e+3]}this.params.vvOpacityEnabled&&(v[j++]=m)};j+=O,Object(l.y)(s,o[0],o[1],o[2]),y&&Object(l.s)(s,s,y);const x=this.isClosed(t);if(x){const e=o.length-3;Object(l.y)(n,o[e],o[e+1],o[e+2]),y&&Object(l.s)(n,n,y)}else{Object(l.m)(n,s),Object(l.y)(a,o[3],o[4],o[5]),y&&Object(l.s)(a,a,y);for(let e=0;e<u;++e){const t=1-e/u;w(n,s,a,t,1,-4,0),w(n,s,a,t,1,4,0)}w(n,s,a,0,0,-4,0),w(n,s,a,0,0,4,0),Object(l.m)(n,s),Object(l.m)(s,a)}const S=x?g:g-1;for(let T=x?0:1;T<S;T++){const e=(T+1)%g*3;Object(l.y)(a,o[e+0],o[e+1],o[e+2]),y&&Object(l.s)(a,a,y),w(n,s,a,0,1,-1,T),w(n,s,a,0,1,1,T);const t=d?d[T]:this.numJoinSubdivisions;for(let r=0;r<t;++r){const e=(r+1)/(t+1);w(n,s,a,e,1,-2,T),w(n,s,a,e,1,2,T)}w(n,s,a,1,0,-2,T),w(n,s,a,1,0,2,T),Object(l.m)(n,s),Object(l.m)(s,a)}if(x)j=B(v,_+O,v,j,2*O);else{w(n,s,a,0,1,-5,S),w(n,s,a,0,1,5,S);for(let e=0;e<u;++e){const t=(e+1)/u;w(n,s,a,t,1,-5,S),w(n,s,a,t,1,5,S)}}B(v,_+O,v,_,O),j=B(v,j-O,v,j,O)}}function B(e,t,r,i,n){for(let s=0;s<n;s++)r[i++]=e[t++];return i}function G(e,t,r){return q(e,t.get("position").data,r?r.get("position"):null)}function q(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}const H=3,W=1,$=Object(c.e)(),Q=Object(c.e)(),Z=Object(c.e)(),X=Object(c.e)(),J=Object(c.e)(),Y=Object(a.d)(),K=Object(a.d)(),ee=Object(c.e)(),te=Object(c.e)(),re=Object(u.c)(),ie=Object(u.c)(),ne=Object(c.e)(),se=Object(c.e)(),ae=Object(c.e)(),oe=[Object(a.d)(),Object(a.d)(),Object(a.d)(),Object(a.d)()],le=[Object(c.e)(),Object(c.e)(),Object(c.e)(),Object(c.e)()],ce=Object(d.d)(),ue=Object(d.d)(),de=Object(d.d)(),he=Object(d.d)()},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(37)),l=r(4),c=r(632),u=r(272);let d=i=class extends u.a{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const r=String(e);this.codedValues.some((e=>(String(e.code)===r&&(t=e.name),!!t)))}return t}clone(){return new i({codedValues:Object(s.a)(this.codedValues),name:this.name})}};Object(n.a)([Object(a.b)({type:[c.a],json:{write:!0}})],d.prototype,"codedValues",void 0),Object(n.a)([Object(o.a)({codedValue:"coded-value"})],d.prototype,"type",void 0),d=i=Object(n.a)([Object(l.a)("esri.layers.support.CodedValueDomain")],d);var h=d;t.a=h},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));var i=r(59);const n=-3;class s{constructor(e,t,r){this._namespace=e,this._storage=t,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,t,r,i=0){this._storage.put(this._namespace+e,t,r,i)}get(e){const t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}pop(e){const t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}updateSize(e,t,r){this._storage.updateSize(this._namespace+e,t,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class a{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new i.a,this._users=new i.a}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,t,r,i){const s=this._db.get(e);if(s&&(this._size-=s.size,this._db.delete(e),s.entry!==t&&this._notifyRemoved(e,s.entry)),r>this._maxSize)return void this._notifyRemoved(e,t);if(void 0===t)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const a=1+Math.max(i,n)-n;this._db.set(e,{entry:t,size:r,lifetime:a,lives:a}),this._size+=r,this._checkSizeLimit()}updateSize(e,t,r){const i=this._db.get(e);if(i&&i.entry===t){if(this._size-=i.size,r>this._maxSize)return this._db.delete(e),void this._notifyRemoved(e,t);i.size=r,this._size+=r,this._checkSizeLimit()}}pop(e){const t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}get(e){const t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,i)=>{const n=e.lifetime;r[n]=(r[n]||0)+e.size,this._users.forAll((r=>{const n=r.namespace;if(i.startsWith(n)){const r=t[n]||0;t[n]=r+e.size}}))}));const i={};this._users.forAll((e=>{const r=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){const n=t[r]||0;t[r]=n,i[r]=Math.round(100*e.hitRate)+"%"}else i[r]="0%"}));const s=Object.keys(t);s.forEach((e=>t[e]=t[e]/this._size*100)),s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r])+"% / "+i[r]));for(let a=r.length-1;a>=0;--a){const t=r[a];t&&(e["Priority "+(a+n-1)]=Math.round(t/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){this._db.forEach(((t,r)=>{r.startsWith(e)&&(this._size-=t.size,this._db.delete(r),this._notifyRemoved(r,t.entry))}))}clearAll(){this._db.forEach(((e,t)=>this._notifyRemoved(t,e.entry))),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemoved(e,t){this._removeFuncs.forAll((r=>{e.startsWith(r[0])&&r[1](t)}))}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,t]of this._db)if(this._db.delete(e),t.lives<=1?(this._size-=t.size,this._notifyRemoved(e,t.entry)):(--t.lives,this._db.set(e,t)),this._size<=.9*this.maxSize)return}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return g}));var i=r(10),n=r(2),s=r(81),a=r(3),o=r(5),l=r(36),c=r(396),u=r(460),d=r(51),h=r(255),p=r(100);function f(e){const t=[],r=[];!function(e,t,r){const{attributeData:{position:i},removeDuplicateStartEnd:n}=e,a=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(i)&&1===n,o=i.length/3-(a?1:0),l=new Uint32Array(2*(o-1)),c=a?Object(s.m)(i,0,i.length-3):i;let u=0;for(let s=0;s<o-1;s++)l[u++]=s,l[u++]=s+1;t.push(["position",{size:3,data:c,exclusive:a}]),r.push(["position",l])}(e,r,t);const o=r[0][1].data,l=t[0][1].length,c=new Uint16Array(l);return function(e,t,r){const i=e.attributeData.mapPosition;Object(n.i)(i)||(r.push(["mapPos",r[0][1]]),t.push(["mapPos",{size:3,data:i}]))}(e,r,t),function(e,t,r,i){if(Object(n.j)(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push(["color",{size:4,data:Object(n.t)(s,u.c)}]),r.push(["color",i])}(e,r,t,c),function(e,t,r,i){if(Object(n.j)(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push(["size",{size:1,data:[Object(n.t)(s,1)]}]),r.push(["size",i])}(e,r,t,c),function(e,t,r,i){const s=e.attributeData.colorFeature;Object(n.i)(s)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([s])}]),r.push(["color",i]))}(e,r,t,c),function(e,t,r,i){const s=e.attributeData.sizeFeature;Object(n.i)(s)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([s])}]),r.push(["sizeFeatureAttribute",i]))}(e,r,t,c),function(e,t,r,i){const s=e.attributeData.opacityFeature;Object(n.i)(s)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([s])}]),r.push(["opacityFeatureAttribute",i]))}(e,r,t,c),function(e,t,r,s){if("round"!==e.join)return;const o=s.length/3,l=new Float32Array(o),c=v,u=O;Object(a.y)(c,0,0,0);const d=Object(n.t)(e.uniformSize,1);for(let n=-1;n<o;++n){const e=n<0?o+n:n,t=(n+1)%o;if(Object(a.y)(u,s[3*t+0]-s[3*e+0],s[3*t+1]-s[3*e+1],s[3*t+2]-s[3*e+2]),Object(a.t)(u,u),n>=0){const e=(Math.PI-Object(i.b)(Object(a.j)(c,u)))*j*1*y(d);l[n]=Math.max(Math.floor(e),0)}Object(a.g)(c,u,-1)}t.push(["subdivisions",{size:1,data:l}]),r.push(["subdivisions",r[0][1]])}(e,r,t,o),new p.a(r,t,2)}function b(e,t,r,i){const n="polygon"===e.type?1:0,s="polygon"===e.type?e.rings:e.paths,{position:a,outlines:o}=Object(c.a)(s,e.hasZ,n),l=new Float64Array(a.length),u=Object(d.c)(a,e.spatialReference,0,l,0,a,0,a.length/3,t,r,i),h=null!=u;return{lines:h?m(o,a,l):[],projectionSuccess:h,sampledElevation:u}}function m(e,t,r){const i=new Array;for(const{index:n,count:s}of e){if(s<=1)continue;const e=3*n,a=e+3*s;i.push({position:t.subarray(e,a),mapPosition:r?r.subarray(e,a):void 0})}return i}function g(e,t){const r="polygon"===e.type?1:0,i="polygon"===e.type?e.rings:e.paths,{position:n,outlines:s}=Object(c.a)(i,!1,r),a=Object(l.q)(n,e.spatialReference,0,n,t,0,n.length/3);for(let o=2;o<n.length;o+=3)n[o]=h.a;return{lines:a?m(s,n):[],projectionSuccess:a}}function y(e){return 1.863798+-2.0062872/(1+e/18.2313)**.8856294}const v=Object(o.e)(),O=Object(o.e)(),j=4/Math.PI},function(e,t,r){"use strict";e.exports=r(677)},function(e,t,r){"use strict";var i,n=r(0),s=(r(1),r(8),r(9),r(7),r(37)),a=r(4),o=r(272);let l=i=class extends o.a{constructor(e){super(e),this.type="inherited"}clone(){return new i}};Object(n.a)([Object(s.a)({inherited:"inherited"})],l.prototype,"type",void 0),l=i=Object(n.a)([Object(a.a)("esri.layers.support.InheritedDomain")],l);var c=l;t.a=c},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(37)),o=r(4),l=r(272);let c=i=class extends l.a{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new i({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};Object(n.a)([Object(s.b)({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,r){t[r]=[this.minValue||0,e]}}}})],c.prototype,"maxValue",void 0),Object(n.a)([Object(s.b)({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,r){t[r]=[e,this.maxValue||0]}}}})],c.prototype,"minValue",void 0),Object(n.a)([Object(a.a)({range:"range"})],c.prototype,"type",void 0),c=i=Object(n.a)([Object(o.a)("esri.layers.support.RangeDomain")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i,n=r(0),s=r(2),a=r(1),o=(r(8),r(9),r(7),r(37)),l=r(4),c=r(147),u=r(490),d=r(187);let h=i=class extends c.a{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new i({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:Object(s.j)(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};Object(n.a)([Object(o.a)({Extrude:"extrude"},{readOnly:!0})],h.prototype,"type",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],h.prototype,"size",void 0),Object(n.a)([Object(a.b)({type:d.a,json:{write:!0}})],h.prototype,"material",void 0),Object(n.a)([Object(a.b)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],h.prototype,"castShadows",void 0),Object(n.a)([Object(a.b)(u.a)],h.prototype,"edges",void 0),h=i=Object(n.a)([Object(l.a)("esri.symbols.ExtrudeSymbol3DLayer")],h);var p=h;t.a=p},function(e,t,r){"use strict";var i,n=r(0),s=r(2),a=r(1),o=(r(8),r(9),r(7),r(37)),l=r(32),c=r(4),u=r(147),d=r(187);let h=i=class extends u.a{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}get size(){return this.width&&this.height?this.width===this.height?this.width:void 0:this.width?this.width:this.height?this.height:void 0}set size(e){this.width=e,this.height=e}readSize(e,t){return t.height||t.width?e:t.size}clone(){return new i({enabled:this.enabled,material:Object(s.j)(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};Object(n.a)([Object(a.b)({type:d.a,json:{write:!0}})],h.prototype,"material",void 0),Object(n.a)([Object(a.b)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],h.prototype,"castShadows",void 0),Object(n.a)([Object(o.a)({Path:"path"},{readOnly:!0})],h.prototype,"type",void 0),Object(n.a)([Object(a.b)({type:Number})],h.prototype,"size",null),Object(n.a)([Object(l.a)("size")],h.prototype,"readSize",null),Object(n.a)([Object(a.b)({type:["circle","quad"],json:{write:!0,default:"circle"}})],h.prototype,"profile",void 0),Object(n.a)([Object(a.b)({type:["miter","bevel","round"],json:{write:!0,default:"miter"}})],h.prototype,"join",void 0),Object(n.a)([Object(a.b)({type:["none","butt","square","round"],json:{write:!0,default:"butt"}})],h.prototype,"cap",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],h.prototype,"width",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],h.prototype,"height",void 0),Object(n.a)([Object(a.b)({type:["center","bottom","top"],json:{write:!0,default:"center"}})],h.prototype,"anchor",void 0),Object(n.a)([Object(a.b)({type:["heading","all"],json:{write:!0,default:"all"}})],h.prototype,"profileRotation",void 0),h=i=Object(n.a)([Object(c.a)("esri.symbols.PathSymbol3DLayer")],h);var p=h;t.a=p},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(13),o=r(1),l=r(9),c=(r(8),r(7),r(37)),u=r(4),d=r(147);let h=i=class extends d.a{constructor(e){super(e),this.color=p.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new i({color:Object(a.a)(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};Object(n.a)([Object(o.b)({type:s.a,nonNullable:!0,json:{type:[l.a],write:(e,t,r)=>t[r]=e.toArray(1),default:()=>p.clone(),defaultEquals:e=>e.toCss(!0)===p.toCss(!0)}})],h.prototype,"color",void 0),Object(n.a)([Object(c.a)({Water:"water"},{readOnly:!0})],h.prototype,"type",void 0),Object(n.a)([Object(o.b)({type:["small","medium","large"],json:{write:!0,default:"medium"}})],h.prototype,"waterbodySize",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0,default:null}})],h.prototype,"waveDirection",void 0),Object(n.a)([Object(o.b)({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],h.prototype,"waveStrength",void 0),h=i=Object(n.a)([Object(u.a)("esri.symbols.WaterSymbol3DLayer")],h);const p=new s.a([0,119,190]);var f=h;t.a=f},function(e,t,r){"use strict";var i,n=r(0),s=r(38),a=r(13),o=r(1),l=(r(9),r(8),r(7),r(37)),c=r(4),u=r(263),d=r(212);const h=s.a.ofType({base:null,key:"type",typeMap:{fill:u.a}});let p=i=class extends d.a{constructor(e){super(e),this.symbolLayers=new h,this.type="mesh-3d"}clone(){return new i({styleOrigin:Object(a.a)(this.styleOrigin),symbolLayers:Object(a.a)(this.symbolLayers),thumbnail:Object(a.a)(this.thumbnail)})}};Object(n.a)([Object(o.b)({type:h})],p.prototype,"symbolLayers",void 0),Object(n.a)([Object(l.a)({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],p.prototype,"type",void 0),p=i=Object(n.a)([Object(c.a)("esri.symbols.MeshSymbol3D")],p);var f=p;t.a=f},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(171);class n{constructor(e){this.channel=e,this.id=Object(i.b)()}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return x}));var i=r(2),n=r(52),s=r(213),a=r(66),o=(r(93),r(8)),l=(r(109),r(145),r(228),r(47),r(90)),c=r(596);class u{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this.data=e,this.memoryUsed=e.byteLength;let r=1;const i=new Uint32Array(e);this.layerUIDs=[];const n=i[r++];for(let s=0;s<n;s++)this.layerUIDs[s]=i[r++];this.bufferDataOffset=r,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return Object(i.i)(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){Object(i.i)(this.data)||(this.doPrepareForRendering(e,this.data,this.bufferDataOffset),this.data=null)}}class d extends u{constructor(e,t){super(e,t),this.type=2,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let i=this.bufferDataOffset;this.lineIndexStart=r[i++],this.lineIndexCount=r[i++];const n=r[i++];if(n>0){const e=new Map;for(let t=0;t<n;t++){const t=r[i++],n=r[i++],s=r[i++];e.set(t,[n,s])}this.patternMap=e}this.bufferDataOffset=i}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){Object(i.j)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),Object(i.j)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),Object(i.j)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){const i=new Uint32Array(t),n=new Int32Array(i.buffer),s=i[r++];this.lineVertexBuffer=a.a.createVertex(e,35044,new Int32Array(n.buffer,4*r,s)),r+=s;const o=i[r++];this.lineIndexBuffer=a.a.createIndex(e,35044,new Uint32Array(i.buffer,4*r,o)),r+=o;const c=this.layer.lineMaterial;this.lineVertexArrayObject=new l.a(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class h extends u{constructor(e,t){super(e,t),this.type=1,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let i=this.bufferDataOffset;this.fillIndexStart=r[i++],this.fillIndexCount=r[i++],this.outlineIndexStart=r[i++],this.outlineIndexCount=r[i++];const n=r[i++];if(n>0){const e=new Map;for(let t=0;t<n;t++){const t=r[i++],n=r[i++],s=r[i++];e.set(t,[n,s])}this.patternMap=e}this.bufferDataOffset=i}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){Object(i.j)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),Object(i.j)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),Object(i.j)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,Object(i.j)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),Object(i.j)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),Object(i.j)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){const i=new Uint32Array(t),n=new Int32Array(i.buffer),s=i[r++];this.fillVertexBuffer=a.a.createVertex(e,35044,new Int32Array(n.buffer,4*r,s)),r+=s;const o=i[r++];this.fillIndexBuffer=a.a.createIndex(e,35044,new Uint32Array(i.buffer,4*r,o)),r+=o;const c=i[r++];this.outlineVertexBuffer=a.a.createVertex(e,35044,new Int32Array(n.buffer,4*r,c)),r+=c;const u=i[r++];this.outlineIndexBuffer=a.a.createIndex(e,35044,new Uint32Array(i.buffer,4*r,u)),r+=u;const d=this.layer,h=d.fillMaterial,p=d.outlineMaterial;this.fillVertexArrayObject=new l.a(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new l.a(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class p extends u{constructor(e,t,r){super(e,t),this.type=3,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const i=new Uint32Array(e),n=new Int32Array(e),s=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!i[a++];const o=i[a++];for(let c=0;c<o;c++){const e=i[a++],t=i[a++],r=i[a++];this.iconPerPageElementsMap.set(e,[t,r])}const l=i[a++];for(let c=0;c<l;c++){const e=i[a++],t=i[a++],r=i[a++];this.glyphPerPageElementsMap.set(e,[t,r])}const u=i[a++],d=i[a++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(d),a=Object(c.b)(i,n,s,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[t,r]of this.iconPerPageElementsMap)e+=r[1];for(const[t,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){Object(i.j)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),Object(i.j)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),Object(i.j)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),Object(i.j)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,Object(i.j)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),Object(i.j)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),Object(i.j)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),Object(i.j)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=Object(i.s)(this.iconOpacity),t=Object(i.s)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);const r=Object(i.s)(this.textOpacity),n=Object(i.s)(this.textOpacityBuffer);r.length>0&&r.byteLength===n.size&&n.setSubData(r)}doPrepareForRendering(e,t,r){const n=new Uint32Array(t),s=new Int32Array(n.buffer),o=n[r++];this.iconVertexBuffer=a.a.createVertex(e,35044,new Int32Array(s.buffer,4*r,o)),r+=o;const c=n[r++];this.iconIndexBuffer=a.a.createIndex(e,35044,new Uint32Array(n.buffer,4*r,c)),r+=c;const u=n[r++];this.textVertexBuffer=a.a.createVertex(e,35044,new Int32Array(s.buffer,4*r,u)),r+=u;const d=n[r++];this.textIndexBuffer=a.a.createIndex(e,35044,new Uint32Array(n.buffer,4*r,d)),r+=d,this.iconOpacityBuffer=a.a.createVertex(e,35044,Object(i.s)(this.iconOpacity).buffer),this.textOpacityBuffer=a.a.createVertex(e,35044,Object(i.s)(this.textOpacity).buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new l.a(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new l.a(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class f extends u{constructor(e,t){super(e,t),this.type=4,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let i=this.bufferDataOffset;this.circleIndexStart=r[i++],this.circleIndexCount=r[i++],this.bufferDataOffset=i}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){Object(i.j)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),Object(i.j)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),Object(i.j)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){const i=new Uint32Array(t),n=new Int32Array(i.buffer),s=i[r++];this.circleVertexBuffer=a.a.createVertex(e,35044,new Int32Array(n.buffer,4*r,s)),r+=s;const o=i[r++];this.circleIndexBuffer=a.a.createIndex(e,35044,new Uint32Array(i.buffer,4*r,o)),r+=o;const c=this.layer.circleMaterial;this.circleVertexArrayObject=new l.a(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}var b=r(545),m=r(68),g=r(12);const y=1/Object(o.a)("mapview-transitions-duration");class v extends m.a{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Object(g.h)(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Object(g.h)(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;null==(e=this.parent)||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const t=this._fadeOutResolver||!this.visible?0:this.opacity,r=this.computedOpacity;if(r===t)this.computedVisible=this.visible;else{const i=e*y;this.computedOpacity=r>t?Math.max(t,r-i):Math.min(t,r+i),this.computedVisible=this.computedOpacity>0;const n=t===this.computedOpacity;this.inFadeTransition=!n,n||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}var O=r(574);class j extends v{constructor(e,t,r,i=r){super(),this.triangleCountReportedInDebug=0,this.transforms={dvs:Object(s.b)(),tileMat3:Object(s.b)()},this.triangleCount=0,this.key=new O.a(e),this.bounds=t,this.size=r,this.coordRange=i}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}get coords(){return this._coords}get bounds(){return this._bounds}set bounds(e){this._coords=[e[0],e[3]],this._bounds=e}setTransform(e,t){const r=t/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,a]=e.toScreenNoRotation([0,0],this.coords),o=this.size[0]/this.coordRange[0]*r,l=this.size[1]/this.coordRange[1]*r;Object(n.m)(i,o,0,0,0,l,0,s,a,1),Object(n.j)(this.transforms.dvs,e.displayViewMat3,i)}}class _ extends j{constructor(e,t,r,i,n=null){super(e,r,i,[4096,4096]),this._memCache=n,this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=t,this.id=e.id,this.transforms.tileUnitsToPixels=Object(s.b)()}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<b.c}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<b.c)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let t=!1;for(const r of e)if(this.layerData.has(r)){const e=this.layerData.get(r);this._memoryUsedByLayerData-=e.memoryUsed,3===e.type&&this.symbols.has(r)&&(this.symbols.delete(r),t=!0),e.destroy(),this.layerData.delete(r),this.layerCount--}Object(i.j)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),t&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){"unloaded"!==this.status&&(w.delete(this),_._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let t=!1;if(e){const r=this._createRenderBuckets(e);for(const[e,i]of r){if(this.layerData.has(e)){const t=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,t.destroy(),this.layerData.delete(e),this.layerCount--}3===i.type&&(this.symbols.set(e,i.symbols),t=!0),this._memoryUsedByLayerData+=i.memoryUsed,this.layerData.set(e,i),this.layerCount++}Object(i.j)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,i]of this.layerData)3===i.type&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e,t){super.setTransform(e,t);const r=t/(e.resolution*e.pixelRatio),i=this.size[0]/this.coordRange[0]*r,s=this.size[1]/this.coordRange[1]*r,a=[0,0];e.toScreen(a,this.coords);const o=this.transforms.tileUnitsToPixels;Object(n.b)(o),Object(n.c)(o,o,a),Object(n.l)(o,o,Math.PI*e.rotation/180),Object(n.d)(o,o,[i,s,1])}static _destroyRenderBuckets(e){if(!e)return;const t=new Set;e.forEach((e=>{t.has(e)||(e.destroy(),t.add(e))})),e.clear()}_createRenderBuckets(e){const t=new Map,r=new Map;for(const i of e){const e=this._deserializeBucket(i,r);for(const r of e.layerUIDs)t.set(r,e)}return t}_deserializeBucket(e,t){let r=t.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case 1:r=new h(e,this.styleRepository);break;case 2:r=new d(e,this.styleRepository);break;case 3:r=new p(e,this.styleRepository,this);break;case 4:r=new f(e,this.styleRepository)}return t.set(e,r),r}}const w=new Map;function x(){w.forEach(((e,t)=>{console.log(`\n${t.key}:`),e[0].forEach((e=>console.log(e))),console.log("========"),e[1].forEach((e=>console.log(e)))}))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return f}));var i=r(328),n=r(38),s=r(7),a=r(25),o=r(9),l=r(336);const c=s.a.getLogger("esri.support.basemapUtils");function u(){return{}}function d(e){for(const t in e){const r=e[t];!1===(null==r?void 0:r.destroyed)&&r.destroy(),delete e[t]}}function h(e,t){var r;let n;if("string"==typeof e){if(!(e in l.a)){const t=Object.keys(l.a).map((e=>`"${e}"`)).join(", ");return c.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`),null}t&&(n=t[e]),n||(n=i.default.fromId(e),t&&(t[e]=n))}else n=Object(o.m)(i.default,e);return null!=(r=n)&&r.destroyed&&(c.warn("The provided basemap is already destroyed",{basemap:n}),n=null),n}function p(e,t=null){const r=h(e);if(!r)return null;const n=new i.default({id:r.id,title:r.title,baseLayers:r.baseLayers.slice(),referenceLayers:r.referenceLayers.slice()});return t&&(n.baseLayers=b(n.baseLayers,t.baseLayers),n.referenceLayers=b(n.referenceLayers,t.referenceLayers)),n.load().catch((()=>{})),n.portalItem=r.portalItem,n}function f(e){let t=null;const r=m(e),i=!r.baseLayers.length;for(const n in l.a){const e=j(r,v(l.a[n]),{mustMatchReferences:i});if("equal"===e){t=n;break}"base-layers-equal"===e&&(t=n)}return t}function b(e,t){const r=new n.a;return e.forEach((e=>{const i=t.find((t=>w(y(e),y(t))))||e;r.some((e=>e===i))?r.push(e):r.push(i)})),r}function m(e){return e?!e.loaded&&e.resourceInfo?v(e.resourceInfo.data):{baseLayers:g(e.baseLayers),referenceLayers:g(e.referenceLayers)}:null}function g(e){return(n.a.isCollection(e)?e.toArray():e).map(y)}function y(e){return{type:e.type,url:x("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible}}function v(e){return e?{baseLayers:O(e.baseMapLayers.filter((e=>!e.isReference))),referenceLayers:O(e.baseMapLayers.filter((e=>e.isReference)))}:null}function O(e){return e.map((e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;default:t="unknown"}return{type:t,url:x(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:null!=e.minScale?e.minScale:0,maxScale:null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visibility||!!e.visibility}}(e)))}function j(e,t,r){return null!=e!=(null!=t)?"not-equal":e?_(e.baseLayers,t.baseLayers)?_(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function _(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!w(e[r],t[r]))return!1;return!0}function w(e,t){return e.type===t.type&&e.url===t.url&&e.minScale===t.minScale&&e.maxScale===t.maxScale&&e.visible===t.visible&&e.opacity===t.opacity}function x(e){return e?Object(a.D)(e).replace(/^\s*https?:/i,"").toLowerCase():""}},function(e,t,r){"use strict";r.d(t,"a",(function(){return I})),r.d(t,"b",(function(){return R})),r.d(t,"c",(function(){return E}));var i=r(157),n=(r(113),r(124)),s=r(122),a=r(102),o=(r(8),r(11)),l=r(2),c=r(12),u=r(52),d=r(83),h=r(20),p=r(3),f=r(5),b=r(36),m=r(22),g=r(28),y=r(105),v=r(46),O=r(162),j=r(71),_=r(148),w=r(67),x=r(39),S=r(50),T=r(146),C=r(41);function M(e){return 360-w.e.normalize(e)}function P(e){return w.e.normalize(360-e)}function A(e){return Object(l.j)(e)&&e.resolver&&e.resolver.reject(),null}function E(e,t,r,i=null){if(!t)return A(i);const n=e.spatialReference||x.a.WGS84;if(Object(l.j)(t.camera)){const e=t.get("camera.position.spatialReference");if(!Object(v.a)(e,n))return A(i);const r=t.camera.clone();return e.equals(n)||(r.position=Object(v.d)(r.position,n)),function(e,t){return Object(l.j)(e)&&e.resolver&&e.resolver.resolve(t),t}(i,r)}if(Object(l.i)(t.targetGeometry))return A(i);const s=t.get("targetGeometry.spatialReference");if(s&&!Object(v.a)(s,n))return A(i);const a=Object(j.k)(e,e.state.camera);let o=1;if(null!=t.rotation&&(a.heading=M(t.rotation),o=0),null!=r&&(a.tilt=r),"point"===t.targetGeometry.type){const r=t.targetGeometry;let n;const s=t.targetGeometry.clone();return n=null!=t.scale?Object(j.l)(e,t.scale,r.latitude):e.state.camera.distance,Object(j.f)(e,s,n,a,o,i)}const c=t.targetGeometry.extent;return Object(j.h)(e,c,a.heading,a.tilt,o,i)}function R(e,t,r=null){return Object(l.i)(r)&&(r=new s.a),L(e,null,t.clone(),r)}async function I(e,t,r){const n=function(e,t){if(!t||!e.spatialReference)return null;const r={target:null};if("declaredClass"in t||Array.isArray(t))r.target=t;else{for(const e in t)r[e]=t[e];t.center&&!r.target&&(r.target=t.center)}return r}(e,t);if(!n)throw new o.a("viewpointutils-create:no-target","Missing target for creating viewpoint");const a=new i.a({fov:e.camera.fov}),c=new s.a({camera:a});if(n.target instanceof s.a)return U(await async function(e,t,r,i,n){if(Object(l.j)(t.camera))return V(e,t.camera,n);n.scale=t.scale,n.rotation=t.rotation,n.targetGeometry=Object(l.j)(t.targetGeometry)?t.targetGeometry.clone():null,n.camera=null,null!=r.heading?n.rotation=P(r.heading):null!=r.rotation&&(n.rotation=r.rotation);const s=D(e,r);null!=s&&(n.scale=s);const a=new j.a(i);return E(e,n,r.tilt,a),n.camera=await a.resolver.promise,n}(e,n.target,n,r,c));if(n.target instanceof i.a)return U(V(e,n.target,c));const d=null!=n.scale||null!=n.zoom;if(n.target instanceof S.a){const t=n.target.xmin===n.target.xmax||n.target.ymin===n.target.ymax;return U(d||t?await N(e,n,n.target.center,a,r,c):await async function(e,t,r,i,n,s){s.targetGeometry=r.clone();const a=Object(O.a)(e);Object(j.k)(e,a,i);const o=F(i,t)?0:1,l=new j.a(n);return Object(j.h)(e,r,i.heading,i.tilt,o,l),s.camera=await l.resolver.promise,s}(e,n,n.target,a,r,c))}const h={boundingBox:Object(m.k)(),hasZ:!1,screenSpaceObjects:[]},f=d?function(e,t){return Object(j.m)(e,D(e,t))}(e,n):void 0;if(await z(e,n.target,f,h),isFinite(h.boundingBox[0])){let t;if(Object(m.e)(h.boundingBox,B),J.x=B[0],J.y=B[1],J.z=B[2],J.spatialReference=e.spatialReference,isFinite(J.z)&&h.hasZ?t=Object(m.x)(h.boundingBox):(J.z=void 0,t=Object(g.w)(Object(m.F)(h.boundingBox,W))),d||t)return U(await N(e,n,J,a,r,c));const i=function(e,t){const r=.66;if(!t.length)return r;let i=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const e=t[n].screenSpaceBoundingRect;i=Math.max(i,Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2]),Math.abs(e[3]))}return r-i/Math.min(e.width,e.height)*2}(e,h.screenSpaceObjects);return U(await async function(e,t,r,i,n,s,a,o){o.targetGeometry=r.clone();const c=Object(O.a)(e),d=function(e,t,r,i,n){let s=0;r.hasZ?s=r.z:e.basemapTerrain&&(s=Object(l.s)(Object(_.b)(e.elevationProvider,r))),Object(p.y)(B,r.x,r.y,s),Object(b.d)(e.spatialReference,B,G,e.renderSpatialReference),Object(u.f)(q,G),Object(u.n)(q,q),Object(m.k)(H);const a=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let l=0;l<a.length;l++){const t=a[l];let r=i[t[2]];isFinite(r)||(r=s),Object(p.y)(B,i[t[0]],i[t[1]],r),Object(b.z)(B,e.spatialReference,B,e.renderSpatialReference),Object(m.r)(H,Object(p.z)(B,B,q))}const o=Object(m.G)(H),c=Object(m.u)(H),d=Object(m.i)(H),h=1/Math.tan(t.fovX/2),f=1/Math.tan(t.fovY/2),g=.5*Math.sqrt(o*o+d*d)*Math.max(f,h)+.5*c,y=.5*c*f+.5*Math.max(o,d);return Math.max(g,y)/n}(e,c,r,i,n);Object(j.k)(e,c,s);const h=F(s,t)?0:1;o.scale=Object(j.d)(e,d,o.targetGeometry.latitude);const f=new j.a(a);return Object(j.g)(e,o.targetGeometry,o.scale,s,h,f),o.camera=await f.resolver.promise,o}(e,n,J,h.boundingBox,i,a,r,c))}return n.position?U(function(e,t,r,i){const n=Object(O.a)(e);return Object(p.m)($,n.viewForward),Object(j.c)(e,n.eye,$,n.up,X),r.position=new C.a(t.position),r.heading=null!=t.heading?t.heading:X.heading,r.tilt=null!=t.tilt?t.tilt:X.tilt,L(e,null,r,i)}(e,n,a,c)):U(await async function(e,t,r,i,n){const s=Object(O.a)(e);return N(e,t,Object(b.y)(s.center,e.renderSpatialReference,e.spatialReference),r,i,n)}(e,n,a,r,c))}function D(e,t){return null==t.scale&&null!=t.zoom?Object(j.p)(e,t.zoom):t.scale}function F(e,t){let r=!1;return null!=t.heading?(e.heading=t.heading,r=!0):null!=t.rotation&&(e.heading=M(t.rotation),r=!0),null!=t.tilt&&(e.tilt=t.tilt,r=!0),null!=t.fov&&(e.fov=t.fov),r}function L(e,t,r,i){const n=e.spatialReference||x.a.WGS84;return t=Object(l.j)(t)?t:Object(j.e)(e,r),Object(l.i)(t)||(i.targetGeometry=Object(b.y)(t.center,e.renderSpatialReference,n),i.scale=Object(j.b)(e,t),i.rotation=P(r.heading),i.camera=r),i}function k(e,t,r){if(!t)return;if(!Object(v.a)(t.spatialReference,e.spatialReference))throw new o.a("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const i=[];if(!t.hasZ&&e.basemapTerrain){let r;switch(t.type){case"point":r=t;break;case"multipoint":case"polyline":r=t.extent.center;break;case"mesh":r=t.origin;break;case"extent":r=t.center;break;case"polygon":r=t.centroid}r&&Object(v.a)(r,e.basemapTerrain.spatialReference)?B[2]=Object(l.t)(Object(_.b)(e.elevationProvider,r),0):B[2]=0}(0,Y[t.type])(t,(e=>{i.push(e[0],e[1],e[2])}),B);const n=i.length/3;if(0===n)return;const s=new Array(i.length);if(Object(b.q)(i,t.spatialReference,0,s,e.spatialReference,0,n)){t.hasZ&&(r.hasZ=!0);for(let e=0;e<s.length;e+=3)t.hasZ?(B[0]=s[e+0],B[1]=s[e+1],B[2]=s[e+2]):(B[0]=s[e+0],B[1]=s[e+1]),Object(m.r)(r.boundingBox,B)}}async function z(e,t,r,i){if(Array.isArray(t)&&2===t.length){const r=t[0],n=t[1];if("number"==typeof r&&"number"==typeof n)return J.x=r,J.y=n,J.z=void 0,J.spatialReference=e.spatialReference.isGeographic?e.spatialReference:x.a.WGS84,void k(e,J,i)}t&&"function"==typeof t.map?await Object(c.k)(t.map((t=>z(e,t,r,i)))):t instanceof T.a?k(e,t,i):t instanceof n.a&&await async function(e,t,r,i){const n=await Object(a.d)(e.whenViewForGraphic(t));if(!1===n.ok||Object(l.i)(n.value)||!("whenGraphicBounds"in n.value))return void k(e,t.geometry,i);const s=n.value,o=await Object(a.d)(s.whenGraphicBounds(t,{minDemResolution:r}));if(!1===o.ok)return void k(e,t.geometry,i);const{screenSpaceObjects:c,boundingBox:u}=o.value;Object(m.m)(i.boundingBox,u),c&&c.forEach((e=>{i.screenSpaceObjects.push(e)})),isFinite(u[2])&&(i.hasZ=!0)}(e,t,r,i)}function V(e,t,r){const i=e.spatialReference,n=t.position.spatialReference;return Object(v.a)(n,i)?((t=t.clone()).fov=e.camera.fov,n.equals(i)||(t.position=Object(v.d)(t.position,i)),L(e,null,t,r)):null}async function N(e,t,r,i,n,s){if(Object(l.i)(r))throw new o.a("createfromcenter","invalid point");s.targetGeometry=r.clone();const a=Object(O.a)(e);if(t.position)return function(e,t,r,i,n,s){const a=e.renderSpatialReference;return Object(b.u)(r.position,Q,a),Object(b.u)(t,Z,a),s.targetGeometry=new C.a(t),n.position=new C.a(r.position),Object(p.l)($,Z,Q),Object(j.c)(e,Q,$,i.up,n),s.scale=Object(j.d)(e,Object(p.o)(Q,Z),s.targetGeometry.latitude),s.rotation=P(n.heading),s.camera=n,s}(e,s.targetGeometry,t,a,i,s);if(t.zoomFactor){const i=a.distance/t.zoomFactor,n=Object(p.g)(B,a.viewForward,-i);a.eye=Object(p.h)(B,a.center,n),s.scale=Object(j.d)(e,i,r.latitude)}Object(j.k)(e,a,i);const c=F(i,t)?0:1;if(!t.zoomFactor){s.scale=D(e,t),null==s.scale&&(Object(b.u)(r,B,e.renderSpatialReference),Object(y.h)(a.frustum,B)?s.scale=Object(j.d)(e,Object(p.o)(a.eye,B),r.latitude):s.scale=Object(j.b)(e,a));const o=new j.a(n);Object(j.g)(e,s.targetGeometry,s.scale,i,c,o),s.camera=await o.resolver.promise}return s}function U(e){return e&&Object(l.j)(e.camera)&&(e.rotation=P(e.camera.heading)),e}const B=Object(f.e)(),G=Object(h.d)(),q=Object(d.b)(),H=Object(m.h)(),W=Object(g.k)(),$=Object(f.e)(),Q=Object(f.e)(),Z=Object(f.e)(),X={heading:0,tilt:0},J=new C.a,Y={point(e,t,r){r[0]=e.x,r[1]=e.y,e.hasZ&&(r[2]=e.z),t(r)},polygon(e,t,r){const i=e.hasZ;for(let n=0;n<e.rings.length;n++){const s=e.rings[n];for(let e=0;e<s.length;e++)r[0]=s[e][0],r[1]=s[e][1],i&&(r[2]=s[e][2]),t(r)}},polyline(e,t,r){const i=e.hasZ;for(let n=0;n<e.paths.length;n++){const s=e.paths[n];for(let e=0;e<s.length;e++)r[0]=s[e][0],r[1]=s[e][1],i&&(r[2]=s[e][2]),t(r)}},multipoint(e,t,r){const i=e.points,n=e.hasZ;for(let s=0;s<i.length;s++)r[0]=i[s][0],r[1]=i[s][1],n&&(r[2]=i[s][2]),t(r)},extent(e,t,r){e.hasZ?(t(Object(p.y)(r,e.xmin,e.ymin,e.zmin)),t(Object(p.y)(r,e.xmax,e.ymin,e.zmin)),t(Object(p.y)(r,e.xmin,e.ymax,e.zmin)),t(Object(p.y)(r,e.xmax,e.ymax,e.zmin)),t(Object(p.y)(r,e.xmin,e.ymin,e.zmax)),t(Object(p.y)(r,e.xmax,e.ymin,e.zmax)),t(Object(p.y)(r,e.xmin,e.ymax,e.zmax)),t(Object(p.y)(r,e.xmax,e.ymax,e.zmax))):(t(Object(p.y)(r,e.xmin,e.ymin,r[2])),t(Object(p.y)(r,e.xmax,e.ymin,r[2])),t(Object(p.y)(r,e.xmin,e.ymax,r[2])),t(Object(p.y)(r,e.xmax,e.ymax,r[2])))},mesh(e,t,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(i)for(let n=0;n<i.length;n+=3)t(Object(p.y)(r,i[n+0],i[n+1],i[n+2]))}}},function(e,t,r){"use strict";var i,n=r(0),s=r(19),a=r(1),o=(r(8),r(9),r(7),r(4));let l=i=class extends s.a{clone(){return new i({url:this.url})}};Object(n.a)([Object(a.b)({type:String})],l.prototype,"url",void 0),l=i=Object(n.a)([Object(o.a)("esri.symbols.support.Thumbnail")],l);var c=l;t.a=c},function(e,t,r){"use strict";function i(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function n(e,t,r,n){for(let o=0;o<n;++o)s[0]=e[o],i(s,a,1),t[o]=a[0],r[o]=a[1]}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));const s=new Float64Array(1),a=new Float32Array(2)},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return u}));var i=r(10),n=r(41),s=r(53);function a(e,t,r){return function(e,t,r,n,s){const a=Object(i.g)(r),o=Object(i.g)(s),l=a-o,c=Object(i.g)(t)-Object(i.g)(n),u=Math.sin(l/2),d=Math.sin(c/2),h=2*Object(i.c)(Math.sqrt(u*u+Math.cos(a)*Math.cos(o)*d*d))*e;return Math.round(1e4*h)/1e4}(e,t.longitude,t.latitude,r.longitude,r.latitude)}function o(e,t,r){const i=t.spatialReference,o=Object(s.e)(i),l=new n.a(t.x,e.y,i),c=new n.a(r.x,e.y,i),u=new n.a(e.x,t.y,i),d=new n.a(e.x,r.y,i);return{lon:a(o.radius,l,c),lat:a(o.radius,u,d)}}function l(e,t,r){const n=t/r,s=Object(i.g)(e),a=Math.sin(n/2),o=Math.cos(s),l=2*Object(i.c)(Math.sqrt(a*a/(o*o)));return Object(i.r)(l)}function c(e,t){let r=e/15;return t||(r=Math.round(r)),r}function u(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=c(e[0],!0);const r=t.hours%1;t.hours-=r,t.minutes=60*r;const i=t.minutes%1;return t.minutes-=i,t.seconds=Math.round(60*i),t}},function(e,t,r){"use strict";function i(e){return"point"===e.type}r.d(t,"a",(function(){return i}))},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(13),o=r(1),l=r(9),c=(r(8),r(7),r(4)),u=r(29);let d=i=class extends s.a{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new i(Object(a.a)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};Object(n.a)([Object(o.b)({type:[String],json:{write:!0}})],d.prototype,"attachmentTypes",void 0),Object(n.a)([Object(o.b)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],d.prototype,"attachmentsWhere",void 0),Object(n.a)([Object(o.b)({type:[String],json:{write:!0}})],d.prototype,"keywords",void 0),Object(n.a)([Object(o.b)({type:[Number],json:{write:!0}})],d.prototype,"globalIds",void 0),Object(n.a)([Object(o.b)({json:{write:!0}})],d.prototype,"name",void 0),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],d.prototype,"num",void 0),Object(n.a)([Object(o.b)({type:[Number],json:{write:!0}})],d.prototype,"objectIds",void 0),Object(n.a)([Object(o.b)({type:Boolean,json:{default:!1,write:!0}})],d.prototype,"returnMetadata",void 0),Object(n.a)([Object(o.b)({type:[Number],json:{write:!0}})],d.prototype,"size",void 0),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"resultOffset"}}})],d.prototype,"start",void 0),Object(n.a)([Object(u.a)("start"),Object(u.a)("num")],d.prototype,"writeStart",null),Object(n.a)([Object(o.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],d.prototype,"where",void 0),d=i=Object(n.a)([Object(c.a)("esri.rest.support.AttachmentQuery")],d),d.from=Object(l.m)(d);var h=d;t.a=h},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(373);function n(e,t,r){if(!r||!r.features||!r.hasZ)return;const n=Object(i.a)(r.geometryType,t,e.outSpatialReference);if(n)for(const i of r.features)n(i.geometry)}},function(e,t,r){"use strict";var i,n=r(0),s=(r(8),r(14)),a=r(1),o=r(9),l=(r(7),r(32)),c=r(4),u=r(29),d=r(115),h=r(259);const p=new WeakMap;let f=0,b=i=class extends s.a{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,i){if(e instanceof HTMLImageElement){const n={type:"image-element",src:Object(d.e)(e.src,i),crossOrigin:e.crossOrigin};t[r]=n}else if(e instanceof HTMLCanvasElement){const i=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this.encodeImageData(i)};t[r]=n}else if(e instanceof HTMLVideoElement){const n={type:"video-element",src:Object(d.e)(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=n}else{const i={type:"image-data",imageData:this.encodeImageData(e)};t[r]=i}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this.decodeImageData(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return this.decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this.imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this.imageDataContainsTransparent(e);if(t){const e=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(".png"===e||"data:image/png;"===r)return!0}return!1}set transparent(e){null!=e?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(t="")=>`d:${t},t:${this.transparent},w:${e}`;return null!=this.url?t(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(p.has(this.data)||p.set(this.data,++f),t(p.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this.cloneWrap()};return new i(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}encodeImageData(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}decodeImageData(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return Object(h.f)(r,e.width,e.height)}imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}static from(e){return"string"==typeof e?new i({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new i({data:e}):Object(o.d)(i,e)}};Object(n.a)([Object(a.b)({type:String,json:{write:d.f}})],b.prototype,"url",null),Object(n.a)([Object(a.b)({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),Object(a.b)()],b.prototype,"data",null),Object(n.a)([Object(u.a)("data")],b.prototype,"writeData",null),Object(n.a)([Object(l.a)("data")],b.prototype,"readData",null),Object(n.a)([Object(a.b)({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null),Object(n.a)([Object(a.b)({json:{write:!0}})],b.prototype,"wrap",void 0),Object(n.a)([Object(a.b)({readOnly:!0})],b.prototype,"contentHash",null),b=i=Object(n.a)([Object(c.a)("esri.geometry.support.MeshTexture")],b);var m=b;t.a=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return F}));var i=r(7),n=r(2),s=r(17),a=r(18),o=r(3),l=r(5),c=r(112),u=r(26),d=r(21),h=r(136),p=r(184),f=r(103),b=r(33),m=r(137),g=r(231),y=r(88),v=r(123),O=r(0),j=r(61),_=r(96),w=r(92),x=r(77),S=r(82),T=r(15),C=r(62),M=r(74),P=r(97),A=r(612),E=r(30);class R extends S.a{constructor(e,t,r){super(e,t,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=R.shader.get(),r=this.configuration,i=t.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:r.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:r.stippleIntegerRepeatsEnabled});return new M.a(e.rctx,i,C.a)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(w.c)(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.configuration.stippleEnabled){const e=Object(n.j)(this.stippleTextureBind)?this.stippleTextureBind(this.program)*t.camera.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const t=Object(n.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}4===this.configuration.output&&Object(_.b)(this.program,t)}bindDraw(e){Object(w.d)(this.program,e),Object(j.c)(this.program,this.configuration,e),this.program.rebindTextures()}initializePipeline(){const e=this.configuration,t=Object(E.h)(770,1,771,771),r=(t,r=null,i=null)=>Object(E.g)({blending:r,depthTest:P.b,depthWrite:i,colorWrite:E.d,stencilWrite:e.sceneHasOcludees?P.j:null,stencilTest:e.sceneHasOcludees?t?P.f:P.e:null});return 0===e.output?(this._occludeePipelineState=r(!0,e.transparent||e.stippleEnabled?t:null,E.e),r(!1,e.transparent||e.stippleEnabled?t:null,E.e)):r(!1)}get primitiveType(){return 1}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}R.shader=new x.a(A.a,(()=>r.e(195).then(r.bind(null,1053))));class I extends T.a{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.sceneHasOcludees=!1}}Object(O.a)([Object(T.b)({count:8})],I.prototype,"output",void 0),Object(O.a)([Object(T.b)()],I.prototype,"slicePlaneEnabled",void 0),Object(O.a)([Object(T.b)()],I.prototype,"vertexColors",void 0),Object(O.a)([Object(T.b)()],I.prototype,"transparent",void 0),Object(O.a)([Object(T.b)()],I.prototype,"stippleEnabled",void 0),Object(O.a)([Object(T.b)()],I.prototype,"stippleOffColorEnabled",void 0),Object(O.a)([Object(T.b)()],I.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(O.a)([Object(T.b)()],I.prototype,"sceneHasOcludees",void 0);const D=i.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");class F extends f.a{constructor(e){super(e,z),this.techniqueConfig=new I}getTechniqueConfig(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;const t=Object(n.j)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(n.j)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,r,i,n,s,a,o,l){l?Object(y.h)(e,i,s,1,a):this.intersectLineGeometry(e,t,r,i,a)}intersectLineGeometry(e,t,r,i,n){if(!i.options.selectionMode||Object(v.e)(t))return;if(!Object(b.g)(r))return void D.error("intersection assumes a translation-only matrix");const s=e.vertexAttributes.get("position").data,l=i.camera,d=Z;Object(a.c)(d,i.point);Object(o.y)(X[0],d[0]-2,d[1]+2,0),Object(o.y)(X[1],d[0]+2,d[1]+2,0),Object(o.y)(X[2],d[0]+2,d[1]-2,0),Object(o.y)(X[3],d[0]-2,d[1]-2,0);for(let a=0;a<4;a++)if(!l.unprojectFromRenderScreen(X[a],J[a]))return;Object(u.g)(l.eye,J[0],J[1],Y),Object(u.g)(l.eye,J[1],J[2],K),Object(u.g)(l.eye,J[2],J[3],ee),Object(u.g)(l.eye,J[3],J[0],te);let h=Number.MAX_VALUE;for(let a=0;a<s.length-5;a+=3){if(V[0]=s[a]+r[12],V[1]=s[a+1]+r[13],V[2]=s[a+2]+r[14],N[0]=s[a+3]+r[12],N[1]=s[a+4]+r[13],N[2]=s[a+5]+r[14],Object(u.w)(Y,V)<0&&Object(u.w)(Y,N)<0||Object(u.w)(K,V)<0&&Object(u.w)(K,N)<0||Object(u.w)(ee,V)<0&&Object(u.w)(ee,N)<0||Object(u.w)(te,V)<0&&Object(u.w)(te,N)<0)continue;if(l.projectToRenderScreen(V,G),l.projectToRenderScreen(N,q),G[2]<0&&q[2]>0){Object(o.l)(U,V,N);const e=l.frustum,t=-Object(u.w)(e[4],V)/Object(o.j)(U,Object(u.s)(e[4]));Object(o.g)(U,U,t),Object(o.h)(V,V,U),l.projectToRenderScreen(V,G)}else if(G[2]>0&&q[2]<0){Object(o.l)(U,N,V);const e=l.frustum,t=-Object(u.w)(e[4],N)/Object(o.j)(U,Object(u.s)(e[4]));Object(o.g)(U,U,t),Object(o.h)(N,N,U),l.projectToRenderScreen(N,q)}else if(G[2]<0&&q[2]<0)continue;G[2]=0,q[2]=0;const e=Object(c.d)(Object(c.e)(G,q,$),d);e<h&&(h=e,Object(o.m)(H,V),Object(o.m)(W,N))}const p=i.rayBeginPoint,f=i.rayEndPoint;if(h<4){let e=Number.MAX_VALUE;if(Object(c.a)(Object(c.e)(H,W,$),Object(c.e)(p,f,Q),B)){Object(o.l)(B,B,p);const t=Object(o.r)(B);Object(o.g)(B,B,1/t),e=t/Object(o.o)(p,f)}n(e,B)}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return!1;const i=r.get("position");return Object(h.a)(i,null,!1,t)}createBufferWriter(){const e=this.params.vertexColors?g.b:g.c;return Object(n.i)(this.params.stipplePattern)?new g.a(e):new k(e.clone().vec3f("auxpos1"))}getGLMaterial(e){return 0===e.output||4===e.output?new L(e):void 0}}class L extends p.a{constructor(e){super(e),this.updateParameters()}updateParameters(){this._technique=this._techniqueRep.releaseAndAcquire(R,this._material.getTechniqueConfig(this._output),this._technique)}beginSlot(e){return 3===e}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}ensureParameters(e){0===this._output&&this._updateOccludeeState(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}class k{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){Object(m.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i),this.writeAuxpos1(e,t,r,i)}writeAuxpos1(e,t,r,i){const n=r.getField("auxpos1",d.u),s=t.indices.get("position"),a=t.vertexAttributes.get("position").data,o=e.transformation,l=n.typedBufferStride,c=n.typedBuffer;i*=l;for(let u=0;u<s.length;u+=2){const e=3*s[u],t=a[e],r=a[e+1],n=a[e+2],d=o[0]*t+o[4]*r+o[8]*n+o[12],h=o[1]*t+o[5]*r+o[9]*n+o[13],p=o[2]*t+o[6]*r+o[10]*n+o[14];for(let s=0;s<2;++s)c[i]=d,c[i+1]=h,c[i+2]=p,i+=l}}}const z={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1,...f.b},V=Object(l.e)(),N=Object(l.e)(),U=Object(l.e)(),B=Object(l.e)(),G=Object(s.d)(),q=Object(s.d)(),H=Object(l.e)(),W=Object(l.e)(),$=Object(c.c)(),Q=Object(c.c)(),Z=Object(l.e)(),X=[Object(s.d)(),Object(s.d)(),Object(s.d)(),Object(s.d)()],J=[Object(l.e)(),Object(l.e)(),Object(l.e)(),Object(l.e)()],Y=Object(u.d)(),K=Object(u.d)(),ee=Object(u.d)(),te=Object(u.d)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return l}));var i=r(99),n=r(498);function s(e,t){var r;if(!t.write||t.write.writer||!1===t.write.enabled&&!t.write.overridePolicy)return;const s=null!=(r=null==e?void 0:e.ndimArray)?r:0;var o;e&&(1===s||"type"in e&&Object(n.a)(e.type))?t.write.writer=c:t.write.writer=s>1?(o=s,function(e,t,r,n){let s;if(null===e)s=null;else{s=u(e,n,o);let t=o,r=s;for(;t>0&&Array.isArray(r);)t--,r=r[0];if(void 0!==r)for(let e=0;e<t;e++)s=[s]}Object(i.c)(r,s,t)}):a}function a(e,t,r,n){Object(i.c)(r,o(e,n),t)}function o(e,t){return e&&"function"==typeof e.write?e.write({},t):e&&"function"==typeof e.toJSON?e.toJSON():"number"==typeof e?l(e):e}function l(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function c(e,t,r,n){let s;null===e?s=null:e&&"function"==typeof e.map?(s=e.map((e=>o(e,n))),"function"==typeof s.toArray&&(s=s.toArray())):s=[o(e,n)],Object(i.c)(r,s,t)}function u(e,t,r){return 0!==r&&Array.isArray(e)?e.map((e=>u(e,t,r-1))):o(e,t)}},function(e,t,r){"use strict";var i,n=r(0),s=r(19),a=r(1),o=(r(8),r(9),r(7),r(4)),l=r(118);let c=i=class extends s.a{constructor(){super(...arguments),this.portal=null}clone(){return new i({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};Object(n.a)([Object(a.b)({type:String})],c.prototype,"name",void 0),Object(n.a)([Object(a.b)({type:String})],c.prototype,"styleUrl",void 0),Object(n.a)([Object(a.b)({type:String})],c.prototype,"styleName",void 0),Object(n.a)([Object(a.b)({type:l.a})],c.prototype,"portal",void 0),c=i=Object(n.a)([Object(o.a)("esri.symbols.support.StyleOrigin")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(337),o=r(1),l=(r(8),r(9),r(7),r(4)),c=r(286);let u=i=class extends s.a{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return Object(a.a)(this.value,this.unit,"milliseconds")}clone(){return new i({value:this.value,unit:this.unit})}};Object(n.a)([Object(o.b)({type:Number,json:{write:!0},nonNullable:!0})],u.prototype,"value",void 0),Object(n.a)([Object(o.b)({type:c.a.apiValues,json:{type:c.a.jsonValues,read:c.a.read,write:c.a.write},nonNullable:!0})],u.prototype,"unit",void 0),u=i=Object(n.a)([Object(l.a)("esri.TimeInterval")],u);var d=u;t.a=d},function(e,t,r){"use strict";var i=r(109);t.a=class{constructor(e,t){this._context=e,this._desc=t,this._context.instanceCounter.increment(i.b.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,t.internalFormat,t.width,t.height)}get descriptor(){return this._desc}resize(e,t){const r=this._desc;if(r.width===e&&r.height===t)return;r.width=e,r.height=t;const i=this._context.gl;this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(i.b.Renderbuffer,this),this._context=null)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i=2.1},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(4));let l=i=class extends s.a{constructor(){super(...arguments),this.title=null}clone(){return new i({title:this.title})}};Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=i=Object(n.a)([Object(o.a)("esri.renderers.support.LegendOptions")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return ce})),r.d(t,"b",(function(){return he})),r.d(t,"c",(function(){return ue}));var i=r(11),n=r(8),s=r(12),a=r(180),o=r(7),l=r(110),c=r(155),u=r(2);const d={statsWorker:()=>r.e(140).then(r.bind(null,977)),geometryEngineWorker:()=>Promise.all([r.e(4),r.e(82)]).then(r.bind(null,978)),CSVSourceWorker:()=>Promise.all([r.e(1),r.e(2),r.e(59)]).then(r.bind(null,1180)),EdgeProcessingWorker:()=>Promise.resolve().then(r.bind(null,673)),ElevationSamplerWorker:()=>r.e(58).then(r.bind(null,979)),FeatureServiceSnappingSourceWorker:()=>Promise.all([r.e(1),r.e(2),r.e(74)]).then(r.bind(null,1165)),GeoJSONSourceWorker:()=>Promise.all([r.e(1),r.e(2),r.e(51)]).then(r.bind(null,980)),LercWorker:()=>r.e(91).then(r.bind(null,981)),MemorySourceWorker:()=>Promise.all([r.e(1),r.e(2),r.e(50)]).then(r.bind(null,982)),PBFDecoderWorker:()=>r.e(177).then(r.bind(null,1181)),Pipeline:()=>Promise.all([r.e(1),r.e(2),r.e(36)]).then(r.bind(null,1154)),PointCloudWorker:()=>r.e(57).then(r.bind(null,983)),RasterWorker:()=>Promise.all([r.e(9),r.e(163)]).then(r.bind(null,984)),SceneLayerWorker:()=>r.e(174).then(r.bind(null,787)),WFSSourceWorker:()=>Promise.all([r.e(1),r.e(2),r.e(45)]).then(r.bind(null,985)),WorkerTileHandler:()=>Promise.all([r.e(12),r.e(20),r.e(170)]).then(r.bind(null,1157))};var h,p;(p=h||(h={}))[p.HANDSHAKE=0]="HANDSHAKE",p[p.OPEN=1]="OPEN",p[p.OPENED=2]="OPENED",p[p.RESPONSE=3]="RESPONSE",p[p.INVOKE=4]="INVOKE",p[p.ABORT=5]="ABORT",p[p.CLOSE=6]="CLOSE",p[p.OPEN_PORT=7]="OPEN_PORT",p[p.ON=8]="ON";let f=0;function b(){return f++}function m(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function g(e,t,r,i){if(t.type===h.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==h.INVOKE&&t.type!==h.RESPONSE)return void e.postMessage(t);let n;!function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(r)?(n=v(i),t.data=r):(n=v(r.transferList),t.data=r.result),n?e.postMessage(t,n):e.postMessage(t)}function y(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function v(e){if(!e||!e.length)return null;if(Object(n.a)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}(e)));return t.length?t:null}var O=r(290);const{CLOSE:j,ABORT:_,INVOKE:w,RESPONSE:x,OPEN_PORT:S,ON:T}=h;class C{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===h.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class M{constructor(e,t){this._port=e,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new C((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(e){const t=new MessageChannel;let r;r="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const i=new M(t.port1,{channel:t,client:r});return"object"==typeof r&&"remoteClient"in r&&(r.remoteClient=i),M.clients.set(i,r),t.port2}static loadWorker(e){const t=d[e];return t?t():Promise.resolve(null)}close(){this._post({type:j}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,r){const n=r&&r.signal,a=r&&r.transferList;if(!this._port)return Promise.reject(new i.a("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const o=b();return new Promise(((r,i)=>{const l=Object(s.t)(n,(()=>{var e;const t=this._outJobs.get(o);t&&(this._outJobs.delete(o),null==(e=t.abortHandle)||e.remove(),this._post({type:_,jobId:o}),i(Object(s.f)()))})),c={resolve:r,reject:i,abortHandle:l,debugInfo:e};this._outJobs.set(o,c),this._post({type:w,jobId:o,methodName:e,abortable:null!=n},t,a)}))}on(e,t){const r=new MessageChannel;function i(e){t(e.data)}return this._port.postMessage({type:h.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",i),r.port1.start(),{remove(){r.port1.postMessage({type:h.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",i)}}}openPort(){const e=new MessageChannel;return this._post({type:S,port:e.port2}),e.port1}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{var t;null==(t=e.abortHandle)||t.remove(),e.reject(Object(s.f)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){Object(u.j)(this._schedule)?this._schedule((()=>this._processMessage(e))):this._processMessage(e)}_processMessage(e){const t=y(e);if(t)switch(t.type){case x:this._onResponseMessage(t);break;case w:this._invokeQueue.push(t);break;case _:this._onAbortMessage(t);break;case j:this._onCloseMessage();break;case S:this._onOpenPortMessage(t);break;case T:this._onOnMessage(t)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,i=t.get(r);this._invokeQueue.push(e),i&&(i.controller&&i.controller.abort(),t.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&M.clients.get(this)===e&&e.destroy(),M.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:r,data:i,abortable:n}=e,a=n?Object(s.e)():null,o=this._inJobs;let l,c=this._client,u=c[t];try{if(!u&&t&&-1!==t.indexOf(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)c=c[e[t]],u=c[e[t+1]]}if("function"!=typeof u)throw new TypeError(`${t} is not a function`);l=u.call(c,i,{client:this,signal:a?a.signal:null})}catch(d){return void this._post({type:x,jobId:r,error:m(d)})}Object(s.q)(l)?(o.set(r,{controller:a,promise:l}),l.then((e=>{o.has(r)&&(o.delete(r),this._post({type:x,jobId:r},e))}),(e=>{o.has(r)&&(o.delete(r),Object(s.n)(e)||this._post({type:x,jobId:r,error:m(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:x,jobId:r},l)}_onOpenPortMessage(e){new M(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,r=this._client.on(e.eventType,(e=>{t.postMessage(e)})),i=Object(c.c)(e.port,"message",(e=>{y(e).type===h.CLOSE&&(i.remove(),r.remove(),t.close())}))}_onResponseMessage(e){var t;const{jobId:r,error:n,data:s}=e,a=this._outJobs;if(!a.has(r))return;const o=a.get(r);a.delete(r),null==(t=o.abortHandle)||t.remove(),n?o.reject(i.a.fromJSON(JSON.parse(n))):o.resolve(s)}_post(e,t,r){return g(this._port,e,t,r)}}M.kernelInfo={revision:O.b,version:l.d,buildDate:O.a},M.clients=new Map;var P=M;const A=o.a.getLogger("esri.core.workers.Connection");var E=class{constructor(){this._clients=new Array,this._clientPromises=new Array,this._clientIdx=0}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,t){return new Promise(((r,i)=>{let n=!0;const a=e=>{Object(s.x)(t.signal),n&&(n=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length;for(let o=0;o<e.length;++o){const n=e[o];Object(s.q)(n)?this._clientPromises[o]=n.then((e=>(this._clients[o]=new P(e,t),a(r),this._clients[o])),(()=>(a(i),null))):(this._clients[o]=new P(n,t),this._clientPromises[o]=Promise.resolve(this._clients[o]),a(r))}}))}broadcast(e,t,r){const i=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const s=this._clientPromises[n];i[n]=s.then((i=>i.invoke(e,t,r)))}return i}close(){for(const e of this._clientPromises)e.then((e=>e.close()));this._clients.length=0,this._clientPromises.length=0}getAvailableClient(){let e;for(let t=0;t<this._clients.length;++t){const r=this._clients[t];if(r){if(!r.isBusy())return Promise.resolve(r)}else e=e||[],e.push(this._clientPromises[t])}return e?Promise.race(e):(this._clientIdx=(this._clientIdx+1)%this._clients.length,Promise.resolve(this._clients[this._clientIdx]))}invoke(e,t,r){let i=null;return Array.isArray(r)?(A.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),i={transferList:r}):i=r,this.closed?Promise.reject(new Error("Connection closed")):this.getAvailableClient().then((r=>r.invoke(e,t,i)))}on(e,t){return Promise.all(this._clientPromises).then((()=>Object(a.a)(this._clients.map((r=>r.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let r=t.length;for(let i=0;i<this._clientPromises.length;++i)this._clientPromises[i].then((n=>{t[i]=n.openPort(),0==--r&&e(t)}))}))}get test(){return{numClients:this._clients.length}}},R=r(79),I=r(114),D=(r(340),r(25));const F={};var L=function(e){var t;const r={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(r.async=!0),e.hasOwnProperty("isDebug")||(r.isDebug=!1),e.baseUrl||(r.baseUrl=F.baseUrl),null==(t=F.packages)||t.forEach((e=>{!function(e,t){for(const r of e)if(r.name===t.name)return;e.push(t)}(r.packages,e)})),r},k=r(56);class z{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...r)=>e[t](...r)}))}}const V=k.a.MutationObserver||k.a.WebKitMutationObserver,N=function(){let e;if(k.a.process&&k.a.process.nextTick)e=e=>{k.a.process.nextTick(e)};else if(k.a.Promise)e=e=>{k.a.Promise.resolve().then(e)};else if(V){const t=[],r=document.createElement("div");new V((()=>{for(;t.length>0;)t.shift()()})).observe(r,{attributes:!0}),e=e=>{t.push(e),r.setAttribute("queueStatus","1")}}return e}(),U=(()=>{const e=k.a.MessageEvent;try{new e("message",{data:null})}catch{return(e,t={})=>{const{data:r,bubbles:i=!1,cancelable:n=!1}=t,s=document.createEvent("Event");return s.initEvent(e,i,n),s.data=r,s}}return(t,r)=>new e(t,r)})();var B=class{constructor(){this._dispatcher=new z,this._workerPostMessage({type:h.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){N((()=>{this._workerMessageHandler(U("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,r){this._dispatcher.addEventListener(e,t,r)}removeEventListener(e,t,r){this._dispatcher.removeEventListener(e,t,r)}_workerPostMessage(e){N((()=>{this.dispatchEvent(U("message",{data:e}))}))}async _workerMessageHandler(e){const t=y(e);if(t&&t.type===h.OPEN){const{modulePath:e,jobId:r}=t;let i=await P.loadWorker(e);i||(i=await import(e));const n=P.connect(i);this._workerPostMessage({type:h.OPENED,jobId:r,data:n})}}},G=r(125);const q=o.a.getLogger("esri.core.workers"),{HANDSHAKE:H}=h;let W,$;const Q="Failed to create Worker. Fallback to execute module in main thread";async function Z(){if(!Object(n.a)("esri-workers"))return X(new B);if(!W&&!$)try{const e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.replace('"{CONFIGURATION}"',`'${function(){let e;if(null!=I.a.default){const t={...I.a};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(I.a));e.assetsPath=Object(D.A)(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=Object(G.b)(),e.has={"csp-restrictions":Object(n.a)("csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":Object(n.a)("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":Object(n.a)("esri-2d-query-centroid-enabled"),"featurelayer-pbf":Object(n.a)("featurelayer-pbf"),"esri-atomics":Object(n.a)("esri-atomics"),"esri-shared-array-buffer":Object(n.a)("esri-shared-array-buffer"),"esri-tiles-debug":Object(n.a)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":Object(n.a)("esri-workers-arraybuffer-transfer"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=Object(D.A)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=Object(D.A)(e.workers.workerPath):e.workers.workerPath=Object(D.A)(Object(R.b)("esri/core/workers/RemoteClient.js"));const t=I.a.workers.loaderConfig,r=L({baseUrl:null==t?void 0:t.baseUrl,locale:Object(G.b)(),has:{"csp-restrictions":Object(n.a)("csp-restrictions"),"dojo-test-sniff":0,"host-webworker":1,...null==t?void 0:t.has},map:{...null==t?void 0:t.map},paths:{...null==t?void 0:t.paths},packages:(null==t?void 0:t.packages)||[]}),i={version:l.d,buildDate:O.a,revision:O.b};return JSON.stringify({esriConfig:e,loaderConfig:r,kernelInfo:i})}()}'`);W=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(t){$=t||{}}let e;if(W)try{e=new Worker(W,{name:"esri-worker-"+J++})}catch(t){q.warn(Q,$),e=new B}else q.warn(Q,$),e=new B;return X(e)}async function X(e){return new Promise((t=>{function r(n){const s=y(n);s&&s.type===H&&(e.removeEventListener("message",r),e.removeEventListener("error",i),t(e))}function i(t){t.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",i),q.warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new B).addEventListener("message",r),e.addEventListener("error",i)}e.addEventListener("message",r),e.addEventListener("error",i)}))}let J=0;const Y=o.a.getLogger("esri.core.workers"),{ABORT:K,INVOKE:ee,OPEN:te,OPENED:re,RESPONSE:ie}=h;class ne{constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),Y.error(e)}))}static async create(e){const t=await Z();return new ne(t,e)}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:r}=t,i=b();return new Promise(((t,n)=>{const a={resolve:t,reject:n,abortHandle:Object(s.t)(r,(()=>{this._outJobs.delete(i),this._post({type:K,jobId:i})}))};this._outJobs.set(i,a),this._post({type:te,jobId:i,modulePath:e})}))}_onMessage(e){const t=y(e);if(t)switch(t.type){case re:this._onOpenedMessage(t);break;case ie:this._onResponseMessage(t);break;case K:this._onAbortMessage(t);break;case ee:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,i=t.get(r);i&&(i.controller&&i.controller.abort(),t.delete(r))}_onInvokeMessage(e){const{methodName:t,jobId:r,data:i,abortable:n}=e,a=n?Object(s.e)():null,o=this._inJobs,c=l.e[t];let u;try{if("function"!=typeof c)throw new TypeError(`${t} is not a function`);u=c.call(null,i,{signal:a?a.signal:null})}catch(d){return void this._post({type:ie,jobId:r,error:m(d)})}Object(s.q)(u)?(o.set(r,{controller:a,promise:u}),u.then((e=>{o.has(r)&&(o.delete(r),this._post({type:ie,jobId:r},e))}),(e=>{o.has(r)&&(o.delete(r),e||(e={message:"Error encountered at method"+t}),Object(s.n)(e)||this._post({type:ie,jobId:r,error:m(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:ie,jobId:r},u)}_onOpenedMessage(e){var t;const{jobId:r,data:i}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),null==(t=n.abortHandle)||t.remove(),n.resolve(i))}_onResponseMessage(e){var t;const{jobId:r,error:n,data:s}=e,a=this._outJobs.get(r);a&&(this._outJobs.delete(r),null==(t=a.abortHandle)||t.remove(),n?a.reject(i.a.fromJSON(JSON.parse(n))):a.resolve(s))}_post(e,t,r){return g(this.worker,e,t,r)}}var se=ne;let ae=Object(n.a)("esri-workers-debug")?1:Object(n.a)("host-browser")?navigator.hardwareConcurrency-1:0;ae||(ae=Object(n.a)("safari")&&Object(n.a)("mac")||Object(n.a)("trident")?7:2);let oe=0;const le=[];function ce(){be()}function ue(e,t){return de(e,{client:t})}async function de(e,t){const r=new E;return await r.open(e,t),r}async function he(e,t={}){if("string"!=typeof e)throw new i.a("workers:undefined-module","modulePath is missing");let r=t.strategy||"distributed";if(Object(n.a)("host-webworker")&&!Object(n.a)("esri-workers")&&(r="local"),"local"===r){let r=await P.loadWorker(e);r||(r=await import(e)),Object(s.x)(t.signal);const i=t.client||r;return de([P.connect(r)],{...t,client:i})}if(await be(),Object(s.x)(t.signal),"dedicated"===r){const r=oe++%ae;return de([await le[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,ae);if(r<ae){const i=new Array(r);for(let n=0;n<r;++n){const r=oe++%ae;i[n]=le[r].open(e,t)}return de(i,t)}}return de(le.map((r=>r.open(e,t))),t)}let pe,fe=null;async function be(){if(fe)return fe;pe=Object(s.e)();const e=[];for(let t=0;t<ae;t++){const r=se.create(t).then((e=>(le[t]=e,e)));e.push(r)}return fe=Promise.all(e),fe}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=r(4);let s=0;const a=e=>{let t=class extends e{constructor(...e){super(...e),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+s++})}};return t=Object(i.a)([Object(n.a)("esri.core.Identifiable")],t),t};let o=class extends(a(class{})){};o=Object(i.a)([Object(n.a)("esri.core.Identifiable")],o)},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l}));var i=r(102),n=r(38),s=r(159),a=r(2);async function o(e,t){return await e.load(),l(e,t)}async function l(e,t){const r=[],o=(...e)=>{for(const t of e)Object(a.i)(t)||(Array.isArray(t)?o(...t):n.a.isCollection(t)?t.forEach((e=>o(e))):s.a.isLoadable(t)&&r.push(t))};t(o);let l=null;if(await Object(i.c)(r,(async e=>{!1!==(await Object(i.d)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load())).ok||l||(l=e)})),l)throw l.loadError;return e}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return l}));var i=r(2),n=r(54),s=r(43);function a(e,t,r){if(Object(i.i)(t)||Object(i.i)(r)||r.vcsWkid||Object(s.c)(t,r))return null;const a=Object(n.g)(t)/Object(n.g)(r);if(1===a)return null;switch(e){case"point":case"esriGeometryPoint":return e=>function(e,t){e&&null!=e.z&&(e.z*=t)}(e,a);case"polyline":case"esriGeometryPolyline":return e=>function(e,t){if(e)for(const r of e.paths)for(const e of r)e.length>2&&(e[2]*=t)}(e,a);case"polygon":case"esriGeometryPolygon":return e=>function(e,t){if(e)for(const r of e.rings)for(const e of r)e.length>2&&(e[2]*=t)}(e,a);case"multipoint":case"esriGeometryMultipoint":return e=>function(e,t){if(e)for(const r of e.points)r.length>2&&(r[2]*=t)}(e,a);default:return null}}function o(e,t,r){if(null==e.hasM||e.hasZ)for(const i of t)for(const e of i)e.length>2&&(e[2]*=r)}function l(e,t,r){if(!e&&!t||!r)return;const i=Object(n.g)(r);c(e,r,i),c(t,r,i)}function c(e,t,r){if(e)for(const i of e)u(i.geometry,t,r)}function u(e,t,r){if(!e||!e.spatialReference||Object(s.c)(e.spatialReference,t))return;const i=Object(n.g)(e.spatialReference)/r;if(1!==i)if("x"in e)null!=e.z&&(e.z*=i);else if("rings"in e)o(e,e.rings,i);else if("paths"in e)o(e,e.paths,i);else if("points"in e&&(null==e.hasM||e.hasZ))for(const n of e.points)n.length>2&&(n[2]*=i)}},function(e,t,r){"use strict";var i,n=r(0),s=r(86),a=r(44),o=r(14),l=r(13),c=r(1),u=(r(9),r(8),r(7),r(32)),d=r(4),h=r(29),p=r(239);let f=i=class extends o.a{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?Object(p.a)(t.value):e}writeExpression(e,t,r){null!=this.value&&(e=Object(p.a)(this.value)),t[r]=e}clone(){return new i({expression:this.expression,title:this.title,value:this.value})}};Object(n.a)([Object(c.b)({type:String,json:{write:{allowNull:!0}}})],f.prototype,"expression",void 0),Object(n.a)([Object(u.a)("expression",["expression","value"])],f.prototype,"readExpression",null),Object(n.a)([Object(h.a)("expression")],f.prototype,"writeExpression",null),Object(n.a)([Object(c.b)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],f.prototype,"title",void 0),Object(n.a)([Object(c.b)({json:{read:!1,write:!1}})],f.prototype,"value",void 0),f=i=Object(n.a)([Object(d.a)("esri.layers.support.LabelExpressionInfo")],f);var b,m=f,g=r(601),y=r(174);const v=new a.a({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function O(e){return!e||"service"!==e.origin&&!j(e.layer)}function j(e){return"map-image"===(null==e?void 0:e.type)}function _(e){var t,r;return!!j(e)&&!(null==(t=e.capabilities)||null==(r=t.exportMap)||!r.supportsArcadeExpressionForLabeling)}let w=b=class extends o.a{constructor(e){super(e),this.type="label",this.name=null,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.maxScale=0,this.minScale=0,this.symbol=g.d,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;const i=e.split(" ");if(3===i.length)return r(t[i[0]],i[1],i[2]);if(7===i.length){const e=r(t[i[0]],i[1],i[2]),n=i[3],s=r(t[i[4]],i[5],i[6]);switch(n){case"AND":return e&&s;case"OR":return e||s}}return!1}catch(i){console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}writeLabelExpression(e,t,r){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)e=Object(p.f)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const t=Object(p.e)(this.labelExpressionInfo.expression);t&&(e="["+t+"]")}null!=e&&(t[r]=e)}writeLabelExpressionInfo(e,t,r,i){if(null==e&&null!=this.labelExpression&&O(i))e=new m({expression:this.getLabelExpressionArcade()});else if(!e)return;const n=e.toJSON(i);n.expression&&(t[r]=n)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return Object(p.b)(this)}getLabelExpressionArcade(){return Object(p.c)(this)}getLabelExpressionSingleField(){return Object(p.d)(this)}hash(){return JSON.stringify(this)}clone(){return new b({deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Object(l.a)(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:Object(l.a)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};Object(n.a)([Object(c.b)({type:String,json:{write:!0}})],w.prototype,"name",void 0),Object(n.a)([Object(c.b)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],w.prototype,"deconflictionStrategy",void 0),Object(n.a)([Object(c.b)({type:String,json:{write:{overridePolicy(e,t,r){return this.labelExpressionInfo&&"service"===(null==r?void 0:r.origin)&&_(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],w.prototype,"labelExpression",void 0),Object(n.a)([Object(u.a)("labelExpression")],w.prototype,"readLabelExpression",null),Object(n.a)([Object(h.a)("labelExpression")],w.prototype,"writeLabelExpression",null),Object(n.a)([Object(c.b)({type:m,json:{write:{overridePolicy:(e,t,r)=>function(e){return O(e)||_(e.layer)}(r)?{allowNull:!0}:{enabled:!1}}}})],w.prototype,"labelExpressionInfo",void 0),Object(n.a)([Object(h.a)("labelExpressionInfo")],w.prototype,"writeLabelExpressionInfo",null),Object(n.a)([Object(c.b)({type:v.apiValues,json:{type:v.jsonValues,read:v.read,write:v.write}})],w.prototype,"labelPlacement",void 0),Object(n.a)([Object(c.b)({type:Number})],w.prototype,"maxScale",void 0),Object(n.a)([Object(h.a)("maxScale")],w.prototype,"writeMaxScale",null),Object(n.a)([Object(c.b)({type:Number})],w.prototype,"minScale",void 0),Object(n.a)([Object(h.a)("minScale")],w.prototype,"writeMinScale",null),Object(n.a)([Object(c.b)({types:s.g,json:{origins:{"web-scene":{types:s.h,write:y.b,default:null}},write:y.b,default:null}})],w.prototype,"symbol",void 0),Object(n.a)([Object(c.b)({type:Boolean,json:{write:!0}})],w.prototype,"useCodedValues",void 0),Object(n.a)([Object(c.b)({type:String,json:{write:!0}})],w.prototype,"where",void 0),w=b=Object(n.a)([Object(d.a)("esri.layers.support.LabelClass")],w);var x=w;t.a=x},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i=new(r(44).a)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},function(e,t,r){"use strict";function i(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u)i[l]=s[c],i[l+1]=s[c+1],i[l+2]=s[c+2],l+=n,c+=a}function n(e,t,r,i,n){var s,a;const o=e.typedBuffer,l=e.typedBufferStride,c=null!=(s=null==n?void 0:n.count)?s:e.count;let u=(null!=(a=null==n?void 0:n.dstIndex)?a:0)*l;for(let d=0;d<c;++d)o[u]=t,o[u+1]=r,o[u+2]=i,u+=l}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));Object.freeze({__proto__:null,copy:i,fill:n})},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(1),a=(r(8),r(9),r(7),r(4));let o=class extends n.a{constructor(){super(...arguments),this.type=null}};Object(i.a)([Object(s.b)({type:["selection","cluster"],readOnly:!0,json:{read:!1,write:!0}})],o.prototype,"type",void 0),o=Object(i.a)([Object(a.a)("esri.layers.support.FeatureReduction")],o);var l=o;t.a=l},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){const t=i.a`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=i.a`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return v})),r.d(t,"d",(function(){return O}));var i=r(18),n=r(27),s=r(31),a=r(61),o=r(378),l=r(310),c=r(641),u=r(96),d=r(186),h=r(95),p=r(167),f=r(183),b=r(315),m=r(6),g=r(73);function y(e){const t=new g.a,r=e.signedDistanceFieldEnabled;if(t.include(o.a),t.include(l.a,e),t.include(a.a,e),6===e.output)return t.include(c.a,e),t;t.include(b.a),t.fragment.include(f.a),t.fragment.include(p.a),t.include(d.a,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),r&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(m.a`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?m.a`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:m.a`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const i=m.a`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,n=e.pixelSnappingEnabled?r?m.a`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:m.a`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:m.a`posProj += quadOffset;`;t.vertex.code.add(m.a`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${i}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${m.a.float(h.c)};
      ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${m.a.float(h.c)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${n}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?m.a`} else { vtc = vec2(0.0);
        ${e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),r&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const s=e.debugDrawBorder?m.a`(isBorder > 0.0 ? 0.0 : ${m.a.float(h.b)})`:m.a.float(h.b),y=m.a`
    ${e.debugDrawBorder?m.a`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?m.a`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${s} ||
          fillPixelColor.a + outlinePixelColor.a < ${m.a.float(h.c)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${s}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:m.a`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${s}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${e.debugDrawBorder?m.a`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;return 7===e.output&&t.fragment.code.add(m.a`
      void main() {
        ${y}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),0===e.output&&t.fragment.code.add(m.a`
    void main() {
      ${y}
      ${e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),4===e.output&&(t.include(u.a),t.fragment.code.add(m.a`
    void main() {
      ${y}
      ${e.binaryHighlightOcclusionEnabled?m.a`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function v(e,t,r){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",s.b),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*r,2*t.screenOffset[1]*r),e.setUniform2fv("anchorPos",O(t))}function O(e,t=j){return e.textureIsSignedDistanceField?function(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):Object(i.c)(t,e.anchorPos),t}const j=Object(n.b)();var _=Object.freeze({__proto__:null,build:y,bindHUDMaterialUniforms:v,calculateAnchorPosForRendering:O})},function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return S})),r.d(t,"e",(function(){return x})),r.d(t,"f",(function(){return v})),r.d(t,"g",(function(){return _})),r.d(t,"h",(function(){return j})),r.d(t,"i",(function(){return w}));var i=r(7),n=r(2),s=r(52),a=r(83),o=r(20),l=r(3),c=r(5),u=r(36),d=r(53),h=r(43),p=r(46),f=r(21),b=r(168);const m=i.a.getLogger("esri.geometry.support.meshUtils.normalProjection");function g(e,t,r,i,n){return C(i)?(T(0,f.u.fromTypedArray(e),f.v.fromTypedArray(t),f.v.fromTypedArray(r),i,f.u.fromTypedArray(n)),n):(m.error("Cannot convert spatial reference to PCPF"),n)}function y(e,t,r,i,n){return C(i)?(T(1,f.u.fromTypedArray(e),f.v.fromTypedArray(t),f.v.fromTypedArray(r),i,f.u.fromTypedArray(n)),n):(m.error("Cannot convert to spatial reference from PCPF"),n)}function v(e,t,r){return Object(u.q)(e,t,0,r,Object(d.g)(t),0,e.length/3),r}function O(e,t,r){return Object(u.q)(e,Object(d.g)(r),0,t,r,0,e.length/3),t}function j(e,t,r){if(Object(n.i)(e))return t;const i=f.v.fromTypedArray(e),s=f.v.fromTypedArray(t);return Object(b.e)(s,i,r),t}function _(e,t,r){if(Object(n.i)(e))return t;Object(s.a)(R,r);const i=f.u.fromTypedArray(e),a=f.u.fromTypedArray(t);return Object(b.a)(a,i,R),Object(s.i)(R)||Object(b.c)(a,a),t}function w(e,t,r){if(Object(n.i)(e))return t;Object(s.a)(R,r);const i=f.u.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),a=f.u.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(Object(b.a)(a,i,R),Object(s.i)(R)||Object(b.c)(a,a),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function x(e,t,r,i,n){if(!C(i))return m.error("Cannot convert spatial reference to PCPF"),n;T(0,f.u.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),f.v.fromTypedArray(t),f.v.fromTypedArray(r),i,f.u.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<e.length;s+=4)n[s]=e[s];return n}function S(e,t,r,i,n){if(!C(i))return m.error("Cannot convert to spatial reference from PCPF"),n;T(1,f.u.fromTypedArray(e,16),f.v.fromTypedArray(t),f.v.fromTypedArray(r),i,f.u.fromTypedArray(n,16));for(let s=3;s<e.length;s+=4)n[s]=e[s];return n}function T(e,t,r,i,n,a){if(!t)return;const o=r.count,c=Object(d.g)(n);if(M(n))for(let d=0;d<o;d++)i.getVec(d,P),t.getVec(d,A),Object(u.d)(c,P,E,c),Object(s.f)(R,E),1===e&&Object(s.n)(R,R),Object(l.z)(A,A,R),a.setVec(d,A);else for(let d=0;d<o;d++){i.getVec(d,P),t.getVec(d,A),Object(u.d)(c,P,E,c),Object(s.f)(R,E);const n=Object(p.h)(r.get(d,1));let o=Math.cos(n);0===e&&(o=1/o),R[0]*=o,R[1]*=o,R[2]*=o,R[3]*=o,R[4]*=o,R[5]*=o,1===e&&Object(s.n)(R,R),Object(l.z)(A,A,R),Object(l.t)(A,A),a.setVec(d,A)}return a}function C(e){return M(e)||function(e){return e.isWebMercator}(e)}function M(e){return e.isWGS84||Object(h.e)(e)||Object(h.h)(e)||Object(h.i)(e)}const P=Object(c.e)(),A=Object(c.e)(),E=Object(o.d)(),R=Object(a.b)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(i.a`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return o}));var i=r(35),n=(r(8),r(2)),s=r(17),a=r(31);function o(e){return e&&e.enabled&&(function(e){return"extrude"===e.type}(e)||function(e){return"fill"===e.type}(e))&&Object(n.j)(e.edges)}function l(e,t){return c(function(e){return e&&e.enabled&&e.edges||null}(e),t)}function c(e,t){if(Object(n.i)(e))return null;const r=Object(n.j)(e.color)?Object(a.d)(i.a.toUnitRGBA(e.color)):Object(a.g)(0,0,0,0),o=Object(s.g)(e.size),l=Object(s.g)(e.extensionLength);switch(e.type){case"solid":return u({color:r,size:o,extensionLength:l,...t});case"sketch":return c={color:r,size:o,extensionLength:l,...t},{...h,...c,type:"sketch"};default:return}var c}function u(e){return{...d,...e,type:"solid"}}const d={color:Object(a.g)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},h={color:Object(a.g)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i,n=r(5),s=r(216),a=r(6),o=r(357);function l(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.vertex.include(s.a,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));const r=[a.a`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,a.a`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?a.a`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,a.a`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,a.a`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,t.vertexTangents?a.a`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:a.a``];e.vertex.code.add(r[0]),e.vertex.code.add(r[1]),e.vertex.code.add(r[2]),2===t.output&&e.vertex.code.add(r[3]),e.vertex.code.add(r[4])}(i=l||(l={})).Uniforms=class{},i.bindCustomOrigin=function(e,t){Object(o.b)(t,c,u,3),e.setUniform3fv("viewOriginHi",c),e.setUniform3fv("viewOriginLo",u)};const c=Object(n.e)(),u=Object(n.e)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));r(8);var i=r(2),n=r(109),s=r(145),a=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o=r(228),l=999,c=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function u(){var e,t,r,i=0,n=0,s=l,a=[],u=[],d=1,h=0,p=0,f=!1,b=!1,m="";return function(e){return u=[],null!==e?y(e.replace?e.replace(/\r\n/g,"\n"):e):(a.length&&g(a.join("")),s=10,g("(eof)"),u)};function g(e){e.length&&u.push({type:c[s],data:e,position:p,line:d,column:h})}function y(o){var c;for(i=0,r=(m+=o).length;e=m[i],i<r;){switch(c=i,s){case 0:i="/"===e&&"*"===t?(a.push(e),g(a.join("")),s=l,i+1):(a.push(e),t=e,i+1);break;case 1:case 2:i=v();break;case 3:i=O();break;case 4:i="."===e||/[eE]/.test(e)?(a.push(e),s=5,t=e,i+1):"x"===e&&1===a.length&&"0"===a[0]?(s=11,a.push(e),t=e,i+1):/[^\d]/.test(e)?(g(a.join("")),s=l,i):(a.push(e),t=e,i+1);break;case 11:i=/[^a-fA-F0-9]/.test(e)?(g(a.join("")),s=l,i):(a.push(e),t=e,i+1);break;case 5:"f"===e&&(a.push(e),t=e,i+=1),i=/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(a.push(e),t=e,i+1):/[^\d]/.test(e)?(g(a.join("")),s=l,i):(a.push(e),t=e,i+1);break;case 9999:i=_();break;case 9:i=/[^\s]/g.test(e)?(g(a.join("")),s=l,i):(a.push(e),t=e,i+1);break;case l:a=a.length?[]:a,i="/"===t&&"*"===e?(p=n+i-1,s=0,t=e,i+1):"/"===t&&"/"===e?(p=n+i-1,s=1,t=e,i+1):"#"===e?(s=2,p=n+i,i):/\s/.test(e)?(s=9,p=n+i,i):(f=/\d/.test(e),b=/[^\w_]/.test(e),p=n+i,s=f?4:b?3:9999,i)}if(c!==i)switch(m[c]){case"\n":h=0,++d;break;default:++h}}return n+=i,m=m.slice(i),u}function v(){return"\r"!==e&&"\n"!==e||"\\"===t?(a.push(e),t=e,i+1):(g(a.join("")),s=l,i)}function O(){if("."===t&&/\d/.test(e))return s=5,i;if("/"===t&&"*"===e)return s=0,i;if("/"===t&&"/"===e)return s=1,i;if("."===e&&a.length){for(;j(a););return s=5,i}if(";"===e||")"===e||"("===e){if(a.length)for(;j(a););return g(e),s=l,i+1}var r=2===a.length&&"="!==e;if(/[\w_\d\s]/.test(e)||r){for(;j(a););return s=l,i}return a.push(e),t=e,i+1}function j(e){for(var t,r,i=0;;){if(t=o.c.indexOf(e.slice(0,e.length+i).join("")),r=o.c[t],-1===t){if(i--+e.length>0)continue;r=e.slice(0,1).join("")}return g(r),p+=r.length,(a=a.slice(r.length)).length}}function _(){if(/[^\d\w_]/.test(e)){var r=a.join("");return s=o.b.indexOf(r)>-1?8:o.a.indexOf(r)>-1?7:6,g(a.join("")),s=l,i}return a.push(e),t=e,i+1}}function d(e){return function(e){var t=u(),r=[];return(r=r.concat(t(e))).concat(t(null))}(e)}const h=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function p(e,t){for(let r=t-1;r>=0;r--){const t=e[r];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function f(e,t,r,i){i=i||r;for(const n of e)if("ident"===n.type&&n.data===r)return i in t?t[i]++:t[i]=0,f(e,t,i+"_"+t[i],i);return r}function b(e,t,r="afterVersion"){function i(e,t){for(let r=t;r<e.length;r++){const t=e[r];if("operator"===t.type&&";"===t.data)return r}return null}const n={data:"\n",type:"whitespace"},s=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let a=function(e){let t=-1,n=0,s=-1;for(let a=0;a<e.length;a++){const o=e[a];if("preprocessor"===o.type&&(o.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++n:o.data.match(/\#endif\s*.*/)&&--n),"afterVersion"!==r&&"afterPrecision"!==r||"preprocessor"===o.type&&/^#version/.test(o.data)&&(s=Math.max(s,a)),"afterPrecision"===r&&"keyword"===o.type&&"precision"===o.data){const t=i(e,a);if(null===t)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,t)}t<s&&0===n&&(t=a)}return t+1}(e);s(a-1)&&e.splice(a++,0,n);for(const o of t)e.splice(a++,0,o);s(a-1)&&s(a)&&e.splice(a,0,n)}function m(e,t,r,i="lowp"){b(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function g(e,t,r,i,n="lowp"){b(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function y(e,t){let r,i,n=-1;for(let s=t;s<e.length;s++){const t=e[s];if("operator"===t.type&&("["===t.data&&(r=s),"]"===t.data)){i=s;break}"integer"===t.type&&(n=parseInt(t.data,10))}return r&&i&&e.splice(r,i-r+1),n}function v(e,t){const r=d(e);if("300 es"===function(e,t="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of e)if("preprocessor"===n.type){const e=i.exec(n.data);if(e){const i=e[1].replace(/\s\s+/g," ");if(i===r)return i;if(i===t)return n.data="#version "+r,t;throw new Error("unknown glsl version: "+i)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:"\n"}),null}(r,"100","300 es"))throw new Error("shader is already glsl 300 es");let i=null,n=null;const s={},o={};for(let l=0;l<r.length;++l){const e=r[l];switch(e.type){case"keyword":35633===t&&"attribute"===e.data?e.data="in":"varying"===e.data&&(e.data=35633===t?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(e.data.trim())&&(e.data=e.data.replace(/(2D|Cube|EXT)/g,"")),35632===t&&"gl_FragColor"===e.data&&(i||(i=f(r,s,"fragColor"),m(r,i,"vec4")),e.data=i),35632===t&&"gl_FragData"===e.data){const t=y(r,l+1),i=f(r,s,"fragData");g(r,i,"vec4",t,"mediump"),e.data=i}else 35632===t&&"gl_FragDepthEXT"===e.data&&(n||(n=f(r,s,"gl_FragDepth")),e.data=n);break;case"ident":if(a.indexOf(e.data)>=0){if(35633===t&&p(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");e.data in o||(o[e.data]=f(r,s,e.data)),e.data=o[e.data]}}}for(let a=r.length-1;a>=0;--a){const e=r[a];if("preprocessor"===e.type){const t=e.data.match(/\#extension\s+(.*)\:/);if(t&&t[1]&&h.indexOf(t[1].trim())>=0){const e=r[a+1];r.splice(a,e&&"whitespace"===e.type?2:1)}const i=e.data.match(/\#ifdef\s+(.*)/);i&&i[1]&&h.indexOf(i[1].trim())>=0&&(e.data="#if 1");const n=e.data.match(/\#ifndef\s+(.*)/);n&&n[1]&&h.indexOf(n[1].trim())>=0&&(e.data="#if 0")}}return r.map((e=>"eof"!==e.type?e.data:"")).join("")}class O{constructor(e,t,r,i){this._context=e,this._locations=i,this._vShader=null,this._fShader=null,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),this._vShader=_(this._context,35633,t),this._fShader=_(this._context,35632,r),this._vShader&&this._fShader||console.error("Error loading shaders!");const a=this._context.gl,o=a.createProgram();a.attachShader(o,this._vShader),a.attachShader(o,this._fShader),i.forEach(((e,t)=>a.bindAttribLocation(o,e,t))),a.linkProgram(o),Object(s.c)()&&!a.getProgramParameter(o,a.LINK_STATUS)&&console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(o,a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(o)),this._glName=o,this._context.instanceCounter.increment(n.b.Program,this)}get glName(){return this._glName}dispose(){const e=this._context.gl;if(this._vShader){const t=this._vShader;e.deleteShader(t),this._vShader=null}if(this._fShader){const t=this._fShader;e.deleteShader(t),this._fShader=null}this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(n.b.Program,this))}_getUniformLocation(e){return void 0===this._nameToUniformLocation[e]&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this._glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return null!==this._getUniformLocation(e)}setUniform1i(e,t){const r=this._nameToUniform1[e];void 0!==r&&t===r||(this._context.useProgram(this),this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1iv(e,t){const r=this._nameToUniform1v[e];j(r,t)&&(this._context.useProgram(this),this._context.gl.uniform1iv(this._getUniformLocation(e),t),void 0===r?this._nameToUniform1v[e]=Array.from(t):w(t,r))}setUniform2iv(e,t){const r=this._nameToUniform2[e];j(r,t)&&(this._context.useProgram(this),this._context.gl.uniform2iv(this._getUniformLocation(e),t),void 0===r?this._nameToUniform2[e]=Array.from(t):w(t,r))}setUniform3iv(e,t){const r=this._nameToUniform3[e];j(r,t)&&(this._context.useProgram(this),this._context.gl.uniform3iv(this._getUniformLocation(e),t),void 0===r?this._nameToUniform3[e]=Array.from(t):w(t,r))}setUniform4iv(e,t){const r=this._nameToUniform4[e];j(r,t)&&(this._context.useProgram(this),this._context.gl.uniform4iv(this._getUniformLocation(e),t),void 0===r?this._nameToUniform4[e]=Array.from(t):w(t,r))}setUniform1f(e,t){const r=this._nameToUniform1[e];void 0!==r&&t===r||(this._context.useProgram(this),this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1fv(e,t){const r=this._nameToUniform1v[e];j(r,t)&&(this._context.useProgram(this),this._context.gl.uniform1fv(this._getUniformLocation(e),t),void 0===r?this._nameToUniform1v[e]=Array.from(t):w(t,r))}setUniform2f(e,t,r){const i=this._nameToUniform2[e];void 0!==i&&t===i[0]&&r===i[1]||(this._context.useProgram(this),this._context.gl.uniform2f(this._getUniformLocation(e),t,r),void 0===i?this._nameToUniform2[e]=[t,r]:(i[0]=t,i[1]=r))}setUniform2fv(e,t){const r=this._nameToUniform2[e];j(r,t)&&(this._context.useProgram(this),this._context.gl.uniform2fv(this._getUniformLocation(e),t),void 0===r?this._nameToUniform2[e]=Array.from(t):w(t,r))}setUniform3f(e,t,r,i){const n=this._nameToUniform3[e];void 0!==n&&t===n[0]&&r===n[1]&&i===n[2]||(this._context.useProgram(this),this._context.gl.uniform3f(this._getUniformLocation(e),t,r,i),void 0===n?this._nameToUniform3[e]=[t,r,i]:(n[0]=t,n[1]=r,n[2]=i))}setUniform3fv(e,t){const r=this._nameToUniform3[e];j(r,t)&&(this._context.useProgram(this),this._context.gl.uniform3fv(this._getUniformLocation(e),t),void 0===r?this._nameToUniform3[e]=Array.from(t):w(t,r))}setUniform4f(e,t,r,i,n){const s=this._nameToUniform4[e];void 0!==s&&t===s[0]&&r===s[1]&&i===s[2]&&n===s[3]||(this._context.useProgram(this),this._context.gl.uniform4f(this._getUniformLocation(e),t,r,i,n),void 0===s?this._nameToUniform4[e]=[t,r,i,n]:(s[0]=t,s[1]=r,s[2]=i,s[3]=n))}setUniform4fv(e,t){const r=this._nameToUniform4[e];j(r,t)&&(this._context.useProgram(this),this._context.gl.uniform4fv(this._getUniformLocation(e),t),void 0===r?this._nameToUniform4[e]=Array.from(t):w(t,r))}setUniformMatrix3fv(e,t,r=!1){const n=this._nameToUniformMatrix3[e];(function(e,t){return!!Object(i.i)(e)||(9!==e.length?j(e,t):9!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8])})(n,t)&&(this._context.useProgram(this),this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),r,t),void 0===n?this._nameToUniformMatrix3[e]=Array.from(t):w(t,n))}setUniformMatrix4fv(e,t,r=!1){const n=this._nameToUniformMatrix4[e];(function(e,t){return!!Object(i.i)(e)||(16!==e.length?j(e,t):16!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8]||e[9]!==t[9]||e[10]!==t[10]||e[11]!==t[11]||e[12]!==t[12]||e[13]!==t[13]||e[14]!==t[14]||e[15]!==t[15])})(n,t)&&(this._context.useProgram(this),this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),r,t),void 0===n?this._nameToUniformMatrix4[e]=Array.from(t):w(t,n))}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){}}function j(e,t){if(Object(i.i)(e)||e.length!==t.length)return!0;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!0;return!1}function _(e,t,r){const i="webgl2"===e.webglVersion?v(r,t):r,n=e.gl,a=n.createShader(t);return n.shaderSource(a,i),n.compileShader(a),Object(s.c)()&&!n.getShaderParameter(a,n.COMPILE_STATUS)&&(console.error("Compile error in ".concat(35633===t?"vertex":"fragment"," shader")),console.error(n.getShaderInfoLog(a)),console.error(function(e){let t=2;return e.replace(/\n/g,(()=>"\n"+function(e){return e>=1e3?e.toString():("  "+e).slice(-3)}(t++)+":"))}(i)),"webgl2"===e.webglVersion&&(console.log("Shader source before transpilation:"),console.log(r))),a}function w(e,t){for(let r=0;r<e.length;++r)t[r]=e[r]}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e){this._notify=e,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const e=this._invalidCount;if(1===e)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}onObservableAccessed(e){this._accessed.includes(e)||this._accessed.push(e)}onTrackingEnd(){const e=this._handles,t=this._accessed;for(let r=0;r<t.length;++r)e.push(t[r].observe(this));t.length=0}clear(){const e=this._handles;for(let t=0;t<e.length;++t)e[t].remove();e.length=0}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return p}));var i=r(87),n=r(11),s=r(7),a=r(150),o=r(101),l=r(287);const c=s.a.getLogger("esri.core.accessorSupport.write");function u(e,t,r,i,n){var s,a;const o={};return null==(s=t.write)||null==(a=s.writer)||a.call(e,i,o,r,n),o}function d(e,t,r,s,o,l){if(!s||!s.write)return!1;const u=e.get(r);if(!o&&s.write.overridePolicy){const t=s.write.overridePolicy.call(e,u,r,l);void 0!==t&&(o=t)}if(o||(o=s.write),!o||!1===o.enabled)return!1;if((null===u&&!o.allowNull||void 0===u)&&o.isRequired){const t=new n.a("web-document-write:property-required",`Missing value for required property '${r}' on '${e.declaredClass}'`,{propertyName:r,target:e});return t&&l&&l.messages?l.messages.push(t):t&&!l&&c.error(t.name,t.message),!1}return void 0!==u&&(!(null===u&&!o.allowNull)&&(!function(e,t,r,n,s){const a=n.default;if(void 0===a)return!1;if(null!=n.defaultEquals)return n.defaultEquals(s);if("function"==typeof a){if(Array.isArray(s)){const n=a.call(e,t,r);return Object(i.e)(n,s)}return!1}return a===s}(e,r,l,s,u)&&(void 0!==s.default||!(!o.ignoreOrigin&&l&&l.origin&&t.store.originOf(r)<Object(a.d)(l.origin)))))}function h(e,t,r,i){const n=Object(o.a)(e),s=n.metadatas,a=Object(l.d)(s[t],i);return!!a&&d(e,n,t,a,r,i)}function p(e,t,r){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return Object(o.c)(t,e.toJSON());const i=Object(o.a)(e),n=i.metadatas;for(const h in n){const p=Object(l.d)(n[h],r);if(!d(e,i,h,p,void 0,r))continue;const f=e.get(h),b=u(e,p,p.write&&"string"==typeof p.write.target?p.write.target:h,f,r);var s,c;Object.keys(b).length>0&&(t=Object(o.c)(t,b),null!=r&&null!=(s=r.resources)&&null!=(c=s.pendingOperations)&&c.length&&Promise.all(r.resources.pendingOperations).then((()=>Object(o.c)(t,b))),r&&r.writtenProperties&&r.writtenProperties.push({target:e,propName:h,oldOrigin:Object(a.c)(i.store.originOf(h)),newOrigin:r.origin}))}return t}},function(e,t,r){"use strict";var i=r(0),n=r(1),s=(r(8),r(9),r(7),r(4)),a=r(152),o=r(121);let l=class extends o.a{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};Object(i.a)([Object(n.b)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":a.a}},json:{default:null,write:!0}})],l.prototype,"outline",void 0),Object(i.a)([Object(n.b)({type:["simple-fill","picture-fill"],readOnly:!0})],l.prototype,"type",void 0),l=Object(i.a)([Object(s.a)("esri.symbols.FillSymbol")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"b",(function(){return p}));var i,n=r(0),s=r(44),a=r(14),o=r(1),l=(r(8),r(9),r(7),r(37)),c=r(4),u=r(115);const d=Object(s.b)()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let h=i=class extends a.a{clone(){return new i({href:this.href,primitive:this.primitive})}};Object(n.a)([Object(o.b)({type:String,json:{read:u.d,write:u.f}})],h.prototype,"href",void 0),Object(n.a)([Object(l.a)(d)],h.prototype,"primitive",void 0),h=i=Object(n.a)([Object(c.a)("esri.symbols.support.ObjectSymbol3DLayerResource")],h);const p="sphere";var f=h;t.a=f},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(4)),l=r(116);let c=i=class extends s.a{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new i({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};Object(n.a)([Object(a.b)(l.b)],c.prototype,"screenLength",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0,default:0}})],c.prototype,"minWorldLength",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],c.prototype,"maxWorldLength",void 0),c=i=Object(n.a)([Object(o.a)("esri.symbols.support.Symbol3DVerticalOffset")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i=r(0),n=r(17),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(121);let l=class extends o.a{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};Object(i.a)([Object(s.b)({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],l.prototype,"angle",void 0),Object(i.a)([Object(s.b)({type:["simple-marker","picture-marker"],readOnly:!0})],l.prototype,"type",void 0),Object(i.a)([Object(s.b)({type:Number,cast:n.j,json:{write:!0}})],l.prototype,"xoffset",void 0),Object(i.a)([Object(s.b)({type:Number,cast:n.j,json:{write:!0}})],l.prototype,"yoffset",void 0),Object(i.a)([Object(s.b)({type:Number,cast:e=>"auto"===e?e:Object(n.j)(e),json:{write:!0}})],l.prototype,"size",void 0),l=Object(i.a)([Object(a.a)("esri.symbols.MarkerSymbol")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.vertex.code.add(i.a`const float PI = 3.141592653589793;`),e.fragment.code.add(i.a`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(6),n=r(318);function s(e,t){const r=e.vertex;switch(e.include(n.a,t),e.attributes.add("sideness","vec2"),2===t.mode?r.code.add(i.a`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(i.a`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case 2:r.code.add(i.a`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case 1:r.code.add(i.a`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case 0:r.code.add(i.a`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`)}}},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(1),a=(r(8),r(9),r(7),r(4));let o=class extends n.a{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};Object(i.a)([Object(s.b)({type:String,json:{write:!0}})],o.prototype,"altText",void 0),Object(i.a)([Object(s.b)({type:String,json:{write:!0}})],o.prototype,"caption",void 0),Object(i.a)([Object(s.b)({type:String,json:{write:!0}})],o.prototype,"title",void 0),Object(i.a)([Object(s.b)({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],o.prototype,"type",void 0),o=Object(i.a)([Object(a.a)("esri.popup.content.mixins.MediaInfo")],o);var l=o;t.a=l},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(1),a=(r(8),r(9),r(7),r(4));let o=class extends n.a{constructor(e){super(e),this.type=null}};Object(i.a)([Object(s.b)({readOnly:!0,json:{read:!1,write:!0}})],o.prototype,"type",void 0),o=Object(i.a)([Object(a.a)("esri.rest.support.ColorRamp")],o);var l=o;t.a=l},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(12);class n{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=0,this._loadError=null,this._loader=null,this.logger=null}get loadStatus(){return this._loadStatus}load(e,t){return 1===this._loadStatus?(e&&e(),this._loader):2===this._loadStatus?(t&&t(this._loadError),this._loader):(this._loader||(this._abortController=Object(i.e)(),this._loader=this.doLoad(this._abortController.signal).then((()=>{this._abortController=null,this._loadStatus=1}),(e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=2,!Object(i.n)(e)&&this.logger&&e.message&&this.logger.warn(e.message),e}))),this._loader.then(e,t).catch((()=>{})),this._loader)}abortLoad(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2),this._loader=null}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var i=r(270),n=r(224),s=r(515);function a(e){const t=o(e.rings,e.hasZ,1),r=[];let n=0,a=0;for(const s of t.polygons){const e=s.count,o=s.index,l=new Float64Array(t.position.buffer,3*o*t.position.BYTES_PER_ELEMENT,3*e),c=s.holeIndices.map((e=>e-o)),u=new Uint32Array(Object(i.a)(l,c,3));r.push({position:l,faces:u}),n+=l.length,a+=u.length}const l=function(e,t,r){if(1===e.length)return e[0];const i=new Float64Array(t),n=new Uint32Array(r);let s=0,a=0,o=0;for(const l of e){for(let e=0;e<l.position.length;e++)i[s++]=l.position[e];for(let e=0;e<l.faces.length;e++)n[a++]=l.faces[e]+o;o=s/3}return{position:i,faces:n}}(r,n,a),c=Object(s.a)(l.position.buffer,6,{originalIndices:l.faces});return l.position=new Float64Array(c.buffer),l.faces=c.indices,l}function o(e,t,r){const i=e.length,n=new Array(i),s=new Array(i),a=new Array(i);let o=0,u=0,d=0,h=0;for(let l=0;l<i;++l)h+=e[l].length;const p=new Float64Array(3*h);let f=0;for(let b=i-1;b>=0;b--){const h=e[b],m=1===r&&c(h);if(m&&1!==i)n[o++]=h;else{let e=h.length;for(let t=0;t<o;++t)e+=n[t].length;const r={index:f,pathLengths:new Array(o+1),count:e,holeIndices:new Array(o)};r.pathLengths[0]=h.length,h.length>0&&(a[d++]={index:f,count:h.length}),f=m?l(h,h.length-1,-1,p,f,h.length,t):l(h,0,1,p,f,h.length,t);for(let i=0;i<o;++i){const e=n[i];r.holeIndices[i]=f,r.pathLengths[i+1]=e.length,e.length>0&&(a[d++]={index:f,count:e.length}),f=l(e,0,1,p,f,e.length,t)}o=0,r.count>0&&(s[u++]=r)}}for(let c=0;c<o;++c){const e=n[c];e.length>0&&(a[d++]={index:f,count:e.length}),f=l(e,0,1,p,f,e.length,t)}return u<i&&(s.length=u),d<i&&(a.length=d),{position:p,polygons:s,outlines:a}}function l(e,t,r,i,n,s,a){n*=3;for(let o=0;o<s;++o){const s=e[t];i[n++]=s[0],i[n++]=s[1],i[n++]=a?s[2]:0,t+=r}return n/3}function c(e){return!Object(n.e)(e,!1,!1)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var i=r(59);class n{constructor(){this.adds=new i.a,this.removes=new i.a,this.updates=new i.a({allocator:e=>e||new s,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class s{}class a{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(235),n=r(525),s=r(6);function a(e,t){e.include(i.a,t),e.fragment.code.add(s.a`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),1===t.attributeTextureCoordinates&&e.fragment.code.add(s.a`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return texture2D(tex, params.uv);
}`),2===t.attributeTextureCoordinates&&(e.include(n.a),e.fragment.code.add(s.a`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
}`))}},function(e,t,r){"use strict";function i(e,t){const r=e.count;t||(t=new e.TypedArrayConstructor(r));for(let i=0;i<r;i++)t[i]=e.get(i);return t}r.d(t,"a",(function(){return i}));Object.freeze({__proto__:null,copy:function(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u)i[l]=s[c],l+=n,c+=a},makeDense:i})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var i=r(25),n=r(115);function s(e,t){return function(e){return e&&("service"===e.origin||"portal-item"===e.origin)&&e.layer&&("feature"===e.layer.type||"stream"===e.layer.type)}(t)&&!Object(i.s)(e)&&t.layer.parsedUrl?Object(i.z)(t.layer.parsedUrl.path,"images",e):Object(n.a)(e,t)}const a={json:{read:{source:["imageData","url"],reader:function(e,t,r){return t.imageData?Object(i.B)({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):s(t.url,r)}},write:{writer(e,t,r,s){!function(e,t,r,s){if(Object(i.u)(e)){const a=Object(i.i)(e);t.contentType=a.mediaType,t.imageData=a.data,r&&r.imageData===t.imageData&&r.url&&Object(n.f)(r.url,t,"url",s)}else Object(n.f)(e,t,"url",s)}(e,t,this.source,s)}}}},o={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const i={};return t.imageData&&(i.imageData=t.imageData),t.contentType&&(i.contentType=t.contentType),t.url&&(i.url=s(t.url,r)),i}}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return a}));var i=r(180);const n=Symbol("widget"),s=new WeakMap;function a(e,t){const r=t.vnodeSelector;if(u(r)){const i=t.properties||{},n=i.key||r;return{vnodeSelector:"div",properties:{parentWidget:e,widgetConstructor:r,key:n,widgetProps:{...i,key:n},afterCreate:o,afterUpdate:l,afterRemoved:c},children:void 0,text:void 0,domNode:null}}const i=t.children;if(i)for(let n=0;n<i.length;++n)i[n]=a(e,i[n]);return t}function o(e,t,r,{parentWidget:n,widgetConstructor:a,widgetProps:o}){const l=new a({...o,container:e});s.set(e,l),null==l.afterCreate||l.afterCreate(l,e),n._internalHandles.add(Object(i.b)((()=>c(e))))}function l(e,t,r,{widgetProps:i}){const n=s.get(e);n&&(n.set(i),null==n.afterUpdate||n.afterUpdate(n,e))}function c(e){const t=s.get(e);t&&(t.destroy(),s.delete(e))}function u(e){return"function"==typeof e&&e[n]}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var i=r(56);function n(e){return e=e||i.a.location.hostname,u.some((t=>{var r;return null!=(null==(r=e)?void 0:r.match(t))}))}function s(e,t){return e&&(t=t||i.a.location.hostname)?null!=t.match(a)||null!=t.match(l)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(o)||null!=t.match(c)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const a=/^devext.arcgis.com$/,o=/^qaext.arcgis.com$/,l=/^[\w-]*\.mapsdevext.arcgis.com$/,c=/^[\w-]*\.mapsqa.arcgis.com$/,u=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,o,/^jsapps.esri.com$/,l,c]},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i=r(7).a.getLogger("esri.views.3d.support.buffer.math")},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return h}));var i=r(0),n=r(609),s=r(77),a=r(82),o=r(15),l=r(62),c=r(74),u=r(30);class d extends a.a{initializeProgram(e){const t=d.shader.get().build();return new c.a(e.rctx,t,l.a)}initializePipeline(){return this.configuration.hasAlpha?Object(u.g)({blending:Object(u.h)(770,1,771,771),colorWrite:u.d}):Object(u.g)({colorWrite:u.d})}}d.shader=new s.a(n.a,(()=>r.e(183).then(r.bind(null,692))));class h extends o.a{constructor(){super(...arguments),this.hasAlpha=!1}}Object(i.a)([Object(o.b)()],h.prototype,"hasAlpha",void 0)},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return m}));var i=r(464),n=r(3),s=r(5),a=r(129),o=r(158);class l{updateSettings(e){this.settings=e,this.edgeHashFunction=e.reducedPrecision?p:h}write(e,t,r){const i=this.edgeHashFunction(r);y.seed=i;const n=y.getIntRange(0,255),s=y.getIntRange(0,this.settings.variants-1),a=y.getFloat(),o=255*(.5*function(e,t){const r=e<0?-1:1;return Math.abs(e)**t*r}(-(1-Math.min(a/.7,1))+Math.max(0,a-.7)/(1-.7),1.2)+.5);e.position0.setVec(t,r.position0),e.position1.setVec(t,r.position1),e.componentIndex.set(t,r.componentIndex),e.variantOffset.set(t,n),e.variantStroke.set(t,s),e.variantExtension.set(t,o)}trim(e,t){return e.slice(0,t)}}const c=new Float32Array(6),u=new Uint32Array(c.buffer),d=new Uint32Array(1);function h(e){const t=c;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],d[0]=5381;for(let r=0;r<u.length;r++)d[0]=31*d[0]+u[r];return d[0]}function p(e){const t=c;t[0]=f(e.position0[0]),t[1]=f(e.position0[1]),t[2]=f(e.position0[2]),t[3]=f(e.position1[0]),t[4]=f(e.position1[1]),t[5]=f(e.position1[2]),d[0]=5381;for(let r=0;r<u.length;r++)d[0]=31*d[0]+u[r];return d[0]}function f(e){return Math.round(1e4*e)/1e4}class b{constructor(){this.commonWriter=new l}updateSettings(e){this.commonWriter.updateSettings(e)}allocate(e){return o.c.createBuffer(e)}write(e,t,r){this.commonWriter.write(e,t,r),Object(n.h)(g,r.faceNormal0,r.faceNormal1),Object(n.t)(g,g),e.normal.setVec(t,g)}trim(e,t){return this.commonWriter.trim(e,t)}}b.Layout=o.c,b.glLayout=Object(a.a)(o.c,1);class m{constructor(){this.commonWriter=new l}updateSettings(e){this.commonWriter.updateSettings(e)}allocate(e){return o.d.createBuffer(e)}write(e,t,r){this.commonWriter.write(e,t,r),e.normalA.setVec(t,r.faceNormal0),e.normalB.setVec(t,r.faceNormal1)}trim(e,t){return this.commonWriter.trim(e,t)}}m.Layout=o.d,m.glLayout=Object(a.a)(o.d,1);const g=Object(s.e)(),y=new i.a},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r(21),n=r(94);function s(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:o(e.layout)}}function a(e){return function(e){const t=Object(n.a)();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach((e=>t.fields.set(e[0],{...e[1],constructor:u(e[1].constructor)}))),t}(e.layout).createView(e.buffer)}function o(e){const t=new Array;return e.fields.forEach(((e,r)=>{const i={...e,constructor:c(e.constructor)};t.push([r,i])})),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}const l=[i.a,i.m,i.u,i.C,i.f,i.h,i.b,i.n,i.v,i.D,i.g,i.i,i.l,i.t,i.B,i.J,i.j,i.r,i.z,i.H,i.k,i.s,i.A,i.I,i.e,i.q,i.y,i.G,i.c,i.o,i.w,i.E,i.d,i.p,i.x,i.F];function c(e){return`${e.ElementType}_${e.ElementCount}`}function u(e){return d.get(e)}const d=new Map;l.forEach((e=>d.set(c(e),e)))},function(e,t,r){"use strict";function i(e,t={},r){if(!window.WebGLRenderingContext)return s(e,a),null;return n(e,t,r)||(s(e,o),null)}function n(e,t={},r){let i;switch(r){case"webgl":i=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case"webgl2":i=["webgl2"];break;default:i=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}let n=null;for(const a of i){try{n=e.getContext(a,t)}catch(s){}if(n)break}return n}function s(e,t){const r=e.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));const a='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',o='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'},function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return O}));var i=r(0),n=r(19),s=r(2),a=r(13),o=r(150);class l{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(o.a),this._values=new Map}clone(e){const t=new l,r=this._originStores[0];r&&r.forEach(((e,r)=>{t.set(r,Object(a.a)(e),0)}));for(let i=2;i<o.a;i++){const r=this._originStores[i];r&&r.forEach(((r,n)=>{e&&e.has(n)||t.set(n,Object(a.a)(r),i)}))}return t}get(e,t){const r=void 0===t?this._values:this._originStores[t];return r?r.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t,r=6){let i=this._originStores[r];if(i||(i=new Map,this._originStores[r]=i),i.set(e,t),!this._values.has(e)||Object(s.d)(this._propertyOriginMap.get(e))<=r){const i=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,r),i!==t}return!1}delete(e,t=6){const r=this._originStores[t];if(!r)return;const i=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let r=t-1;r>=0;r--){const t=this._originStores[r];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,r);break}}}return i}has(e,t){const r=void 0===t?this._values:this._originStores[t];return!!r&&r.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const r=this._originStores[t],i=r&&r.get(e),n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,t),n!==i}originOf(e){return this._propertyOriginMap.get(e)||0}forEach(e){this._values.forEach(e)}}var c=l,u=r(320),d=r(101),h=r(4);const p=e=>{let t=class extends e{constructor(...e){super(...e);const t=Object(s.d)(Object(d.a)(this)),r=t.metadatas,i=t.store,n=new c;t.store=n,i.keys().forEach((e=>{n.set(e,i.get(e),0)})),Object.keys(r).forEach((e=>{t.internalGet(e)&&n.set(e,t.internalGet(e),0)}))}read(e,t){Object(u.a)(this,e,t)}getAtOrigin(e,t){const r=f(this),i=Object(o.d)(t);if("string"==typeof e)return r.get(e,i);const n={};return e.forEach((e=>{n[e]=r.get(e,i)})),n}originOf(e){return Object(o.b)(this.originIdOf(e))}originIdOf(e){return f(this).originOf(e)}revert(e,t){const r=f(this),i=Object(o.d)(t),n=Object(d.a)(this);let s;s="string"==typeof e?"*"===e?r.keys(i):[e]:e,s.forEach((e=>{n.invalidate(e),r.revert(e,i),n.commit(e)}))}};return t=Object(i.a)([Object(h.a)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function f(e){return Object(d.a)(e).store}let b=class extends(p(n.a)){};b=Object(i.a)([Object(h.a)("esri.core.ReadOnlyMultiOriginJSONSupport")],b);var m=r(386);const g=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){return y(this).delete(e,Object(o.d)(t))}write(e={},t){return Object(m.b)(this,e=e||{},t),e}setAtOrigin(e,t,r){Object(d.a)(this).setAtOrigin(e,t,Object(o.d)(r))}removeOrigin(e){const t=y(this),r=Object(o.d)(e),i=t.keys(r);for(const n of i)t.originOf(n)===r&&t.set(n,t.get(n,r),6)}updateOrigin(e,t){const r=y(this),i=Object(o.d)(t),n=this.get(e);for(let s=i+1;s<o.a;++s)r.delete(e,s);r.set(e,n,i)}toJSON(e){return this.write({},e)}};return t=Object(i.a)([Object(h.a)("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function y(e){return Object(d.a)(e).store}const v=e=>{let t=class extends(g(p(e))){constructor(...e){super(...e)}};return t=Object(i.a)([Object(h.a)("esri.core.MultiOriginJSONSupport")],t),t};let O=class extends(v(n.a)){};O=Object(i.a)([Object(h.a)("esri.core.MultiOriginJSONSupport")],O)},function(e,t,r){"use strict";r.d(t,"a",(function(){return G})),r.d(t,"b",(function(){return X})),r.d(t,"c",(function(){return q})),r.d(t,"d",(function(){return W})),r.d(t,"e",(function(){return N})),r.d(t,"f",(function(){return H})),r.d(t,"g",(function(){return Z})),r.d(t,"h",(function(){return $})),r.d(t,"i",(function(){return R})),r.d(t,"j",(function(){return j})),r.d(t,"k",(function(){return z})),r.d(t,"l",(function(){return F})),r.d(t,"m",(function(){return le})),r.d(t,"n",(function(){return ee})),r.d(t,"o",(function(){return ie})),r.d(t,"p",(function(){return oe})),r.d(t,"q",(function(){return Y})),r.d(t,"r",(function(){return K})),r.d(t,"s",(function(){return g})),r.d(t,"t",(function(){return y})),r.d(t,"u",(function(){return se})),r.d(t,"v",(function(){return J})),r.d(t,"w",(function(){return ne}));var i=r(11),n=r(7),s=r(85),a=r(288),o=r(466),l=r(205);function c(e,t){return e?t?4:3:t?3:2}const u=n.a.getLogger("esri.tasks.support.optimizedFeatureSet"),d={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},h=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s},p=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2]},f=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+3]},b=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2],e[r+3]=t[i+3]};function m(e,t,r,i){if(e){if(r)return t&&i?b:p;if(t&&i)return f}else if(t&&i)return p;return h}function g({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function y({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function v({scale:e,translate:t},r){return r*e[0]+t[0]}function O({scale:e,translate:t},r){return t[1]-r*e[1]}function j(e,t,r){return e?t?r?M(e):x(e):r?T(e):_(e):null}function _(e){const t=e.coords;return{x:t[0],y:t[1]}}function w(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function x(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function S(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function T(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function C(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function M(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function P(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function A(e,t){return e&&t?P:e?S:t?C:w}function E(e,t,r,i,n){const s=A(r,i);for(const o of t){const{geometry:t,attributes:r}=o;let i;t&&(i=s(new l.a,t)),e.push(new a.a(i,r,null,r[n]))}return e}function R(e,t,r){if(!e)return null;const i=c(t,r),n=[];for(let s=0;s<e.coords.length;s+=i){const t=[];for(let r=0;r<i;r++)t.push(e.coords[s+r]);n.push(t)}return t?r?{points:n,hasZ:t,hasM:r}:{points:n,hasZ:t}:r?{points:n,hasM:r}:{points:n}}function I(e,t,r,i,n){const s=c(r,i);for(const o of t){const t=o.geometry,r=o.attributes;let i;t&&(i=D(new l.a,t,s)),e.push(new a.a(i,r,null,r[n]))}return e}function D(e,t,r=c(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let n=0;for(const s of t.points)for(let e=0;e<r;e++)i[n++]=s[e];return e}function F(e,t,r){if(!e)return null;const i=c(t,r),{coords:n,lengths:s}=e,a=[];let o=0;for(const l of s){const e=[];for(let t=0;t<l;t++){const t=[];for(let e=0;e<i;e++)t.push(n[o++]);e.push(t)}a.push(e)}return t?r?{paths:a,hasZ:t,hasM:r}:{paths:a,hasZ:t}:r?{paths:a,hasM:r}:{paths:a}}function L(e,t,r,i,n){const s=c(r,i);for(const o of t){const t=o.geometry,r=o.attributes;let i;t&&(i=k(new l.a,t,s)),e.push(new a.a(i,r,null,r[n]))}return e}function k(e,t,r=c(t.hasZ,t.hasM)){const{lengths:i,coords:n}=e;let s=0;for(const a of t.paths){for(const e of a)for(let t=0;t<r;t++)n[s++]=e[t];i.push(a.length)}return e}function z(e,t,r){if(!e)return null;const i=c(t,r),{coords:n,lengths:s}=e,a=[];let o=0;for(const l of s){const e=[];for(let t=0;t<l;t++){const t=[];for(let e=0;e<i;e++)t.push(n[o++]);e.push(t)}a.push(e)}return t?r?{rings:a,hasZ:t,hasM:r}:{rings:a,hasZ:t}:r?{rings:a,hasM:r}:{rings:a}}function V(e,t,r,i,n){for(const s of t){const t=s.geometry,o=s.centroid,c=s.attributes;let u;t&&(u=N(new l.a,t,r,i)),o?e.push(new a.a(u,c,w(new l.a,o),c[n])):e.push(new a.a(u,c,null,c[n]))}return e}function N(e,t,r=t.hasZ,i=t.hasM){return function(e,t,r,i){const n=c(r,i),{lengths:s,coords:a}=e;let o=0;s.length=a.length=0;for(const l of t){for(const e of l)for(let t=0;t<n;t++)a[o++]=e[t];s.push(l.length)}}(e,t.rings,r,i),e}const U=[],B=[];function G(e,t,r,i,n){U[0]=e;const[s]=q(B,U,t,r,i,n);return U.length=B.length=0,s}function q(e,t,r,n,s,o){if(e.length=0,!r){for(const r of t){const t=r.attributes[o];e.push(new a.a(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return E(e,t,n,s,o);case"esriGeometryMultipoint":return I(e,t,n,s,o);case"esriGeometryPolyline":return L(e,t,n,s,o);case"esriGeometryPolygon":return V(e,t,n,s,o);default:u.error("convertToFeatureSet:unknown-geometry",new i.a(`Unable to parse unknown geometry type '${r}'`)),e.length=0}return e}function H(e,t,r,i){B[0]=e,Q(U,B,t,r,i);const n=U[0];return U.length=B.length=0,n}function W(e,t,r){if(!e)return null;const n=new l.a;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),Object(s.f)(e)?A(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(n,e):Object(s.g)(e)?N(n,e,t,r):Object(s.h)(e)?k(n,e,c(t,r)):Object(s.e)(e)?D(n,e,c(t,r)):void u.error("convertFromGeometry:unknown-geometry",new i.a(`Unable to parse unknown geometry type '${e}'`))}function $(e,t,r,n){const s=e&&("coords"in e?e:e.geometry);if(!s)return null;switch(t){case"esriGeometryPoint":{let e=_;return r&&n?e=M:r?e=x:n&&(e=T),e(s)}case"esriGeometryMultipoint":return R(s,r,n);case"esriGeometryPolyline":return F(s,r,n);case"esriGeometryPolygon":return z(s,r,n);default:return void u.error("convertToGeometry:unknown-geometry",new i.a(`Unable to parse unknown geometry type '${t}'`))}}function Q(e,t,r,n,s){switch(e.length=0,r){case"esriGeometryPoint":return function(e,t,r,i){let n=_;r&&i?n=M:r?n=x:i&&(n=T);for(const s of t){const{geometry:t,attributes:r}=s,i=t?n(t):null;e.push({attributes:r,geometry:i})}return e}(e,t,n,s);case"esriGeometryMultipoint":return function(e,t,r,i){for(const n of t){const{geometry:t,attributes:s}=n;let a;t&&(a=R(t,r,i)),e.push({attributes:s,geometry:a})}return e}(e,t,n,s);case"esriGeometryPolyline":return function(e,t,r,i){for(const n of t){const{geometry:t,attributes:s}=n;let a;t&&(a=F(t,r,i)),e.push({attributes:s,geometry:a})}return e}(e,t,n,s);case"esriGeometryPolygon":return function(e,t,r,i){for(const n of t){const{geometry:t,attributes:s,centroid:a}=n;let o;if(t&&(o=z(t,r,i)),a){const t=_(a);e.push({attributes:s,centroid:t,geometry:o})}else e.push({attributes:s,geometry:o})}return e}(e,t,n,s);default:u.error("convertToFeatureSet:unknown-geometry",new i.a(`Unable to parse unknown geometry type '${r}'`))}return e}function Z(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:a,features:o,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:h}=e,p={features:Q([],o,l,a,s),fields:n,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:u,queryGeometry:$(d,h,!1,!1)};return i&&(p.transform=i),c&&(p.exceededTransferLimit=c),s&&(p.hasM=s),a&&(p.hasZ=a),p}function X(e,t){const r=new o.a,{hasM:n,hasZ:s,features:a,objectIdFieldName:l,spatialReference:c,geometryType:d,exceededTransferLimit:h,transform:p,fields:f}=e;return f&&(r.fields=f),r.geometryType=d,r.objectIdFieldName=l||t,r.spatialReference=c,r.objectIdFieldName?(a&&q(r.features,a,d,s,n,r.objectIdFieldName),h&&(r.exceededTransferLimit=h),n&&(r.hasM=n),s&&(r.hasZ=s),p&&(r.transform=p),r):(u.error(new i.a("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function J(e){const{transform:t,features:r,hasM:i,hasZ:n}=e;if(!t)return e;for(const s of r)s.geometry&&ne(s.geometry,s.geometry,i,n,t),s.centroid&&ne(s.centroid,s.centroid,i,n,t);return e.transform=null,e}function Y(e,t){const{geometryType:r,features:i,hasM:n,hasZ:s}=t;if(!e)return t;for(let a=0;a<i.length;a++){const t=i[a],o=t.weakClone();o.geometry=new l.a,K(o.geometry,t.geometry,n,s,r,e),t.centroid&&(o.centroid=new l.a,K(o.centroid,t.centroid,n,s,"esriGeometryPoint",e)),i[a]=o}return t.transform=e,t}function K(e,t,r,i,n,s,a=r,o=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=d[n],{coords:u,lengths:h}=t,p=c(r,i),f=c(r&&a,i&&o),b=m(r,i,a,o);if(!h.length)return b(e.coords,u,0,0,g(s,u[0]),y(s,u[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let v,O,j,_,w=0,x=0,S=x;for(const c of h){if(c<l)continue;let t=0;x=S,j=v=g(s,u[w]),_=O=y(s,u[w+1]),b(e.coords,u,x,w,j,_),t++,w+=p,x+=f;for(let r=1;r<c;r++,w+=p)j=g(s,u[w]),_=y(s,u[w+1]),j===v&&_===O||(b(e.coords,u,x,w,j-v,_-O),x+=f,t++,v=j,O=_);t>=l&&(e.lengths.push(t),S=x)}return e.coords.length=S,e.coords.length?e:null}function ee(e,t,r,i,n,s,a=r,o=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=d[n],{coords:u,lengths:h}=t,p=c(r,i),f=c(r&&a,i&&o),b=m(r,i,a,o);if(!h.length)return b(e.coords,u,0,0,u[0],u[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let g=0;const y=s*s;for(const c of h){if(c<l){g+=c*p;continue}const t=e.coords.length/f,r=g,i=g+(c-1)*p;b(e.coords,u,e.coords.length,r,u[r],u[r+1]),re(e.coords,u,p,y,b,r,i),b(e.coords,u,e.coords.length,i,u[i],u[i+1]);const n=e.coords.length/f-t;n>=l?e.lengths.push(n):e.coords.length=t*f,g+=c*p}return e.coords.length?e:null}function te(e,t,r,i){const n=e[t],s=e[t+1],a=e[r],o=e[r+1],l=e[i],c=e[i+1];let u=a,d=o,h=l-u,p=c-d;if(0!==h||0!==p){const e=((n-u)*h+(s-d)*p)/(h*h+p*p);e>1?(u=l,d=c):e>0&&(u+=h*e,d+=p*e)}return h=n-u,p=s-d,h*h+p*p}function re(e,t,r,i,n,s,a){let o,l=i,c=0;for(let u=s+r;u<a;u+=r)o=te(t,u,s,a),o>l&&(c=u,l=o);l>i&&(c-s>r&&re(e,t,r,i,n,s,c),n(e,t,e.length,c,t[c],t[c+1]),a-c>r&&re(e,t,r,i,n,c,a))}function ie(e,t,r,i){if(!t||!t.coords||!t.coords.length)return null;const n=c(r,i);let s=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=n){const r=e[t],i=e[t+1];s=Math.min(s,r),o=Math.max(o,r),a=Math.min(a,i),l=Math.max(l,i)}}return e[0]=s,e[1]=a,e[2]=o,e[3]=l,e}function ne(e,t,r,i,n){const{coords:s,lengths:a}=t,o=r?i?b:p:i?p:h,l=c(r,i);if(!s.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!a.length)return o(e.coords,s,0,0,v(n,s[0]),O(n,s[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[u,d]=n.scale;let f=0;for(let c=0;c<a.length;c++){const t=a[c];e.lengths[c]=t;let r=v(n,s[f]),i=O(n,s[f+1]);o(e.coords,s,f,f,r,i),f+=l;for(let n=1;n<t;n++,f+=l)r+=s[f]*u,i-=s[f+1]*d,o(e.coords,s,f,f,r,i)}return e!==t&&(e.lengths.length=a.length,e.coords.length=s.length),e}function se(e,t,r,i,n,s){const a=c(r,i),o=m(r,i,n,s),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=a)o(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function ae(e,t,r,i){let n=0,s=e[i*t],a=e[i*(t+1)];for(let o=1;o<r;o++){const r=s+e[i*(t+o)],l=a+e[i*(t+o)+1],c=(r-s)*(l+a);s=r,a=l,n+=c}return.5*n}function oe(e,t){const{coords:r,lengths:i}=e;let n=0,s=0;for(let a=0;a<i.length;a++)s+=ae(r,n,i[a],t),n+=a;return Math.abs(s)}function le(e,t){const r=e.clone(),i=e.coords,n=e.lengths;let s=0;for(let a=0;a<n.length;a++){const e=n[a];let o=i[t*s],l=i[t*s+1];for(let n=1;n<e;n++){const e=o+i[t*(s+n)],a=l+i[t*(s+n)+1];r.coords[t*(s+n)]=e,r.coords[t*(s+n)+1]=a,o=e,l=a}s+=e}return r}},function(e,t,r){"use strict";var i,n=r(0),s=r(44),a=r(14),o=r(54),l=r(1),c=(r(8),r(9)),u=(r(7),r(32)),d=r(4),h=r(29),p=r(41),f=r(39),b=r(28),m=r(43),g=r(46),y=r(588);const v=new s.a({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let O=i=class extends a.a{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:r,size:n=256,spatialReference:s=f.a.WebMercator,numLODs:a=24}=e;if(!Object(m.j)(s)){const e=[];if(r)for(let t=0;t<r.length;t++){const i=r[t];e.push({level:t,scale:i,resolution:i})}else{let t=5e-4;for(let r=a-1;r>=0;r--)e.unshift({level:r,scale:t,resolution:t}),t*=2}return new i({dpi:96,lods:e,origin:new p.a(0,0,s),size:[n,n],spatialReference:s})}const l=Object(m.d)(s),c=e.origin?new p.a({x:e.origin.x,y:e.origin.y,spatialReference:s}):new p.a(l?{x:l.origin[0],y:l.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),u=1/(39.37*Object(o.f)(s)*96),d=[];if(r)for(let i=0;i<r.length;i++){const e=r[i],t=e*u;d.push({level:i,scale:e,resolution:t})}else{let e=Object(m.g)(s)?512/n*591657527.5917094:256/n*591657527.591555;const r=Math.ceil(a/t);d.push({level:0,scale:e,resolution:e*u});for(let i=1;i<r;i++){const r=e/2**t,n=r*u;d.push({level:i,scale:r,resolution:n}),e=r}}return new i({dpi:96,lods:d,origin:c,size:[n,n],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=Object(m.d)(e);return e.isWrappable&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return p.a.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const i=[];this._levelToLOD={},e&&(t=-1/0,r=1/0,e.forEach((e=>{i.push(e.scale),t=e.scale>t?e.scale:t,r=e.scale<r?e.scale:r,this._levelToLOD[e.level]=e}))),this._set("scales",i),this._set("minScale",t),this._set("maxScale",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[0]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const r=Math.floor(e),i=r+1;return t[r]/(t[r]/t[i])**(e-r)}}scaleToZoom(e){const t=this.scales,r=t.length-1;let i=0;for(;i<r;i++){const r=t[i],n=t[i+1];if(r<=e)return i;if(n===e)return i+1;if(r>e&&n<e)return i+Math.log(r/e)/Math.log(r/n)}return i}snapScale(e,t=.95){const r=this.scaleToZoom(e);return r%Math.floor(r)>=t?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(e,t,r,i){const n=this.lodAt(e);if(!n)return null;let s,a;if("number"==typeof t)s=t,a=r;else if(Object(m.c)(t.spatialReference,this.spatialReference))s=t.x,a=t.y,i=r;else{const e=Object(g.d)(t,this.spatialReference);if(!e)return null;s=e.x,a=e.y,i=r}const o=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i={id:null,level:0,row:0,col:0,extent:Object(b.k)()}),i.level=e,i.row=Math.floor((this.origin.y-a)/l+.001),i.col=Math.floor((s-this.origin.x)/o+.001),this.updateTileInfo(i),i}updateTileInfo(e,t=0){let r=this.lodAt(e.level);if(!r&&1===t){const t=this.lods[this.lods.length-1];t.level<e.level&&(r=t)}if(!r)return;const i=e.level-r.level,n=r.resolution*this.size[0]/2**i,s=r.resolution*this.size[1]/2**i;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Object(b.k)()),e.extent[0]=this.origin.x+e.col*n,e.extent[1]=this.origin.y-(e.row+1)*s,e.extent[2]=e.extent[0]+n,e.extent[3]=e.extent[1]+s}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:r}=this.lodAt(t.level),i=r*this.size[0],n=r*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+i,e[3]=e[1]+n,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return i.fromJSON(this.write({}))}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}};Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],O.prototype,"compressionQuality",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],O.prototype,"dpi",void 0),Object(n.a)([Object(l.b)({type:String,json:{read:v.read,write:v.write,origins:{"web-scene":{read:!1,write:!1}}}})],O.prototype,"format",void 0),Object(n.a)([Object(l.b)({readOnly:!0})],O.prototype,"isWrappable",null),Object(n.a)([Object(l.b)({type:p.a,json:{write:!0}})],O.prototype,"origin",void 0),Object(n.a)([Object(u.a)("origin")],O.prototype,"readOrigin",null),Object(n.a)([Object(l.b)({type:[y.a],value:null,json:{write:!0}})],O.prototype,"lods",null),Object(n.a)([Object(l.b)({readOnly:!0})],O.prototype,"minScale",void 0),Object(n.a)([Object(l.b)({readOnly:!0})],O.prototype,"maxScale",void 0),Object(n.a)([Object(l.b)({readOnly:!0})],O.prototype,"scales",void 0),Object(n.a)([Object(l.b)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],O.prototype,"size",void 0),Object(n.a)([Object(u.a)("size",["rows","cols"])],O.prototype,"readSize",null),Object(n.a)([Object(h.a)("size",{cols:{type:c.a},rows:{type:c.a}})],O.prototype,"writeSize",null),Object(n.a)([Object(l.b)({type:f.a,json:{write:!0}})],O.prototype,"spatialReference",void 0),O=i=Object(n.a)([Object(d.a)("esri.layers.support.TileInfo")],O);var j=O;t.a=j},function(e,t,r){"use strict";r.d(t,"a",(function(){return pe})),r.d(t,"b",(function(){return be})),r.d(t,"c",(function(){return ge})),r.d(t,"d",(function(){return Se})),r.d(t,"e",(function(){return fe})),r.d(t,"f",(function(){return we})),r.d(t,"g",(function(){return ye})),r.d(t,"h",(function(){return _e})),r.d(t,"i",(function(){return je})),r.d(t,"j",(function(){return Oe})),r.d(t,"k",(function(){return xe})),r.d(t,"l",(function(){return me})),r.d(t,"m",(function(){return ve}));var i=r(52),n=r(83),s=r(182),a=r(549),o=r(185),l=r(3),c=r(58),u=r(5),d=(r(40),r(31)),h=r(22),p=r(26);const f=1e-6,b=[0,0,0],m=[0,0,0];function g(e,t){const{data:r,size:i}=e,n=r.length/i;if(n<=0)return;const s=new J(e);ee(b,s.minProj,s.maxProj),re(b,b,.5),te(m,s.maxProj,s.minProj);const a=K(m),o=new Y;o.quality=a,n<14&&(e={data:new Float64Array(s.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[0,0,0],h=[0,0,0],p=[0,0,0],g=[0,0,0];switch(y(s,e,g,l,c,u,d,h,p,o)){case 1:return void V(b,m,t);case 2:return void function(e,t,r){ie(N,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?N[0]=0:Math.abs(t[1])>Math.abs(t[2])?N[1]=0:N[2]=0,ae(N)<f&&(N[0]=N[1]=N[2]=1),ne(U,t,N),se(U,U),ne(B,t,U),se(B,B),W(e,t,U,B,G,q),te(H,q,G),X(t,U,B,G,q,H,r)}(e,d,t)}C(e,g,l,c,u,d,h,p,o),W(e,o.b0,o.b1,o.b2,G,q);const v=[0,0,0];te(v,q,G),o.quality=K(v),o.quality<a?X(o.b0,o.b1,o.b2,G,q,v,t):V(b,m,t)}function y(e,t,r,i,n,s,a,o,l,c){return function(e,t,r){let i=oe(e.maxVert[0],e.minVert[0]),n=0;for(let s=1;s<7;++s){const t=oe(e.maxVert[s],e.minVert[s]);t>i&&(i=t,n=s)}ie(t,e.minVert[n]),ie(r,e.maxVert[n])}(e,i,n),oe(i,n)<f?1:(te(a,i,n),se(a,a),function(e,t,r,i){const{data:n,size:s}=e;let a=Number.NEGATIVE_INFINITY,o=0;for(let l=0;l<n.length;l+=s){M[0]=n[l]-t[0],M[1]=n[l+1]-t[1],M[2]=n[l+2]-t[2];const e=r[0]*M[0]+r[1]*M[1]+r[2]*M[2],i=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],s=M[0]*M[0]+M[1]*M[1]+M[2]*M[2]-e*e/i;s>a&&(a=s,o=l)}return ie(i,n,o),a}(t,i,a,s)<f?2:(te(o,n,s),se(o,o),te(l,s,i),se(l,l),ne(r,o,a),se(r,r),L(t,r,a,o,l,c),0))}const v=[0,0,0],O=[0,0,0],j=[0,0,0],_=[0,0,0],w=[0,0,0],x=[0,0,0],S=[0,0,0],T=[0,0,0];function C(e,t,r,i,n,s,a,o,l){(function(e,t,r,i,n){!function(e,t,r,i,n){const{data:s,size:a}=e;ie(i,s),ie(n,i),r[0]=le(k,t),r[1]=r[0];for(let o=a;o<s.length;o+=a){const e=s[o]*t[0]+s[o+1]*t[1]+s[o+2]*t[2];e<r[0]&&(r[0]=e,ie(i,s,o)),e>r[1]&&(r[1]=e,ie(n,s,o))}}(e,t,P,n,i);const s=le(r,t);P[1]-f<=s&&(i[0]=void 0),P[0]+f>=s&&(n[0]=void 0)})(e,t,r,v,O),void 0!==v[0]&&(te(j,v,r),se(j,j),te(_,v,i),se(_,_),te(w,v,n),se(w,w),ne(x,_,s),se(x,x),ne(S,w,a),se(S,S),ne(T,j,o),se(T,T),L(e,x,s,_,j,l),L(e,S,a,w,_,l),L(e,T,o,j,w,l)),void 0!==O[0]&&(te(j,O,r),se(j,j),te(_,O,i),se(_,_),te(w,O,n),se(w,w),ne(x,_,s),se(x,x),ne(S,w,a),se(S,S),ne(T,j,o),se(T,T),L(e,x,s,_,j,l),L(e,S,a,w,_,l),L(e,T,o,j,w,l))}const M=[0,0,0];const P=[0,0];const A=[0,0,0],E=[0,0,0],R=[0,0,0],I=[0,0,0],D=[0,0,0],F=[0,0,0];function L(e,t,r,i,n,s){if(ae(t)<f)return;ne(A,r,t),ne(E,i,t),ne(R,n,t),z(e,t,P),D[1]=P[0],I[1]=P[1],F[1]=I[1]-D[1];const a=[r,i,n],o=[A,E,R];for(let l=0;l<3;++l){z(e,a[l],P),D[0]=P[0],I[0]=P[1],z(e,o[l],P),D[2]=P[0],I[2]=P[1],F[0]=I[0]-D[0],F[2]=I[2]-D[2];const r=K(F);r<s.quality&&(ie(s.b0,a[l]),ie(s.b1,t),ie(s.b2,o[l]),s.quality=r)}}const k=[0,0,0];function z(e,t,r){const{data:i,size:n}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=n){const e=i[s]*t[0]+i[s+1]*t[1]+i[s+2]*t[2];r[0]=Math.min(r[0],e),r[1]=Math.max(r[1],e)}}function V(e,t,r){ie(r.center,e),re(r.halfSize,t,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const N=[0,0,0],U=[0,0,0],B=[0,0,0],G=[0,0,0],q=[0,0,0],H=[0,0,0];function W(e,t,r,i,n,s){z(e,t,P),n[0]=P[0],s[0]=P[1],z(e,r,P),n[1]=P[0],s[1]=P[1],z(e,i,P),n[2]=P[0],s[2]=P[1]}const $=[0,0,0],Q=[1,0,0,0,1,0,0,0,1],Z=[0,0,0];function X(e,t,r,i,n,s,a){Q[0]=e[0],Q[1]=e[1],Q[2]=e[2],Q[3]=t[0],Q[4]=t[1],Q[5]=t[2],Q[6]=r[0],Q[7]=r[1],Q[8]=r[2],function(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const i=(r+1)%3,n=(r+2)%3;let s=Math.sqrt(t[3*r+r]-t[3*i+i]-t[3*n+n]+1);e[r]=.5*s,s=.5/s,e[3]=(t[3*i+n]-t[3*n+i])*s,e[i]=(t[3*i+r]+t[3*r+i])*s,e[n]=(t[3*n+r]+t[3*r+n])*s}}(a.quaternion,Q),ee(Z,i,n),re(Z,Z,.5),re(a.center,e,Z[0]),re($,t,Z[1]),ee(a.center,a.center,$),re($,r,Z[2]),ee(a.center,a.center,$),re(a.halfSize,s,.5)}class J{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7);this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let a=0;a<7;++a)this.minVert[a]=new Float64Array(this.buffer,t,3),t+=24;for(let a=0;a<7;++a)this.maxVert[a]=new Float64Array(this.buffer,t,3),t+=24;for(let a=0;a<7;++a)this.minProj[a]=Number.POSITIVE_INFINITY,this.maxProj[a]=Number.NEGATIVE_INFINITY;const r=new Array(7),i=new Array(7),{data:n,size:s}=e;for(let a=0;a<n.length;a+=s){let e=n[a];e<this.minProj[0]&&(this.minProj[0]=e,r[0]=a),e>this.maxProj[0]&&(this.maxProj[0]=e,i[0]=a),e=n[a+1],e<this.minProj[1]&&(this.minProj[1]=e,r[1]=a),e>this.maxProj[1]&&(this.maxProj[1]=e,i[1]=a),e=n[a+2],e<this.minProj[2]&&(this.minProj[2]=e,r[2]=a),e>this.maxProj[2]&&(this.maxProj[2]=e,i[2]=a),e=n[a]+n[a+1]+n[a+2],e<this.minProj[3]&&(this.minProj[3]=e,r[3]=a),e>this.maxProj[3]&&(this.maxProj[3]=e,i[3]=a),e=n[a]+n[a+1]-n[a+2],e<this.minProj[4]&&(this.minProj[4]=e,r[4]=a),e>this.maxProj[4]&&(this.maxProj[4]=e,i[4]=a),e=n[a]-n[a+1]+n[a+2],e<this.minProj[5]&&(this.minProj[5]=e,r[5]=a),e>this.maxProj[5]&&(this.maxProj[5]=e,i[5]=a),e=n[a]-n[a+1]-n[a+2],e<this.minProj[6]&&(this.minProj[6]=e,r[6]=a),e>this.maxProj[6]&&(this.maxProj[6]=e,i[6]=a)}for(let a=0;a<7;++a){let e=r[a];ie(this.minVert[a],n,e),e=i[a],ie(this.maxVert[a],n,e)}}}class Y{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function K(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function ee(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function te(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function re(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function ie(e,t,r=0){e[0]=t[r+0],e[1]=t[r+1],e[2]=t[r+2]}function ne(e,t,r){const i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2];e[0]=n*l-s*o,e[1]=s*a-i*l,e[2]=i*o-n*a}function se(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function ae(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function oe(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function le(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}const ce=Object(o.b)(),ue=Object(u.e)(),de=Object(u.e)(),he=(Object(d.e)(),Object(n.b)());class pe{constructor(e){const t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(let r=0;r<e;r++)this.obbs[r]={center:Object(u.d)(this.buffer,56*r+0),halfSize:Object(c.b)(this.buffer,56*r+24),quaternion:Object(a.c)(this.buffer,56*r+36)}}}function fe(e=[0,0,0],t=[-1,-1,-1],r=[0,0,0,1]){return{center:Object(u.c)(e),halfSize:Object(c.a)(t),quaternion:Object(a.a)(r)}}function be(e){return fe(e.center,e.halfSize,e.quaternion)}function me(e,t){Object(l.m)(t.center,e.center),Object(l.m)(t.halfSize,e.halfSize),Object(s.a)(t.quaternion,e.quaternion)}function ge(e,t){return g(e,t=t||fe()),t}function ye(e,t){const r=Object(p.w)(t,e.center),i=xe(e,Object(p.s)(t));return r>i?1:r<-i?-1:0}function ve(e,t){t||(t=Object(h.h)());const r=Object(i.h)(he,e.quaternion),n=e.halfSize[0]*Math.abs(r[0])+e.halfSize[1]*Math.abs(r[3])+e.halfSize[2]*Math.abs(r[6]),s=e.halfSize[0]*Math.abs(r[1])+e.halfSize[1]*Math.abs(r[4])+e.halfSize[2]*Math.abs(r[7]),a=e.halfSize[0]*Math.abs(r[2])+e.halfSize[1]*Math.abs(r[5])+e.halfSize[2]*Math.abs(r[8]);return t[0]=e.center[0]-n,t[1]=e.center[1]-s,t[2]=e.center[2]-a,t[3]=e.center[0]+n,t[4]=e.center[1]+s,t[5]=e.center[2]+a,t}function Oe(e,t){return Object(p.w)(t,e.center)-xe(e,Object(p.s)(t))}function je(e,t){return Object(p.w)(t,e.center)+xe(e,Object(p.s)(t))}function _e(e,t){return ye(e,t[0])<=0&&ye(e,t[1])<=0&&ye(e,t[2])<=0&&ye(e,t[3])<=0&&ye(e,t[4])<=0&&ye(e,t[5])<=0}function we(e,t,r,i=0){Object(s.b)(ce,e.quaternion),Object(l.l)(ue,t,e.center);const n=Object(l.w)(ue,ue,ce),a=Object(l.w)(de,r,ce);let o=-1/0,c=1/0;for(let s=0;s<3;s++)if(Math.abs(a[s])>1e-6){const t=(i+e.halfSize[s]-n[s])/a[s],r=(-i-e.halfSize[s]-n[s])/a[s];o=Math.max(o,Math.min(t,r)),c=Math.min(c,Math.max(t,r))}else if(n[s]>e.halfSize[s]+i||n[s]<-e.halfSize[s]-i)return!1;return o<=c}(()=>{const e=new Int8Array(162);let t=0;const r=r=>{for(let i=0;i<r.length;i++)e[t+i]=r[i];t+=6};r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4])})();function xe(e,t){Object(s.b)(ce,e.quaternion),Object(l.w)(ue,t,ce);const r=e.halfSize;return Math.abs(ue[0]*r[0])+Math.abs(ue[1]*r[1])+Math.abs(ue[2]*r[2])}function Se(e,t){for(let r=0;r<8;++r){const i=t[r];i[0]=1&r?-e.halfSize[0]:e.halfSize[0],i[1]=2&r?-e.halfSize[1]:e.halfSize[1],i[2]=4&r?-e.halfSize[2]:e.halfSize[2],Object(l.w)(i,i,e.quaternion),Object(l.h)(i,i,e.center)}}},function(e,t,r){"use strict";var i,n=r(0),s=r(86),a=r(11),o=r(13),l=r(7),c=r(2),u=r(99),d=r(1),h=r(45),p=(r(8),r(37)),f=r(32),b=r(4),m=r(29),g=r(571),y=r(9),v=r(89),O=r(118),j=r(179),_=r(274),w=r(333),x=r(369),S=r(430),T=r(139),C=r(115),M=r(552),P=r(215);const A=l.a.getLogger("esri.renderers.UniqueValueRenderer"),E=Object(y.m)(S.a);let R=i=class extends(Object(_.a)(j.a)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let r=!1;const i={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<t.length;n++){const s=e.find((e=>e.value===t[n].value));s?Object(g.a)(s,t[n])?(i.changed.push({type:"complete",oldValue:s,newValue:t[n]}),r=!0):i.unchanged.push({oldValue:s,newValue:t[n]}):(i.added.push(t[n]),r=!0)}for(let n=0;n<e.length;n++)t.find((t=>t.value===e[n].value))||(i.removed.push(e[n]),r=!0);return r?i:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return null==e||"function"==typeof e?e:Object(y.l)(e)}writeField(e,t,r,i){"string"==typeof e?t[r]=e:i&&i.messages?i.messages.push(new a.a("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):A.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,r){return r.portal||O.a.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=Object(C.a)(t.styleUrl,r);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,r,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=Object(C.e)(e.styleUrl,i))}set uniqueValueInfos(e){this.styleOrigin?A.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void A.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r="object"==typeof e?E(e):new S.a({value:e,symbol:Object(s.a)(t)}),this.uniqueValueInfos.push(r),this._valueInfoMap[r.value]=r}removeUniqueValueInfo(e){if(this.styleOrigin)A.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&(Object(c.i)(t)||Object(c.i)(t.arcade))&&(r={...r,arcade:await Object(T.e)()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&(Object(c.i)(t)||Object(c.i)(t.arcade)))return void A.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(Object(c.i)(r)||Object(c.i)(r.arcade))){const e=await Object(T.e)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this._getUniqueValueInfo(e,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new i({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:Object(o.a)(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:Object(o.a)(this.visualVariables),legendOptions:Object(o.a)(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:Object(o.a)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=Object(o.a)(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(Object(o.a)(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map((r=>r.collectRequiredFields(e,t))),Object(v.a)(e,t,this.valueExpression)];Object(v.d)(e,t,this.field),Object(v.d)(e,t,this.field2),Object(v.d)(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return Object(M.fetchStyle)(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach((r=>{const i=new P.a({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const n=new S.a({value:r.name,symbol:i});t.push(n),this._valueInfoMap[r.name]=n})),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach((e=>this._valueInfoMap[e.value+""]=e))}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=Object(c.t)(t,{});let a=this._cache.compiledFunc;const o=Object(c.s)(s).arcadeUtils;if(!a){const e=o.createSyntaxTree(this.valueExpression);a=o.createFunction(e),this._cache.compiledFunc=a}const l=o.executeFunction(a,o.createExecContext(e,o.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let i;if("function"!=typeof t&&this.field2){const e=this.field2,n=this.field3,s=[];t&&s.push(r[t]),e&&s.push(r[e]),n&&s.push(r[n]),i=s.join(this.fieldDelimiter||"")}else"function"==typeof t?i=t(e):t&&(i=r[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){const r=new i(t&&t.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t&&t.portal||O.a.getDefault());const n=r.populateFromStyle();return n.catch((t=>{A.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),n}static fromStyleUrl(e,t){const r=new i(t&&t.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const n=r.populateFromStyle();return n.catch((t=>{A.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),n}};Object(n.a)([Object(d.b)({readOnly:!0})],R.prototype,"_cache",null),Object(n.a)([Object(p.a)({uniqueValue:"unique-value"})],R.prototype,"type",void 0),Object(n.a)([Object(d.b)(w.a)],R.prototype,"backgroundFillSymbol",void 0),Object(n.a)([Object(d.b)({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],R.prototype,"field",void 0),Object(n.a)([Object(h.a)("field")],R.prototype,"castField",null),Object(n.a)([Object(m.a)("field")],R.prototype,"writeField",null),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],R.prototype,"field2",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],R.prototype,"field3",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],R.prototype,"valueExpression",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],R.prototype,"valueExpressionTitle",void 0),Object(n.a)([Object(d.b)({type:x.a,json:{write:!0}})],R.prototype,"legendOptions",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],R.prototype,"defaultLabel",void 0),Object(n.a)([Object(d.b)(Object(u.a)({...w.b},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],R.prototype,"defaultSymbol",null),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],R.prototype,"fieldDelimiter",void 0),Object(n.a)([Object(d.b)({type:O.a,readOnly:!0})],R.prototype,"portal",void 0),Object(n.a)([Object(f.a)("portal",["styleName"])],R.prototype,"readPortal",null),Object(n.a)([Object(d.b)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],R.prototype,"styleOrigin",void 0),Object(n.a)([Object(f.a)("styleOrigin",["styleName","styleUrl"])],R.prototype,"readStyleOrigin",null),Object(n.a)([Object(m.a)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],R.prototype,"writeStyleOrigin",null),Object(n.a)([Object(d.b)({type:[S.a],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],R.prototype,"uniqueValueInfos",null),R=i=Object(n.a)([Object(b.a)("esri.renderers.UniqueValueRenderer")],R);var I=R;t.a=I},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));const i={value:.5,readOnly:!0},n={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}}},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(37)),l=r(4),c=r(179),u=r(274),d=r(333);let h=i=class extends(Object(u.a)(c.a)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map((r=>r.collectRequiredFields(e,t))))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new i({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Object(s.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],h.prototype,"description",void 0),Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],h.prototype,"label",void 0),Object(n.a)([Object(a.b)(d.b)],h.prototype,"symbol",void 0),Object(n.a)([Object(o.a)({simple:"simple"})],h.prototype,"type",void 0),h=i=Object(n.a)([Object(l.a)("esri.renderers.SimpleRenderer")],h);var p=h;t.a=p},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return d}));var i=r(443),n=r(538),s=r(539),a=r(540),o=r(179),l=r(414),c=r(412);const u={key:"type",base:o.a,typeMap:{heatmap:a.a,simple:l.a,"unique-value":c.a,"class-breaks":i.a,"dot-density":s.a,dictionary:n.default},errorContext:"renderer"},d={key:"type",base:o.a,typeMap:{simple:l.a,"unique-value":c.a,"class-breaks":i.a},errorContext:"renderer"}},function(e,t,r){"use strict";r.r(t),r.d(t,"getAllSizes",(function(){return x})),r.d(t,"getColor",(function(){return f})),r.d(t,"getOpacity",(function(){return b})),r.d(t,"getRotationAngle",(function(){return m})),r.d(t,"getSize",(function(){return g})),r.d(t,"getSizeForValue",(function(){return O})),r.d(t,"getSizeFromNumberOrVariable",(function(){return y})),r.d(t,"getSizeRangeAtScale",(function(){return j})),r.d(t,"getVisualVariableValues",(function(){return _})),r.d(t,"viewScaleRE",(function(){return p}));var i=r(35),n=r(124),s=r(120),a=r(7),o=r(2),l=r(301),c=r(203);const u=a.a.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),d=new n.a,h=Math.PI,p=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function f(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"color"===e.type))[0]:e;if(!n)return;if("esri.renderers.visualVariables.ColorVariable"!==n.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s="number"==typeof t,a=s?null:t,l=a&&a.attributes;let c=s?t:null;const d=n.field,{ipData:h,hasExpression:p}=n.cache;let f=n.cache.compiledFunc;if(!d&&!p){const e=n.stops;return e&&e[0]&&e[0].color}if("number"!=typeof c)if(p){if(!Object(o.j)(r)||!Object(o.j)(r.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,i=t.getViewInfo(e),s=t.createExecContext(a,i);if(!f){const e=t.createSyntaxTree(n.valueExpression);f=t.createFunction(e),n.cache.compiledFunc=f}c=t.executeFunction(f,s)}else l&&(c=l[d]);const b=n.normalizationField,m=l?parseFloat(l[b]):void 0;if(null!=c&&(!b||s||!isNaN(m)&&0!==m)){isNaN(m)||s||(c/=m);const e=w(c,h);if(e){const t=e[0],s=e[1],a=t===s?n.stops[t].color:i.a.blendColors(n.stops[t].color,n.stops[s].color,e[2],Object(o.j)(r)?r.color:void 0);return new i.a(a)}}}function b(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"opacity"===e.type))[0]:e;if(!i)return;if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n="number"==typeof t,s=n?null:t,a=s&&s.attributes;let l=n?t:null;const c=i.field,{ipData:d,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!c&&!h){const e=i.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof l)if(h){if(Object(o.i)(r)||Object(o.i)(r.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),a=t.createExecContext(s,n);if(!p){const e=t.createSyntaxTree(i.valueExpression);p=t.createFunction(e),i.cache.compiledFunc=p}l=t.executeFunction(p,a)}else a&&(l=a[c]);const f=i.normalizationField,b=a?parseFloat(a[f]):void 0;if(null!=l&&(!f||n||!isNaN(b)&&0!==b)){isNaN(b)||n||(l/=b);const e=w(l,d);if(e){const t=e[0],r=e[1];if(t===r)return i.stops[t].opacity;{const n=i.stops[t].opacity;return n+(i.stops[r].opacity-n)*e[2]}}}}function m(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"rotation"===e.type))[0]:e;if(!i)return;if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=i.axis||"heading",s="heading"===n&&"arithmetic"===i.rotationType?90:0,a="heading"===n&&"arithmetic"===i.rotationType?-1:1,l="number"==typeof t?null:t,c=l&&l.attributes,d=i.field,{hasExpression:h}=i.cache;let p=i.cache.compiledFunc,f=0;if(!d&&!h)return f;if(h){if(Object(o.i)(r)||Object(o.i)(r.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),s=t.createExecContext(l,n);if(!p){const e=t.createSyntaxTree(i.valueExpression);p=t.createFunction(e),i.cache.compiledFunc=p}f=t.executeFunction(p,s)}else c&&(f=c[d]||0);return f="number"!=typeof f||isNaN(f)?null:s+a*f,f}function g(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"size"===e.type))[0]:e;if(!i)return;if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=O(function(e,t,r){const i="number"==typeof t,n=i?null:t,s=n&&n.attributes;let a=i?t:null;const{isScaleDriven:l}=e.cache;let d=e.cache.compiledFunc;if(l){const t=Object(o.j)(r)?r.scale:void 0,i=Object(o.j)(r)?r.view:void 0;a=null==t||"3d"===i?function(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):t}else if(!i)switch(e.inputValueType){case"expression":{if(Object(o.i)(r)||Object(o.i)(r.arcade))return void u.error("Use of arcade expressions requires an arcade context");const t={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},i=r.arcade.arcadeUtils,s=i.getViewInfo(t),l=i.createExecContext(n,s);if(!d){const t=i.createSyntaxTree(e.valueExpression);d=i.createFunction(t),e.cache.compiledFunc=d}a=i.executeFunction(d,l);break}case"field":s&&(a=s[e.field]);break;case"unknown":a=null}if(!Object(c.d)(a))return null;if(i||!e.normalizationField)return a;const h=s?parseFloat(s[e.normalizationField]):null;return Object(c.d)(h)&&0!==h?a/h:null}(i,t,r),i,t,r,i.cache.ipData);return null==n||isNaN(n)?0:n}function y(e,t,r){return null==e?null:Object(c.c)(e)?g(e,t,r):Object(c.d)(e)?e:null}function v(e,t,r){return Object(c.d)(r)&&e>r?r:Object(c.d)(t)&&e<t?t:e}function O(e,t,r,i,n){switch(t.transformationType){case"additive":return function(e,t,r,i){return e+(y(t.minSize,r,i)||t.minDataValue)}(e,t,r,i);case"constant":return function(e,t,r){const i=e.stops;let n=i&&i.length&&i[0].size;return null==n&&(n=e.minSize),y(n,t,r)}(t,r,i);case"clamped-linear":return function(e,t,r,i){const n=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),s=y(t.minSize,r,i),a=y(t.maxSize,r,i),l=Object(o.j)(i)?i.shape:void 0;if(e<=t.minDataValue)return s;if(e>=t.maxDataValue)return a;if("area"===t.scaleBy&&l){const e="circle"===l,t=e?h*(s/2)**2:s*s,r=t+n*((e?h*(a/2)**2:a*a)-t);return e?2*Math.sqrt(r/h):Math.sqrt(r)}return s+n*(a-s)}(e,t,r,i);case"proportional":return function(e,t,r,i){const n=Object(o.j)(i)?i.shape:void 0,s=e/t.minDataValue,a=y(t.minSize,r,i),l=y(t.maxSize,r,i);let c=null;return c="circle"===n?2*Math.sqrt(s*(a/2)**2):"square"===n||"diamond"===n||"image"===n?Math.sqrt(s*a**2):s*a,v(c,a,l)}(e,t,r,i);case"stops":return function(e,t,r,i,n){const[s,a,o]=w(e,n);if(s===a)return y(t.stops[s].size,r,i);{const e=y(t.stops[s].size,r,i);return e+(y(t.stops[a].size,r,i)-e)*o}}(e,t,r,i,n);case"real-world-size":return function(e,t,r,i){const n=(Object(o.j)(i)&&i.resolution?i.resolution:1)*l.a[t.valueUnit],s=y(t.minSize,r,i),a=y(t.maxSize,r,i),{valueRepresentation:c}=t;let u=null;return u="area"===c?2*Math.sqrt(e/h)/n:"radius"===c||"distance"===c?2*e/n:e/n,v(u,s,a)}(e,t,r,i);case"identity":return e;case"unknown":return null}}function j(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&"3d"===r||t))return null;const n={scale:t,view:r};let s=y(e.minSize,d,n),a=y(e.maxSize,d,n);if(null!=s||null!=a){if(s>a){const e=a;a=s,s=e}return{minSize:s,maxSize:a}}}function _(e,t,r){if(!e.visualVariables)return;const i=[],n=[],s=[],a=[],o=[];for(const l of e.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":o.push(l);break;case"size":a.push(l)}return n.forEach((e=>{const n=f(e,t,r);i.push({variable:e,value:n})})),s.forEach((e=>{const n=b(e,t,r);i.push({variable:e,value:n})})),o.forEach((e=>{const n=m(e,t,r);i.push({variable:e,value:n})})),a.forEach((e=>{const n=g(e,t,r);i.push({variable:e,value:n})})),i.filter((e=>null!=e.value))}function w(e,t){if(!t)return;let r=0,i=t.length-1;return t.some(((t,n)=>e<t?(i=n,!0):(r=n,!1))),[r,i,(e-t[r])/(t[i]-t[r])]}function x(e,t,r){const i=["proportional","proportional","proportional"];for(const n of e){const e=n.useSymbolValue?"symbol-value":g(n,t,r);switch(n.axis){case"width":i[0]=e;break;case"depth":i[1]=e;break;case"height":i[2]=e;break;case"width-and-depth":i[0]=e,i[1]=e;break;case"all":case void 0:case null:i[0]=e,i[1]=e,i[2]=e;break;default:Object(s.a)(n.axis)}}return i}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n}));var i=r(301);function n(e){return null!=i.a[e]}function s(e){return 1/(i.a[e]||1)}const a=function(){const e=Object.keys(i.a);return e.sort(),e}()},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(377);let l=i=class extends o.a{constructor(e){super(e),this.type="selection"}clone(){return new i}};Object(n.a)([Object(s.b)({type:["selection"]})],l.prototype,"type",void 0),l=i=Object(n.a)([Object(a.a)("esri.layers.support.FeatureReductionSelection")],l);var c=l;t.a=c},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(4)),l=r(170);let c=i=class extends l.a{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new i({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Object(s.a)(this.outFields):null})}};Object(n.a)([Object(a.b)()],c.prototype,"creator",void 0),Object(n.a)([Object(a.b)()],c.prototype,"destroyer",void 0),Object(n.a)([Object(a.b)()],c.prototype,"outFields",void 0),Object(n.a)([Object(a.b)({type:["custom"],readOnly:!0})],c.prototype,"type",void 0),c=i=Object(n.a)([Object(o.a)("esri.popup.content.CustomContent")],c);var u=c;t.a=u},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r(10),n=r(2);function s(e){switch(e){case"multiply":return 1;case"ignore":return 2;case"replace":return 3;case"tint":return 4;default:return 1}}function a(e,t,r){if(Object(n.i)(e)||2===t)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const s=Object(i.e)(Math.round(e[3]*l),0,l),a=0===s||4===t?0:3===t?c:u;r[0]=Object(i.e)(Math.round(e[0]*o),0,o),r[1]=Object(i.e)(Math.round(e[1]*o),0,o),r[2]=Object(i.e)(Math.round(e[2]*o),0,o),r[3]=s+a}const o=255,l=85,c=l,u=2*l},function(e,t,r){"use strict";function i(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u)i[l]=s[c],i[l+1]=s[c+1],i[l+2]=s[c+2],i[l+3]=s[c+3],l+=n,c+=a}function n(e,t,r,i,n,s){var a,o;const l=e.typedBuffer,c=e.typedBufferStride,u=null!=(a=null==s?void 0:s.count)?a:e.count;let d=(null!=(o=null==s?void 0:s.dstIndex)?o:0)*c;for(let h=0;h<u;++h)l[d]=t,l[d+1]=r,l[d+2]=i,l[d+3]=n,d+=c}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));Object.freeze({__proto__:null,copy:i,fill:n})},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(527),n=r(493),s=r(6);function a(e,t){e.extensions.add("GL_OES_standard_derivatives"),3!==t.pbrMode&&4!==t.pbrMode||e.include(n.a,t),e.vertex.uniforms.add("overlayTexOffset","vec4"),e.vertex.uniforms.add("overlayTexScale","vec4"),e.varyings.add("vtcOverlay","vec4"),e.vertex.code.add(s.a`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),e.fragment.uniforms.add("ovColorTex","sampler2D"),e.fragment.uniforms.add("overlayOpacity","float"),e.fragment.code.add(s.a`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.fragment.code.add(s.a`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),3!==t.pbrMode&&4!==t.pbrMode||(e.include(i.a),e.fragment.code.add(s.a`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);
return vec4(final, colorInput.w);
}`))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return u}));var i=r(2),n=r(79);let s;var a=r(47),o=r(78);let l=null,c=null;async function u(){return Object(i.i)(c)&&(c=function(){if(Object(i.i)(s)){const e=e=>Object(n.b)(`esri/libs/basisu/${e}`);s=Promise.all([r.e(81),r.e(144)]).then(r.bind(null,1052)).then((function(e){return e.b})).then((({default:t})=>t({locateFile:e}).then((e=>(e.initializeBasis(),delete e.then,e)))))}return s}(),l=await c),c}function d(e,t){if(Object(i.i)(l))return e.byteLength;const r=new l.BasisFile(new Uint8Array(e)),n=f(r)?p(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),n}function h(e,t){if(Object(i.i)(l))return e.byteLength;const r=new l.KTX2File(new Uint8Array(e)),n=b(r)?p(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),n}function p(e,t,r,i,n){const s=Object(o.b)(t?37496:37492),a=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*i*s*a)}function f(e){return e.getNumImages()>=1&&!e.isUASTC()}function b(e){return e.getFaces()>=1&&e.isETC1S()}async function m(e,t,r){Object(i.i)(l)&&(l=await u());const n=new l.BasisFile(new Uint8Array(r));if(!f(n))return null;n.startTranscoding();const s=y(e,t,n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),((e,t)=>n.getImageTranscodedSizeInBytes(0,e,t)),((e,t,r)=>n.transcodeImage(r,0,e,t,0,0)));return n.close(),n.delete(),s}async function g(e,t,r){Object(i.i)(l)&&(l=await u());const n=new l.KTX2File(new Uint8Array(r));if(!b(n))return null;n.startTranscoding();const s=y(e,t,n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),((e,t)=>n.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,r)=>n.transcodeImage(r,e,0,0,t,0,-1,-1)));return n.close(),n.delete(),s}function y(e,t,r,i,n,s,o,l){const{compressedTextureETC:c,compressedTextureS3TC:u}=e.capabilities,[d,h]=c?i?[1,37496]:[0,37492]:u?i?[3,33779]:[2,33776]:[13,6408],p=t.hasMipmap?r:Math.min(1,r),f=[];for(let a=0;a<p;a++)f.push(new Uint8Array(o(a,d))),l(a,d,f[a]);const b=f.length>1,m=b?9987:9729,g={...t,samplingMode:m,hasMipmap:b,internalFormat:h,width:n,height:s};return new a.a(e,g,{type:"compressed",levels:f})}},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(13),o=r(1),l=r(9),c=(r(8),r(7),r(37)),u=r(4),d=r(394);let h=i=class extends d.a{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new i({fromColor:Object(a.a)(this.fromColor),toColor:Object(a.a)(this.toColor),algorithm:this.algorithm})}};Object(n.a)([Object(c.a)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],h.prototype,"algorithm",void 0),Object(n.a)([Object(o.b)({type:s.a,json:{type:[l.a],write:!0}})],h.prototype,"fromColor",void 0),Object(n.a)([Object(o.b)({type:s.a,json:{type:[l.a],write:!0}})],h.prototype,"toColor",void 0),Object(n.a)([Object(o.b)({type:["algorithmic"]})],h.prototype,"type",void 0),h=i=Object(n.a)([Object(u.a)("esri.rest.support.AlgorithmicColorRamp")],h);var p=h;t.a=p},function(e,t,r){"use strict";var i,n=r(0),s=r(86),a=r(14),o=r(1),l=(r(8),r(9),r(7),r(4)),c=r(174);let u=i=class extends a.a{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new i({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],u.prototype,"description",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],u.prototype,"label",void 0),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],u.prototype,"minValue",void 0),Object(n.a)([Object(o.b)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],u.prototype,"maxValue",void 0),Object(n.a)([Object(o.b)({types:s.i,json:{origins:{"web-scene":{types:s.j,write:c.b}},write:c.b}})],u.prototype,"symbol",void 0),u=i=Object(n.a)([Object(l.a)("esri.renderers.support.ClassBreakInfo")],u);var d=u;t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r(522),n=r(6);function s(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(i.b),e.fragment.code.add(n.a`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}function a(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},function(e,t,r){"use strict";var i=r(2),n=r(176);const s={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};t.a=class{constructor(e,t,r=null,i=null){this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.scale=1,this.offset=[0,0],this.opacity=1,this.lij=e,this.source=t,this.width=r||t.width,this.height=i||t.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._memoryUsed=null)}get symbolizerParameters(){return this.isRendereredSource?{...s,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||s}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){Object(i.j)(e)&&e.length>0?this._bandIds&&e.every(((e,t)=>!!this._bandIds[t]&&e===this._bandIds[t]))||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation}set interpolation(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===e?9729:9728)}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&(this._rasterTexture&&!this._dirty||this._updateRasterTexture(e,this.bandIds),this._rasterTexture&&(this._updateColormapTexture(e),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=Object(n.c)(e,this.transformGrid))),!0)}getUniforms(){const e=Object(n.d)(this.scale,this.offset),{symbolizerParameters:t,transformGrid:r,width:i,height:s,opacity:a}=this;return{basic:e,common:Object(n.f)(r,[i,s],[this.source.width,this.source.height],a),colormap:t.colormap?Object(n.e)(t.colormap,t.colormapOffset):null,stretch:"stretch"===this.symbolizerParameters.type?Object(n.h)(this.symbolizerParameters):null,hillshade:"hillshade"===this.symbolizerParameters.type?Object(n.g)(this.symbolizerParameters):null}}getTextures(){const e=new Array,t=[];return this._rasterTexture&&(t.push(this._rasterTexture),e.push("u_image"),this._transformGridTexture&&(t.push(this._transformGridTexture),e.push("u_transformGrid")),this._colormapTexture&&(t.push(this._colormapTexture),e.push("u_colormap"))),{names:e,textures:t}}get memoryUsage(){if(Object(i.i)(this._memoryUsed)){const e=this.getTextures();if(null==e)return 0;this._memoryUsed=e.textures.map((e=>e.descriptor.width*e.descriptor.height*4)).reduce(((e,t)=>e+t),0)}return this._memoryUsed}release(){return this._rasterTexture=Object(i.f)(this._rasterTexture),this._transformGridTexture=Object(i.f)(this._transformGridTexture),this._colormapTexture=Object(i.f)(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,t){const r=this.source?this.source.extractBands(t):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null));const s=Object(i.i)(t)&&Object(i.i)(this.bandIds)||Object(i.j)(t)&&Object(i.j)(this.bandIds)&&t.join("")===this.bandIds.join("");if(this._rasterTexture){if(s)return;this._rasterTexture.dispose(),this._rasterTexture=null}this._rasterTexture=Object(n.b)(e,r,this.interpolation||"nearest",this.isRendereredSource)}_updateColormapTexture(e){const t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some(((e,r)=>e!==t[r]))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=Object(n.a)(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=Object(n.a)(e,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));r(163),r(130),r(295),r(8),r(7);r(491),r(24),r(69);function i(e){return e&&"function"==typeof e.render}function n(e){return e&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(14),o=r(2),l=r(17),c=r(1),u=(r(8),r(9),r(7),r(4)),d=r(116);let h=i=class extends a.a{constructor(){super(...arguments),this.color=new s.a([0,0,0,1]),this.size=Object(l.h)(1),this.stipplePattern=null,this.stippleOffColor=null}clone(){return new i({color:Object(o.j)(this.color)?this.color.clone():null,size:this.size,stipplePattern:this.stipplePattern?this.stipplePattern.slice():null,stippleOffColor:this.stippleOffColor?this.stippleOffColor.clone():null})}};Object(n.a)([Object(c.b)(d.a)],h.prototype,"color",void 0),Object(n.a)([Object(c.b)(d.b)],h.prototype,"size",void 0),Object(n.a)([Object(c.b)(d.c)],h.prototype,"stipplePattern",void 0),Object(n.a)([Object(c.b)({type:s.a})],h.prototype,"stippleOffColor",void 0),h=i=Object(n.a)([Object(u.a)("esri.symbols.support.Symbol3DOutline")],h);var p=h;t.a=p},function(e,t,r){"use strict";var i,n=r(0),s=r(86),a=r(14),o=r(1),l=(r(8),r(9),r(7),r(4)),c=r(174);let u=i=class extends a.a{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new i({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],u.prototype,"description",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],u.prototype,"label",void 0),Object(n.a)([Object(o.b)({types:s.i,json:{origins:{"web-scene":{types:s.j,write:c.b}},write:c.b}})],u.prototype,"symbol",void 0),Object(n.a)([Object(o.b)({type:[String,Number],json:{type:String,write:{writer:(e,t)=>{t.value=null==e?void 0:e.toString()}}}})],u.prototype,"value",void 0),u=i=Object(n.a)([Object(l.a)("esri.renderers.support.UniqueValueInfo")],u);var d=u;t.a=d},function(e,t,r){"use strict";var i=r(0),n=r(44),s=r(14),a=r(13),o=r(1),l=(r(9),r(8),r(7),r(4)),c=r(29);const u=new n.a({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let d=class extends s.a{constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}writeDrawingTool(e,t){t.drawingTool=u.toJSON(e)}writePrototype(e,t){t.prototype=Object(a.c)(Object(a.a)(e),!0)}writeThumbnail(e,t){t.thumbnail=Object(a.c)(Object(a.a)(e))}};Object(i.a)([Object(o.b)({json:{write:!0}})],d.prototype,"name",void 0),Object(i.a)([Object(o.b)({json:{write:!0}})],d.prototype,"description",void 0),Object(i.a)([Object(o.b)({json:{read:u.read,write:u.write}})],d.prototype,"drawingTool",void 0),Object(i.a)([Object(c.a)("drawingTool")],d.prototype,"writeDrawingTool",null),Object(i.a)([Object(o.b)({json:{write:!0}})],d.prototype,"prototype",void 0),Object(i.a)([Object(c.a)("prototype")],d.prototype,"writePrototype",null),Object(i.a)([Object(o.b)({json:{write:!0}})],d.prototype,"thumbnail",void 0),Object(i.a)([Object(c.a)("thumbnail")],d.prototype,"writeThumbnail",null),d=Object(i.a)([Object(l.a)("esri.layers.support.FeatureTemplate")],d);var h=d;t.a=h},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c}));var i=r(201),n=r(18),s=r(3),a=r(5),o=r(112);r(34);function l(e,t,r){const i=Object(n.d)(e,t),s=Object(n.d)(t,r),a=Object(n.d)(r,e),o=(i+s+a)/2,l=o*(o-i)*(o-s)*(o-a);return l<=0?0:Math.sqrt(l)}function c(e,t,r){return Object(s.l)(u,t,e),Object(s.l)(d,r,e),Object(s.r)(Object(s.i)(u,u,d))/2}new i.a(o.c),new i.a((()=>({p0:null,p1:null,p2:null})));const u=Object(a.e)(),d=Object(a.e)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));r(8);var i=r(160);function n(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function s(e,t){const r=(e,r,n=!1)=>({levels:e.map((e=>{const s=r(e.tesselation);return n&&i.a.cgToGIS(s),{components:[{geometry:s,material:t}],faceCount:s.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}}))});switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(e=>i.a.createPolySphereGeometry(.5,e,!0)));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>i.a.createBoxGeometry(1)));case"cone":return r(a,(e=>i.a.createConeGeometry(1,.5,e,!1)),!0);case"inverted-cone":return r(a,(e=>i.a.createConeGeometry(1,.5,e,!0)),!0);case"cylinder":return r(a,(e=>i.a.createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5])));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>i.a.createTetrahedronGeometry(1)),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>i.a.createDiamondGeometry(1)),!0);default:return}}const a=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l}));var i=r(10),n=r(40),s=r(28),a=r(281);class o{constructor(e,t){this.index=e,this.renderTargets=t,this.extent=Object(s.k)(),this.resolution=0,this.viewport=Object(s.k)(),this.renderLocalOrigin=Object(a.a)(0,0,0,"O"),this.pixelRatio=1,this.canvasGeometries={extents:[Object(s.k)(),Object(s.k)(),Object(s.k)()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}getValidTarget(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}get needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}getNormalTexture(e){const t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}draw(e,t){const r=this.computeRenderTargetValidityBitfield(),i=this.needsColorWithoutRasterImage;for(const n of this.renderTargets.renderTargets)1===n.type&&!1===i?this.validTargets[n.type]=!1:this.validTargets[n.type]=e.drawTarget(this,n,t);return r^this.computeRenderTargetValidityBitfield()?0:1}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this.extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(s.x)(this.extent,e.range,0,t)}if(this.extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(s.x)(this.extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Object(s.y)(this.canvasGeometries.extents[0],this.extent),Object(n.l)(this.viewport,0,0,this.resolution,this.resolution)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){const t=this.viewport;0===this.index?e.setViewport(t[0],t[1],t[2],t[3]):e.setViewport(t[0]+this.resolution,t[1],t[2],t[3])}}function l(e,t,r){return Math.min(Object(i.p)(Math.max(e,t)+256),r)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(184),n=r(521);class s extends i.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(n.a,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){if(2===this._output)return 22===e;if(5===this._output)return null==e;if(4===this._output)return 3===e;let t=3;return this._material.params.transparent&&(t=this._material.params.writeDepth?5:8),e===t}setElapsedTimeUniform(e){const t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.params.animationSpeed)}_updateShadowState(e){e.shadowMappingEnabled!==this._material.params.receiveShadows&&this._material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}_updateSSRState(e){e.ssrEnabled!==this._material.params.ssrEnabled&&this._material.setParameterValues({ssrEnabled:e.ssrEnabled})}ensureResources(e){return this._technique.ensureResource(e)}ensureParameters(e){0===this._output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.params,e),2!==this._output&&0!==this._output||this.setElapsedTimeUniform(this._technique.program)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return c}));var i=r(2),n=r(258),s=r(101),a=r(523);const o=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class l{constructor(){this.triangles=0,this.drawCalls=0}reset(){this.triangles=0,this.drawCalls=0}}function c(e,t,r){Object(i.j)(r)&&(r.drawCalls+=e,r.triangles+=t)}class u extends n.a{constructor(){super("total"),this.total=0,this.frameCount=0}}class d{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new u,this.gpuTime=new n.a("gpu",9),this.renderPassTimings=o.map((e=>new n.a(e))),this.stats=new l}enableGPUTimer(){return++this._enableGPUTimer,{remove:Object(s.d)((()=>--this._enableGPUTimer))}}prerender(e){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=Object(a.a)(e))}advance(e){const t=performance.now();this.renderPassTimings[e].record(t-this._lastSample),this._lastSample=t}postrender(){Object(i.j)(this._gpuTimer)&&(this._gpuTimer.stop((e=>Object(i.j)(e)&&this.gpuTime.record(e)),16),this._gpuTimer=null);const e=performance.now()-this._startTime;this.totalTime.record(e),this.totalTime.total+=e,this.totalTime.frameCount++}}},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(14),o=r(2),l=r(1),c=(r(8),r(9),r(7),r(4)),u=r(362);let d=i=class extends a.a{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=Object(o.j)(e)?e.get(this):null;if(r)return r;const n=new i(this.clonePropertiesWithDeduplication(t));return Object(o.j)(e)&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{color:Object(o.j)(this.color)?this.color.clone():null,colorTexture:Object(o.j)(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:Object(o.j)(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};Object(n.a)([Object(l.b)({type:s.a,json:{write:!0}})],d.prototype,"color",void 0),Object(n.a)([Object(l.b)({type:u.a,json:{write:!0}})],d.prototype,"colorTexture",void 0),Object(n.a)([Object(l.b)({type:u.a,json:{write:!0}})],d.prototype,"normalTexture",void 0),Object(n.a)([Object(l.b)({nonNullable:!0,json:{write:!0}})],d.prototype,"alphaMode",void 0),Object(n.a)([Object(l.b)({nonNullable:!0,json:{write:!0}})],d.prototype,"alphaCutoff",void 0),Object(n.a)([Object(l.b)({nonNullable:!0,json:{write:!0}})],d.prototype,"doubleSided",void 0),d=i=Object(n.a)([Object(c.a)("esri.geometry.support.MeshMaterial")],d);var h=d;t.a=h},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return s}));r(8);var i=r(5),n=r(22);function s(e,{isPrimitive:t,width:r,depth:n,height:s}){const a=t?10:1;if(null==r&&null==s&&null==n)return[a*e[0],a*e[1],a*e[2]];const o=Object(i.g)(r,n,s);let l;for(let i=0;i<3;i++){const t=o[i];if(null!=t){l=t/e[i];break}}for(let i=0;i<3;i++)null==o[i]&&(o[i]=e[i]*l);return o}const a=Object(n.t)(-.5,-.5,-.5,.5,.5,.5),o=Object(n.t)(-.5,-.5,0,.5,.5,1),l=Object(n.t)(-.5,-.5,0,.5,.5,.5);function c(e){switch(e){case"sphere":case"cube":case"diamond":return a;case"cylinder":case"cone":case"inverted-cone":return o;case"tetrahedron":return l;default:return}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return O}));var i=r(84),n=r(102),s=r(11),a=r(7),o=r(2),l=r(12),c=r(324),u=r(5),d=r(22),h=r(142),p=r(100),f=r(193),b=r(199);const m=a.a.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function g(e,t){const r=await async function(e,t){const r=Object(o.j)(t)&&t.streamDataRequester;if(r)return async function(e,t,r){const i=await Object(n.d)(t.request(e,"json",r));if(!0===i.ok)return i.value;Object(l.w)(i.error),y(i.error.details.url)}(e,r,t);const s=await Object(n.d)(Object(i.default)(e,Object(o.s)(t)));if(!0===s.ok)return s.value.data;Object(l.w)(s.error),y(s.error)}(e,t);return{resource:r,textures:await _(r.textureDefinitions,t)}}function y(e){throw new s.a("",`Request for object resource failed: ${e}`)}function v(e){const t=e.params,r=t.topology;let i=!0;switch(t.vertexAttributes||(m.warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const r in t.vertexAttributes){const t=e[r];t&&t.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(m.warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),i=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(m.warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),i=!1)):(m.warn(`Indexed geometry does not specify face indices for '${r}' attribute`),i=!1)}}else m.warn("Indexed geometries must specify faces"),i=!1;break}default:m.warn(`Unsupported topology '${r}'`),i=!1}e.params.material||(m.warn("Geometry requires material"),i=!1);const n=e.params.vertexAttributes;for(const s in n)n[s].values||(m.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function O(e,t){const r=[],i=[],n=[],s=[],a=e.resource,l=c.a.parse(a.version||"1.0","wosr");S.validate(l);const d=a.model.name,h=a.model.geometries,m=a.materialDefinitions,g=e.textures;let y=0;const O=new Map;for(let c=0;c<h.length;c++){const e=h[c];if(!v(e))continue;const a=x(e),l=e.params.vertexAttributes,d=[];for(const t in l){const e=l[t],r=e.values;d.push([t,{data:r,size:e.valuesPerElement,exclusive:!0}])}const j=[];if("PerAttributeArray"!==e.params.topology){const t=e.params.faces;for(const e in t)j.push([e,new Uint32Array(t[e].values)])}const _=g&&g[a.texture];if(_&&!O.has(a.texture)){const{image:e,params:t}=_,r=new f.a(e,t);s.push(r),O.set(a.texture,r)}const S=O.get(a.texture),T=S?S.id:void 0;let C=n[a.material]?n[a.material][a.texture]:null;if(!C){const e=m[a.material.substring(a.material.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const r=_&&_.alphaChannelUsage,i=e.transparency>0||"transparency"===r||"maskAndTransparency"===r,s={ambient:Object(u.f)(e.diffuse),diffuse:Object(u.f)(e.diffuse),opacity:1-(e.transparency||0),transparent:i,textureAlphaMode:_?w(_.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:T,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};Object(o.j)(t)&&t.materialParamsMixin&&Object.assign(s,t.materialParamsMixin),C=new b.a(s),n[a.material]||(n[a.material]={}),n[a.material][a.texture]=C}i.push(C);const M=new p.a(d,j);y+=j.position?j.position.length:0,r.push(M)}return{name:d,stageResources:{textures:s,materials:i,geometries:r},pivotOffset:a.model.pivotOffset,boundingBox:j(r),numberOfVertices:y,lodThreshold:null}}function j(e){const t=Object(d.k)();return e.forEach((e=>{const r=e.boundingInfo;Object(o.j)(r)&&(Object(d.r)(t,r.getBBMin()),Object(d.r)(t,r.getBBMax()))})),t}async function _(e,t){const r=[];for(const s in e){const i=e[s],n=i.images[0].data;if(!n){m.warn("Externally referenced texture data is not yet supported");continue}const a=i.encoding+";base64,"+n,l="/textureDefinitions/"+s,c={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0},u=Object(o.j)(t)&&t.disableTextures?Promise.resolve(null):Object(h.a)(a,t);r.push(u.then((e=>({refId:l,image:e,params:c,alphaChannelUsage:"rgba"===i.channels?i.alphaChannelUsage||"transparency":"none"}))))}const i=await Promise.all(r),n={};for(const s of i)n[s.refId]=s;return n}function w(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;case"transparency":default:return 0}}function x(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const S=new c.a(1,2,"wosr")},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o}));var i=r(2);class n{constructor(e,t,r=2048){this.text=e,this._parameters=t,this.maxSize=r,this._lineWidths=new Array,this._renderPixelRatio=null,this._displayWidth=null,this.key=`${this._parameters.key}--${e}`,this._lines=e.split(/\r?\n/),this._lineHeight=this.computeLineHeight()}get displayWidth(){return this._ensureTextWidth()}get displayHeight(){return this._lineHeight*this._lines.length}get renderedWidth(){return Math.round(this.displayWidth*this.renderPixelRatio)}get renderedHeight(){return Math.round(this.displayHeight*this.renderPixelRatio)}get renderedLineHeight(){return Math.round(this._lineHeight*this.renderPixelRatio)}get renderedFontSize(){return this._parameters.definition.size*this.renderPixelRatio}get renderedHaloSize(){return this._parameters.haloSize*this.renderPixelRatio}get renderPixelRatio(){if(Object(i.i)(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/(this.displayWidth*e),this.maxSize/(this.displayHeight*e))):this._renderPixelRatio=e}return this._renderPixelRatio}getLineXOffset(e){return Math.round((this.renderedWidth-this._lineWidths[e]*this.renderPixelRatio)/2)}render(e,t=0,r=0){const i=this.renderedLineHeight,n=this.renderedHaloSize,a=function(e,t){return"center"===e?.5*t:"right"===e?t:0}(e.textAlign,this.renderedWidth)+n,o=n+s;e.save(),n>0&&this.renderHalo(e,a,o,t,r),this.setFontProperties(e,this.renderedFontSize),r+=o,t+=a;for(let s=0;s<this._lines.length;++s){e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)";const n=this._lines[s],a=this.getLineXOffset(s);e.fillText(n,t+a,r),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.fillStyle,e.fillText(n,t+this.getLineXOffset(s),r),r+=i}e.restore()}renderHalo(e,t,r,i,n){const s=this.renderedWidth,a=this.renderedHeight,u=o(l,Math.max(s,c),Math.max(a,c)),d=u.getContext("2d");d.clearRect(0,0,s,a),this.setFontProperties(d,this.renderedFontSize),d.fillStyle=this._parameters.haloStyle,d.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;d.lineJoin=h?"miter":"round",h?this.renderHaloEmulated(d,t,r):this.renderHaloNative(d,t,r),e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(u,0,0,s,a,i,n,s,a),e.globalAlpha=1}renderHaloEmulated(e,t,r){const i=this.renderedLineHeight,n=this.renderedHaloSize;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],l=this.getLineXOffset(s);for(const[i,s]of a)e.fillText(o,t+l+n*i,r+n*s);r+=i}}renderHaloNative(e,t,r){const i=this.renderedLineHeight,n=this.renderedHaloSize;for(let s=0;s<this._lines.length;++s){const a=2*n,o=this._lines[s],l=this.getLineXOffset(s),c=5,u=.1;for(let i=0;i<c;i++){const n=1-(c-1)*u+i*u;e.lineWidth=n*a,e.strokeText(o,t+l,r)}r+=i}}setFontProperties(e,t){const r=this._parameters.definition.font,i=`${r.style} ${r.weight} ${t}px ${r.family}, sans-serif`;e.font=i,e.textAlign="left",e.textBaseline="top"}_ensureTextWidth(){if(Object(i.j)(this._displayWidth))return this._displayWidth;const e=o(l,c,c).getContext("2d");this.setFontProperties(e,this._parameters.definition.size);let t=0,r=2*this._parameters.haloSize;this._lineWidths.length=0;const n=this._parameters.definition.font;("italic"===n.style||"oblique"===n.style||"string"==typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"==typeof n.weight&&n.weight>600)&&(r+=.3*e.measureText("A").width);for(const i of this._lines){const n=Math.round(e.measureText(i).width+r);this._lineWidths.push(n),t=Math.max(t,n)}return this._displayWidth=t,this._displayWidth}computeLineHeight(){const e=1.275*this._parameters.definition.size;return Math.ceil(e+2*this._parameters.haloSize)+s}}const s=1,a=[];{const e=16;for(let t=0;t<360;t+=360/e)a.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}function o(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}const l={canvas:null},c=512},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var i=r(2);function n(e,t){if(!e.target)return null;switch(e.target.type){case"stage":return o(e.target.obj.metadata,t);case"external":switch(e.intersector){case"PointRenderer":return function(e,t){const r=e.metadata.layerUid;return null!=r?t.map.findLayerByUid(r):null}(e.target,t);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return o(e.target.metadata,t);case"TerrainRenderer":return t.map&&t.map.ground}}return null}function s(e,t){if(!e.target)return null;switch(e.target.type){case"stage":return a(e.target.obj.metadata,t);case"external":switch(e.intersector){case"PointRenderer":return function(e){return e.metadata.createGraphic()}(e.target);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return a(e.target.metadata,t)}}return null}function a(e,t){if(Object(i.i)(e))return null;const r=o(e,t);if(Object(i.i)(r))return null;if(r===t.graphics)return Object(i.j)(t.graphicsView)?Object(i.s)(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;const n=t.allLayerViews.find((e=>e.layer===r));return n?(a=e,!(s=n)||s.suspended?null:"getGraphicFromIntersectorMetadata"in s&&a?s.getGraphicFromIntersectorMetadata(a):"getGraphicFromGraphicUid"in s&&null!=a.graphicUid?s.getGraphicFromGraphicUid(a.graphicUid):null):null;var s,a}function o(e,t){return Object(i.i)(e)||null==e.layerUid?null:Object(i.j)(t.graphicsView)&&e.layerUid===t.graphicsView.graphics3d.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return p}));var i=r(0),n=r(11),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(29),l=r(320),c=r(386);const u={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,VectorTileLayer:!0,WMS:!0,KML:!0,RasterDataLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};var d=r(177);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(e,t,r,i){(i&&"ground"===i.layerContainerType||e&&Object(c.a)(this,r,{},i))&&(t[r]=e)}writeOperationalLayerType(e,t,r,i){!e||i&&"tables"===i.layerContainerType||(t.layerType=e)}writeTitle(e,t){t.title=e||"Layer"}read(e,t){t&&(t.layer=this),Object(l.b)(this,e,(t=>super.read(e,t)),t)}write(e,t){if(t&&t.origin){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`,r=u[e];let i=r&&r[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(i=!1),!i)return t.messages&&t.messages.push(new n.a("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const r=super.write(e,{...t,layer:this}),i=!!t&&!!t.messages&&!!t.messages.filter((e=>e instanceof n.a&&"web-document-write:property-required"===e.name)).length;return!this.url&&i?null:r}beforeSave(){}};return Object(i.a)([Object(s.b)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),Object(i.a)([Object(s.b)({json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}})],t.prototype,"listMode",void 0),Object(i.a)([Object(o.a)("listMode")],t.prototype,"writeListMode",null),Object(i.a)([Object(s.b)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),Object(i.a)([Object(o.a)("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),Object(i.a)([Object(s.b)(d.h)],t.prototype,"opacity",void 0),Object(i.a)([Object(s.b)({type:String,json:{write:{ignoreOrigin:!0,allowNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,allowNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),Object(i.a)([Object(o.a)("title")],t.prototype,"writeTitle",null),Object(i.a)([Object(s.b)({type:Boolean,json:{name:"visibility",origins:{"web-document":{name:"visibility",default:!0},"portal-item":{name:"visibility",read:{source:["visible","visibility"]}}}}})],t.prototype,"visible",void 0),t=Object(i.a)([Object(a.a)("esri.layers.mixins.OperationalLayer")],t),t};function p(e){return"operationalLayerType"in e}},function(e,t,r){"use strict";var i,n=r(0),s=r(86),a=r(44),o=r(13),l=r(7),c=r(2),u=r(1),d=r(45),h=(r(8),r(37)),p=r(32),f=r(4),b=r(29),m=r(9),g=r(89),y=r(179),v=r(274),O=r(425),j=r(333),_=r(369),w=r(139);const x=l.a.getLogger("esri.renderers.ClassBreaksRenderer"),S="percent-of-total",T="field",C=new a.a({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:S,esriNormalizeByField:T}),M=Object(m.m)(O.a);let P=i=class extends(Object(v.a)(y.a)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let i=t.minValue;return e.map((e=>{const t=new O.a;return t.read(e,r),null==t.minValue&&(t.minValue=i),null==t.maxValue&&(t.maxValue=t.minValue),i=t.maxValue,t}))}writeClassBreakInfos(e,t,r,i){const n=e.map((e=>e.write({},i)));this._areClassBreaksConsecutive()&&n.forEach((e=>delete e.classMinValue)),t[r]=n}castField(e){return null==e?e:"function"==typeof e?(x.error(".field: field must be a string value"),null):Object(m.l)(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=(t?T:r&&S)||null,t&&r&&x.warn("warning: both normalizationField and normalizationTotal are set!")):e!==T&&e!==S||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let i=null;i="number"==typeof e?new O.a({minValue:e,maxValue:t,symbol:Object(s.a)(r)}):M(Object(o.a)(e)),this.classBreakInfos.push(i),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]===e&&r[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(Object(c.i)(t)||Object(c.i)(t.arcade))&&x.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&(Object(c.i)(t)||Object(c.i)(t.arcade))&&(r={...r,arcade:await Object(w.e)()});const i=this.getBreakIndex(e,r);return-1!==i?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&(Object(c.i)(t)||Object(c.i)(t.arcade)))return void x.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(Object(c.i)(t)||Object(c.i)(t.arcade))){const e=await Object(w.e)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this.getBreakIndex(e,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new i({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:Object(o.a)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:Object(o.a)(this.visualVariables),legendOptions:Object(o.a)(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map((r=>r.collectRequiredFields(e,t))),Object(g.a)(e,t,this.valueExpression)];Object(g.d)(e,t,this.field),Object(g.d)(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=Object(c.t)(t,{});let a=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const o=Object(c.s)(s).arcadeUtils;if(!a){const e=o.createSyntaxTree(this.valueExpression);a=o.createFunction(e),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=this.valueExpression;const l=o.executeFunction(a,o.createExecContext(e,o.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,i=this.normalizationType;let n=parseFloat(r[t]);if(i){const e=this.normalizationTotal,t=parseFloat(r[this.normalizationField]);if("log"===i)n=Math.log(n)*Math.LOG10E;else if(i!==S||isNaN(e)){if(i===T&&!isNaN(t)){if(isNaN(n)||isNaN(t))return-1;n/=t}}else n=n/e*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}};Object(n.a)([Object(u.b)(j.a)],P.prototype,"backgroundFillSymbol",void 0),Object(n.a)([Object(u.b)({type:[O.a]})],P.prototype,"classBreakInfos",void 0),Object(n.a)([Object(p.a)("classBreakInfos")],P.prototype,"readClassBreakInfos",null),Object(n.a)([Object(b.a)("classBreakInfos")],P.prototype,"writeClassBreakInfos",null),Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],P.prototype,"defaultLabel",void 0),Object(n.a)([Object(u.b)(j.b)],P.prototype,"defaultSymbol",void 0),Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],P.prototype,"field",void 0),Object(n.a)([Object(d.a)("field")],P.prototype,"castField",null),Object(n.a)([Object(u.b)({type:Boolean})],P.prototype,"isMaxInclusive",void 0),Object(n.a)([Object(u.b)({type:_.a,json:{write:!0}})],P.prototype,"legendOptions",void 0),Object(n.a)([Object(u.b)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],P.prototype,"minValue",null),Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],P.prototype,"normalizationField",void 0),Object(n.a)([Object(u.b)({type:Number,cast:e=>Object(m.i)(e),json:{write:!0}})],P.prototype,"normalizationTotal",void 0),Object(n.a)([Object(u.b)({type:C.apiValues,value:null,json:{type:C.jsonValues,read:C.read,write:C.write}})],P.prototype,"normalizationType",null),Object(n.a)([Object(h.a)({classBreaks:"class-breaks"})],P.prototype,"type",void 0),Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],P.prototype,"valueExpression",void 0),Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],P.prototype,"valueExpressionTitle",void 0),P=i=Object(n.a)([Object(f.a)("esri.renderers.ClassBreaksRenderer")],P);var A=P;t.a=A},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return y}));var i=r(156);function n(e,t){return Object(i.e)(e,t)}function s(e,t){const r=e.hasZ&&t.hasZ;let i,n,s;if(e.xmin<=t.xmin){if(i=t.xmin,e.xmax<i)return!1}else if(i=e.xmin,t.xmax<i)return!1;if(e.ymin<=t.ymin){if(n=t.ymin,e.ymax<n)return!1}else if(n=e.ymin,t.ymax<n)return!1;if(r&&t.hasZ)if(e.zmin<=t.zmin){if(s=t.zmin,e.zmax<s)return!1}else if(s=e.zmin,t.zmax<s)return!1;return!0}function a(e,t){const{points:r,hasZ:n}=t,s=n?i.b:i.a;for(const i of r)if(s(e,i))return!0;return!1}const o=[0,0],l=[0,0],c=[0,0],u=[0,0],d=[o,l,c,u],h=[[c,o],[o,l],[l,u],[u,c]];function p(e,t){o[0]=e.xmin,o[1]=e.ymax,l[0]=e.xmax,l[1]=e.ymax,c[0]=e.xmin,c[1]=e.ymin,u[0]=e.xmax,u[1]=e.ymin;for(const r of d)if(Object(i.f)(t,r))return!0;for(const r of t.rings){if(!r.length)continue;let t=r[0];if(Object(i.a)(e,t))return!0;for(let n=1;n<r.length;n++){const s=r[n];if(Object(i.a)(e,s)||g(t,s,h))return!0;t=s}}return!1}function f(e,t){o[0]=e.xmin,o[1]=e.ymax,l[0]=e.xmax,l[1]=e.ymax,c[0]=e.xmin,c[1]=e.ymin,u[0]=e.xmax,u[1]=e.ymin;const r=t.paths;for(const n of r){if(!r.length)continue;let t=n[0];if(Object(i.a)(e,t))return!0;for(let r=1;r<n.length;r++){const s=n[r];if(Object(i.a)(e,s)||g(t,s,h))return!0;t=s}}return!1}const b=[0,0];function m(e){for(let t=0;t<e.length;t++){const r=e[t];for(let n=0;n<r.length-1;n++){const i=r[n],s=r[n+1];for(let r=t+1;r<e.length;r++)for(let t=0;t<e[r].length-1;t++){const n=e[r][t],a=e[r][t+1];if(y(i,s,n,a,b)&&!(b[0]===i[0]&&b[1]===i[1]||b[0]===n[0]&&b[1]===n[1]||b[0]===s[0]&&b[1]===s[1]||b[0]===a[0]&&b[1]===a[1]))return!0}}const i=r.length;if(!(i<=4))for(let e=0;e<i-3;e++){let t=i-1;0===e&&(t=i-2);const n=r[e],s=r[e+1];for(let i=e+2;i<t;i++){const e=r[i],t=r[i+1];if(y(n,s,e,t,b)&&!(b[0]===n[0]&&b[1]===n[1]||b[0]===e[0]&&b[1]===e[1]||b[0]===s[0]&&b[1]===s[1]||b[0]===t[0]&&b[1]===t[1]))return!0}}}return!1}function g(e,t,r){for(let i=0;i<r.length;i++)if(y(e,t,r[i][0],r[i][1]))return!0;return!1}function y(e,t,r,i,n){const[s,a]=e,[o,l]=t,[c,u]=r,[d,h]=i,p=d-c,f=s-c,b=o-s,m=h-u,g=a-u,y=l-a,v=m*b-p*y;if(0===v)return!1;const O=(p*g-m*f)/v,j=(b*g-y*f)/v;return O>=0&&O<=1&&j>=0&&j<=1&&(n&&(n[0]=s+O*(o-s),n[1]=a+O*(l-a)),!0)}function v(e){switch(e){case"esriGeometryEnvelope":case"extent":return s;case"esriGeometryMultipoint":case"multipoint":return a;case"esriGeometryPoint":case"point":return n;case"esriGeometryPolygon":case"polygon":return p;case"esriGeometryPolyline":case"polyline":return f}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u}));var i=r(0),n=r(7),s=r(12),a=r(48),o=(r(8),r(9),r(1)),l=r(4);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.refreshTimestamp=null,this.refreshDebounced=Object(s.j)((async(e,t)=>{let r;"number"==typeof e?r=e:(r=Date.now(),t=e),this._set("refreshTimestamp",r),this.doRefresh&&await this.doRefresh(t).catch((e=>{Object(s.n)(e)||n.a.getLogger(this.declaredClass).error(e)}))}),2e3)}refresh(e=Date.now()){this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh().catch((e=>{Object(s.n)(e)||n.a.getLogger(this.declaredClass).error(e)}))}};return Object(i.a)([Object(o.b)()],t.prototype,"layer",void 0),Object(i.a)([Object(a.a)("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),Object(i.a)([Object(o.b)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),t=Object(i.a)([Object(l.a)("esri.layers.mixins.RefreshableLayerView")],t),t};function u(e){return"refresh"in e}},function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return _}));var i=r(114),n=r(11),s=r(7),a=r(2),o=r(144),l=r(166),c=r(169),u=r(43),d=r(46),h=(r(113),r(84)),p=r(25),f=r(85);async function b(e,t,r){const i="string"==typeof e?Object(p.K)(e):e,n=t[0].spatialReference,s=Object(f.c)(t[0]),a={...r,query:{...i.query,f:"json",sr:n.wkid?n.wkid:JSON.stringify(n),geometries:JSON.stringify((o=t,{geometryType:Object(f.c)(o[0]),geometries:o.map((e=>e.toJSON()))}))}};var o;return function(e,t,r){const i=Object(f.b)(t);return e.map((e=>{const t=i.fromJSON(e);return t.spatialReference=r,t}))}((await Object(h.default)(i.path+"/simplify",a)).data,s,n)}const m=s.a.getLogger("esri.geometry.support.normalizeUtils");function g(e){return"polygon"===e[0].type}function y(e){return"polyline"===e[0].type}function v(e,t,r){if(t){const t=function(e,t){if(!(e instanceof l.a||e instanceof o.a)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw m.error(e),new n.a(e)}const r=Object(c.b)(e),i=[];for(const n of r){const e=[];i.push(e),e.push([n[0][0],n[0][1]]);for(let r=0;r<n.length-1;r++){const i=n[r][0],s=n[r][1],a=n[r+1][0],o=n[r+1][1],l=Math.sqrt((a-i)*(a-i)+(o-s)*(o-s)),c=(o-s)/l,u=(a-i)/l,d=l/t;if(d>1){for(let o=1;o<=d-1;o++){const r=o*t,n=u*r+i,a=c*r+s;e.push([n,a])}const r=(l+Math.floor(d-1)*t)/2,n=u*r+i,a=c*r+s;e.push([n,a])}e.push([a,o])}}return function(e){return"polygon"===e.type}(e)?new o.a({rings:i,spatialReference:e.spatialReference}):new l.a({paths:i,spatialReference:e.spatialReference})}(e,1e6);e=Object(d.e)(t,!0)}return r&&(e=Object(c.e)(e,r)),e}function O(e,t,r){if(Array.isArray(e)){const i=e[0];if(i>t){const r=Object(c.d)(i,t);e[0]=i+r*(-2*t)}else if(i<r){const t=Object(c.d)(i,r);e[0]=i+t*(-2*r)}}else{const i=e.x;if(i>t){const r=Object(c.d)(i,t);e=e.clone().offset(r*(-2*t),0)}else if(i<r){const t=Object(c.d)(i,r);e=e.clone().offset(t*(-2*r),0)}}return e}async function j(e,t,r){if(!Array.isArray(e))return j([e],t);const n=t?t.url:i.a.geometryServiceUrl;let s,m,_,w,x,S,T,C,M=0;const P=[],A=[];for(const i of e)if(Object(a.i)(i))A.push(i);else if(s||(s=i.spatialReference,m=Object(u.d)(s),_=s.isWebMercator,S=_?102100:4326,w=c.a[S].maxX,x=c.a[S].minX,T=c.a[S].plus180Line,C=c.a[S].minus180Line),m)if("mesh"===i.type)A.push(i);else if("point"===i.type)A.push(O(i.clone(),w,x));else if("multipoint"===i.type){const e=i.clone();e.points=e.points.map((e=>O(e,w,x))),A.push(e)}else if("extent"===i.type){const e=i.clone()._normalize(!1,!1,m);A.push(e.rings?new o.a(e):e)}else if(i.extent){const e=i.extent,t=Object(c.d)(e.xmin,x)*(2*w);let r=0===t?i.clone():Object(c.e)(i.clone(),t);e.offset(t,0),e.intersects(T)&&e.xmax!==w?(M=e.xmax>M?e.xmax:M,r=v(r,_),P.push(r),A.push("cut")):e.intersects(C)&&e.xmin!==x?(M=e.xmax*(2*w)>M?e.xmax*(2*w):M,r=v(r,_,360),P.push(r),A.push("cut")):A.push(r)}else A.push(i.clone());else A.push(i);let E=Object(c.d)(M,w),R=-90;const I=E,D=new l.a;for(;E>0;){const e=360*E-180;D.addPath([[e,R],[e,-1*R]]),R*=-1,E--}if(P.length>0&&I>0){const t=function(e,t){let r=-1;for(let i=0;i<t.cutIndexes.length;i++){const n=t.cutIndexes[i],s=t.geometries[i],a=Object(c.b)(s);for(let e=0;e<a.length;e++){const t=a[e];t.some((r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const i=t[e][0];r=i>r?i:r}r=Number(r.toFixed(9));const i=-360*Object(c.d)(r,180);for(let n=0;n<t.length;n++){const t=s.getPoint(e,n);s.setPoint(e,n,t.clone().offset(i,0))}return!0}}))}if(n===r){if(g(e))for(const t of Object(c.b)(s))e[n]=e[n].addRing(t);else if(y(e))for(const t of Object(c.b)(s))e[n]=e[n].addPath(t)}else r=n,e[n]=s}return e}(P,await async function(e,t,r,i){const n="string"==typeof e?Object(p.K)(e):e,s=t[0].spatialReference,a={...i,query:{...n.query,f:"json",sr:JSON.stringify(s),target:JSON.stringify({geometryType:Object(f.c)(t[0]),geometries:t}),cutter:JSON.stringify(r)}},o=await Object(h.default)(n.path+"/cut",a),{cutIndexes:l,geometries:c=[]}=o.data;return{cutIndexes:l,geometries:c.map((e=>{const t=Object(f.a)(e);return t.spatialReference=s,t}))}}(n,P,D,r)),i=[],s=[];for(let r=0;r<A.length;r++){const n=A[r];if("cut"!==n)s.push(n);else{const n=t.shift(),o=e[r];Object(a.j)(o)&&"polygon"===o.type&&o.rings&&o.rings.length>1&&n.rings.length>=o.rings.length?(i.push(n),s.push("simplify")):s.push(_?Object(d.b)(n):n)}}if(!i.length)return s;const o=await b(n,i,r),l=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?l.push(t):l.push(_?Object(d.b)(o.shift()):o.shift())}return l}const F=[];for(let i=0;i<A.length;i++){const e=A[i];if("cut"!==e)F.push(e);else{const e=P.shift();F.push(!0===_?Object(d.b)(e):e)}}return Promise.resolve(F)}function _(e,t){const r=Object(u.d)(t);if(r){const[t,i]=r.valid,n=i-t;if(e<t)for(;e<t;)e+=n;if(e>i)for(;e>i;)e-=n}return e}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return l}));r(8);var i=r(11),n=r(99),s=r(181),a=r(246),o=r(415);function l(e,t,r,s){const a=function(e,t){return e?function(e,t){if(!t||"web-scene"!==t.origin)return!0;switch(e.type){case"simple":case"unique-value":case"class-breaks":return!0;case"heatmap":case"dictionary":case"dot-density":default:return!1}}(e,t)?e.write({},t):(t.messages&&t.messages.push(new i.a("renderer:unsupported",`Renderer of type '${e.declaredClass}' are not supported in scenes.`,{renderer:e,context:t})),null):null}(e,s);a&&Object(n.c)(r,a,t)}function c(e,t){return d(e,null,t)}const u=Object(a.b)({types:o.a});function d(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(r&&r.messages&&r.messages.push(new s.a("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):u(e,t,r):null}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(87),n=r(180),s=r(7),a=r(2),o=r(12),l=r(370);const c=s.a.getLogger("esri.core.workers.WorkerHandle");class u{constructor(e,t,r,i={}){this._mainMethod=t,this._listeners=[],this._promise=Object(l.b)(e,{...i,schedule:r}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,i.hasInitialize&&this.broadcast({},"initialize");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>c.error(`Failed to initialize ${e} worker: ${t}`)))}on(e,t){const r={removed:!1,eventName:e,callback:t,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Object(n.b)((()=>{r.removed=!0,Object(i.j)(this._listeners,r),this._thread&&Object(a.j)(r.threadHandle)&&r.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,r){if(this._thread){const i=this.getTransferList(t,e);return this._thread.invoke(e,t,{transferList:i,signal:r})}return this._promise?this._promise.then((()=>(Object(o.x)(r),this.invokeMethod(e,t,r)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o}));var i=r(2),n=r(5),s=r(36);function a(e,t,r){if(null==e||Object(i.i)(r))return!1;let n=!0;return l[0]=null!=e.xmin?e.xmin:0,l[1]=null!=e.ymin?e.ymin:0,l[2]=null!=e.zmin?e.zmin:0,n=n&&Object(s.q)(l,e.spatialReference,0,t,r,0,1),l[0]=null!=e.xmax?e.xmax:0,l[1]=null!=e.ymax?e.ymax:0,l[2]=null!=e.zmax?e.zmax:0,n=n&&Object(s.q)(l,e.spatialReference,0,t,r,3,1),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),n}function o(e,t,r){if(null==e)return!1;let i=!0;return l[0]=null!=e.xmin?e.xmin:0,l[1]=null!=e.ymin?e.ymin:0,l[2]=null!=e.zmin?e.zmin:0,i=i&&Object(s.q)(l,e.spatialReference,0,l,r,0,1),t[0]=l[0],t[1]=l[1],l[0]=null!=e.xmax?e.xmax:0,l[1]=null!=e.ymax?e.ymax:0,l[2]=null!=e.zmax?e.zmax:0,i=i&&Object(s.q)(l,e.spatialReference,0,l,r,0,1),t[2]=l[0],t[3]=l[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),i}const l=Object(n.e)()},function(e,t,r){"use strict";function i(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function n(e){return void 0!==e.points}function s(e){return void 0!==e.x&&void 0!==e.y}function a(e){return void 0!==e.paths}function o(e){return void 0!==e.rings}function l(e){return(t,r)=>null==t?r:null==r?t:e(t,r)}r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return p}));const c=l(Math.min),u=l(Math.max);function d(e,t){return a(t)?p(e,t.paths,!1,!1):o(t)?p(e,t.rings,!1,!1):n(t)?b(e,t.points,!1,!1,!1,!1):i(t)?f(e,t):(s(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function h(e,t){return a(t)?p(e,t.paths,!0,!1):o(t)?p(e,t.rings,!0,!1):n(t)?b(e,t.points,!0,!1,!0,!1):i(t)?f(e,t,!0,!1,!0,!1):(s(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function p(e,t,r,i){const n=r?3:2;if(!t.length||!t[0].length)return null;let s,a,o,l,[d,h]=t[0][0],[p,f]=t[0][0];for(let b=0;b<t.length;b++){const e=t[b];for(let t=0;t<e.length;t++){const b=e[t],[m,g]=b;if(d=c(d,m),h=c(h,g),p=u(p,m),f=u(f,g),r&&b.length>2){const e=b[2];s=c(s,e),a=u(a,e)}if(i&&b.length>n){const e=b[n];o=c(s,e),l=u(a,e)}}}return r?i?(e[0]=d,e[1]=h,e[2]=s,e[3]=o,e[4]=p,e[5]=f,e[6]=a,e[7]=l,e.length=8,e):(e[0]=d,e[1]=h,e[2]=s,e[3]=p,e[4]=f,e[5]=a,e.length=6,e):i?(e[0]=d,e[1]=h,e[2]=o,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=d,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function f(e,t,r,i,n,s){const a=t.xmin,o=t.xmax,l=t.ymin,c=t.ymax;let u=t.zmin,d=t.zmax,h=t.mmin,p=t.mmax;return n?(u=u||0,d=d||0,s?(h=h||0,p=p||0,e[0]=a,e[1]=l,e[2]=u,e[3]=h,e[4]=o,e[5]=c,e[6]=d,e[7]=p,e):(e[0]=a,e[1]=l,e[2]=u,e[3]=o,e[4]=c,e[5]=d,e)):s?(h=h||0,p=p||0,e[0]=a,e[1]=l,e[2]=h,e[3]=o,e[4]=c,e[5]=p,e):(e[0]=a,e[1]=l,e[2]=o,e[3]=c,e)}function b(e,t,r,i,n,s){const a=r?3:2,o=i&&s,l=r&&n;if(!t.length||!t[0].length)return null;let d,h,p,f,[b,m]=t[0],[g,y]=t[0];for(let v=0;v<t.length;v++){const e=t[v],[r,i]=e;if(b=c(b,r),m=c(m,i),g=u(g,r),y=u(y,i),l&&e.length>2){const t=e[2];d=c(d,t),h=u(h,t)}if(o&&e.length>a){const t=e[a];p=c(d,t),f=u(h,t)}}return n?(d=d||0,h=h||0,s?(p=p||0,f=f||0,e[0]=b,e[1]=m,e[2]=d,e[3]=p,e[4]=g,e[5]=y,e[6]=h,e[7]=f,e):(e[0]=b,e[1]=m,e[2]=d,e[3]=g,e[4]=y,e[5]=h,e)):s?(p=p||0,f=f||0,e[0]=b,e[1]=m,e[2]=p,e[3]=g,e[4]=y,e[5]=f,e):(e[0]=b,e[1]=m,e[2]=g,e[3]=y,e)}},function(e,t,r){"use strict";var i,n=r(0),s=r(44),a=r(14),o=r(13),l=r(1),c=(r(9),r(8),r(7),r(4)),u=r(29);const d=new s.a({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete"});let h=i=class extends a.a{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=Object(o.a)(e))}clone(){return new i({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Object(o.a)(this.statisticParameters)})}};Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],h.prototype,"maxPointCount",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],h.prototype,"maxRecordCount",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],h.prototype,"maxVertexCount",void 0),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],h.prototype,"onStatisticField",void 0),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],h.prototype,"outStatisticFieldName",void 0),Object(n.a)([Object(l.b)({type:String,json:{read:{source:"statisticType",reader:d.read},write:{target:"statisticType",writer:d.write}}})],h.prototype,"statisticType",void 0),Object(n.a)([Object(l.b)({type:Object})],h.prototype,"statisticParameters",void 0),Object(n.a)([Object(u.a)("statisticParameters")],h.prototype,"writeStatisticParameters",null),h=i=Object(n.a)([Object(c.a)("esri.rest.support.StatisticDefinition")],h);var p=h;t.a=p},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return l}));var i=r(35),n=r(2),s=r(416);function a(e,t){if(!e||e.symbol)return null;const r=t&&t.renderer;return e&&Object(n.j)(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function o(e,t){const r=a(e,t),i=function(e,t){if(Object(n.j)(e.symbol))return e.symbol;const r=a(e,t);return Object(n.j)(r)&&"dot-density"!==r.type?r.getSymbol(e,t):null}(e,t);if(Object(n.i)(i))return null;const o={renderer:r,symbol:i};if(Object(n.i)(r)||!("visualVariables"in r)||!r.visualVariables)return o;const l=Object(s.getVisualVariableValues)(r,e,t),c=["proportional","proportional","proportional"];for(const{variable:n,value:s}of l)switch(n.type){case"color":o.color=s.toRgba();break;case"size":if("outline"===n.target)o.outlineSize=s;else{const e=n.axis,t=n.useSymbolValue?"symbol-value":s;switch(e){case"width":c[0]=t;break;case"depth":c[1]=t;break;case"height":c[2]=t;break;case"width-and-depth":c[0]=c[1]=t;break;default:c[0]=c[1]=c[2]=t}}break;case"opacity":o.opacity=s;break;case"rotation":switch(n.axis){case"tilt":o.tilt=s;break;case"roll":o.roll=s;break;default:o.heading=s}}return"proportional"===c[0]&&"proportional"===c[1]&&"proportional"===c[2]||(o.size=c),o}async function l(e,t){const r=a(e,t),o=await async function(e,t){if(Object(n.j)(e.symbol))return e.symbol;const r=a(e,t);return Object(n.j)(r)&&r.getSymbolAsync(e,{...t,abortOptions:{signal:t.signal}})}(e,t);if(!o)return null;const l={renderer:r,symbol:o};if(!r||!("visualVariables"in r)||!r.visualVariables)return l;const c=Object(s.getVisualVariableValues)(r,e,t),u=["proportional","proportional","proportional"];for(const{variable:n,value:s}of c)if("color"===n.type)l.color=i.a.toUnitRGBA(s);else if("size"===n.type)if("outline"===n.target)l.outlineSize=s;else{const e=n.axis,t=n.useSymbolValue?"symbol-value":s;"width"===e?u[0]=t:"depth"===e?u[1]=t:"height"===e?u[2]=t:u[0]=u[1]="width-and-depth"===e?t:u[2]=t}else"opacity"===n.type?l.opacity=s:"rotation"===n.type&&"tilt"===n.axis?l.tilt=s:"rotation"===n.type&&"roll"===n.axis?l.roll=s:"rotation"===n.type&&(l.heading=s);return(isFinite(u[0])||isFinite(u[1])||isFinite(u[2]))&&(l.size=u),l}function c(e,t=0){const r=e[t];return"number"==typeof r&&isFinite(r)?r:null}function u(e){for(let t=0;t<3;t++){const r=e[t];if("number"==typeof r)return isFinite(r)?r:0}return 0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r(2);function i(e,t){for(const r of e.entries())if(t(r[0]))return!0;return!1}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(56);function n(){const e=s.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const s=i.a.crypto||i.a.msCrypto},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return a}));var i=r(2);function n(e){return e&&"function"==typeof e.highlight}function s(e){return e&&"function"==typeof e.maskOccludee}function a(e,t,r){return Object(i.i)(e)||e>r&&(0===t||e<t)}function o(e){let{minScale:t,maxScale:r}=e;return t=t||0,r=r||0,{minScale:t,maxScale:r}}},function(e,t,r){"use strict";var i=r(2),n=r(184);class s extends n.a{constructor(e){super(e),this._textureIDs=new Set,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._initTransparent=!!e.initTextureTransparent,this._texture=this._acquire(this._textureId),this._textureNormal=this._acquire(e.normalTextureId),this._textureEmissive=this._acquire(e.emissiveTextureId),this._textureOcclusion=this._acquire(e.occlusionTextureId),this._textureMetallicRoughness=this._acquire(e.metallicRoughnessTextureId)}dispose(){this._textureIDs.forEach((e=>this._textureRepository.release(e))),this._textureIDs.clear()}updateTexture(e){e!==this._textureId&&(this._release(this._textureId),this._textureId=e,this._texture=this._acquire(this._textureId))}bindTextures(e){Object(i.j)(this._texture)&&e.bindTexture(this._texture.glTexture,"tex"),Object(i.j)(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture"),Object(i.j)(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,"texEmission"),Object(i.j)(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),Object(i.j)(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}bindTextureScale(e){const t=Object(i.j)(this._texture)&&this._texture.glTexture;t&&t.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",t.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquire(e){if(!Object(i.i)(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)}_release(e){Object(i.i)(e)||(this._textureIDs.delete(e),this._textureRepository.release(e))}}t.a=s},function(e,t,r){"use strict";function i(e){return 32+e.length}function n(){return 16}function s(e){if(!e)return 0;let t=32;for(const r in e)if(e.hasOwnProperty(r)){const n=e[r];switch(typeof n){case"string":t+=i(n);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function a(e,t){return 32+e.length*t}r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return i}))},function(e,t,r){"use strict";var i,n=r(0),s=r(11),a=r(44),o=r(7),l=r(17),c=r(1),u=(r(8),r(45)),d=r(32),h=r(4),p=r(29),f=r(278),b=r(637),m=(r(9),r(512));let g=i=class extends m.a{constructor(){super(...arguments),this.customValues=null}clone(){return new i({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};Object(n.a)([Object(c.b)({type:[Number],json:{write:!0}})],g.prototype,"customValues",void 0),g=i=Object(n.a)([Object(h.a)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],g);var y,v=g,O=r(203),j=r(416);const _=o.a.getLogger("esri.renderers.visualVariables.SizeVariable"),w=new a.a({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),x=new a.a({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function S(e){if(null!=e)return"string"==typeof e||"number"==typeof e?Object(l.j)(e):"size"===e.type?Object(O.c)(e)?e:(delete(e={...e}).type,new C(e)):void 0}function T(e,t,r){if("object"!=typeof e)return e;const i=new C;return i.read(e,r),i}let C=y=class extends f.a{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:j.viewScaleRE.test(this.valueExpression)}}set expression(e){_.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),"view.scale"===e?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){Object(O.c)(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),Object(O.c)(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return Object(O.a)(this)}set maxDataValue(e){e&&this.stops&&(_.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(_.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return S(e)}readMaxSize(e,t,r){return T(e,0,r)}set minDataValue(e){e&&this.stops&&(_.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(_.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return S(e)}readMinSize(e,t,r){return T(e,0,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(_.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return Object(O.b)(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,r,i){if("$view.scale"===e){if(i&&i.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;i.messages.push(new s.a("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:i}))}}else t[r]=e}readValueUnit(e){return e?x.read(e):null}clone(){return new y({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Object(O.c)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Object(O.c)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if("clamped-linear"===this.transformationType){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if("stops"===this.transformationType){const e=this.stops,t=e.map((e=>e.size)).reverse(),r=e.length;for(let i=0;i<r;i++)e[i].size=t[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};Object(n.a)([Object(c.b)({readOnly:!0})],C.prototype,"cache",null),Object(n.a)([Object(c.b)({type:w.apiValues,json:{type:w.jsonValues,origins:{"web-map":{read:!1}},read:w.read,write:w.write}})],C.prototype,"axis",void 0),Object(n.a)([Object(c.b)({type:String,value:null,json:{read:!1}})],C.prototype,"expression",null),Object(n.a)([Object(c.b)()],C.prototype,"index",null),Object(n.a)([Object(c.b)({type:String,readOnly:!0})],C.prototype,"inputValueType",null),Object(n.a)([Object(c.b)({type:v,json:{write:!0}})],C.prototype,"legendOptions",void 0),Object(n.a)([Object(c.b)({type:Number,value:null,json:{write:!0}})],C.prototype,"maxDataValue",null),Object(n.a)([Object(c.b)({type:Number,value:null,json:{write:!0}})],C.prototype,"maxSize",null),Object(n.a)([Object(u.a)("maxSize")],C.prototype,"castMaxSize",null),Object(n.a)([Object(d.a)("maxSize")],C.prototype,"readMaxSize",null),Object(n.a)([Object(c.b)({type:Number,value:null,json:{write:!0}})],C.prototype,"minDataValue",null),Object(n.a)([Object(c.b)({type:Number,value:null,json:{write:!0}})],C.prototype,"minSize",null),Object(n.a)([Object(u.a)("minSize")],C.prototype,"castMinSize",null),Object(n.a)([Object(d.a)("minSize")],C.prototype,"readMinSize",null),Object(n.a)([Object(c.b)({type:String,json:{write:!0}})],C.prototype,"normalizationField",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],C.prototype,"arcadeRequired",null),Object(n.a)([Object(c.b)({type:String})],C.prototype,"scaleBy",void 0),Object(n.a)([Object(c.b)({type:[b.a],value:null,json:{write:!0}})],C.prototype,"stops",null),Object(n.a)([Object(c.b)({type:["outline"],json:{write:!0}})],C.prototype,"target",void 0),Object(n.a)([Object(c.b)({type:String,readOnly:!0})],C.prototype,"transformationType",null),Object(n.a)([Object(c.b)({type:["size"],json:{type:["sizeInfo"]}})],C.prototype,"type",void 0),Object(n.a)([Object(c.b)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],C.prototype,"useSymbolValue",void 0),Object(n.a)([Object(c.b)({type:String,json:{write:!0}})],C.prototype,"valueExpression",void 0),Object(n.a)([Object(d.a)("valueExpression",["valueExpression","expression"])],C.prototype,"readValueExpression",null),Object(n.a)([Object(p.a)("web-scene","valueExpression")],C.prototype,"writeValueExpressionWebScene",null),Object(n.a)([Object(c.b)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],C.prototype,"valueRepresentation",void 0),Object(n.a)([Object(c.b)({type:x.apiValues,json:{write:x.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],C.prototype,"valueUnit",void 0),Object(n.a)([Object(d.a)("valueUnit")],C.prototype,"readValueUnit",null),C=y=Object(n.a)([Object(h.a)("esri.renderers.visualVariables.SizeVariable")],C);var M=C;t.a=M},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(260);let n,s=(e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r};n=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let a=(e,t)=>{let r=e;return t.forEach((e=>{r=r&&r.children?n(r.children,(t=>t.domNode===e)):void 0})),r},o=(e,t,r)=>{let i=function(i){r("domEvent",i);let n=t(),o=s(i.currentTarget,n.domNode);o.reverse();let l,c=a(n.getLastRender(),o);return e.scheduleRender(),c&&(l=c.properties[`on${i.type}`].apply(c.properties.bind||this,arguments)),r("domEventProcessed",i),l};return(e,t,r,n)=>i},l=e=>{let t,r,n=Object(i.a)(e),s=n.performanceLogger,a=!0,l=!1,c=[],u=[],d=(e,r,i)=>{let a;n.eventHandlerInterceptor=o(t,(()=>a),s),a=e(r,i(),n),c.push(a),u.push(i)},h=()=>{if(r=void 0,a){a=!1,s("renderStart",void 0);for(let e=0;e<c.length;e++){let t=u[e]();s("rendered",void 0),c[e].update(t),s("patched",void 0)}s("renderDone",void 0),a=!0}};return t={renderNow:h,scheduleRender:()=>{r||l||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),l=!0},resume:()=>{l=!1,a=!0,t.scheduleRender()},append:(e,t)=>{d(i.b.append,e,t)},insertBefore:(e,t)=>{d(i.b.insertBefore,e,t)},merge:(e,t)=>{d(i.b.merge,e,t)},replace:(e,t)=>{d(i.b.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));var i=r(31);const n=1.2,s=i.b,a=i.a},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var i=r(2);function n(e){return Object(i.i)(e)?e:e.slice()}function s(e){return[e,e]}},function(e,t,r){"use strict";r.d(t,"a",(function(){return P})),r.d(t,"b",(function(){return C})),r.d(t,"c",(function(){return M}));var i=r(57),n=r(655),s=r(656),a=r(264),o=r(61),l=r(235),c=r(210),u=r(271),d=r(132),h=r(209),p=r(96),f=r(107),b=r(559),m=r(471),g=r(560),y=r(266),v=r(98),O=r(262),j=r(657),_=r(135),w=r(422),x=r(95),S=r(6),T=r(73);const C=new Map([["position",0],["normal",1],["normalCompressed",1],["color",2],["uv0",3],["uvRegion",4],["componentIndex",5]]);function M(e){const t=new T.a;t.include(d.a,e),t.include(u.a,e),t.include(c.a,e),t.include(l.a,e),t.include(a.a,e),t.include(n.a,e),t.include(x.a,e),t.include(o.a,e),t.include(j.a,e),t.include(s.a,e),t.fragment.uniforms.add("view","mat4"),1!==e.pbrMode&&2!==e.pbrMode||(t.include(O.b,e),e.hasNormalTexture&&t.include(m.a,e)),3===e.output&&1===e.componentData?t.vertex.code.add(S.a`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):t.vertex.code.add(S.a`#define discardShadows(castShadows) {}`);const r=e.overlayEnabled&&0===e.output&&4===e.pbrMode;return e.overlayEnabled&&(t.include(w.a,e),1===e.viewingMode?t.vertex.code.add(S.a`
      const float invEllipsoidRadius = ${S.a.float(1/(1===e.ellipsoidMode?i.a.radius:2===e.ellipsoidMode?i.b.radius:i.c.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):t.vertex.code.add(S.a`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),r&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3"),t.varyings.add("positionView","vec3")),t.vertex.code.add(S.a`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${S.a.float(x.c)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${r?S.a`
        positionView = position_view();
        ${1===e.viewingMode?S.a`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:S.a`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${e.overlayEnabled?S.a`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `),7===e.output&&(t.fragment.include(f.a),e.multipassTerrainEnabled&&t.include(v.b,e),t.include(b.a,e),t.fragment.code.add(S.a`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.multipassTerrainEnabled?S.a`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${e.overlayEnabled?S.a`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),0===e.output&&(t.fragment.include(f.a),e.multipassTerrainEnabled&&t.include(v.b,e),t.include(b.a,e),t.include(g.a,e),t.include(y.a,e),r&&t.fragment.uniforms.add("ovNormalTex","sampler2D"),e.receiveShadows?(t.include(_.a,e),t.fragment.code.add(S.a`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):t.fragment.code.add(S.a`float evaluateShadow() { return 0.0; }`),t.fragment.code.add(S.a`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.multipassTerrainEnabled?S.a`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${e.overlayEnabled?S.a`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),1===e.pbrMode||2===e.pbrMode?(t.fragment.code.add(S.a`
        ${1===e.pbrMode?S.a`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?t.fragment.code.add(S.a`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):t.fragment.code.add(S.a`vec3 shadingNormal = normalVertex;`),t.fragment.code.add(S.a`${1===e.viewingMode?S.a`vec3 normalGround = normalize(positionWorld());`:S.a`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),t.fragment.code.add(S.a`vec3 viewDir = normalize(vPositionWorldCameraRelative);
float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);`)):(e.receiveShadows?t.fragment.code.add(S.a`float shadow = evaluateShadow();`):1===e.viewingMode?t.fragment.code.add(S.a`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`):t.fragment.code.add(S.a`float shadow = 0.0;`),t.fragment.code.add(S.a`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${r?S.a`
          vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),t.fragment.code.add(S.a`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),1!==e.output&&3!==e.output||(t.include(h.a,e),t.fragment.code.add(S.a`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),2===e.output&&(t.include(g.a,e),t.fragment.code.add(S.a`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${2===e.normalType?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),4===e.output&&(t.include(p.a),t.fragment.code.add(S.a`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${e.overlayEnabled?S.a`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `)),t}var P=Object.freeze({__proto__:null,attributeLocations:C,build:M})},function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return u}));var i=r(265),n=r(107),s=r(135),a=r(381),o=r(183),l=r(6),c=r(73);const u=255,d=1/u;function h(e){const t=new c.a;t.fragment.include(o.a),t.fragment.include(n.a),t.include(a.a),t.include(i.a);const{pass:r}=e;if(1===r){const{visualization:r,bandsEnabled:i}=e;t.fragment.constants.add("inverseSampleValue","float",u),t.fragment.uniforms.add("shadowAccumulationMap","sampler2D"),t.fragment.uniforms.add("sampleScale","float"),t.fragment.uniforms.add("opacityFromElevation","float"),0===r?(t.fragment.uniforms.add("colorRamp","sampler2D"),t.fragment.uniforms.add("rampSize","float"),t.fragment.code.add(l.a`vec4 sampleColorRamp(sampler2D ramp, float rampSize, float u) {
float rampU = (u * (rampSize - 1.0) + 0.5) / rampSize;
return texture2D(ramp, vec2(rampU, 0.5));
}`),i&&t.fragment.uniforms.add("bandSize","float")):1===r&&(t.fragment.uniforms.add("threshold","float"),t.fragment.uniforms.add("colors","vec4",2)),t.fragment.code.add(l.a`
      void main(void) {
        vec4 record = texture2D(shadowAccumulationMap, uv);
        float pixelSamples = record.r * inverseSampleValue;

        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${0===r&&i?l.a`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = ${0===r?l.a`sampleColorRamp(colorRamp, rampSize, strength)`:l.a`strength <= threshold ? colors[0] : colors[1]`};

        gl_FragColor.a *= opacityFromElevation;
      }
    `)}else 0!==r&&2!==r||(t.include(s.a),t.fragment.uniforms.add("depthMap","sampler2D"),t.fragment.uniforms.add("inverseView","mat4"),t.fragment.uniforms.add("nearFar","vec2"),0===r?t.fragment.constants.add("sampleValue","float",d):t.fragment.constants.add("shadowColor","vec4",[0,0,0,.8]),t.fragment.code.add(l.a`
      void main(void) {

        float depth = rgba2float(texture2D(depthMap, uv));
        // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
        if (depth == 0.0) {
          discard;
        }

        float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

        if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
          discard;
        }

        vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
        vec4 worldSpacePos = inverseView * currentPixelPos;

        mat4 shadowMatrix;
        float linearDepth = -currentPixelDepth;
        int i = chooseCascade(linearDepth, shadowMatrix);

        if (i >= uShadowMapNum) {
          discard;
        }

        vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

        // vertex completely outside? -> no shadow
        if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
          discard;
        }

        vec2 uvShadow = cascadeCoordinates(i, lvpos);

        float depthShadow = readShadowMapDepth(uvShadow, uShadowMapTex);
        bool shadow = depthShadow < lvpos.z;

        if (!shadow) {
          discard;
        }

        gl_FragColor = ${0===r?l.a`vec4(sampleValue)`:l.a`shadowColor`};
      }
    `));return t}var p=Object.freeze({__proto__:null,shadowAccumulationMaxSamples:u,build:h})},function(e,t,r){"use strict";class i{constructor(e=1){this._seed=e}set seed(e){this._seed=null==e?Math.random()*i._m:e}getInt(){return this._seed=(i._a*this._seed+i._c)%i._m,this._seed}getFloat(){return this.getInt()/(i._m-1)}getIntRange(e,t){return Math.round(this.getFloatRange(e,t))}getFloatRange(e,t){const r=t-e;return e+this.getInt()/i._m*r}}i._m=2147483647,i._a=48271,i._c=0,t.a=i},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var i=r(54);function n(e,t){const r=t||e.extent,n=e.width,s=Object(i.f)(r&&r.spatialReference);return r&&n?r.width/n*s*i.j*96:0}function s(e,t){return e/(Object(i.f)(t)*i.j*96)}},function(e,t,r){"use strict";class i{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new i;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}t.a=i},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(i.a`
  float getStippleAlpha() {
    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;
    ${t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":""}

    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;
  }`),t.stippleOffColorEnabled?e.fragment.code.add(i.a`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):e.fragment.code.add(i.a`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(e,t):function(e){e.fragment.code.add(i.a`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.vertex.code.add(i.a`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(526),n=r(6);function s(e,t){t.symbolColor?(e.include(i.a),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(n.a`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`):e.vertex.code.add(n.a`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var i=r(61),n=r(117),s=r(313),a=r(235),o=r(271),l=r(209),c=r(96),u=r(186),d=r(95),h=r(6);function p(e,t){const r=e.vertex.code,p=e.fragment.code;1!==t.output&&3!==t.output||(e.include(n.a,{linearDepth:!0}),e.include(a.a,t),e.include(u.a,t),e.include(l.a,t),e.include(i.a,t),e.vertex.uniforms.add("cameraNearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),r.add(h.a`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);
forwardTextureCoordinates();
}`),e.include(d.a,t),p.add(h.a`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?h.a`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),2===t.output&&(e.include(n.a,{linearDepth:!1}),e.include(s.a,t),e.include(o.a,t),e.include(a.a,t),e.include(u.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),r.add(h.a`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${0===t.normalType?h.a`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();
      }
    `),e.include(i.a,t),e.include(d.a,t),p.add(h.a`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?h.a`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${3===t.normalType?h.a`
            vec3 normal = screenDerivativeNormal(vPositionView);`:h.a`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),4===t.output&&(e.include(n.a,{linearDepth:!1}),e.include(a.a,t),e.include(u.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),r.add(h.a`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),e.include(i.a,t),e.include(d.a,t),e.include(c.a),p.add(h.a`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?h.a`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(398),n=r(6);function s(e,t){const r=e.fragment;t.vertexTangents?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?r.code.add(n.a`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(n.a`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(n.a`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),0!==t.attributeTextureCoordinates&&(e.include(i.a,t),r.uniforms.add("normalTexture","sampler2D"),r.uniforms.add("normalTextureSize","vec2"),r.code.add(n.a`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){const r=e.fragment;r.code.add(i.a`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),1===t.doubleSidedMode?r.code.add(i.a`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`):2===t.doubleSidedMode?r.code.add(i.a`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`):r.code.add(i.a`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(6),n=r(145);function s(e,t){const r=i.a`
  /*
  *  ${t.name}
  *  ${0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":""}
  */
  `;Object(n.c)()&&(e.fragment.code.add(r),e.vertex.code.add(r))}},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(2),o=r(1),l=(r(8),r(9),r(7),r(4)),c=r(437),u=r(362);let d=i=class extends c.a{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=Object(a.j)(e)?e.get(this):null;if(r)return r;const n=new i(this.clonePropertiesWithDeduplication(t));return Object(a.j)(e)&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:Object(a.j)(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:Object(a.j)(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:Object(a.j)(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:Object(a.j)(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null}}};Object(n.a)([Object(o.b)({type:s.a,json:{write:!0}})],d.prototype,"emissiveColor",void 0),Object(n.a)([Object(o.b)({type:u.a,json:{write:!0}})],d.prototype,"emissiveTexture",void 0),Object(n.a)([Object(o.b)({type:u.a,json:{write:!0}})],d.prototype,"occlusionTexture",void 0),Object(n.a)([Object(o.b)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],d.prototype,"metallic",void 0),Object(n.a)([Object(o.b)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],d.prototype,"roughness",void 0),Object(n.a)([Object(o.b)({type:u.a,json:{write:!0}})],d.prototype,"metallicRoughnessTexture",void 0),d=i=Object(n.a)([Object(l.a)("esri.geometry.support.MeshMaterialMetallicRoughness")],d);var h=d;t.a=h},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r(334);function n(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u)i[l]=s[c],i[l+1]=s[c+1],l+=n,c+=a}function s(e,t,r){const s=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,l=t.typedBufferStride,c=r?r.count:t.count;let u=(r&&r.dstIndex?r.dstIndex:0)*a,d=(r&&r.srcIndex?r.srcIndex:0)*l;if(Object(i.b)(t.elementType)){const e=Object(i.d)(t.elementType);if(Object(i.c)(t.elementType))for(let t=0;t<c;++t)s[u]=Math.max(o[d]/e,-1),s[u+1]=Math.max(o[d+1]/e,-1),u+=a,d+=l;else for(let t=0;t<c;++t)s[u]=o[d]/e,s[u+1]=o[d+1]/e,u+=a,d+=l}else n(e,t,r);return e}function a(e,t,r,i){var n,s;const a=e.typedBuffer,o=e.typedBufferStride,l=null!=(n=null==i?void 0:i.count)?n:e.count;let c=(null!=(s=null==i?void 0:i.dstIndex)?s:0)*o;for(let u=0;u<l;++u)a[c]=t,a[c+1]=r,c+=o}Object.freeze({__proto__:null,copy:n,normalizeIntegerBuffer:s,fill:a})},function(e,t,r){"use strict";var i,n=r(0),s=r(305),a=r(86),o=r(14),l=r(13),c=r(17),u=r(1),d=(r(9),r(8),r(7),r(4));let h=i=class extends o.a{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new i({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],h.prototype,"statisticType",void 0),Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],h.prototype,"onStatisticField",void 0),Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],h.prototype,"onStatisticValueExpression",void 0),h=i=Object(n.a)([Object(d.a)("esri.layers.support.OutStatistic")],h);var p,f=h;let b=p=class extends o.a{constructor(){super(...arguments),this.name=null}clone(){return new p({name:this.name,outStatistic:this.outStatistic.clone()})}};Object(n.a)([Object(u.b)({type:String,json:{write:!0}})],b.prototype,"name",void 0),Object(n.a)([Object(u.b)({type:f,json:{write:!0}})],b.prototype,"outStatistic",void 0),b=p=Object(n.a)([Object(d.a)("esri.layers.support.AggregateField")],b);var m,g=b,y=r(177),v=r(374);let O=m=class extends o.a{constructor(e){super(e),this.type="cluster",this.clusterRadius=Object(c.j)("80px"),this.clusterMinSize=Object(c.j)("12px"),this.clusterMaxSize=Object(c.j)("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new m({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Object(l.a)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Object(l.a)(this.fields),popupEnabled:this.popupEnabled,popupTemplate:Object(l.a)(this.popupTemplate)})}};Object(n.a)([Object(u.b)({type:["cluster"],readOnly:!0,json:{write:!0}})],O.prototype,"type",void 0),Object(n.a)([Object(u.b)({type:Number,cast:e=>"auto"===e?e:Object(c.j)(e),json:{write:!0}})],O.prototype,"clusterRadius",void 0),Object(n.a)([Object(u.b)({type:Number,cast:c.j,json:{write:!0}})],O.prototype,"clusterMinSize",void 0),Object(n.a)([Object(u.b)({type:Number,cast:c.j,json:{write:!0}})],O.prototype,"clusterMaxSize",void 0),Object(n.a)([Object(u.b)(y.j)],O.prototype,"popupEnabled",void 0),Object(n.a)([Object(u.b)({type:s.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],O.prototype,"popupTemplate",void 0),Object(n.a)([Object(u.b)({types:a.f})],O.prototype,"symbol",void 0),Object(n.a)([Object(u.b)({type:[v.a],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],O.prototype,"labelingInfo",void 0),Object(n.a)([Object(u.b)(y.d)],O.prototype,"labelsVisible",void 0),Object(n.a)([Object(u.b)({type:[g],json:{write:!0}})],O.prototype,"fields",void 0),O=m=Object(n.a)([Object(d.a)("esri.layers.support.FeatureReductionCluster")],O);var j=O;t.a=j},function(e,t,r){"use strict";let i;const n={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:13,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:14,102069:15,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102962:0,102963:0,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(i=2e3;i<=2045;i++)n[i]=0;for(i=2056;i<=2065;i++)n[i]=0;for(i=2067;i<=2135;i++)n[i]=0;for(i=2137;i<=2154;i++)n[i]=0;for(i=2161;i<=2170;i++)n[i]=0;for(i=2172;i<=2193;i++)n[i]=0;for(i=2195;i<=2198;i++)n[i]=0;for(i=2200;i<=2203;i++)n[i]=0;for(i=2205;i<=2217;i++)n[i]=0;for(i=2222;i<=2224;i++)n[i]=1;for(i=2225;i<=2250;i++)n[i]=2;for(i=2251;i<=2253;i++)n[i]=1;for(i=2257;i<=2264;i++)n[i]=2;for(i=2274;i<=2279;i++)n[i]=2;for(i=2280;i<=2282;i++)n[i]=1;for(i=2283;i<=2289;i++)n[i]=2;for(i=2290;i<=2292;i++)n[i]=0;for(i=2308;i<=2313;i++)n[i]=0;for(i=2315;i<=2491;i++)n[i]=0;for(i=2494;i<=2866;i++)n[i]=0;for(i=2867;i<=2869;i++)n[i]=1;for(i=2870;i<=2888;i++)n[i]=2;for(i=2891;i<=2895;i++)n[i]=2;for(i=2896;i<=2898;i++)n[i]=1;for(i=2902;i<=2908;i++)n[i]=2;for(i=2915;i<=2920;i++)n[i]=2;for(i=2921;i<=2923;i++)n[i]=1;for(i=2924;i<=2930;i++)n[i]=2;for(i=2931;i<=2962;i++)n[i]=0;for(i=2964;i<=2968;i++)n[i]=2;for(i=2969;i<=2973;i++)n[i]=0;for(i=2975;i<=2991;i++)n[i]=0;for(i=2995;i<=3051;i++)n[i]=0;for(i=3054;i<=3079;i++)n[i]=0;for(i=3081;i<=3088;i++)n[i]=0;for(i=3092;i<=3101;i++)n[i]=0;for(i=3106;i<=3138;i++)n[i]=0;for(i=3146;i<=3151;i++)n[i]=0;for(i=3153;i<=3166;i++)n[i]=0;for(i=3168;i<=3172;i++)n[i]=0;for(i=3174;i<=3203;i++)n[i]=0;for(i=3294;i<=3358;i++)n[i]=0;for(i=3367;i<=3403;i++)n[i]=0;for(i=3408;i<=3416;i++)n[i]=0;for(i=3417;i<=3438;i++)n[i]=2;for(i=3441;i<=3446;i++)n[i]=2;for(i=3447;i<=3450;i++)n[i]=0;for(i=3451;i<=3459;i++)n[i]=2;for(i=3460;i<=3478;i++)n[i]=0;for(i=3554;i<=3559;i++)n[i]=0;for(i=3560;i<=3570;i++)n[i]=2;for(i=3571;i<=3581;i++)n[i]=0;for(i=3594;i<=3597;i++)n[i]=0;for(i=3601;i<=3604;i++)n[i]=0;for(i=3637;i<=3639;i++)n[i]=0;for(i=3665;i<=3667;i++)n[i]=0;for(i=3693;i<=3695;i++)n[i]=0;for(i=3701;i<=3727;i++)n[i]=0;for(i=3728;i<=3739;i++)n[i]=2;for(i=3740;i<=3751;i++)n[i]=0;for(i=3753;i<=3760;i++)n[i]=2;for(i=3761;i<=3773;i++)n[i]=0;for(i=3775;i<=3777;i++)n[i]=0;for(i=3779;i<=3781;i++)n[i]=0;for(i=3783;i<=3785;i++)n[i]=0;for(i=3788;i<=3791;i++)n[i]=0;for(i=3797;i<=3802;i++)n[i]=0;for(i=3814;i<=3816;i++)n[i]=0;for(i=3825;i<=3829;i++)n[i]=0;for(i=3832;i<=3841;i++)n[i]=0;for(i=3844;i<=3852;i++)n[i]=0;for(i=3873;i<=3885;i++)n[i]=0;for(i=3890;i<=3893;i++)n[i]=0;for(i=3907;i<=3912;i++)n[i]=0;for(i=3942;i<=3950;i++)n[i]=0;for(i=3968;i<=3970;i++)n[i]=0;for(i=3973;i<=3976;i++)n[i]=0;for(i=3986;i<=3989;i++)n[i]=0;for(i=3994;i<=3997;i++)n[i]=0;for(i=4048;i<=4051;i++)n[i]=0;for(i=4056;i<=4063;i++)n[i]=0;for(i=4093;i<=4096;i++)n[i]=0;for(i=4390;i<=4398;i++)n[i]=0;for(i=4399;i<=4413;i++)n[i]=2;for(i=4418;i<=4433;i++)n[i]=2;for(i=4455;i<=4457;i++)n[i]=2;for(i=4484;i<=4489;i++)n[i]=0;for(i=4491;i<=4554;i++)n[i]=0;for(i=4568;i<=4589;i++)n[i]=0;for(i=4652;i<=4656;i++)n[i]=0;for(i=4766;i<=4800;i++)n[i]=0;for(i=5014;i<=5016;i++)n[i]=0;for(i=5069;i<=5072;i++)n[i]=0;for(i=5105;i<=5130;i++)n[i]=0;for(i=5173;i<=5188;i++)n[i]=0;for(i=5253;i<=5259;i++)n[i]=0;for(i=5269;i<=5275;i++)n[i]=0;for(i=5292;i<=5311;i++)n[i]=0;for(i=5329;i<=5331;i++)n[i]=0;for(i=5343;i<=5349;i++)n[i]=0;for(i=5355;i<=5357;i++)n[i]=0;for(i=5387;i<=5389;i++)n[i]=0;for(i=5459;i<=5463;i++)n[i]=0;for(i=5479;i<=5482;i++)n[i]=0;for(i=5518;i<=5520;i++)n[i]=0;for(i=5530;i<=5539;i++)n[i]=0;for(i=5550;i<=5552;i++)n[i]=0;for(i=5562;i<=5583;i++)n[i]=0;for(i=5623;i<=5625;i++)n[i]=2;for(i=5631;i<=5639;i++)n[i]=0;for(i=5649;i<=5653;i++)n[i]=0;for(i=5663;i<=5680;i++)n[i]=0;for(i=5682;i<=5685;i++)n[i]=0;for(i=5875;i<=5877;i++)n[i]=0;for(i=5896;i<=5899;i++)n[i]=0;for(i=5921;i<=5940;i++)n[i]=0;for(i=6050;i<=6125;i++)n[i]=0;for(i=6244;i<=6275;i++)n[i]=0;for(i=6328;i<=6348;i++)n[i]=0;for(i=6350;i<=6356;i++)n[i]=0;for(i=6366;i<=6372;i++)n[i]=0;for(i=6381;i<=6387;i++)n[i]=0;for(i=6393;i<=6404;i++)n[i]=0;for(i=6480;i<=6483;i++)n[i]=0;for(i=6511;i<=6514;i++)n[i]=0;for(i=6579;i<=6581;i++)n[i]=0;for(i=6619;i<=6624;i++)n[i]=0;for(i=6625;i<=6627;i++)n[i]=2;for(i=6628;i<=6632;i++)n[i]=0;for(i=6634;i<=6637;i++)n[i]=0;for(i=6669;i<=6692;i++)n[i]=0;for(i=6707;i<=6709;i++)n[i]=0;for(i=6720;i<=6723;i++)n[i]=0;for(i=6732;i<=6738;i++)n[i]=0;for(i=6931;i<=6933;i++)n[i]=0;for(i=6956;i<=6959;i++)n[i]=0;for(i=7005;i<=7007;i++)n[i]=0;for(i=7057;i<=7070;i++)n[i]=2;for(i=7074;i<=7082;i++)n[i]=0;for(i=7109;i<=7118;i++)n[i]=0;for(i=7119;i<=7127;i++)n[i]=1;for(i=7374;i<=7376;i++)n[i]=0;for(i=7528;i<=7586;i++)n[i]=0;for(i=7587;i<=7645;i++)n[i]=2;for(i=7692;i<=7696;i++)n[i]=0;for(i=7755;i<=7787;i++)n[i]=0;for(i=7791;i<=7795;i++)n[i]=0;for(i=7799;i<=7801;i++)n[i]=0;for(i=7803;i<=7805;i++)n[i]=0;for(i=7825;i<=7831;i++)n[i]=0;for(i=7845;i<=7859;i++)n[i]=0;for(i=8013;i<=8032;i++)n[i]=0;for(i=8065;i<=8068;i++)n[i]=1;for(i=8518;i<=8529;i++)n[i]=2;for(i=8533;i<=8536;i++)n[i]=2;for(i=8538;i<=8540;i++)n[i]=2;for(i=8677;i<=8679;i++)n[i]=0;for(i=8836;i<=8840;i++)n[i]=0;for(i=8857;i<=8859;i++)n[i]=0;for(i=8908;i<=8910;i++)n[i]=0;for(i=9154;i<=9159;i++)n[i]=0;for(i=9205;i<=9218;i++)n[i]=0;for(i=9271;i<=9273;i++)n[i]=0;for(i=9295;i<=9297;i++)n[i]=0;for(i=9356;i<=9360;i++)n[i]=0;for(i=9404;i<=9407;i++)n[i]=0;for(i=9476;i<=9482;i++)n[i]=0;for(i=9487;i<=9494;i++)n[i]=0;for(i=9697;i<=9699;i++)n[i]=0;for(i=20002;i<=20032;i++)n[i]=0;for(i=20062;i<=20092;i++)n[i]=0;for(i=20135;i<=20138;i++)n[i]=0;for(i=20248;i<=20258;i++)n[i]=0;for(i=20348;i<=20358;i++)n[i]=0;for(i=20436;i<=20440;i++)n[i]=0;for(i=20822;i<=20824;i++)n[i]=0;for(i=20934;i<=20936;i++)n[i]=0;for(i=21035;i<=21037;i++)n[i]=0;for(i=21095;i<=21097;i++)n[i]=0;for(i=21148;i<=21150;i++)n[i]=0;for(i=21413;i<=21423;i++)n[i]=0;for(i=21453;i<=21463;i++)n[i]=0;for(i=21473;i<=21483;i++)n[i]=0;for(i=21780;i<=21782;i++)n[i]=0;for(i=21891;i<=21894;i++)n[i]=0;for(i=21896;i<=21899;i++)n[i]=0;for(i=22171;i<=22177;i++)n[i]=0;for(i=22181;i<=22187;i++)n[i]=0;for(i=22191;i<=22197;i++)n[i]=0;for(i=22234;i<=22236;i++)n[i]=0;for(i=22521;i<=22525;i++)n[i]=0;for(i=22991;i<=22994;i++)n[i]=0;for(i=23028;i<=23038;i++)n[i]=0;for(i=23830;i<=23853;i++)n[i]=0;for(i=23866;i<=23872;i++)n[i]=0;for(i=23877;i<=23884;i++)n[i]=0;for(i=23886;i<=23894;i++)n[i]=0;for(i=23946;i<=23948;i++)n[i]=0;for(i=24311;i<=24313;i++)n[i]=0;for(i=24342;i<=24347;i++)n[i]=0;for(i=24370;i<=24374;i++)n[i]=10;for(i=24375;i<=24381;i++)n[i]=0;for(i=24718;i<=24721;i++)n[i]=0;for(i=24817;i<=24821;i++)n[i]=0;for(i=24877;i<=24882;i++)n[i]=0;for(i=24891;i<=24893;i++)n[i]=0;for(i=25391;i<=25395;i++)n[i]=0;for(i=25828;i<=25838;i++)n[i]=0;for(i=26191;i<=26195;i++)n[i]=0;for(i=26391;i<=26393;i++)n[i]=0;for(i=26701;i<=26722;i++)n[i]=0;for(i=26729;i<=26799;i++)n[i]=2;for(i=26801;i<=26803;i++)n[i]=2;for(i=26811;i<=26813;i++)n[i]=2;for(i=26847;i<=26870;i++)n[i]=2;for(i=26891;i<=26899;i++)n[i]=0;for(i=26901;i<=26923;i++)n[i]=0;for(i=26929;i<=26946;i++)n[i]=0;for(i=26948;i<=26998;i++)n[i]=0;for(i=27037;i<=27040;i++)n[i]=0;for(i=27205;i<=27232;i++)n[i]=0;for(i=27258;i<=27260;i++)n[i]=0;for(i=27391;i<=27398;i++)n[i]=0;for(i=27561;i<=27564;i++)n[i]=0;for(i=27571;i<=27574;i++)n[i]=0;for(i=27581;i<=27584;i++)n[i]=0;for(i=27591;i<=27594;i++)n[i]=0;for(i=28191;i<=28193;i++)n[i]=0;for(i=28348;i<=28358;i++)n[i]=0;for(i=28402;i<=28432;i++)n[i]=0;for(i=28462;i<=28492;i++)n[i]=0;for(i=29118;i<=29122;i++)n[i]=0;for(i=29168;i<=29172;i++)n[i]=0;for(i=29177;i<=29185;i++)n[i]=0;for(i=29187;i<=29195;i++)n[i]=0;for(i=29900;i<=29903;i++)n[i]=0;for(i=30161;i<=30179;i++)n[i]=0;for(i=30491;i<=30494;i++)n[i]=0;for(i=30729;i<=30732;i++)n[i]=0;for(i=31251;i<=31259;i++)n[i]=0;for(i=31265;i<=31268;i++)n[i]=0;for(i=31275;i<=31279;i++)n[i]=0;for(i=31281;i<=31297;i++)n[i]=0;for(i=31461;i<=31469;i++)n[i]=0;for(i=31491;i<=31495;i++)n[i]=0;for(i=31917;i<=31922;i++)n[i]=0;for(i=31965;i<=32e3;i++)n[i]=0;for(i=32001;i<=32003;i++)n[i]=2;for(i=32005;i<=32031;i++)n[i]=2;for(i=32033;i<=32060;i++)n[i]=2;for(i=32064;i<=32067;i++)n[i]=2;for(i=32074;i<=32077;i++)n[i]=2;for(i=32081;i<=32086;i++)n[i]=0;for(i=32107;i<=32130;i++)n[i]=0;for(i=32133;i<=32158;i++)n[i]=0;for(i=32164;i<=32167;i++)n[i]=2;for(i=32180;i<=32199;i++)n[i]=0;for(i=32201;i<=32260;i++)n[i]=0;for(i=32301;i<=32360;i++)n[i]=0;for(i=32601;i<=32662;i++)n[i]=0;for(i=32664;i<=32667;i++)n[i]=2;for(i=32701;i<=32761;i++)n[i]=0;for(i=53001;i<=53004;i++)n[i]=0;for(i=53008;i<=53019;i++)n[i]=0;for(i=53021;i<=53032;i++)n[i]=0;for(i=53034;i<=53037;i++)n[i]=0;for(i=53042;i<=53046;i++)n[i]=0;for(i=53074;i<=53080;i++)n[i]=0;for(i=54001;i<=54004;i++)n[i]=0;for(i=54008;i<=54019;i++)n[i]=0;for(i=54021;i<=54032;i++)n[i]=0;for(i=54034;i<=54037;i++)n[i]=0;for(i=54042;i<=54046;i++)n[i]=0;for(i=54048;i<=54053;i++)n[i]=0;for(i=54074;i<=54080;i++)n[i]=0;for(i=54098;i<=54101;i++)n[i]=0;for(i=102001;i<=102040;i++)n[i]=0;for(i=102042;i<=102063;i++)n[i]=0;for(i=102065;i<=102067;i++)n[i]=0;for(i=102070;i<=102117;i++)n[i]=0;for(i=102122;i<=102216;i++)n[i]=0;for(i=102221;i<=102377;i++)n[i]=0;for(i=102382;i<=102388;i++)n[i]=0;for(i=102389;i<=102398;i++)n[i]=2;for(i=102399;i<=102444;i++)n[i]=0;for(i=102445;i<=102447;i++)n[i]=2;for(i=102448;i<=102458;i++)n[i]=0;for(i=102459;i<=102468;i++)n[i]=2;for(i=102469;i<=102499;i++)n[i]=0;for(i=102500;i<=102519;i++)n[i]=1;for(i=102520;i<=102524;i++)n[i]=0;for(i=102525;i<=102529;i++)n[i]=2;for(i=102530;i<=102588;i++)n[i]=0;for(i=102590;i<=102598;i++)n[i]=0;for(i=102601;i<=102603;i++)n[i]=0;for(i=102605;i<=102628;i++)n[i]=0;for(i=102629;i<=102646;i++)n[i]=2;for(i=102648;i<=102700;i++)n[i]=2;for(i=102701;i<=102703;i++)n[i]=0;for(i=102707;i<=102730;i++)n[i]=2;for(i=102733;i<=102758;i++)n[i]=2;for(i=102767;i<=102900;i++)n[i]=0;for(i=102965;i<=102969;i++)n[i]=0;for(i=102971;i<=102973;i++)n[i]=0;for(i=102975;i<=102989;i++)n[i]=0;for(i=102990;i<=102992;i++)n[i]=1;for(i=102997;i<=103002;i++)n[i]=0;for(i=103003;i<=103008;i++)n[i]=2;for(i=103009;i<=103011;i++)n[i]=0;for(i=103012;i<=103014;i++)n[i]=2;for(i=103019;i<=103021;i++)n[i]=0;for(i=103022;i<=103024;i++)n[i]=2;for(i=103029;i<=103031;i++)n[i]=0;for(i=103032;i<=103034;i++)n[i]=2;for(i=103065;i<=103068;i++)n[i]=0;for(i=103074;i<=103076;i++)n[i]=0;for(i=103077;i<=103079;i++)n[i]=1;for(i=103080;i<=103082;i++)n[i]=0;for(i=103083;i<=103085;i++)n[i]=2;for(i=103090;i<=103093;i++)n[i]=0;for(i=103097;i<=103099;i++)n[i]=0;for(i=103100;i<=103102;i++)n[i]=2;for(i=103107;i<=103109;i++)n[i]=0;for(i=103110;i<=103112;i++)n[i]=2;for(i=103113;i<=103116;i++)n[i]=0;for(i=103117;i<=103120;i++)n[i]=2;for(i=103153;i<=103157;i++)n[i]=0;for(i=103158;i<=103162;i++)n[i]=2;for(i=103163;i<=103165;i++)n[i]=0;for(i=103166;i<=103168;i++)n[i]=1;for(i=103169;i<=103171;i++)n[i]=2;for(i=103186;i<=103188;i++)n[i]=0;for(i=103189;i<=103191;i++)n[i]=2;for(i=103192;i<=103195;i++)n[i]=0;for(i=103196;i<=103199;i++)n[i]=2;for(i=103200;i<=103224;i++)n[i]=0;for(i=103225;i<=103227;i++)n[i]=1;for(i=103232;i<=103237;i++)n[i]=0;for(i=103238;i<=103243;i++)n[i]=2;for(i=103244;i<=103246;i++)n[i]=0;for(i=103247;i<=103249;i++)n[i]=2;for(i=103254;i<=103256;i++)n[i]=0;for(i=103257;i<=103259;i++)n[i]=2;for(i=103264;i<=103266;i++)n[i]=0;for(i=103267;i<=103269;i++)n[i]=2;for(i=103300;i<=103375;i++)n[i]=0;for(i=103381;i<=103383;i++)n[i]=0;for(i=103384;i<=103386;i++)n[i]=1;for(i=103387;i<=103389;i++)n[i]=0;for(i=103390;i<=103392;i++)n[i]=2;for(i=103397;i<=103399;i++)n[i]=0;for(i=103400;i<=103471;i++)n[i]=2;for(i=103476;i<=103478;i++)n[i]=0;for(i=103479;i<=103481;i++)n[i]=2;for(i=103486;i<=103488;i++)n[i]=0;for(i=103489;i<=103491;i++)n[i]=2;for(i=103492;i<=103495;i++)n[i]=0;for(i=103496;i<=103499;i++)n[i]=2;for(i=103528;i<=103543;i++)n[i]=0;for(i=103544;i<=103548;i++)n[i]=2;for(i=103549;i<=103551;i++)n[i]=0;for(i=103552;i<=103554;i++)n[i]=1;for(i=103555;i<=103557;i++)n[i]=2;for(i=103558;i<=103560;i++)n[i]=0;for(i=103571;i<=103573;i++)n[i]=0;for(i=103574;i<=103576;i++)n[i]=2;for(i=103577;i<=103580;i++)n[i]=0;for(i=103581;i<=103583;i++)n[i]=2;for(i=103595;i<=103694;i++)n[i]=0;for(i=103696;i<=103699;i++)n[i]=0;for(i=103700;i<=103793;i++)n[i]=2;for(i=103794;i<=103872;i++)n[i]=0;for(i=103900;i<=103971;i++)n[i]=2;t.a=n},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return h}));var i=r(450);const n=[];function s(e,t,r,i){return{xmin:e,ymin:t,xmax:r,ymax:i}}function a(e,t,r,i,n,s){return{xmin:e,ymin:t,zmin:r,xmax:i,ymax:n,zmax:s}}function o(e,t,r,i,n,s){return{xmin:e,ymin:t,mmin:r,xmax:i,ymax:n,mmax:s}}function l(e,t,r,i,n,s,a,o){return{xmin:e,ymin:t,zmin:r,mmin:i,xmax:n,ymax:s,zmax:a,mmax:o}}function c(e,t=!1,r=!1){return t?r?l(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):a(e[0],e[1],e[2],e[3],e[4],e[5]):r?o(e[0],e[1],e[2],e[3],e[4],e[5]):s(e[0],e[1],e[2],e[3])}function u(e){return e?function(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}(e)?e:function(e){return void 0!==e.x&&void 0!==e.y}(e)?function(e){const{x:t,y:r,z:i,m:n}=e,c=null!=n;return null!=i?c?l(t,r,i,n,t,r,i,n):a(t,r,i,t,r,i):c?o(t,r,n,t,r,n):s(t,r,t,r)}(e):function(e){return void 0!==e.rings}(e)?d(e):function(e){return void 0!==e.paths}(e)?h(e):function(e){return void 0!==e.points}(e)?function(e){const{hasZ:t,hasM:r,points:s}=e;return c(Object(i.c)(n,s,t,r),t,r)}(e):null:null}function d(e){const{hasZ:t,hasM:r,rings:s}=e,a=Object(i.d)(n,s,t,r);return a?c(a,t,r):null}function h(e){const{hasZ:t,hasM:r,paths:s}=e,a=Object(i.d)(n,s,t,r);return a?c(a,t,r):null}},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(4));let l=i=class extends s.a{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new i({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],l.prototype,"name",void 0),Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],l.prototype,"title",void 0),Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),Object(n.a)([Object(a.b)({type:["string","number"],json:{write:!0}})],l.prototype,"returnType",void 0),l=i=Object(n.a)([Object(o.a)("esri.popup.ExpressionInfo")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"b",(function(){return m}));var i,n=r(0),s=r(44),a=r(14),o=r(25),l=r(1),c=(r(8),r(9),r(7),r(37)),u=r(32),d=r(4),h=r(29),p=r(115);const f=Object(s.b)()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let b=i=class extends a.a{constructor(e){super(e)}readHref(e,t,r){return e?Object(p.a)(e,r):t.dataURI}writeHref(e,t,r,i){e&&(Object(o.u)(e)?t.dataURI=e:(t.href=Object(p.e)(e,i),Object(o.s)(t.href)&&(t.href=Object(o.D)(t.href))))}clone(){return new i({href:this.href,primitive:this.primitive})}};Object(n.a)([Object(l.b)({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],b.prototype,"href",void 0),Object(n.a)([Object(u.a)("href")],b.prototype,"readHref",null),Object(n.a)([Object(h.a)("href",{href:{type:String},dataURI:{type:String}})],b.prototype,"writeHref",null),Object(n.a)([Object(c.a)(f)],b.prototype,"primitive",void 0),b=i=Object(n.a)([Object(d.a)("esri.symbols.support.IconSymbol3DLayerResource")],b);const m="circle";var g=b;t.a=g},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(13),o=r(2),l=r(17),c=r(1),u=(r(9),r(8),r(7),r(37)),d=r(4),h=r(511),p=r(482),f=r(116);let b=i=class extends h.a{constructor(e){super(e),this.type="line",this.color=new s.a([0,0,0,1]),this.size=Object(l.h)(1),this.border=null}get visible(){return this.size>0&&Object(o.j)(this.color)&&this.color.a>0}clone(){return new i({color:Object(a.a)(this.color),size:this.size,border:Object(a.a)(this.border)})}};Object(n.a)([Object(u.a)({line:"line"},{readOnly:!0})],b.prototype,"type",void 0),Object(n.a)([Object(c.b)(f.a)],b.prototype,"color",void 0),Object(n.a)([Object(c.b)(f.b)],b.prototype,"size",void 0),Object(n.a)([Object(c.b)({type:p.a,json:{write:!0}})],b.prototype,"border",void 0),Object(n.a)([Object(c.b)({readOnly:!0})],b.prototype,"visible",null),b=i=Object(n.a)([Object(d.a)("esri.symbols.callouts.LineCallout3D")],b);var m=b;t.a=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i,n=r(0),s=r(35),a=r(14),o=r(13),l=r(1),c=(r(9),r(8),r(7),r(4)),u=r(116);let d=i=class extends a.a{constructor(){super(...arguments),this.color=new s.a("white")}clone(){return new i({color:Object(o.a)(this.color)})}};Object(n.a)([Object(l.b)(u.a)],d.prototype,"color",void 0),d=i=Object(n.a)([Object(c.a)("esri.symbols.callouts.LineCallout3DBorder")],d);var h=d;Object.freeze({__proto__:null,get LineCallout3DBorder(){return d},default:h})},function(e,t,r){"use strict";var i,n=r(0),s=r(11),a=r(1),o=(r(8),r(9),r(7),r(4)),l=r(29),c=r(278);let u=i=class extends c.a{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,r,i){if(i&&i.messages){const e=`visualVariables[${this.index}]`;i.messages.push(new s.a("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:e+".valueExpressionTitle",context:i}))}}clone(){return new i({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};Object(n.a)([Object(a.b)({readOnly:!0})],u.prototype,"cache",null),Object(n.a)([Object(a.b)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],u.prototype,"axis",void 0),Object(n.a)([Object(a.b)({type:["rotation"],json:{type:["rotationInfo"]}})],u.prototype,"type",void 0),Object(n.a)([Object(a.b)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],u.prototype,"rotationType",void 0),Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],u.prototype,"valueExpressionTitle",void 0),Object(n.a)([Object(l.a)("web-scene","valueExpressionTitle")],u.prototype,"writeValueExpressionTitleWebScene",null),u=i=Object(n.a)([Object(o.a)("esri.renderers.visualVariables.RotationVariable")],u);var d=u;t.a=d},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return u}));var i=r(11),n=r(99),s=r(377),a=r(476),o=r(418);const l={key:"type",base:s.a,typeMap:{selection:o.a}};function c(e,t){const r=(t=t.layerDefinition||t).featureReduction;if(r)switch(r.type){case"selection":return o.a.fromJSON(r);case"cluster":return a.a.fromJSON(r)}return null}function u(e,t,r,s){const a=function(e,t,r){return e?"selection"!==e.type?(r.messages&&r.messages.push(new i.a("featureReduction:unsupported",`FeatureReduction of type '${e.declaredClass}' are not supported in scenes.`,{featureReduction:e,context:r})),null):e.write(t,r):null}(e,{},s);a&&Object(n.c)(r,a,t)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r(2),n=r(20),s=r(3),a=r(5),o=r(36),l=r(100),c=r(281),u=r(149),d=r(267),h=r(341);let p=0;class f{constructor(e){this._originSR=e,this.ROOT_ORIGIN_ID="rg_root_"+p++,this._origins=new Map,this._gridSize=125e4,this._objects=new Map}getOrigin(e){const t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){if(Object(i.j)(b))return this._origins.set(this.ROOT_ORIGIN_ID,Object(c.a)(b[0],b[1],b[2],this.ROOT_ORIGIN_ID)),this.getOrigin(e);const t=Object(c.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,t),t}const r=this._gridSize,n=Math.round(e[0]/r),a=Math.round(e[1]/r),o=Math.round(e[2]/r),l=`rg_${n}/${a}/${o}`;let u=this._origins.get(l);const d=.5*r;if(Object(s.l)(m,e,t.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]),m[0]<d&&m[1]<d&&m[2]<d){if(u){const t=Math.max(...m);if(Object(s.l)(m,e,u.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]),Math.max(...m)<t)return u}return t}return u||(u=Object(c.a)(n*r,a*r,o*r,l),this._origins.set(l,u)),u}_drawOriginBox(e,t=[1,1,0,1]){const r=window.view,i=r._stage,s=t.toString();if(!this._objects.has(s)){this._material=new h.a({width:2,color:t}),i.add(this._material);const e=new d.a({isPickable:!1}),r=new u.a({castShadow:!1});i.add(r),e.add(r),i.add(e),this._objects.set(s,r)}const a=this._objects.get(s),c=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=c.length,f=new Array(3*p),b=new Uint16Array(2*(p-1)),m=.5*this._gridSize;for(let n=0;n<p;n++)f[3*n+0]=e[0]+(1&c[n]?m:-m),f[3*n+1]=e[1]+(2&c[n]?m:-m),f[3*n+2]=e[2]+(4&c[n]?m:-m),n>0&&(b[2*n+0]=n-1,b[2*n+1]=n);Object(o.q)(f,this._originSR,0,f,r.renderSpatialReference,0,p);const g=new l.a([["position",{size:3,data:f,exclusive:!0}]],[["position",b]],2);i.add(g),a.addGeometry(g,this._material,n.a)}get test(){const e=this;return{get gridSize(){return e._gridSize},set gridSize(t){e._gridSize=t}}}}let b=null;const m=Object(a.e)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r(84),n=r(102),s=r(11),a=r(2),o=r(12),l=r(25);class c{constructor(e){this.streamDataRequester=e}async loadJSON(e,t){return this.load("json",e,t)}async loadBinary(e,t){return Object(l.u)(e)?(Object(o.x)(t),Object(l.j)(e)):this.load("binary",e,t)}async loadImage(e,t){return this.load("image",e,t)}async load(e,t,r){if(Object(a.i)(this.streamDataRequester))return(await Object(i.default)(t,{responseType:u[e]})).data;const l=await Object(n.d)(this.streamDataRequester.request(t,e,r));if(!0===l.ok)return l.value;throw Object(o.w)(l.error),new s.a("",`Request for resource failed: ${l.error}`)}}const u={image:"image",binary:"array-buffer",json:"json"}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r(311),n=r(6);function s(e,t){e.attributes.add("featureValue","vec4"),e.vertex.code.add(n.a`bool isCapVertex() {
return featureValue.w == 1.0;
}`),e.vertex.uniforms.add("size","vec3"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(n.a`vec2 getSize() {
return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):e.vertex.code.add(n.a`vec2 getSize(){
return size.xy;
}`),t.vvOpacity?(e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(n.a`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):e.vertex.code.add(n.a`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(n.a`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):e.vertex.code.add(n.a`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(i.a),e.attributes.add("profileRight","vec4"),e.attributes.add("profileUp","vec4"),e.attributes.add("profileVertexAndNormal","vec4"),e.vertex.code.add(n.a`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),e.vertex.code.add(n.a`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),e.vertex.code.add(n.a`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),e.vertex.code.add(n.a`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}function a(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors)),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(85);let l=class extends n.a{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((function(e){return e.toJSON()})),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:Object(o.c)(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}};Object(i.a)([Object(s.b)()],l.prototype,"geometries",void 0),Object(i.a)([Object(s.b)({json:{read:{source:"outSR"}}})],l.prototype,"outSpatialReference",void 0),Object(i.a)([Object(s.b)()],l.prototype,"transformation",void 0),Object(i.a)([Object(s.b)()],l.prototype,"transformForward",void 0),l=Object(i.a)([Object(a.a)("esri.rest.support.ProjectParameters")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return I}));var i=r(2),n=r(20),s=r(11);const a=r(7).a.getLogger("esri.views.3d.glTF");var o=r(120),l=r(25),c=r(324),u=r(16),d=r(182),h=r(185),p=r(21),f=r(399);class b{constructor(e){this.data=e,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const e=this.offset4;return this.offset4+=1,this.dataUint32[e]}readUint8Array(e){const t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)}remainingBytes(){return this.data.byteLength-4*this.offset4}}const m={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},g={pbrMetallicRoughness:m,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},y={ESRI_externalColorMixMode:"tint"},v=(e={})=>{const t={...m,...e.pbrMetallicRoughness},r=function(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:Object(o.a)(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}({...y,...e.extras});return{...g,...e,pbrMetallicRoughness:t,extras:r}};const O={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};const j=1179937895,_=1313821514,w=5130562;class x{constructor(e,t,r,i,n){this.context=e,this.errorContext=t,this.uri=r,this.json=i,this.glbBuffer=n,this.bufferCache=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=function(e){let t,r;return e.replace(/^(.*\/)?([^/]*)$/,((e,i,n)=>(t=i||"",r=n||"",""))),{dirPart:t,filePart:r}}(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),t.errorUnsupportedIf(null==i.scenes,"Scenes must be defined."),t.errorUnsupportedIf(null==i.meshes,"Meshes must be defined"),t.errorUnsupportedIf(null==i.nodes,"Nodes must be defined."),this.computeNodeParents()}static async load(e,t,r,i){if(Object(l.u)(r)){const i=Object(l.i)(r);if("model/gltf-binary"!==i.mediaType)try{const n=JSON.parse(i.isBase64?atob(i.data):i.data);return new x(e,t,r,n)}catch{}const n=Object(l.j)(r);if(x.isGLBData(n))return this.fromGLBData(e,t,r,n)}if(r.endsWith(".gltf")){const n=await e.loadJSON(r,i);return new x(e,t,r,n)}const n=await e.loadBinary(r,i);if(x.isGLBData(n))return this.fromGLBData(e,t,r,n);const s=await e.loadJSON(r,i);return new x(e,t,r,s)}static isGLBData(e){const t=new b(e);return t.remainingBytes()>=4&&t.readUint32()===j}static async fromGLBData(e,t,r,i){const n=await x.parseGLBData(t,i);return new x(e,t,r,n.json,n.binaryData)}static async parseGLBData(e,t){const r=new b(t);e.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const i=r.readUint32(),n=r.readUint32(),s=r.readUint32();e.assert(i===j,"Magic first 4 bytes do not fit to expected GLB value."),e.assert(t.byteLength>=s,"GLB binary data is smaller than header specifies."),e.errorUnsupportedIf(2!==n,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,o,l=0;for(;r.remainingBytes()>=8;){const t=r.readUint32(),i=r.readUint32();0===l?(e.assert(i===_,"First GLB chunk must be JSON."),e.assert(t>=0,"No JSON data found."),a=await A(r.readUint8Array(t))):1===l?(e.errorUnsupportedIf(i!==w,"Second GLB chunk expected to be BIN."),o=r.readUint8Array(t)):e.warnUnsupported("More than 2 GLB chunks detected. Skipping."),l+=1}return a||e.error("No GLB JSON chunk detected."),{json:a,binaryData:o}}async getBuffer(e,t){const r=this.json.buffers[e],i=this.errorContext;if(null==r.uri)return i.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;let n=this.bufferCache.get(e);if(!n){const s=await this.context.loadBinary(this.resolveUri(r.uri),t);n=new Uint8Array(s),this.bufferCache.set(e,n),i.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match.")}return n}async getAccessor(e,t){const r=this.json.accessors[e],i=this.errorContext;i.errorUnsupportedIf(null==r.bufferView,"Some accessor does not specify a bufferView."),i.errorUnsupportedIf(r.type in["MAT2","MAT3","MAT4"],`AttributeType ${r.type} is not supported`);const n=this.json.bufferViews[r.bufferView],s=await this.getBuffer(n.buffer,t),a=M[r.type],o=P[r.componentType],l=a*o,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:a,componentByteSize:o,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,t){if(null==e.indices)return null;const r=await this.getAccessor(e.indices,t);if(r.isDenselyPacked)switch(r.componentType){case 5121:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case 5123:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case 5125:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case 5121:return Object(f.a)(this.wrapAccessor(p.l,r));case 5123:return Object(f.a)(this.wrapAccessor(p.j,r));case 5125:return Object(f.a)(this.wrapAccessor(p.k,r))}}async getPositionData(e,t){const r=this.errorContext;r.errorUnsupportedIf(null==e.attributes.POSITION,"No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,t);return r.errorUnsupportedIf(5126!==i.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+E[i.componentType]),r.errorUnsupportedIf(3!==i.componentCount,"POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed()),this.wrapAccessor(p.u,i)}async getNormalData(e,t){const r=this.errorContext;r.assert(null!=e.attributes.NORMAL,"No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,t);return r.errorUnsupportedIf(5126!==i.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+E[i.componentType]),r.errorUnsupportedIf(3!==i.componentCount,"NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed()),this.wrapAccessor(p.u,i)}async getTangentData(e,t){const r=this.errorContext;r.assert(null!=e.attributes.TANGENT,"No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,t);return r.errorUnsupportedIf(5126!==i.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+E[i.componentType]),r.errorUnsupportedIf(4!==i.componentCount,"TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed()),new p.C(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,t){const r=this.errorContext;r.assert(null!=e.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,t);return r.errorUnsupportedIf(2!==i.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed()),5126===i.componentType?this.wrapAccessor(p.m,i):(r.errorUnsupportedIf(!i.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),function(e){switch(e.componentType){case 5120:return new p.q(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5121:return new p.t(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5122:return new p.o(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5123:return new p.r(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5125:return new p.s(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5126:return new p.m(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void Object(o.a)(e.componentType)}}(i))}async getVertexColors(e,t){const r=this.errorContext;r.assert(null!=e.attributes.COLOR_0,"No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,t);if(r.errorUnsupportedIf(4!==i.componentCount&&3!==i.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed()),4===i.componentCount){if(5126===i.componentType)return this.wrapAccessor(p.C,i);if(5121===i.componentType)return this.wrapAccessor(p.J,i);if(5123===i.componentType)return this.wrapAccessor(p.H,i)}else if(3===i.componentCount){if(5126===i.componentType)return this.wrapAccessor(p.u,i);if(5121===i.componentType)return this.wrapAccessor(p.B,i);if(5123===i.componentType)return this.wrapAccessor(p.z,i)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+E[i.componentType])}hasPositions(e){return void 0!==e.attributes.POSITION}hasNormals(e){return void 0!==e.attributes.NORMAL}hasVertexColors(e){return void 0!==e.attributes.COLOR_0}hasTextureCoordinates(e){return void 0!==e.attributes.TEXCOORD_0}hasTangents(e){return void 0!==e.attributes.TANGENT}async getMaterial(e,t,r){const i=this.errorContext;let n=this.materialCache.get(e.material);if(!n){const s=null!=e.material?v(this.json.materials[e.material]):v(),a=s.pbrMetallicRoughness,o=this.hasVertexColors(e);let l,c,u,d,h;a.baseColorTexture&&(i.errorUnsupportedIf(0!==(a.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported."),l=await this.getTexture(a.baseColorTexture.index,t)),s.normalTexture&&(0!==(s.normalTexture.texCoord||0)?i.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture."):c=await this.getTexture(s.normalTexture.index,t)),s.occlusionTexture&&r&&(0!==(s.occlusionTexture.texCoord||0)?i.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture."):u=await this.getTexture(s.occlusionTexture.index,t)),s.emissiveTexture&&r&&(0!==(s.emissiveTexture.texCoord||0)?i.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture."):d=await this.getTexture(s.emissiveTexture.index,t)),a.metallicRoughnessTexture&&r&&(0!==(a.metallicRoughnessTexture.texCoord||0)?i.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture."):h=await this.getTexture(a.metallicRoughnessTexture.index,t));const p=null!=e.material?e.material:-1;n={alphaMode:s.alphaMode,alphaCutoff:s.alphaCutoff,color:a.baseColorFactor,doubleSided:!!s.doubleSided,colorTexture:l,normalTexture:c,name:s.name,id:p,occlusionTexture:u,emissiveTexture:d,emissiveFactor:s.emissiveFactor,metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor,metallicRoughnessTexture:h,vertexColors:o,ESRI_externalColorMixMode:s.extras.ESRI_externalColorMixMode}}return n}async getTexture(e,t){const r=this.errorContext,i=this.json.textures[e],n=(e=>({...O,...e}))(null!=i.sampler?this.json.samplers[i.sampler]:{});r.errorUnsupportedIf(null==i.source,"Source is expected to be defined for a texture.");const s=this.json.images[i.source];let a=this.textureCache.get(e);if(!a){let i;if(s.uri)i=await this.context.loadImage(this.resolveUri(s.uri),t);else{r.errorUnsupportedIf(null==s.bufferView,"Image bufferView must be defined."),r.errorUnsupportedIf(null==s.mimeType,"Image mimeType must be defined.");const e=this.json.bufferViews[s.bufferView],n=await this.getBuffer(e.buffer,t);r.errorUnsupportedIf(null!=e.byteStride,"byteStride not supported for image buffer"),i=await async function(e,t){return new Promise(((r,i)=>{const n=new Blob([e],{type:t}),s=URL.createObjectURL(n),a=new Image;a.addEventListener("load",(()=>{URL.revokeObjectURL(s),"decode"in a?a.decode().then((()=>r(a)),(()=>r(a))):r(a)})),a.addEventListener("error",(e=>{URL.revokeObjectURL(s),i(e)})),a.src=s}))}(new Uint8Array(n.buffer,n.byteOffset+(e.byteOffset||0),e.byteLength),s.mimeType)}const o=e=>33071===e||33648===e||10497===e,l=e=>(r.error(`Unexpected TextureSampler WrapMode: ${e}. Using default REPEAT(10497).`),10497);a={data:i,wrapS:o(n.wrapS)?n.wrapS:l(n.wrapS),wrapT:o(n.wrapT)?n.wrapT:l(n.wrapT),minFilter:n.minFilter,name:s.name,id:e},this.textureCache.set(e,a)}return a}getNodeTransform(e){if(void 0===e)return T;let t=this.nodeTransformCache.get(e);if(!t){const r=this.getNodeTransform(this.getNodeParent(e)),i=this.json.nodes[e];i.matrix?t=Object(u.m)(Object(n.d)(),r,i.matrix):i.translation||i.rotation||i.scale?(t=Object(n.c)(r),i.translation&&Object(u.t)(t,t,i.translation),i.rotation&&(C[3]=Object(d.c)(C,i.rotation),Object(u.c)(t,t,C[3],C)),i.scale&&Object(u.s)(t,t,i.scale)):t=r,this.nodeTransformCache.set(e,t)}return t}wrapAccessor(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}resolveUri(e){return Object(l.A)(e,this.baseUri)}getNodeParent(e){return this.nodeParentMap.get(e)}checkVersionSupported(){const e=c.a.parse(this.json.asset.version,"glTF");S.validate(e)}checkRequiredExtensionsSupported(){const e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}computeNodeParents(){this.json.nodes.forEach(((e,t)=>{e.children&&e.children.forEach((e=>{this.nodeParentMap.set(e,t)}))}))}}const S=new c.a(2,0,"glTF"),T=Object(u.n)(Object(n.d)(),Math.PI/2),C=Object(h.b)(),M={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},P={5120:1,5121:1,5122:2,5123:2,5126:4,5125:4};async function A(e){return new Promise(((t,r)=>{const i=new Blob([e]),n=new FileReader;n.onload=()=>{const e=n.result;t(JSON.parse(e))},n.onerror=e=>{r(e)},n.readAsText(i)}))}const E={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let R=0;async function I(e,t,r={},s=!0){const a=await x.load(e,k,t,r),o="gltf_"+R++,l={lods:[],materials:new Map,textures:new Map,meta:D(a)},c=!(!a.json.asset.extras||"symbolResource"!==a.json.asset.extras.ESRI_type);return await async function(e,t){const r=e.json,i=r.scenes[r.scene||0].nodes,n=i.length>1;for(const a of i){const e=r.nodes[a],t=[s(a,0)];if(F(e)&&!n){const r=e.extensions.MSFT_lod.ids;t.push(...r.map(((e,t)=>s(e,t+1))))}await Promise.all(t)}async function s(i,n){const a=r.nodes[i],o=e.getNodeTransform(i);if(k.warnUnsupportedIf(null!=a.weights,"Morph targets are not supported."),null!=a.mesh){const e=r.meshes[a.mesh];for(const r of e.primitives)await t(r,o,n,e.name)}for(const e of a.children||[])await s(e,n)}}(a,(async(e,t,c,u)=>{const d=void 0!==e.mode?e.mode:4,h=4===d||5===d||6===d?d:null;if(Object(i.i)(h))return void k.warnUnsupported("Unsupported primitive mode ("+V[d]+"). Skipping primitive.");if(!a.hasPositions(e))return void k.warn("Skipping primitive without POSITION vertex attribute.");const p=await a.getMaterial(e,r,s),f={transform:Object(n.c)(t),attributes:{position:await a.getPositionData(e,r),normal:null,texCoord0:null,color:null,tangent:null},indices:await a.getIndexData(e,r),primitiveType:h,material:L(l,p,o)};a.hasNormals(e)&&(f.attributes.normal=await a.getNormalData(e,r)),a.hasTangents(e)&&(f.attributes.tangent=await a.getTangentData(e,r)),a.hasTextureCoordinates(e)&&(f.attributes.texCoord0=await a.getTextureCoordinates(e,r)),a.hasVertexColors(e)&&(f.attributes.color=await a.getVertexColors(e,r));let b=null;Object(i.j)(l.meta)&&Object(i.j)(l.meta.ESRI_lod)&&"screenSpaceRadius"===l.meta.ESRI_lod.metric&&(b=l.meta.ESRI_lod.thresholds[c]),l.lods[c]=l.lods[c]||{parts:[],name:u,lodThreshold:b},l.lods[c].parts.push(f)})),{model:l,meta:{isEsriSymbolResource:c,uri:a.uri},customMeta:{}}}function D(e){const t=e.json;let r=null;return t.nodes.forEach((e=>{const t=e.extras;Object(i.j)(t)&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(r=t)})),r}function F(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function L(e,t,r){const i=t=>{const i=`${r}_tex_${t&&t.id}${t&&t.name?"_"+t.name:""}`;if(t&&!e.textures.has(i)){const r=function(e,t={}){return{data:e,parameters:{wrap:{s:10497,t:10497,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}(t.data,{wrap:{s:t.wrapS,t:t.wrapT},mipmap:z.some((e=>e===t.minFilter)),noUnpackFlip:!0});e.textures.set(i,r)}return i},n=`${r}_mat_${t.id}_${t.name}`;if(!e.materials.has(n)){const r=function(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?i(t.colorTexture):void 0,textureNormal:t.normalTexture?i(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?i(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?i(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?i(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(n,r)}return n}const k=new class{error(e){throw new s.a("gltf-loader-error",e)}errorUnsupported(e){throw new s.a("gltf-loader-unsupported-feature",e)}errorUnsupportedIf(e,t){e&&this.errorUnsupported(t)}assert(e,t){e||this.error(t)}warn(e){a.warn(e)}warnUnsupported(e){this.warn("[Unsupported Feature] "+e)}warnUnsupportedIf(e,t){e&&this.warnUnsupported(t)}},z=[9987,9985],V=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"]},function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var i=r(0),n=r(35),s=r(14),a=r(13),o=r(17),l=r(1),c=(r(9),r(8),r(7),r(4)),u=r(116);let d=class extends s.a{constructor(e){super(e),this.color=new n.a([0,0,0,1]),this.extensionLength=0,this.size=Object(o.h)(1)}clone(){}cloneProperties(){return{color:Object(a.a)(this.color),size:this.size,extensionLength:this.extensionLength}}};Object(i.a)([Object(l.b)({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],d.prototype,"type",void 0),Object(i.a)([Object(l.b)(u.a)],d.prototype,"color",void 0),Object(i.a)([Object(l.b)({...u.b,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],d.prototype,"extensionLength",void 0),Object(i.a)([Object(l.b)(u.b)],d.prototype,"size",void 0),d=Object(i.a)([Object(c.a)("esri.symbols.edges.Edges3D")],d);var h,p=d,f=r(37);let b=h=class extends p{constructor(e){super(e),this.type="sketch"}clone(){return new h(this.cloneProperties())}};Object(i.a)([Object(f.a)({sketch:"sketch"},{readOnly:!0})],b.prototype,"type",void 0),b=h=Object(i.a)([Object(c.a)("esri.symbols.edges.SketchEdges3D")],b);var m,g=b;let y=m=class extends p{constructor(e){super(e),this.type="solid"}clone(){return new m(this.cloneProperties())}};Object(i.a)([Object(f.a)({solid:"solid"},{readOnly:!0})],y.prototype,"type",void 0),y=m=Object(i.a)([Object(c.a)("esri.symbols.support.SolidEdges3D")],y);const v={types:{key:"type",base:p,typeMap:{solid:y,sketch:g}},json:{write:!0}}},function(e,t,r){"use strict";function i(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const r=t._delegatedEventNames,i=Array.isArray(e)?e:function(e){return e.split(",").map((e=>e.trim()))}(e);r.push(...i)}}r.d(t,"a",(function(){return i}))},function(e,t,r){"use strict";var i,n=r(0),s=r(221),a=r(366),o=r(14),l=r(13),c=r(2),u=r(1),d=(r(9),r(8),r(7),r(32)),h=r(4),p=r(29);let f=i=class extends o.a{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new i({respectsDaylightSaving:e,timezone:t})}};Object(n.a)([Object(u.b)({type:Boolean,json:{write:!0}})],f.prototype,"respectsDaylightSaving",void 0),Object(n.a)([Object(d.a)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],f.prototype,"readRespectsDaylightSaving",null),Object(n.a)([Object(u.b)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],f.prototype,"timezone",void 0),f=i=Object(n.a)([Object(h.a)("esri.layers.support.TimeReference")],f);var b,m=f,g=r(286);let y=b=class extends o.a{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;const r=new Date(t.timeExtent[0]),i=new Date(t.timeExtent[1]);return new s.a({start:r,end:i})}writeFullTimeExtent(e,t){e&&Object(c.j)(e.start)&&Object(c.j)(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new a.a({value:t.timeInterval,unit:g.a.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new a.a({value:t.defaultTimeInterval,unit:g.a.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const r=e.toJSON();t.timeInterval=r.value,t.timeIntervalUnits=r.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:r,interval:i,startField:n,timeReference:s,fullTimeExtent:a,trackIdField:o,useTime:c}=this;return new b({cumulative:e,endField:t,hasLiveData:r,interval:i,startField:n,timeReference:Object(l.a)(s),fullTimeExtent:Object(l.a)(a),trackIdField:o,useTime:c})}};Object(n.a)([Object(u.b)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],y.prototype,"cumulative",void 0),Object(n.a)([Object(u.b)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],y.prototype,"endField",void 0),Object(n.a)([Object(u.b)({type:s.a,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"fullTimeExtent",void 0),Object(n.a)([Object(d.a)("fullTimeExtent",["timeExtent"])],y.prototype,"readFullTimeExtent",null),Object(n.a)([Object(p.a)("fullTimeExtent")],y.prototype,"writeFullTimeExtent",null),Object(n.a)([Object(u.b)({type:Boolean,json:{write:!0}})],y.prototype,"hasLiveData",void 0),Object(n.a)([Object(u.b)({type:a.a,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"interval",void 0),Object(n.a)([Object(d.a)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],y.prototype,"readInterval",null),Object(n.a)([Object(p.a)("interval")],y.prototype,"writeInterval",null),Object(n.a)([Object(u.b)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],y.prototype,"startField",void 0),Object(n.a)([Object(u.b)({type:m,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"timeReference",void 0),Object(n.a)([Object(u.b)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"trackIdField",void 0),Object(n.a)([Object(u.b)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],y.prototype,"useTime",void 0),y=b=Object(n.a)([Object(h.a)("esri.layers.support.TimeInfo")],y);var v=y;t.a=v},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(522),n=r(6);function s(e){e.fragment.code.add(n.a`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var a=r(312),o=r(326);function l(e,t){e.include(a.a,t),e.include(s),e.include(i.a),t.ssrEnabled&&e.include(o.a,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(n.a`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),e.fragment.code.add(n.a`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {
float reflectionHit = 0.;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}`),t.ssrEnabled?e.fragment.code.add(n.a`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);
float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
}
float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
}`):e.fragment.code.add(n.a`return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
}`)}},function(e,t,r){"use strict";var i=r(99);class n{constructor(e,t,r){this.name=e,this.details=r,this.message=void 0,this instanceof n&&(this.message=t&&function(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(function(e,r){if(""===r)return"$";const n=Object(i.b)(r,t),s=null==n?"":n;if(void 0===s)throw new Error(`could not find key "${r}" in template`);return s.toString()}))}(t,r)||"")}toString(){return"["+this.name+"]: "+this.message}}t.a=n},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(87);class n{constructor(e,t){this._observers=e,this._observer=t}remove(){Object(i.j)(this._observers,this._observer)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r(8);var i=r(7),n=r(189);function s(e,t,r){if(e&&t)if("object"==typeof t)for(const i of Object.getOwnPropertyNames(t))s(e,i,t[i]);else{if(-1!==t.indexOf(".")){const i=t.split("."),a=i.splice(i.length-1,1)[0];return void s(Object(n.b)(e,i),a,r)}e[t]=r}}i.a.getLogger("esri.core.accessorSupport.set")},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(2),n=r(104);class s extends n.a{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=Object(i.p)(this._set)}acquire(...e){const t=super.acquire(...e);return this._set.delete(t),t}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}}},function(e,t,r){"use strict";function i(e){return!!e&&e.prototype&&e.prototype.declaredClass&&0===e.prototype.declaredClass.indexOf("esri.core.Collection")}r.d(t,"a",(function(){return i}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(8),n=r(2),s=r(12);function a(e,t,r=!1,a){return new Promise(((l,c)=>{if(Object(s.o)(a))return void c(o());let u=()=>{p(),c(new Error(`Unable to load ${t}`))},d=()=>{const t=e;p(),l(t)},h=()=>{if(!e)return;const t=e;p(),t.src="",c(o())};const p=()=>{Object(i.a)("esri-image-decode")||(e.removeEventListener("error",u),e.removeEventListener("load",d)),u=null,d=null,e=null,Object(n.j)(a)&&a.removeEventListener("abort",h),h=null,r&&URL.revokeObjectURL(t)};Object(n.j)(a)&&a.addEventListener("abort",h),Object(i.a)("esri-image-decode")?e.decode().then(d,u):(e.addEventListener("error",u),e.addEventListener("load",d))}))}function o(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var i=r(224);function n(e){return e?s(e.rings,e.hasZ):null}function s(e,t){if(!e||!e.length)return null;const r=[],n=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let i=0,o=e.length;i<o;i++){const r=a(e[i],t,s);r&&n.push(r)}if(n.sort(((e,r)=>{let i=e[2]-r[2];return 0===i&&t&&(i=e[4]-r[4]),i})),n.length&&(r[0]=n[0][0],r[1]=n[0][1],t&&(r[2]=n[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||t&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=e[0]&&e[0].length?function(e,t){const r=t?[0,0,0]:[0,0],n=t?[0,0,0]:[0,0];let s=0,a=0,o=0,l=0;for(let c=0,u=e.length;c<u-1;c++){const u=e[c],d=e[c+1];if(u&&d){r[0]=u[0],r[1]=u[1],n[0]=d[0],n[1]=d[1],t&&u.length>2&&d.length>2&&(r[2]=u[2],n[2]=d[2]);const e=Object(i.a)(r,n);if(e){s+=e;const r=Object(i.b)(u,d);a+=e*r[0],o+=e*r[1],t&&r.length>2&&(l+=e*r[2])}}}return s>0?t?[a/s,o/s,l/s]:[a/s,o/s]:e.length?e[0]:null}(e[0],t):null;if(!n)return null;r[0]=n[0],r[1]=n[1],t&&n.length>2&&(r[2]=n[2])}return r}function a(e,t,r){let i=0,n=0,s=0,a=0,o=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,u=e.length&&t?e[0][2]:0;for(let h=0;h<e.length;h++){const d=e[h],p=e[(h+1)%e.length],[f,b,m]=d,g=f-l,y=b-c,v=t?m-u:void 0,[O,j,_]=p,w=O-l,x=j-c,S=t?_-u:void 0,T=g*x-w*y;if(a+=T,i+=(g+w)*T,n+=(y+x)*T,t&&d.length>2&&p.length>2){const e=g*S-w*v;s+=(v+S)*e,o+=e}f<r[0]&&(r[0]=f),f>r[1]&&(r[1]=f),b<r[2]&&(r[2]=b),b>r[3]&&(r[3]=b),t&&(m<r[4]&&(r[4]=m),m>r[5]&&(r[5]=m))}if(a>0&&(a*=-1),o>0&&(o*=-1),!a)return null;a*=.5,o*=.5;const d=[i/(6*a)+l,n/(6*a)+c,a];return t&&(r[4]===r[5]||0===o?(d[3]=(r[4]+r[5])/2,d[4]=0):(d[3]=s/(6*o)+u,d[4]=o)),d}},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(1),a=(r(8),r(9),r(7),r(4));let o=class extends n.a{constructor(e){super(e)}clone(){}};Object(i.a)([Object(s.b)({readOnly:!0,json:{read:!1}})],o.prototype,"type",void 0),o=Object(i.a)([Object(a.a)("esri.webscene.background.Background")],o);var l=o;t.a=l},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(1),o=(r(8),r(9),r(7),r(37)),l=r(4),c=r(116),u=r(501);const d={...c.a,nonNullable:!0};let h=i=class extends u.a{constructor(e){super(e),this.type="color",this.color=new s.a([0,0,0,1])}clone(){return new i(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};Object(n.a)([Object(o.a)({color:"color"},{readOnly:!0})],h.prototype,"type",void 0),Object(n.a)([Object(a.b)(d)],h.prototype,"color",void 0),h=i=Object(n.a)([Object(l.a)("esri.webscene.background.ColorBackground")],h);var p=h;t.a=p},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(327),l=r(321);let c=i=class extends o.a{constructor(e){super(e),this.type="bar-chart"}clone(){return new i({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};Object(n.a)([Object(s.b)({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:l.a.write}})],c.prototype,"type",void 0),c=i=Object(n.a)([Object(a.a)("esri.popup.content.BarChartMediaInfo")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i,n=r(0),s=r(19),a=r(48),o=(r(8),r(9),r(7),r(1)),l=r(4);let c=i=class extends s.a{constructor(e){super(e),this.tooltip=null,this.value=null,this.x=null,this.y=null}clone(){return new i({tooltip:this.tooltip,value:this.value})}};Object(n.a)([Object(o.b)()],c.prototype,"tooltip",void 0),Object(n.a)([Object(o.b)()],c.prototype,"value",void 0),Object(n.a)([Object(a.a)("value")],c.prototype,"x",void 0),Object(n.a)([Object(a.a)("tooltip")],c.prototype,"y",void 0),c=i=Object(n.a)([Object(l.a)("esri.popup.content.support.ChartMediaInfoValueSeries")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(327),l=r(321);let c=i=class extends o.a{constructor(e){super(e),this.type="column-chart"}clone(){return new i({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};Object(n.a)([Object(s.b)({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:l.a.write}})],c.prototype,"type",void 0),c=i=Object(n.a)([Object(a.a)("esri.popup.content.ColumnChartMediaInfo")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(327),l=r(321);let c=i=class extends o.a{constructor(e){super(e),this.type="line-chart"}clone(){return new i({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};Object(n.a)([Object(s.b)({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:l.a.write}})],c.prototype,"type",void 0),c=i=Object(n.a)([Object(a.a)("esri.popup.content.LineChartMediaInfo")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(327),l=r(321);let c=i=class extends o.a{constructor(e){super(e),this.type="pie-chart"}clone(){return new i({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};Object(n.a)([Object(s.b)({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:l.a.write}})],c.prototype,"type",void 0),c=i=Object(n.a)([Object(a.a)("esri.popup.content.PieChartMediaInfo")],c);var u=c;t.a=u},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(503),n=r(505),s=r(536),a=r(506),o=r(507);const l={base:r(393).a,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":i.a,"column-chart":n.a,"line-chart":a.a,"pie-chart":o.a,image:s.a}}},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(4));let l=i=class extends s.a{constructor(e){super(e),this.field=null,this.order=null}clone(){return new i({field:this.field,order:this.order})}};Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],l.prototype,"field",void 0),Object(n.a)([Object(a.b)({type:["asc","desc"],json:{write:!0}})],l.prototype,"order",void 0),l=i=Object(n.a)([Object(o.a)("esri.popup.support.RelatedRecordsInfoFieldOrder")],l);var c=l;t.a=c},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(322);let l=i=class extends o.a{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new i({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};Object(n.a)([Object(s.b)()],l.prototype,"image",void 0),Object(n.a)([Object(s.b)()],l.prototype,"value",void 0),l=i=Object(n.a)([Object(a.a)("esri.support.Action.ActionToggle")],l);var c=l;t.a=c},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(1),a=(r(8),r(9),r(7),r(4));let o=class extends n.a{constructor(e){super(e),this.visible=!0}clone(){}};Object(i.a)([Object(s.b)({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],o.prototype,"type",void 0),Object(i.a)([Object(s.b)({readOnly:!0})],o.prototype,"visible",void 0),o=Object(i.a)([Object(a.a)("esri.symbols.callouts.Callout3D")],o);var l=o;t.a=l},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(369);let l=i=class extends o.a{constructor(){super(...arguments),this.showLegend=null}clone(){return new i({title:this.title,showLegend:this.showLegend})}};Object(n.a)([Object(s.b)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),l=i=Object(n.a)([Object(a.a)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(59),n=r(3),s=r(5),a=r(33);class o{constructor(e,t,r,i){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=r,this.position=i,this.center=Object(s.e)(),Object(a.a)(e.length>=1),Object(a.a)(r.length%this._numIndexPerPrimitive==0),Object(a.a)(r.length>=e.length*this._numIndexPerPrimitive),Object(a.a)(3===i.size||4===i.size);const{data:o,size:c}=i,u=e.length;let d=c*r[this._numIndexPerPrimitive*e[0]];l.clear(),l.push(d),this.bbMin=Object(s.g)(o[d],o[d+1],o[d+2]),this.bbMax=Object(s.c)(this.bbMin);for(let n=0;n<u;++n){const t=this._numIndexPerPrimitive*e[n];for(let e=0;e<this._numIndexPerPrimitive;++e){d=c*r[t+e],l.push(d);let i=o[d];this.bbMin[0]=Math.min(i,this.bbMin[0]),this.bbMax[0]=Math.max(i,this.bbMax[0]),i=o[d+1],this.bbMin[1]=Math.min(i,this.bbMin[1]),this.bbMax[1]=Math.max(i,this.bbMax[1]),i=o[d+2],this.bbMin[2]=Math.min(i,this.bbMin[2]),this.bbMax[2]=Math.max(i,this.bbMax[2])}}Object(n.k)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let h=this.radius*this.radius;for(let n=0;n<l.length;++n){d=l.getItemAt(n);const e=o[d]-this.center[0],t=o[d+1]-this.center[1],r=o[d+2]-this.center[2],i=e*e+t*t+r*r;if(i<=h)continue;const s=Math.sqrt(i),a=.5*(s-this.radius);this.radius=this.radius+a,h=this.radius*this.radius;const c=a/s;this.center[0]+=e*c,this.center[1]+=t*c,this.center[2]+=r*c}l.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Object(n.n)(this.bbMin,this.bbMax)>1){const e=Object(n.k)(Object(s.e)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,r=new Uint8Array(t),i=new Array(8);for(let n=0;n<8;++n)i[n]=0;const{data:a,size:l}=this.position;for(let n=0;n<t;++n){let t=0;const s=this._numIndexPerPrimitive*this.primitiveIndices[n];let o=l*this.indices[s],c=a[o],u=a[o+1],d=a[o+2];for(let e=1;e<this._numIndexPerPrimitive;++e){o=l*this.indices[s+e];const t=a[o],r=a[o+1],i=a[o+2];t<c&&(c=t),r<u&&(u=r),i<d&&(d=i)}c<e[0]&&(t|=1),u<e[1]&&(t|=2),d<e[2]&&(t|=4),r[n]=t,++i[t]}let c=0;for(let n=0;n<8;++n)i[n]>0&&++c;if(c<2)return;const u=new Array(8);for(let n=0;n<8;++n)u[n]=i[n]>0?new Uint32Array(i[n]):void 0;for(let n=0;n<8;++n)i[n]=0;for(let n=0;n<t;++n){const e=r[n];u[e][i[e]++]=this.primitiveIndices[n]}this._children=new Array(8);for(let n=0;n<8;++n)void 0!==u[n]&&(this._children[n]=new o(u[n],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){l.prune()}}const l=new i.a({deallocator:null})},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return o}));var i=r(27),n=r(3),s=r(5),a=r(26);function o(e,t,r,i){return h(e,t,r,u(i,t,r,!0))}function l(e,t,r,i){const s=Object(n.j)(r,Object(n.l)(e,i,t));return Object(n.h)(e,t,Object(n.g)(e,r,s))}const c={dir:Object(s.e)(),len:0,clip:Object(i.b)()};function u(e,t,r,i){const s=c;return e?(r&&i&&(s.len=Object(n.o)(t,r)),Object(n.m)(s.dir,e)):i?(s.len=Object(n.o)(t,r),Object(n.l)(s.dir,r,t),Object(n.g)(s.dir,s.dir,1/s.len)):(Object(n.l)(s.dir,r,t),Object(n.t)(s.dir,s.dir)),s}function d(e,t,r){const i=Object(n.j)(Object(a.s)(e),r.dir),s=-Object(a.w)(e,t);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const o=s/i;return i>0?o<r.clip[1]&&(r.clip[1]=o):o>r.clip[0]&&(r.clip[0]=o),r.clip[0]<=r.clip[1]}function h(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<e.length;n++)if(!d(e[n],t,i))return!1;return!0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(10);function n(e,t,r){var n;const c=e.byteLength/(4*t),u=new Uint32Array(e,0,c*t);let d=new Uint32Array(c);const h=null!=(n=null==r?void 0:r.minReduction)?n:0,p=(null==r?void 0:r.originalIndices)||null,f=p?p.length:0,b=(null==r?void 0:r.componentOffsets)||null;let m=0;if(b)for(let i=0;i<b.length-1;i++){const e=b[i+1]-b[i];e>m&&(m=e)}else m=c;const g=Math.floor(1.1*m)+1;(null==l||l.length<2*g)&&(l=new Uint32Array(Object(i.p)(2*g)));for(let i=0;i<2*g;i++)l[i]=0;let y=0;const v=!!b&&!!p,O=v?f:c,j=v?new Uint32Array(f):null,_=1.96;let w=0!==h?Math.ceil(4*_*_/(h*h)*h*(1-h)):O,x=1,S=b?b[1]:O;for(let i=0;i<O;i++){if(i===w){const e=1-y/i;if(e+_*Math.sqrt(e*(1-e)/i)<h)return null;w*=2}if(i===S){for(let e=0;e<2*g;e++)l[e]=0;if(p)for(let e=b[x-1];e<b[x];e++)j[e]=d[p[e]];S=b[++x]}const e=v?p[i]:i,r=e*t,n=o(u,r,t);let a=n%g,c=y;for(;0!==l[2*a+1];){if(l[2*a]===n){const e=l[2*a+1]-1;if(s(u,r,e*t,t)){c=d[e];break}}a++,a>=g&&(a-=g)}c===y&&(l[2*a]=n,l[2*a+1]=e+1,y++),d[e]=c}if(0!==h&&1-y/c<h)return null;if(v){for(let e=b[x-1];e<j.length;e++)j[e]=d[p[e]];d=j}const T=new Uint32Array(t*y);y=0;for(let i=0;i<O;i++)d[i]===y&&(a(u,(v?p[i]:i)*t,T,y*t,t),y++);if(p&&!v){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=d[p[t]];d=e}return{buffer:T.buffer,indices:d,uniqueCount:y}}function s(e,t,r,i){for(let n=0;n<i;n++)if(e[t+n]!==e[r+n])return!1;return!0}function a(e,t,r,i,n){for(let s=0;s<n;s++)r[i+s]=e[t+s]}function o(e,t,r){let i=0;for(let n=0;n<r;n++)i=e[t+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let l=null},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(2);class n{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}class s{constructor(e){this._context=e,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.dispose())))),this._perConstructorInstances.clear()}acquire(e,t){const r=t.key;let i=this._perConstructorInstances.get(e);i||(i=new Map,this._perConstructorInstances.set(e,i));let s=i.get(r);if(void 0===s){const a=new e(this._context,t,(()=>this.release(a)));s=new n(a),i.set(r,s)}return++s.refCount,s.technique}releaseAndAcquire(e,t,r){if(Object(i.j)(r)){if(t.key===r.key)return r;r.release()}return this.acquire(e,t)}release(e){if(Object(i.i)(e))return;const t=this._perConstructorInstances.get(e.constructor).get(e.key);--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter)}frameUpdate(){this._frameCounter++,this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((t,r)=>{0===t.refCount&&t.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(t.technique.dispose(),e.delete(r))})),0===e.size&&this._perConstructorInstances.delete(t)}))}async hotReload(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{e.push((async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>{e.technique.reload(this._context)})))})(t,r))})),await Promise.all(e)}}},function(e,t,r){"use strict";var i=r(2),n=r(104),s=r(59),a=r(3),o=r(5),l=r(105),c=r(64),u=r(55),d=r(33);class h{constructor(){this.bounds=Object(u.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,r,n=this.depth){return this.node=Object(i.j)(e)?e:h.createEmptyNode(),Object(i.j)(t)&&Object(u.h)(t,this.bounds),this.halfSize=r,this.depth=n,this}advance(e){let t=this.node.children[e];t||(t=h.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const r=O[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*_,this}advanceTo(e,t,r=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!r)return t&&t(this,-1),!1;this.node.residents=null}const i=this._childIndex(e);t&&t(this,i),this.advance(i)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new s.a({shrink:!0}),residents:new s.a({shrink:!0})}}static acquire(){return h._pool.acquire()}static release(e){h._pool.release(e)}static clearPool(){h._pool.prune()}}function p(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function f(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function b(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function m(e,t,r,i){if(1===t){const t=r(e[0]);Object(u.h)(t,i)}else{T[0]=1/0,T[1]=1/0,T[2]=1/0,C[0]=-1/0,C[1]=-1/0,C[2]=-1/0;for(let i=0;i<t;i++){const t=r(e[i]);v(t[3])&&(p(T,t),f(C,t))}Object(a.k)(i,T,C,.5),i[3]=Math.max(C[0]-T[0],C[1]-T[1],C[2]-T[2])/2}}function g(e,t){let r=1/0,i=null;for(let n=0;n<8;++n){const s=y(e,t,j[n]);s<r&&(r=s,i=j[n])}return i}function y(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function v(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}h._pool=new n.a(h);const O=[Object(o.g)(-1,-1,-1),Object(o.g)(1,-1,-1),Object(o.g)(-1,1,-1),Object(o.g)(1,1,-1),Object(o.g)(-1,-1,1),Object(o.g)(1,-1,1),Object(o.g)(-1,1,1),Object(o.g)(1,1,1)],j=[Object(o.g)(-1,-1,-1),Object(o.g)(-1,-1,1),Object(o.g)(-1,1,-1),Object(o.g)(-1,1,1),Object(o.g)(1,-1,-1),Object(o.g)(1,-1,1),Object(o.g)(1,1,-1),Object(o.g)(1,1,1)],_=Math.sqrt(3),w=[null];const x=Object(u.c)(),S=Object(o.e)(),T=Object(o.e)(),C=Object(o.e)(),M=new s.a,P=Object(u.c)(),A=Object(u.c)(),E=Object(u.c)(),R=Object(u.c)(),I=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],D=new s.a,F=[0,0,0,0,0,0,0,0];t.a=class{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new h,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),h.clearPool(),w[0]=null,M.prune(),D.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const r=h.acquire();for(let i=0;i<t;i++){const t=e[i];this._isDegenerate(t)?this._degenerateObjects.add(t):(r.init(this._root),this._add(t,r))}h.release(r)}remove(e,t=null){this._objectCount-=e.length;const r=h.acquire();for(const n of e){const e=Object(i.j)(t)?t:Object(u.h)(this._objectToBoundingSphere(n),P);v(e[3])?(r.init(this._root),this._remove(n,e,r)):this._degenerateObjects.delete(n)}h.release(r),this._shrink()}update(e,t){if(!v(t[3])&&this._isDegenerate(e))return;const r=function(e){return w[0]=e,w}(e);this.remove(r,t),this.add(r)}forEachAlongRay(e,t,r){const i=Object(c.g)(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNode(i,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(i,e)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(i,e)&&r(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,r,i){const n=Object(c.g)(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNodeWithOffset(n,e,i))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)})),!0}))}forEach(e){this._forEachNode(this._root,(t=>{const r=t.node;return r.terminals.forAll(e),null!==r.residents&&r.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,r,i=(()=>!0),n=1/0){let s=1/0,o=1/0,c=null;const d=g(e,t),h=a=>{if(--n,!i(a))return;const d=this._objectToBoundingSphere(a);if(!Object(l.j)(r,d))return;const h=y(e,t,Object(u.g)(d)),p=h-d[3],f=h+d[3];p<s&&(s=p,o=f,c=a)};return this._forEachNodeDepthOrdered(this._root,(i=>{if(n<=0||!Object(l.j)(r,i.bounds))return!1;if(Object(a.g)(S,d,i.halfSize),Object(a.h)(S,S,i.bounds),y(e,t,S)>o)return!1;const s=i.node;return s.terminals.forAll((e=>h(e))),null!==s.residents&&s.residents.forAll((e=>h(e))),!0}),e,t),c}forEachInDepthRange(e,t,r,i,n,s,o){let c=-1/0,d=1/0;const h={setRange:e=>{1===r?(c=Math.max(c,e.near),d=Math.min(d,e.far)):(c=Math.max(c,-e.far),d=Math.min(d,-e.near))}};h.setRange(i);const p=y(t,r,e),f=g(t,r),b=g(t,-1*r),m=e=>{if(!o(e))return;const i=this._objectToBoundingSphere(e),a=Object(u.g)(i),f=y(t,r,a)-p,b=f-i[3],m=f+i[3];b>d||m<c||!Object(l.j)(s,i)||n(e,h)};this._forEachNodeDepthOrdered(this._root,(e=>{if(!Object(l.j)(s,e.bounds))return!1;if(Object(a.g)(S,f,e.halfSize),Object(a.h)(S,S,e.bounds),y(t,r,S)-p>d)return!1;if(Object(a.g)(S,b,e.halfSize),Object(a.h)(S,S,e.bounds),y(t,r,S)-p<c)return!1;const i=e.node;return i.terminals.forAll((e=>m(e))),null!==i.residents&&i.residents.forAll((e=>m(e))),!0}),t,r)}forEachNode(e){this._forEachNode(this._root,(t=>e(t.node,t.bounds,t.halfSize)))}_intersectsNode(e,t){return b(t.bounds,2*-t.halfSize,T),b(t.bounds,2*t.halfSize,C),Object(d.k)(e.origin,e.direction,T,C)}_intersectsNodeWithOffset(e,t,r){return b(t.bounds,2*-t.halfSize,T),b(t.bounds,2*t.halfSize,C),r.applyToMinMax(T,C),Object(d.k)(e.origin,e.direction,T,C)}_intersectsObject(e,t){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||Object(u.j)(r,e)}_intersectsObjectWithOffset(e,t,r){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(u.j)(r.applyToBoundingSphere(i),e)}_forEachNode(e,t){let r=h.acquire().init(e);const i=[r];for(;0!==i.length;){if(r=i.pop(),t(r)&&!r.isLeaf())for(let e=0;e<r.node.children.length;e++)r.node.children[e]&&i.push(h.acquire().init(r).advance(e));h.release(r)}}_forEachNodeDepthOrdered(e,t,r,i=1){let n=h.acquire().init(e);const s=[n];for(function(e,t,r){if(!D.length)for(let i=0;i<8;++i)D.push({index:0,distance:0});for(let i=0;i<8;++i){const r=O[i];D.data[i].index=i,D.data[i].distance=y(e,t,r)}D.sort(((e,t)=>e.distance-t.distance));for(let i=0;i<8;++i)r[i]=D.data[i].index}(r,i,F);0!==s.length;){if(n=s.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=F[e];n.node.children[t]&&s.push(h.acquire().init(n).advance(t))}h.release(n)}}_remove(e,t,r){M.clear();const i=r.advanceTo(t,((e,t)=>{M.push(e.node),M.push(t)}))?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(let n=M.length-2;n>=0;n-=2){const e=M.data[n],t=M.data[n+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new s.a({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let r=0;r<t.length;r++){const i=h.acquire().init(e);this._add(t.getItemAt(r),i),h.release(i)}}_grow(e,t){if(0!==t&&(m(e,t,(e=>this._objectToBoundingSphere(e)),A),v(A[3])&&!this._fitsInsideTree(A)))if(this._nodeIsEmpty(this._root.node))Object(u.h)(A,this._root.bounds),this._root.halfSize=1.25*A[3];else{const e=this._rootBoundsForRootAsSubNode(A);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(A,e):this._growRootAsSubNode(e),h.release(e)}}_rebuildTree(e,t){Object(a.m)(E,t.bounds),E[3]=t.halfSize,m([e,E],2,(e=>e),R);const r=h.acquire().init(this._root);this._root.initFrom(null,R,1.25*R[3]),this._forEachNode(r,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),h.release(r)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,(e=>(r=Math.max(r,e.depth),r+t<=this._maximumDepth))),r+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],r=e;let i=-1/0;const n=this._root.bounds,s=this._root.halfSize;for(let a=0;a<3;a++){const e=n[a]-s-(r[a]-t),o=r[a]+t-(n[a]+s),l=Math.max(0,Math.ceil(e/(2*s))),c=Math.max(0,Math.ceil(o/(2*s)))+1,u=2**Math.ceil(Math.log(l+c)*Math.LOG2E);i=Math.max(i,u),I[a].min=l,I[a].max=c}for(let a=0;a<3;a++){let e=I[a].min,t=I[a].max;const r=(i-(e+t))/2;e+=Math.ceil(r),t+=Math.floor(r);const o=n[a]-s-e*s*2;x[a]=o+(t+e)*s}return x[3]=i*s*_,h.acquire().initFrom(null,x,i*s,0)}_growRootAsSubNode(e){const t=this._root.node;Object(a.m)(A,this._root.bounds),A[3]=this._root.halfSize,this._root.init(e),e.advanceTo(A,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let r=0,i=0;for(;i<t.length&&null==e;)r=i++,e=t[r];for(;i<t.length;)if(t[i++])return-1;return r}_isDegenerate(e){return!v(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=t[0]-r&&e[0]<=t[0]+r&&e[1]>=t[1]-r&&e[1]<=t[1]+r&&e[2]>=t[2]-r&&e[2]<=t[2]+r}}},function(e,t,r){"use strict";var i,n=r(83),s=r(58);!function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:Object(s.d)(1,1,1),vvSizeMaxSize:Object(s.d)(100,100,100),vvSizeOffset:Object(s.d)(0,0,0),vvSizeFactor:Object(s.d)(1,1,1),vvSizeValue:Object(s.d)(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(n.b)()}}(i||(i={}));var a=i;t.a=a},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var i=r(72);class n{constructor(e){this.rctx=e,this.camera=null,this.lastFrameCamera=new i.a,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=a,this.hasOccludees=!1}resetRenderOccludedMask(){this.renderOccludedMask=a}get isHighlightPass(){return 5===this.pass}}class s extends n{constructor(e,t,r,i,n,s){super(e),this.offscreenRenderingHelper=t,this.scenelightingData=r,this.shadowMap=i,this.ssaoHelper=n,this.sliceHelper=s}}const a=13},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(397);function n(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new i.b,t.set(e,r)),r};return e.adds.forAll((e=>{s(e)&&r(e.material).adds.push(e)})),e.removes.forAll((e=>{s(e)&&r(e.material).removes.push(e)})),e.updates.forAll((e=>{s(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}function s(e){return e.data.indexCount>=1}},function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return O}));var i=r(0),n=r(61),s=r(96),a=r(98),o=r(135),l=r(326),c=r(426),u=r(92),d=r(77),h=r(82),p=r(15),f=r(62),b=r(75),m=r(74),g=r(608),y=r(30);class v extends h.a{constructor(e,t,r){super(e,t,r),this._textureRepository=e.waterTextureRepository}initializeProgram(e){const t=v.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:r.useSSR,highStepCount:!0,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new m.a(e.rctx,i,f.a)}ensureResource(e){return this._textureRepository.ready||this._textureRepository.updating||this._textureRepository.loadTextures(e),this._textureRepository.ready?2:1}bindPass(e,t){Object(u.c)(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(a.a)(this.program,t)),0===this.configuration.output&&(t.lighting.setUniforms(this.program,!1),Object(l.b)(this.program,t)),0!==this.configuration.output&&2!==this.configuration.output||(Object(c.b)(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),4===this.configuration.output&&Object(s.b)(this.program,t)}bindDraw(e){Object(u.d)(this.program,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(u.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(o.b)(this.program,e),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||Object(n.c)(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,r=3===e,i=2===e;return Object(y.g)({blending:2!==t.output&&4!==t.output&&t.transparent?r?b.f:Object(b.a)(e):null,depthTest:{func:Object(b.b)(e)},depthWrite:r?t.writeDepth&&y.e:Object(b.c)(e),colorWrite:y.d,polygonOffset:r||i?null:Object(b.g)(t.enableOffset)})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}v.shader=new d.a(g.a,(()=>r.e(206).then(r.bind(null,691))));class O extends p.a{constructor(){super(...arguments),this.output=0,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.useSSR=!1,this.isDraped=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(i.a)([Object(p.b)({count:8})],O.prototype,"output",void 0),Object(i.a)([Object(p.b)()],O.prototype,"receiveShadows",void 0),Object(i.a)([Object(p.b)()],O.prototype,"slicePlaneEnabled",void 0),Object(i.a)([Object(p.b)()],O.prototype,"transparent",void 0),Object(i.a)([Object(p.b)()],O.prototype,"enableOffset",void 0),Object(i.a)([Object(p.b)()],O.prototype,"writeDepth",void 0),Object(i.a)([Object(p.b)()],O.prototype,"useSSR",void 0),Object(i.a)([Object(p.b)()],O.prototype,"isDraped",void 0),Object(i.a)([Object(p.b)({count:4})],O.prototype,"transparencyPassType",void 0),Object(i.a)([Object(p.b)()],O.prototype,"multipassTerrainEnabled",void 0),Object(i.a)([Object(p.b)()],O.prototype,"cullAboveGround",void 0)},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var i=r(6);function n(e){e.fragment.code.add(i.a`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function s(e){e.fragment.code.add(i.a`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(2);function n(e){const t=e.capabilities.disjointTimerQuery;return Object(i.i)(t)?null:t.timestampBits()>0?new s(t):o?null:new a(t)}class s{constructor(e){this.timer=e,this.start=e.createQuery(),e.createTimestamp(this.start)}stop(e,t=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this.checkQueryResult(e,t)}checkQueryResult(e,t){if(!this.timer.resultAvailable(this.end))return void setTimeout((()=>this.checkQueryResult(e,t)),t);if(this.timer.disjoint())return void e(null);const r=this.timer.getResult(this.start),i=this.timer.getResult(this.end);e((i-r)/1e6)}}class a{constructor(e){this.timer=e,this.query=e.createQuery(),o=!0,this.timer.beginTimeElapsed(this.query)}stop(e,t=50){this.timer.endTimeElapsed(),o=!1,this.checkQueryResult(e,t)}checkQueryResult(e,t){const r=this.timer.resultAvailable(this.query),i=this.timer.disjoint();if(!r||i)i?e(null):setTimeout((()=>this.checkQueryResult(e,t)),t);else{const t=this.timer.getResult(this.query);e(t/1e6)}}}let o=!1},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(2),n=(r(66),r(93),r(8),r(109),r(145),r(228),r(47));r(90);class s{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach((e=>e.texture=Object(i.f)(e.texture))),this.cache.clear()}acquire(e){if(Object(i.i)(e))return null;const t=this.patternId(e),r=this.cache.get(t);if(r)return r.refCount++,r.bind;const s=this.patternToTextureData(e,2),a=s.length/2,o={refCount:1,texture:null,bind:e=>(Object(i.i)(o.texture)&&(o.texture=new n.a(this._rctx,{width:s.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},s)),e.bindTexture(o.texture,"stipplePatternTexture"),a)};return this.cache.set(t,o),o.bind}release(e){if(Object(i.i)(e))return;const t=this.patternId(e),r=this.cache.get(t);r&&(r.refCount--,0===r.refCount&&(Object(i.j)(r.texture)&&r.texture.dispose(),this.cache.delete(t)))}swap(e,t){const r=this.acquire(t);return this.release(e),r}patternId(e){return e.join(",")}patternToTextureData(e,t){const r=e.reduce(((e,t)=>e+t))*t,i=new Uint8Array(r);let n=!0,s=0;for(const a of e){for(let e=0;e<a*t;e++)i[s++]=n?255:0;n=!n}return i}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(i.a`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.vertex.code.add(i.a`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${i.a.int(1)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${i.a.int(3)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${i.a.int(4)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${i.a.int(1)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){const t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(i.a`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return n}));var i=r(403);function n(e,t,r){if(e.count!==t.count)return void i.a.error("source and destination buffers need to have the same number of elements");const n=e.count,s=r[0],a=r[1],o=r[2],l=r[3],c=r[4],u=r[5],d=r[6],h=r[7],p=r[8],f=e.typedBuffer,b=e.typedBufferStride,m=t.typedBuffer,g=t.typedBufferStride;for(let i=0;i<n;i++){const e=i*b,t=i*g,r=m[t],n=m[t+1],y=m[t+2],v=m[t+3];f[e]=s*r+l*n+d*y,f[e+1]=a*r+c*n+h*y,f[e+2]=o*r+u*n+p*y,f[e+3]=v}}function s(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride;for(let l=0;l<i;l++){const e=l*s,t=l*o;n[e]=r*a[t],n[e+1]=r*a[t+1],n[e+2]=r*a[t+2],n[e+3]=r*a[t+3]}}function a(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride;for(let l=0;l<i;l++){const e=l*s,t=l*o;n[e]=a[t]>>r,n[e+1]=a[t+1]>>r,n[e+2]=a[t+2]>>r,n[e+3]=a[t+3]>>r}}Object.freeze({__proto__:null,transformMat4:function(e,t,r){if(e.count!==t.count)return void i.a.error("source and destination buffers need to have the same number of elements");const n=e.count,s=r[0],a=r[1],o=r[2],l=r[3],c=r[4],u=r[5],d=r[6],h=r[7],p=r[8],f=r[9],b=r[10],m=r[11],g=r[12],y=r[13],v=r[14],O=r[15],j=e.typedBuffer,_=e.typedBufferStride,w=t.typedBuffer,x=t.typedBufferStride;for(let i=0;i<n;i++){const e=i*_,t=i*x,r=w[t],n=w[t+1],S=w[t+2],T=w[t+3];j[e]=s*r+c*n+p*S+g*T,j[e+1]=a*r+u*n+f*S+y*T,j[e+2]=o*r+d*n+b*S+v*T,j[e+3]=l*r+h*n+m*S+O*T}},transformMat3:n,scale:s,shiftRight:a})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s}));var i=r(81),n=r(136);function s(e,t=n.d){return"number"==typeof e?t(e):Object(i.i)(e)||Object(i.k)(e)?new Uint32Array(e):e}function a(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;t+=1)t%2==0?(i[e++]=t,i[e++]=t+1,i[e++]=t+2):(i[e++]=t+1,i[e++]=t,i[e++]=t+2)}else{let t=0;for(let n=0;n<r;n+=1)if(n%2==0){const r=e[n],s=e[n+1],a=e[n+2];i[t++]=r,i[t++]=s,i[t++]=a}else{const r=e[n+1],s=e[n],a=e[n+2];i[t++]=r,i[t++]=s,i[t++]=a}}return i}function o(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;++t)i[e++]=0,i[e++]=t+1,i[e++]=t+2;return i}{const t=e[0];let n=e[1],s=0;for(let a=0;a<r;++a){const r=e[a+2];i[s++]=t,i[s++]=n,i[s++]=r,n=r}return i}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(35),n=r(2),s=r(17),a=r(31);class o{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.fillStyle=this.colorToRGBA(e.color),this.haloStyle=this.colorToRGB(e.halo.color)}colorToRGB(e){return`rgb(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()})`}colorToRGBA(e){return`rgba(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()},${e[3]})`}static fromSymbol(e,t=1){const r=Object(n.h)(e,"material","color"),l=Object(n.j)(r)?i.a.toUnitRGBA(r):a.b,c=e.halo,u=null!=e.size?Object(s.g)(e.size):12,d={family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:"normal",style:e.font&&e.font.style?e.font.style:"normal"},h=Object(n.j)(c)&&Object(n.j)(c.color)&&c.size>0?{size:Object(s.g)(c.size),color:i.a.toUnitRGBA(c.color)}:{size:0,color:a.b};return new o({size:u,color:l,font:d,halo:h,pixelRatio:t})}}},function(e,t,r){"use strict";var i=r(0),n=r(328),s=r(283),a=r(19),o=r(268),l=r(68),c=r(7),u=r(1),d=(r(8),r(45)),h=r(4);function p(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&null!=e&&null!=(t=e.capabilities)&&t.operations&&"supportsEditing"in e.capabilities.operations&&!0===e.capabilities.operations.supportsEditing)&&!("editingEnabled"in e&&!e.editingEnabled)}var f=r(354),b=r(9);const m=c.a.getLogger("esri.support.groundUtils"),g={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var y=r(629),v=r(630);const O=c.a.getLogger("esri.Map");let j=class extends(Object(v.a)(Object(y.a)(l.a.EventedMixin(a.a)))){constructor(e){super(e),this.allLayers=new o.a({getCollections:()=>{var e,t,r;return[null==(e=this.basemap)?void 0:e.baseLayers,null==(t=this.ground)?void 0:t.layers,this.layers,null==(r=this.basemap)?void 0:r.referenceLayers]},getChildrenFunction:e=>"layers"in e?e.layers:null}),this.allTables=new o.a({getCollections:()=>[this.tables,this.layers],getChildrenFunction:e=>{const t=[];return"tables"in e&&t.push(e.tables),"layers"in e&&t.push(e.layers),t},itemFilterFunction:e=>{const t=e.parent;return t&&"tables"in t&&t.tables.includes(e)}}),this.basemap=null,this.editableLayers=new o.a({getCollections:()=>[this.allLayers],itemFilterFunction:p}),this.ground=new s.a,this._basemapCache=Object(f.b)()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),null==(e=this.ground)||e.destroy(),null==(t=this.basemap)||t.destroy(),Object(f.c)(this._basemapCache),this._basemapCache=null}castBasemap(e){return Object(f.d)(e,this._basemapCache)}castGround(e){return function(e){let t;if("string"==typeof e)if(e in g){const r=g[e];t=new s.a({resourceInfo:{data:{layers:[r]}}})}else m.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=Object(b.m)(s.a,e);return t}(e)||(O.error("Map.ground may not be set to null or undefined"),this._get("ground"))}findLayerById(e){return this.allLayers.find((t=>t.id===e))}findTableById(e){return this.allTables.find((t=>t.id===e))}};Object(i.a)([Object(u.b)({readOnly:!0,dependsOn:[]})],j.prototype,"allLayers",void 0),Object(i.a)([Object(u.b)({readOnly:!0})],j.prototype,"allTables",void 0),Object(i.a)([Object(u.b)({type:n.default})],j.prototype,"basemap",void 0),Object(i.a)([Object(d.a)("basemap")],j.prototype,"castBasemap",null),Object(i.a)([Object(u.b)({readOnly:!0})],j.prototype,"editableLayers",void 0),Object(i.a)([Object(u.b)({type:s.a,nonNullable:!0})],j.prototype,"ground",void 0),Object(i.a)([Object(d.a)("ground")],j.prototype,"castGround",null),j=Object(i.a)([Object(h.a)("esri.Map")],j);var _=j;t.a=_},function(e,t,r){"use strict";var i=r(108),n=r(2),s=r(16),a=r(20),o=r(129),l=r(10);class c{constructor(e){null==e?e=16:e<65536&&(e=Object(l.p)(e)),this._array=new Float32Array(e),this._size=0}resize(e,t){if(this._size=e,this._size>this._array.length){let e=this._array.length||1;for(;e<this._size;)e*=2;const r=new Float32Array(e);return t&&r.set(this._array),this._array=r,!0}const r=2*this._size;if(r<=this._array.length){let e=this._array.length;for(;e>=r;)e=Math.floor(e/2);const i=new Float32Array(e);return t&&i.set(this._array.subarray(0,e)),this._array=i,!0}return!1}append(e){const t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)}erase(e,t){for(let r=e;r<t;++r)this._array[r]=0}get array(){return this._array}get size(){return this._size}}var u=r(33),d=r(435);class h{constructor(e,t,r,i,n,o){this.from=e,this.to=t,this.isVisible=r,this.hasHighlights=i,this.hasOccludees=n,this.transformation=o,null!=o&&(this.transformationNormal=Object(a.c)(o),Object(s.a)(this.transformationNormal,this.transformationNormal),Object(s.e)(this.transformationNormal,this.transformationNormal))}}function p(e,t){const r=e=>({first:e.from,count:e.to-e.from});if(0===e.length)return void e.push(r(t));const i=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(i,t)){const e=t.from-i.first+t.to-t.from;i.count=e}else e.push(r(t))}var f=r(123),b=r(436),m=r(66),g=r(78),y=r(90);function v(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}const O={begin:0,end:0},j=Object(a.d)(),_=Object(a.d)(),w=Object(a.d)();t.a=class{constructor(e,t,r){this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=e,this._material=r,this._materialRep=t,this._glMaterials=Object(f.a)(this._material,this._materialRep),this._bufferWriter=r.createBufferWriter()}dispose(){Object(f.f)(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((e=>{e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((e=>{e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&Object(i.b)(this._glMaterials,(e=>e instanceof d.a))}get rendersOccluded(){return!this.isEmpty&&1!==this._material.renderOccluded}modify(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}addAndRemoveGeometries(e,t){const r=this._bufferWriter,i=r.vertexBufferLayout,s=i.stride/4,a=this._dataByOrigin,o=function(e,t,r,i){const s=new Map,a=t.vertexBufferLayout.stride/4,o=(r,i)=>{const o=r.origin;if(Object(n.i)(o))return;const l=e.get(o.id);let c=s.get(o.id);null==c&&(c={optimalCount:null==l?0:l.optimalCount,sparseCount:null==l?0:l.buffer.size,toAdd:[],toRemove:[],origin:o.vec3},s.set(o.id,c));const u=t.elementCount(r.data)*a;i?(c.optimalCount+=u,c.sparseCount+=u,c.toAdd.push(r)):(c.optimalCount-=u,c.toRemove.push(r))};for(const n of r)o(n,!0);for(const n of i)o(n,!1);return s}(a,r,e,t);o.forEach(((e,t)=>{o.delete(t);const r=e.optimalCount,n=e.sparseCount;let l=a.get(t);if(null==l)Object(u.a)(r>0),l=this.createData(i,r,e.origin),a.set(t,l);else if(0===r)return l.vao.dispose(!0),l.vao=null,void a.delete(t);const c=r<e.sparseCount/2,d=c?r:n,h=O,p=l.buffer.size,f=l.buffer.array,b=l.buffer.resize(d,!1);c||b?this.removeAndRebuild(l,e.toRemove,s,f,h):e.toRemove.length>0?(this.removeByErasing(l,e.toRemove,s,h),e.toAdd.length>0&&(h.end=p)):(h.begin=p,h.end=p);const m=j;Object(u.m)(m,-e.origin[0],-e.origin[1],-e.origin[2]),this.append(l,e.toAdd,s,m,h);const g=l.vao.vertexBuffers.geometry;if(g.byteSize!==l.buffer.array.buffer.byteLength)g.setData(l.buffer.array);else{const{begin:e,end:t}=h;if(e<t){const r=l.buffer.array,i=4,n=e*i,s=t*i;g.setSubData(r,n,n,s)}}l.drawCommandsDirty=!0}))}updateGeometries(e){const t=this._bufferWriter,r=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.updateType,n=i.renderGeometry,s=this._dataByOrigin.get(n.origin.id),a=s&&s.instances.get(n.id);if(!a)return;if(1&e&&(a.isVisible=n.instanceParameters.visible),9&e){const e=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&e}if(16&e&&(a.hasOccludees=!!n.instanceParameters.occludees),6&e){const e=s.buffer.array,i=s.vao;Object(f.c)(n,_,w),t.write({transformation:_,invTranspTransformation:w},n.data,t.vertexBufferLayout.createView(e.buffer),a.from),Object(u.a)(a.from+t.elementCount(n.data)===a.to,"material VBO layout has changed"),i.vertexBuffers.geometry.setSubData(e,a.from*r*4,a.from*r*4,a.to*r*4)}s.drawCommandsDirty=!0}}updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,Object(i.b)(e.instances,(t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees)))}));this._dataByOrigin.forEach((e=>{e.drawCommandsDirty&&((e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,e.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0},0===e.instances.size)return;if(!v(e)){const t=4*e.buffer.size/Object(g.d)(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0,shadowHighlightRest:0})}const t=function(e){return e.sort(((e,t)=>e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0))}([...e.instances.values()]);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const i of t)i.isVisible&&(i.hasOccludees?p(e.drawCommandsOccludees,i):p(e.drawCommandsDefault,i),i.hasHighlights?p(e.drawCommandsHighlight,i):p(e.drawCommandsShadowHighlightRest,i));const r=e=>{let t=0;for(const r of e)t+=r.count;return t/3};e.stats={default:r(e.drawCommandsDefault),highlight:r(e.drawCommandsHighlight),occludees:r(e.drawCommandsOccludees),shadowHighlightRest:r(e.drawCommandsShadowHighlightRest)}})(e),e.drawCommandsDirty=!1)}))}updateLogic(e){return this._material.update(e)}render(e,t,r,i){const s=this._rctx,a=this._glMaterials.get(t),o=5===t||7===t,l=6===t,c=!(o||l);if(3===t&&null===e&&(e=22),!a||2!==a.ensureResources(s)||null!=e&&!a.beginSlot(e)||o&&!this._hasHighlights)return!1;a.ensureParameters(r);const u=a.getPipelineState(e,!1);s.setPipelineState(u);const d=a.technique;s.useProgram(d.program),a.bind(r);let h=!1;return this._dataByOrigin.forEach((t=>{if(Object(n.i)(t.drawCommandsDefault)&&Object(n.i)(t.drawCommandsHighlight)&&Object(n.i)(t.drawCommandsOccludees)&&Object(n.i)(t.drawCommandsShadowHighlightRest))return;if(o&&!t.hasHighlights)return;r.origin=t.origin,d.bindDraw(r,{},{}),d.ensureAttributeLocations(t.vao),s.bindVAO(t.vao);const p=d.primitiveType,f=o?t.drawCommandsHighlight:l&&v(t)?t.drawCommandsShadowHighlightRest:t.drawCommandsDefault;if(Object(n.j)(f)){this.renderCommands(s,p,f);const e=o?t.stats.highlight:l&&v(t)?t.stats.shadowHighlightRest:t.stats.default;Object(b.b)(f.length,e,i),h=!0}if(c){const r=t.drawCommandsOccludees;if(Object(n.j)(r)){const n=a.getPipelineState(e,!0);s.setPipelineState(n),this.renderCommands(s,p,r),s.setPipelineState(u),Object(b.b)(r.length,t.stats.occludees,i),h=!0}}})),h}renderCommands(e,t,r){for(let i=0;i<r.length;i++)e.drawArrays(t,r[i].first,r[i].count)}createData(e,t,r){return{instances:new Map,vao:new y.a(this._rctx,this._material.vertexAttributeLocations,{geometry:Object(o.a)(e)},{geometry:m.a.createVertex(this._rctx,35044)}),buffer:new c(t),optimalCount:0,origin:r,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}}removeAndRebuild(e,t,r,i,n){for(const u of t){const t=u.id,i=e.instances.get(t);e.optimalCount-=(i.to-i.from)*r,e.instances.delete(t)}let s=0;const a=e.buffer.array;n.begin=0,n.end=0;let o=-1,l=-1,c=0;e.instances.forEach((e=>{const t=e.from*r,n=e.to*r,u=n-t;o!==l&&l!==t?(a.set(i.subarray(o,l),c),c+=l-o,o=t):-1===o&&(o=t),l=n,e.from=s/r,s+=u,e.to=s/r})),o!==l&&a.set(i.subarray(o,l),c),n.end=s}removeByErasing(e,t,r,i){i.begin=1/0,i.end=-1/0;let n=-1,s=-1;for(const a of t){const t=a.id,o=e.instances.get(t),l=o.from*r,c=o.to*r;n!==s&&s!==l?(e.buffer.erase(n,s),n=l):-1===n&&(n=l),s=c,e.instances.delete(t),e.optimalCount-=c-l,l<i.begin&&(i.begin=l),c>i.end&&(i.end=c)}n!==s&&e.buffer.erase(n,s)}append(e,t,r,i,a){const o=this._bufferWriter;for(const l of t){const t=Object(n.j)(l.transformation)?Object(s.m)(_,i,l.transformation):i;Object(s.a)(w,t),Object(s.e)(w,w);const c=a.end;o.write({transformation:t,invTranspTransformation:w},l.data,o.vertexBufferLayout.createView(e.buffer.array.buffer),a.end/r);const d=o.elementCount(l.data)*r,p=c+d;Object(u.a)(null==e.instances.get(l.id));const f=l.instanceParameters.visible,b=!!l.instanceParameters.highlights&&f,m=!!l.instanceParameters.occludees,g=new h(c/r,p/r,f,b,m);e.instances.set(l.id,g),e.optimalCount+=d,a.end+=d}}get test(){return{material:this._material,glMaterials:this._glMaterials}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var i=r(3),n=r(5),s=r(220),a=r(10);function o(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function l(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function c(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function u(e){return(e+1)*(e+1)}function d(e,t,r){const i=e[0],n=e[1],s=e[2],a=r||[];return a.length=u(t),t>=0&&(a[0]=.28209479177),t>=1&&(a[1]=.4886025119*i,a[2]=.4886025119*s,a[3]=.4886025119*n),t>=2&&(a[4]=1.09254843059*i*n,a[5]=1.09254843059*n*s,a[6]=.31539156525*(3*s*s-1),a[7]=1.09254843059*i*s,a[8]=.54627421529*(i*i-n*n)),a}function h(e,t){const r=(n=t.r.length,Object(a.e)(Math.floor(Math.sqrt(n)-1),0,2));var n;for(const s of e)Object(i.u)(v,s.direction),d(v,r,g),o(g,O),l(g,s.intensity[0],y),c(t.r,y),l(g,s.intensity[1],y),c(t.g,y),l(g,s.intensity[2],y),c(t.b,y);return t}function p(e,t,r,n){(function(e,t){const r=u(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0})(t,n),Object(i.y)(r.intensity,0,0,0);let a=!1;const o=f,l=b,p=m;o.length=0,l.length=0,p.length=0;for(const c of e)c instanceof s.c&&!a?(Object(i.m)(r.direction,c.direction),r.intensity[0]=c.intensity[0],r.intensity[1]=c.intensity[1],r.intensity[2]=c.intensity[2],r.castShadows=c.castShadows,a=!0):c instanceof s.c||c instanceof s.b?o.push(c):c instanceof s.a?l.push(c):c instanceof s.d&&p.push(c);h(o,n),function(e,t){d(v,0,g);for(const r of e)t.r[0]+=g[0]*O[0]*r.intensity[0]*4*Math.PI,t.g[0]+=g[0]*O[0]*r.intensity[1]*4*Math.PI,t.b[0]+=g[0]*O[0]*r.intensity[2]*4*Math.PI}(l,n);for(const i of p)c(n.r,i.r),c(n.g,i.g),c(n.b,i.b)}const f=[],b=[],m=[],g=[0],y=[0],v=Object(n.e)(),O=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class j{constructor(){this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Object(n.e)(),ambient:{color:Object(n.e)(),intensity:1},diffuse:{color:Object(n.e)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new s.d,this._mainLight={intensity:Object(n.e)(),direction:Object(n.g)(1,0,0),castShadows:!1}}get lightingMainDirection(){return this._mainLight.direction}setLightDirectionUniform(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}setUniforms(e,t=!1){const r=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",r),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("ambientBoostFactor",this._ambientBoost);const i=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8]))}set(e){p(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(i.m)(this._oldSunlight.direction,this._mainLight.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(i.g)(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(i.m)(_,this._oldSunlight.diffuse.color),Object(i.g)(_,_,this._ambientBoost*this.globalFactor),Object(i.h)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,_)}get old(){return this._oldSunlight}}const _=Object(n.e)()},function(e,t,r){"use strict";r.r(t);var i=r(0),n=r(11),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(4));let l=class extends s.a{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new n.a("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};Object(i.a)([Object(a.b)({type:Date})],l.prototype,"created",void 0),Object(i.a)([Object(a.b)()],l.prototype,"id",void 0),Object(i.a)([Object(a.b)()],l.prototype,"portal",void 0),Object(i.a)([Object(a.b)()],l.prototype,"title",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],l.prototype,"url",null),Object(i.a)([Object(a.b)()],l.prototype,"username",void 0),l=Object(i.a)([Object(o.a)("esri.portal.PortalFolder")],l);var c,u=l,d=r(561);let h=c=class extends s.a{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,r=e&&e.data,i=e&&e.folder,n={method:"post"};t&&(n.query=t.createPostQuery(),null!=r&&("string"==typeof r?n.query.text=r:"object"==typeof r&&(n.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+("string"==typeof i?i:i.id)),this.portal._request(s+"/addItem",n).then((e=>(t.id=e.id,t.portal=this.portal,t.loaded?t.reload():t.load())))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then((()=>{e.id=null,e.portal=null}))}deleteItems(e){const t=this.userContentUrl+"/deleteItems",r=e.map((e=>e.id));if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal._request(t,i).then((()=>{e.forEach((e=>{e.id=null,e.portal=null}))}))}return Promise.resolve(void 0)}fetchFolders(){return this.portal._request(this.userContentUrl,{query:{num:1}}).then((e=>{let t;return t=e&&e.folders?e.folders.map((e=>{const t=u.fromJSON(e);return t.portal=this.portal,t})):[],t}))}fetchGroups(){return this.portal._request(this.url).then((e=>{let t;return t=e&&e.groups?e.groups.map((e=>{const t=d.default.fromJSON(e);return t.portal=this.portal,t})):[],t}))}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),Promise.resolve().then(r.bind(null,306)).then((({default:r})=>{t=r;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:n})})).then((e=>{let r;return e&&e.items?(r=e.items.map((e=>{const r=t.fromJSON(e);return r.portal=this.portal,r})),Promise.all(r.map((e=>e.load()))).catch((e=>e)).then((()=>({items:r,nextStart:e.nextStart,total:e.total})))):{items:[],nextStart:-1,total:0}}))}fetchTags(){return this.portal._request(this.url+"/tags").then((e=>e.tags))}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new d.default({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new n.a("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new n.a("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new c;return t.sourceJSON=e,t.read(e),t}};Object(i.a)([Object(a.b)()],h.prototype,"access",void 0),Object(i.a)([Object(a.b)({type:Date})],h.prototype,"created",void 0),Object(i.a)([Object(a.b)()],h.prototype,"culture",void 0),Object(i.a)([Object(a.b)()],h.prototype,"description",void 0),Object(i.a)([Object(a.b)()],h.prototype,"email",void 0),Object(i.a)([Object(a.b)()],h.prototype,"favGroupId",void 0),Object(i.a)([Object(a.b)()],h.prototype,"fullName",void 0),Object(i.a)([Object(a.b)({type:Date})],h.prototype,"modified",void 0),Object(i.a)([Object(a.b)()],h.prototype,"orgId",void 0),Object(i.a)([Object(a.b)()],h.prototype,"portal",void 0),Object(i.a)([Object(a.b)()],h.prototype,"preferredView",void 0),Object(i.a)([Object(a.b)()],h.prototype,"privileges",void 0),Object(i.a)([Object(a.b)()],h.prototype,"region",void 0),Object(i.a)([Object(a.b)()],h.prototype,"role",void 0),Object(i.a)([Object(a.b)()],h.prototype,"roleId",void 0),Object(i.a)([Object(a.b)()],h.prototype,"sourceJSON",void 0),Object(i.a)([Object(a.b)()],h.prototype,"thumbnail",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],h.prototype,"thumbnailUrl",null),Object(i.a)([Object(a.b)()],h.prototype,"units",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],h.prototype,"userContentUrl",null),Object(i.a)([Object(a.b)({readOnly:!0})],h.prototype,"url",null),Object(i.a)([Object(a.b)()],h.prototype,"username",void 0),Object(i.a)([Object(a.b)()],h.prototype,"userType",void 0),h=c=Object(i.a)([Object(o.a)("esri.portal.PortalUser")],h);var p=h;t.default=p},function(e,t,r){"use strict";var i=r(7),n=r(2);const s=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];function a(e,t){return e+"_"+s.find((e=>e.output===t)).name}var o=r(33);const l=i.a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep");class c{constructor(e){this.refCnt=0,this.glMaterial=e}incRefCnt(){++this.refCnt}decRefCnt(){--this.refCnt,Object(o.a)(this.refCnt>=0)}getRefCnt(){return this.refCnt}getGLMaterial(){return this.glMaterial}}t.a=class{constructor(e,t,r){this._textureRep=e,this._techniqueRep=t,this.onMaterialChanged=r,this._id2glMaterialRef=new Map}dispose(){this._textureRep.dispose()}acquire(e,t){this.ownMaterial(e);const r=a(e.id,t);let i=this._id2glMaterialRef.get(r);if(null==i){const n=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t});return i=new c(n),i.incRefCnt(),this._id2glMaterialRef.set(r,i),n}return i.incRefCnt(),i.getGLMaterial()}release(e,t){const r=a(e.id,t),i=this._id2glMaterialRef.get(r);if(i.decRefCnt(),0===i.getRefCnt()){const e=i.getGLMaterial();e&&e.dispose(),this._id2glMaterialRef.delete(r)}}materialChanged(e){for(const t of s)if(5!==t.output&&6!==t.output){const r=this._id2glMaterialRef.get(a(e.id,t.output));if(r&&r.getGLMaterial()){const e=r.getGLMaterial();e.updateParameters&&e.updateParameters()}}this.onMaterialChanged&&this.onMaterialChanged(e)}ownMaterial(e){Object(n.j)(e.materialRepository)&&e.materialRepository!==this&&l.error("Material is already owned by a different material repository"),e.materialRepository=this}}},function(e,t,r){"use strict";var i,n=r(0),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(393),l=r(14);let c=i=class extends l.a{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new i({linkURL:this.linkURL,sourceURL:this.sourceURL})}};Object(n.a)([Object(s.b)({type:String,json:{write:!0}})],c.prototype,"linkURL",void 0),Object(n.a)([Object(s.b)({type:String,json:{write:!0}})],c.prototype,"sourceURL",void 0),c=i=Object(n.a)([Object(a.a)("esri.popup.content.support.ImageMediaInfoValue")],c);var u,d=c;let h=u=class extends o.a{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new u({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};Object(n.a)([Object(s.b)({type:Number,json:{write:!0}})],h.prototype,"refreshInterval",void 0),Object(n.a)([Object(s.b)({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],h.prototype,"type",void 0),Object(n.a)([Object(s.b)({type:d,json:{write:!0}})],h.prototype,"value",void 0),h=u=Object(n.a)([Object(a.a)("esri.popup.content.ImageMediaInfo")],h);var p=h;t.a=p},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(1),o=(r(8),r(9)),l=(r(7),r(4));const c={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let u=i=class extends s.a{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=function(e){const{exifInfo:t,exifName:r,tagName:i}=e;if(!t||!r||!i)return null;const n=t.find((e=>e.name===r));return n?function(e){const{tagName:t,tags:r}=e;if(!r||!t)return null;const i=r.find((e=>e.name===t));return i&&i.value||null}({tagName:i,tags:n.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return c[t]||null}clone(){return new i({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};Object(n.a)([Object(a.b)({type:String})],u.prototype,"contentType",void 0),Object(n.a)([Object(a.b)()],u.prototype,"exifInfo",void 0),Object(n.a)([Object(a.b)({readOnly:!0})],u.prototype,"orientationInfo",null),Object(n.a)([Object(a.b)({type:o.a})],u.prototype,"id",void 0),Object(n.a)([Object(a.b)({type:String})],u.prototype,"globalId",void 0),Object(n.a)([Object(a.b)({type:String})],u.prototype,"keywords",void 0),Object(n.a)([Object(a.b)({type:String})],u.prototype,"name",void 0),Object(n.a)([Object(a.b)({json:{read:!1}})],u.prototype,"parentGlobalId",void 0),Object(n.a)([Object(a.b)({json:{read:!1}})],u.prototype,"parentObjectId",void 0),Object(n.a)([Object(a.b)({type:o.a})],u.prototype,"size",void 0),Object(n.a)([Object(a.b)({json:{read:!1}})],u.prototype,"url",void 0),u=i=Object(n.a)([Object(l.a)("esri.layers.support.AttachmentInfo")],u);var d=u;t.a=d},function(e,t,r){"use strict";r.r(t);var i,n=r(0),s=r(35),a=r(84),o=r(11),l=r(13),c=r(7),u=r(582),d=r(2),h=r(12),p=r(134),f=r(1),b=(r(9),r(8),r(4)),m=r(29),g=r(89),y=r(179),v=r(274),O=r(139),j=r(277);const _=c.a.getLogger("esri.renderers.DictionaryRenderer"),w={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let x=i=class extends(Object(v.a)(y.a)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new u.a(100),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,i){null!=i&&i.origin||super.writeVisualVariables(e,t,r,i)}clone(){return new i({config:Object(l.a)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Object(l.a)(this.fieldMap),url:Object(l.a)(this.url),visualVariables:Object(l.a)(this.visualVariables)})}async getSymbolAsync(e,t){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{r=await this._dictionaryPromise}catch(m){if(Object(h.n)(m))return this._dictionaryPromise=null,null}const i={};if(this.fieldMap)for(const s of this._symbolFields){const t=this.fieldMap[s];if(t&&null!==e.attributes[t]&&void 0!==e.attributes[t]){const r=""+e.attributes[t];i[s]=r}else i[s]=""}const n=r(i,t);if(!n||"string"!=typeof n)return null;const a=Object(p.b)(n).toString(),o=this._symbolCache.get(a);if(o)return o.catch((()=>{this._symbolCache.pop(a)})),o;const l=n.split(";"),c=[],u=[];for(const d of l)if(d&&0!==d.length)if(-1===d.indexOf("po:"))if(-1!==d.indexOf("|"))for(const e of d.split("|"))this._itemNames.has(e)&&c.push(e);else this._itemNames.has(d)&&c.push(d);else{const e=d.substr(3).split("|");if(3===e.length){const t=e[0],r=e[1];let i=e[2];if("DashTemplate"===r)i=i.split(" ").map((e=>Number(e)));else if("Color"===r){const e=new s.a(i).toRgba();i=[e[0],e[1],e[2],255*e[3]]}else i=Number(i);u.push({primitiveName:t,propertyName:r,value:i})}}const f=!Object(d.j)(e.geometry)||!e.geometry.hasZ&&"point"===e.geometry.type,b=this._cimPartsToCIMSymbol(c,u,f,t);return this._symbolCache.put(a,b,1),b}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Object(g.a)(e,t,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];t.has(i)&&e.add(i)}}get arcadeRequired(){return!0}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void _.error("no valid URL!");const t=Object(d.j)(e)?e.abortOptions:null,r=Object(a.default)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},...t}),[{data:i}]=await Promise.all([r,Object(O.e)()]);if(!i)throw this._dictionaryPromise=null,new o.a("esri.renderers.DictionaryRenderer","Bad dictionary data!");const n=i.expression,s=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=s.symbol;const l={};if(this.config){const e=this.config;for(const t in e)l[t]=e[t]}if(s.configuration)for(const a of s.configuration)l.hasOwnProperty(a.name)||(l[a.name]=a.value);const c=[];if(Object(d.j)(e)&&e.fields&&this.fieldMap)for(const a of this._symbolFields){const t=this.fieldMap[a],r=e.fields.filter((e=>e.name===t));r.length>0&&c.push({...r[0],name:a})}return this._dictionaryPromise=Object(O.b)(n,Object(d.j)(e)?e.spatialReference:null,c,l).then((e=>{const t={scale:0};return(r,i)=>{const n=e.repurposeFeature({geometry:null,attributes:r});return t.scale=Object(d.j)(i)?i.scale:void 0,e.evaluate({$feature:n,$view:t})}})).catch((e=>(_.error("Creating dictinoary expression failed:",e),null))),this._dictionaryPromise}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._symbolFields}async _getSymbolPart(e,t){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),i=Object(a.default)(r,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,i);try{return(await i).data}catch(n){return this._ongoingRequests.delete(e),Promise.reject(n)}}_combineSymbolParts(e,t,r){if(!e||0===e.length)return null;const i={...e[0]};if(e.length>1){i.symbolLayers=[];for(const t of e){const e=t;i.symbolLayers.unshift(...e.symbolLayers)}}return r&&(i.callout=w),{type:"CIMSymbolReference",symbol:i,primitiveOverrides:t}}async _cimPartsToCIMSymbol(e,t,r,i){const n=new Array(e.length);for(let a=0;a<e.length;a++)n[a]=this._getSymbolPart(e[a],i);const s=await Promise.all(n);return new j.a({data:this._combineSymbolParts(s,t,r)})}};Object(n.a)([Object(f.b)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],x.prototype,"config",void 0),Object(n.a)([Object(f.b)({type:Object,json:{write:!0}})],x.prototype,"fieldMap",void 0),Object(n.a)([Object(f.b)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],x.prototype,"scaleExpression",void 0),Object(n.a)([Object(m.a)("scaleExpression")],x.prototype,"writeData",null),Object(n.a)([Object(f.b)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],x.prototype,"scaleExpressionTitle",void 0),Object(n.a)([Object(f.b)({type:String,json:{write:!0}})],x.prototype,"url",void 0),Object(n.a)([Object(m.a)("visualVariables")],x.prototype,"writeVisualVariables",null),x=i=Object(n.a)([Object(b.a)("esri.renderers.DictionaryRenderer")],x);var S=x;t.default=S},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(13),o=r(48),l=r(9),c=(r(8),r(7)),u=r(37),d=r(1),h=r(4),p=r(89),f=r(179),b=r(274),m=r(14),g=r(45);const y=c.a.getLogger("esri.renderers.support.AttributeColorInfo");let v=i=class extends m.a{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(y.error(".field: field must be a string value"),null):Object(l.l)(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new i({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};Object(n.a)([Object(d.b)({type:s.a,json:{type:[Number],write:!0}})],v.prototype,"color",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],v.prototype,"field",void 0),Object(n.a)([Object(g.a)("field")],v.prototype,"castField",null),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],v.prototype,"label",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],v.prototype,"valueExpression",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],v.prototype,"valueExpressionTitle",void 0),v=i=Object(n.a)([Object(h.a)("esri.renderers.support.AttributeColorInfo")],v);var O,j=v;let _=O=class extends m.a{constructor(){super(...arguments),this.unit=null}clone(){return new O({unit:this.unit})}};Object(n.a)([Object(d.b)({type:String,json:{write:!0}})],_.prototype,"unit",void 0),_=O=Object(n.a)([Object(h.a)("esri.renderers.support.DotDensityLegendOptions")],_);var w,x=_,S=r(211),T=r(152);let C=w=class extends(Object(b.a)(f.a)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new s.a([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new T.a,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new S.a({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new w({attributes:Object(a.a)(this.attributes),backgroundColor:Object(a.a)(this.backgroundColor),dotBlendingEnabled:Object(a.a)(this.dotBlendingEnabled),dotShape:Object(a.a)(this.dotShape),dotSize:Object(a.a)(this.dotSize),dotValue:Object(a.a)(this.dotValue),legendOptions:Object(a.a)(this.legendOptions),outline:Object(a.a)(this.outline),referenceScale:Object(a.a)(this.referenceScale),visualVariables:Object(a.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map((e=>e.field||e.valueExpression||""))}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await Object(p.a)(e,t,r.valueExpression),r.field&&e.add(r.field)}};Object(n.a)([Object(d.b)({type:[j],json:{write:!0}})],C.prototype,"attributes",void 0),Object(n.a)([Object(d.b)({type:s.a,json:{write:!0}})],C.prototype,"backgroundColor",void 0),Object(n.a)([Object(d.b)({type:Boolean}),Object(o.a)("dotBlendingEnabled")],C.prototype,"blendDots",void 0),Object(n.a)([Object(d.b)({type:Boolean,json:{write:!0}})],C.prototype,"dotBlendingEnabled",void 0),Object(n.a)([Object(d.b)({type:String,json:{write:!1}})],C.prototype,"dotShape",void 0),Object(n.a)([Object(d.b)({type:Number,json:{write:!1}})],C.prototype,"dotSize",void 0),Object(n.a)([Object(d.b)({type:x,json:{write:!0}})],C.prototype,"legendOptions",void 0),Object(n.a)([Object(d.b)({type:T.a,json:{default:null,write:!0}})],C.prototype,"outline",void 0),Object(n.a)([Object(d.b)({type:Number,json:{write:!0}})],C.prototype,"dotValue",void 0),Object(n.a)([Object(d.b)({type:Number}),Object(o.a)("dotValue")],C.prototype,"referenceDotValue",void 0),Object(n.a)([Object(d.b)({type:Number,json:{write:!0}})],C.prototype,"referenceScale",void 0),Object(n.a)([Object(d.b)({type:Number,json:{write:!0}})],C.prototype,"seed",void 0),Object(n.a)([Object(u.a)({dotDensity:"dot-density"})],C.prototype,"type",void 0),C=w=Object(n.a)([Object(h.a)("esri.renderers.DotDensityRenderer")],C);var M=C;t.a=M},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(13),o=r(1),l=(r(9),r(8),r(7),r(37)),c=r(4),u=r(89),d=r(179),h=r(14);let p=i=class extends h.a{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new i({color:this.color,ratio:this.ratio})}};Object(n.a)([Object(o.b)({type:s.a,json:{write:!0}})],p.prototype,"color",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],p.prototype,"ratio",void 0),p=i=Object(n.a)([Object(c.a)("esri.renderers.support.HeatmapColorStop")],p);var f,b=p;let m=f=class extends d.a{constructor(e){super(e),this.blurRadius=10,this.colorStops=[new b({ratio:0,color:new s.a("rgba(255, 140, 0, 0)")}),new b({ratio:.75,color:new s.a("rgba(255, 140, 0, 1)")}),new b({ratio:.9,color:new s.a("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.maxPixelIntensity=100,this.minPixelIntensity=0,this.type="heatmap"}async collectRequiredFields(e,t){const r=this.field;r&&"string"==typeof r&&Object(u.d)(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new f({blurRadius:this.blurRadius,colorStops:Object(a.a)(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})}};Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],m.prototype,"blurRadius",void 0),Object(n.a)([Object(o.b)({type:[b],json:{write:!0}})],m.prototype,"colorStops",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],m.prototype,"field",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:null==r})}}})],m.prototype,"fieldOffset",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],m.prototype,"maxPixelIntensity",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],m.prototype,"minPixelIntensity",void 0),Object(n.a)([Object(l.a)({heatmap:"heatmap"})],m.prototype,"type",void 0),m=f=Object(n.a)([Object(c.a)("esri.renderers.HeatmapRenderer")],m);var g=m;t.a=g},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(587);function n(e){e&&e.writtenProperties&&e.writtenProperties.forEach((e=>{const t=e.target;e.newOrigin&&e.oldOrigin!==e.newOrigin&&Object(i.a)(t)&&t.updateOrigin(e.propName,e.newOrigin)}))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(102),n=r(11),s=r(12),a=r(454),o=r(668);async function l(e,t,r){if(!t||!t.resources)return;const i=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const l=new Set(t.resources.toKeep.map((e=>e.resource.path))),d=new Set,h=[];l.forEach((t=>{i.delete(t),e.paths.push(t)}));for(const n of t.resources.toUpdate)if(i.delete(n.resource.path),l.has(n.resource.path)||d.has(n.resource.path)){const{resource:t,content:i,finish:s,error:l}=n,u=Object(o.getSiblingOfSameTypeI)(t,Object(a.a)());e.paths.push(u.path),h.push(c({resource:u,content:i,finish:s,error:l},r))}else e.paths.push(n.resource.path),h.push(u(n,r)),d.add(n.resource.path);for(const n of t.resources.toAdd)h.push(c(n,r)),e.paths.push(n.resource.path);if(i.forEach((e=>{const r=t.portalItem.resourceFromPath(e);h.push(r.portalItem.removeResource(r).catch((()=>{})))})),0===h.length)return;const p=await Object(s.k)(h);Object(s.x)(r);const f=p.filter((e=>"error"in e)).map((e=>e.error));if(f.length>0)throw new n.a("save:resources","Failed to save one or more resources",{errors:f})}async function c(e,t){const r=await Object(i.d)(e.resource.portalItem.addResource(e.resource,e.content,t));if(!0!==r.ok)throw e.error&&e.error(r.error),r.error;e.finish&&e.finish(e.resource)}async function u(e,t){const r=await Object(i.d)(e.resource.update(e.content,t));if(!0!==r.ok)throw e.error(r.error),r.error;e.finish(e.resource)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(374);const n=/\[([^\[\]]+)\]/gi;function s(e,t,r){return e?e.map((e=>{const s=new i.a;if(s.read(e,r),s.labelExpression){const e=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(n,((t,r)=>`[${function(e,t){if(!t)return e;const r=e.toLowerCase();for(let i=0;i<t.length;i++){const e=t[i].name;if(e.toLowerCase()===r)return e}return e}(r,e)}]`))}return s})):null}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));const i=(()=>{const e=new Array;return e[0]=10,e[1]=10,e[2]=10,e[3]=10,e[4]=5,e})(),n=30},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return s}));const i=!0,n=32,s=200},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var i=r(424),n=r(394),s=r(556);const a={key:"type",base:n.a,typeMap:{algorithmic:i.a,multipart:s.a}};function o(e){return e&&e.type?"algorithmic"===e.type?i.a.fromJSON(e):"multipart"===e.type?s.a.fromJSON(e):null:null}},function(e,t,r){"use strict";var i=r(0),n=r(14),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(32)),l=r(4),c=r(29),u=(r(237),r(431)),d=r(346),h=r(342),p=r(347);let f=class extends n.a{constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];switch(i.type){case"range":t[r]=p.a.fromJSON(i);break;case"codedValue":t[r]=h.a.fromJSON(i);break;case"inherited":t[r]=d.a.fromJSON(i)}}return t}writeDomains(e,t){const r={};for(const i in e)e.hasOwnProperty(i)&&(r[i]=e[i]&&e[i].toJSON());Object(s.c)(r),t.domains=r}readTemplates(e){return e&&e.map((e=>new u.a(e)))}writeTemplates(e,t){t.templates=e&&e.map((e=>e.toJSON()))}};Object(i.a)([Object(a.b)({json:{write:!0}})],f.prototype,"id",void 0),Object(i.a)([Object(a.b)({json:{write:!0}})],f.prototype,"name",void 0),Object(i.a)([Object(a.b)({json:{write:!0}})],f.prototype,"domains",void 0),Object(i.a)([Object(o.a)("domains")],f.prototype,"readDomains",null),Object(i.a)([Object(c.a)("domains")],f.prototype,"writeDomains",null),Object(i.a)([Object(a.b)({json:{write:!0}})],f.prototype,"templates",void 0),Object(i.a)([Object(o.a)("templates")],f.prototype,"readTemplates",null),Object(i.a)([Object(c.a)("templates")],f.prototype,"writeTemplates",null),f=Object(i.a)([Object(l.a)("esri.layers.support.FeatureType")],f);var b=f;t.a=b},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return u}));var i,n=r(61),s=r(378),a=r(310),o=r(316),l=r(6),c=r(73);function u(e){const t=new c.a;return t.include(s.a),t.include(a.a,e),t.include(n.a,e),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2"),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.multipassGeometryEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(l.a`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?l.a`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.screenSizePerspectiveEnabled?l.a`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:l.a`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.multipassGeometryEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?l.a`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:l.a`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.screenSizePerspectiveEnabled?l.a`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:l.a`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),t.fragment.uniforms.add("color","vec4"),t.fragment.uniforms.add("borderColor","vec4"),e.multipassGeometryEnabled&&(t.fragment.include(o.b,e),t.fragment.uniforms.add("inverseViewport","vec2")),t.fragment.code.add(l.a`
    void main() {
      ${e.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = color.a * borderColor.a * coverage.y;
      float colorAlpha = color.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?l.a`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:l.a`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function d(e,t,r){3===r.length?e.setUniform4f(t,r[0],r[1],r[2],1):e.setUniform4fv(t,r)}(i||(i={})).bindUniforms=function(e,t,r){d(e,"color",t.color),e.setUniform1f("pixelRatio",r),e.setUniform2f("screenOffset",t.screenOffset[0]*r,t.screenOffset[1]*r),null!==t.borderColor?(d(e,"borderColor",t.borderColor),e.setUniform1f("borderSize",r)):(e.setUniform4f("borderColor",0,0,0,0),e.setUniform1f("borderSize",0))};var h=Object.freeze({__proto__:null,build:u,get LineCallout(){return i}})},function(e,t,r){"use strict";function i(){const e=new Float32Array(4);return e[3]=1,e}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t){return new Float32Array(e,t,4)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return s}));Object.freeze({__proto__:null,create:i,clone:n,fromValues:function(e,t,r,i){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},createView:s})},function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var i=r(184),n=r(103),s=r(75),a=r(231),o=r(88),l=r(0),c=r(61),u=r(96),d=r(98),h=r(92),p=r(77),f=r(82),b=r(15),m=r(62),g=r(74),y=r(97),v=r(614),O=r(30);class j extends f.a{initializeProgram(e){const t=j.shader.get(),r=this.configuration,i=t.build({output:r.output,OITEnabled:0===r.transparencyPassType,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new g.a(e.rctx,i,m.a)}bindPass(e,t){Object(h.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),4===this.configuration.output&&Object(u.b)(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(d.a)(this.program,t))}bindDraw(e){Object(h.d)(this.program,e),this.program.rebindTextures(),Object(c.c)(this.program,this.configuration,e)}setPipelineState(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(O.g)({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?s.f:Object(s.a)(e),culling:Object(O.c)(r.cullFace),depthTest:{func:Object(s.b)(e)},depthWrite:i||n?r.writeDepth&&O.e:null,colorWrite:O.d,stencilWrite:r.sceneHasOcludees?y.j:null,stencilTest:r.sceneHasOcludees?t?y.f:y.e:null,polygonOffset:i||n?r.polygonOffset&&_:Object(s.g)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}j.shader=new p.a(v.a,(()=>r.e(187).then(r.bind(null,1055))));const _={factor:1,units:1};class w extends b.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(l.a)([Object(b.b)({count:8})],w.prototype,"output",void 0),Object(l.a)([Object(b.b)({count:3})],w.prototype,"cullFace",void 0),Object(l.a)([Object(b.b)()],w.prototype,"slicePlaneEnabled",void 0),Object(l.a)([Object(b.b)()],w.prototype,"vertexColors",void 0),Object(l.a)([Object(b.b)()],w.prototype,"transparent",void 0),Object(l.a)([Object(b.b)()],w.prototype,"polygonOffset",void 0),Object(l.a)([Object(b.b)()],w.prototype,"enableOffset",void 0),Object(l.a)([Object(b.b)()],w.prototype,"writeDepth",void 0),Object(l.a)([Object(b.b)()],w.prototype,"sceneHasOcludees",void 0),Object(l.a)([Object(b.b)({count:4})],w.prototype,"transparencyPassType",void 0),Object(l.a)([Object(b.b)()],w.prototype,"multipassTerrainEnabled",void 0),Object(l.a)([Object(b.b)()],w.prototype,"cullAboveGround",void 0);class x extends n.a{constructor(e){super(e,T),this.supportsEdges=!0,this.techniqueConfig=new w}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<s.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,r,i,n,s,a){Object(o.i)(e,t,i,n,s,void 0,a)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new S(e):void 0}createBufferWriter(){return new a.a(a.b)}}class S extends i.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(j,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return 4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const T={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...n.b}},function(e,t,r){"use strict";var i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function a(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(n){return!1}}()?Object.assign:function(e,t){for(var r,o,l=a(e),c=1;c<arguments.length;c++){for(var u in r=Object(arguments[c]))n.call(r,u)&&(l[u]=r[u]);if(i){o=i(r);for(var d=0;d<o.length;d++)s.call(r,o[d])&&(l[o[d]]=r[o[d]])}}return l}},function(e,t,r){"use strict";r.r(t),r.d(t,"fetchStyle",(function(){return g})),r.d(t,"fetchSymbolFromStyle",(function(){return v})),r.d(t,"resolveWebStyleSymbol",(function(){return y})),r.d(t,"styleNameFromItem",(function(){return j}));var i=r(84),n=r(86),s=r(402),a=r(11),o=r(25),l=r(118),c=r(238),u=r(314),d=r(115),h=r(174),p=r(365),f=r(356);const b={};function m(e,t,r){const i=t.portal||l.a.getDefault();let n;const s=`${i.url} - ${i.user&&i.user.username} - ${e}`;return b[s]||(b[s]=function(e,t,r){return t.load(r).then((()=>{const i=new c.a({disableExtraQuery:!0,query:`owner:${w} AND type:${x} AND typekeywords:"${e}"`});return t.queryItems(i,r)})).then((({results:t})=>{let i=null;const n=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t)if(e.typeKeywords.some((e=>e.toLowerCase()===n))&&e.type===x&&e.owner===w){i=e;break}if(!i)throw new a.a("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return i.load(r)}))}(e,i,r).then((e=>(n=e,e.fetchData()))).then((t=>({data:t,baseUrl:n.itemUrl,styleName:e})))),b[s]}function g(e,t,r){return e.styleUrl?function(e,t){return _(e,t).then((t=>({data:t.data,baseUrl:Object(o.G)(e),styleUrl:e})))}(e.styleUrl,r):e.styleName?m(e.styleName,t,r):Promise.reject(new a.a("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function y(e,t,r,i){return e.name?e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,r){const i=S.replace(/\{SymbolName\}/gi,e.name);return _(i,r).then((e=>{const r=O(e.data);return Object(h.a)(r,{portal:t.portal,url:Object(o.K)(Object(o.G)(i)),origin:"portal-item"})}))}(e,t,i):g(e,t,i).then((n=>v(n,e.name,t,r,i))):Promise.reject(new a.a("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function v(e,t,r,i,l){const c=e.data,b={portal:r.portal,url:Object(o.K)(e.baseUrl),origin:"portal-item"},m=c.items.find((e=>e.name===t));if(!m){const e=`The symbol name '${t}' could not be found`;return Promise.reject(new a.a("symbolstyleutils:symbol-name-not-found",e,{symbolName:t}))}let g=Object(d.a)(function(e,t){if("cimRef"===t)return e.cimRef;if(e.formatInfos&&!Object(u.c)())for(const r of e.formatInfos)if("gltf"===r.type)return r.href;return e.webRef}(m,i),b),y=m.thumbnail&&m.thumbnail.href;const v=m.thumbnail&&m.thumbnail.imageData;Object(s.b)()&&(g=Object(s.a)(g),y=Object(s.a)(y));const j={portal:r.portal,url:Object(o.K)(Object(o.G)(g)),origin:"portal-item"};return _(g,l).then((s=>{const a="cimRef"===i?O(s.data):s.data,o=Object(h.a)(a,j);if(o&&Object(n.c)(o)){if(y){const e=Object(d.a)(y,b);o.thumbnail=new f.a({url:e})}else v&&(o.thumbnail=new f.a({url:`data:image/png;base64,${v}`}));e.styleUrl?o.styleOrigin=new p.a({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(o.styleOrigin=new p.a({portal:r.portal,styleName:e.styleName,name:t}))}return o}))}function O(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function j(e){for(const t of e.typeKeywords)if(/^Esri.*Style$/.test(t)&&"Esri Style"!==t)return t}function _(e,t){const r={responseType:"json",query:{f:"json"},...t};return Object(i.default)(Object(o.D)(e),r)}const w="esri_en",x="Style",S="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r(11),n=r(13),s=r(2),a=r(99),o=r(364);const l=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile"]),c=new Set(["csv","feature","geo-rss","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","tile","unknown","unsupported","vector-tile","web-tile","wfs"]);function u(e){return!("feature"!==e.type||e.url||!e.source||"memory"!==e.source.type)}function d(e,t){if(t.restrictedWebMapWriting){const r=function(e){return"basemap"===e.layerContainerType?l:"operational-layers"===e.layerContainerType?c:null}(t);return!Object(s.j)(r)||r.has(e.type)&&!u(e)}return!0}function h(e,t){"maxScale"in e&&(t.maxScale=Object(o.b)(e.maxScale)),"minScale"in e&&(t.minScale=Object(o.b)(e.minScale))}function p(e,t){if(function(e,t){if(u(e)){const r=Object(a.b)("featureCollection.layers",t),i=r&&r[0]&&r[0].layerDefinition;i&&h(e,i)}else"stream"===e.type?h(e,t.layerDefinition=t.layerDefinition||{}):"group"!==e.type&&h(e,t)}(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=Object(o.b)(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type)if(u(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function f(e,t,r){if(!("write"in e)||!e.write)return r&&r.messages&&r.messages.push(new i.a("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(d(e,r)){const t={};return e.write(t,r)?t:null}return Object(s.j)(t)&&p(e,t=Object(n.a)(t)),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i,n=r(0),s=r(19),a=r(1),o=(r(8),r(9),r(7),r(4));let l=i=class extends s.a{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new i({x:this.x,y:this.y})}};Object(n.a)([Object(a.b)({type:Number})],l.prototype,"x",void 0),Object(n.a)([Object(a.b)({type:Number})],l.prototype,"y",void 0),l=i=Object(n.a)([Object(o.a)("esri.symbols.support.Symbol3DAnchorPosition2D")],l);var c=l;t.b=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c}));var i=r(110),n=r(84),s=r(25),a=r(537),o=r(325);function l(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function c(e,t){const r={};for(const n of e){const{parentObjectId:e,parentGlobalId:o,attachmentInfos:l}=n;for(const n of l){const{id:l}=n,c=Object(s.b)(Object(i.a)(`${t}/${e}/attachments/${l}`)),u=a.a.fromJSON(n);u.set({url:c,parentObjectId:e,parentGlobalId:o}),r[e]?r[e].push(u):r[e]=[u]}}return r}function u(e,t,r){let i={query:Object(o.a)({...e.query,f:"json",...l(t)})};return r&&(i={...r,...i,query:{...r.query,...i.query}}),Object(n.default)(e.path+"/queryAttachments",i)}},function(e,t,r){"use strict";var i,n=r(0),s=r(13),a=r(1),o=(r(9),r(8),r(7),r(4)),l=r(424),c=r(394);let u=i=class extends c.a{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new i({colorRamps:Object(s.a)(this.colorRamps)})}};Object(n.a)([Object(a.b)({type:[l.a],json:{write:!0}})],u.prototype,"colorRamps",void 0),Object(n.a)([Object(a.b)({type:["multipart"]})],u.prototype,"type",void 0),u=i=Object(n.a)([Object(o.a)("esri.rest.support.MultipartColorRamp")],u);var d=u;t.a=d},function(e,t,r){"use strict";var i=r(2);t.a=class{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(0===this._items.size)return;let e;for(e of this._items);return e}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(Object(i.d)(e)),e}popLast(){if(0===this.length)return;const e=this.last();return this._items.delete(Object(i.d)(e)),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach((t=>{e(t)||this._items.delete(t)})),this}}},function(e,t,r){"use strict";r.d(t,"b",(function(){return h}));var i=r(0),n=r(124),s=r(38),a=r(153),o=(r(8),r(7)),l=r(1),c=(r(9),r(4));const u=s.a.ofType(n.a);o.a.getLogger("esri.support.GraphicsCollection");let d=class extends u{constructor(e){super(e),this.on("before-add",(e=>{e.item||e.preventDefault()})),this.on("after-add",(e=>this._own(e.item))),this.on("after-remove",(({item:e})=>{e.layer=null}))}destroy(){this._unownAll()}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._unownAll(),this._set("owner",e),this._ownAll())}_createNewInstance(e){return new u(e)}_ownAll(){this.items.forEach((e=>this._own(e)))}_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_unownAll(){this.items.forEach((e=>this._unown(e)))}_unown(e){e.layer===this.owner&&(e.layer=null)}};Object(i.a)([Object(l.b)()],d.prototype,"owner",null),d=Object(i.a)([Object(c.a)("esri.support.GraphicsCollection")],d);const h=(e="graphics")=>({type:d,cast:a.a,set(t){const r=Object(a.b)(t,this._get(e),d);r.owner=this,this._set(e,r)}});var p=d;t.a=p},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(210),n=r(317),s=r(6);function a(e,t){e.include(i.a,t),e.fragment.include(n.a);const r=e.fragment;r.uniforms.add("uBaseColor","vec4"),r.uniforms.add("uObjectOpacity","float"),t.attributeColor?r.code.add(s.a`vec3 _baseColor() {
return uBaseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return uBaseColor.a * vColor.a;
}`):r.code.add(s.a`vec3 _baseColor() {
return uBaseColor.rgb;
}
float _baseOpacity() {
return uBaseColor.a;
}`),r.code.add(s.a`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = uObjectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(271),n=r(132),s=r(6);function a(e,t){const r=e.fragment;0===t.doubleSidedMode?r.code.add(s.a`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`):1===t.doubleSidedMode?(e.include(n.a,t),r.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),r.code.add(s.a`vec3 _adjustDoublesided(vec3 normal) {
vec3 viewDir = vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;
return dot(normal, viewDir) > 0.0 ? -normal : normal;
}`)):2===t.doubleSidedMode&&r.code.add(s.a`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`),0===t.normalType||1===t.normalType?(e.include(i.a,t),r.code.add(s.a`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`)):3===t.normalType?(e.extensions.add("GL_OES_standard_derivatives"),e.include(n.a,t),r.code.add(s.a`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`)):2===t.normalType&&(1===t.viewingMode?(e.include(n.a,t),r.code.add(s.a`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):2===t.viewingMode&&r.code.add(s.a`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),r.code.add(s.a`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`))}},function(e,t,r){"use strict";r.r(t);var i=r(0),n=r(11),s=r(14),a=r(1),o=(r(8),r(9)),l=(r(7),r(4)),c=r(238);let u=class extends s.a{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then((t=>{const r=t.categorySchema||[];return r.some((e=>"contentCategorySetsGroupQuery.LivingAtlas"===e.source))?this._fetchCategorySchemaSet("LivingAtlas",e):r}))}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new n.a("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let r=Object(o.m)(c.a,e);return parseFloat(this.portal.currentVersion)>5?(r=r||new c.a,this.portal._queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",t)):(r=r?r.clone():new c.a,r.query="group:"+this.id+(r.query?" "+r.query:""),this.portal.queryItems(r,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then((e=>{const r=e.contentCategorySetsGroupQuery;if(r){const e=new c.a;return e.disableExtraQuery=!0,e.num=1,e.query=r,this.portal.queryGroups(e,t)}throw new n.a("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")})).then((r=>{if(r.total){const i=r.results[0],n=new c.a;return n.num=1,n.query=`typekeywords:"${e}"`,i.queryItems(n,t)}throw new n.a("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")})).then((e=>e.total?e.results[0].fetchData("json",t).then((e=>{const t=e&&e.categorySchema;return t&&t.length?t:[]})):[]))}};Object(i.a)([Object(a.b)()],u.prototype,"access",void 0),Object(i.a)([Object(a.b)({type:Date})],u.prototype,"created",void 0),Object(i.a)([Object(a.b)()],u.prototype,"description",void 0),Object(i.a)([Object(a.b)()],u.prototype,"id",void 0),Object(i.a)([Object(a.b)()],u.prototype,"isInvitationOnly",void 0),Object(i.a)([Object(a.b)({type:Date})],u.prototype,"modified",void 0),Object(i.a)([Object(a.b)()],u.prototype,"owner",void 0),Object(i.a)([Object(a.b)()],u.prototype,"portal",void 0),Object(i.a)([Object(a.b)()],u.prototype,"snippet",void 0),Object(i.a)([Object(a.b)()],u.prototype,"sortField",void 0),Object(i.a)([Object(a.b)()],u.prototype,"sortOrder",void 0),Object(i.a)([Object(a.b)()],u.prototype,"tags",void 0),Object(i.a)([Object(a.b)()],u.prototype,"thumbnail",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],u.prototype,"thumbnailUrl",null),Object(i.a)([Object(a.b)()],u.prototype,"title",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],u.prototype,"url",null),u=Object(i.a)([Object(l.a)("esri.portal.PortalGroup")],u);var d=u;t.default=d},function(e,t,r){"use strict";var i=r(0),n=r(19),s=r(68),a=r(178),o=r(371),l=r(7),c=r(206),u=r(1),d=(r(8),r(9),r(4));let h=class extends(Object(a.b)(Object(o.a)(Object(c.b)(s.a.EventedMixin(n.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",r=this.layer&&this.layer.title||"no title";throw l.a.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${r}', id: '${t}')`,e),e}}))}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(i.a)([Object(u.b)()],h.prototype,"fullOpacity",null),Object(i.a)([Object(u.b)()],h.prototype,"layer",void 0),Object(i.a)([Object(u.b)()],h.prototype,"parent",void 0),Object(i.a)([Object(u.b)({readOnly:!0})],h.prototype,"suspended",null),Object(i.a)([Object(u.b)({readOnly:!0})],h.prototype,"suspendInfo",null),Object(i.a)([Object(u.b)({readOnly:!0})],h.prototype,"legendEnabled",null),Object(i.a)([Object(u.b)({type:Boolean,readOnly:!0})],h.prototype,"updating",null),Object(i.a)([Object(u.b)({readOnly:!0})],h.prototype,"updatingProgress",null),Object(i.a)([Object(u.b)()],h.prototype,"visible",null),h=Object(i.a)([Object(d.a)("esri.views.layers.LayerView")],h);var p=h;t.a=p},function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var i=r(0),n=r(110),s=r(84),a=r(102),o=r(11),l=r(7),c=r(2),u=r(12),d=r(25),h=r(1),p=(r(8),r(9),r(32)),f=r(4),b=r(29),m=r(118),g=r(306),y=r(534);const v=l.a.getLogger("esri.layers.mixins.PortalLayer"),O=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var e;null==(e=this.portalItem)||e.destroy(),this.portalItem=null}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,r){if(t.itemId)return new g.default({id:t.itemId,portal:r&&r.portal})}writePortalItem(e,t){e&&e.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem&&this.portalItem.id)try{const i=await r.e(78).then(r.bind(null,686));return Object(u.x)(t),await i.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)}catch(i){throw Object(u.n)(i)||v.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${i}`),i}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this.fetchUserHasEditingPrivileges(e).catch((e=>(Object(u.w)(e),!0))))}async fetchUserHasEditingPrivileges(e){const t=this.url?null==n.b?void 0:n.b.findCredential(this.url):null;if(!t)return!0;const r=j.credential===t?j.user:await this.fetchEditingUser(e);return j.credential=t,j.user=r,Object(c.i)(r)||null==r.privileges||r.privileges.includes("features:user:edit")}async fetchEditingUser(e){var t,r;const i=null==(t=this.portalItem)||null==(r=t.portal)?void 0:r.user;if(i)return i;const o=n.b.findServerInfo(this.url);if(null==o||!o.owningSystemUrl)return null;const l=`${o.owningSystemUrl}/sharing/rest`,u=m.a.getDefault();if(u&&u.loaded&&Object(d.D)(u.restUrl)===Object(d.D)(l))return u.user;const h=`${l}/community/self`,p=Object(c.j)(e)?e.signal:null,f=await Object(a.d)(Object(s.default)(h,{authMode:"no-prompt",query:{f:"json"},signal:p}));return f.ok?y.default.fromJSON(f.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const r=t&&t.portal,i=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||m.a.getDefault());return r&&i&&!Object(d.r)(i.restUrl,r.restUrl)?(t.messages&&t.messages.push(new o.a("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return Object(i.a)([Object(h.b)({type:g.default})],t.prototype,"portalItem",null),Object(i.a)([Object(p.a)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),Object(i.a)([Object(b.a)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),Object(i.a)([Object(h.b)()],t.prototype,"resourceReferences",void 0),Object(i.a)([Object(h.b)({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=Object(i.a)([Object(f.a)("esri.layers.mixins.PortalLayer")],t),t},j={credential:null,user:null}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(0),n=r(23),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(329);const l=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),Object(o.b)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=Object(n.h)(this.view.defaultsFromMap,"isHeightModelInfoSearching");this.handles.add(e),await e;const t=Object(o.c)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(t)throw t}};return Object(i.a)([Object(s.b)()],t.prototype,"view",void 0),Object(i.a)([Object(s.b)()],t.prototype,"slicePlaneEnabled",void 0),t=Object(i.a)([Object(a.a)("esri.views.3d.layers.LayerView3D")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=r(1),s=(r(8),r(9),r(7),r(4));const a=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get scaleRangeId(){return`${this.minScale},${this.maxScale}`}};return Object(i.a)([Object(n.b)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),Object(i.a)([Object(n.b)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),Object(i.a)([Object(n.b)({readOnly:!0})],t.prototype,"scaleRangeId",null),t=Object(i.a)([Object(s.a)("esri.layers.mixins.ScaleRangeLayer")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=r(1),s=(r(8),r(9),r(7),r(4));const a=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return Object(i.a)([Object(n.b)({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{default:"normal",read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),Object(i.a)([Object(n.b)()],t.prototype,"effect",void 0),t=Object(i.a)([Object(s.a)("esri.layers.mixins.BlendLayer")],t),t}},function(e,t,r){"use strict";function i(e){return"date"===e.type||"esriFieldTypeDate"===e.type}function n(e){return e.toLowerCase().trim()}t.a=class{constructor(e){if(this.fields=e,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],!e)return;const t=[];for(const r of e){const e=r&&r.name;if(e){const s=n(e);this._fieldsMap.set(e,r),this._fieldsMap.set(s,r),t.push(s),i(r)&&(this.dateFields.push(r),this._dateFieldsSet.add(r))}}t.sort(),this.uid=t.join(",")}destroy(){this._fieldsMap.clear()}has(e){return null!=this.get(e)}get(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(n(e)):void 0}isDateField(e){return this._dateFieldsSet.has(this.get(e))}normalizeFieldName(e){const t=this.get(e);if(t)return t.name}}},function(e,t,r){"use strict";r.r(t),r.d(t,"create",(function(){return o})),r.d(t,"projectGeometry",(function(){return l}));var i=r(114),n=r(11),s=r(118),a=r(488);async function o(e=null,t){if(i.a.geometryServiceUrl)return new(0,(await r.e(15).then(r.bind(null,676))).default)({url:i.a.geometryServiceUrl});if(!e)throw new n.a("internal:geometry-service-url-not-configured");let a;if(a="portal"in e?e.portal||s.a.getDefault():e,await a.load({signal:t}),a.helperServices&&a.helperServices.geometry&&a.helperServices.geometry.url)return new(0,(await r.e(15).then(r.bind(null,676))).default)({url:a.helperServices.geometry.url});throw new n.a("internal:geometry-service-url-not-configured")}async function l(e,t,r=null,i){const s=await o(r,i),l=new a.a;l.geometries=[e],l.outSpatialReference=t;const c=await s.project(l,{signal:i});if(c&&Array.isArray(c)&&1===c.length)return c[0];throw new n.a("internal:geometry-service-projection-failed")}},function(e,t,r){"use strict";r.r(t);var i,n=r(0),s=r(305),a=(r(443),r(538),r(539),r(540),r(179),r(414)),o=r(412),l=r(447),c=r(415),u=r(84),d=r(86),h=r(38),p=r(11),f=r(42),b=r(8),m=r(44),g=r(7),y=r(2),v=r(408),O=r(99),j=r(12),_=r(25),w=r(1),x=r(45),S=r(32),T=r(4),C=r(29),M=r(246),P=r(14),A=r(13),E=r(9);let R=i=class extends P.a{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new i({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],R.prototype,"expression",void 0),Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],R.prototype,"name",void 0),Object(n.a)([Object(w.b)({type:["boolean"],json:{write:!0}})],R.prototype,"returnType",void 0),Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],R.prototype,"title",void 0),R=i=Object(n.a)([Object(T.a)("esri.form.ExpressionInfo")],R);var I=R;let D=class extends P.a{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],D.prototype,"description",void 0),Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],D.prototype,"label",void 0),Object(n.a)([Object(w.b)()],D.prototype,"type",void 0),Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],D.prototype,"visibilityExpression",void 0),D=Object(n.a)([Object(T.a)("esri.form.elements.Element")],D);var F,L=D;let k=F=class extends P.a{constructor(e){super(e),this.type=null}clone(){return new F({type:this.type})}};Object(n.a)([Object(w.b)({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],k.prototype,"type",void 0),k=F=Object(n.a)([Object(T.a)("esri.form.elements.inputs.AttachmentInput")],k);var z,V=k;let N=z=class extends L{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new z({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],N.prototype,"attachmentKeyword",void 0),Object(n.a)([Object(w.b)({type:Boolean,json:{write:!0}})],N.prototype,"editable",void 0),Object(n.a)([Object(w.b)({type:V,json:{read:{source:"inputType"},write:{target:"inputType"}}})],N.prototype,"input",void 0),Object(n.a)([Object(w.b)({type:["attachment"],json:{read:!1,write:!0}})],N.prototype,"type",void 0),N=z=Object(n.a)([Object(T.a)("esri.form.elements.AttachmentElement")],N);var U=N;let B=class extends P.a{constructor(e){super(e),this.type=null}};Object(n.a)([Object(w.b)()],B.prototype,"type",void 0),B=Object(n.a)([Object(T.a)("esri.form.elements.inputs.Input")],B);var G=B;let q=class extends G{constructor(e){super(e),this.maxLength=null,this.minLength=0}};Object(n.a)([Object(w.b)({type:Number,json:{write:!0}})],q.prototype,"maxLength",void 0),Object(n.a)([Object(w.b)({type:Number,json:{write:!0}})],q.prototype,"minLength",void 0),q=Object(n.a)([Object(T.a)("esri.form.elements.inputs.TextInput")],q);var H,W=q;let $=H=class extends W{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new H({maxLength:this.maxLength,minLength:this.minLength})}};Object(n.a)([Object(w.b)({type:["barcode-scanner"],json:{read:!1,write:!0}})],$.prototype,"type",void 0),$=H=Object(n.a)([Object(T.a)("esri.form.elements.inputs.BarcodeScannerInput")],$);var Q,Z=$;let X=Q=class extends G{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new Q({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],X.prototype,"noValueOptionLabel",void 0),Object(n.a)([Object(w.b)({type:Boolean,json:{write:!0}})],X.prototype,"showNoValueOption",void 0),Object(n.a)([Object(w.b)({type:["combo-box"],json:{read:!1,write:!0}})],X.prototype,"type",void 0),X=Q=Object(n.a)([Object(T.a)("esri.form.elements.inputs.ComboBoxInput")],X);var J,Y=X;function K(e){return null!=e?new Date(e):null}function ee(e){return e?e.getTime():null}let te=J=class extends G{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return K(t.max)}writeMax(e,t){t.max=ee(e)}readMin(e,t){return K(t.min)}writeMin(e,t){t.min=ee(e)}clone(){return new J({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};Object(n.a)([Object(w.b)({type:Boolean,json:{write:!0}})],te.prototype,"includeTime",void 0),Object(n.a)([Object(w.b)({type:Date,json:{type:Number,write:!0}})],te.prototype,"max",void 0),Object(n.a)([Object(S.a)("max")],te.prototype,"readMax",null),Object(n.a)([Object(C.a)("max")],te.prototype,"writeMax",null),Object(n.a)([Object(w.b)({type:Date,json:{type:Number,write:!0}})],te.prototype,"min",void 0),Object(n.a)([Object(S.a)("min")],te.prototype,"readMin",null),Object(n.a)([Object(C.a)("min")],te.prototype,"writeMin",null),Object(n.a)([Object(w.b)({type:["datetime-picker"],json:{read:!1,write:!0}})],te.prototype,"type",void 0),te=J=Object(n.a)([Object(T.a)("esri.form.elements.inputs.DateTimePickerInput")],te);var re,ie=te;let ne=re=class extends G{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new re({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],ne.prototype,"noValueOptionLabel",void 0),Object(n.a)([Object(w.b)({type:Boolean,json:{write:!0}})],ne.prototype,"showNoValueOption",void 0),Object(n.a)([Object(w.b)({type:["radio-buttons"],json:{read:!1,write:!0}})],ne.prototype,"type",void 0),ne=re=Object(n.a)([Object(T.a)("esri.form.elements.inputs.RadioButtonsInput")],ne);var se,ae=ne;let oe=se=class extends G{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new se({offValue:this.offValue,onValue:this.onValue})}};Object(n.a)([Object(w.b)({type:[String,Number],json:{write:!0}})],oe.prototype,"offValue",void 0),Object(n.a)([Object(w.b)({type:[String,Number],json:{write:!0}})],oe.prototype,"onValue",void 0),Object(n.a)([Object(w.b)({type:["switch"],json:{read:!1,write:!0}})],oe.prototype,"type",void 0),oe=se=Object(n.a)([Object(T.a)("esri.form.elements.inputs.SwitchInput")],oe);var le,ce=oe;let ue=le=class extends W{constructor(e){super(e),this.type="text-area"}clone(){return new le({maxLength:this.maxLength,minLength:this.minLength})}};Object(n.a)([Object(w.b)({type:["text-area"],json:{read:!1,write:!0}})],ue.prototype,"type",void 0),ue=le=Object(n.a)([Object(T.a)("esri.form.elements.inputs.TextAreaInput")],ue);var de,he=ue;let pe=de=class extends W{constructor(e){super(e),this.type="text-box"}clone(){return new de({maxLength:this.maxLength,minLength:this.minLength})}};Object(n.a)([Object(w.b)({type:["text-box"],json:{read:!1,write:!0}})],pe.prototype,"type",void 0),pe=de=Object(n.a)([Object(T.a)("esri.form.elements.inputs.TextBoxInput")],pe);const fe={base:G,key:"type",typeMap:{"barcode-scanner":Z,"combo-box":Y,"datetime-picker":ie,"radio-buttons":ae,switch:ce,"text-area":he,"text-box":pe}};var be,me=r(237);let ge=be=class extends L{constructor(e){super(e),this.domain=null,this.editable=!0,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field"}clone(){return new be({description:this.description,domain:this.domain,editable:this.editable,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,visibilityExpression:this.visibilityExpression})}};Object(n.a)([Object(w.b)({types:me.d,json:{read:{reader:me.b},write:!0}})],ge.prototype,"domain",void 0),Object(n.a)([Object(w.b)({type:Boolean,json:{write:!0}})],ge.prototype,"editable",void 0),Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],ge.prototype,"fieldName",void 0),Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],ge.prototype,"hint",void 0),Object(n.a)([Object(w.b)({types:fe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ge.prototype,"input",void 0),Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],ge.prototype,"requiredExpression",void 0),Object(n.a)([Object(w.b)({type:String,json:{read:!1,write:!0}})],ge.prototype,"type",void 0),ge=be=Object(n.a)([Object(T.a)("esri.form.elements.FieldElement")],ge);var ye,ve=ge,Oe=r(509);let je=ye=class extends L{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new ye({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:Object(A.a)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};Object(n.a)([Object(w.b)({type:Number,json:{write:!0}})],je.prototype,"displayCount",void 0),Object(n.a)([Object(w.b)({type:["list"],json:{write:!0}})],je.prototype,"displayType",void 0),Object(n.a)([Object(w.b)({type:Boolean,json:{write:!0}})],je.prototype,"editable",void 0),Object(n.a)([Object(w.b)({type:[Oe.a],json:{write:!0}})],je.prototype,"orderByFields",void 0),Object(n.a)([Object(w.b)({type:Number,json:{write:!0}})],je.prototype,"relationshipId",void 0),Object(n.a)([Object(w.b)({type:["relationship"],json:{read:!1,write:!0}})],je.prototype,"type",void 0),je=ye=Object(n.a)([Object(T.a)("esri.form.elements.RelationshipElement")],je);var _e,we=je;function xe(e){return{typesWithGroup:{base:L,key:"type",typeMap:{attachment:U,field:ve,group:e,relationship:we}},typesWithoutGroup:{base:L,key:"type",typeMap:{attachment:U,field:ve,relationship:we}}}}function Se(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>i[e.type])).map((e=>i[e.type].fromJSON(e)))}function Te(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>i[e.type])).map((e=>e.toJSON()))}function Ce(e,t,r=!0){return e?e.map((e=>Object(E.k)(r?t.typesWithGroup:t.typesWithoutGroup,e))):null}let Me=_e=class extends L{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Ce(e,Pe,!1)}readElements(e,t){return Se(t.formElements,Pe,!1)}writeElements(e,t){t.formElements=Te(e,Pe,!1)}clone(){return new _e({description:this.description,elements:Object(A.a)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};Object(n.a)([Object(w.b)({json:{write:!0}})],Me.prototype,"elements",void 0),Object(n.a)([Object(x.a)("elements")],Me.prototype,"castElements",null),Object(n.a)([Object(S.a)("elements",["formElements"])],Me.prototype,"readElements",null),Object(n.a)([Object(C.a)("elements")],Me.prototype,"writeElements",null),Object(n.a)([Object(w.b)({type:["collapsed","expanded"],json:{write:!0}})],Me.prototype,"initialState",void 0),Object(n.a)([Object(w.b)({type:String,json:{read:!1,write:!0}})],Me.prototype,"type",void 0),Me=_e=Object(n.a)([Object(T.a)("esri.form.elements.GroupElement")],Me);const Pe=xe(Me);var Ae;const Ee=xe(Me);let Re=Ae=class extends P.a{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Ce(e,Ee)}readElements(e,t){return Se(t.formElements,Ee)}writeElements(e,t){t.formElements=Te(e,Ee)}clone(){return new Ae({description:this.description,expressionInfos:Object(A.a)(this.expressionInfos),elements:Object(A.a)(this.elements),title:this.title})}};Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],Re.prototype,"description",void 0),Object(n.a)([Object(w.b)({json:{write:!0}})],Re.prototype,"elements",void 0),Object(n.a)([Object(x.a)("elements")],Re.prototype,"castElements",null),Object(n.a)([Object(S.a)("elements",["formElements"])],Re.prototype,"readElements",null),Object(n.a)([Object(C.a)("elements")],Re.prototype,"writeElements",null),Object(n.a)([Object(w.b)({type:[I],json:{write:!0}})],Re.prototype,"expressionInfos",void 0),Object(n.a)([Object(w.b)({type:String,json:{write:!0}})],Re.prototype,"title",void 0),Re=Ae=Object(n.a)([Object(T.a)("esri.form.FormTemplate")],Re);var Ie=Re,De=r(50),Fe=r(222),Le=r(39),ke=r(303),ze=(r(113),r(124)),Ve=r(159),Ne=r(206),Ue=r(370);var Be=r(361),Ge=r(373),qe=r(204),He=r(144),We=r(230);let $e=0;const Qe=g.a.getLogger("esri.layers.graphics.sources.MemorySource");let Ze=class extends(Ve.a.LoadableMixin(Object(Ne.b)(h.a))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=Object(y.j)(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;null==(e=this._connection)||e.close(),this._connection=null}get workerGeometryType(){var e;const t=null==(e=this.layer)?void 0:e.geometryType;return t?this._geometryTypeRequiresClientGraphicMapping(t)?"polygon":t:null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}async queryFeatures(e,t={}){await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);Object(Be.a)(e,this.layer.spatialReference,r);const i=qe.default.fromJSON(r);if(!this._requiresClientGraphicMapping())return i;const n=this.layer.objectIdField;for(const s of i.features){const e=s.attributes[n],t=this._idToClientGraphic.get(e);t&&(s.geometry=t.geometry)}return i.geometryType=this.layer.geometryType,i}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new p.a("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return Object(Be.a)(e,this.layer.spatialReference,r),r}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:De.a.fromJSON(e.extent)})))}querySnapping(e,t={}){return this.load(t).then((()=>this._connection.invoke("querySnapping",e,t)))}async _applyEdits(e){if(!this._connection)throw new p.a("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let r=null;const i=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const s=e=>"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[t]?e.attributes[t]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const e=s(c);null!=e&&i.push(e)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures)for(const c of e.updateFeatures)if(n.push(this._serializeFeature(c)),a){const e=s(c);null!=e&&a.set(e,c)}Object(Ge.b)(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:o,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:i});return this.fullExtent=o,r&&r.finish(l.uidToObjectId),this._updateClientGraphicIds(a,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if("mesh"!==this.layerOrSourceGeometryType||Object(y.i)(e))return;const r=[];for(const{geometry:i}of e)!Object(y.j)(i)||"mesh"!==i.type||i.hasExtent||i.loaded||r.push(i.load({signal:t}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const r of t.updateResults){if(!r.success)continue;const t=e.get(r.objectId);null!=t&&this._addIdToClientGraphic(t)}for(const e of t.deleteResults)e.success&&this._idToClientGraphic.delete(e.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new p.a("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,r=new Array(e.length);let i=null;for(let s=0;s<e.length;s++){const n=e[s],a=this._serializeFeature(n);!i&&Object(y.j)(n.geometry)&&(i=n.geometry.type),r[s]=a,t.set(`${a.uid}`,n)}const n=this;return{features:r,inferredGeometryType:i,finish(e){const r=n.sourceJSON.objectIdField;for(const i in e){const s=e[i],a=t.get(i);a&&(a.attributes||(a.attributes={}),-1===s?delete a.attributes[r]:a.attributes[r]=s,n._addIdToClientGraphic(a))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[t];null!=r&&this._idToClientGraphic.set(r,e)}get layerOrSourceGeometryType(){var e,t,r;return null!=(e=null==(t=this.layer)?void 0:t.geometryType)?e:null==(r=this.sourceJSON)?void 0:r.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return"mesh"===e||"multipatch"===e||"extent"===e}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e),i=($e++).toString();return r?{uid:i,geometry:r.toJSON(),attributes:t}:{uid:i,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return Object(y.i)(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?He.a.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await Object(Ue.b)("MemorySourceWorker",{strategy:Object(b.a)("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:r,objectIdField:i,hasM:n,hasZ:s,timeInfo:a}=this.layer,o="defaults"===this.layer.originOf("spatialReference");await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.on("before-changes",(e=>{Qe.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()}));const c={features:l.features,fields:t&&t.map((e=>e.toJSON())),geometryType:We.c.toJSON(this.workerGeometryType),hasM:"mesh"!==this.layerOrSourceGeometryType&&n,hasZ:"mesh"===this.layerOrSourceGeometryType||s,objectIdField:i,spatialReference:o?null:r&&r.toJSON(),timeInfo:a?a.toJSON():null},u=await this._connection.invoke("load",c,{signal:e});for(const h of u.warnings)Qe.warn(h.message,{layer:this.layer,warning:h});u.featureErrors.length&&Qe.warn(`Encountered ${u.featureErrors.length} validation errors while loading features`,u.featureErrors);const d=u.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(d.geometryType=We.c.toJSON(l.inferredGeometryType)),this.sourceJSON=d,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(u.assignedObjectIds)}};var Xe;Object(n.a)([(Xe={Type:ze.a,ensureType:Object(E.m)(ze.a)},(e,t)=>{e[t]=Xe})],Ze.prototype,"itemType",void 0),Object(n.a)([Object(w.b)()],Ze.prototype,"type",void 0),Object(n.a)([Object(w.b)({constructOnly:!0})],Ze.prototype,"layer",void 0),Object(n.a)([Object(w.b)({readOnly:!0})],Ze.prototype,"workerGeometryType",null),Object(n.a)([Object(w.b)()],Ze.prototype,"sourceJSON",void 0),Ze=Object(n.a)([Object(T.a)("esri.layers.graphics.sources.MemorySource")],Ze);var Je,Ye=Ze,Ke=r(577),et=r(573),tt=r(566),rt=r(583),it=r(442),nt=r(563),st=r(570),at=r(565),ot=r(584),lt=r(244),ct=r(177);let ut=Je=class extends P.a{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:r,isUnique:i,description:n}=this;return new Je({name:e,fields:t,isAscending:r,isUnique:i,description:n})}};Object(n.a)([Object(w.b)({constructOnly:!0})],ut.prototype,"name",void 0),Object(n.a)([Object(w.b)({constructOnly:!0})],ut.prototype,"fields",void 0),Object(n.a)([Object(w.b)({constructOnly:!0})],ut.prototype,"isAscending",void 0),Object(n.a)([Object(w.b)({constructOnly:!0})],ut.prototype,"isUnique",void 0),Object(n.a)([Object(w.b)({constructOnly:!0})],ut.prototype,"description",void 0),ut=Je=Object(n.a)([Object(T.a)("esri.layers.support.FeatureIndex")],ut);var dt=r(377),ht=r(476),pt=r(418),ft=r(484),bt=r(431),mt=r(547),gt=r(575),yt=r(89),vt=r(54);let Ot=class extends P.a{constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};Object(n.a)([Object(w.b)({type:String,json:{read:{source:"shapeAreaFieldName"}}})],Ot.prototype,"shapeAreaField",void 0),Object(n.a)([Object(w.b)({type:String,json:{read:{source:"shapeLengthFieldName"}}})],Ot.prototype,"shapeLengthField",void 0),Object(n.a)([Object(w.b)({type:String,json:{read:e=>vt.a.read(e)||vt.m.read(e)}})],Ot.prototype,"units",void 0),Ot=Object(n.a)([Object(T.a)("esri.layers.support.GeometryFieldsInfo")],Ot);var jt=Ot,_t=r(374),wt=r(543),xt=r(638);const St=new m.a({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Tt=new m.a({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Ct=class extends P.a{constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};Object(n.a)([Object(w.b)({json:{read:St.read,write:St.write}})],Ct.prototype,"cardinality",void 0),Object(n.a)([Object(w.b)({json:{read:!0,write:!0}})],Ct.prototype,"composite",void 0),Object(n.a)([Object(w.b)({json:{read:!0,write:!0}})],Ct.prototype,"id",void 0),Object(n.a)([Object(w.b)({json:{read:!0,write:!0}})],Ct.prototype,"keyField",void 0),Object(n.a)([Object(w.b)({json:{read:!0,write:!0}})],Ct.prototype,"keyFieldInRelationshipTable",void 0),Object(n.a)([Object(w.b)({json:{read:!0,write:!0}})],Ct.prototype,"name",void 0),Object(n.a)([Object(w.b)({json:{read:!0,write:!0}})],Ct.prototype,"relatedTableId",void 0),Object(n.a)([Object(w.b)({json:{read:!0,write:!0}})],Ct.prototype,"relationshipTableId",void 0),Object(n.a)([Object(w.b)({json:{read:Tt.read,write:Tt.write}})],Ct.prototype,"role",void 0),Ct=Object(n.a)([Object(T.a)("esri.layers.support.Relationship")],Ct);var Mt=Ct,Pt=r(492),At=r(294),Et=r(585),Rt=r(360),It=r(138),Dt=r(254),Ft=r(227),Lt=r(572);const kt=new m.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),zt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Vt="FeatureLayer",Nt=g.a.getLogger("esri.layers.FeatureLayer");function Ut(e){return e&&e instanceof h.a}function Bt(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}function Gt(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}const qt=Object(gt.a)();function Ht(e,t,r){const i=!(null==r||!r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let Wt=class extends(Object(tt.a)(Object(ot.a)(Object(at.a)(Object(st.a)(Object(et.a)(Object(it.a)(Object(nt.a)(Object(v.a)(Object(rt.a)(Object(Ke.a)(ke.a))))))))))){constructor(...e){super(...e),this._handles=new f.a,this.capabilities=null,this.charts=null,this.copyright=null,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Le.a.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(h.a.ofType(ut)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;null==(e=this.source)||e.destroy(),this._handles=Object(y.e)(this._handles)}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=Object(y.j)(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then((e=>this._initLayerProperties(e))));const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(j.w).then((async()=>{if(this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)){const e=await this._fetchFirstLayerId(t);null!=e&&(this.layerId=e)}if(!this.url&&!this._hasMemorySource())throw new p.a("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))})).then((()=>this.finishLoadEditablePortalLayer(e)));return this.addResolvingPromise(r),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges}set editingEnabled(e){null!=e?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,r){return this._readEditingEnabled(t,!0,r)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,r,i){this._writeEditingEnabled(e,t,!0,i)}readEditingInfo(e,t){const{editingInfo:r}=t;return r?{lastEditDate:null!=r.lastEditDate?new Date(r.lastEditDate):null}:null}readFeatureReduction(e,t){return Object(ft.a)(e,t)}writeWebSceneFeatureReduction(e,t,r,i){Object(ft.c)(e,t,"layerDefinition.featureReduction",i)}readIsTable(e,t){return"Table"===(t=t&&t.layerDefinition||t).type||!t.geometryType}writeIsTable(e,t,r,i){null!=i&&i.writeLayerSchema&&Object(O.c)(r,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(const r of t.fields)if("esriFieldTypeGlobalID"===r.type)return r.name}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(const r of t.fields)if("esriFieldTypeOID"===r.type)return r.name}get parsedUrl(){const e=this.url?Object(_.K)(this.url):null;return null!=e&&(null!=this.dynamicDataSource?e.path=Object(_.z)(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=Object(_.z)(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Object(yt.j)(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,r){const i=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(i){const e=Object(l.b)(i,t,r)||void 0;return e||Nt.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),e}if(t.defaultSymbol)return t.types&&t.types.length?new o.a({defaultSymbol:$t(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map((e=>({id:e.id,symbol:$t(e.symbol,e,r)})))}):new a.a({symbol:$t(t.defaultSymbol,t,r)})}set source(e){const t=this._get("source");t!==e&&(Ut(t)&&this._resetMemorySource(t),Ut(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof h.a?new Ye({layer:this,items:e}):e:null}readSource(e,t){const r=qe.default.fromJSON(t.featureSet);return new Ye({layer:this,items:r&&r.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const r=t.editFieldsInfo,i=r&&r.creatorField,n=r&&r.editorField;return e=e&&e.map((e=>bt.a.fromJSON(e))),this._fixTemplates(e,i),this._fixTemplates(e,n),e}readTitle(e,t){const r=t.layerDefinition&&t.layerDefinition.name||t.name,i=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){const e=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?Object(lt.i)(this.url,r):r;let t=r;if(!t&&this.url){const e=Object(lt.e)(this.url);Object(y.j)(e)&&(t=e.title)}if(!t)return;return"item-title-and-service-name"===this.sublayerTitleMode&&e&&e!==t&&(t=e+" - "+t),Object(lt.a)(t)}if("item-title"===this.sublayerTitleMode&&i)return i}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let r=(t=t.layerDefinition||t).typeIdField;if(r&&t.fields){r=r.toLowerCase();const e=t.fields.find((e=>e.name.toLowerCase()===r));e&&(r=e.name)}return r}readTypes(e,t){e=(t=t.layerDefinition||t).types;const r=t.editFieldsInfo,i=r&&r.creatorField,n=r&&r.editorField;return e&&e.map((e=>(e=mt.a.fromJSON(e),this._fixTemplates(e.templates,i),this._fixTemplates(e.templates,n),e)))}set url(e){const t=Object(lt.h)({layer:this,url:e,nonStandardUrlAllowed:!0,logger:Nt});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,r,i){Object(lt.j)(this,e,null,t,i)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}addAttachment(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("addAttachment"in this.source))throw new p.a(Vt,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)}))}updateAttachment(e,t,r){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("updateAttachment"in this.source))throw new p.a(Vt,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,r)}))}async applyEdits(e,t){const i=await r.e(32).then(r.bind(null,1028));return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return Object(Lt.a)(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await Object(j.A)(r.e(86).then(r.bind(null,1029)),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new It.a,t=this.get("capabilities.data");e.dynamicDataSource=this.dynamicDataSource,e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:r,timeExtent:i}=this;return e.timeExtent=null!=r&&null!=i?i.offset(-r.value,r.unit):i||null,e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("deleteAttachments"in this.source))throw new p.a(Vt,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)}))}fetchRecomputedExtents(e){return this.load({signal:null==e?void 0:e.signal}).then((()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new p.a(Vt,"Layer source does not support fetchUpdates capability")}))}getFeatureType(e){const{typeIdField:t,types:r}=this;if(!t||!e)return null;const i=e.attributes?e.attributes[t]:void 0;if(null==i)return null;let n=null;return r.some((e=>{const{id:t}=e;return null!=t&&(t.toString()===i.toString()&&(n=e),!!n)})),n}getFieldDomain(e,t){const r=t&&t.feature,i=this.getFeatureType(r);if(i){const t=i.domains&&i.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=Rt.a.from(e),this.load().then((()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new p.a(Vt,"this layer doesn't support attachments");const{attachmentTypes:t,objectIds:r,globalIds:i,num:n,size:s,start:a,where:o}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const l=r&&r.length>1,c=t&&t.length,u=i&&i.length,d=s&&s.length;if(l||c||u||d||n||a||o)throw new p.a(Vt,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||o))throw new p.a(Vt,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new p.a(Vt,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)}))}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(It.a.from(e)||this.createQuery(),t))).then((e=>{if(null!=e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(It.a.from(e)||this.createQuery(),t);throw new p.a(Vt,"Layer source does not support queryObjectIds capability")}))}queryFeatureCount(e,t){return this.load().then((()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(It.a.from(e)||this.createQuery(),t);throw new p.a(Vt,"Layer source does not support queryFeatureCount capability")}))}queryExtent(e,t){return this.load().then((()=>{if(this.source.queryExtent)return this.source.queryExtent(It.a.from(e)||this.createQuery(),t);throw new p.a(Vt,"Layer source does not support queryExtent capability")}))}queryRelatedFeatures(e,t){return this.load().then((()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(Dt.a.from(e),t);throw new p.a(Vt,"Layer source does not support queryRelatedFeatures capability")}))}queryRelatedFeaturesCount(e,t){return this.load().then((()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(Dt.a.from(e),t);throw new p.a(Vt,"Layer source does not support queryRelatedFeaturesCount capability")}))}queryTopFeatures(e,t){return this.load().then((()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(Ft.a.from(e),t).then((e=>{if(null!=e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}));throw new p.a(Vt,"Layer source does not support queryTopFeatures capability")}))}queryTopObjectIds(e,t){return this.load().then((()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(Ft.a.from(e),t);throw new p.a(Vt,"Layer source does not support queryTopObjectIds capability")}))}queryTopFeaturesExtent(e,t){return this.load().then((()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(Ft.a.from(e),t);throw new p.a(Vt,"Layer source does not support queryTopExtents capability")}))}queryTopFeatureCount(e,t){return this.load().then((()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(Ft.a.from(e),t);throw new p.a(Vt,"Layer source does not support queryFeatureCount capability")}))}read(e,t){const r=e.featureCollection;if(r){const e=r.layers;e&&1===e.length&&(super.read(e[0],t),null!=r.showLegend&&super.read({showLegend:r.showLegend},t))}super.read(e,t),t&&"service"===t.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var r,i;const n=(t={...t,writeLayerSchema:null!=(r=null==(i=t)?void 0:i.writeLayerSchema)?r:this._hasMemorySource()}).origin,s=t.layerContainerType,a=t.messages;if(this.isTable){if("web-scene"===n||"web-map"===n&&"tables"!==s)return a&&a.push(new p.a("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Table source cannot be written to web scenes and web maps`,{layer:this})),null;if(this._hasMemorySource())return a&&a.push(new p.a("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using an in-memory Table source cannot be written to web scenes and web maps`,{layer:this})),null}else if(this.loaded&&"web-map"===n&&"tables"===s)return a&&a.push(new p.a("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a non-table source cannot be written to tables in web maps`,{layer:this})),null;return super.write(e,t)}_readEditingEnabled(e,t,r){var i;let n=null==(i=e.layerDefinition)?void 0:i.capabilities;return n?this._hasEditingCapability(n):(n=e.capabilities,t&&"web-map"===(null==r?void 0:r.origin)&&!this._hasMemorySource()&&n?this._hasEditingCapability(n):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map((e=>e.trim())).includes("editing")}_writeEditingEnabled(e,t,r,i){if(!e){var n,s;const e=null!=(n=this.capabilities)&&null!=(s=n.operations)&&s.supportsSync?"Query,Sync":"Query";Object(O.c)("layerDefinition.capabilities",e,t),!r||null!=i&&i.writeLayerSchema||(t.capabilities=e)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:r}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[r]?void 0:Promise.reject(new p.a(Vt,`feature is missing the identifying attribute ${r}`)):Promise.reject(new p.a(Vt,"'attributes' are required on a feature to query attachments")):Promise.reject(new p.a(Vt,"A feature is required to add/delete/update attachments")):Promise.reject(new p.a(Vt,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return Object(u.default)(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then((e=>{const t=e.data;if(t)return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}))}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Object(yt.j)(this.renderer,this.fieldsIndex),Object(yt.k)(this.timeInfo,this.fieldsIndex),Object(Et.a)(this,{origin:"service"})}_verifyFields(){const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some((function(e){return"geometry"===e.type}))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach((e=>{const r=e.prototype&&e.prototype.attributes;r&&t&&delete r[t]}))}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new p.a("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new p.a("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach((e=>{e.layer=this,e.sourceLayer=this})),this._handles.add([e.on("after-add",(e=>{e.item.layer=this,e.item.sourceLayer=this})),e.on("after-remove",(e=>{e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")}_resetMemorySource(e){e.forEach((e=>{e.layer=null,e.sourceLayer=null})),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAttachmentCapabilities(e){const t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach((e=>{const r=zt[e.name];r&&(t[r]=!!e.isEnabled)})),t}_readDataCapabilities(e){return{isVersioned:Bt(e,"isDataVersioned",!1),supportsAttachment:Bt(e,"hasAttachments",!1),supportsM:Bt(e,"hasM",!1),supportsZ:Bt(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Bt(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const r=e?e.toLowerCase().split(",").map((e=>e.trim())):[],i=-1!==r.indexOf("editing");let n=i&&-1!==r.indexOf("create"),s=i&&-1!==r.indexOf("delete"),a=i&&-1!==r.indexOf("update");const o=-1!==r.indexOf("changetracking");return i&&!(n||s||a)&&(n=s=a=!0),{supportsCalculate:Bt(t,"supportsCalculate",!1),supportsTruncate:Bt(t,"supportsTruncate",!1),supportsValidateSql:Bt(t,"supportsValidateSql",!1),supportsAdd:n,supportsDelete:s,supportsEditing:i,supportsChangeTracking:o,supportsQuery:-1!==r.indexOf("query"),supportsQueryAttachments:Bt(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:Bt(t,"supportsAttachmentsResizing",!1),supportsSync:-1!==r.indexOf("sync"),supportsUpdate:a,supportsExceedsLimitStatistics:Bt(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var t;const r=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,n=e.archivingInfo,s=null==(t=this.url)?void 0:t.includes("MapServer"),a=!Object(b.a)("mapserver-pbf-enabled")&&s&&this.version<10.81,o=(e.supportedQueryFormats||"").split(",").reduce(((e,t)=>{const r=t.toLowerCase().trim();return r&&e.add(r),e}),new Set);return{supportsStatistics:Bt(r,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Bt(r,"supportsPercentileStatistics",!1),supportsCentroid:Bt(r,"supportsReturningGeometryCentroid",!1),supportsDistance:Bt(r,"supportsQueryWithDistance",!1),supportsDistinct:Bt(r,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Bt(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Bt(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:Bt(r,"supportsHavingClause",!1),supportsOrderBy:Bt(r,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Bt(r,"supportsPagination",!1),supportsQuantization:Bt(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Bt(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Bt(e,"supportsReturningQueryGeometry",!1),supportsResultType:Bt(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Bt(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Bt(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Bt(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Bt(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Bt(i,"allowOthersToQuery",!0),supportsHistoricMoment:Bt(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!a&&o.has("pbf"),supportsDisjointSpatialRelationship:Bt(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:Bt(r,"supportsQueryWithCacheHint",!1),maxRecordCountFactor:Gt(e,"maxRecordCountFactor",void 0),maxRecordCount:Gt(e,"maxRecordCount",void 0),standardMaxRecordCount:Gt(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:Gt(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,r=Bt(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Bt(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Bt(e,"allowGeometryUpdates",!0),supportsGlobalId:Bt(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Bt(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Bt(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Bt(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Bt(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Bt(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Bt(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Bt(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Bt(t,"allowOthersToUpdate",!0)}}};Object(n.a)([Object(w.b)({readOnly:!0,json:{read:!1}})],Wt.prototype,"capabilities",void 0),Object(n.a)([Object(S.a)("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Wt.prototype,"readCapabilities",null),Object(n.a)([Object(w.b)({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Wt.prototype,"charts",void 0),Object(n.a)([Object(w.b)({readOnly:!0})],Wt.prototype,"createQueryVersion",null),Object(n.a)([Object(w.b)({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Wt.prototype,"copyright",void 0),Object(n.a)([Object(w.b)({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Wt.prototype,"displayField",void 0),Object(n.a)([Object(w.b)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Wt.prototype,"definitionExpression",void 0),Object(n.a)([Object(w.b)({types:d.e,readOnly:!0})],Wt.prototype,"defaultSymbol",void 0),Object(n.a)([Object(w.b)({type:At.a})],Wt.prototype,"dynamicDataSource",void 0),Object(n.a)([Object(w.b)({readOnly:!0})],Wt.prototype,"editFieldsInfo",void 0),Object(n.a)([Object(w.b)({type:Boolean})],Wt.prototype,"editingEnabled",null),Object(n.a)([Object(S.a)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Wt.prototype,"readEditingEnabled",null),Object(n.a)([Object(S.a)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Wt.prototype,"readEditingEnabledFromWebMap",null),Object(n.a)([Object(C.a)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Wt.prototype,"writeEditingEnabled",null),Object(n.a)([Object(C.a)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Wt.prototype,"writeEditingEnabledToWebMap",null),Object(n.a)([Object(w.b)({readOnly:!0})],Wt.prototype,"editingInfo",void 0),Object(n.a)([Object(S.a)("editingInfo")],Wt.prototype,"readEditingInfo",null),Object(n.a)([Object(w.b)(ct.b)],Wt.prototype,"elevationInfo",void 0),Object(n.a)([Object(w.b)({types:{key:"type",base:dt.a,typeMap:{selection:pt.a,cluster:ht.a}},json:{write:{target:"layerDefinition.featureReduction"}}})],Wt.prototype,"featureReduction",void 0),Object(n.a)([Object(S.a)("featureReduction",["layerDefinition.featureReduction"])],Wt.prototype,"readFeatureReduction",null),Object(n.a)([Object(C.a)("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:ft.b}})],Wt.prototype,"writeWebSceneFeatureReduction",null),Object(n.a)([Object(w.b)({...qt.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{read:!0},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:Ht}}}}})],Wt.prototype,"fields",void 0),Object(n.a)([Object(w.b)(qt.fieldsIndex)],Wt.prototype,"fieldsIndex",void 0),Object(n.a)([Object(w.b)({type:xt.a,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Wt.prototype,"floorInfo",void 0),Object(n.a)([Object(w.b)({type:Ie,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Wt.prototype,"formTemplate",void 0),Object(n.a)([Object(w.b)({type:De.a,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Wt.prototype,"fullExtent",void 0),Object(n.a)([Object(w.b)()],Wt.prototype,"gdbVersion",void 0),Object(n.a)([Object(w.b)({readOnly:!0,type:jt,json:{read:{source:"geometryProperties"}}})],Wt.prototype,"geometryFieldsInfo",void 0),Object(n.a)([Object(w.b)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:kt.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:Ht,writer(e,t,r){const i=e?kt.toJSON(e):null;i&&Object(O.c)(r,i,t)}}}},read:{source:"layerDefinition.geometryType",reader:kt.read}}})],Wt.prototype,"geometryType",void 0),Object(n.a)([Object(w.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Wt.prototype,"hasM",void 0),Object(n.a)([Object(w.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Wt.prototype,"hasZ",void 0),Object(n.a)([Object(w.b)({readOnly:!0,type:Fe.a})],Wt.prototype,"heightModelInfo",void 0),Object(n.a)([Object(w.b)({type:Date})],Wt.prototype,"historicMoment",void 0),Object(n.a)([Object(w.b)(ct.c)],Wt.prototype,"id",void 0),Object(n.a)([Object(w.b)({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Wt.prototype,"infoFor3D",void 0),Object(n.a)([Object(w.b)({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Wt.prototype,"isTable",void 0),Object(n.a)([Object(S.a)("service","isTable",["type","geometryType"]),Object(S.a)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Wt.prototype,"readIsTable",null),Object(n.a)([Object(C.a)("web-map","isTable")],Wt.prototype,"writeIsTable",null),Object(n.a)([Object(w.b)(ct.d)],Wt.prototype,"labelsVisible",void 0),Object(n.a)([Object(w.b)({type:[_t.a],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:wt.a},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:wt.a},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Wt.prototype,"labelingInfo",void 0),Object(n.a)([Object(w.b)(ct.i)],Wt.prototype,"opacity",void 0),Object(n.a)([Object(w.b)({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],Wt.prototype,"layerId",void 0),Object(n.a)([Object(w.b)(ct.e)],Wt.prototype,"legendEnabled",void 0),Object(n.a)([Object(w.b)({type:["show","hide"]})],Wt.prototype,"listMode",void 0),Object(n.a)([Object(w.b)(ct.g)],Wt.prototype,"minScale",void 0),Object(n.a)([Object(S.a)("service","minScale",["minScale","effectiveMinScale"])],Wt.prototype,"readMinScale",null),Object(n.a)([Object(w.b)(ct.f)],Wt.prototype,"maxScale",void 0),Object(n.a)([Object(S.a)("service","maxScale",["maxScale","effectiveMaxScale"])],Wt.prototype,"readMaxScale",null),Object(n.a)([Object(w.b)({type:String})],Wt.prototype,"globalIdField",void 0),Object(n.a)([Object(S.a)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Object(S.a)("service","globalIdField",["globalIdField","fields"])],Wt.prototype,"readGlobalIdFieldFromService",null),Object(n.a)([Object(w.b)({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:Ht}}}}})],Wt.prototype,"objectIdField",void 0),Object(n.a)([Object(S.a)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Object(S.a)("service","objectIdField",["objectIdField","fields"])],Wt.prototype,"readObjectIdFieldFromService",null),Object(n.a)([Object(w.b)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Wt.prototype,"operationalLayerType",void 0),Object(n.a)([Object(w.b)(qt.outFields)],Wt.prototype,"outFields",void 0),Object(n.a)([Object(w.b)({readOnly:!0})],Wt.prototype,"parsedUrl",null),Object(n.a)([Object(w.b)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Wt.prototype,"path",void 0),Object(n.a)([Object(w.b)(ct.j)],Wt.prototype,"popupEnabled",void 0),Object(n.a)([Object(w.b)({type:s.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Wt.prototype,"popupTemplate",void 0),Object(n.a)([Object(w.b)({readOnly:!0})],Wt.prototype,"defaultPopupTemplate",null),Object(n.a)([Object(w.b)({type:[Mt],readOnly:!0})],Wt.prototype,"relationships",void 0),Object(n.a)([Object(w.b)({types:c.a,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:c.b,write:{target:"layerDefinition.drawingInfo.renderer",writer:l.c}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,r)=>({ignoreOrigin:null==r?void 0:r.writeLayerSchema}),writer:l.c}}})],Wt.prototype,"renderer",null),Object(n.a)([Object(S.a)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Object(S.a)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Wt.prototype,"readRenderer",null),Object(n.a)([Object(w.b)()],Wt.prototype,"sourceJSON",void 0),Object(n.a)([Object(w.b)({type:Boolean})],Wt.prototype,"returnM",void 0),Object(n.a)([Object(w.b)({type:Boolean})],Wt.prototype,"returnZ",void 0),Object(n.a)([Object(w.b)(ct.m)],Wt.prototype,"screenSizePerspectiveEnabled",void 0),Object(n.a)([Object(w.b)()],Wt.prototype,"source",null),Object(n.a)([Object(x.a)("source")],Wt.prototype,"castSource",null),Object(n.a)([Object(S.a)("portal-item","source",["featureSet"]),Object(S.a)("web-map","source",["featureSet"])],Wt.prototype,"readSource",null),Object(n.a)([Object(w.b)({readOnly:!0})],Wt.prototype,"serviceDefinitionExpression",void 0),Object(n.a)([Object(S.a)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Wt.prototype,"readServiceDefinitionExpression",null),Object(n.a)([Object(w.b)({type:Le.a,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Wt.prototype,"spatialReference",void 0),Object(n.a)([Object(w.b)({type:Number})],Wt.prototype,"subtypeCode",void 0),Object(n.a)([Object(w.b)({type:[bt.a]})],Wt.prototype,"templates",void 0),Object(n.a)([Object(S.a)("templates",["editFieldsInfo","creatorField","editorField","templates"])],Wt.prototype,"readTemplates",null),Object(n.a)([Object(w.b)({type:Pt.a})],Wt.prototype,"timeInfo",void 0),Object(n.a)([Object(w.b)()],Wt.prototype,"title",void 0),Object(n.a)([Object(S.a)("service","title",["name"]),Object(S.a)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Wt.prototype,"readTitle",null),Object(n.a)([Object(S.a)("web-map","title",["layerDefinition.name","title"])],Wt.prototype,"readTitleFromWebMap",null),Object(n.a)([Object(w.b)({type:String})],Wt.prototype,"sublayerTitleMode",void 0),Object(n.a)([Object(w.b)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Wt.prototype,"trackIdField",void 0),Object(n.a)([Object(w.b)({json:{read:!1}})],Wt.prototype,"type",void 0),Object(n.a)([Object(w.b)({type:String})],Wt.prototype,"typeIdField",void 0),Object(n.a)([Object(S.a)("service","typeIdField"),Object(S.a)("typeIdField",["layerDefinition.typeIdField"])],Wt.prototype,"readTypeIdField",null),Object(n.a)([Object(w.b)({type:[mt.a]})],Wt.prototype,"types",void 0),Object(n.a)([Object(S.a)("service","types",["types"]),Object(S.a)("types",["layerDefinition.types"])],Wt.prototype,"readTypes",null),Object(n.a)([Object(w.b)({readOnly:!0,json:{write:!1}})],Wt.prototype,"serverGens",void 0),Object(n.a)([Object(w.b)({type:h.a.ofType(ut),readOnly:!0})],Wt.prototype,"indexes",void 0),Object(n.a)([Object(w.b)(ct.n)],Wt.prototype,"url",null),Object(n.a)([Object(C.a)("url")],Wt.prototype,"writeUrl",null),Object(n.a)([Object(w.b)({readOnly:!0})],Wt.prototype,"userIsAdmin",void 0),Object(n.a)([Object(w.b)({json:{origins:{service:{read:!0}},read:!1}})],Wt.prototype,"version",void 0),Object(n.a)([Object(S.a)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Wt.prototype,"readVersion",null),Object(n.a)([Object(w.b)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Wt.prototype,"visible",void 0),Object(n.a)([Object(S.a)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Wt.prototype,"readVisible",null),Wt=Object(n.a)([Object(T.a)("esri.layers.FeatureLayer")],Wt);const $t=Object(M.b)({types:d.i});var Qt=Wt;t.default=Qt},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=r(1),s=(r(8),r(9),r(7),r(4));const a=e=>{let t=class extends e{constructor(){super(...arguments),this.refreshInterval=0}refresh(){this.emit("refresh")}};return Object(i.a)([Object(n.b)({type:Number,cast:e=>e>=.1?e:e<=0?0:.1,json:{write:!0,origins:{"web-document":{write:!0}}}})],t.prototype,"refreshInterval",void 0),t=Object(i.a)([Object(s.a)("esri.layers.mixins.RefreshableLayer")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return m}));var i=r(19),n=r(38),s=r(2),a=r(101);const o=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function l(e){return e instanceof i.a}function c(e){return e instanceof n.a?Object.keys(e.items):l(e)?Object(a.a)(e).keys():e?Object.keys(e):[]}function u(e,t){return e instanceof n.a?e.items[t]:e[t]}function d(e){return e?e.declaredClass:null}function h(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const i=c(e),n=c(t);if(0===i.length&&0===n.length)return;if(!i.length||!n.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const a=n.filter((e=>-1===i.indexOf(e))),p=i.filter((e=>-1===n.indexOf(e))),f=i.filter((r=>n.indexOf(r)>-1&&u(e,r)!==u(t,r))).concat(a,p).sort(),b=d(e);if(b&&o.indexOf(b)>-1&&f.length)return{type:"complete",oldValue:e,newValue:t};let m;const g=l(e)&&l(t);for(const o of f){const i=u(e,o),n=u(t,o);let a;(g||"function"!=typeof i&&"function"!=typeof n)&&i!==n&&(null==i&&null==n||(a=r&&r[o]&&"function"==typeof r[o]?r[o](i,n):"object"==typeof i&&"object"==typeof n&&d(i)===d(n)?h(i,n):{type:"complete",oldValue:i,newValue:n},Object(s.j)(a)&&(Object(s.j)(m)?m.diff[o]=a:m={type:"partial",diff:{[o]:a}})))}return m}function p(e,t){if(Object(s.i)(e))return!1;const r=t.split(".");let i=e;for(const n of r){if("complete"===i.type)return!0;if("partial"!==i.type)return!1;{const e=i.diff[n];if(!e)return!1;i=e}}return!0}function f(e,t){for(const r of t)if(p(e,r))return!0;return!1}function b(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&d(e)!==d(t)?{type:"complete",oldValue:e,newValue:t}:h(e,t)}function m(e){if(Object(s.i)(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!m(e))return!1;for(const e of t.removed)if(!m(e))return!1;for(const e of t.changed)if(!m(e))return!1;return!0}case"partial":for(const t in e.diff)if(!m(e.diff[t]))return!1;return!0}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(305),n=r(89),s=r(275),a=(r(170),r(419),r(252)),o=(r(291),r(250),r(276)),l=r(335);const c=["oid","global-id"],u=["oid","global-id","guid"];function d({displayField:e,editFieldsInfo:t,fields:r,objectIdField:o,title:l},c){if(!r)return null;const u=g({editFieldsInfo:t,fields:r,objectIdField:o},c);if(!u.length)return null;const d=function(e){const t=Object(n.l)(e),{titleBase:r}=e;return t?`${r}: {${t.trim()}}`:r}({titleBase:l,fields:r,displayField:e}),h=[new a.a,new s.a];return new i.a({title:d,content:h,fieldInfos:u})}const h=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],p=(e,{editFieldsInfo:t,objectIdField:r,visibleFieldNames:i})=>i?i.has(e.name):!b(e.name,t)&&(!r||e.name!==r)&&!(c.indexOf(e.type)>-1)&&!h.some((t=>t.test(e.name)));function f(e,t){return"oid"===e.type?-1:"oid"===t.type?1:v(e)?-1:v(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function b(e,t){if(!e||!t)return!1;const{creationDateField:r,creatorField:i,editDateField:n,editorField:s}=t;return-1!==[r&&r.toLowerCase(),i&&i.toLowerCase(),n&&n.toLowerCase(),s&&s.toLowerCase()].indexOf(e.toLowerCase())}function m(e,t){return e.editable&&-1===u.indexOf(e.type)&&!b(e.name,t)}function g({editFieldsInfo:e,fields:t,objectIdField:r},i){return function(e,t){const r=e;return t&&(e=e.filter((e=>-1===t.indexOf(e.type)))),e===r&&(e=e.slice()),e.sort(f),e}(t,(null==i?void 0:i.ignoreFieldTypes)||O).map((t=>new o.a({fieldName:t.name,isEditable:m(t,e),label:t.alias,format:y(t),visible:p(t,{editFieldsInfo:e,objectIdField:r,visibleFieldNames:null==i?void 0:i.visibleFieldNames})})))}function y(e){switch(e.type){case"small-integer":case"integer":case"single":return new l.a({digitSeparator:!0,places:0});case"double":return new l.a({digitSeparator:!0,places:2});case"date":return new l.a({dateFormat:"long-month-day-year"});default:return null}}function v(e){return"name"===(e.name&&e.name.toLowerCase())||("name"===(e.alias&&e.alias.toLowerCase())||void 0)}const O=["geometry","blob","raster","guid","xml"]},function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r(0),n=r(7),s=r(2),a=r(1),o=(r(8),r(9),r(4)),l=r(244);const c=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=Object(l.e)(this.url);if(Object(s.j)(e)&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",Object(l.g)(e,n.a.getLogger(this.declaredClass)))}};return Object(i.a)([Object(a.b)()],t.prototype,"title",null),Object(i.a)([Object(a.b)({type:String})],t.prototype,"url",null),t=Object(i.a)([Object(o.a)("esri.layers.mixins.ArcGISService")],t),t}},function(e,t,r){"use strict";var i=r(104);class n{constructor(e,t,r,i){this.set(e,t,r,i)}static getId(e,t,r,i){return"object"==typeof e?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${t}/${r}/${i}`}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}acquire(e,t,r,i){this.set(e,t,r,i)}contains(e){const t=e.level-this.level;return this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new n(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,r,i){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){const[t,r,i,n]=e.split("/");this.level=parseFloat(t),this.row=parseFloat(r),this.col=parseFloat(i),this.world=parseFloat(n)}else this.level=+e,this.row=+t,this.col=+r,this.world=+i||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new n(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,t=this.row<<1,r=this.col<<1,i=this.world;return[new n(e,t,r,i),new n(e,t,r+1,i),new n(e,t+1,r,i),new n(e,t+1,r+1,i)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}n.pool=new i.a(n,null,null,25,50),t.a=n},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(7),n=r(304),s=r(567),a=r(89);const o=i.a.getLogger("esri.layers.support.fieldProperties");function l(){return{fields:{type:[n.a],value:null},fieldsIndex:{readOnly:!0,get(){return new s.a(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||o.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return Object(a.i)(this.fieldsIndex,e)}}}}},function(e,t,r){"use strict";var i,n=r(0),s=(r(113),r(44)),a=r(14),o=r(13),l=r(1),c=(r(9),r(8),r(7),r(4)),u=r(50);const d=new s.a({upperLeft:"upper-left",lowerLeft:"lower-left"});let h=i=class extends a.a{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new i(Object(o.a)({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};Object(n.a)([Object(l.b)({type:u.a,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],h.prototype,"extent",void 0),Object(n.a)([Object(l.b)({type:["view","edit"],json:{write:!0}})],h.prototype,"mode",void 0),Object(n.a)([Object(l.b)({type:String,json:{read:d.read,write:d.write}})],h.prototype,"originPosition",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],h.prototype,"tolerance",void 0),h=i=Object(n.a)([Object(c.a)("esri.rest.support.QuantizationParameters")],h);var p=h;t.a=p},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=r(1),s=(r(8),r(9),r(7),r(4));const a=e=>{let t=class extends e{get apiKey(){var e;return this._isOverridden("apiKey")?this._get("apiKey"):function(e){return"portalItem"in e}(this)?null==(e=this.portalItem)?void 0:e.apiKey:null}set apiKey(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return Object(i.a)([Object(n.b)({type:String})],t.prototype,"apiKey",null),t=Object(i.a)([Object(s.a)("esri.layers.mixins.APIKeyMixin")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));r(8);var i=r(2);function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const i=e[r],n=t[r];if(i.length!==n.length)return!1;for(let e=0;e<i.length;e++)if(i[e]!==n[e])return!1}return!0}function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function a(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&s(e.paths,t.paths)}function o(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&s(e.rings,t.rings)}function l(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&n(e.points,t.points)}function c(e,t){return e===t||e&&t&&e.equals(t)}function u(e,t){if(e===t)return!0;if(Object(i.i)(e)||Object(i.i)(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return function(e,t){return!!c(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return a(e,t);case"polygon":return o(e,t);case"multipoint":return l(e,t);case"mesh":return!1;default:return}}function d(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!u(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const n of r)if(e[n]!==t[n])return!1;return!0}(e.attributes,t.attributes)}},function(e,t,r){"use strict";var i,n=r(0),s=r(44),a=r(14),o=r(2),l=r(1),c=(r(8),r(9),r(7),r(32)),u=r(4),d=r(29),h=r(89);let p=i=class extends a.a{async collectRequiredFields(e,t){return Object(h.a)(e,t,this.expression)}clone(){return new i({expression:this.expression,title:this.title})}};Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],p.prototype,"expression",void 0),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],p.prototype,"title",void 0),p=i=Object(n.a)([Object(u.a)("esri.layers.support.FeatureExpressionInfo")],p);var f,b=p,m=r(417);const g=Object(s.b)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),y=new s.a({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let v=f=class extends a.a{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,i){t[r]=e.write(null,i),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):Object(o.j)(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new f({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}};Object(n.a)([Object(l.b)({type:b,json:{write:!0}})],v.prototype,"featureExpressionInfo",void 0),Object(n.a)([Object(c.a)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],v.prototype,"readFeatureExpressionInfo",null),Object(n.a)([Object(d.a)("featureExpressionInfo",{featureExpressionInfo:{type:b},"featureExpression.value":{type:[0]}})],v.prototype,"writeFeatureExpressionInfo",null),Object(n.a)([Object(l.b)({type:g.apiValues,nonNullable:!0,json:{type:g.jsonValues,read:g.read,write:{writer:g.write,isRequired:!0}}})],v.prototype,"mode",null),Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],v.prototype,"offset",void 0),Object(n.a)([Object(l.b)({type:m.b,json:{type:String,read:y.read,write:y.write}})],v.prototype,"unit",null),v=f=Object(n.a)([Object(u.a)("esri.layers.support.ElevationInfo")],v);var O=v;t.a=O},function(e,t,r){"use strict";var i=r(12);class n{constructor(e,t,r,i,n){this.resolve=e,this.reject=t,this.callback=r,this.signal=i,this.abortCallback=n}}t.a=class{constructor(){this._tasks=new Array}get length(){return this._tasks.length}push(e,t,r){return new Promise(((i,s)=>this._tasks.push(new n(i,s,e,t,r))))}unshift(e,t,r){return new Promise(((i,s)=>this._tasks.unshift(new n(i,s,e,t,r))))}process(){if(0===this._tasks.length)return!1;const e=this._tasks.shift();try{const t=Object(i.o)(e.signal);if(t&&!e.abortCallback)e.reject(Object(i.f)());else{const r=t?e.abortCallback(Object(i.f)()):e.callback();Object(i.p)(r)?r.then(e.resolve,e.reject):e.resolve(r)}}catch(n){e.reject(n)}return!0}cancelAll(){const e=Object(i.f)();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0}}},function(e,t,r){"use strict";var i=r(0),n=r(19),s=r(25),a=r(1),o=(r(8),r(9),r(7),r(4));let l=class extends n.a{constructor(...e){super(...e),this.requestOptions=null,this.url=null}normalizeCtorArgs(e,t){return"string"!=typeof e?e:{url:e,...t}}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(e){return e?Object(s.K)(e):null}_encode(e,t,r){const i={};for(const n in e){if("declaredClass"===n)continue;const s=e[n];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){i[n]=[];for(let e=0;e<s.length;e++)i[n][e]=this._encode(s[e])}else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(r&&r[n]);i[n]=t?e:JSON.stringify(e)}else i[n]=t?s:JSON.stringify(s);else i[n]=s}return i}};Object(i.a)([Object(a.b)({readOnly:!0})],l.prototype,"parsedUrl",null),Object(i.a)([Object(a.b)()],l.prototype,"requestOptions",void 0),Object(i.a)([Object(a.b)({type:String})],l.prototype,"url",void 0),l=Object(i.a)([Object(o.a)("esri.tasks.Task")],l);var c=l;t.a=c},function(e,t,r){"use strict";var i=r(343);t.a=class{constructor(e,t){this._storage=new i.c,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t,r){this._storage.put(e,t,r,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=r(1),s=(r(8),r(9),r(7),r(4));const a=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return Object(i.a)([Object(n.b)({type:Object,json:{write:!0}})],t.prototype,"customParameters",void 0),t=Object(i.a)([Object(s.a)("esri.layers.mixins.CustomParametersMixin")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r(0),n=r(221),s=r(366),a=r(1),o=(r(8),r(9),r(7),r(32)),l=r(4),c=r(492),u=r(89),d=r(286);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const r=t.timeInfo.exportOptions;if(!r)return null;const i=r.timeOffset,n=d.a.fromJSON(r.timeOffsetUnits);return i&&n?new s.a({value:i,unit:n}):null}set timeInfo(e){Object(u.k)(e,this.fieldsIndex),this._set("timeInfo",e)}};return Object(i.a)([Object(a.b)({type:n.a,json:{write:!1}})],t.prototype,"timeExtent",void 0),Object(i.a)([Object(a.b)({type:s.a})],t.prototype,"timeOffset",void 0),Object(i.a)([Object(o.a)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),Object(i.a)([Object(a.b)({value:null,type:c.a,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),Object(i.a)([Object(a.b)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=Object(i.a)([Object(l.a)("esri.layers.mixins.TemporalLayer")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(102),n=r(12),s=r(181);async function a(e,t,r){const a=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(a&&"unique-value"===a.type&&a.styleOrigin){const o=await Object(i.d)(a.populateFromStyle());if(Object(n.x)(r),!1===o.ok){const r=o.error;t&&t.messages&&t.messages.push(new s.a("renderer:style-reference",`Failed to create unique value renderer from style reference: ${r.message}`,{error:r,context:t})),e.clear("renderer",t.origin)}}}},function(e,t,r){"use strict";function i(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function n(e,t,r,i){const n=t[i],s=t[i+1];e[i]=r[0]*n+r[2]*s+r[4],e[i+1]=r[1]*n+r[3]*s+r[5]}function s(e,t,r,i=0,s=0,a=2){const o=s||t.length/a;for(let l=i;l<o;l++)n(e,t,r,l*a)}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s}));Object.freeze({__proto__:null,create:i,clone:function(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},fromValues:function(e,t,r,i,n,s){const a=new Float32Array(6);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=n,a[5]=s,a},createView:function(e,t){return new Float32Array(e,t,6)},transform:n,transformMany:s})},function(e,t,r){"use strict";function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}r.d(t,"a",(function(){return i}))},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(1),o=(r(8),r(9)),l=(r(7),r(4));let c=i=class extends s.a{constructor(e){super(e),this.level=0,this.levelValue=null,this.resolution=0,this.scale=0}clone(){return new i({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})}};Object(n.a)([Object(a.b)({type:o.a,json:{write:!0}})],c.prototype,"level",void 0),Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0),Object(n.a)([Object(a.b)({type:Number,json:{write:!0}})],c.prototype,"scale",void 0),c=i=Object(n.a)([Object(l.a)("esri.layers.support.LOD")],c);var u=c;t.a=u},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(0),n=r(11),s=r(23),a=r(1),o=(r(8),r(9),r(7),r(4)),l=r(413),c=r(63);const u=e=>{let t=class extends e{get imageFormatIsOpaque(){return!1}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataLevelRange(){const e=this.tileInfo.lods,t=e[0].scale,r=e[e.length-1].scale;return this.levelRangeFromScaleRange(t,r)}get displayLevelRange(){const e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,r=this.layer.maxScale||e[e.length-1].scale,i=this.levelRangeFromScaleRange(t,r);return this.layer.maxScale&&i.maxLevel++,i}getTileUrl(e,t,r){return this.layer.getTileUrl(e,t,r)}_addTilingSchemeMatchPromise(){const e=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);if(e)this.addResolvingPromise(Promise.reject(e));else{const e=Object(s.l)(this.view,"basemapTerrain.tilingSchemeLocked").then((()=>{const e=this.view.basemapTerrain.tilingScheme,t=this._getTileInfoCompatibilityError(this.tileInfo,e);if(t)throw t}));this.addResolvingPromise(e)}}_getTileInfoSupportError(e,t){const r=Object(c.a)(e,t,this.view.spatialReference,this.view.state.viewingMode);if(r){const e={layer:this.layer,error:r};let t;switch(r.name){case"tilingscheme:local-gcs-not-supported":t=new n.a("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",e);break;case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":t=new n.a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",e);break;default:t=new n.a("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",e)}return t}return null}_getTileInfoCompatibilityError(e,t){return t.compatibleWith(e)?null:new n.a("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const r={minLevel:0,maxLevel:1/0},i=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!i)return r;const n=i.levels[0],s=e=>{const t=Math.log(n.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(r.minLevel=Math.max(0,s(e))),null!=t&&t>0&&(r.maxLevel=Math.max(0,s(t))),r}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"updating",void 0),Object(i.a)([Object(a.b)(l.a)],t.prototype,"updatingProgress",void 0),Object(i.a)([Object(a.b)(l.b)],t.prototype,"updatingProgressValue",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"fullExtent",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"isOpaque",null),Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"dataLevelRange",null),Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"displayLevelRange",null),Object(i.a)([Object(a.b)()],t.prototype,"layer",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],t.prototype,"tileInfo",void 0),t=Object(i.a)([Object(o.a)("esri.views.3d.layers.TiledLayerView3D")],t),t}},function(e,t,r){"use strict";var i=r(8),n=r(104);const s=4294967296,a=Object(i.a)("esri-text-decoder")?new TextDecoder("utf-8"):null,o=Object(i.a)("safari")||Object(i.a)("ios")?6:Object(i.a)("ff")?12:32;class l{constructor(e,t,r=0,i=(e?e.byteLength:0)){this._tag=0,this._dataType=99,this.init(e,t,r,i)}init(e,t,r,i){this._data=e,this._dataView=t,this._pos=r,this._end=i}clone(){return new l(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getUint32(t+4,!0)*s;return this._skip(8),r}getSFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getInt32(t+4,!0)*s;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}getBytes(){const e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,r,i){const n=this.getMessage(),s=e(n,t,r,i);return n.release(),s}processMessage(e){const t=this.getMessage(),r=e(t);return t.release(),r}getMessage(){const e=this._getLength(),t=l.pool.acquire();return t.init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){l.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t,r=this._pos,i=0;if(this._end-r>=10)do{if(t=e[r++],i|=127&t,0==(128&t))break;if(t=e[r++],i|=(127&t)<<7,0==(128&t))break;if(t=e[r++],i|=(127&t)<<14,0==(128&t))break;if(t=e[r++],i|=(127&t)<<21,0==(128&t))break;if(t=e[r++],i+=268435456*(127&t),0==(128&t))break;if(t=e[r++],i+=34359738368*(127&t),0==(128&t))break;if(t=e[r++],i+=4398046511104*(127&t),0==(128&t))break;if(t=e[r++],i+=562949953421312*(127&t),0==(128&t))break;if(t=e[r++],i+=72057594037927940*(127&t),0==(128&t))break;if(t=e[r++],i+=0x8000000000000000*(127&t),0==(128&t))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(t=e[r],0!=(128&t));)++r,i+=(127&t)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=t*n}return this._pos=r,i}_decodeSVarint(){const e=this._decodeVarint();return e%2?-(e+1)/2:e/2}_getLength(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,r){if((r=Math.min(this._end,r))-t>o&&a){const i=e.subarray(t,r);return a.decode(i)}let i="",n="";for(let s=t;s<r;++s){const t=e[s];128&t?n+="%"+t.toString(16):(i+=decodeURIComponent(n)+String.fromCharCode(t),n="")}return n.length&&(i+=decodeURIComponent(n)),i}_toBytes(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}l.pool=new n.a(l,null,(e=>{e._data=null,e._dataView=null})),t.a=l},function(e,t,r){"use strict";var i,n=r(0),s=r(35),a=r(14),o=r(1),l=(r(8),r(9)),c=(r(7),r(4)),u=r(29);let d=i=class extends a.a{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=null==e?0:e}clone(){return new i({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};Object(n.a)([Object(o.b)({type:s.a,json:{type:[l.a],write:!0}})],d.prototype,"color",void 0),Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],d.prototype,"label",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:{allowNull:!0}}})],d.prototype,"value",void 0),Object(n.a)([Object(u.a)("value")],d.prototype,"writeValue",null),d=i=Object(n.a)([Object(c.a)("esri.renderers.visualVariables.support.ColorStop")],d);var h=d;t.a=h},function(e,t,r){"use strict";var i=r(343);t.a=class{constructor(e,t){this._storage=new i.c,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t){this._storage.put(e,t,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}},function(e,t,r){"use strict";var i=r(11),n=r(7),s=r(280);const a=new Map;function o(e,t,r){const{transform:o,hasZ:l,hasM:c}=r;a.has(t)||a.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,n)=>Object(s.c)(r,t,e,i,n);case"esriGeometryPolygon":return(e,r,i,n)=>Object(s.d)(r,t,e,i,n);case"esriGeometryPolyline":return(e,r,i,n)=>Object(s.e)(r,t,e,i,n);case"esriGeometryMultipoint":return(e,r,i,n)=>Object(s.b)(r,t,e,i,n);default:return n.a.getLogger("esri.views.2d.support.arcadeOnDemand").error(new i.a("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const u=a.get(t)(e.geometry,o,l,c);return{...e,geometry:u}}t.a=function(e,t,r,i,s){const a=e.referencesGeometry()&&s?o(t,i,s):t,l=e.repurposeFeature(a);try{return e.evaluate({...r,$feature:l})}catch(c){return n.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",c),null}}},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(13),o=r(7),l=r(1),c=r(45),u=(r(8),r(4)),d=r(9),h=r(437),p=r(474),f=r(595);const b=o.a.getLogger("esri.geometry.support.MeshComponent");let m=i=class extends s.a{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return Object(d.d)(i,e)}castFaces(e){return Object(f.b)(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},b)}castMaterial(e){return Object(d.d)(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?p.a:h.a,e)}clone(){return new i({faces:Object(a.a)(this.faces),shading:this.shading,material:Object(a.a)(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const r={faces:Object(a.a)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new i(r)}};Object(n.a)([Object(l.b)({json:{write:!0}})],m.prototype,"faces",void 0),Object(n.a)([Object(c.a)("faces")],m.prototype,"castFaces",null),Object(n.a)([Object(l.b)({type:h.a,json:{write:!0}})],m.prototype,"material",void 0),Object(n.a)([Object(c.a)("material")],m.prototype,"castMaterial",null),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],m.prototype,"shading",void 0),Object(n.a)([Object(l.b)({type:Boolean})],m.prototype,"trustSourceNormals",void 0),m=i=Object(n.a)([Object(u.a)("esri.geometry.support.MeshComponent")],m);var g=m;t.a=g},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return f}));var i,n=r(0),s=r(14),a=r(13),o=r(7),l=r(1),c=r(45),u=(r(8),r(4));const d=o.a.getLogger("esri.geometry.support.MeshVertexAttributes");let h=i=class extends s.a{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return f(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},d)}castPosition(e){return e&&e instanceof Float32Array&&d.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),f(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},d)}castUv(e){return f(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},d)}castNormal(e){return f(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},d)}castTangent(e){return f(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},d)}clone(){const e={position:Object(a.a)(this.position),uv:Object(a.a)(this.uv),normal:Object(a.a)(this.normal),tangent:Object(a.a)(this.tangent),color:Object(a.a)(this.color)};return new i(e)}clonePositional(){const e={position:Object(a.a)(this.position),normal:Object(a.a)(this.normal),tangent:Object(a.a)(this.tangent),uv:this.uv,color:this.color};return new i(e)}};function p(e,t,r,i){const{loggerTag:n,stride:s}=t;return e.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):e}function f(e,t,r,i,n){if(!e)return e;if(e instanceof t)return p(e,i,t,n);for(const s of r)if(e instanceof s)return p(new t(e),i,t,n);if(Array.isArray(e))return p(new t(e),i,t,n);{const i=r.map((e=>`'${e.name}'`));return n.error(`Failed to set property, expected one of ${i}, but got ${e.constructor.name}`),new t([])}}function b(e,t,r){t[r]=function(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}(e)}Object(n.a)([Object(l.b)({json:{write:b}})],h.prototype,"color",void 0),Object(n.a)([Object(c.a)("color")],h.prototype,"castColor",null),Object(n.a)([Object(l.b)({nonNullable:!0,json:{write:b}})],h.prototype,"position",void 0),Object(n.a)([Object(c.a)("position")],h.prototype,"castPosition",null),Object(n.a)([Object(l.b)({json:{write:b}})],h.prototype,"uv",void 0),Object(n.a)([Object(c.a)("uv")],h.prototype,"castUv",null),Object(n.a)([Object(l.b)({json:{write:b}})],h.prototype,"normal",void 0),Object(n.a)([Object(c.a)("normal")],h.prototype,"castNormal",null),Object(n.a)([Object(l.b)({json:{write:b}})],h.prototype,"tangent",void 0),Object(n.a)([Object(c.a)("tangent")],h.prototype,"castTangent",null),h=i=Object(n.a)([Object(u.a)("esri.geometry.support.MeshVertexAttributes")],h);var m=h;t.c=m},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return o}));r(2);var i=r(648);function n(e,t,r,i,n,s){const a=r-n;if(a>=0)return(t>>a)+(i-(s<<a))*(e>>a);const o=-a;return t-(s-(i<<o))*(e>>o)<<o}class s{constructor(e,t,r){this._rows=Math.ceil(t/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let i=0;i<this._rows;i++){this.cells[i]=new Array(this._columns);for(let e=0;e<this._columns;e++)this.cells[i][e]=[]}}getCell(e,t){const r=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][i]||null}getCellSpan(e,t,r,i){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function a(e,t,r,n,s,a){const o=t[n++];for(let l=0;l<o;l++){const o=new i.a(a);o.xTile=t[n++],o.yTile=t[n++],o.hash=t[n++],o.priority=t[n++];const l=t[n++];for(let e=0;e<l;e++){const e=t[n++],i=t[n++],s=t[n++],a=t[n++],l=!!t[n++],c=t[n++],u=r[n++],d=r[n++],h=t[n++],p=t[n++];o.colliders.push({xTile:e,yTile:i,dxPixels:s,dyPixels:a,hard:l,partIndex:c,width:h,height:p,minLod:u,maxLod:d})}const c=e[n++];for(let t=0;t<c;t++)o.textVertexRanges.push([e[n++],e[n++]]);const u=e[n++];for(let t=0;t<u;t++)o.iconVertexRanges.push([e[n++],e[n++]]);s.push(o)}return n}function o(e,t,r){for(const[i,n]of e.symbols)l(e,t,r,n,i)}function l(e,t,r,i,n){const s=e.layerData.get(n);if(3===s.type){for(const t of i){const i=t.unique;let n;if(t.selectedForRendering){const t=i.parts[0],s=t.startOpacity,a=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===a;const o=r?Math.floor(127*s)|a<<7:a?255:0;n=o<<24|o<<16|o<<8|o}else n=0;for(const[e,r]of t.iconVertexRanges)for(let t=e;t<e+r;t+=4)s.iconOpacity[t/4]=n;if(t.selectedForRendering){const t=i.parts[1],s=t.startOpacity,a=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===a;const o=r?Math.floor(127*s)|a<<7:a?255:0;n=o<<24|o<<16|o<<8|o}else n=0;for(const[e,r]of t.textVertexRanges)for(let t=e;t<e+r;t+=4)s.textOpacity[t/4]=n}s.lastOpacityUpdate=t,s.opacityChanged=!0}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(94);function n(e){const t=Object(i.a)().vec3f("position");return e.normals&&t.vec2i16("normalCompressed",{glNormalized:!0}),1===e.textureCoordinates?t.vec2f("uv0"):2===e.textureCoordinates&&(t.vec2f("uv0"),t.vec4u16("uvRegion",{glNormalized:!0})),e.colors&&t.vec4u8("color",{glNormalized:!0}),t.alignTo(4)}},function(e,t,r){"use strict";var i=r(0),n=r(11),s=r(8),a=r(2),o=r(12),l=r(1),c=(r(9),r(7),r(4)),u=r(294),d=r(133),h=r(555),p=r(360);var f=r(261),b=r(138);r(113);var m=r(50);var g=r(204);async function y(e,t,r){const i=Object(d.c)(e),n={...r},s=b.a.from(t),{data:a}=await Object(f.executeQuery)(i,s,s.sourceSpatialReference,n);return a}var v=r(120),O=r(409),j=r(373);function _(e,t){return t}function w(e,t,r,i){switch(r){case 0:return C(e,t+i,0);case 1:return"lowerLeft"===e.originPosition?C(e,t+i,1):function({translate:e,scale:t},r,i){return e[i]-r*t[i]}(e,t+i,1)}}function x(e,t,r,i){switch(r){case 2:return C(e,t,2);default:return w(e,t,r,i)}}function S(e,t,r,i){switch(r){case 2:return C(e,t,3);default:return w(e,t,r,i)}}function T(e,t,r,i){switch(r){case 3:return C(e,t,3);default:return x(e,t,r,i)}}function C({translate:e,scale:t},r,i){return e[i]+r*t[i]}class M{constructor(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=_,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,!e.hasZ)return;const t=Object(j.a)(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(const r of e.features)t(r.geometry)}createSpatialReference(){return{}}addField(e,t){e.fields.push(t);const r=e.fields.map((e=>e.name));this.AttributesConstructor=function(){for(const e of r)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,r)=>this.addCoordinatePolygon(e,t,r),this.createGeometry=e=>this.createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,r)=>this.addCoordinatePolyline(e,t,r),this.createGeometry=e=>this.createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,r)=>this.addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this.createMultipointGeometry(e);break;default:Object(v.a)(e.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this.AttributesConstructor}}allocateCoordinates(){}addLength(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:r,queryGeometryType:i}=t,n=Object(O.w)(r.clone(),r,!1,!1,this.transform),s=Object(O.h)(n,i,!1,!1);e.queryGeometryType=i,e.queryGeometry={...s}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}transformPathLikeValue(e,t){let r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)}addCoordinatePolyline(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)}addCoordinatePolygon(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)}addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);const i=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(i)}createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}dehydratedAddPointsCoordinate(e,t,r){0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const i=this.transformPathLikeValue(t,r),n=e[e.length-1];0===r&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),n.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=i}deriveApplyTransform(e){const{hasZ:t,hasM:r}=e;return t&&r?T:t?x:r?S:w}}async function P(e,t,r){const i=Object(d.c)(e),n={...r},s=b.a.from(t),a=!s.quantizationParameters,{data:o}=await Object(f.executeQueryPBF)(i,s,new M({sourceSpatialReference:s.sourceSpatialReference,applyTransform:a}),n);return o}var A=r(84),E=r(325);function R(e,t){const r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),!r.outFields||null!=t&&t.returnCountOnly?delete r.outFields:-1!==r.outFields.indexOf("*")?r.outFields="*":r.outFields=r.outFields.join(","),r.outSpatialReference&&(r.outSR=r.outSR.wkid||JSON.stringify(r.outSR.toJSON()),delete r.outSpatialReference),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}async function I(e,t,r={},i){const n=Object(E.a)({...e.query,f:"json",...i,...R(t,i)});return Object(A.default)(e.path+"/queryRelatedRecords",{...r,query:{...r.query,...n}})}var D=r(254);async function F(e,t,r){t=D.a.from(t);return async function(e,t,r){const i=await I(e,t,r),n=i.data,s=n.geometryType,a=n.spatialReference,o={};for(const l of n.relatedRecordGroups){const e={fields:void 0,objectIdFieldName:void 0,geometryType:s,spatialReference:a,hasZ:!!n.hasZ,hasM:!!n.hasM,features:l.relatedRecords};if(null!=l.objectId)o[l.objectId]=e;else for(const t in l)l.hasOwnProperty(t)&&"relatedRecords"!==t&&(o[l[t]]=e)}return{...i,data:o}}(Object(d.c)(e),t,r).then((e=>{const t=e.data,r={};return Object.keys(t).forEach((e=>r[e]=g.default.fromJSON(t[e]))),r}))}async function L(e,t,r){t=D.a.from(t);return async function(e,t,r){const i=await I(e,t,r,{returnCountOnly:!0}),n=i.data,s={};for(const a of n.relatedRecordGroups)null!=a.objectId&&(s[a.objectId]=a.count);return{...i,data:s}}(Object(d.c)(e),t,{...r}).then((e=>e.data))}var k=r(25),z=r(85),V=r(446),N=r(361);const U="Layer does not support extent calculation.";function B(e,t){var r,i;const n=e.geometry,s=e.toJSON(),o=s;if(Object(a.j)(n)&&(o.geometry=JSON.stringify(n),o.geometryType=Object(z.c)(n),o.inSR=n.spatialReference.wkid||JSON.stringify(n.spatialReference)),null!=(r=s.topFilter)&&r.groupByFields&&(o.topFilter.groupByFields=s.topFilter.groupByFields.join(",")),null!=(i=s.topFilter)&&i.orderByFields&&(o.topFilter.orderByFields=s.topFilter.orderByFields.join(",")),s.topFilter&&(o.topFilter=JSON.stringify(o.topFilter)),s.objectIds&&(o.objectIds=s.objectIds.join(",")),s.orderByFields&&(o.orderByFields=s.orderByFields.join(",")),s.outFields&&!(null!=t&&t.returnCountOnly||null!=t&&t.returnExtentOnly||null!=t&&t.returnIdsOnly)?-1!==s.outFields.indexOf("*")?o.outFields="*":o.outFields=s.outFields.join(","):delete o.outFields,s.outSR?o.outSR=s.outSR.wkid||JSON.stringify(s.outSR):n&&s.returnGeometry&&(o.outSR=o.inSR),s.returnGeometry&&delete s.returnGeometry,s.timeExtent){const e=s.timeExtent,{start:t,end:r}=e;null==t&&null==r||(o.time=t===r?t:`${null==t?"null":t},${null==r?"null":r}`),delete s.timeExtent}return o}function G(e,t,r,i={},n={}){const s="string"==typeof e?Object(k.K)(e):e,o=t.geometry?[t.geometry]:[];return i.responseType="pbf"===r?"array-buffer":"json",Object(V.a)(o,null,i).then((e=>{const o=e&&e[0];Object(a.j)(o)&&((t=t.clone()).geometry=o);const l=Object(E.a)({...s.query,f:r,...n,...B(t,n)});return Object(A.default)(Object(k.z)(s.path,"queryTopFeatures"),{...i,query:{...l,...i.query}})}))}var q=r(227);async function H(e,t,r,i){const n=Object(d.c)(e),s={...i},{data:a}=await async function(e,t,r,i){const n=await G(e,t,"json",i);return Object(N.a)(t,r,n.data),n}(n,q.a.from(t),r,s);return g.default.fromJSON(a)}async function W(e,t,r){const i=Object(d.c)(e);return(await async function(e,t,r){return Object(a.j)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):G(e,t,"json",r,{returnIdsOnly:!0})}(i,q.a.from(t),{...r})).data.objectIds}async function $(e,t,r){const i=Object(d.c)(e),n=await async function(e,t,r){return Object(a.j)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):G(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((e=>{const t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(U);if(t.hasOwnProperty("count"))throw new Error(U);return e}))}(i,q.a.from(t),{...r});return{count:n.data.count,extent:m.a.fromJSON(n.data.extent)}}async function Q(e,t,r){const i=Object(d.c)(e);return(await(n=i,s=q.a.from(t),o={...r},Object(a.j)(s.timeExtent)&&s.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):G(n,s,"json",o,{returnIdsOnly:!0,returnCountOnly:!0}))).data.count;var n,s,o}var Z=r(581);let X=class extends Z.a{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.format="json",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}execute(e,t){return this.executeJSON(e,t).then((r=>this.featureSetFromJSON(e,r,t)))}async executeJSON(e,t){var r;const i={...this.requestOptions,...t},n=this._normalizeQuery(e),a=null!=(null==(r=e.outStatistics)?void 0:r[0]),o=Object(s.a)("featurelayer-pbf-statistics"),l=!a||o;let c;if("pbf"===this.format&&l)try{c=await P(this.url,n,i)}catch(u){if("query:parsing-pbf"!==u.name)throw u;this.format="json"}return"json"!==this.format&&l||(c=await y(this.url,n,i)),this._normalizeFields(c.fields),c}async featureSetFromJSON(e,t,i){if(!(this._queryIs3DObjectFormat(e)&&Object(a.j)(this.infoFor3D)&&t.features&&t.features.length))return g.default.fromJSON(t);const{meshFeatureSetFromJSON:n}=await Object(o.A)(r.e(75).then(r.bind(null,1161)),i);return n(e,this.infoFor3D,t)}executeForCount(e,t){const r={...this.requestOptions,...t},i=this._normalizeQuery(e);return async function(e,t,r){const i=Object(d.c)(e);return Object(f.executeQueryForCount)(i,b.a.from(t),{...r}).then((e=>e.data.count))}(this.url,i,r)}executeForExtent(e,t){const r={...this.requestOptions,...t},i=this._normalizeQuery(e);return async function(e,t,r){const i=Object(d.c)(e);return Object(f.executeQueryForExtent)(i,b.a.from(t),{...r}).then((e=>({count:e.data.count,extent:m.a.fromJSON(e.data.extent)})))}(this.url,i,r)}executeForIds(e,t){const r={...this.requestOptions,...t},i=this._normalizeQuery(e);return async function(e,t,r){const i=Object(d.c)(e);return Object(f.executeQueryForIds)(i,b.a.from(t),{...r}).then((e=>e.data.objectIds))}(this.url,i,r)}executeRelationshipQuery(e,t){e=D.a.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),F(this.url,e,r)}executeRelationshipQueryForCount(e,t){e=D.a.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),L(this.url,e,r)}executeAttachmentQuery(e,t){const r={...this.requestOptions,...t};return async function(e,t,r){const i=Object(d.c)(e);return Object(h.a)(i,p.a.from(t),{...r}).then((e=>Object(h.b)(e.data.attachmentGroups,i.path)))}(this.url,e,r)}executeTopFeaturesQuery(e,t){const r={...this.requestOptions,...t};return H(this.parsedUrl,e,this.sourceSpatialReference,r)}executeForTopIds(e,t){const r={...this.requestOptions,...t};return W(this.parsedUrl,e,r)}executeForTopExtents(e,t){const r={...this.requestOptions,...t};return $(this.parsedUrl,e,r)}executeForTopCount(e,t){const r={...this.requestOptions,...t};return Q(this.parsedUrl,e,r)}_normalizeQuery(e){let t=b.a.from(e);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?u.a.from(e.dynamicDataSource):this.dynamicDataSource),Object(a.j)(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){t=t===e?t.clone():t,t.formatOf3DObjects=null;for(const e of this.infoFor3D.queryFormats){if("3D_glb"===e.id){t.formatOf3DObjects=e.id;break}"3D_gltf"!==e.id||t.formatOf3DObjects||(t.formatOf3DObjects=e.id)}if(!t.formatOf3DObjects)throw new n.a("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(Object(a.i)(t.outFields)||!t.outFields.includes("*")){t=t===e?t.clone():t,Object(a.i)(t.outFields)&&(t.outFields=[]);const{originX:r,originY:i,originZ:n,translationX:s,translationY:o,translationZ:l,scaleX:c,scaleY:u,scaleZ:d,rotationX:h,rotationY:p,rotationZ:f,rotationDeg:b}=this.infoFor3D.transformFieldRoles;t.outFields.push(r,i,n,s,o,l,c,u,d,h,p,f,b)}}return t}_normalizeFields(e){if(Object(a.j)(this.fieldsIndex)&&Object(a.j)(e))for(const t of e){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(e){return Object(a.j)(this.infoFor3D)&&e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}};Object(i.a)([Object(l.b)({type:u.a})],X.prototype,"dynamicDataSource",void 0),Object(i.a)([Object(l.b)()],X.prototype,"fieldsIndex",void 0),Object(i.a)([Object(l.b)()],X.prototype,"format",void 0),Object(i.a)([Object(l.b)()],X.prototype,"gdbVersion",void 0),Object(i.a)([Object(l.b)()],X.prototype,"infoFor3D",void 0),Object(i.a)([Object(l.b)()],X.prototype,"sourceSpatialReference",void 0),X=Object(i.a)([Object(c.a)("esri.tasks.QueryTask")],X);var J=X;t.a=J},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c}));var i=r(54),n=r(43),s=r(288),a=r(466),o=r(205);const l=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class c{constructor(e){this.options=e,this.geometryTypes=l,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new a.a}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e||!e.features||!e.hasZ||!this.options.sourceSpatialReference||!e.spatialReference||Object(n.c)(e.spatialReference,this.options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=Object(i.g)(this.options.sourceSpatialReference)/Object(i.g)(e.spatialReference);if(1!==t)for(const r of e.features){if(!r.geometry||!r.geometry.coords)continue;const e=r.geometry.coords;for(let r=2;r<e.length;r+=3)e[r]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new s.a}createSpatialReference(){return{wkid:0}}createGeometry(){return new o.a}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new o.a}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var i=r(86),n=r(11),s=r(215),a=r(207),o=r(152),l=r(293),c=r(249),u=r(309),d=r(211),h=r(245),p=r(247),f=r(292);function b(e,t=!1,r=!1,b=!0){if(!e)return{symbol:null};let m;if(Object(i.c)(e)||e instanceof s.a)m=e.clone();else if("cim"===e.type)m=a.a.fromCIMSymbol(e);else if(e instanceof o.a)m=l.a.fromSimpleLineSymbol(e);else if(e instanceof c.a)m=a.a.fromSimpleMarkerSymbol(e);else if(e instanceof u.a)m=a.a.fromPictureMarkerSymbol(e);else if(e instanceof d.a)m=h.a.fromSimpleFillSymbol(e);else{if(!(e instanceof p.a))return{error:new n.a("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};m=b?f.a.fromTextSymbol(e):a.a.fromTextSymbol(e)}if(t&&(m.id=e.id),r&&Object(i.c)(m))for(let i=0;i<m.symbolLayers.length;++i)m.symbolLayers.getItemAt(i)._ignoreDrivers=!0;return{symbol:m}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return p}));r(8),r(2);var i=r(211),n=r(152),s=r(249),a=r(247),o=r(307);const l=s.a.fromJSON(o.c),c=n.a.fromJSON(o.e),u=i.a.fromJSON(o.d),d=a.a.fromJSON(o.f);const h=s.a.fromJSON(o.g),p=n.a.fromJSON(o.i),f=i.a.fromJSON(o.h)},function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return b}));var i=r(79),n=r(35),s=r(84),a=r(592),o=r(17),l=r(603);const c="picture-fill",u="simple-fill",d="simple-marker",h=new a.a(1e3);function p(e){const t=e.style;let r=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(r=e.color);break;case u:"solid"===t?r=e.color:"none"!==t&&(r={type:"pattern",x:0,y:0,src:Object(i.b)(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case c:r={type:"pattern",src:e.url,width:Object(o.g)(e.width)*e.xscale,height:Object(o.g)(e.height)*e.yscale,x:Object(o.g)(e.xoffset),y:Object(o.g)(e.yoffset)};break;case"text":r=e.color;break;case"cim":r=Object(l.a)(e)}return r}function f(e,t){const r=e+"-"+t;return void 0!==h.get(r)?Promise.resolve(h.get(r)):Object(s.default)(e,{responseType:"image"}).then((e=>{const i=e.data,n=i.naturalWidth,s=i.naturalHeight,a=document.createElement("canvas");a.width=n,a.height=s;const o=a.getContext("2d");o.fillStyle=t,o.fillRect(0,0,n,s),o.globalCompositeOperation="destination-in",o.drawImage(i,0,0);const l=a.toDataURL();return h.put(r,l),l}))}function b(e){if(!e)return null;let t;switch(e.type){case u:case c:case d:t=b(e.outline);break;case"simple-line":{const r=Object(o.g)(e.width);"none"!==e.style&&0!==r&&(t={color:e.color,style:m(e.style),width:r,cap:e.cap,join:"miter"===e.join?Object(o.g)(e.miterLimit):e.join});break}default:t=null}return t}const m=function(){const e={};return function(t){if(e[t])return e[t];const r=t.replace(/-/g,"");return e[t]=r,r}}(),g=new n.a([128,128,128])},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return a}));var i=r(35),n=r(164);function s(e){const t=Object(n.k)(e);if("CIMTextSymbol"===t.type)return t.height;let r=0;if(t.symbolLayers)for(const i of t.symbolLayers)Object(n.g)(i)&&i.size>r?r=i.size:Object(n.i)(i)&&i.width>r?r=i.width:Object(n.f)(i);return r}function a(e,t,r){const i=Object(n.k)(e),a=s(e);0!==a?o(i,t/a,!1,r):function(e,t){if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const r of e.symbolLayers)switch(r.type){case"CIMPictureMarker":case"CIMVectorMarker":r.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":r.width=t}}else e.height=t}(i,t)}function o(e,t,r,i){if("CIMTextSymbol"!==e.type){if(r&&e.effects)for(const r of e.effects)c(r,t);if(e.symbolLayers)for(const r of e.symbolLayers)switch(r.type){case"CIMPictureMarker":case"CIMVectorMarker":l(r,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":null!=i&&i.preserveOutlineWidth||(r.width*=t);break;case"CIMPictureFill":r.height*=t,r.offsetX*=t,r.offsetY*=t;break;case"CIMHatchFill":o(r.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),r.offsetX*=t,r.offsetY*=t,r.separation*=t}}else e.height*=t}function l(e,t,r){if(e.markerPlacement&&function(e,t){switch(Object(n.h)(e)&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map((e=>e*t));e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset*=t,e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map((e=>e*t));e.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":e.startPointOffset*=t;break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine*=t;break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition*=t,e.endPosition*=t;break;case"CIMMarkerPlacementPolygonCenter":e.offsetX*=t,e.offsetY*=t;break;case"CIMMarkerPlacementInsidePolygon":e.offsetX*=t,e.offsetY*=t,e.stepX*=t,e.stepY*=t}}(e.markerPlacement,t),e.offsetX*=t,e.offsetY*=t,e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,"CIMVectorMarker"===e.type&&e.markerGraphics)for(const i of e.markerGraphics)e.scaleSymbolsProportionally||o(i.symbol,t,!0,r)}function c(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width*=t;break;case"CIMGeometricEffectBuffer":e.size*=t;break;case"CIMGeometricEffectCut":e.beginCut*=t,e.endCut*=t,e.middleCut*=t;break;case"CIMGeometricEffectDashes":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.dashTemplate&&e.dashTemplate.length){const r=e.dashTemplate.map((e=>e*t));e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length*=t;break;case"CIMGeometricEffectMove":e.offsetX*=t,e.offsetY*=t;break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset*=t;break;case"CIMGeometricEffectRegularPolygon":e.radius*=t;break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth*=t,e.length*=t,e.toWidth*=t;break;case"CIMGeometricEffectWave":e.amplitude*=t,e.period*=t}}function u(e){const t=[];return d(Object(n.k)(e),t),t.length?new i.a(Object(n.e)(t[0])):null}function d(e,t){let r;r="CIMTextSymbol"===e.type?e.symbol:e;const i="CIMPolygonSymbol"===e.type;if(r.symbolLayers)for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(Object(n.i)(s)||Object(n.g)(s)&&s.markerPlacement&&Object(n.h)(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":break;case"CIMVectorMarker":s.markerGraphics.forEach((e=>{d(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":h(t,s.color);break;case"CIMHatchFill":d(s.lineSymbol,t)}}function h(e,t){for(const r of e)if(r.join(".")===t.join("."))return;e.push(t)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var i=r(117),n=r(6),s=r(73);function a(e){const t=new s.a;if(2===e.geometry)t.attributes.add("position","vec2"),t.varyings.add("color","vec4"),t.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),t.vertex.code.add(n.a`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),t.fragment.code.add(n.a`void main() {
gl_FragColor = color;
}`);else{t.include(i.a,{linearDepth:!1}),t.attributes.add("position","vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const r=1===e.geometry;t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),r||(t.varyings.add("innerFactor","float"),t.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"));const s=6.2831853,a=1/128;t.vertex.code.add(n.a`
		void main(void) {
      ${r?n.a`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:n.a`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${n.a.float(s*a)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${n.a.float(a)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),t.fragment.uniforms.add("tex","sampler2D"),r||t.fragment.uniforms.add("altitudeFade","float"),t.fragment.code.add(n.a`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${r?n.a`gl_FragColor = atmosphereColor;`:n.a`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}var o=Object.freeze({__proto__:null,build:a})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var i=r(167),n=r(6),s=r(73);function a(e){const t=new s.a;return t.attributes.add("position","vec2"),t.attributes.add("uv0","vec2"),t.varyings.add("worldRay","vec3"),t.varyings.add("vtc","vec2"),e.haze&&t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add("projectionInverse","mat4"),t.vertex.uniforms.add("viewInverse","mat4"),t.vertex.code.add(n.a`
    void main(void) {
      vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;

      worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;
      vtc = uv0;

      ${e.haze?n.a`eyeDir = posViewNear;`:""}

      gl_Position = vec4(position, 1, 1);
    }
  `),t.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength","vec3").add("invWavelengthScaled","vec3").add("radii","vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4"),e.haze?t.fragment.uniforms.add("depthTex","sampler2D"):t.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance","float").add("altitudeFade","float"),t.fragment.include(i.a),t.fragment.code.add(n.a`const float krESun = 0.075;
const float kmESun = 0.015;
#define innerRadius radii[0]
#define outerRadius radii[1]
#define shellScale atmosphereParameters1.x
#define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)
#define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)
#define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)`),e.haze||t.fragment.code.add(n.a`#define g atmosphereParameters2.x
#define gSq atmosphereParameters3.x
#define miePhaseCoefficients atmosphereParameters3.y
#define lowerAlphaBlendBound atmosphereParameters3.z`),t.fragment.code.add(n.a`
  // The camera's current height
  #define cameraHeight heightParameters[0]
  // cameraHeight^2
  #define cameraHeightSq heightParameters[1]
  // cameraHeightSq - outerRadiusSq; // C = ||o-c||^2 - r^2
  #define C heightParameters[2]
  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C = ||o-c||^2 - r^2
  #define CSur heightParameters[3]

  ${e.haze?"// Camera HDR\n        const float exposure = 1.5;\n        const vec3 oneOverGamma = vec3(1.0); //Gamma = 1.0":"const float exposure = 2.0;\n        const vec3 oneOverGamma = vec3(0.454545); // Gamma = 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate = inputColor * _exposure;\n          intermediate /= ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        "}
    // Loop constants for integral approximation
    const float samples = 5.0;
    const int maxSamples = 5;

    // ToneMapping operators
    vec3 expTM(vec3 inputColor,float _exposure) {
        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);
    }

    // Approximation for inner integral based on a radii ratio of 10.25:10
    float scale(float _cos) {
      float x = 1.0 - _cos;
      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));
    }

    void main() {
      // Obtain ray from Camera
      vec3 worldSpaceRay = normalize(worldRay);

      // Compute Atmosphere intersection; i.e. ray/sphere intersection
      float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))
      float det = B * B - 4.0 * C; // det = B^2 - 4.0* C

      // idealized sphere intersection to discard early some pixels
      float detSur = B * B - 4.0 * CSur; // det = B^2 - 4.0* C

      // the minimal sample start position:
      // at the camera by default, on the earth radius surface if the camera is underground.
      float minRayStart = 0.0;
  `),e.haze||t.fragment.code.add(n.a`float surfaceBlend = 0.0;
vec4 surfaceColor = vec4(0.0);
if (detSur >= 0.0) {
float nearSurface = max(0.0, 0.5 *(-B - sqrt(detSur)));
float farSurface = max(0.0, 0.5 *(-B + sqrt(detSur)));
if (nearSurface == 0.0) {
minRayStart = farSurface;
}
vec3 vPos = cameraPosition + worldSpaceRay * nearSurface;
float lightAngle = dot(lightingMainDirection, normalize(vPos));
float brightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));
surfaceColor = vec4(brightness, brightness, brightness, 1.0 - altitudeFade);
float relDist = (farSurface - nearSurface) / innerFadeDistance;
if (relDist > 1.0) {
gl_FragColor = surfaceColor;
return;
}
surfaceBlend = smoothstep(0.0, 1.0, relDist * relDist);
}`),t.fragment.code.add(n.a`
    if (det >= 0.0) {
    ${e.haze?"\n          float depthSample = texture2D(depthTex, vtc).r;\n\n          float zNear = nearFar[0];\n          float zFar = nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm = 2.0 * depthSample - 1.0;\n          float linDepth = 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha = 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample < 1.0 && depthSample > 0.0) {\n            vec3 cameraSpaceRay = normalize(eyeDir);\n            cameraSpaceRay /= cameraSpaceRay.z;\n            cameraSpaceRay *= linDepth;\n\n            float cameraSpaceRayLength = length(cameraSpaceRay);\n\n            vec3 world = cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq = dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart = innerRadius + 20000.0;\n            float transitionHeight = 25000.0;\n            float transitionEnd = transitionStart + transitionHeight;\n\n            float edge0 = transitionStart * transitionStart;\n            float edge1 = transitionEnd * transitionEnd;\n\n            altitudeAlpha = 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd = cameraSpaceRayLength;\n\n            if (altitudeAlpha > 0.0 && detSur > 0.0) {\n              float nearSurface = 0.5 * ( -B - sqrt(detSur) );\n              float interp = clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd = mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":""}
    float rayStart = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere
    ${e.haze?"float near = abs(rayStart);\n        float far = abs(rayEnd);":"float rayEnd = 0.5 *(-B + sqrt(det)); //far intersection with atmosphere"}

    float scatterDistance; // calculate its scattering offset
    // Calculate the ray's starting position
    if (rayStart < minRayStart)
    { // ray starts from camera or inner radius sphere to far
      rayStart = minRayStart;
      ${e.haze?"":"// clamp to value at inner radius altitude\n          scatterDistance = shellScale * min(0.0, innerRadius - cameraHeight);"}
    }
    ${e.haze?"":"else { // outside atmosphere\n          scatterDistance = -1.0;\n        }"}
    // Initialize the scattering loop variables
    vec3 start = cameraPosition + worldSpaceRay * rayStart;
  `),e.haze&&t.fragment.code.add(n.a`vec3 end = cameraPosition + worldSpaceRay * rayEnd;
float endLength = length(end);
vec2 altitudeInterval = vec2(length(start) - innerRadius, endLength - innerRadius);
if (altitudeInterval.x < 0.0) {
altitudeInterval = -altitudeInterval;
}
float lightAngle = dot(lightingMainDirection, end) / endLength;
if (near > far)
{
if (altitudeInterval.x < altitudeInterval.y)
{
end = cameraPosition + worldSpaceRay * rayStart;
start = cameraPosition + worldSpaceRay * rayEnd;
worldSpaceRay *= -1.0;
float tmp = altitudeInterval.x;
altitudeInterval.x = altitudeInterval.y;
altitudeInterval.y = tmp;
}
else if (altitudeInterval.x == altitudeInterval.y)
{
altitudeInterval.x += 1.0;
}
}
if (altitudeInterval.x > outerRadius - innerRadius)
{
scatterDistance = innerRadius - outerRadius;
} else
{
scatterDistance = altitudeInterval.y - altitudeInterval.x;
}`),t.fragment.code.add(n.a`vec2 opticalStartDepth = exp(scatterDistance * oneOverScaleDepth);
float rayLength = rayEnd - rayStart;
float sampleLength = rayLength / samples;
float scaledLength = sampleLength * shellScale;
vec3 sampleRay = worldSpaceRay * sampleLength;
vec3 samplePoint = start + sampleRay * 0.5;`),e.haze?t.fragment.code.add(n.a`float cameraAngle = dot(-worldSpaceRay, end) / length(end);
float scaleCameraAngle = scale(cameraAngle);
vec2 cameraOffset = scaleCameraAngle * opticalStartDepth;
float scaledValues = scale(lightAngle) + scaleCameraAngle;
vec2 scaledValuesDepth = scaledValues * shellDepth;`):t.fragment.code.add(n.a`float cameraAngle = dot(worldSpaceRay, start / length(start));
float angleMultiplier = cameraAngle > 0.0 ? cameraAngle : 0.0;
float scaleCameraAngle = scale(cameraAngle);
vec2 cameraOffset = scaleCameraAngle * opticalStartDepth * shellDepth;`),t.fragment.code.add(n.a`vec3 frontColor = vec3(0.0);
vec3 frontColorBlue = vec3(0.0);
vec3 attenuate = vec3(0.0);
vec3 attenuateBlue = vec3(0.0);
for(int i=0; i<maxSamples; i++) {
float height = length(samplePoint);
float altitude = abs(height - innerRadius);
vec2 depth = exp(-altitude * scaleOverScaleDepth);`),e.haze?t.fragment.code.add(n.a`vec2 scatter = depth * scaledValuesDepth - cameraOffset;`):t.fragment.code.add(n.a`float lightAngle = dot(lightingMainDirection, samplePoint) / height;
float cameraAngle = dot(worldSpaceRay, samplePoint) / height;
float tmpScaledValues = scale(lightAngle) - scale(cameraAngle);
vec2 scatter = cameraOffset + tmpScaledValues * depth * shellDepth;`),t.fragment.code.add(n.a`attenuate = exp(-scatter.x * invWavelengthScaled);
attenuateBlue = exp(-scatter.y * invWavelengthScaled);
frontColor += attenuate * depth.x;
frontColorBlue += attenuateBlue * depth.y;
samplePoint += sampleRay;
}
float LdotR = clamp(dot(lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);
float LdotRSq = LdotR * LdotR + 1.0;`),e.haze?t.fragment.code.add(n.a`vec3 colorCoefficients = (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );
vec3 color = colorCoefficients * frontColor;
vec3 colorBlue = colorCoefficients * frontColorBlue;`):t.fragment.code.add(n.a`vec3 rayleighCoefficients = (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;
float mieCoefficients = scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);
vec3 color = rayleighCoefficients * frontColor + mieCoefficients * frontColor;
vec3 colorBlue = rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;`),t.fragment.code.add(n.a`vec3 ldrBlue = expTM(colorBlue, 2.0 * exposure);
vec3 ldrRed = expTM(color, exposure);
vec3 LDR = mix(ldrBlue, ldrRed, 0.2);`),e.haze?t.fragment.code.add(n.a`LDR *= (1.0 - cameraAngle);
vec3 hsv = rgb2hsv(LDR);
hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0);
LDR = hsv2rgb(hsv);
vec3 finalColor = LDR;`):t.fragment.code.add(n.a`vec3 ldrReinhard = reinhardTM(color, exposure);
LDR += angleMultiplier * ldrReinhard;
float side = (rayEnd + rayStart) * 0.5;
float atmoHeight = sqrt(cameraHeightSq - side * side);
float h2 = clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);
vec3 finalColor = LDR * h2;
vec3 hsv = rgb2hsv(finalColor);
hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0);
finalColor = hsv2rgb(hsv);`),t.fragment.code.add(n.a`
    ${e.haze?"gl_FragColor = vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength = clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor = vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend > 0.0) {\n            gl_FragColor = mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }"}
      } else { // Outside Atmosphere
        gl_FragColor = vec4(0.0);
      }
    }
  `),t}var o=Object.freeze({__proto__:null,build:a})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var i=r(378),n=r(6),s=r(73);function a(){const e=new s.a;return e.attributes.add("position","vec3"),e.attributes.add("color","vec4"),e.attributes.add("size","float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float"),e.include(i.a),e.vertex.code.add(n.a`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(n.a`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}var o=Object.freeze({__proto__:null,build:a})},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return f}));var i=r(61),n=r(644),s=r(209),a=r(107),o=r(467),l=r(98),c=r(391),u=r(95),d=r(167),h=r(6),p=r(73);function f(e){const t=new p.a;t.extensions.add("GL_OES_standard_derivatives"),t.include(c.a),t.include(n.a,e),t.include(o.a,e),1===e.output&&t.include(s.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");const r=e.falloffEnabled,f=e.innerColorEnabled;return f&&t.varyings.add("vLineDistance","float"),r&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(h.a`#define PERPENDICULAR(v) vec2(v.y, -v.x);
#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),t.vertex.code.add(h.a`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`),t.vertex.code.add(h.a`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`),t.vertex.code.add(h.a`void main(void) {
float coverage = 1.0;
vpos = position;
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;
bool isJoin = abs(uv0.y)-3.0 < 0.0;
float lineWidth = getSize() * pixelRatio;
if (lineWidth < 1.0) {
coverage = lineWidth;
lineWidth = 1.0;
}else{
lineWidth = floor(lineWidth + 0.5);
}
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
vec4 next = view * vec4(auxpos2.xyz, 1.0);
clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),e.stippleEnabled&&t.vertex.code.add(h.a`vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);
vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;
vec2 stippleSegmentDirection = stippleSegmentInfo.zw;`),t.vertex.code.add(h.a`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = ISOUTSIDE;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?t.vertex.code.add(h.a`vec2 startDir;
vec2 endDir;
if (leftLen < 0.001) {
startDir = right;
}
else{
startDir = left;
}
startDir = normalize(startDir);
startDir = PERPENDICULAR(startDir);
if (rightLen < 0.001) {
endDir = left;
}
else{
endDir = right;
}
endDir = normalize(endDir);
endDir = PERPENDICULAR(endDir);
float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);`):t.vertex.code.add(h.a`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),t.vertex.code.add(h.a`displacementLen = lineWidth;
}
} else {
if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
displacementLen = lineWidth;
capDisplacementDir = isStartVertex ? -right : left;`),e.roundCaps?t.vertex.code.add(h.a`float angle = subdivisionFactor*PI*0.5;
joinDisplacementDir *= cos(angle);
capDisplacementDir *= sin(angle);`):t.vertex.code.add(h.a`capDisplacementDir *= subdivisionFactor;`),t.vertex.code.add(h.a`
  }

  // Displacement (in pixels) caused by join/or cap
  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

  ${r||f?h.a`float lineDist = lineWidth * sign(uv0.y) * pos.w;`:""}

  ${f?h.a`vLineDistance = lineDist;`:""}
  ${r?h.a`vLineDistanceNorm = lineDist / lineWidth;`:""}

  pos.xy += dpos;
  `),e.stippleEnabled&&(t.vertex.code.add(h.a`{
vec2 posVec = pos.xy - stippleSegmentOrigin;
float stippleSegmentDirectionLength = length(stippleSegmentDirection);`),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(h.a`float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;
float roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);
stipplePatternUvMax = roundedNumberOfPatternRepeats;`),t.vertex.code.add(h.a`
      if (stippleSegmentDirectionLength >= 0.001) {
        // Project the vertex position onto the line segment.
        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;
     ${e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;"}
        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;
        } else {
          stipplePatternUv = 1.0;
        }
      }
    `)),t.vertex.code.add(h.a`pos.xy = pos.xy / screenSize * pos.w;
vColor = getColor();
vColor.a *= coverage;
gl_Position = pos;
}
}`),e.multipassTerrainEnabled&&(t.fragment.include(a.a),t.include(l.b,e)),t.include(i.a,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(d.a),t.fragment.code.add(h.a`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 color = intrinsicColor * vColor;
  `),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(h.a`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),t.fragment.code.add(h.a`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&t.fragment.code.add(h.a`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`),t.fragment.code.add(h.a`
    if (finalColor.a < ${h.a.float(u.c)}) {
      discard;
    }

    ${7===e.output?h.a`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===e.output?h.a`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${4===e.output?h.a`gl_FragColor = vec4(1.0);`:""}
    ${1===e.output?h.a`outputDepth(linearDepth);`:""}
  }
  `),t}var b=Object.freeze({__proto__:null,build:f})},function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return g}));var i=r(264),n=r(61),s=r(117),a=r(96),o=r(107),l=r(98),c=r(251),u=r(135),d=r(493),h=r(426),p=r(95),f=r(167),b=r(6),m=r(73);function g(e){const t=new m.a;return t.include(s.a,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(c.a,e),t.include(i.a,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(b.a`
      void main(void) {
        if (waterColor.a < ${b.a.float(p.c)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${0===e.output?"forwardLinearDepth();":""}
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(o.a),t.include(l.b,e)),7===e.output&&(t.include(n.a,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b.a`
        void main() {
          discardBySlice(vpos);
          ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),0===e.output&&(t.include(h.a,e),t.include(n.a,e),e.receiveShadows&&t.include(u.a,e),t.include(d.a,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(f.a),t.fragment.code.add(b.a`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        float shadow = ${e.receiveShadows?b.a`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),2===e.output&&(t.include(c.a,e),t.include(h.a,e),t.include(n.a,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b.a`
        void main(void) {
          if (waterColor.a < ${b.a.float(p.c)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(b.a`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(b.a`
        void main(void) {
          if (waterColor.a < ${b.a.float(p.c)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b.a`void main() {
gl_FragColor = waterColor;
}`)),4===e.output&&(t.include(a.a),t.varyings.add("vpos","vec3"),t.vertex.code.add(b.a`
      void main(void) {
        if (waterColor.a < ${b.a.float(p.c)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(n.a,e),t.fragment.code.add(b.a`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}var y=Object.freeze({__proto__:null,build:g})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var i=r(265),n=r(6),s=r(73);function a(){const e=new s.a;return e.include(i.a),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(n.a`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * color;
}`),e}var o=Object.freeze({__proto__:null,build:a})},function(e,t,r){"use strict";r.d(t,"a",(function(){return R})),r.d(t,"b",(function(){return E}));var i=r(264),n=r(468),s=r(61),a=r(117),o=r(383),l=r(313),c=r(311),u=r(469),d=r(235),h=r(210),p=r(271),f=r(269),b=r(470),m=r(107),g=r(471),y=r(308),v=r(266),O=r(98),j=r(472),_=r(312),w=r(262),x=r(135),S=r(186),T=r(95),C=r(473),M=r(317),P=r(6),A=r(73);function E(e){const t=new A.a,r=t.vertex.code,E=t.fragment.code;return t.include(C.a,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(c.a),t.varyings.add("vpos","vec3"),t.include(S.a,e),t.include(o.a,e),t.include(f.a,e),0!==e.output&&7!==e.output||(t.include(l.a,e),t.include(a.a,{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(n.a),t.include(g.a,e),t.include(p.a,e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(d.a,e),t.include(i.a,e),t.include(u.a,e),t.include(h.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),r.add(P.a`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${P.a.float(T.c)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${0===e.normalType?P.a`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.vertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
        }

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),7===e.output&&(t.include(s.a,e),t.include(T.a,e),e.multipassTerrainEnabled&&(t.fragment.include(m.a),t.include(O.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(M.a),E.add(P.a`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?P.a`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:P.a`vec4 texColor = vec4(1.0);`}
        ${e.attributeColor?P.a`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:P.a`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `)),0===e.output&&(t.include(s.a,e),t.include(v.a,e),t.include(y.a,e),t.include(T.a,e),e.receiveShadows&&t.include(x.a,e),e.multipassTerrainEnabled&&(t.fragment.include(m.a),t.include(O.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(w.b,e),t.include(_.a,e),t.fragment.include(M.a),t.include(j.a,e),E.add(P.a`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?P.a`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:P.a`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - camPos);
        ${3===e.normalType?P.a`
        vec3 normal = screenDerivativeNormal(localvpos);`:P.a`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${1===e.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.attributeColor?P.a`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:P.a`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${e.hasNormalTexture?P.a`
              mat3 tangentSpace = ${e.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal = normal;"}
        ${1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?P.a`vec3 normalGround = normalize(vpos + localOrigin);`:P.a`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:P.a``}
        ${1===e.pbrMode||2===e.pbrMode?P.a`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(b.a,e),t}var R=Object.freeze({__proto__:null,build:E})},function(e,t,r){"use strict";r.d(t,"a",(function(){return M})),r.d(t,"b",(function(){return C}));var i=r(264),n=r(468),s=r(61),a=r(117),o=r(383),l=r(313),c=r(311),u=r(469),d=r(235),h=r(210),p=r(269),f=r(470),b=r(107),m=r(308),g=r(266),y=r(98),v=r(312),O=r(262),j=r(135),_=r(186),w=r(95),x=r(317),S=r(6),T=r(73);function C(e){const t=new T.a,r=t.vertex.code,C=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(c.a),t.varyings.add("vpos","vec3"),t.include(_.a,e),t.include(o.a,e),t.include(p.a,e),0!==e.output&&7!==e.output||(t.include(l.a,e),t.include(a.a,{linearDepth:!1}),e.offsetBackfaces&&t.include(n.a),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(d.a,e),t.include(i.a,e),t.include(u.a,e),t.include(h.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),r.add(S.a`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${S.a.float(w.c)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
          }
          ${e.multipassTerrainEnabled?S.a`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),7===e.output&&(t.include(s.a,e),t.include(w.a,e),e.multipassTerrainEnabled&&(t.fragment.include(b.a),t.include(y.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(x.a),C.add(S.a`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?S.a`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S.a`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:S.a`vec4 texColor = vec4(1.0);`}
        ${e.attributeColor?S.a`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S.a`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `)),0===e.output&&(t.include(s.a,e),t.include(g.a,e),t.include(m.a,e),t.include(w.a,e),e.receiveShadows&&t.include(j.a,e),e.multipassTerrainEnabled&&(t.fragment.include(b.a),t.include(y.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(O.b,e),t.include(v.a,e),t.fragment.include(x.a),C.add(S.a`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?S.a`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S.a`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:S.a`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - camPos);
        ${1===e.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.attributeColor?S.a`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S.a`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${S.a`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?S.a`vec3 normalGround = normalize(vpos + localOrigin);`:S.a`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:S.a``}
        ${1===e.pbrMode||2===e.pbrMode?S.a`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(f.a,e),t}var M=Object.freeze({__proto__:null,build:C})},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return d}));var i=r(61),n=r(117),s=r(210),a=r(96),o=r(467),l=r(95),c=r(6),u=r(73);function d(e){const t=new u.a;return t.include(n.a,{linearDepth:!1}),t.include(s.a,e),t.include(o.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(c.a`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(c.a`
    vec4 vpos2 = transformPosition(proj, view, auxpos1);
    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);

    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;
    ${e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""}

    // Cancel out perspective correct interpolation because we want this length the really represent
    // the screen distance
    stipplePatternUv *= gl_Position.w;
    `)),t.vertex.code.add(c.a`}`),4===e.output&&t.include(a.a),t.include(i.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(c.a`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${c.a.float(l.c)}) {
      discard;
    }

    ${0===e.output?c.a`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===e.output?c.a`outputHighlight();`:""}
  }
  `),t}var h=Object.freeze({__proto__:null,build:d})},function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return v}));var i=r(264),n=r(61),s=r(117),a=r(487),o=r(209),l=r(96),c=r(107),u=r(308),d=r(266),h=r(98),p=r(472),f=r(251),b=r(135),m=r(167),g=r(6),y=r(73);function v(e){const t=new y.a;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.varyings.add("vpos","vec3"),t.include(a.a,e),0!==e.output&&7!==e.output||(t.include(s.a,{linearDepth:!1}),e.receiveShadows&&t.include(b.a,e),t.include(i.a,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(g.a`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${0===e.output?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(c.a),t.include(h.b,e)),7===e.output&&(t.include(n.a,e),t.fragment.uniforms.add("camPos","vec3"),t.fragment.uniforms.add("localOrigin","vec3"),t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(g.a`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),0===e.output&&(t.include(n.a,e),t.include(d.a,e),t.include(u.a,e),e.receiveShadows&&t.include(b.a,e),t.include(p.a,e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),t.fragment.include(m.a),t.fragment.code.add(g.a`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - camPos);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),1!==e.output&&3!==e.output||(t.include(s.a,{linearDepth:!0}),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("depth","float"),t.vertex.code.add(g.a`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(n.a,e),t.include(o.a,e),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(g.a`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),2===e.output&&(t.include(s.a,{linearDepth:!1}),t.include(f.a,e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(g.a`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n.a,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(g.a`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),4===e.output&&(t.include(s.a,{linearDepth:!1}),t.include(f.a,e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(g.a`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n.a,e),t.include(l.a),t.fragment.code.add(g.a`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}var O=Object.freeze({__proto__:null,build:v})},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return f}));var i=r(61),n=r(117),s=r(210),a=r(209),o=r(96),l=r(107),c=r(98),u=r(95),d=r(167),h=r(6),p=r(73);function f(e){const t=new p.a,r=1===e.output;return t.include(n.a,{linearDepth:r}),t.include(s.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),r&&(t.include(a.a,e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(h.a`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${r?h.a`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:h.a`transformPosition(proj, view, vpos);`}
    }
  `),t.include(i.a,e),t.fragment.include(d.a),e.multipassTerrainEnabled&&(t.fragment.include(l.a),t.include(c.b,e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(o.a),t.fragment.code.add(h.a`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${h.a.float(u.c)}) {
      discard;
    }

    ${7===e.output?h.a`gl_FragColor = vec4(color.a);`:""}

    ${0===e.output?h.a`gl_FragColor = highlightSlice(color, vpos); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===e.output?h.a`outputHighlight();`:""};
    ${1===e.output?h.a`outputDepth(linearDepth);`:""};
  }
  `),t}var b=Object.freeze({__proto__:null,build:f})},function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return m}));var i=r(61),n=r(117),s=r(210),a=r(209),o=r(96),l=r(107),c=r(98),u=r(95),d=r(167),h=r(6),p=r(73);const f=.70710678118,b=f;function m(e){const t=new p.a;e.draped||t.extensions.add("GL_OES_standard_derivatives");const r=1===e.output;t.include(n.a,{linearDepth:r}),t.include(s.a,e),t.vertex.uniforms.add("proj","mat4"),t.vertex.uniforms.add("view","mat4"),r&&(t.include(a.a,e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),e.draped?t.vertex.uniforms.add("worldToScreenRatio","float"):(t.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),t.vertex.uniforms.add("camPos","vec3"),t.attributes.add("boundingRect","mat3")),t.attributes.add("position","vec3"),t.attributes.add("uvMapSpace","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");const m=3===e.style||4===e.style||5===e.style;return m&&t.vertex.code.add(h.a`
      const mat2 rotate45 = mat2(${h.a.float(f)}, ${h.a.float(-b)},
                                 ${h.a.float(b)}, ${h.a.float(f)});
    `),e.draped||(t.vertex.code.add(h.a`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),t.vertex.code.add(h.a`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),t.vertex.code.add(h.a`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${h.a.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, camPos, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - camPos);
      }
    `)),t.vertex.code.add(h.a`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${m?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${m?" * rotate45":""};

      ${e.draped?h.a`
            float ratio = worldToScreenRatio;
          `:h.a`
            float distanceToCamera = boundingRectDistanceToCamera();
            float ratio = worldToScreenPerDistanceRatio / distanceToCamera;

            // Logarithmically discretize ratio to avoid jittering
            float step = 0.1;
            ratio = log(ratio);
            ratio = ceil(ratio / step) * step;
            ratio = exp(ratio);
          `}

      vec2 uvOffset = mod(uvCellOrigin * ratio, ${h.a.float(e.patternSpacing)});
      return uvOffset + (uv * ratio);
    }
  `),t.vertex.code.add(h.a`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${r?h.a`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:h.a`transformPosition(proj, view, vpos);`}
    }
  `),t.include(i.a,e),t.fragment.include(d.a),t.fragment.uniforms.add("matColor","vec4"),e.draped&&t.fragment.uniforms.add("texelSize","float"),4===e.output&&t.include(o.a),e.multipassTerrainEnabled&&(t.fragment.include(l.a),t.include(c.b,e)),4!==e.output&&(t.fragment.code.add(h.a`
      const float lineWidth = ${h.a.float(e.lineWidth)};
      const float spacing = ${h.a.float(e.patternSpacing)};
      const float spacingINV = ${h.a.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||t.fragment.code.add(h.a`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),t.fragment.code.add(h.a`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.attributeColor?"vColor * matColor;":"matColor;"}
      color = highlightSlice(color, vpos);

      ${4!==e.output?h.a`color.a *= ${function(e){function t(t){return e.draped?h.a`coverage(vuv.${t}, texelSize)`:h.a`sample(vuv.${t})`}switch(e.style){case 3:case 0:return t("y");case 4:case 1:return t("x");case 5:case 2:return h.a`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}(e)};`:""}

      if (color.a < ${h.a.float(u.c)}) {
        discard;
      }

      ${7===e.output?h.a`gl_FragColor = vec4(color.a);`:""}

      ${0===e.output?h.a`gl_FragColor = color; ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${4===e.output?h.a`outputHighlight();`:""}
      ${1===e.output?h.a`outputDepth(linearDepth);`:""};
    }
  `),t}var g=Object.freeze({__proto__:null,build:m})},function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var i=r(120),n=r(10),s=r(16),a=r(20),o=r(3),l=r(5),c=r(36),u=r(53),d=r(22),h=r(28),p=r(112),f=r(26),b=r(64),m=r(514);const g=.5*Math.PI,y=g/Math.PI*180;class v{constructor(e){this.renderCoordsHelper=e.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:Object(l.e)(),direction:Object(l.e)()};for(let t=0;t<4;t++)this.extent[t]={origin:Object(l.e)(),direction:Object(l.e)(),cap:{next:null,direction:Object(l.e)()}},this.planes[t]=Object(f.d)();this.planes[4]=Object(f.d)(),this.planes[5]=Object(f.d)(),this.planesWithoutFar=this.planes.slice(0,5)}update(e,t,r,i=!0){const n=this.extent;this.toRenderBoundingExtent(e,t,r),Object(o.h)(this.center.origin,n[0].origin,n[2].origin),Object(o.g)(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),i||Object(o.g)(this.center.direction,this.center.direction,-1);for(let s=0;s<4;s++){const e=n[s];this.renderCoordsHelper.worldUpAtPosition(e.origin,e.direction);const t=n[3===s?0:s+1];e.cap.next=t.origin,Object(o.x)(e.cap.direction,e.origin,t.origin),Object(f.j)(e.direction,e.cap.direction,e.origin,this.planes[s]),i||Object(o.g)(e.direction,e.direction,-1)}Object(f.j)(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[4]),i?Object(f.r)(this.planes[4],this.planes[5]):(Object(f.c)(this.planes[4],this.planes[5]),Object(f.r)(this.planes[4],this.planes[4])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t,this.minGlobalAltitude=.9*Object(u.e)(this.maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,r=!1){if(null==e)return!1;if(1===this.renderCoordsHelper.viewingMode){const r=this.maxSpanSpatialReference.isGeographic?y:g*t;if(this.maxSpan>r)return!0;if(e.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(e)}if(0===this.maxSpan){const t=this.extent[0];return!(r||!e.intersectsRay(Object(b.g)(t.origin,t.direction)))}for(let n=0;n<this.extent.length;n++){const t=this.extent[n];if(!r&&e.intersectsRay(Object(b.g)(t.origin,t.direction)))return!0;if(e.intersectsLineSegment(Object(p.e)(t.origin,t.cap.next,S),t.cap.direction))return!0}const i=r?this.planes:this.planesWithoutFar;for(let n=0;n<e.lines.length;n++){const t=e.lines[n];if(Object(m.b)(i,t.origin,t.endpoint,t.direction))return!0}return!1}toRenderBoundingExtentGlobal(e,t,r){Object(h.e)(e,j),j[2]=r,Object(c.d)(t,j,_,this.renderCoordsHelper.spatialReference),Object(s.a)(w,_),Object(d.k)(x);for(const{x0:i,x1:s,y0:a,y1:l}of O)for(let u=0;u<5;u++){const h=u/4;j[0]=Object(n.m)(e[i],e[s],h),j[1]=Object(n.m)(e[a],e[l],h),j[2]=r,Object(c.z)(j,t,j,this.renderCoordsHelper.spatialReference),Object(o.s)(j,j,w),Object(d.r)(x,j)}Object(o.y)(this.extent[0].origin,x[0],x[1],x[2]),Object(o.y)(this.extent[1].origin,x[3],x[1],x[2]),Object(o.y)(this.extent[2].origin,x[3],x[4],x[2]),Object(o.y)(this.extent[3].origin,x[0],x[4],x[2]);for(let i=0;i<4;++i)Object(o.s)(this.extent[i].origin,this.extent[i].origin,_)}toRenderBoundingExtentLocal(e,t){Object(o.y)(this.extent[0].origin,e[0],e[1],t),Object(o.y)(this.extent[1].origin,e[2],e[1],t),Object(o.y)(this.extent[2].origin,e[2],e[3],t),Object(o.y)(this.extent[3].origin,e[0],e[3],t)}toRenderBoundingExtent(e,t,r){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(e,t,r);break;case 2:this.toRenderBoundingExtentLocal(e,r);break;default:Object(i.a)(this.renderCoordsHelper.viewingMode)}}isVisibleInFrustumGlobal(e){if(Object(o.j)(this.center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const r=this.extent[t];if(Object(o.j)(r.direction,e.direction)<0)return!0}return!1}}const O=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],j=Object(l.e)(),_=Object(a.d)(),w=Object(a.d)(),x=Object(d.h)(),S=Object(p.c)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r(6),n=r(73);function s(){const e=new n.a;return e.attributes.add("position","vec2"),e.attributes.add("uv0","vec2"),e.vertex.uniforms.add("scale","float"),e.vertex.uniforms.add("offset","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(i.a`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
}`),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("opacity","float"),e.fragment.code.add(i.a`void main() {
vec4 color = texture2D(tex, uv);
gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
}`),e}var a=Object.freeze({__proto__:null,build:s})},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c}));var i=r(650),n=r(651),s=r(665),a=r(167),o=r(6),l=r(73);function c(e){const t=new l.a;return t.include(i.a),t.include(s.a),t.include(n.a),0===e.output?function(e,t){e.fragment.uniforms.add("u_bandCount","int"),e.fragment.uniforms.add("u_minCutOff","float",3),e.fragment.uniforms.add("u_maxCutOff","float",3),e.fragment.uniforms.add("u_factor","float",3),e.fragment.uniforms.add("u_minOutput","float"),e.fragment.uniforms.add("u_maxOutput","float"),e.fragment.uniforms.add("u_useGamma","bool"),e.fragment.uniforms.add("u_gamma","float",3),e.fragment.uniforms.add("u_gammaCorrection","float",3),e.fragment.code.add(o.a`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=t?o.a`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:o.a`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`;e.fragment.code.add(o.a`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }
      }
    `)}(t,e.applyColormap):1===e.output?t.fragment.code.add(o.a`void main() {
vec2 pixelLocation = getPixelLocation(v_texcoord);
if (isOutside(pixelLocation)) {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = colormap(currentPixel, true);
}`):2===e.output&&function(e,t){e.fragment.uniforms.add("u_hillshadeType","int"),e.fragment.uniforms.add("u_sinZcosAs","float",6),e.fragment.uniforms.add("u_sinZsinAs","float",6),e.fragment.uniforms.add("u_cosZs","float",6),e.fragment.uniforms.add("u_weights","float",6),e.fragment.uniforms.add("u_factor","vec2"),e.fragment.uniforms.add("u_applyColormap","bool"),e.fragment.uniforms.add("u_minValue","float"),e.fragment.uniforms.add("u_maxValue","float"),e.fragment.uniforms.add("u_srcImageSize","vec2"),e.fragment.include(a.a),e.fragment.code.add(o.a`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(rgb.xyz);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),e.fragment.code.add(o.a`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t?o.a`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:o.a`hillshade *= alpha;
gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);`;e.fragment.code.add(o.a`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}(t,e.applyColormap),t}var u=Object.freeze({__proto__:null,build:c})},function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return m}));var i=r(61),n=r(117),s=r(652),a=r(209),o=r(96),l=r(266),c=r(251),u=r(422),d=r(653),h=r(654),p=r(473),f=r(6),b=r(73);function m(e){const t=new b.a;if(t.include(p.a,{name:"Terrain Shader",output:e.output}),t.include(d.a),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float"),0===e.output){t.include(n.a,{linearDepth:!1}),t.include(c.a,e),t.include(h.a,e);const r=0!==e.overlayMode,a=2===e.overlayMode;r&&t.include(u.a,{pbrMode:3,useCustomDTRExponentForWater:!1,ssrEnabled:e.ssrEnabled,highStepCount:e.highStepCount}),a&&t.include(s.a,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("viewNormal","mat4"),e.receiveShadows&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(t.vertex.uniforms.add("lightingMainDirection","vec3"),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.vertex.uniforms.add("screenSizePerspective","vec4"),t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),t.vertex.code.add(f.a`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        vpos = applySkirts(uv, vpos, vnormal, skirtScale);
        ${e.atmosphere?f.a`
        wnormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        wlight = (view  * vec4(lightingMainDirection, 1.0)).xyz;`:""}
        ${e.tileBorders?f.a`vuv = uv;`:""}
        ${e.screenSizePerspective?f.a`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${e.receiveShadows?f.a`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${r?f.a`setOverlayVTC(uv);`:""}
        ${a?f.a`forwardVertexTangent(vnormal);`:f.a``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(i.a,e),t.include(l.a,e),t.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4").add("opacity","float"),e.screenSizePerspective&&t.fragment.uniforms.add("screenSizePerspective","vec4"),a&&(t.fragment.uniforms.add("ovWaterTex","sampler2D"),t.fragment.uniforms.add("view","mat4")),t.fragment.code.add(f.a`const vec3 ambient = vec3(0.2, 0.2, 0.2);
const vec3 diffuse = vec3(0.8, 0.8, 0.8);
const float diffuseHardness = 2.5;
const float sliceOpacity = 0.2;
float lum(vec3 c) {
float max = max(max(c.r, c.g), c.b);
float min = min(min(c.r, c.g), c.b);
return (min + max) * 0.5;
}`),e.atmosphere&&t.fragment.code.add(f.a`vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {
vec3 surfaceColor   = vec3(0.0);
vec3 fuzzySpecColor = vec3(1.0);
vec3 subColor       = vec3(0.0);
float rollOff       = 1.0;
vec3 Ln = normalize(lightPos);
vec3 Nn = normalize(normal);
vec3 Hn = normalize(view + Ln);
float ldn = dot(Ln, Nn);
float diffComp = max(0.0, ldn);
float vdn = clamp(1.0 - dot(view, Nn), 0.0, 1.0);
float ndv = dot(view, Ln);
vec3 diffContrib = surfaceColor * diffComp;
float subLamb = max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));
vec3 subContrib = subLamb * subColor;
vec3 vecColor = vec3(vdn);
vec3 diffuseContrib = (subContrib + diffContrib);
vec3 specularContrib = (vecColor * fuzzySpecColor);
return (diffContrib + specularContrib) * rollOff;
}`),t.fragment.code.add(f.a`
      void main() {
        ${e.receiveShadows?f.a`float shadow = readShadowMap(vpos, linearDepth);`:f.a`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), lightingMainDirection);
        float k = smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));
        vec3 d = (1.0 - shadow/1.8) * diffuse * k;

        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        vec4 tileColor = getTileColor() * opacity;
        ${r?f.a`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        vec3 atm = vec3(0.0);
        ${e.atmosphere?f.a`
            float ndotl = max(0.0, min(1.0, vndl));
            atm = atmosphere(wlight, wnormal, -viewDirection);
            atm *= max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps
            atm *= max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}
        vec3 albedo = atm + tileColor.rgb;
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${a?f.a`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?f.a`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?f.a`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return 1!==e.output&&3!==e.output||(t.include(n.a,{linearDepth:!0}),t.include(a.a,{output:e.output}),t.include(c.a,e),t.varyings.add("linearDepth","float"),t.vertex.uniforms.add("nearFar","vec2"),t.vertex.code.add(f.a`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
}`),t.fragment.code.add(f.a`void main() {
outputDepth(linearDepth);
}`)),2===e.output&&(t.include(n.a,{linearDepth:!1}),t.include(c.a,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("viewNormal","mat4"),t.vertex.code.add(f.a`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vpos = applySkirts(uv, position, normal, skirtScale);
gl_Position = transformPosition(proj, view, vpos);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),t.fragment.code.add(f.a`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),4===e.output&&(t.include(n.a,{linearDepth:!1}),t.include(c.a,e),t.include(u.a,{pbrMode:0}),t.vertex.code.add(f.a`void main() {
vec3 vnormal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);
setOverlayVTC(uv);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(o.a),t.fragment.code.add(f.a`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}var g=Object.freeze({__proto__:null,build:m})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var i=r(265),n=r(6),s=r(73);function a(e){const t=new s.a;return t.include(i.a),t.fragment.uniforms.add("tex","sampler2D"),0===e.function&&(e.hasOpacityFactor?(t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(n.a`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):t.fragment.code.add(n.a`void main() {
gl_FragColor = texture2D(tex, uv);
}`)),3===e.function&&(t.fragment.uniforms.add("overlayIdx","int"),e.hasOpacityFactor&&t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(n.a`
      void main() {
        vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5+ 0.5, uv.y);
        gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
      }`)),1===e.function&&t.fragment.code.add(n.a`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),2===e.function&&(t.fragment.uniforms.add("colorTexture","sampler2D"),t.fragment.uniforms.add("alphaTexture","sampler2D"),t.fragment.uniforms.add("frontFaceTexture","sampler2D"),t.fragment.code.add(n.a`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`)),t}var o=Object.freeze({__proto__:null,build:a})},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r(6),n=r(73);function s(e){const t=new n.a,r=t.vertex.code,s=t.fragment.code;return t.attributes.add("position","vec2"),2===e.highlightStage&&(r.add(i.a`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("invFramebufferDim","vec2"),s.add(i.a`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`)),0===e.highlightStage&&(t.attributes.add("uv0","vec2"),e.gridOptimization?(t.vertex.uniforms.add("coverageTex","sampler2D"),t.fragment.uniforms.add("blurSize","vec2"),t.varyings.add("blurCoordinate","vec3")):(t.vertex.uniforms.add("blurSize","vec2"),t.varyings.add("blurCoordinates[5]","vec2")),r.add(i.a`
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e.gridOptimization?i.a`
      vec4 cov = texture2D(coverageTex, uv0);
      if (cov.r == 0.0) {
        gl_Position = vec4(0.0);
      }
      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
      `:i.a`
      vec2 uv = position.xy * 0.5 + vec2(0.5);
      blurCoordinates[0] = uv;
      blurCoordinates[1] = uv + blurSize * 1.407333;
      blurCoordinates[2] = uv - blurSize * 1.407333;
      blurCoordinates[3] = uv + blurSize * 3.294215;
      blurCoordinates[4] = uv - blurSize * 3.294215;
          `}
    }`),t.fragment.uniforms.add("tex","sampler2D"),s.add(i.a`
    void main() {
      ${e.gridOptimization?i.a`
          vec2 uv = blurCoordinate.xy;
          vec4 center = texture2D(tex, uv);

          // do not blur if no pixel or all pixels in neighborhood are set
          if (blurCoordinate.z == 1.0) {
            gl_FragColor = center;
          } else {
            vec4 sum = vec4(0.0);
            sum += center * 0.204164;
            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
            gl_FragColor = sum;
          }`:i.a`
          vec4 sum = vec4(0.0);
          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;
          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;
          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;
          gl_FragColor = sum;`}
    }`)),1===e.highlightStage&&(t.varyings.add("uv","vec2"),e.gridOptimization&&(t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("coverageTex","sampler2D")),r.add(i.a`
      void main() {
        ${e.gridOptimization?i.a`
            vec4 cov = texture2D(coverageTex, uv0);
            // if no highlight pixel set in this block, hide block
            if (cov.r == 0.0) {
              gl_Position = vec4(0.0);
              return;
            }`:""}
        gl_Position = vec4(position, 0.0, 1.0);
        uv = position.xy * 0.5 + vec2(0.5);
      }`),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("origin","sampler2D"),t.fragment.uniforms.add("color","vec4"),t.fragment.uniforms.add("haloColor","vec4"),t.fragment.uniforms.add("outlineSize","float"),t.fragment.uniforms.add("blurSize","float"),t.fragment.uniforms.add("opacities","vec4"),s.add(i.a`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = color.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = color.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);
}`)),t}var a=Object.freeze({__proto__:null,build:s})},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return d}));var i=r(265),n=r(96),s=r(107),a=r(135),o=r(381),l=r(183),c=r(6),u=r(73);function d(e){const t=new u.a;return t.include(a.a),t.fragment.include(l.a),t.fragment.include(s.a),t.include(o.a),t.include(i.a),t.fragment.uniforms.add("defaultDepthTex","sampler2D").add("highlightDepthTex","sampler2D").add("depthMap","sampler2D").add("highlightMap","sampler2D").add("color","vec4").add("nearFar","vec2").add("opacity","float").add("occludedOpacity","float").add("terminationFactor","float").add("inverseView","mat4").add("lightingMainDirectionView","vec3").add("texelSize","vec2"),t.fragment.constants.add("unoccludedHighlightFlag","vec4",n.c).add("highlightedThreshold","float",e.highlightedThreshold).add("selfShadowThreshold","float",e.selfShadowThreshold),t.fragment.code.add(c.a`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.fragment.code.add(c.a`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseView * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= uShadowMapNum) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float differenceOpacity = opacity;
float bothOpacity = occludedOpacity;
float fragOpacity = (shadowDefault || shaded) ? bothOpacity : differenceOpacity;
gl_FragColor = vec4(color.rgb, color.a * fragOpacity * terminationFactor);
}`),t}var h=Object.freeze({__proto__:null,build:d})},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r(6),n=r(73);function s(e){const t=new n.a;return 0===e.output&&(t.attributes.add("position","vec2"),t.vertex.uniforms.add("uResolution","vec4"),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(i.a`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + uResolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add("tColor","sampler2D"),t.fragment.code.add(i.a`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${i.a.float(e.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${i.a.float(e.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),1===e.output&&(t.attributes.add("position","vec2"),t.vertex.uniforms.add("uResolution","vec4"),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(i.a`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * uResolution.zw;
        fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * uResolution.xxyy * float( ${i.a.int(e.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add("tEdges","sampler2D").add("tArea","sampler2D").add("tSearch","sampler2D").add("tColor","sampler2D").add("uResolution","vec4"),t.fragment.code.add(i.a`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture2D( tex, coord + offset.x * uResolution.xy, 0.0 );
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${i.a.int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * uResolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * uResolution.x;
        texcoord.x += uResolution.x;
        texcoord.x += 2.0 * uResolution.x;
        texcoord.x -= uResolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${i.a.int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * uResolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * uResolution.x;
        texcoord.x -= uResolution.x;
        texcoord.x -= 2.0 * uResolution.x;
        texcoord.x += uResolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${i.a.int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * uResolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * uResolution.y;
        texcoord.y -= uResolution.y;
        texcoord.y -= 2.0 * uResolution.y;
        texcoord.y += uResolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${i.a.int(e.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * uResolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * uResolution.y;
        texcoord.y += uResolution.y;
        texcoord.y += 2.0 * uResolution.y;
        texcoord.y -= uResolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${i.a.int(e.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * uResolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * uResolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * uResolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * uResolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),2===e.output&&(t.attributes.add("position","vec2"),t.vertex.uniforms.add("uResolution","vec4"),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(i.a`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add("tBlendWeights","sampler2D"),t.fragment.uniforms.add("tColor","sampler2D"),t.fragment.uniforms.add("uResolution","vec4"),t.fragment.code.add(i.a`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * uResolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}var a=Object.freeze({__proto__:null,build:s})},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l}));var i=r(265),n=r(107),s=r(381),a=r(6),o=r(73);function l(e){const t=new o.a;return t.include(i.a),1===e.output&&(t.fragment.include(n.a),t.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("g_BlurFalloff","float").add("projScale","float").add("nearFar","vec2").add("zScale","vec2"),t.fragment.code.add(a.a`
      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);

        w_total += w;

        return w*c;
      }

      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/(center_d*zScale.x+zScale.y);
        for (int r = -${a.a.int(e.radius)}; r <= ${a.a.int(e.radius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf*blurSize;
          b += blurFunction(uvOffset, rf, center_d, w_total, sharpness);
        }

        gl_FragColor = vec4(b/w_total);
      }
    `)),0===e.output&&(t.fragment.include(n.a),t.include(s.a),t.fragment.uniforms.add("projMatrixInv","mat4").add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),t.fragment.code.add(a.a`
    uniform vec3 pSphere[${a.a.int(e.samples)}];

    float fallOffFunction(float vv, float vn, float bias) {
      float radius2 = radius * radius;
      float f = max(radius2 - vv, 0.0);
      return f * f * f * max(vn-bias, 0.0);
    }
    `),t.fragment.code.add(a.a`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.code.add(a.a`
      void main(void) {
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;

        vec4 occluderFragment;
        vec3 ray;

        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);

        for(int i = 0; i < ${a.a.int(e.samples)}; ++i) {
          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it
          //float ssR;
          //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);
          // get the depth of the occluder fragment
          //vec2 offset = vec2(-unitOffset*radius*ssR*ps);

          vec2 unitOffset = reflect(pSphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset*radius*ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;
          vec2 tcTap = tc/screenDimensions;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result

        float A = max(1.0-sum*intensity/float(${a.a.int(e.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther
        // (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

        //gl_FragColor = vec4(norm/2.0+0.5, 1.0);
        //gl_FragColor = vec4(-currentPixelDepth/1000.0);
        //gl_FragColor = vec4(tapPixelPos.x/100.0);
        gl_FragColor = vec4(A);
      }
    `)),t}var c=Object.freeze({__proto__:null,build:l})},function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return m}));var i=r(61),n=r(107),s=r(98),a=r(6),o=r(73),l=r(666),c=r(658),u=r(659),d=r(660),h=r(318),p=r(661),f=r(662),b=r(392);function m(e){const t=new o.a,r=t.vertex,m=t.fragment;return e.legacy&&r.uniforms.add("uModel","mat4"),e.antialiasing&&(r.code.add(a.a`#define ANTIALIASING 1`),m.code.add(a.a`#define ANTIALIASING 1`)),t.include(l.a,e),t.include(p.a,e),t.include(h.a,e),t.include(b.a,e),t.include(f.a,e),t.include(i.a,e),t.include(u.a,e),t.include(c.a,e),t.include(d.a,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add("uPixelToNDC","vec2"),r.uniforms.add("uNDCToPixel","vec2"),r.uniforms.add("uPixelRatio","float"),t.attributes.add("position0","vec3"),t.attributes.add("position1","vec3"),t.attributes.add("variantOffset","float"),t.attributes.add("variantStroke","float"),t.attributes.add("variantExtension","float"),r.code.add(a.a`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0 = worldFromModelPosition(position0);
vec3 worldPosV1 = worldFromModelPosition(position1);
vec3 viewPosV0 = viewFromModelPosition(position0);
vec3 viewPosV1 = viewFromModelPosition(position1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),e.multipassTerrainEnabled&&(t.fragment.include(n.a),t.include(s.b,e)),t.fragment.code.add(a.a`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}var g=Object.freeze({__proto__:null,build:m})},function(e,t,r){"use strict";var i=r(407);let n;t.a=function(){return n||(n=function(){const e={available:!1,version:0,majorPerformanceCaveat:!1,maxTextureSize:0,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1,supportsInstancedArrays:!1,supportsTextureFloat:!1,supportsColorBufferFloat:!1};if(void 0===typeof WebGLRenderingContext)return e;const t=document.createElement("canvas");if(!t)return e;let r=Object(i.a)(t,{failIfMajorPerformanceCaveat:!0},"webgl");if(r||(r=Object(i.a)(t,{},"webgl"),r&&(e.majorPerformanceCaveat=!0)),!r)return e;const n=r.getParameter(r.VERSION);if(!n)return e;const s=n.match(/^WebGL\s+([\d.]*)/);if(s){const t=parseFloat(s[1]);e.available=t>=.94;const i=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);i&&(e.supportsHighPrecisionFragment=i.precision>0),e.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0,e.supportsElementIndexUint=null!==r.getExtension("OES_element_index_uint"),e.supportsStandardDerivatives=null!==r.getExtension("OES_standard_derivatives"),e.supportsInstancedArrays=null!==r.getExtension("ANGLE_instanced_arrays"),e.supportsTextureFloat=null!==r.getExtension("OES_texture_float"),e.supportsColorBufferFloat=null!==r.getExtension("WEBGL_color_buffer_float")&&null!==r.getExtension("EXT_float_blend")}return e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),e.version=function(){if(void 0===typeof WebGL2RenderingContext)return!1;const e=document.createElement("canvas");return!!e&&!!Object(i.a)(e,{},"webgl2")}()?2:1,e}()),n}},function(e,t,r){"use strict";var i=r(102),n=r(2),s=r(12),a=r(643),o=r(154),l=r(7),c=r(11),u=r(270),d=r(52),h=r(83),p=r(16),f=r(20),b=r(3),m=r(5),g=r(36),y=r(22),v=r(21),O=r(168),j=r(452),_=r(51),w=r(140),x=r(127),S=r(91),T=(r(113),r(396)),C=r(255),M=r(100),P=r(50),A=r(144);function E(e){const t=[["position",e.indices]],r=[["position",{size:3,data:e.attributeData.position,exclusive:!0}]];return Object(n.j)(e.attributeData.color)&&(r.push(["color",{size:4,data:e.attributeData.color,exclusive:!0}]),t.push(["color",new Uint32Array(e.indices.length)])),Object(n.j)(e.attributeData.uvMapSpace)&&(r.push(["uvMapSpace",{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push(["uvMapSpace",e.indices])),Object(n.j)(e.attributeData.boundingRect)&&(r.push(["boundingRect",{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push(["boundingRect",e.indices])),Object(n.j)(e.attributeData.mapPosition)&&(r.push(["mapPos",{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push(["mapPos",e.indices])),new M.a(r,t)}function R(e){const t=[["position",e.indices],["uv0",e.indices]],r=[["position",{size:3,data:e.attributeData.position,exclusive:!0}],["uv0",{size:2,data:e.attributeData.uv0,exclusive:!0}]];return Object(n.j)(e.attributeData.mapPosition)&&(r.push(["mapPos",{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push(["mapPos",e.indices])),new M.a(r,t)}function I(e){switch(e.type){case"extent":if(e instanceof P.a)return A.a.fromExtent(e);break;case"polygon":return e}return null}function D(e,t,r,i){const n=Object(T.a)(e.rings,e.hasZ,1),s=new Float64Array(n.position.length),a=Object(_.c)(n.position,e.spatialReference,0,s,0,n.position,0,n.position.length/3,t,r,i),o=null!=a;return{position:n.position,mapPosition:s,polygons:k(n.polygons,n.position,s),outlines:L(n.outlines,n.position,s),projectionSuccess:o,sampledElevation:a}}function F(e,t){const r=Object(T.a)(e.rings,!1,1),i=Object(g.q)(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=C.a;return{position:r.position,polygons:k(r.polygons,r.position),outlines:L(r.outlines,r.position),projectionSuccess:i}}function L(e,t,r){const i=new Array;for(const{index:n,count:s}of e){if(s<=1)continue;const e=3*n,a=e+3*s;i.push({index:n,count:s,position:t.subarray(e,a),mapPosition:r?r.subarray(e,a):void 0})}return i}function k(e,t,r){const i=new Array;for(const{index:n,count:s,holeIndices:a,pathLengths:o}of e){if(s<=1)continue;const e=3*n,l=e+3*s,c=a.map((e=>e-n));i.push({index:n,count:s,holeIndices:c,pathLengths:o,position:t.subarray(e,l),mapPosition:r?r.subarray(e,l):void 0})}return i}var z=r(382),V=r(70),N=r(148),U=r(149),B=r(199);const G=["polygon","extent"];class q extends x.a{constructor(e,t,r,i){super(e,t,r,i),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Object(S.k)(this._getSymbolSize());if(e)throw new c.a("graphics3dextrudesymbollayer:invalid-size",e)}const e=Object(n.h)(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e),r=Object(m.f)(t),i=t[3],s=i<1||this.needsDrivenTransparentPass,a={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:i,transparent:s,cullFace:s?0:2,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new B.a(a),this._bottomMaterial=new B.a({...a,cullFace:2}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,G,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t,new w.a);return this._createAs3DShape(t,e.renderingInfo,r,i,t.uid)}layerOpacityChanged(e,t){const r=Object(n.h)(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass;this._material.setParameterValues({opacity:i,transparent:s}),this._bottomMaterial.setParameterValues({opacity:i,transparent:s});const a=this._getLayerOpacity();return e.forEach((e=>{const r=t(e);Object(n.j)(r)&&r.layerOpacityChanged(a,this._context.isAsync)})),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,_.g)}slicePlaneEnabledChanged(e,t){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),e.forEach((e=>{const r=t(e);Object(n.j)(r)&&r.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){return this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(e){let t;var r;return t=e.size&&this._drivenProperties.size?null!=(r=Object(j.a)(e.size,2))?r:0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}_getSymbolSize(){var e;return null!=(e=this.symbolLayer.size)?e:1}_createAs3DShape(e,t,r,i,s){const a=I(e.geometry);if(Object(n.i)(a))return null;const l=D(a,this._context.elevationProvider,this._context.renderCoordsHelper,i);if(this._logGeometryCreationWarnings(l,a.rings,"rings","ExtrudeSymbol3DLayer"),0===a.rings.length||!a.rings.some((e=>e.length>0)))return null;const c=Object(S.a)(a);if(Object(n.i)(c))return null;const b=new Array,j=new Array,w=new Array,x=Object(y.h)(),T=Object(f.d)(),C=Object(m.e)(),M=1===this._context.renderCoordsHelper.viewingMode;M||this._context.renderCoordsHelper.worldUpAtPosition(null,C),Object(g.d)(a.spatialReference,[c.x,c.y,0],T,this._context.renderCoordsHelper.spatialReference);const P=Object(f.d)();Object(p.a)(P,T);const A=Object(h.b)();Object(d.a)(A,P);const{polygons:E,mapPosition:R,position:F}=l,L=F.length/3,k=new Float64Array(3*L*6),V=new Float64Array(3*L*6),N=new Float64Array(3*L*6),B=new Float64Array(1*L*6);let G=0;for(let n=0;n<E.length;++n){const e=E[n],i=e.count;if(this._context.clippingExtent&&(Object(y.k)(x),Object(y.n)(x,e.mapPosition),!Object(y.w)(x,this._context.clippingExtent)))continue;const s=Object(u.a)(e.mapPosition,e.holeIndices,3);if(0===s.length)continue;const a=3*i*2+s.length,o=new Uint32Array(a),l=new Uint32Array(s.length),c=6*i,d=3*k.BYTES_PER_ELEMENT,h=new v.v(k.buffer,G*d,d,(G+c)*d),p=3*V.BYTES_PER_ELEMENT,m=new v.v(V.buffer,G*p,p,(G+c)*p),g=new Float64Array(N.buffer,3*G*N.BYTES_PER_ELEMENT,3*c),_=new Float64Array(B.buffer,1*G*B.BYTES_PER_ELEMENT,1*c),S=this._getExtrusionSize(t);H(F,R,s,e,h.typedBuffer,g,m.typedBuffer,_,0,o,l,S,C,M),Object(O.e)(h,h,P),Object(O.a)(m,m,A),G+=6*i;const T=this._createExtrudeGeometry(o,o.length-l.length,{positions:h.typedBuffer,elevation:g,normals:m.typedBuffer,heights:_},r);b.push(T),j.push(this._material),w.push(f.a);const I=this._createExtrudeGeometry(l,0,{positions:h.typedBuffer,elevation:g,normals:m.typedBuffer,heights:_},r);b.push(I),j.push(this._bottomMaterial),w.push(f.a)}if(0===b.length)return null;const q=new U.a({geometries:b,materials:j,transformations:w,metadata:{layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0}});q.transformation=T;const W=re,$=Object(z.a)(this.symbolLayer,{opacity:this._getLayerOpacity()}),Q=Object(n.j)($)?{baseMaterial:this._material,edgeMaterials:[$],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,Z=new o.a(this,q,b,null,null,W,i,Q);return Z.alignedSampledElevation=l.sampledElevation,Z.needsElevationUpdates=Object(_.g)(i.mode),Z}_createExtrudeGeometry(e,t,r,i){const n=new Uint32Array(e.length),s=[["position",{size:3,data:r.positions,exclusive:!0}],["normal",{size:3,data:r.normals,exclusive:!0}],["color",{size:4,data:i,exclusive:!0}],["size",{size:1,data:r.heights,exclusive:!0}]],a=[["position",e],["normal",e],["color",n]];return r.elevation&&(s.push(["mapPos",{size:3,data:r.elevation}]),a.push(["mapPos",e])),new M.a(s,a,0,t)}}function H(e,t,r,i,n,s,a,o,l,c,u,d,h,p){const f=r.length/3;let m=0,g=2*i.count;(function(e,t,r,i,n,s,a,o,l,c,u,d,h,p,f,m,g,y){Object(b.m)(ne,g);const v=m>0?1:-1;let O=3*r,j=d,_=3*j,w=d+i,x=3*w;for(let C=0;C<i;++C)y&&(ne[0]=e[O+0],ne[1]=e[O+1],ne[2]=e[O+2],Object(b.t)(ne,ne)),o[_+0]=e[O+0],o[_+1]=e[O+1],o[_+2]=e[O+2],l[_+0]=t[O+0],l[_+1]=t[O+1],l[_+2]=t[O+2],c[_+0]=-v*ne[0],c[_+1]=-v*ne[1],c[_+2]=-v*ne[2],u[j]=0,o[x+0]=e[O+0]+m*ne[0],o[x+1]=e[O+1]+m*ne[1],o[x+2]=e[O+2]+m*ne[2],l[x+0]=t[O+0],l[x+1]=t[O+1],l[x+2]=t[O+2],c[x+0]=v*ne[0],c[x+1]=v*ne[1],c[x+2]=v*ne[2],u[w]=m,_+=3,x+=3,O+=3,j+=1,w+=1;O=3*s,_=0,x=3*f;const S=m<0?ae:se,T=m<0?se:ae;for(let b=0;b<a;++b)p[_+0]=n[O+S[0]],p[_+1]=n[O+S[1]],p[_+2]=n[O+S[2]],h[x+0]=n[O+T[0]]+i,h[x+1]=n[O+T[1]]+i,h[x+2]=n[O+T[2]]+i,_+=3,x+=3,O+=3})(e,t,i.index,i.count,r,0,f,n,s,a,o,l,c,u,g,d,h,p),l+=2*i.count,g=0,Q(n,s,o,a,m,i.pathLengths[0],i.count,l,c,g,d),l+=4*i.pathLengths[0],g+=2*i.pathLengths[0],m+=i.pathLengths[0];for(let b=1;b<i.pathLengths.length;++b)Q(n,s,o,a,m,i.pathLengths[b],i.count,l,c,g,d),l+=4*i.pathLengths[b],g+=2*i.pathLengths[b],m+=i.pathLengths[b]}function W(e,t,r,i,n,s,a){i[s]=i[a],a*=3,e[0+(s*=3)]=e[a+0],e[s+1]=e[a+1],e[s+2]=e[a+2],t[s+0]=t[a+0],t[s+1]=t[a+1],t[s+2]=t[a+2],r[s+0]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const $=Object(m.e)();function Q(e,t,r,i,n,s,a,o,l,c,u){let d=n,h=n+1,p=n+a,f=n+a+1,b=o,m=o+1,g=o+2*s,y=o+2*s+1;u<0&&(d=n+a+1,f=n),c*=3;for(let v=0;v<s;++v)v===s-1&&(u>0?(h=n,f=n+a):(h=n,d=n+a)),ee(e,d,h,p,$),W(e,t,i,r,$,b,d),W(e,t,i,r,$,m,h),W(e,t,i,r,$,g,p),W(e,t,i,r,$,y,f),l[c++]=b,l[c++]=g,l[c++]=y,l[c++]=b,l[c++]=y,l[c++]=m,d++,h++,p++,f++,b+=2,m+=2,g+=2,y+=2}const Z=Object(m.e)(),X=Object(m.e)(),J=Object(m.e)(),Y=Object(m.e)(),K=Object(m.e)();function ee(e,t,r,i,n){t*=3,r*=3,i*=3,Object(b.y)(Z,e[t++],e[t++],e[t++]),Object(b.y)(X,e[r++],e[r++],e[r++]),Object(b.y)(J,e[i++],e[i++],e[i++]),Object(b.l)(Y,X,Z),Object(b.l)(K,J,Z),Object(b.i)(n,K,Y),Object(b.t)(n,n)}const te=Object(m.e)();function re(e,t,r,i){const n=e.stageObject,s=n.geometryRecords,a=s.length,o="absolute-height"!==t.mode;let l=0;const c=n.transformation,u=Object(p.a)(Object(f.d)(),c);for(let d=0;d<a;d+=2){const e=s[d].geometry,a=e.getMutableAttribute("position").data,h=e.vertexAttributes.get("size").data,p=e.vertexAttributes.get("mapPos").data,f=new N.a(p),m=a.length/3;let g=0,y=!1,v=0;const O=r.spatialReference;for(let n=0;n<m;n++){te[0]=a[g],te[1]=a[g+1],te[2]=a[g+2];const e=Object(_.e)(f,r,t,i,o?le:null);o&&(v+=le.sampledElevation),V.a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(Object(b.y)(ie,f.array[f.offset+0],f.array[f.offset+1],e+h[g/3]),i.toRenderCoords(ie,O,ie),Object(b.s)(ie,ie,u)):(Object(b.y)(ie,a[g+0],a[g+1],a[g+2]),Object(b.s)(ie,ie,c),i.setAltitude(ie,e+h[g/3]),Object(b.s)(ie,ie,u)),a[g]=ie[0],a[g+1]=ie[1],a[g+2]=ie[2];const n=oe/i.unitInMeters;(Math.abs(te[0]-a[g])>=n||Math.abs(te[1]-a[g+1])>=n||Math.abs(te[2]-a[g+2])>=n)&&(y=!0),f.offset+=3,g+=3}y&&(e.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(d),s[d+1].geometry.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(d+1)),l+=v/m}return l/a}const ie=Object(m.e)(),ne=Object(m.e)(),se=[0,2,1],ae=[0,1,2],oe=.01,le={verticalDistanceToGround:0,sampledElevation:0};var ce=r(35),ue=(r(86),r(8)),de=r(17),he=r(25),pe=r(27),fe=r(40),be=r(31),me=r(139),ge=r(480),ye=r(256),ve=r(593),Oe=r(460),je=r(188),_e=r(28);const we=Object(_e.k)(),xe=Object(y.h)(),Se=Object(m.e)();var Te=class{constructor(e,t,r){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this._layerView=null,this.isElevationSource=!1}initialize(e,t,r){this.stage=e,this._layerView=r,this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);if(e||this._addedToStage){for(const e of this.renderGeometries)e.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}}}destroy(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=Object(m.e)()){return Object(b.y)(e,0,0,0)}getBoundingBoxObjectSpace(e=Object(y.h)()){return Object(y.k)(e)}addObjectState(e,t){0===e&&(this.renderGeometries.forEach((e=>{const r=e.addHighlight();t.addRenderGeometry(e,r,this)})),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))}removeObjectState(e){this.renderGeometries.forEach((t=>{e.removeRenderGeometry(t)}))}removeRenderGeometryObjectState(e,t){e.removeHighlight(t),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.computeAttachmentOrigin(Se)&&(e.draped.origin[0]+=Se[0],e.draped.origin[1]+=Se[1],e.draped.num++)}async getProjectedBoundingBox(e,t,r,i,s){Object(y.k)(s);for(let n=0;n<this.renderGeometries.length;n++){const t=this.renderGeometries[n];this._getRenderGeometryProjectedBoundingRect(t,e,we,r),Object(y.q)(s,we)}if(t){let e;Object(y.e)(s,Se);const r=Object(S.d)(s,t);try{e=await t.service.queryElevation(Se[0],Se[1],i,r,"ground")}catch(a){}Object(n.j)(e)&&(s[2]=Math.min(s[2],e),s[5]=Math.max(s[5],e))}return s}_getRenderGeometryProjectedBoundingRect(e,t,r,i){if(this.boundingBox)Object(y.B)(xe,this.boundingBox);else{const t=e.boundingSphere,r=t[3];xe[0]=t[0]-r,xe[1]=t[1]-r,xe[2]=t[2]-r,xe[3]=t[0]+r,xe[4]=t[1]+r,xe[5]=t[2]+r}return t(xe,0,2),this.calculateRelativeScreenBounds&&i.push({location:Object(y.e)(xe),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Object(y.F)(xe,r)}},Ce=r(175),Me=r(33);function Pe(e,t){const r=e,i=new Uint8Array(4*r*r),n=r/2-.5,s=t/2;for(let a=0;a<r;a++)for(let t=0;t<r;t++){const o=t+r*a,l=t-n,c=a-n;let u=Math.sqrt(l*l+c*c)-s;u=u/e+.5,Object(Me.i)(u,i,4*o)}return i}function Ae(e,t){return Fe(e,t,!1)}function Ee(e,t){return Fe(e,t,!0)}function Re(e,t){return Le(e,t,!1)}function Ie(e,t){return Le(e,t,!0)}function De(e,t){const r=new Uint8Array(4*e*e),i=-.5,n=Math.sqrt(1.25),s=(e-t)/2;for(let a=0;a<e;a++)for(let o=0;o<e;o++){const l=a*e+o,c=(o-s)/t,u=(a-s+.75)/t,d=-(1*c+i*u)/n,h=(1*(c-1)+i*-u)/n,p=-u,f=Math.max(d,h,p);Object(Me.i)(f*t/e+.5,r,4*l)}return r}function Fe(e,t,r){r&&(t/=Math.SQRT2);const i=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let s=0;s<e;s++){let a=s-.5*e+.25,o=.5*e-n-.75;const l=n*e+s;if(r){const e=(a+o)/Math.SQRT2;o=(o-a)/Math.SQRT2,a=e}let c=Math.max(Math.abs(a),Math.abs(o))-.5*t;c=c/e+.5,Object(Me.i)(c,i,4*l)}return i}function Le(e,t,r){r&&(t*=Math.SQRT2);const i=.5*t,n=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let t=0;t<e;t++){let a=t-.5*e,o=.5*e-s-1;const l=s*e+t;if(r){const e=(a+o)/Math.SQRT2;o=(o-a)/Math.SQRT2,a=e}let c;a=Math.abs(a),o=Math.abs(o),c=a>o?a>i?Math.sqrt((a-i)*(a-i)+o*o):o:o>i?Math.sqrt(a*a+(o-i)*(o-i)):a,c=c/e+.5,Object(Me.i)(c,n,4*l)}return n}var ke,ze=r(10),Ve=r(301);function Ne(e){return null!=e}function Ue(e){return"number"==typeof e}function Be(e){return"string"==typeof e}function Ge(e,t){e&&e.push(t)}function qe(e,t,r,i,n){const s=e.minSize,a=e.maxSize;if(e.expression)return Ge(n,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const e=i.symbolSize[r];return t.minSize[r]=e,t.maxSize[r]=e,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(Ne(e.field))return Ne(e.stops)?2===e.stops.length&&Ue(e.stops[0].size)&&Ue(e.stops[1].size)?(He(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(Ge(n,"Could not convert size info: stops only supported with 2 elements"),!1):Ue(s)&&Ue(a)&&Ne(e.minDataValue)&&Ne(e.maxDataValue)?(He(s,a,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):null!=Ve.a[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/Ve.a[e.valueUnit],t.type[r]=1,!0):"unknown"===e.valueUnit?(Ge(n,"Could not convert size info: proportional size not supported"),!1):(Ge(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!Ne(e.field)){if(e.stops&&e.stops[0]&&Ue(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(Ue(s))return t.minSize[r]=s,t.maxSize[r]=s,t.offset[r]=s,t.factor[r]=0,t.type[r]=1,!0}return Ge(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function He(e,t,r,i,n,s){const a=Math.abs(i-r)>0?(t-e)/(i-r):0;n.minSize[s]=a>0?e:t,n.maxSize[s]=a>0?t:e,n.offset[s]=e-r*a,n.factor[s]=a}function We(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return Ge(i,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||Be(e)}(e.field))return Ge(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return Ge(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};let n;switch(e.axis){case"width":return n=qe(e,t.size,0,r,i),n?t:null;case"height":return n=qe(e,t.size,2,r,i),n?t:null;case"depth":return n=qe(e,t.size,1,r,i),n?t:null;case"width-and-depth":return n=qe(e,t.size,0,r,i),n&&qe(e,t.size,1,r,i),n?t:null;case null:case void 0:case"all":return n=qe(e,t.size,0,r,i),n=n&&qe(e,t.size,1,r,i),n=n&&qe(e,t.size,2,r,i),n?t:null;default:return Ge(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}function $e(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function Qe(e,t,r){const i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function Ze(e,t,r){if(!e)return null;const i=!t.supportedTypes||!!t.supportedTypes.size,n=!t.supportedTypes||!!t.supportedTypes.color,s=!t.supportedTypes||!!t.supportedTypes.rotation,a=!!t.supportedTypes&&!!t.supportedTypes.opacity,o=e.reduce(((e,o)=>{if(!e)return e;if(o.valueExpression)return Ge(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(o.type){case"size":return i?We(o,e,t,r):e;case"color":return n?function(e,t,r){if(e.normalizationField)return Ge(r,"Could not convert color info: unsupported property"),null;if(Be(e.field)){if(!e.stops)return Ge(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return Ge(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.color.values[e]=r.value,$e(t.color.colors,e,r.color)}}}else{if(!(e.stops&&e.stops.length>=0))return Ge(r,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,$e(t.color.colors,e,r)}}return t}(o,e,r):e;case"opacity":return a?function(e,t,r){if(e.normalizationField)return Ge(r,"Could not convert opacity info: unsupported property"),null;if(Be(e.field)){if(!e.stops)return Ge(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return Ge(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.opacity.values[e]=r.value,t.opacity.opacityValues[e]=r.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return Ge(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}(o,e,r):null;case"rotation":return s?function(e,t,r){if(!Be(e.field))return Ge(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return Ge(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return Qe(e,t.rotation,0),t;case"roll":return Qe(e,t.rotation,1),t;case null:case void 0:case"heading":return Qe(e,t.rotation,2),t;default:return Ge(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(o,e,r):e;default:return null}}),{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&o)||o.size||o.color||o.opacity||o.rotation?o&&o.size&&!function(e,t,r){for(let n=0;n<3;++n){let r=t.unitInMeters;1===e.type[n]&&(r*=t.modelSize[n],e.type[n]=2),e.minSize[n]=e.minSize[n]/r,e.maxSize[n]=e.maxSize[n]/r,e.offset[n]=e.offset[n]/r,e.factor[n]=e.factor[n]/r}let i;if(0!==e.type[0])i=0;else if(0!==e.type[1])i=1;else{if(0===e.type[2])return Ge(r,"No size axis contains a valid size or scale"),!1;i=2}for(let n=0;n<3;++n)0===e.type[n]&&(e.minSize[n]=e.minSize[i],e.maxSize[n]=e.maxSize[i],e.offset[n]=e.offset[i],e.factor[n]=e.factor[i],e.type[n]=e.type[i]);return!0}(o.size,t,r)?null:o:null}function Xe(e){return e&&null!=e.size}function Je(e,t){if(!e)return{enabled:!1};if(V.a.DISABLE_FAST_UPDATES)return{enabled:!1};const r=Ze(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:et(r,t),requiresShaderTransformation:Xe(r)}:{enabled:!1}}function Ye(e,t,r){if(!t||!e.enabled)return!1;const i=e.visualVariables,n=Ze(t.visualVariables,r);return!!n&&!!(Ke(i.size,n.size,"size")&&Ke(i.color,n.color,"color")&&Ke(i.rotation,n.rotation,"rotation")&&Ke(i.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=et(n,r),e.requiresShaderTransformation=Xe(n),!0)}function Ke(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t.field)return!1;if(e&&"rotation"===r){const r=e,i=t;for(let e=0;e<3;e++)if(r.type[e]!==i.type[e]||r.offset[e]!==i.offset[e]||r.factor[e]!==i.factor[e])return!1}return!0}function et(e,t){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=Xe(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&i&&(r.vvSizeValue=t.transformation.scale),e&&i&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=Object(h.b)(),Object(p.i)(tt),function(e,t,r,i=Object(f.d)()){const n=e||0,s=t||0,a=r||0;0!==n&&Object(p.r)(i,i,-n/180*Math.PI),0!==s&&Object(p.b)(i,i,s/180*Math.PI),0!==a&&Object(p.j)(i,i,a/180*Math.PI)}(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],tt),Object(d.f)(r.vvSymbolRotationMatrix,tt)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}!function(e){const t=Object(f.d)(),r=Object(m.e)();e.evaluateModelTransform=function(e,i,n){if(!e.vvSizeEnabled)return n;Object(p.d)(t,n);const s=e.vvSymbolRotationMatrix;Object(p.h)(tt,s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1),Object(p.m)(t,t,tt);for(let t=0;t<3;++t){const n=e.vvSizeOffset[t]+i[0]*e.vvSizeFactor[t];r[t]=Object(ze.e)(n,e.vvSizeMinSize[t],e.vvSizeMaxSize[t])}return Object(p.s)(t,t,r),Object(p.t)(t,t,e.vvSymbolAnchor),t},e.evaluateModelTransformScale=function(e,t,r){if(!t.vvSizeEnabled)return Object(b.y)(e,1,1,1);for(let i=0;i<3;++i){const n=t.vvSizeOffset[i]+r[0]*t.vvSizeFactor[i];e[i]=Object(ze.e)(n,t.vvSizeMinSize[i],t.vvSizeMaxSize[i])}return e}}(ke||(ke={}));const tt=Object(f.d)(),rt=ke.evaluateModelTransform,it=ke.evaluateModelTransformScale;var nt=r(160),st=r(248),at=r(193),ot=r(282),lt=r(277);const ct=Object(f.d)(),ut=Object(m.g)(0,0,1),dt=128,ht=.5,pt=[.25,.25,.75,.75],ft=[64,64];class bt extends x.a{constructor(e,t,r,i){super(e,t,r,i),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._texture=null,this._releaseTexture=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),r=this._getPrimitive();if(Object(n.j)(r))this._prepareResourcesPrimitive(t,r);else{const r=Object(ye.f)(this.symbol,this.symbolLayer),i=Object(he.i)(r);i&&"application/json"===i.mediaType?await this._prepareResourcesCIM(t,JSON.parse(i.data),e):await this._prepareResourcesHref(t,r,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=Object(S.k)(this._getIconSize());if(e)throw new c.a("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?Object(de.g)(e.size):16);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){const t=this._getGraphicHash(e);let r=""===t?null:this._cimSymbolTextures.get(t);if(!r){const i={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,e,"esriGeometryPoint",i,null,null);this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",n.anchorPosition);const s={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:2};r=new at.a(n.imageData,s),this._cimSymbolTextures.set(t,r),this._context.stage.add(r)}return r}_computeSize(e,t){const r=e.width/e.height;return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]}_prepareMaterialParameters(){const e={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(function(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}(t)){const{screenLength:r,minWorldLength:i,maxWorldLength:n}=t.verticalOffset;e.verticalOffset={screenLength:Object(de.g)(r),minWorldLength:i||0,maxWorldLength:null!=n?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const r=this._getOutlineSize();if(mt(t)&&0===r)throw new Error("Nothing to render");this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;const i=this._context.sharedResources.textures.fromData(t,(()=>function(e){let t;const r=dt,i=r*ht;switch(e){case"circle":t=Pe(r,i);break;case"square":t=Ae(r,i);break;case"kite":t=Ee(r,i);break;case"cross":t=Re(r,i);break;case"x":t=Ie(r,i);break;case"triangle":t=De(r,i)}return new at.a(t,{mipmap:!1,wrap:{s:33071,t:33071},width:dt,height:dt,components:4,noUnpackFlip:!0})}(t)));this._texture=i.texture,this._releaseTexture=()=>this._context.sharedResources.textures.release(i.uid),e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=pt,e.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=2,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,t,r){if(!Object(ue.a)("esri-canvas-svg-support")&&Object(he.x)(t))throw new c.a("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),a=n*this._context.layerView.view.pixelRatio,o=await Object(i.d)(this._context.sharedResources.textures.fromUrl(t,a,{signal:r}));if(!1===o.ok)throw Object(s.w)(o.error),new c.a("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${t})`);const{uid:l,texture:u}=o.value;this._releaseTexture=()=>this._context.sharedResources.textures.release(l);const d=u.params;this._size=this._computeSize(d,n),e.textureId=u.id,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,i){const n=new lt.a({data:t});if(!this._context.sharedResources.cimSymbolRasterizer){const e=(await Promise.all([r.e(6),r.e(25)]).then(r.bind(null,974))).CIMSymbolRasterizer;Object(s.x)(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference,!0))}const a=this._context.layer.fields?this._context.layer.fields.map((e=>e.toJSON())):null;let o,l;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(n,a,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(isNaN(e.scaleExpression)){const t=e.scaleExpression,r=await Object(me.d)(t,this._context.layer.spatialReference,a);l=(e,t,i)=>{const n=Object(ve.a)(r,e,{$view:i},"esriGeometryPoint",t);return null!==n?n:1}}else o=Number(e.scaleExpression)}this._cimScaleFactorOrFunction=o||l||1;const c=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Object(s.x)(i);const u=this._context.layer.fieldsIndex;this._cimRequiredFields=c.map((e=>u.get(e).name)),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||ge.b}_getOutlineSize(){let e=0;const t=this.symbolLayer;return Object(n.j)(t.outline)&&null!=t.outline.size?Math.max(Object(de.g)(t.outline.size),0):(e=mt(this._getPrimitive())?1.5:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),t=this.symbolLayer,r=Object(n.h)(t,"outline","color");if(Object(n.j)(r)){const t=ce.a.toUnitRGB(r),i=r.a*e;return[t[0],t[1],t[2],i]}return[0,0,0,0]}_getFillColor(){if(mt(this._getPrimitive()))return Oe.b;const e=Object(n.i)(this._getPrimitive()),t=Object(n.h)(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getAnchorPos(e,t){return"relative"===e?Object(pe.f)((t.x||0)+.5,.5-(t.y||0)):e in S.h?S.h[e]:S.h.center}_createMaterialAndAddToStage(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=Je(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let r=this._cimSymbolMaterials.get(e.textureId);return r||(r=new ot.a(e),this._cimSymbolMaterials.set(e.textureId,r),t.add(r)),r}return this._material=new ot.a(e),t.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial((e=>{e.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:this.draped})})),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial((e=>this._context.stage.remove(e))),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((e=>this._context.stage.remove(e))),this._cimSymbolTextures.clear(),this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let t=0;t<3;t++){const r=e.size[t];r&&"symbol-value"!==r&&"proportional"!==r&&(e.size[t]=Object(de.g)(r))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let r,i;if(this._cimLayers){if(!this._cimLayers.length)return null;const e=this._generateTextureCIM(t),n={textureId:e.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(n,this._context.stage),r=[e.params.width,e.params.height]}else r=this._size,i=Object(n.s)(this._material);const s=Object(Ce.c)(t.geometry);if(Object(n.i)(s))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const a=e.renderingInfo,o=this._getVertexOpacityAndColor(a);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const e=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(a,e)}l*=this._symbolTextureRatio;const c=[r[0]*l,r[1]*l],u=this.setGraphicElevationContext(t,new w.a);return this.ensureDrapedStatus("on-the-ground"===u.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,s,i,o,c,e.layer.uid):this._createAs3DShape(t,s,i,o,c,u,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();return this._forEachMaterial((r=>{r.setParameterValues({color:e}),r.setParameterValues({outlineColor:t})})),!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(_.d)(bt.elevationModeChangeTypes,r,i);if(n!==_.a.UPDATE)return n;const s=Object(_.f)(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial((e=>{e.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(e,t){for(const r in e.diff)switch(r){case"visualVariables":if(!Ye(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;Object(n.j)(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0}_defaultElevationInfoNoZ(){return gt}_createAs3DShape(e,t,r,i,n,s,a){const l=this.getFastUpdateAttrValues(e),c=l?e=>rt(this._fastUpdates.materialParameters,l,e):null,u=[nt.a.createPointGeometry(ut,null,i,n,yt,null,l)],d=Object(Ce.a)(this._context,t,u,[r],null,null,s,this._context.layer.uid,a,c);if(null===d)return null;const h=je.b,p=new o.a(this,d.object,u,null,null,h,s);return p.alignedSampledElevation=d.sampledElevation,p.needsElevationUpdates=Object(_.f)(s.mode)||"absolute-height"===s.mode,p.getScreenSize=this._createScreenSizeGetter(n,c),p.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(p.getScreenSize(),1,e),Object(Ce.b)(p,t,this._context.elevationProvider),p}_createAsOverlay(e,t,r,i,s,a){r.renderPriority=this._renderPriority;const o=Object(be.e)();Object(g.u)(t,o,this._context.overlaySR),o[2]=C.a;const l=this._context.clippingExtent;if(Object(n.j)(l)&&!Object(y.g)(l,o))return null;const c=this.getFastUpdateAttrValues(e),u=c?e=>rt(this._fastUpdates.materialParameters,c,e):null,d=nt.a.createPointGeometry(ut,o,i,s,null,null,c),h=new st.a(d,r,a,e.uid);o[3]=0,Object(fe.c)(h.boundingSphere,o),h.calculateShaderTransformation=u;const p=new Te(this,[h],null);return p.getScreenSize=this._createScreenSizeGetter(s,u),p.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(p.getScreenSize(),1,e),p}_createScreenSizeGetter(e,t){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const i=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(e=Object(pe.b)())=>{const s=t(ct);return e[0]=s[0]*i+r,e[1]=s[5]*n+r,e}}{const t=e[0]/this._symbolTextureRatio+r,i=e[1]/this._symbolTextureRatio+r;return(e=Object(pe.b)())=>(e[0]=t,e[1]=i,e)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=Object(m.g)(e,e,e),r=Object(de.h)(1),i=e*r;return{modelSize:t,symbolSize:Object(m.g)(i,i,i),unitInMeters:r,transformation:{anchor:m.b,scale:m.a,rotation:m.b}}}_getGraphicHash(e){let t="";for(const r of this._cimRequiredFields)t+=r+e.attributes[r];return t}_forEachMaterial(e){Object(n.j)(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}}function mt(e){return!!Object(n.j)(e)&&("cross"===e||"x"===e)}bt.PRIMITIVE_SIZE=ft,bt.elevationModeChangeTypes={definedChanged:_.a.UPDATE,staysOnTheGround:_.a.NONE,onTheGroundChanged:_.a.RECREATE};const gt={mode:"relative-to-ground",offset:0},yt=Object(be.g)(0,0,0,1);var vt=r(344),Ot=r(461),jt=r(341);const _t=["polyline","polygon","extent"];class wt extends x.a{constructor(e,t,r,i){super(e,t,r,i),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=Je(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const e=null!=this.symbolLayer.size?this.symbolLayer.size:Object(de.h)(1);if(e<0)throw new c.a("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=e}}getMaterialParameters(e){const t=Object(n.h)(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t),i=r[3],s={width:1,color:r,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:i<1||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:this.symbolLayer.stipplePattern?Object(Ot.a)(this.symbolLayer.stipplePattern.map(de.g)):null,stippleOffColor:this.symbolLayer.stippleOffColor?ce.a.toUnitRGBA(this.symbolLayer.stippleOffColor):null,stippleIntegerRepeats:!0};if(this._drivenProperties.size)this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(s.width=Object(de.g)(1));else{const e=null!=this.symbolLayer.size?this.symbolLayer.size:Object(de.h)(1);s.width=Object(de.g)(e)}return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get lineMaterial(){return Object(n.i)(this._lineMaterial)&&(this._lineMaterial=new jt.a(this.getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return Object(n.i)(this._ringMaterial)&&(this._ringMaterial=new jt.a(this.getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}destroy(){super.destroy(),this._context.stage.remove(this._lineMaterial),this._lineMaterial=null,this._context.stage.remove(this._ringMaterial),this._ringMaterial=null}getDrivenSize(e){return this._drivenProperties.size&&e.size?Object(de.g)(Object(j.b)(e.size)):1}getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Object(x.b)(this._fastUpdates.visualVariables.size.field,e):null}getDrivenColor(e){const t=Object(be.g)(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Object(x.b)(this._fastUpdates.visualVariables.color.field,e):null}getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Object(x.b)(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,_t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new w.a);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}applyRendererDiff(e,t){for(const r in e.diff)switch(r){case"visualVariables":if(!Ye(this._fastUpdates,t,this._vvConvertOptions))return!1;Object(n.j)(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),Object(n.j)(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0}layerOpacityChanged(){return Object(n.j)(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial),Object(n.j)(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial),!0}updateMaterialLayerOpacity(e){const t=e.params.color,r=Object(n.h)(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass,a=[t[0],t[1],t[2],i];e.setParameterValues({color:a,transparent:s})}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(_.d)(wt.elevationModeChangeTypes,r,i);if(n!==_.a.UPDATE)return n;const s=Object(_.f)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){return Object(n.j)(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),Object(n.j)(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof P.a)return A.a.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,t,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),a="polygon"===s.type?s.rings:s.paths,l=new Array,c=new Array,u=new Array,d=Object(y.h)(),h=Object(vt.b)(s,this._context.elevationProvider,this._context.renderCoordsHelper,t),p="polygon"===s.type?"rings":"paths";this._logGeometryCreationWarnings(h,a,p,"LineSymbol3DLayer");for(let o=0;o<h.lines.length;o++){const{position:t,mapPosition:r}=h.lines[o];if(Object(n.j)(this._context.clippingExtent)&&(Object(y.k)(d),Object(y.n)(d,r),!Object(y.w)(d,this._context.clippingExtent)))continue;const i=this._createGeometry(e,t,r,s.type);l.push(i),c.push("polygon"===s.type?this.ringMaterial:this.lineMaterial),u.push(f.a)}if(0===l.length)return null;const b=new U.a({geometries:l,materials:c,transformations:u,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),m=new o.a(this,b,l,null,null,je.c,t);return m.alignedSampledElevation=h.sampledElevation,m.needsElevationUpdates=Object(_.f)(t.mode),m}_createGeometry(e,t,r,i){const n="polygon"===i?1:0,s=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return Object(vt.a)({removeDuplicateStartEnd:n,uniformSize:this._uniformSize,attributeData:{position:t,mapPosition:r,size:a?null:this.getDrivenSize(e.renderingInfo),color:s?null:this.getDrivenColor(e.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(e.graphic),colorFeature:this.getColorFeatureAttributeData(e.graphic),opacityFeature:this.getOpacityFeatureAttributeData(e.graphic)}})}_createAsOverlay(e,t){const r=e.graphic,i=this._getGeometryAsPolygonOrPolyline(r.geometry),n="polygon"===i.type?i.rings:i.paths,s="polygon"===i.type?this.ringMaterial:this.lineMaterial;s.renderPriority=this._renderPriority;const a=new Array,o=Object(y.h)(),l=Object(y.k)(),c=Object(vt.c)(i,this._context.overlaySR),u="polygon"===i.type?"rings":"paths";this._logGeometryCreationWarnings(c,n,u,"LineSymbol3DLayer");for(const d of c.lines){if(Object(y.k)(o),Object(y.n)(o,d.position),!Object(y.w)(o,this._context.clippingExtent))continue;Object(y.m)(l,o);const n=this._createGeometry(e,d.position,null,i.type),c=new st.a(n,s,t,r.uid);Object(fe.l)(c.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),a.push(c)}return new Te(this,a,l)}}wt.elevationModeChangeTypes={definedChanged:_.a.RECREATE,staysOnTheGround:_.a.NONE,onTheGroundChanged:_.a.RECREATE};var xt=r(594),St=r(474),Tt=r(380),Ct=r(191),Mt=r(420),Pt=r(136),At=r(363);const Et=["mesh"];class Rt extends x.a{constructor(e,t,r,i){super(e,t,r,i),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){V.a.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new At.a({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new At.a({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),(e=>e.material))),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Et,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(t,new w.a),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}layerOpacityChanged(e,t){const r=this._getLayerOpacity();return this._materials.forEach((e=>{e.material.setParameterValues({layerOpacity:r});const t=e.material.params;this._setMaterialTransparentParameter(t,e),e.material.setParameterValues({transparent:t.transparent})})),e.forEach((e=>{const i=t(e);Object(n.j)(i)&&i.layerOpacityChanged(r,this._context.isAsync)})),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,_.g)}slicePlaneEnabledChanged(e,t){return this._materials.forEach((e=>{e.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})})),e.forEach((e=>{const r=t(e);Object(n.j)(r)&&r.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach((t=>t.material.setParameterValues({usePBR:e}))),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return Object(n.i)(e)?"-":e instanceof ce.a?e.toHex():e.contentHash}_materialPropertiesDefault(e,t){const r=this._requiresSymbolVertexColors(),i=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:i,hasVertexTangents:n,uid:`vc:${i},vt:${n},vct${t},svc:${r}`}}_materialProperties(e,t,r){const i=this._materialPropertiesDefault(e,r);if(!t.material)return i;const{color:n,colorTexture:s,normalTexture:a,doubleSided:o,alphaCutoff:l,alphaMode:c}=t.material,u=this._colorOrTextureUid(n),d=this._colorOrTextureUid(s),h=this._colorOrTextureUid(a);if(i.color=n,i.colorTexture=s,i.normalTexture=a,i.uid=`${i.uid},cmuid:${u},ctmuid:${d},ntmuid:${h},ds:${o},ac:${l},am:${c}`,t.material instanceof St.a){const{metallic:e,roughness:r,metallicRoughnessTexture:n,emissiveColor:s,emissiveTexture:a,occlusionTexture:o}=t.material,l=this._colorOrTextureUid(n),c=this._colorOrTextureUid(s),u=this._colorOrTextureUid(a),d=this._colorOrTextureUid(o);i.metallic=e,i.roughness=r,i.metallicRoughnessTexture=n,i.emissiveColor=s,i.emissiveTexture=a,i.occlusionTexture=o,i.uid=`${i.uid},mrm:${e},mrr:${r},mrt:${l},emuid:${c},etmuid:${u},otmuid:${d}`}return i}_setInternalColorValueParameters(e,t){t.diffuse=ce.a.toUnitRGB(e),t.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const t=this._getLoadableTextureResource(e);if(!t)return;const r=e.contentHash;let i=this._textures.get(r);return i||(i=new at.a(t,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!0}),this._textures.set(r,i),this._context.stage.add(i)),i.id}_castTextureWrap(e="repeat"){if("string"==typeof e){const t=this._castTextureWrapIndividual(e);return{s:t,t:t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return 33071;case"mirror":return 33648;case"repeat":default:return 10497}}_setInternalMaterialParameters(e,t){Object(n.j)(e.color)&&this._setInternalColorValueParameters(e.color,t),Object(n.j)(e.colorTexture)&&(t.textureId=this._getInternalTextureId(e.colorTexture)),Object(n.j)(e.normalTexture)&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),Object(n.j)(e.emissiveColor)&&(t.emissiveFactor=ce.a.toUnitRGB(e.emissiveColor)),Object(n.j)(e.emissiveTexture)&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),Object(n.j)(e.occlusionTexture)&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),Object(n.j)(e.metallicRoughnessTexture)&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture))}_setExternalMaterialParameters(e){const t=this._drivenProperties.color;let r=Object(n.j)(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(t)e.externalColor=be.a;else{const t=Object(n.j)(this.symbolLayer.material)?this.symbolLayer.material.color:null;Object(n.j)(t)?e.externalColor=ce.a.toUnitRGBA(t):(r=null,e.externalColor=be.a)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const t=e.vertexAttributes.color;if(Object(n.i)(t))return!1;for(let r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1}_getOrCreateMaterial(e,t){const r=t.material&&t.material.color,i=t.material&&t.material.colorTexture,s=t.material&&"blend"===t.material.alphaMode,a=!(t.material&&"opaque"===t.material.alphaMode)&&(this._hasTransparentVertexColors(e)||Object(n.j)(r)&&r.a<1||Object(n.j)(i)&&i.transparent||s),o=this._materialProperties(e,t,a),l=this._materials.get(o.uid);if(l)return l.material;const c={material:null,isComponentTransparent:a,alphaMode:t.material?t.material.alphaMode:"opaque"},u=null==o.metallicRoughnessTexture&&null==o.metallic&&null==o.roughness,d={usePBR:this._usePBR(),isSchematic:u,vertexColors:o.hasVertexColors,symbolColors:o.hasSymbolVertexColors,vertexTangents:o.hasVertexTangents,ambient:m.b,diffuse:m.a,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,textureAlphaPremultiplied:!0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};u||(d.mrrFactors=[null!=o.metallic?o.metallic:1,null!=o.roughness?o.roughness:1,.5]),t.material&&(d.doubleSided=t.material.doubleSided,d.cullFace=t.material.doubleSided?0:2,d.textureAlphaCutoff=t.material.alphaCutoff),this._setInternalMaterialParameters(o,d),this._setExternalMaterialParameters(d),this._setMaterialTransparentParameter(d,c);const h=new B.a(d);return c.material=h,this._materials.set(o.uid,c),this._context.stage.add(h),h}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?3:1:e.textureAlphaMode="opaque"===t.alphaMode?1:"mask"===t.alphaMode?2:0}_addDebugNormals(e,t,r,i){const n=t.length,s=e.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],l=[],c=[],u=[];for(let p=0;p<n;p++){const e=t[p],r=e.vertexAttributes.get("position"),i=e.vertexAttributes.get("normal"),n=e.indices.get("position"),s=e.indices.get("normal"),d=r.data,h=i.data;for(let t=0;t<n.length;t++){const e=3*n[t],r=3*s[t];for(let t=0;t<3;t++)o.push(d[e+t]);for(let t=0;t<3;t++)o.push(d[e+t]+h[r+t]*a);if(l.push(l.length),l.push(l.length),t%3==0){this._calculateFaceNormal(d,n,t,kt),this._getFaceVertices(d,n,t,Dt,Ft,Lt),Object(b.h)(Dt,Dt,Ft),Object(b.h)(Dt,Dt,Lt),Object(b.g)(Dt,Dt,1/3);for(let e=0;e<3;e++)c.push(Dt[e]);for(let e=0;e<3;e++)c.push(Dt[e]+kt[e]*a);u.push(u.length),u.push(u.length)}}}const d=new M.a([["position",{data:o,size:3,exclusive:!0}]],[["position",new Uint32Array(l)]],2);t.push(d),r.push(this._debugVertexNormalMaterial),i.push(Object(f.c)(i[0]));const h=new M.a([["position",{data:c,size:3,exclusive:!0}]],[["position",new Uint32Array(u)]],2);t.push(h),r.push(this._debugFaceNormalMaterial),i.push(Object(f.c)(i[0]))}_createAs3DShape(e,t,r,i){const s=e.geometry;if("mesh"!==s.type)return null;const a=this._createGeometryInfo(s,t);if(!a)return null;const{geometries:l,materials:c,transformations:u,objectTransformation:d}=a;V.a.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,l,c,u);const h=new U.a({geometries:l,materials:c,transformations:u,metadata:{layerUid:this._context.layer.uid,graphicUid:i}});h.transformation=d;const p=je.b,f=this._createEdgeMaterial(),b=Object(n.j)(f)?{baseMaterial:c[0],edgeMaterials:[f],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,m=new o.a(this,h,l,null,null,p,r,b);return m.needsElevationUpdates=Object(_.g)(r.mode),m.useObjectOriginAsAttachmentOrigin=!0,m.elevationContext.centerPointInElevationSR=this.getCenterPointInElevationSR(h),m.alignedSampledElevation=p(m,m.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),m}getCenterPointInElevationSR(e){const t=Object(Ct.j)(0,0,0,this._context.elevationProvider.spatialReference);return Object(g.x)([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}_createComponentNormals(e,t,r,i){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(e,t,r,i);case"flat":return this._createComponentNormalsFlat(e,i);case"smooth":return this._createComponentNormalsSmooth(e,i);default:return}}_createComponentNormalsSource(e,t,r,i){if(Object(n.i)(t))return this._createComponentNormalsFlat(e,i);let s=!1;if(!r.trustSourceNormals)for(let n=0;n<i.length;n+=3){this._calculateFaceNormal(e,i,n,kt);for(let e=0;e<3;e++){const r=3*i[n+e];Dt[0]=t[r+0],Dt[1]=t[r+1],Dt[2]=t[r+2],Object(b.j)(kt,Dt)<0&&(t[r+0]=-t[r+0],t[r+1]=-t[r+1],t[r+2]=-t[r+2],s=!0)}}return{normals:t,indices:i,didFlipNormals:s}}_createComponentNormalsFlat(e,t){const r=new Float32Array(t.length),i=new Uint32Array(3*t.length);for(let n=0;n<t.length;n+=3){const s=this._calculateFaceNormal(e,t,n,kt);for(let e=0;e<3;e++)r[n+e]=s[e],i[n+e]=n/3}return{normals:r,indices:i,didFlipNormals:!1}}_createComponentNormalsSmooth(e,t){const r={};for(let s=0;s<t.length;s+=3){const i=this._calculateFaceNormal(e,t,s,kt);for(let e=0;e<3;e++){const n=t[s+e];let a=r[n];a||(a={normal:Object(m.e)(),count:0},r[n]=a),Object(b.h)(a.normal,a.normal,i),a.count++}}const i=new Float32Array(3*t.length),n=new Uint32Array(3*t.length);for(let s=0;s<t.length;s++){const e=r[t[s]];1!==e.count&&(Object(b.t)(e.normal,e.normal),e.count=1);for(let t=0;t<3;t++)i[3*s+t]=e.normal[t];n[s]=s}return{normals:i,indices:n,didFlipNormals:!1}}_getFaceVertices(e,t,r,i,n,s){const a=3*t[r+0],o=3*t[r+1],l=3*t[r+2];i[0]=e[a+0],i[1]=e[a+1],i[2]=e[a+2],n[0]=e[o+0],n[1]=e[o+1],n[2]=e[o+2],s[0]=e[l+0],s[1]=e[l+1],s[2]=e[l+2]}_calculateFaceNormal(e,t,r,i){return this._getFaceVertices(e,t,r,Dt,Ft,Lt),Object(b.l)(Ft,Ft,Dt),Object(b.l)(Lt,Lt,Dt),Object(b.i)(Dt,Ft,Lt),Object(b.t)(i,Dt),i}_getOrCreateComponents(e){return e.components?e.components:Ut}_createPositionBuffer(e,t){let r=e.vertexAttributes.position;const i=1===t.reprojection?t.transformBeforeProject:null;if(Object(n.j)(i)&&(r=Object(Tt.h)(r,new Float64Array(r.length),i)),0===t.reprojection)return t.needsBufferCopy?new Float64Array(r):r;const s=Object(n.j)(i)?r:new Float64Array(r.length);return Object(g.q)(r,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,r.length/3),s}_createNormalBuffer(e,t,r){let i=e.vertexAttributes.normal;if(Object(n.i)(i))return null;const s=1===r.reprojection?r.transformBeforeProject:null;if(Object(n.j)(s)&&(i=Object(Tt.g)(i,new Float32Array(i.length),s)),"local"===this._context.layerView.view.viewingMode||0===r.reprojection)return r.needsBufferCopy&&e.vertexAttributes.normal===i?new Float32Array(i):i;const a=e.vertexAttributes.position,o=Object(n.j)(s)?i:new Float32Array(i.length);return Object(Tt.c)(i,a,t,e.spatialReference,o)}_createTangentBuffer(e,t,r){let i=e.vertexAttributes.tangent;if(Object(n.i)(i))return null;const s=1===r.reprojection?r.transformBeforeProject:null;if(Object(n.j)(s)&&(i=Object(Tt.i)(i,new Float32Array(i.length),s)),"local"===this._context.layerView.view.viewingMode||0===r.reprojection)return r.needsBufferCopy&&e.vertexAttributes.normal===i?new Float32Array(i):i;const a=e.vertexAttributes.position,o=Object(n.j)(s)?i:new Float32Array(i.length);return Object(Tt.e)(i,a,t,e.spatialReference,o)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),r=Object(Mt.b)(Object(n.h)(this.symbolLayer,"material","colorMixMode")),i=new Uint8Array(4);return Object(Mt.a)(t,r,i),i}return null}_createBuffers(e,t){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const i=e.vertexAttributes.normal,s=e.vertexAttributes.uv,a=e.vertexAttributes.tangent;if(Object(n.j)(i)&&i.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(n.j)(a)&&a.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(n.j)(s)&&s.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const o=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,o),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(t),d=this._createNormalBuffer(e,l,o),h=this._createTangentBuffer(e,l,o);return{positionBuffer:l,normalBuffer:d,tangentBuffer:h,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:0===o.reprojection&&Object(n.j)(o.objectTransformation)?o.objectTransformation:this._transformOriginLocal(e,l,d,h),geometryTransformation:0===o.reprojection&&Object(n.j)(o.geometryTransformation)?o.geometryTransformation:Object(f.d)()}}_computeReprojectionInfo(e){const t=Object(n.j)(e.transform)&&e.transform.geographic||2===this._context.renderCoordsHelper.viewingMode?0:1;let r=null;if(Object(n.j)(e.transform)){if(0===t){const r=Object(f.d)();return Object(g.d)(e.spatialReference,e.transform.origin,r,this._context.renderCoordsHelper.spatialReference),{reprojection:t,objectTransformation:r,geometryTransformation:Object(f.c)(e.transform.localMatrix),needsBufferCopy:!1}}return r=Object(p.q)(Object(f.d)(),e.transform.origin),Object(p.m)(r,r,e.transform.localMatrix),{reprojection:t,transformBeforeProject:r,needsBufferCopy:!0}}return{reprojection:t,needsBufferCopy:!0}}_transformOriginLocal(e,t,r,i){const s=this._context.renderCoordsHelper.spatialReference,a=e.anchor;It[0]=a.x,It[1]=a.y,It[2]=a.z;const o=Object(f.d)();Object(g.d)(e.spatialReference,It,o,s);const l=v.v.fromTypedArray(t);if(Object(p.a)(zt,o),Object(O.e)(l,l,zt),Object(n.j)(r)||Object(n.j)(i)){if(Object(d.f)(Vt,o),Object(d.n)(Vt,Vt),Object(n.j)(r)){const e=v.u.fromTypedArray(r);Object(O.a)(e,e,Vt)}if(Object(n.j)(i)){const e=v.u.fromTypedArray(i,4*i.BYTES_PER_ELEMENT);Object(O.a)(e,e,Vt)}}return o}_validateFaces(e,t){const r=e.vertexAttributes.position.length/3,i=t.faces;if(i){let e=-1;for(let t=0;t<i.length;t++){const r=i[t];r>e&&(e=r)}if(r<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,t){return t.faces?t.faces:Object(Pt.d)(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;const r=this._context.elevationProvider.spatialReference;let i;const n=t.length/3;return e.spatialReference.equals(r)?i=t:(i=new Float64Array(t.length),Object(g.q)(e.vertexAttributes.position,e.spatialReference,0,i,r,0,n)),Object(y.k)(Nt),Object(y.n)(Nt,i,0,n),!Object(y.w)(Nt,this._context.clippingExtent)}_createGeometryInfo(e,t){if(!Object(g.b)(e.spatialReference,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const r=this._createBuffers(e,t);if(Object(n.i)(r))return null;const{positionBuffer:i,uvBuffer:s,colorBuffer:a,symbolColorBuffer:o,normalBuffer:l,tangentBuffer:c,objectTransformation:u,geometryTransformation:d}=r,h=this._getOrCreateComponents(e),p=[],f=[],b=[];let m=!1;for(const g of h){if(!this._validateFaces(e,g))return null;const t=this._getOrCreateFaces(e,g);if(0===t.length)continue;const r=this._createComponentNormals(i,l,g,t);r.didFlipNormals&&(m=!0);const u=[["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:r.normals,exclusive:!0}]],h=[["position",t],["normal",r.indices]];Object(n.j)(a)&&(u.push(["color",{size:4,data:a,exclusive:!0}]),h.push(["color",t])),Object(n.j)(o)&&(u.push(["symbolColor",{size:4,data:o,exclusive:!0}]),h.push(["symbolColor",new Uint16Array(t.length)])),Object(n.j)(s)&&(u.push(["uv0",{size:2,data:s,exclusive:!0}]),h.push(["uv0",t])),Object(n.j)(c)&&(u.push(["tangent",{size:4,data:c,exclusive:!0}]),h.push(["tangent",t]));const y=new M.a(u,h);p.push(y),f.push(d),b.push(this._getOrCreateMaterial(e,g))}return m&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:p,transformations:f,materials:b,objectTransformation:u}}_createEdgeMaterial(){const e={opacity:this._getLayerOpacity()};return Object(z.a)(this.symbolLayer,e)}}const It=Object(m.e)(),Dt=Object(m.e)(),Ft=Object(m.e)(),Lt=Object(m.e)(),kt=Object(m.e)(),zt=Object(f.d)(),Vt=Object(h.b)(),Nt=Object(y.h)(),Ut=[new xt.a];var Bt=r(388),Gt=r(438),qt=r(223),Ht=r(352);const Wt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$t=Object(m.e)(),Qt=Object(m.e)(),Zt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Xt=Object(f.d)();var Jt=class{constructor(e,t,r,i){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=r,this.elevationContext=i,this.type="lod-instance",this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const t=this.lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}destroy(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,t,r){if(this.elevationAligner){Object(qt.g)(this.elevationContext.featureExpressionInfoContext,r);const i=this.elevationAligner(this,this.elevationContext,e,t);null!=i&&(this.alignedSampledElevation=i)}}getCenterObjectSpace(e=Object(m.e)()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Xt),Object(b.s)(e,this.lodRenderer.baseBoundingSphere.center,Xt)}getBoundingBoxObjectSpace(e=Object(y.h)()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Xt);const t=this.lodRenderer.baseBoundingBox;Object(y.k)(e);for(let r=0;r<8;++r)Object(b.y)($t,0==(1&r)?t[0]:t[3],0==(2&r)?t[1]:t[4],0==(4&r)?t[2]:t[5]),Object(b.s)($t,$t,Xt),Object(y.r)(e,$t);return e}computeAttachmentOrigin(e){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Xt),e.render.origin[0]+=Xt[12],e.render.origin[1]+=Xt[13],e.render.origin[2]+=Xt[14],e.render.num++}async getProjectedBoundingBox(e,t,r,i,s){const a=this.getBoundingBoxObjectSpace(s),o=Zt,l=Object(y.x)(a)?1:o.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Xt);for(let n=0;n<l;n++){const e=o[n];$t[0]=a[e[0]],$t[1]=a[e[1]],$t[2]=a[e[2]],Object(b.s)($t,$t,Xt),Wt[3*n+0]=$t[0],Wt[3*n+1]=$t[1],Wt[3*n+2]=$t[2]}if(!e(Wt,0,l))return null;Object(y.k)(a);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let n=0;n<3*l;n+=3){for(let e=0;e<3;e++)a[e]=Math.min(a[e],Wt[n+e]),a[e+3]=Math.max(a[e+3],Wt[n+e]);c&&r.push({location:Wt.slice(n,n+3),screenSpaceBoundingRect:c})}if(t&&(Object(y.e)(a,Qt),"absolute-height"!==this.elevationContext.mode)){let e;const r=Object(S.d)(a,t);try{e=await t.service.queryElevation(Qt[0],Qt[1],i,r,"ground")}catch(u){}Object(n.j)(e)&&Object(y.z)(a,0,0,-this.alignedSampledElevation+e)}return a}addObjectState(e,t){if(0===e){const r=new Ht.a(e);this.addHighlightId(r),t.addExternal((e=>{this.removeHighlightId(e)}),r)}}removeObjectState(e){this.highlights&&this.highlights.forEach((t=>e.remove(t)))}addHighlightId(e){this.highlights=this.highlights||new Set,this.highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}removeHighlightId(e){this.highlights&&(this.highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this.highlights.size>0),0===this.highlights.size&&(this.highlights=null))}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}},Yt=r(240);function Kt(e){e.levels.forEach((e=>{e.minScreenSpaceRadius||(e.minScreenSpaceRadius=function(e,t=er){const r=Object(Yt.a)(e);return Math.sqrt(r/(t*Math.PI))}(e))}))}const er=.05;var tr,rr,ir=r(645),nr=r(433),sr=r(273),ar=r(129),or=r(96),lr=r(72),cr=r(62),ur=r(68),dr=r(67),hr=r(94);(rr=tr||(tr={}))[rr.ALLOCATED=1]="ALLOCATED",rr[rr.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",rr[rr.VISIBLE=4]="VISIBLE",rr[rr.HIGHLIGHT=8]="HIGHLIGHT",rr[rr.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",rr[rr.REMOVE=32]="REMOVE",rr[rr.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",rr[rr.ACTIVE=18]="ACTIVE";class pr{constructor(e){this.localTransform=e.getField("localTransform",v.i),this.globalTransform=e.getField("globalTransform",v.i),this.modelOrigin=e.getField("modelOrigin",v.v),this.model=e.getField("model",v.f),this.modelNormal=e.getField("modelNormal",v.f),this.modelScaleFactors=e.getField("modelScaleFactors",v.m),this.boundingSphere=e.getField("boundingSphere",v.D),this.color=e.getField("color",v.C),this.featureAttribute=e.getField("featureAttribute",v.C),this.state=e.getField("state",v.l),this.lodLevel=e.getField("lodLevel",v.l)}}class fr extends ur.a{constructor(e,t){super(),this._capacity=0,this._size=0,this._next=0,this._layout=function(e){let t=Object(hr.a)().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");return e.indexOf("color")>=0&&(t=t.vec4f("color")),e.indexOf("featureAttribute")>=0&&(t=t.vec4f("featureAttribute")),t=t.u8("state").u8("lodLevel").alignTo(8),t}(e),this._shaderTransformation=t}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this.grow();const e=this.findSlot();return this._view.state.set(e,tr.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e}removeInstance(e){const t=this._view.state;Object(Me.a)(e>=0&&e<this._capacity&&t.get(e)&tr.ALLOCATED,"invalid instance handle"),this.getStateFlag(e,tr.ACTIVE)?this.setStateFlags(e,tr.REMOVE):this.freeInstance(e),this.emit("instance-removed",{index:e})}freeInstance(e){const t=this._view.state;Object(Me.a)(e>=0&&e<this._capacity&&t.get(e)&tr.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,r=!0){this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,r=!0){this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=gr,i=yr;t.localTransform.getMat(e,vr),t.globalTransform.getMat(e,Or);const n=Object(p.m)(Or,Or,vr);Object(b.y)(r,n[12],n[13],n[14]),t.modelOrigin.setVec(e,r),Object(d.f)(i,n),t.model.setMat(e,i);const s=Object(dr.l)(gr,n);s.sort(),t.modelScaleFactors.set(e,0,s[1]),t.modelScaleFactors.set(e,1,s[2]),Object(d.e)(i,i),Object(d.n)(i,i),t.modelNormal.setMat(e,i),this.setStateFlags(e,tr.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,yr),r.modelOrigin.getVec(e,gr),t[0]=yr[0],t[1]=yr[1],t[2]=yr[2],t[3]=0,t[4]=yr[3],t[5]=yr[4],t[6]=yr[5],t[7]=0,t[8]=yr[6],t[9]=yr[7],t[10]=yr[8],t[11]=0,t[12]=gr[0],t[13]=gr[1],t[14]=gr[2],t[15]=1}applyShaderTransformation(e,t){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){return this._view.localTransform.getMat(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(gr,this,e);t*=Math.max(r[0],r[1],r[2])}return t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(gr,this,e);r.sort(),t*=r[1]}return t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}getColor(e,t){this._view.color.getVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this.setStateFlag(e,tr.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this.getStateFlag(e,tr.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this.setStateFlag(e,tr.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))}getHighlight(e){return this.getStateFlag(e,tr.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}setStateFlag(e,t,r){r?this.setStateFlags(e,t):this.clearStateFlags(e,t)}getStateFlag(e,t){return!!(this._view.state.get(e)&t)}grow(){const e=Math.max(br,Math.floor(this._capacity*mr)),t=this._layout.createBuffer(e);if(this._buffer){const e=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(e)}this._capacity=e,this._buffer=t,this._view=new pr(this._buffer)}findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&tr.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t}}const br=1024,mr=2,gr=Object(m.e)(),yr=Object(h.b)(),vr=Object(f.d)(),Or=Object(f.d)();var jr=r(55),_r=r(517);class wr extends _r.a{constructor(e,t){super((e=>Object(jr.m)(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere))),{maximumDepth:25}),this._tmpSphere=Object(jr.c)(),this._tmpMat4=Object(f.d)(),this._instanceData=e,this._boundingSphere=t}addInstance(e){const t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Object(b.s)(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*Object(dr.i)(r),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}}class xr{constructor(e,t){this.thresholdScale=1,this._camera=new lr.a,this._worldSpaceRadius=e,this._thresholds=t.map((e=>e))}updateCamera(e){this._camera.copyFrom(e)}selectLevel(e,t){const r=this._camera.computeScreenPixelSizeAt(e),i=this._worldSpaceRadius*t/r,n=this._thresholds;let s=-1;for(let a=0;a<n.length;++a)i>=n[a]*this.thresholdScale&&(s=a);return s}}var Sr=r(233),Tr=r(123),Cr=r(66),Mr=r(90);class Pr{constructor(e,t){const r=e.renderContext.rctx,i=t.geometry,n=t.material;this.materialRep=e.materialRep,n.setParameterValues({instancedDoublePrecision:!0});const s=n.createBufferWriter(),a=s.vertexBufferLayout,o=s.elementCount(i),l=s.allocate(o);s.write({},i,l,0),this.geometry=i,this.material=n,this.glMaterials=Object(Tr.a)(n,this.materialRep),this.vertexBufferLayout=a,this.vbo=Cr.a.createVertex(r,35044,l.buffer),this.vao=new Mr.a(r,cr.a,{geometry:Object(ar.a)(a)},{geometry:this.vbo}),this.vertexCount=o}destroy(){Object(Tr.f)(this.material,this.materialRep),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,r,i,n,s){const a=this.geometry.id,o=n.toString();this.material.intersect(this.geometry,null,e.transform.transform,e,r,i,((r,i,l,c)=>{if(r>=0){if(null!=t&&!t(e.rayBeginPoint,e.rayEndPoint,r))return;const u={type:"external",metadata:{layerUid:s.layerUid,graphicUid:s.graphicUid(n)}};if((null==e.results.min.drapedLayerOrder||c>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&(e.results.min.set(u,o,r,i,e.transform.transform,c,null,a,l),e.results.min.intersector="LodRenderer"),0!==e.options.store&&(null==e.results.max.drapedLayerOrder||c>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&(e.results.max.set(u,o,r,i,e.transform.transform,c,null,a,l),e.results.min.intersector="LodRenderer"),2===e.options.store){const t=new Sr.a(e.results.min.ray);t.set(u,o,r,i,e.transform.transform,c,null,a,l),t.intersector="LodRenderer",e.results.all.push(t)}}}))}}class Ar{constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}static async create(e,t,r){const i=await Promise.all(t.components.map((t=>e.schedule((()=>new Pr(e,t)),r))));return new Ar(t.minScreenSpaceRadius,i)}destroy(){this.components.forEach((e=>{e.destroy()}))}intersect(e,t,r,i,n,s){this.components.forEach((a=>{a.intersect(e,t,r,i,n,s)}))}get boundingBox(){if(!this._boundingBox){const e=Object(y.k)();this.components.forEach((t=>{Object(n.j)(t.boundingInfo)&&(Object(y.r)(e,t.boundingInfo.bbMin),Object(y.r)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(!this._boundingSphere){const e=this.boundingBox,t=Object(m.e)();Object(y.e)(e,t),this._boundingSphere={center:t,radius:.5*Object(y.j)(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((e,t)=>e+t.triangleCount),0)}}var Er=class{constructor(e,t,r){this._elementSize=t,this._buffer=Cr.a.createVertex(e,35044),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,t,r,i=0){const n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(this._array,r,r,i)}resize(e){const t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setData(t),this._capacity=e}};class Rr{constructor(e){this.modelOriginHi=e.getField("modelOriginHi",v.u),this.modelOriginLo=e.getField("modelOriginLo",v.u),this.model=e.getField("model",v.f),this.modelNormal=e.getField("modelNormal",v.f),this.color=e.getField("instanceColor",v.C),this.featureAttribute=e.getField("instanceFeatureAttribute",v.C)}}class Ir{constructor(e,t){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=t,this._elementSize=t.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){Object(Me.a)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Object(Me.a)(this._updating,"not updating"),this.size<Lr*this.capacity&&this.shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Object(Me.a)(this._updating,"not updating"),this.isFull&&this.grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this.incrementHead(),Object(Me.a)(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Object(Me.a)(this._updating,"not updating"),Object(Me.a)(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this.incrementTail(),e&&(this._firstIndex=this._tailIndex)}grow(){const e=Math.max(Dr,Math.floor(this._capacity*Fr));this.resize(e)}shrink(){const e=Math.max(Dr,Math.floor(this._capacity*kr));this.resize(e)}resize(e){if(Object(Me.a)(this._updating,"not updating"),e===this._capacity)return;const t=new Er(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,r=this.compactInstances(t);Object(Me.a)(r===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=r,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Rr(this._instanceBufferLayout.createView(this._buffer.array))}compactInstances(e){const t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}const Dr=1024,Fr=2,Lr=.3,kr=.5;var zr=r(88),Vr=r(78);let Nr=function(e){const t=e.baseBoundingSphere.radius,r=e.levels.map((e=>e.minScreenSpaceRadius));return new xr(t,r)};class Ur{constructor(e,t,r,i){this.type="Lod",this.isGround=!1,this._inverseViewport=Object(pe.b)(),this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new lr.a,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.canRender=!0,this._symbol=e,this._optionalFields=t,this._metadata=r,this._instanceBufferLayout=B.a.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:t}),this._glInstanceBufferLayout=Object(ar.a)(this._instanceBufferLayout,1),this._instanceData=new fr(this._optionalFields,i),this._instanceData.on("instance-added",(()=>{this.requestUpdateCycle()})),this._instanceData.on("instance-removed",(()=>{this.requestUpdateCycle()})),this._instanceData.on("instance-transform-changed",(e=>{this.requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(e.index)})),this._instanceData.on("instance-visibility-changed",(e=>{this.requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(e.index)})),this._instanceData.on("instance-highlight-changed",(()=>{this.requestUpdateCycle(!0)})),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlane(){return this._slicePlane}set slicePlane(e){this._slicePlane=e}get intersectionHandlerId(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach((t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),this._highlightRenderInstanceData.forEach((t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,r)=>{const i=this._defaultRenderInstanceData[r],n=this._highlightRenderInstanceData[r],s=i.size+n.size,a=e.triangleCount;t.push({renderedInstances:s,renderedTriangles:s*a,trianglesPerInstance:a})})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}async initializeRenderContext(e,t){this._context=e;const r=e.renderContext.rctx;this._levels=await Object(s.b)(this._symbol.levels.map((i=>(this._defaultRenderInstanceData.push(new Ir(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new Ir(r,this._instanceBufferLayout)),Ar.create(e,i,t))))),this._levelSelector=Nr(this)}uninitializeRenderContext(){this.invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData.forEach((e=>e.destroy())),this._highlightRenderInstanceData.forEach((e=>e.destroy()))}get slots(){return[4,6]}get needsHighlight(){return this._highlightRenderInstanceData.reduce(((e,t)=>e+t.size),0)>0}prepareRender(e,t){if(V.a.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const e=t.equals(this._lastCamera);this._lastCamera.copyFrom(t),e||this.requestUpdateCycle()}const r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this.updateInstances(t,r),this.needsUpdates&&this._context.requestRender()}render(e){const t=e.rctx,r=4===e.slot?3:6===e.slot?5:null;if(!r)return;if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(e.pass))return!1;const i=e.camera;this._inverseViewport[0]=1/i.fullViewport[2],this._inverseViewport[1]=1/i.fullViewport[3];const n={slot:r,origin:[0,0,0],camera:i,inverseViewport:this._inverseViewport,shadowMap:e.shadowMap,shadowMappingEnabled:e.shadowMap.enabled,ssaoHelper:e.ssaoHelper,ssaoEnabled:e.ssaoHelper.enabled,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:e.sliceHelper&&e.sliceHelper.plane,hudVisibilityTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:e.scenelightingData,transparencyPassType:e.transparencyPassType,terrainLinearDepthTexture:e.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:e.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:e.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:e.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:e.multipassGeometryParams.multipassGeometryEnabled,highlightColorTexture:null};t.bindVAO();const s=5!==e.pass&&7!==e.pass,a=6!==e.pass;return s&&this._renderComponents(e,r,n,this._defaultRenderInstanceData),a&&this._renderComponents(e,r,n,this._highlightRenderInstanceData),!0}intersect(e,t,r,i){if(!this.baseMaterial.isVisible())return;const n=Object(m.e)();Object(b.l)(n,i,r);const s=n=>{this._instanceData.getCombinedModelTransform(n,Hr),e.transform.set(Hr),Object(b.s)(Wr,r,e.transform.inverse),Object(b.s)($r,i,e.transform.inverse);const s=this._instanceData.getState(n),a=this._instanceData.getLodLevel(n);Object(Me.a)(s&tr.ACTIVE,"invalid instance state"),Object(Me.a)(a>=0&&a<this._levels.length,"invaid lod level"),this._levels[a].intersect(e,t,Wr,$r,n,this._metadata)};this.baseMaterial.params.verticalOffset?this.octree.forEach(s):this.octree.forEachAlongRay(r,n,s)}queryDepthRange(e){return this.queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this.invalidateOctree()}requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this.buildOctree()),this._octree}invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}buildOctree(){const e=new wr(this._instanceData,this.baseBoundingSphere),t=this._instanceData,r=t.view?t.view.state:null;for(let i=0;i<this._instanceData.capacity;++i)r.get(i)&tr.ACTIVE&&e.addInstance(i);return e}queryDepthRangeOctree(e){const t=e.eye,r=e.viewForward,i=this.octree.findClosest(r,1,e.frustum),n=this.octree.findClosest(r,-1,e.frustum);if(null!=i&&null!=n){this._instanceData.view.boundingSphere.getVec(i,qr),Object(b.l)(qr,qr,t);const s=Object(b.j)(qr,r)-qr[3];this._instanceData.view.boundingSphere.getVec(n,qr),Object(b.l)(qr,qr,t);const a=Object(b.j)(qr,r)+qr[3];return{near:Math.max(e.near,s),far:Math.min(e.far,a)}}return{near:1/0,far:-1/0}}startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach((e=>{e.startUpdateCylce()})),this._highlightRenderInstanceData.forEach((e=>{e.startUpdateCylce()})),this.needsUpdates&&this._context.requestRender()}updateInstances(e,t){const r=this._enableLevelSelection,i=this._levelSelector;i.updateCamera(e),this._defaultRenderInstanceData.forEach((e=>{e.beginUpdate()})),this._highlightRenderInstanceData.forEach((e=>{e.beginUpdate()}));const n=this._instanceData,s=this._instanceData.view,a=n.size,o=n.capacity;let l=this._instanceIndex;t=Math.min(a,t);for(let c=0;c<t;++c){0===l&&this.startUpdateCycle();const e=s.state.get(l);let a=0;if(!(e&tr.ALLOCATED)){l=(l+1)%o,t++;continue}const c=s.lodLevel.get(l);if(e&tr.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[c].freeTail(),e&tr.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[c].freeTail(),e&tr.REMOVE)n.freeInstance(l);else if(e&tr.VISIBLE){let t=0;r&&(s.modelOrigin.getVec(l,Gr),t=i.selectLevel(Gr,n.getCombinedMedianScaleFactor(l))),a=e&~(tr.ACTIVE|tr.TRANSFORM_CHANGED),t>=0&&(e&tr.HIGHLIGHT?(Br(this._highlightRenderInstanceData[t],s,l),a|=tr.HIGHLIGHT_ACTIVE):(Br(this._defaultRenderInstanceData[t],s,l),a|=tr.DEFAULT_ACTIVE)),s.state.set(l,a),s.lodLevel.set(l,t)}else a=e&~(tr.ACTIVE|tr.TRANSFORM_CHANGED),s.state.set(l,a);if(this._octree){const t=!!(e&tr.ACTIVE),r=!!(a&tr.ACTIVE);!t&&r?this._octree.addInstance(l):t&&!r?this._octree.removeInstance(l):t&&r&&e&tr.TRANSFORM_CHANGED&&(this._octree.removeInstance(l),this._octree.addInstance(l))}l=(l+1)%o}this._instanceIndex=l,this._defaultRenderInstanceData.forEach((e=>{e.endUpdate()})),this._highlightRenderInstanceData.forEach((e=>{e.endUpdate()}))}_renderComponents(e,t,r,i){this.levels.forEach(((n,s)=>{n.components.forEach((n=>{this._renderComponent(e,t,r,i[s],n,s)}))}))}_renderComponent(e,t,r,i,n,s){const a=n.glMaterials.get(e.pass);if(!a||!a.beginSlot(t)||0===i.size)return;const o=e.rctx,l=o.capabilities.instancing;a.ensureParameters(r);const c=a.technique,u=c.program,d=a.getPipelineState(t);o.setPipelineState(d),o.useProgram(u),a.bind(r),o.bindVAO(n.vao),c.ensureAttributeLocations(n.vao),e.isHighlightPass&&Object(or.b)(u,r),c.bindDraw(r,{},{}),V.a.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===e.pass&&(u.setUniform4fv("externalColor",Qr[Math.min(s,Qr.length-1)]),u.setUniform1i("colorMixMode",zr.b.replace));const h=i.capacity,p=i.headIndex,f=i.tailIndex,b=i.firstIndex,m=this._glInstanceBufferLayout,g=(e,t)=>{Object(Vr.a)(o,cr.a,i.buffer,m,e),l.drawArraysInstanced(c.primitiveType,0,n.vertexCount,t-e),Object(Vr.e)(o,cr.a,i.buffer,m)};n.material.params.transparent&&null!=b?p>f?(Object(Me.a)(b>=f&&b<=p,"invalid firstIndex"),g(b,p),g(f,b)):p<f&&(b<=p?(Object(Me.a)(b>=0&&b<=p,"invalid firstIndex"),g(b,p),g(f,h),g(0,b)):(Object(Me.a)(b>=f&&b<=h,"invalid firstIndex"),g(b,h),g(0,p),g(f,b))):p>f?g(f,p):p<f&&(g(0,p),g(f,h)),o.bindVAO(null)}}function Br(e,t,r){const i=e.allocateHead();!function(e,t,r,i){Object(Tr.d)(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}(t,r,e.view,i)}const Gr=Object(m.e)(),qr=Object(be.e)(),Hr=Object(f.d)(),Wr=Object(m.e)(),$r=Object(m.e)(),Qr=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];class Zr extends x.a{constructor(e,t,r,i){super(e,t,r,i),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[e,t,r]=Object(n.j)(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:r}}async doLoad(e){if(!this._drivenProperties.size&&Object(S.k)(this.symbolLayer))throw new Error;const t=this.symbolLayer;if(this.isPrimitive){const r=t.resource?t.resource.primitive:Bt.b;this._resources=await this._createResourcesForPrimitive(r,e)}else this._resources=await this._createResourcesForUrl(t.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return Object(n.j)(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Object(n.h)(this._resources,"lodRenderer")}setMaterialTransparencyParams(e,t=Object(n.h)(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;return e.transparent=i,e.opacity=r,e.cullFace=i?0:2,e}async _createResourcesForPrimitive(e,t){if(!Object(nr.a)(e))throw new Error(`Unknown object symbol primitive: ${e}`);const r=this.symbolLayer,i=Object(y.h)(Object(Gt.a)(e)),s=Object(m.f)(Object(y.E)(i)),a=Object(m.f)(Object(Gt.b)(s,r)),o=Object(b.r)(a),l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:m.a,diffuse:m.a,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},c=l.usePBR;this.setMaterialTransparencyParams(l);const u=this.symbol;if("point-3d"===u.type&&u.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=u.verticalOffset;l.verticalOffset={screenLength:Object(de.g)(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},l.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(l.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)l.externalColor=be.a;else{const e=Object(n.j)(r.material)&&r.material.color,t=Object(n.j)(e)?ce.a.toUnitRGBA(e):be.a;l.externalColor=t}this._fastUpdates=Je(this._context.renderer,this._fastVisualVariableConvertOptions(i,a,s,n.o)),this._fastUpdates.enabled?(Object.assign(l,this._fastUpdates.materialParameters),l.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(l.instanced.push("color"),this._optionalFields.push("color"));const d=new B.a(l),h=Object(nr.b)(e,d);if(!h)throw new Error(`Unknown object symbol primitive: ${e}`);const p=Object(Yt.d)(h).map((e=>({opacity:1,transparent:e.params.transparent}))),f=this._createStageResources(h,c);return{lodResources:h,lodRenderer:await this._createLodRenderer(h,t),stageResources:f,symbolSize:a,extentPadding:o,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:p,physicalBasedRenderingEnabled:c,resourceBoundingBox:i,resourceSize:s,dispose:n.o,pivotOffset:n.o}}async _createResourcesForUrl(e,t){const r=["transformation"],i={materialParamsMixin:{instanced:r,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=Je(this._context.renderer,this._fastVisualVariableConvertOptions(n.o,n.o,n.o,n.o)),this._fastUpdates.enabled?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const s=this.symbol;if("point-3d"===s.type&&s.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=s.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:Object(de.g)(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},i.materialParamsMixin.castShadows=!1}i.signal=t,i.usePBR=this._context.physicalBasedRenderingEnabled;const a=i.usePBR,o=await Object(ir.fetch)(e,i),l=o.isEsriSymbolResource,c=o.isWosr,u=o.remove,d=function(e){return{levels:e.map((e=>function(e){const t=[];return e.stageResources.geometries.forEach(((r,i)=>{const n=e.stageResources.materials[i],s=e.stageResources.textures;t.push({material:n,geometry:r,textures:s})})),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}(e)))}}(o.lods);Kt(d),d.levels.sort(((e,t)=>e.minScreenSpaceRadius-t.minScreenSpaceRadius)),d.levels[0].minScreenSpaceRadius=Math.min(2,d.levels[0].minScreenSpaceRadius);const h=this._context,p=this.symbolLayer.material,f=this._getExternalColorParameters(p),g=Object(n.h)(this.symbolLayer,"material","color"),v=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),O=this.needsDrivenTransparentPass,j=Object(Yt.d)(d),_=Object(Yt.d)(d).map((e=>({opacity:e.params.opacity||1,transparent:e.params.transparent})));j.forEach((e=>{const t=e.params;e.setParameterValues(f);const r=t.opacity*v,i=r<1||O||t.transparent;e.setParameterValues({opacity:r,transparent:i}),h.screenSizePerspectiveEnabled&&e.setParameterValues({screenSizePerspective:h.sharedResources.screenSizePerspectiveSettings})}));const w=o.referenceBoundingBox,x=Object(m.f)(Object(y.E)(w)),S=Object(m.f)(d.levels[0].pivotOffset),T=Object(m.f)(Object(Gt.b)(x,this.symbolLayer)),C=Object(b.r)(T);Ye(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(w,T,x,S))&&j.forEach((e=>e.setParameterValues(this._fastUpdates.materialParameters)));const M=this._createStageResources(d,a);return{lodResources:d,lodRenderer:await this._createLodRenderer(d,t),stageResources:M,symbolSize:T,extentPadding:C,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:_,physicalBasedRenderingEnabled:a,resourceBoundingBox:w,resourceSize:x,dispose:u,pivotOffset:S}}_createStageResources(e,t){const r=this._context.stage,i=Object(Yt.d)(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(i);const n=Object(Yt.e)(e);r.addMany(n);const s=Object(Yt.c)(e);return r.addMany(s),{materials:i,textures:n,geometries:s}}async _createLodRenderer(e,t){const r=this._context.stage,i={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},n=this._fastUpdates.enabled?{applyTransform:(e,t,r)=>{e.getFeatureAttribute(t,Kr),Object(p.d)(r,rt(this._fastUpdates.materialParameters,Kr,r))},scaleFactor:(e,t,r)=>(t.getFeatureAttribute(r,Kr),it(e,this._fastUpdates.materialParameters,Kr))}:null,s=new Ur(e,this._optionalFields,i,n);return s.slicePlane=this._context.slicePlaneEnabled,await r.addRenderPlugin(s.slots,s,t),s}_getExternalColorParameters(e){const t={};return this._drivenProperties.color?t.externalColor=be.a:Object(n.j)(e)&&Object(n.j)(e.color)?t.externalColor=ce.a.toUnitRGBA(e.color):(t.externalColor=be.a,t.colorMixMode="ignore"),t}destroy(){super.destroy();const e=this._context.stage;if(Object(n.j)(this._resources)){e.removeRenderPlugin(this._resources.lodRenderer);const t=this._resources.stageResources;e.removeMany(t.materials),e.removeMany(t.textures),e.removeMany(t.geometries),Object(n.j)(this._resources.dispose)&&this._resources.dispose()}this._resources=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const r=Object(Ce.c)(t.geometry);if(Object(n.i)(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const i=this.setGraphicElevationContext(t,new w.a),s=e.renderingInfo;return this._createAs3DShape(t,r,s,i,t.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(Object(n.i)(this._resources))return!0;const e=this._drivenProperties.opacity,t=!this.isPrimitive,r=this._resources.stageResources.materials,i=this._resources.originalMaterialParameters;for(let s=0;s<r.length;s++){const a=r[s],o=Object(n.h)(this.symbolLayer,"material","color"),l=i[s],c=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*l.opacity,u=c<1||e||l.transparent;a.setParameterValues({opacity:c,transparent:u}),this.isPrimitive&&a.setParameterValues({cullFace:u?0:2})}return!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,_.g)}slicePlaneEnabledChanged(){if(Object(n.i)(this._resources))return!0;this._resources.lodRenderer.slicePlane=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(Object(n.i)(this._resources))return!0;const{stageResources:e,isWosr:t}=this._resources;for(const r of e.materials)this.isPrimitive?r.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||r.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this.hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(e,t){if(Object(n.i)(this._resources))return!0;const{stageResources:{materials:r},lodRenderer:i,resourceBoundingBox:s,symbolSize:a,resourceSize:o,pivotOffset:l}=this._resources;for(const n in e.diff)switch(n){case"visualVariables":if(!Ye(this._fastUpdates,t,this._fastVisualVariableConvertOptions(s,a,o,l)))return!1;for(const e of r)e.setParameterValues(this._fastUpdates.materialParameters);i.notifyShaderTransformationChanged();break;default:return!1}return!0}computeComplexity(){return Object(n.i)(this._resources)?super.computeComplexity():{primitivesPerFeature:Object(Yt.b)(this._resources.lodResources.levels[0]).reduce(((e,t)=>e+t.indices.get("position").length),0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Object(sr.d)(this.symbol,this.symbolLayer)}}hasLodRenderer(){return Object(n.j)(this._resources)}_createAs3DShape(e,t,r,i,s){if(!this.hasLodRenderer()||Object(n.i)(this._resources))return null;const a=this.getFastUpdateAttrValues(e),o=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?Object(S.g)(r.color,r.opacity):null,l=this._context.clippingExtent;if(Object(g.u)(t,Xr,this._context.elevationProvider.spatialReference),Object(n.j)(l)&&!Object(y.g)(l,Xr))return null;const c=this._requiresTerrainElevation(i),u=this._computeGlobalTransform(t,i,Yr,c?ei:null),d=this._computeLocalTransform(this._resources,this.symbolLayer,r,Jr),h=this._resources.lodRenderer.instanceData,p=h.addInstance();this._instanceIndexToGraphicUid.set(p,s),h.setLocalTransform(p,d,!1),h.setGlobalTransform(p,u),a&&h.setFeatureAttribute(p,a),o&&h.setColor(p,o);const f=new Jt(this,p,je.a,i);return c&&(f.alignedSampledElevation=ei.sampledElevation),f.needsElevationUpdates=Object(_.g)(i.mode),Object(Ce.b)(f,t,this._context.elevationProvider),f}_computeGlobalTransform(e,t,r,i){const n=Object(_.e)(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,i);return Xr[0]=e.x,Xr[1]=e.y,Xr[2]=n,Object(g.d)(e.spatialReference,Xr,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,t,r,i){return Object(p.i)(i),this._applyObjectRotation(r,!1,i),this._applyObjectRotation(t,!0,i),this._applyObjectScale(e,r,i),this._applyAnchor(e,t,i),i}_applyObjectScale(e,t,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const i=this._drivenProperties.size&&t.size?t.size:e.symbolSize,n=Object(S.c)(i,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||Object(p.s)(r,r,n)}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(Object(n.i)(this._resources))return!0;const r=t&&Object(Ce.c)(t);if(Object(n.i)(r))return!1;const i=this.getGeometryElevationMode(t);if(e.elevationContext.mode!==i)return!1;const s=this._requiresTerrainElevation(e.elevationContext);return this._computeGlobalTransform(r,e.elevationContext,Yr,s?ei:null),s&&(e.alignedSampledElevation=ei.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Yr,!0),Object(Ce.b)(e,r,this._context.elevationProvider),!0}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(Object(n.i)(this._resources))return;const r=(e,t,r)=>Object(n.t)(null!=e&&"complete"===e.type?e.newValue:t,r),i=r(t.heading,this.symbolLayer.heading,0),s=r(t.tilt,this.symbolLayer.tilt,0),a=r(t.roll,this.symbolLayer.roll,0),o=r(t.width,this.symbolLayer.width,void 0),l=r(t.height,this.symbolLayer.height,void 0),c=r(t.depth,this.symbolLayer.depth,void 0),u=r(t.anchor,this.symbolLayer.anchor,void 0),d=r(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const h={heading:i,tilt:s,roll:a,anchor:u,anchorPosition:d},p=this._resources;1===this.loadStatus&&e.symbolLayerStatePatches.push((()=>{p.symbolSize=Object(m.f)(Object(Gt.b)(p.resourceSize,{width:o,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push(((e,t)=>{const r=this._computeLocalTransform(p,h,t,Jr),i=e.instanceIndex;p.lodRenderer.instanceData.setLocalTransform(i,r,!0)}))}_preparePatchColor(e,t){if(!t.material||"partial"!==t.material.type)return;const r=t.material.diff;if(!r.color||"complete"!==r.color.type||null==r.color.newValue||null==r.color.oldValue)return;const i=r.color.newValue,s=Object(n.j)(i)?ce.a.toUnitRGBA(i):be.a;delete r.color;const a=this._resources;Object(n.i)(a)||e.graphics3DGraphicPatches.push((e=>{let t;this._hasPerInstanceColor()?(a.lodRenderer.instanceData.setColor(e.instanceIndex,s),t=this.setMaterialTransparencyParams({},i)):t=this.setMaterialTransparencyParams({externalColor:s},i);for(const r of a.stageResources.materials)r.setParameterValues(t)}))}_requiresTerrainElevation(e){return"absolute-height"!==e.mode}_applyObjectRotation(e,t,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return Object(S.b)(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,t,r){const i=Object(m.e)();switch(r.anchor){case"center":Object(b.m)(i,Object(y.e)(e)),Object(b.u)(i,i);break;case"top":{const t=Object(y.e)(e);Object(b.y)(i,-t[0],-t[1],-e[5]);break}case"bottom":{const t=Object(y.e)(e);Object(b.y)(i,-t[0],-t[1],-e[2]);break}case"relative":{const t=Object(y.e)(e),n=Object(y.E)(e),s=r.anchorPosition,a=s?Object(m.g)(s.x,s.y,s.z):m.b;Object(b.d)(i,n,a),Object(b.h)(i,i,t),Object(b.u)(i,i);break}case"origin":default:Object(n.j)(t)?Object(b.u)(i,t):Object(b.m)(i,m.b)}return i}_applyAnchor(e,t,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const i=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);i&&Object(p.t)(r,r,i)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,r,i){const s=Object(n.j)(e)?Object(m.f)(Object(y.E)(e)):m.a,a=Object(n.j)(e)?this._computeAnchor(e,i,this.symbolLayer):m.b,o=this._context.renderCoordsHelper.unitInMeters,l=Object(S.c)(Object(n.j)(t)?t:void 0,t,r,o),c=Object(m.g)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:s,symbolSize:Object(n.j)(t)?t:m.a,unitInMeters:o,transformation:{anchor:a,scale:l,rotation:c}}}}const Xr=Object(m.e)(),Jr=Object(f.d)(),Yr=Object(f.d)(),Kr=Object(be.e)(),ei={verticalDistanceToGround:0,sampledElevation:0};var ti=r(49);function ri(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function ii(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*o+s*l,e[1]=n*o+a*l,e[2]=i*c+s*u,e[3]=n*c+a*u,e}function ni(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}const si=ii,ai=ni;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},set:ri,transpose:function(e,t){if(e===t){const r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){const r=t[0],i=t[1],n=t[2],s=t[3];let a=r*s-n*i;return a?(a=1/a,e[0]=s*a,e[1]=-i*a,e[2]=-n*a,e[3]=r*a,e):null},adjoint:function(e,t){const r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:ii,rotate:function(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*o,e[1]=n*l+a*o,e[2]=i*-o+s*l,e[3]=n*-o+a*l,e},scale:function(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1];return e[0]=i*o,e[1]=n*o,e[2]=s*l,e[3]=a*l,e},fromRotation:function(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)},LDU:function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract:ni,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){const r=e[0],i=e[1],n=e[2],s=e[3],a=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(r-a)<=ti.a*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=ti.a*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-l)<=ti.a*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=ti.a*Math.max(1,Math.abs(s),Math.abs(c))},multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},mul:si,sub:ai});var oi=r(18),li=r(58);class ci extends M.a{constructor(e,t,r,i,n,s){super(e,t),this.path=r,this.geometrySR=i,this.upVectorAlignment=n,this.stencilWidth=s}}function ui(e){return"upVectorAlignment"in e}function di(){return[1,0,0,1]}Object.freeze({__proto__:null,create:di,clone:function(e){return[e[0],e[1],e[2],e[3]]},fromValues:function(e,t,r,i){return[e,t,r,i]},createView:function(e,t){return new Float64Array(e,t,4)}});var hi=r(26),pi=r(64);function fi(){return{up:Object(m.e)(),right:Object(m.e)()}}function bi(e,t,r){Object(b.s)(e.up,t.up,r),Object(b.s)(e.right,t.right,r)}function mi(e,t,r){Object(oi.r)(e,Object(b.j)(r,t.right),Object(b.j)(r,t.up))}class gi{constructor(){this.pos=Object(m.e)(),this.posES=Object(m.e)(),this.posGS=Object(m.e)(),this.vRight=Object(m.e)(),this.vLeft=Object(m.e)(),this.frame=fi(),this.rotationFrame=fi(),this.rotationRight=Object(pe.b)(),this.rotationAngle=0,this.miterStretch=[1,0,0,1]}setFrameFromUpVector(e){Object(b.m)(this.frame.up,e),Object(b.h)(Li,this.vLeft,this.vRight),Object(b.t)(Li,Li),Object(b.g)(Fi,this.frame.up,Object(b.j)(Li,this.frame.up)),Object(b.l)(Vi,Li,Fi),Object(b.t)(Vi,Vi),Object(b.i)(this.frame.right,Vi,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){Object(b.m)(this.rotationFrame.up,this.frame.up),Object(b.m)(this.rotationFrame.right,this.frame.right),Object(oi.r)(this.rotationRight,1,0),Object(b.g)(Fi,this.frame.up,Object(b.j)(this.frame.up,this.vLeft)),Object(b.l)(Fi,this.vLeft,Fi),Object(b.u)(Fi,Fi),Object(b.t)(Fi,Fi),Object(b.g)(Li,this.frame.up,Object(b.j)(this.frame.up,this.vRight)),Object(b.l)(Li,this.vRight,Li),Object(b.t)(Li,Li),Object(b.i)(ki,this.rotationFrame.up,this.vLeft);const e=Object(ze.t)(Object(b.j)(ki,this.vRight));if(this.rotationAngle=e*(Math.PI-Object(ze.b)(Object(b.j)(Fi,Li))),Math.abs(this.rotationAngle)>0){const e=Object(ze.s)(Math.cos(.5*this.rotationAngle));ri(this.miterStretch,e-1+1,0,0,1)}const t=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*t))}}class yi{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(e,t){return this.vertices.push(Object(pe.c)(e)),this.vertexNormals.push(Object(pe.c)(t)),this.vertices.length-1}addUV(e){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(e),this.uvs.length-1}addPole(e,t=null){return this.poles.push({position:Object(pe.c)(e),normal:t?Object(pe.c)(t):null}),this.poles.length-1}addSegment(e,t=null,r=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),t&&(this.uvIndices.push(t.v0),this.uvIndices.push(t.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return null!=this.uvs}translate(e,t){for(const r of this.vertices)r[0]+=e,r[1]+=t;for(const r of this.poles)r.position[0]+=e,r.position[1]+=t}static circle(e=20){const t=new yi,r={v0:0,v1:0};t.addPole(Object(pe.f)(0,0));for(let s=0;s<e;++s){const r=2*s*Math.PI/e,i=Math.cos(r),n=Math.sin(r),a=Object(pe.f)(.5*i,.5*n),o=Object(pe.f)(i,n);t.addVertex(a,o),t.addUV(s/e)}t.addUV(1);for(let s=0;s<e-1;++s){const e={v0:s,v1:s+1},i=e;t.addSegment(e,i,r)}const i={v0:e-1,v1:0},n={v0:e-1,v1:e};return t.addSegment(i,n,r),t}static rect(){const e=new yi,t=Object(pe.f)(-.5,-.5),r=Object(pe.f)(.5,-.5),i=Object(pe.f)(.5,.5),n=Object(pe.f)(-.5,.5),s=Object(pe.f)(0,-1),a=Object(pe.f)(1,0),o=Object(pe.f)(0,1),l=Object(pe.f)(-1,0);e.addUV(0),e.addUV(1),e.addPole(Object(pe.f)(0,.5),o),e.addPole(Object(pe.f)(0,.5)),e.addPole(Object(pe.f)(0,-.5)),e.addPole(Object(pe.f)(0,-.5),s);const c={v0:0,v1:1};return e.addVertex(t,s),e.addVertex(r,s),e.addSegment({v0:0,v1:1},c,{v0:3,v1:3}),e.addVertex(r,a),e.addVertex(i,a),e.addSegment({v0:2,v1:3},c,{v0:2,v1:1}),e.addVertex(i,o),e.addVertex(n,o),e.addSegment({v0:4,v1:5},c,{v0:0,v1:0}),e.addVertex(n,l),e.addVertex(t,l),e.addSegment({v0:6,v1:7},c,{v0:1,v1:2}),e}}class vi{constructor(e){this.vertices=[],this.offset=Object(m.e)(),this.xform=Object(f.d)(),this.vertices=e;const t=Math.floor((e.length-1)/2);Object(b.m)(this.offset,this.vertices[t].pos);for(const r of this.vertices)Object(b.l)(r.pos,r.pos,this.offset);Object(p.t)(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length;let t=this.vertices[0];t.index=0,Object(b.y)(t.vLeft,0,0,0),t.vLeftLength=0,Object(b.l)(t.vRight,this.vertices[1].pos,t.pos),t.vRightLength=Object(b.r)(t.vRight),Object(b.t)(t.vRight,t.vRight);let r=t;for(let i=1;i<e;++i)t=this.vertices[i],t.index=i,Object(b.m)(t.vLeft,r.vRight),t.vLeftLength=r.vRightLength,i<e-1?(Object(b.l)(t.vRight,this.vertices[i+1].pos,t.pos),t.vRightLength=Object(b.r)(t.vRight),Object(b.t)(t.vRight,t.vRight)):(Object(b.m)(t.vRight,t.vLeft),t.vRightLength=t.vLeftLength),r=t}}class Oi{numProfilesPerJoin(){return 1}extrude(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],!1)}}class ji{constructor(e=.8*Math.PI,t=1){this.cutoffAngle=e,this.numBendSubdivisions=t}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,t,r){const i=Ni;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){Object(p.i)(Ui),Object(p.c)(Ui,Ui,.5*-e.rotationAngle+n*e.rotationAngle/this.numBendSubdivisions,e.rotationFrame.up),bi(i,e.frame,Ui);for(let n=0;n<t.vertices.length;++n)Object(oi.h)(t.vertices[n],e.rotationRight)*e.rotationAngle>=0?r(e.index,i,t.vertices[n],t.vertexNormals[n],!1):(Object(oi.o)(Ri,t.vertices[n],e.miterStretch),r(e.index,e.frame,Ri,t.vertexNormals[n],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let i=0;i<t.vertices.length;++i){const n=Object(oi.h)(t.vertices[i],e.rotationRight)*e.rotationAngle>=0;Object(oi.o)(Ri,t.vertices[i],e.miterStretch),r(e.index,e.frame,Ri,t.vertexNormals[i],!n)}}}const _i={generateUV:!1};class wi{rebuildConnectingProfileGeometry(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],0,0)}}class xi extends wi{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class Si extends wi{constructor(e,t=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=t,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],this.profilePlaneOffset,0)}rebuildCapGeometry(e,t){const r=Ii;Object(oi.r)(r,0,0);const i=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)t(e.index,e.frame,this.profile.vertices[n],r,this.profilePlaneOffset,i)}buildTopology(e,t){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let i=1;i<this.profile.numSegments;++i){const e=this.profile.vertexIndices[2*i+0],n=this.profile.vertexIndices[2*i+1],s=this.vertexBufferStart+e,a=this.vertexBufferStart+n;this.flip?t(a,s,r):t(r,s,a)}}}class Ti extends wi{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let t=0;t<this.profile.numSegments;++t){const r=this.profile.vertexIndices[2*t+0],i=this.profile.vertexIndices[2*t+1];this.profile.poleIndices[r]===this.profile.poleIndices[i]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,t){const r=e.frame,i=.5*this.sign,n=Ri,s=Ii;Object(oi.r)(s,0,0);for(let a=0;a<this.profile.poles.length;++a){const n=this.profile.poles[a];n.normal?t(e.index,r,n.position,n.normal,i,0):t(e.index,r,n.position,s,i,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)t(e.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const o=(1-(a+1)/this.numSegments)*Math.PI*.5,l=Math.sin(o),c=Math.cos(o);for(let a=0;a<this.profile.vertices.length;++a){const o=this.profile.poles[this.profile.poleIndices[a]];Object(oi.a)(n,this.profile.vertices[a],o.position),Object(oi.b)(n,n,l),o.normal?(Object(oi.i)(n,n,o.position),t(e.index,r,n,o.normal,i*c,0)):(Object(oi.f)(s,n),Object(oi.b)(s,s,l),Object(oi.i)(n,n,o.position),t(e.index,r,n,s,i*c,this.sign*c))}}}buildTopology(e,t){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const e=this.profile.vertexIndices[2*n+0],s=this.profile.vertexIndices[2*n+1],a=this.vertexBufferStart+this.profile.poleIndices[e],o=this.vertexBufferStart+this.profile.poleIndices[s];let l=r+e,c=r+s;for(let r=0;r<this.numSegments-1;++r){const n=i+r*this.profile.vertices.length+e,a=i+r*this.profile.vertices.length+s;this.flip?(t(n,c,l),t(c,n,a)):(t(l,c,n),t(a,n,c)),l=n,c=a}this.flip?(t(a,c,l),a!==o&&t(a,o,c)):(t(l,c,a),a!==o&&t(c,o,a))}}}class Ci{constructor(e,t,r,i,n,s=_i){this.options=s,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=t,this.path=e,this.extruder=r,this.startCap=i,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=t.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const o=this.startCap.getNumVertices();this.numVerticesTotal+=o,this.numNormalsTotal+=o,this.endCap.vertexBufferStart=this.numVerticesTotal;const l=this.endCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this.rebuildGeometry(),this.buildTopology()}emitVertex(e,t,r,i,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const t=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[0]*t.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[1]*t.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,t,r,i,n,s){this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=s,++this._extrusionVertexCount}emitTriangle(e,t,r){this.vertexIndices[3*this._triangleCount+0]=e,this.vertexIndices[3*this._triangleCount+1]=t,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[e],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=e,this.normalIndices[3*this._triangleCount+1]=t,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}rebuildGeometry(){const e=(e,t,r,i,n)=>this.emitVertex(e,t,r,i,n),t=(e,t,r,i,n,s)=>this.emitCapVertex(e,t,r,i,n,s);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,t);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,e);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,t),this.startCap.rebuildCapGeometry(this.path.vertices[0],t),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],t),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const e=(e,t,r)=>this.emitTriangle(e,t,r);this._triangleCount=0;const t=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let n=r*i*2*3;this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let s=0;s<r;++s){const r=this.profile.vertexIndices[2*s],n=this.profile.vertexIndices[2*s+1];for(let s=0;s<i;++s){const i=s*t+r,a=(s+1)*t+n,o=s*t+n;e(i,(s+1)*t+r,a),e(i,a,o)}}this.startCap.buildTopology(this.path.vertices[0],e),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],e)}onPathChanged(){this.rebuildGeometry()}}class Mi{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class Pi extends Mi{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let t=0;t<this.builder.numVerticesTotal;++t){let r=this.builder.pathVertexData[t];const i=0===r||r===this.builder.path.vertices.length-1;r*=3;const n=Ei;Object(b.y)(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const s=4*t,a=Fi,o=Ri,l=Li,c=ki,u=zi;let d=0,h=0;if(Object(b.y)(c,this.builder.profileRightAxisData[s],this.builder.profileRightAxisData[s+1],this.builder.profileRightAxisData[s+2]),Object(b.y)(u,this.builder.profileUpAxisData[s],this.builder.profileUpAxisData[s+1],this.builder.profileUpAxisData[s+2]),Object(oi.r)(o,this.builder.profileVertexAndNormalData[s]*e[0],this.builder.profileVertexAndNormalData[s+1]*e[1]),i)Object(b.i)(l,u,c),d=this.builder.profileRightAxisData[s+3]*e[0],h=this.builder.profileUpAxisData[s+3];else{const e=Ii,t=Di;Object(oi.r)(e,this.builder.profileRightAxisData[s+3],this.builder.profileUpAxisData[s+3]);const r=Object(oi.l)(e);Object(oi.f)(e,e);const i=Object(oi.h)(o,e);if(Math.abs(i)>r){Object(oi.r)(t,-e[1],e[0]);const n=Object(oi.h)(o,t);Object(oi.b)(e,e,r*Object(ze.t)(i)),Object(oi.b)(t,t,n),Object(oi.i)(o,e,t)}Object(b.y)(l,0,0,0)}Object(b.y)(a,c[0]*o[0]+u[0]*o[1],c[1]*o[0]+u[1]*o[1],c[2]*o[0]+u[2]*o[1]),this.vertexAttributePosition[3*t+0]=n[0]+a[0]+l[0]*d,this.vertexAttributePosition[3*t+1]=n[1]+a[1]+l[1]*d,this.vertexAttributePosition[3*t+2]=n[2]+a[2]+l[2]*d;const p=Ri;Object(oi.r)(p,this.builder.profileVertexAndNormalData[s+2],this.builder.profileVertexAndNormalData[s+3]),this.vertexAttributeNormal[3*t+0]=c[0]*p[0]+u[0]*p[1]+l[0]*h,this.vertexAttributeNormal[3*t+1]=c[1]*p[0]+u[1]*p[1]+l[1]*h,this.vertexAttributeNormal[3*t+2]=c[2]*p[0]+u[2]*p[1]+l[2]*h}}createGeometryData(){const e=[["position",this.builder.vertexIndices],["normal",this.builder.normalIndices]],t=[["position",{size:3,data:this.vertexAttributePosition,exclusive:!0}],["normal",{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;e.push(["color",new Uint32Array(r)]),t.push(["color",{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:t,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,t,r){const i=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},s=i.length/3;Object(zr.j)(e,t,0,s,i,n,void 0,void 0,r)}}class Ai extends Mi{constructor(e,t,r,i){super(e),this.sizeAttributeValue=t,this.colorAttributeValue=r,this.opacityAttributeValue=i,this.vvData=null,this.baked=new Pi(e),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=t,this.vvData[4*n+1]=r,this.vvData[4*n+2]=i;const e=0===n||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=e?1:0}}createGeometryData(){return{vertexAttributes:[["position",{size:3,data:this.builder.originData,exclusive:!0}],["profileRight",{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],["profileUp",{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],["profileVertexAndNormal",{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],["featureValue",{size:4,data:this.vvData,exclusive:!0}]],indices:[["position",this.builder.pathVertexIndices],["profileRight",this.builder.vertexIndices],["profileUp",this.builder.vertexIndices],["profileVertexAndNormal",this.builder.vertexIndices],["featureValue",this.builder.pathVertexIndices]]}}}const Ei=Object(m.e)(),Ri=Object(pe.b)(),Ii=Object(pe.b)(),Di=Object(pe.b)(),Fi=Object(m.e)(),Li=Object(m.e)(),ki=Object(m.e)(),zi=Object(m.e)(),Vi=Object(m.e)(),Ni=fi(),Ui=Object(f.d)();var Bi=r(184),Gi=r(103),qi=r(0),Hi=r(61),Wi=r(487),$i=r(271),Qi=r(98),Zi=r(135),Xi=r(92),Ji=r(77),Yi=r(82),Ki=r(15),en=r(75),tn=r(74),rn=r(97),nn=r(613),sn=r(30);const an=new Map([["position",0],["profileRight",1],["profileUp",2],["profileVertexAndNormal",3],["featureValue",4]]);class on extends Yi.a{initializeProgram(e){const t=on.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:r.receiveSSAO,doubleSidedMode:r.doubleSidedMode,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new tn.a(e.rctx,i,an)}bindPass(e,t){var r,i;Object(Xi.c)(this.program,t.camera.projectionMatrix),this.program.setUniform3fv("size",e.size),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Qi.a)(this.program,t)),0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",e.opacity),0===this.configuration.output?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform3fv("specular",e.specular),this.program.setUniform1f("opacity",e.opacity)):1!==this.configuration.output&&3!==this.configuration.output||Object(Xi.b)(this.program,t.camera.nearFar),Object(Wi.b)(this.program,e),null==(r=t.shadowMap)||r.bind(this.program),null==(i=t.ssaoHelper)||i.bind(this.program)}bindDraw(e){Object(Xi.d)(this.program,e),Object(Hi.c)(this.program,this.configuration,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(Xi.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(Zi.c)(this.program,e),2===this.configuration.output&&$i.a.bindUniforms(this.program,e.camera.viewInverseTransposeMatrix)}setPipelineState(e){const t=this.configuration,r=3===e,i=2===e;return Object(sn.g)({blending:0!==t.output&&7!==t.output||!t.transparent?null:r?en.f:Object(en.a)(e),culling:(e=>!e.slicePlaneEnabled&&!(e.transparent||0===e.doubleSidedMode))(t)&&sn.f,depthTest:{func:Object(en.b)(e)},depthWrite:r||i?sn.e:null,colorWrite:sn.d,stencilWrite:t.sceneHasOcludees?rn.j:null,stencilTest:t.sceneHasOcludees?rn.e:null,polygonOffset:r||i?null:en.d})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}on.shader=new Ji.a(nn.a,(()=>r.e(196).then(r.bind(null,1054))));class ln extends Ki.a{constructor(){super(...arguments),this.output=0,this.doubleSidedMode=0,this.receiveShadows=!1,this.receiveSSAO=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(qi.a)([Object(Ki.b)({count:8})],ln.prototype,"output",void 0),Object(qi.a)([Object(Ki.b)({count:3})],ln.prototype,"doubleSidedMode",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"receiveShadows",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"receiveSSAO",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"vvSize",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"vvColor",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"vvOpacity",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"slicePlaneEnabled",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"transparent",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"sceneHasOcludees",void 0),Object(qi.a)([Object(Ki.b)({count:4})],ln.prototype,"transparencyPassType",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"multipassTerrainEnabled",void 0),Object(qi.a)([Object(Ki.b)()],ln.prototype,"cullAboveGround",void 0);var cn=r(518),un=r(137);const dn=Me.a;class hn extends Gi.a{constructor(e){super(e,fn),this.supportsEdges=!0,this._vertexAttributeLocations=an,this.techniqueConfig=new ln,this.vertexBufferLayout=hn.getVertexBufferLayout(this.params)}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,0!==e&&7!==e||(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.receiveSSAO=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO),this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}isVisibleInPass(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}isVisible(){const e=this.params;return!!super.isVisible()&&e.opacity>0}intersect(e,t,r,i,s,a,o){const l=e;if(!ui(l))return;const c=l.path,u=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){const e=this.params.vvSizeOffset,t=this.params.vvSizeFactor,r=this.params.vvSizeMinSize,i=this.params.vvSizeMaxSize,n=c.sizeAttributeValue;u[0]*=Object(ze.e)(e[0]+n*t[0],r[0],i[0]),u[1]*=Object(ze.e)(e[2]+n*t[2],r[2],i[2])}const d=Math.max(u[0],u[1]),h=e.boundingInfo;if(Object(n.i)(h))return void this._intersectTriangles(c,u,s,a,o);const p=Object(y.t)(h.bbMin[0]-d,h.bbMin[1]-d,h.bbMin[2]-d,h.bbMax[0]+d,h.bbMax[1]+d,h.bbMax[2]+d),f=[a[0]-s[0],a[1]-s[1],a[2]-s[2]],b=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),m=[b/f[0],b/f[1],b/f[2]];Object(zr.f)(p,s,m,i.tolerance)&&this._intersectTriangles(c,u,s,a,o)}_intersectTriangles(e,t,r,i,n){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,i,n)}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return null;const i=r.get("position");return Object(Pt.a)(i,null,!1,t)}createBufferWriter(){return new bn(this.vertexBufferLayout)}getGLMaterial(e){if(0===e.output||7===e.output||1===e.output||2===e.output||4===e.output||3===e.output&&this.params.castShadows)return new pn(e)}static getVertexBufferLayout(e){let t=Object(hr.a)().vec3f("position").vec4f("profileRight").vec4f("profileUp").vec4f("profileVertexAndNormal");return(e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f("featureValue")),t}}class pn extends Bi.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(on,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return e===(this._technique.configuration.transparent?5:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}_updateShadowState(e){e.shadowMappingEnabled!==this._technique.configuration.receiveShadows&&this._material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}ensureParameters(e){0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}}const fn={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...cn.a.Default,...Gi.b};class bn{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){const n=e=>{if(t.vertexAttributes.has(e)){const n=t.vertexAttributes.get(e),s=t.indices.get(e);dn(4===n.size);const a=r.getField(e,v.C);if(!a)throw new Error("unable to acquire view for "+e);Object(un.a)(s,n.data,a,i)}};n("profileRight"),n("profileUp"),n("profileVertexAndNormal"),this.vertexBufferLayout.hasField("featureValue")&&n("featureValue"),Object(un.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}const mn=["polyline"];class gn extends x.a{constructor(e,t,r,i){super(e,t,r,i),this._intrinsicSize=Object(pe.f)(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=Object(n.j)(this.symbolLayer.width)?this.symbolLayer.width:Object(n.j)(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size,t=Object(n.j)(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,t],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=Je(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path","heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");const i=this.symbolLayer.profile||"circle";switch(i){case"circle":default:this._profile=yi.circle(Cn);break;case"quad":this._profile=yi.rect()}let s=[0,0];switch("center"!==r&&(s={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(s[0],s[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new ji(0,Sn);break;case"bevel":this._extruder=new ji(0,1);break;case"miter":this._extruder=new ji(.8*Math.PI,1);break;case"simple":default:this._extruder=new Oi}const a=this.symbolLayer.cap||"butt";switch(a){case"none":this._startCap=new xi,this._endCap=new xi;break;case"butt":default:this._startCap=new Si(this._profile,0),this._endCap=new Si(this._profile,0,!0);break;case"square":this._startCap=new Si(this._profile,-.5),this._endCap=new Si(this._profile,.5,!0);break;case"round":{const e="quad"===i;this._startCap=new Ti({profile:this._profile,flip:!1,breakNormals:e,subdivisions:Tn}),this._endCap=new Ti({profile:this._profile,flip:!0,breakNormals:e,subdivisions:Tn});break}}const o=Object(n.h)(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(o),u=Object(m.f)(l),d=l[3],h=d<1||this.needsDrivenTransparentPass,p={diffuse:u,ambient:u,opacity:d,transparent:h,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:h||"none"===a?0:2,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Object(oi.r)(this._intrinsicSize,e,t),!Object(S.f)(this._intrinsicSize[0])||!Object(S.f)(this._intrinsicSize[1])))throw new c.a("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Object(oi.b)(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled?(Object.assign(p,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new hn(p)):(p.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new B.a(p)),this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,mn,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new w.a),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}layerOpacityChanged(){const e=Object(n.h)(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),r=t<1||this.needsDrivenTransparentPass;return this._material.setParameterValues({opacity:t,transparent:r}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,_.g)}slicePlaneEnabledChanged(){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(e,t){for(const r in e.diff)switch(r){case"visualVariables":if(!Ye(this._fastUpdates,t,this._vvConvertOptions))return!1;this._material.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0}getVertexData(e){let t=0;const r=e.paths,i=[],n=e.spatialReference,s=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const h of r)t+=h.length;const o=new Float64Array(3*t),l=new Float64Array(3*t),c=new Float64Array(3*t);let u=0;for(const h of r){i.push({index:u,numVertices:h.length});for(const t of h)o[u++]=t[0],o[u++]=t[1],o[u++]=e.hasZ?t[2]:0}let d=!0;return n.equals(s)?this._copyVertices(o,0,l,0,t):d=Object(g.q)(o,n,0,l,s,0,t),s.equals(a)?this._copyVertices(l,0,c,0,t):Object(g.q)(l,s,0,c,a,0,t),{pathVertexDataInfos:i,vertexDataGS:o,vertexDataES:l,vertexDataRS:c,projectionSuccess:d,terrainElevation:0}}_copyVertices(e,t,r,i,n){t*=3,i*=3;for(let s=0;s<n;++s)r[i++]=e[t++],r[i++]=e[t++],r[i++]=e[t++]}_createAs3DShape(e,t,r,i){const s=e.geometry,a=new Array,l=new Array,c=new Array,u=s.spatialReference,d=Object(y.h)(),h=this._context.renderCoordsHelper,p=this.getVertexData(s);if(!p.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(p.pathVertexDataInfos.length>0){for(let i=0;i<p.pathVertexDataInfos.length;++i){const s=p.pathVertexDataInfos[i],o=s.index,f=s.numVertices;if(f<2)continue;if(Object(n.j)(this._context.clippingExtent)&&(Object(y.k)(d),Object(y.n)(d,p.vertexDataES,3*o,f),!Object(y.w)(d,this._context.clippingExtent)))continue;const m=[];for(let e=o;e<o+3*f;){const t=e++,i=e++,n=e++,s=new gi;Object(b.y)(s.posGS,p.vertexDataGS[t],p.vertexDataGS[i],p.vertexDataGS[n]),Object(b.y)(s.posES,p.vertexDataES[t],p.vertexDataES[i],p.vertexDataES[n]);const a=Object(_.e)(s.posES,this._context.elevationProvider,r,h,null);Object(b.y)(_n,p.vertexDataRS[t],p.vertexDataRS[i],p.vertexDataRS[n]),h.setAltitude(_n,a),Object(b.y)(s.pos,_n[0],_n[1],_n[2]),m.push(s)}const g=new vi(m);yn(g,this.upVectorAlignment,this._context.renderCoordsHelper);const v=new Ci(g,this._profile,this._extruder,this._startCap,this._endCap);let O=null;if(this._fastUpdates.enabled){const t=this._fastUpdates.visualVariables,r=t.size?Object(x.b)(t.size.field,e):0,i=t.color?Object(x.b)(t.color.field,e):0,n=t.opacity?Object(x.b)(t.opacity.field,e):0;O=new Ai(v,r,i,n)}else{const e=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(e[0]*=vn(t.size[0],"symbol-value"===t.size[2]?this.symbolLayer.height||0:t.size[2],this.symbolLayer.width||0),e[1]*=vn(t.size[2],"symbol-value"===t.size[0]?this.symbolLayer.width||0:t.size[0],this.symbolLayer.height||0));let r=null;this._drivenProperties.color&&(r=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(r=r?[r[0],r[1],r[2],t.opacity]:[1,1,1,t.opacity]);const i=new Pi(v);i.bake(e),r&&i.bakeVertexColors(r),O=i}const{vertexAttributes:j,indices:w}=O.createGeometryData(),S=new ci(j,w,O,u,this.upVectorAlignment,this.stencilWidth);a.push(S),l.push(this._material),c.push(O.xform)}if(a.length>0){const e={layerUid:this._context.layer.uid,graphicUid:i},t=new U.a({geometries:a,materials:l,transformations:c,metadata:e}),n=new o.a(this,t,a,null,null,jn,r);return n.alignedSampledElevation=p.terrainElevation,n.needsElevationUpdates=Object(_.g)(r.mode),n}}else 0!==s.paths.length&&s.paths.some((e=>e.length>0))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function yn(e,t,r){switch(t){case"world":for(const t of e.vertices)Object(b.h)(wn,t.pos,e.offset),r.worldUpAtPosition(wn,_n),t.setFrameFromUpVector(_n),t.computeRotationAxisAndAngleFromUpVector();break;case"path":Object(b.h)(wn,e.vertices[0].pos,e.offset),r.worldUpAtPosition(wn,_n),function(e,t){let r=null;const i=e.vertices.length,n=.99619469809,s=Object(m.e)(),a=Object(m.e)(),o=Object(m.e)(),l=Object(m.e)(),c=Object(m.e)(),u=Object(m.e)(),d=Object(hi.d)();let h=e.vertices[0];Object(b.m)(a,t),Object(b.y)(s,0,1,0),nt.a.makeOrthoBasisDirUpFallback(h.vRight,a,s,s,o,a,n),Object(b.m)(h.frame.up,a),Object(b.m)(h.frame.right,o),r=h;for(let p=1;p<i;++p){h=e.vertices[p],Object(b.h)(c,h.vLeft,h.vRight);let t=Object(b.r)(c);t>0?(t=1/Math.sqrt(t),c[0]=c[0]*t,c[1]=c[1]*t,c[2]=c[2]*t):(c[0]=h.vRight[0],c[1]=h.vRight[1],c[2]=h.vRight[2]),Object(b.h)(u,r.pos,r.frame.up),Object(hi.h)(h.pos,c,d),Object(hi.m)(d,Object(pi.g)(u,h.vLeft),l)?(Object(b.l)(l,l,h.pos),Object(b.t)(a,l),Object(b.i)(o,c,a),Object(b.t)(o,o)):nt.a.makeOrthoBasisDirUpFallback(c,r.frame.up,r.frame.right,s,o,a,n),Object(b.m)(h.frame.up,a),Object(b.m)(h.frame.right,o),r=h}}(e,_n);for(const t of e.vertices){const e=Object(ze.t)(Object(b.j)(t.frame.right,t.vRight));Object(b.i)(t.rotationFrame.up,t.vRight,t.vLeft),Object(b.g)(t.rotationFrame.up,t.rotationFrame.up,e),Object(b.t)(t.rotationFrame.up,t.rotationFrame.up);const r=Object(b.j)(t.rotationFrame.up,t.frame.up),i=Object(b.j)(t.rotationFrame.up,t.frame.right);if(Object(b.g)(wn,t.frame.up,-i),Object(b.g)(xn,t.frame.right,r),Object(b.h)(wn,wn,xn),Object(b.t)(t.rotationFrame.right,wn),mi(t.rotationRight,t.frame,t.rotationFrame.right),Object(b.u)(wn,t.vLeft),t.rotationAngle=-e*(Math.PI-Object(ze.b)(Object(b.j)(wn,t.vRight))),Math.abs(t.rotationAngle)>0){const e=Object(ze.s)(Math.cos(.5*t.rotationAngle));ri(t.miterStretch,1+(e-1)*t.rotationRight[0]*t.rotationRight[0],(e-1)*t.rotationRight[0]*t.rotationRight[1],(e-1)*t.rotationRight[0]*t.rotationRight[1],1+(e-1)*t.rotationRight[1]*t.rotationRight[1])}const n=Math.PI-t.rotationAngle;t.maxStretchDistance=Math.abs(Math.min(t.vLeftLength,t.vRightLength)*Object(ze.s)(Math.cos(.5*n)))}}}function vn(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function On(e,t,r,i){let n=0;for(const s of e.vertices){const a=Object(_.e)(s.posES,r,t,i,Mn);n+=Mn.sampledElevation,Object(b.h)(_n,s.pos,e.offset),i.setAltitude(_n,a),Object(b.l)(s.pos,_n,e.offset)}return e.updatePathVertexInformation(),n/e.vertices.length}function jn(e,t,r,i){const n=e.stageObject,s=n.geometryRecords,a=s.length;let o=0;i.spatialReference;for(let l=0;l<a;l++){const e=s[l].geometry;if(!ui(e))continue;const a=e.path,c=a.builder.path;e.geometrySR,o+=On(c,t,r,i),"world"!==e.upVectorAlignment&&yn(c,e.upVectorAlignment,i),a.onPathChanged(),e.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return o/a}const _n=Object(m.e)(),wn=Object(li.c)(),xn=Object(li.c)(),Sn=3,Tn=3,Cn=10,Mn={verticalDistanceToGround:0,sampledElevation:0};var Pn=r(53);function An(e,t,r,i,s=1){Object(b.y)(Dn,1,0,0),Object(b.y)(Fn,0,1,0),Object(b.y)(Ln,0,0,1),function(e,t){Object(b.y)($n,0,0,0);for(let r=0;r<t.count-1;r++)t.getVec(r,Rn),Object(b.h)($n,$n,Rn);Object(b.g)(e,$n,1/(t.count-1))}(En,t),function(e,t){const r=e.count-1;return Object(hi.e)(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}(t,In)&&function(e,t,r,i,s,a){Object(n.j)(s)?(s.basisMatrixAtPosition(a,Gn),Object(b.y)(qn,Gn[0],Gn[1],Gn[2]),Object(b.y)(Hn,Gn[4],Gn[5],Gn[6]),Object(b.y)(Wn,Gn[8],Gn[9],Gn[10])):(Object(b.y)(qn,1,0,0),Object(b.y)(Hn,0,1,0),Object(b.y)(Wn,0,0,1));const o=Object(hi.s)(e);Object(b.j)(o,Wn)<0&&Object(b.g)(o,o,-1),Object(b.m)(i,o);const l=Object(b.j)(o,Hn),c=Object(b.j)(o,qn);Math.abs(l)<Math.abs(c)?(Object(b.f)(t,qn,o,-c),Object(b.t)(t,t),Object(b.i)(r,t,o),Object(b.t)(r,r),Object(b.g)(r,r,-1)):(Object(b.f)(r,Hn,o,-l),Object(b.t)(r,r),Object(b.i)(t,r,o),Object(b.t)(t,t))}(In,Dn,Fn,Ln,r,En),Object(oi.r)(kn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Object(oi.r)(zn,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let n=0;n<t.count;n++){t.getVec(n,Rn);const e=Object(b.j)(Dn,Rn),r=Object(b.j)(Fn,Rn);kn[0]=Math.min(kn[0],e),kn[1]=Math.min(kn[1],r),zn[0]=Math.max(zn[0],e),zn[1]=Math.max(zn[1],r)}const a=Object(b.j)(Ln,En);Qn(Nn,kn[0],kn[1],a,Dn,Fn,Ln),Qn(Un,zn[0],kn[1],a,Dn,Fn,Ln),Qn(Bn,kn[0],zn[1],a,Dn,Fn,Ln),Object(b.l)(Un,Un,Nn),Object(b.g)(Un,Un,.5),Object(b.l)(Bn,Bn,Nn),Object(b.g)(Bn,Bn,.5),Object(b.h)(Nn,Nn,Un),Object(b.h)(Nn,Nn,Bn);const o=kn[0]%s,l=kn[1]%s;Vn[0]=kn[0]-o,Vn[1]=kn[1]-l;for(let n=0;n<t.count;n++){t.getVec(n,Rn),e.setValues(n,(Object(b.j)(Dn,Rn)-Vn[0])/s,(Object(b.j)(Fn,Rn)-Vn[1])/s,Vn[0]/s,Vn[1]/s);for(let e=0;e<3;e++)i.set(n,e,Nn[e]),i.set(n,e+3,Un[e]),i.set(n,e+6,Bn[e])}}const En=Object(m.e)(),Rn=Object(m.e)(),In=Object(hi.d)(),Dn=Object(m.e)(),Fn=Object(m.e)(),Ln=Object(m.e)(),kn=Object(pe.b)(),zn=Object(pe.b)(),Vn=Object(pe.b)(),Nn=Object(m.e)(),Un=Object(m.e)(),Bn=Object(m.e)();const Gn=Object(f.d)(),qn=Object(m.e)(),Hn=Object(m.e)(),Wn=Object(m.e)();const $n=Object(m.e)();function Qn(e,t,r,i,n,s,a){Object(b.y)(e,t*n[0]+r*s[0]+i*a[0],t*n[1]+r*s[1]+i*a[1],t*n[2]+r*s[2]+i*a[2])}var Zn=r(550),Xn=r(231),Jn=r(615);class Yn extends Yi.a{initializeProgram(e){const t=Yn.shader.get(),r=this.configuration,i=t.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:r.style,patternSpacing:r.patternSpacing,lineWidth:r.lineWidth,draped:r.draped,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new tn.a(e.rctx,i,ts)}bindPass(e,t){Object(Xi.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("matColor",e.color),this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/t.screenToWorldRatioGlobalWM),this.program.setUniform1f("texelSize",1/t.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),4===this.configuration.output&&Object(or.b)(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Qi.a)(this.program,t))}bindDraw(e){Object(Xi.d)(this.program,e),Object(Xi.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(Hi.c)(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(sn.g)({blending:0===r.output||7===r.output?r.transparent&&i?en.f:Object(en.a)(e):null,culling:Object(sn.c)(r.cullFace),depthTest:{func:Object(en.b)(e)},depthWrite:i?r.writeDepth&&sn.e:Object(en.c)(e),colorWrite:sn.d,stencilWrite:r.sceneHasOcludees?rn.j:null,stencilTest:r.sceneHasOcludees?t?rn.f:rn.e:null,polygonOffset:i||n?r.polygonOffset&&Kn:Object(en.g)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}Yn.shader=new Ji.a(Jn.a,(()=>r.e(197).then(r.bind(null,1056))));const Kn={factor:1,units:1};class es extends Ki.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!0,this.polygonOffset=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.enableOffset=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(qi.a)([Object(Ki.b)({count:8})],es.prototype,"output",void 0),Object(qi.a)([Object(Ki.b)({count:3})],es.prototype,"cullFace",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"slicePlaneEnabled",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"vertexColors",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"transparent",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"polygonOffset",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"writeDepth",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"sceneHasOcludees",void 0),Object(qi.a)([Object(Ki.b)({count:6})],es.prototype,"style",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"patternSpacing",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"lineWidth",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"enableOffset",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"draped",void 0),Object(qi.a)([Object(Ki.b)({count:4})],es.prototype,"transparencyPassType",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"multipassTerrainEnabled",void 0),Object(qi.a)([Object(Ki.b)()],es.prototype,"cullAboveGround",void 0);const ts=new Map([["position",0],["color",3],["uvMapSpace",4],["boundingRect",5]]);class rs extends Gi.a{constructor(e){super(e,ss),this.supportsEdges=!0,this._vertexAttributeLocations=ts,this.techniqueConfig=new es}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.style=this.params.style,this.techniqueConfig.patternSpacing=this.params.patternSpacing,this.techniqueConfig.lineWidth=this.params.lineWidth,this.techniqueConfig.draped=this.params.draped,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<en.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,r,i,n,s,a){Object(zr.i)(e,t,i,n,s,void 0,a)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new is(e):void 0}createBufferWriter(){const e=Object(hr.a)().vec3f("position").vec4u8("color").vec4f("uvMapSpace");return this.params.draped||e.mat3f("boundingRect"),new ns(e)}}class is extends Bi.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(Yn,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return 4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}class ns extends Xn.a{write(e,t,r,i){for(const n of this.vertexBufferLayout.fieldNames){const s=t.vertexAttributes.get(n),a=t.indices.get(n);if(s&&a)switch(n){case"position":{Object(Me.a)(3===s.size);const t=r.getField(n,v.u);t&&Object(un.e)(a,s.data,e.transformation,t,i);break}case"color":{Object(Me.a)(3===s.size||4===s.size);const e=r.getField(n,v.J);e&&Object(un.b)(a,s.data,s.size,e,i);break}case"uvMapSpace":{Object(Me.a)(4===s.size);const e=r.getField(n,v.C);e&&Object(un.a)(a,s.data,e,i);break}case"boundingRect":{Object(Me.a)(9===s.size);const t=r.getField(n,v.f);t&&this.writeBoundingRect(a,s.data,e.transformation,t,i);break}}}}writeBoundingRect(e,t,r,i,n){const s=r,a=i.typedBuffer,o=i.typedBufferStride,l=e.length;n*=o;for(let c=0;c<l;++c){const r=9*e[c],i=t[r],l=t[r+1],u=t[r+2];a[n]=s[0]*i+s[4]*l+s[8]*u+s[12],a[n+1]=s[1]*i+s[5]*l+s[9]*u+s[13],a[n+2]=s[2]*i+s[6]*l+s[10]*u+s[14];for(let e=3;e<9;++e)a[n+e]=t[r+e];n+=o}}}const ss={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0,...Gi.b};function as(e,t,r){return function(e,t,r){return Object(n.j)(e)?"none"===e.style||"solid"===e.style?("none"===e.style&&(t.color=Object(be.g)(0,0,0,0),t.transparent=!0),new Zn.a(t)):(t.style=function(e){switch(e){case"horizontal":return 0;case"vertical":return 1;case"cross":return 2;case"forward-diagonal":return 3;case"backward-diagonal":return 4;case"diagonal-cross":return 5;default:return}}(e.style),t.draped=r.isDraped,new rs(t)):new Zn.a(t)}(function(e){return e&&e.pattern||null}(e),t,r)}function os(e,t){if(function(e){return e.material instanceof rs&&!e.material.params.draped}(e)){const r=e.geometry.vertexAttributes,i=r.get("position").data,n=r.get("uvMapSpace").data,s=r.get("boundingRect").data;An(v.C.fromTypedArray(n),v.v.fromTypedArray(i),t,v.g.fromTypedArray(s))}}function ls(e,t,r,i){const n=Object(je.c)(e,t,r,i),s=e.stageObject.geometryRecords;for(let a=0;a<s.length;a++)os(s[a],i);return n}const cs=["polyline","polygon","extent"];class us extends x.a{constructor(e,t,r,i){super(e,t,r,i),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}ensureMaterials(){this.ensureFillMaterial(),this.ensureOutlineMaterial()}ensureFillMaterial(){if(Object(n.j)(this._material))return;const e=Object(n.h)(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e);this._material=as(this.symbolLayer,{color:t,transparent:t[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof rs,this._context.stage.add(this._material)}ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(Object(n.j)(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;this._outlineMaterial=(t=>{const r=e.stipplePattern?Object(Ot.a)(e.stipplePattern.map(de.g)):null,i=e.stippleOffColor?ce.a.toUnitRGBA(e.stippleOffColor):null;return t>1.5?new jt.a({width:t,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:r,stippleIntegerRepeats:!0,stippleOffColor:i}):new At.a({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,width:t,stipplePattern:r,stippleIntegerRepeats:!0,stippleOffColor:i})})(Object(de.g)(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return Object(n.j)(e)&&e.size&&e.size>0&&Object(n.j)(e.color)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,cs,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t,new w.a);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.ensureMaterials(),this.draped?this._createAsOverlay(t,r):this._createAs3DShape(t,r,i)}layerOpacityChanged(){if(Object(n.j)(this._material)){const e=this._material.params.color,t=Object(n.h)(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t);this._material.setParameterValues({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(Object(n.j)(this._outlineMaterial)){const e=this._outlineMaterial.params.color;this._outlineMaterial.setParameterValues({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(_.d)(us.elevationModeChangeTypes,r,i);if(n!==_.a.UPDATE)return n;const s=Object(_.f)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){if(Object(n.j)(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),Object(n.j)(this._outlineMaterial)){const e={slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial.setParameterValues(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,r){const i=I(e.geometry);if(Object(n.i)(i))return null;hs.renderData=D(i,this._context.elevationProvider,this._context.renderCoordsHelper,r),hs.color=t;const s=hs.renderData.position.length/3;if(this._needsUV&&(hs.uvMapSpace=new Float32Array(4*s),hs.boundingRect=new Float64Array(9*s)),hs.outNum=0,hs.outGeometries=[],hs.outTransforms=[],hs.outMaterials=[],this._createAs3DShapeFill(hs),this._hasOutline&&this._createAs3DShapeOutline(hs),this._logGeometryCreationWarnings(hs.renderData,i.rings,"rings","FillSymbol3DLayer"),0===hs.outNum)return null;this._needsUV&&An(v.C.fromTypedArray(hs.uvMapSpace),v.v.fromTypedArray(hs.renderData.position),this._context.renderCoordsHelper,v.g.fromTypedArray(hs.boundingRect));const a=new U.a({geometries:hs.outGeometries,materials:hs.outMaterials,transformations:hs.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),l=ls,c=new o.a(this,a,hs.outGeometries,null,null,l,r);return c.alignedSampledElevation=hs.renderData.sampledElevation,c.needsElevationUpdates=Object(_.f)(r.mode),c}_createAs3DShapeFill(e){const t=e.renderData.polygons;for(const{position:r,mapPosition:i,holeIndices:s,index:a,count:o}of t){if(Object(n.j)(this._context.clippingExtent)&&(Object(y.k)(ds),Object(y.n)(ds,i),!Object(y.w)(ds,this._context.clippingExtent)))continue;const t=Object(u.a)(i,s,3);if(0===t.length)continue;const l=E({indices:new Uint32Array(t),attributeData:{position:r,color:e.color,mapPosition:i,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*a*e.uvMapSpace.BYTES_PER_ELEMENT,4*o):null,boundingRect:this._needsUV?new Float64Array(e.boundingRect.buffer,9*a*e.boundingRect.BYTES_PER_ELEMENT,9*o):null}});e.outGeometries.push(l),e.outMaterials.push(Object(n.s)(this._material)),e.outTransforms.push(f.a),e.outNum++}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines,r=this._outlineMaterial instanceof At.a;for(let i=0;i<t.length;++i){const{mapPosition:s,position:a}=t[i];if(Object(n.j)(this._context.clippingExtent)&&(Object(y.k)(ds),Object(y.n)(ds,s),!Object(y.w)(ds,this._context.clippingExtent)))continue;const o=Object(vt.a)({removeDuplicateStartEnd:r?0:1,attributeData:{position:a,mapPosition:s}}),l=o.vertexAttributes.get("position");l.data===a&&(l.data=new Float64Array(a)),e.outGeometries.push(o),e.outMaterials.push(Object(n.s)(this._outlineMaterial)),e.outTransforms.push(f.a),e.outNum++}}_createAsOverlay(e,t){const r=I(e.geometry);if(Object(n.i)(r))return null;Object(n.s)(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,Object(n.j)(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),ps.renderData=F(r,this._context.overlaySR),ps.color=t;const i=ps.renderData.position.length/3;return this._needsUV&&(ps.uvMapSpace=new Float32Array(4*i)),ps.outNum=0,ps.outGeometries=[],ps.outBoundingBox=Object(y.k)(),ps.layerUid=this._context.layer.uid,ps.graphicsUid=e.uid,this._createAsOverlayFill(ps),this._hasOutline&&this._createAsOverlayOutline(ps),this._logGeometryCreationWarnings(ps.renderData,r.rings,"rings","FillSymbol3DLayer"),0===ps.outNum?null:(this._needsUV&&function(e,t,r,i=1){if(r.isGeographic){const e=new Float64Array(t.typedBuffer.length),i=3*t.count;for(let n=0;n<i;n+=3)Object(g.m)(t.typedBuffer,n,e,n,Object(Pn.e)(r));t=v.v.fromTypedArray(e)}Object(oi.r)(kn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,Rn),kn[0]=Math.min(kn[0],Rn[0]),kn[1]=Math.min(kn[1],Rn[1]);const n=kn[0]%i,s=kn[1]%i;Vn[0]=kn[0]-n,Vn[1]=kn[1]-s;for(let a=0;a<t.count;a++)t.getVec(a,Rn),e.setValues(a,(Rn[0]-Vn[0])/i,(Rn[1]-Vn[1])/i,Vn[0]/i,Vn[1]/i)}(v.C.fromTypedArray(ps.uvMapSpace),v.v.fromTypedArray(ps.renderData.position),this._context.overlaySR),ps.outNum>0?new Te(this,ps.outGeometries,ps.outBoundingBox):null)}_createAsOverlayFill(e){const t=e.renderData.polygons;for(const{position:r,holeIndices:i,index:s,count:a}of t){if(Object(y.k)(ds),Object(y.n)(ds,r),!Object(y.w)(ds,this._context.clippingExtent))continue;const t=Object(u.a)(r,i,3);if(0===t.length)continue;Object(y.m)(e.outBoundingBox,ds);const o=E({indices:new Uint32Array(t),attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*s*e.uvMapSpace.BYTES_PER_ELEMENT,4*a):null}}),l=new st.a(o,Object(n.s)(this._material),e.layerUid,e.graphicsUid),c=ds;Object(fe.l)(l.boundingSphere,.5*(c[0]+c[3]),.5*(c[1]+c[4]),0,.5*Math.sqrt((c[3]-c[0])*(c[3]-c[0])+(c[4]-c[1])*(c[4]-c[1]))),e.outGeometries.push(l),e.outNum++}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let r=0;r<t.length;++r){const{position:i}=t[r];if(Object(y.k)(ds),Object(y.n)(ds,i),!Object(y.w)(ds,this._context.clippingExtent))continue;Object(y.m)(e.outBoundingBox,ds);const s=this._outlineMaterial instanceof At.a,a=Object(vt.a)({removeDuplicateStartEnd:s?0:1,attributeData:{position:i}}),o=new st.a(a,Object(n.s)(this._outlineMaterial),e.layerUid,e.graphicsUid),l=ds;Object(fe.l)(o.boundingSphere,.5*(l[0]+l[3]),.5*(l[1]+l[4]),0,.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]))),e.outGeometries.push(o),e.outNum++}}_getOutlineOpacity(){const e=Object(n.h)(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(Object(n.j)(e)?e.a:0)}_getOutlineColor(){const e=Object(n.h)(this.symbolLayer,"outline","color"),t=this._getOutlineOpacity();return Object(S.g)(Object(n.j)(e)?ce.a.toUnitRGB(e):null,t)}get test(){return{createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,r)=>this._createAs3DShape(e,t,r)}}}us.elevationModeChangeTypes={definedChanged:_.a.RECREATE,staysOnTheGround:_.a.NONE,onTheGroundChanged:_.a.RECREATE};const ds=Object(y.h)(),hs={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},ps={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};var fs=r(218),bs=r(530),ms=r(236),gs=r(440),ys=r(47),vs=r(143);class Os extends ms.a{constructor(e,t,r){super(),this.type=4,this._glTexture=null,this.events=new ur.a,this._requiresPowerOfTwo=!Object(vs.a)(e.gl),this._renderer=new gs.a(t,r)}get width(){return this._renderer.renderedWidth}get height(){return this._renderer.renderedHeight}get textureWidth(){const e=this.width;return this._requiresPowerOfTwo?Object(ze.p)(e):e}get textureHeight(){const e=this.height;return this._requiresPowerOfTwo?Object(ze.p)(e):e}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}get texcoordScale(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]}get requiresFrameUpdates(){return!1}createDescriptor(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}load(e){if(Object(n.j)(this._glTexture))return this._glTexture;const t=Object(gs.b)(js,this.textureWidth,this.textureHeight),r=t.getContext("2d");return r.save(),this._renderer.render(r,0,this.textureHeight-this._renderer.renderedHeight),this._glTexture=new ys.a(e,this.createDescriptor(e),t),r.restore(),this._glTexture}unload(){Object(n.j)(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),this.events.emit("unloaded")}}const js={canvas:null};var _s=Os;const ws=[0,0,1];class xs extends x.a{constructor(e,t,r,i){super(e,t,r,i),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Object(S.k)(this.symbolLayer.size);if(e)throw new c.a("graphics3dtextsymbollayer:invalid-size",e)}this._createTextRenderParameters()}_createTextRenderParameters(){const e=this._context.layerView.view.pixelRatio;this._textRenderParameters=bs.a.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const t=e.graphic,r=Object(Ce.c)(t.geometry);if(Object(n.i)(r))return this.logger.warn(`unsupported geometry type for text symbol: ${t.geometry.type}`),null;const i=this.symbolLayer.text;if(!i)return null;const s=Object(fs.d)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(t,r,i,s)}createLabel(e,t,r,i){const s=e.graphic,a=Object(Ce.c)(s.geometry);if(Object(n.i)(a))return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const o=t.text;return!o||/^\s+$/.test(o)?null:this._createAs3DShape(s,a,o,t,t,r,i)}setGraphicElevationContext(e,t,r=0){const i=super.setGraphicElevationContext(e,t);return i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return Ss(e,t,((e,t)=>{this.updateGraphicElevationContext(t,e)})),_.a.UPDATE}slicePlaneEnabledChanged(e,t){return Ss(e,t,(e=>{for(const t of e.stageObject.geometryRecords)t.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(_.f)(t.elevationContext.mode)||"absolute-height"===t.elevationContext.mode}_defaultElevationInfoNoZ(){return Ts}_createAs3DShape(e,t,r,i,s=Cs,a,l){const c=this.setGraphicElevationContext(e,new w.a,s.elevationOffset),u="polyline"===Object(n.h)(e.geometry,"type"),d=e.uid,h=this._context.stage.renderView.renderingContext,p=s.anchor in S.h?s.anchor:"center",f=S.h[p],b=Object(n.i)(l)?new _s(h,r,this._textRenderParameters):null,m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPos:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawBorder:s.debugDrawBorder,drawInSecondSlot:!0};if(Object(n.j)(b)&&(m.textureId=b.id,m.texCoordScale=b.texcoordScale),Object(n.j)(l)&&(m.textureId=l.id),Object(n.j)(i)&&Object(n.j)(i.verticalOffset)){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=i.verticalOffset;m.verticalOffset={screenLength:Object(de.g)(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:e,screenSizePerspectiveSettingsLabels:t}=this._context.sharedResources;m.screenSizePerspective=t.overridePadding(this._textRenderParameters.haloSize),m.screenSizePerspectiveAlignment=e}let g;if(u&&(m.shaderPolygonOffset=1e-4),m.slicePlaneEnabled=this._context.slicePlaneEnabled,Object(n.j)(a)){const e=JSON.stringify(m);g=a.get(e),Object(n.i)(g)&&(g=new ot.a(m),a.add(e,g))}else g=new ot.a(m);const y=[g],v=s.translation,O=Object(n.j)(b)?[b.displayWidth,b.displayHeight]:[0,0],j=s.centerOffset,x=ws,T=[nt.a.createPointGeometry(x,v,null,O,j,[0,0],null)],C=this._context.layer.uid,M=Object(Ce.a)(this._context,t,T,y,null,null,c,C,d);if(null===M)return null;const P=je.b,A=new o.a(this,M.object,T,Object(n.i)(a)?y:null,Object(n.j)(b)?[b]:null,P,c);A.alignedSampledElevation=M.sampledElevation,A.needsElevationUpdates=Object(_.f)(c.mode)||"absolute-height"===c.mode;const{displayWidth:E,displayHeight:R}=Object(n.j)(b)?b:s;A.getScreenSize=(e=Object(pe.b)())=>(e[0]=E,e[1]=R,e);const I={labelText:r,elevationOffset:s.elevationOffset};return A.metadata=I,Object(Ce.b)(A,t,this._context.elevationProvider),A}}function Ss(e,t,r){e&&e.forEach((e=>{const i=t(e);Object(n.j)(i)&&r(i,e.graphic)}))}const Ts={mode:"relative-to-ground",offset:0},Cs={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};var Ms=r(54),Ps=r(60);class As{constructor(e=!0){this.enabled=e,this._time=0}get time(){return Object(n.j)(this._forcedTime)?this._forcedTime:Object(Ps.a)(this._time)}advance(e){return this.enabled&&(this._time+=e),Object(n.i)(this._forcedTime)&&this.enabled&&0!==e}stopAtTime(e){this._forcedTime=e}}var Es=r(435),Rs=r(521);const Is={waveStrength:.06,waveTextureRepeat:32,waveDirection:Object(pe.f)(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...Gi.b},Ds={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};class Fs extends Gi.a{constructor(e){super(e,Is),this.animation=new As,this.techniqueConfig=new Rs.b}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.useSSR=this.params.ssrEnabled,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<en.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*t<Ls;const r=this.animation.advance(e.dt);return this.animation.enabled&&r}intersect(e,t,r,i,n,s,a){Object(zr.i)(e,t,i,n,s,void 0,a)}getGLMaterial(e){if(0===e.output&&this.params.isDraped){const t=e;return t.output=5,new Es.a(t)}switch(e.output){case 0:case 2:case 4:case 7:return new Es.a(e)}}createBufferWriter(){return new Xn.a(Xn.d)}}const Ls=35e3,ks=["polyline","polygon","extent"];class zs extends x.a{constructor(e,t,r,i){super(e,t,r,i)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,ks,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new w.a);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}ensureMaterial(){if(Object(n.j)(this._material))return;const e={...Is},t=this.symbolLayer.color;Object(n.j)(t)&&(e.color=ce.a.toUnitRGBA(t));const r=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=Object(n.j)(this.symbolLayer.waveDirection)?zs.headingVectorFromAngle(this.symbolLayer.waveDirection):Object(pe.f)(0,0);const i=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=Ds[i];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new Fs(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(Object(n.i)(this._material))return!0;const e=this._material.params.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;return this._material.setParameterValues({color:[e[0],e[1],e[2],t],transparent:r}),!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(_.d)(zs.elevationModeChangeTypes,r,i);if(n!==_.a.UPDATE)return n;const s=Object(_.f)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){return Object(n.j)(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,r){const i=I(e.geometry);if(Object(n.i)(i))return null;Gs.renderData=D(i,this._context.elevationProvider,this._context.renderCoordsHelper,t);const s=Gs.renderData.position.length/3;if(Gs.uvCoords=new Float64Array(2*s),Gs.outNum=0,Gs.outGeometries=[],Gs.outTransforms=[],Gs.outMaterials=[],this._create3DShapeGeometries(Gs),this._logGeometryCreationWarnings(Gs.renderData,i.rings,"rings","WaterSymbol3DLayer"),0===Gs.outNum)return null;this._createUVCoordsFromVertices(Gs.uvCoords,Gs.renderData.mapPosition,s,this._context.elevationProvider.spatialReference);const a=new U.a({geometries:Gs.outGeometries,materials:Gs.outMaterials,transformations:Gs.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),l=je.c,c=new o.a(this,a,Gs.outGeometries,null,null,l,t);return c.alignedSampledElevation=Gs.renderData.sampledElevation,c.needsElevationUpdates=Object(_.f)(t.mode),c}_createUVCoordsFromVertices(e,t,r,i){const n=Object(Ms.f)(i);Object(_e.m)(Ns);for(let o=0;o<r;o++)Object(oi.r)(Us,t[3*o+0],t[3*o+1]),Object(_e.p)(Ns,Us);Object(fe.b)(Ns,Ns,n);const s=Ns[0]%zs.unitSizeOfTexture,a=Ns[1]%zs.unitSizeOfTexture;Vs[0]=Ns[0]-s,Vs[1]=Ns[1]-a;for(let o=0;o<r;o++)e[2*o+0]=(t[3*o+0]*n-Vs[0])/zs.unitSizeOfTexture,e[2*o+1]=(t[3*o+1]*n-Vs[1])/zs.unitSizeOfTexture}_create3DShapeGeometries(e){const t=e.renderData.polygons,r=e.uvCoords;for(const{count:i,index:s,position:a,mapPosition:o,holeIndices:l}of t){if(Object(n.j)(this._context.clippingExtent)&&(Object(y.k)(Bs),Object(y.n)(Bs,o),!Object(y.w)(Bs,this._context.clippingExtent)))continue;const t=Object(u.a)(o,l,3);if(0===t.length)continue;const c=R({indices:new Uint32Array(t),attributeData:{position:a,uv0:new Float64Array(r.buffer,2*s*r.BYTES_PER_ELEMENT,2*i),mapPosition:o}});e.outGeometries.push(c),e.outMaterials.push(Object(n.s)(this._material)),e.outTransforms.push(f.a),e.outNum++}}_createAsOverlay(e){const t=I(e.geometry);if(Object(n.i)(t))return null;Object(n.s)(this._material).renderPriority=this._renderPriority,qs.renderData=F(t,this._context.overlaySR);const r=qs.renderData.position.length/3;return qs.uvCoords=new Float64Array(2*r),qs.outNum=0,qs.outGeometries=[],qs.outBoundingBox=Object(y.k)(),qs.layerUid=this._context.layer.uid,qs.graphicsUid=e.uid,this._createAsOverlayWater(qs),this._logGeometryCreationWarnings(qs.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===qs.outNum?null:(this._createUVCoordsFromVertices(qs.uvCoords,qs.renderData.position,r,this._context.overlaySR),qs.outNum>0?new Te(this,qs.outGeometries,qs.outBoundingBox):null)}_createAsOverlayWater(e){const t=e.uvCoords,r=e.renderData.polygons;for(const{position:i,holeIndices:s,index:a,count:o}of r){if(Object(y.k)(Bs),Object(y.n)(Bs,i),!Object(y.w)(Bs,this._context.clippingExtent))continue;Object(y.m)(e.outBoundingBox,Bs);const r=Object(u.a)(i,s,3);if(0===r.length)continue;const l=R({indices:new Uint32Array(r),attributeData:{position:i,uv0:new Float64Array(t.buffer,2*a*t.BYTES_PER_ELEMENT,2*o)}}),c=new st.a(l,Object(n.s)(this._material),e.layerUid,e.graphicsUid),d=Bs;Object(fe.l)(c.boundingSphere,.5*(d[0]+d[3]),.5*(d[1]+d[4]),0,.5*Math.sqrt((d[3]-d[0])*(d[3]-d[0])+(d[4]-d[1])*(d[4]-d[1]))),e.outGeometries.push(c),e.outNum++}}static headingVectorFromAngle(e){const t=Object(pe.b)(),r=Object(ti.d)(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}get test(){return{create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}zs.unitSizeOfTexture=100,zs.elevationModeChangeTypes={definedChanged:_.a.RECREATE,staysOnTheGround:_.a.NONE,onTheGroundChanged:_.a.RECREATE};const Vs=Object(pe.b)(),Ns=Object(_e.k)(),Us=Object(pe.b)(),Bs=Object(y.h)(),Gs={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},qs={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};const Hs=l.a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function Ws(e,t,r,i){const n=Qs[e.type]&&Qs[e.type][t.type]||$s[t.type];return n?new n(e,t,r,i):(Hs.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const $s={icon:bt,object:Zr,line:wt,path:gn,fill:us,extrude:q,text:xs,water:zs};const Qs={"mesh-3d":{fill:Rt}};var Zs=r(395);class Xs extends Zs.a{constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=[],this.referenced=0,this._extentPadding=0}set symbol(e){if(this._symbol=e,this.symbolLayers)for(let t=0;t<e.symbolLayers.length;t++){const r=this.symbolLayers[t];Object(n.i)(r)||(r.symbol=e,r.symbolLayer=e.symbolLayers.items[t])}}get symbol(){return this._symbol}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const a=[];for(let i=0;i<r;i++){const n=t.getItemAt(i);if(!1===n.enabled)continue;Js.renderPriority=1-(1+i)/r,Js.renderPriorityStep=1/r,Js.ignoreDrivers=n._ignoreDrivers;const o=Ws(this.symbol,n,this._context,Js);a.push(Object(s.t)(e,(()=>{this.symbolLayers[i]=null,o.destroy()}))),this.symbolLayers[i]=o}await Object(i.b)(this.symbolLayers,(async(e,t)=>{if(Object(n.j)(e))try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}}));for(const i of a)null==i||i.remove();if(a.length=0,Object(s.x)(e),this.symbolLayers.length&&!this.symbolLayers.some((e=>!!e)))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return Object(n.j)(t)?t.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(e,t){const r=e.graphic,i=new Array(this.symbolLayers.length);for(let a=0;a<this.symbolLayers.length;a++){const t=this.symbolLayers[a];i[a]=Object(n.j)(t)?t.createGraphics3DGraphic(e):null}const s=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new a.a(r,t||this,i,e.layer,s)}get complexity(){return Object(sr.f)(this.symbolLayers.map((e=>Object(n.h)(e,"complexity"))))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let i=0;i<r;i++){const r=this.symbolLayers[i],s=e=>{const t=e._graphics[i];return t instanceof o.a?t:null};if(Object(n.j)(r)&&!r.globalPropertyChanged(e,t,s))return!1}return!0}applyRendererDiff(e,t){return 1===this.loadStatus&&this.symbolLayers.reduce(((r,i)=>r&&(Object(n.i)(i)||i.applyRendererDiff(e,t))),!0)}prepareSymbolPatch(e){if(2===this.loadStatus)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const r=t.symbolLayers.diff;this.symbolLayers.forEach(((t,i)=>{if(Object(n.i)(t))return;const s=r[i];if(s){const r={diff:s,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(r),e.symbolStatePatches.push(...r.symbolLayerStatePatches),r.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push(((e,t)=>{const s=e._graphics[i];Object(n.j)(s)&&r.graphics3DGraphicPatches.forEach((e=>e(s,t)))}))}}))}updateGeometry(e,t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(Object(n.i)(i))continue;const s=e._graphics[r];if(Object(n.i)(s)||!i.updateGeometry(s,t))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(Object(n.i)(r))continue;const i=e._graphics[t];Object(n.j)(i)&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=0,t=0,r=0;return this.symbolLayers.forEach((i=>{Object(n.i)(i)||(0===i.loadStatus?e++:i.isFastUpdatesEnabled()?r++:t++)})),{loading:e,slow:t,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(const e of this.symbolLayers)Object(n.j)(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const Js={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};t.a=Xs},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(25);const n=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function s(e){const t=Object(i.m)(e,!0);return t&&t.endsWith(".arcgis.com")&&!n.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r(0),n=r(38),s=r(153),a=r(7),o=r(12),l=r(1),c=(r(8),r(9),r(4)),u=r(303);function d(e){return e&&"group"===e.type}function h(e,t,r){let i,n;if(e)for(let s=0,a=e.length;s<a;s++){if(i=e.getItemAt(s),i[t]===r)return i;if(d(i)&&(n=h(i.layers,t,r),n))return n}}const p=a.a.getLogger("esri.support.LayersMixin"),f=e=>{let t=class extends e{constructor(...e){super(...e),this.layers=new n.a;const t=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||p.error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},r=e=>{e.parent=null,this.layerRemoved(e)};this.layers.on("before-add",(e=>(e=>{e.parent&&"remove"in e.parent&&e.parent.remove(e)})(e.item))),this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>r(e.item)))}destroy(){const e=this.layers.removeAll();for(const t of e)this.layerRemoved(t),t.destroy();this.layers.destroy()}set layers(e){this._set("layers",Object(s.b)(e,this._get("layers")))}add(e,t){const r=this.layers;if(t=r.getNextIndex(t),e instanceof u.a){const i=e;i.parent===this?this.reorder(i,t):r.add(i,t)}else Object(o.q)(e)?e.then((e=>{this.destroyed||this.add(e,t)})):p.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const r=this.layers;t=r.getNextIndex(t),e.slice().forEach((e=>{e.parent!==this?(r.add(e,t),t+=1):this.reorder(e,t)}))}findLayerById(e){return h(this.layers,"id",e)}findLayerByUid(e){return h(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return Object(i.a)([Object(l.b)()],t.prototype,"layers",null),t=Object(i.a)([Object(c.a)("esri.support.LayersMixin")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var i=r(0),n=r(38),s=r(153),a=r(7),o=r(1),l=(r(8),r(9),r(4));const c="esri.support.TablesMixin",u=a.a.getLogger(c);function d(e){return e&&"group"===e.type}function h(e,t,r){if(e)for(let i=0,n=e.length;i<n;i++){const n=e.getItemAt(i);if(n[t]===r)return n;if(d(n)){const e=h(n.tables,t,r);if(e)return e}}}const p=e=>{let t=class extends e{constructor(...e){super(...e),this.tables=new n.a,this.tables.on("after-add",(e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,"feature"!==t.type&&u.error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(e=>{e.item.parent=null}))}destroy(){const e=this.tables.removeAll();for(const t of e)t.destroy();this.tables.destroy()}set tables(e){this._set("tables",Object(s.b)(e,this._get("tables")))}findTableById(e){return h(this.tables,"id",e)}findTableByUid(e){return h(this.tables,"uid",e)}};return Object(i.a)([Object(o.b)()],t.prototype,"tables",null),t=Object(i.a)([Object(l.a)(c)],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return n}));var i=r(57);const n=Math.PI/180,s=/SPHEROID\[([^\]]+)]/i,a=i.a.radius,o=i.a.eccentricitySquared,l={a1:a*o,a2:a*o*a*o,a3:a*o*o/2,a4:a*o*a*o*2.5,a5:a*o+a*o*o/2,a6:1-o},c={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:i.a.radius,f:i.a.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:i.c.radius,f:i.c.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:i.b.radius,f:i.b.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:i.b.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}}},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(4));let l=i=class extends s.a{constructor(e){super(e),this.name=null,this.code=null}clone(){return new i({name:this.name,code:this.code})}};Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],l.prototype,"name",void 0),Object(n.a)([Object(a.b)({type:[String,Number],json:{write:!0}})],l.prototype,"code",void 0),l=i=Object(n.a)([Object(o.a)("esri.layers.support.CodedValue")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return l})),r.d(t,"i",(function(){return c}));var i=r(10),n=r(134),s=r(54),a=r(151);function o(e,t,r,i=2,n="abbr"){return`${Object(a.b)(t,{minimumFractionDigits:i,maximumFractionDigits:i})} ${function(e,t,r){return e.units[t][r]}(e,r,n)}`}function l(e,t,r,i=2,n="abbr"){const a=Object(s.s)(t,r);return o(e,Object(s.c)(t,r,a),a,i,n)}function c(e,t,r,i=2,n="abbr"){const a=Object(s.t)(t,r);return o(e,Object(s.c)(t,r,a),a,i,n)}function u(e,t,r,i=2,n="abbr"){const a=Object(s.p)(t,r);return o(e,Object(s.c)(t,r,a),a,i,n)}function d(e,t,r,i=2,n="abbr"){const a=Object(s.q)(t,r);return o(e,Object(s.c)(t,r,a),a,i,n)}function h(e,t,r,i=2,n="abbr"){const a=Object(s.r)(t,r);return o(e,Object(s.c)(t,r,a),a,i,n)}function p(e,t,r,i=2,n="abbr"){const a=Object(s.o)(t,r);return o(e,Object(s.c)(t,r,a),a,i,n)}function f(e,t,r=2){let i=Object(s.c)(e,t,"degrees"),n=i-Math.floor(i);i-=n,n*=60;let a=n-Math.floor(n);return n-=a,a*=60,`${i.toFixed()}\xb0 ${n.toFixed()}' ${a.toFixed(r)}"`}const b=["B","kB","MB","GB","TB"];function m(e,t){let r=0===t?0:Math.floor(Math.log(t)/Math.log(1024));r=Object(i.e)(r,0,b.length-1);const s=Object(a.b)(t/1024**r,{maximumFractionDigits:2});return Object(n.c)(e.units.bytes[b[r]],{fileSize:s})}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i,n=r(0),s=r(14),a=r(1),o=(r(8),r(9)),l=(r(7),r(37)),c=r(4);let u=i=class extends s.a{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new i({mapLayerId:e,gdbVersion:t})}};Object(n.a)([Object(l.a)({mapLayer:"map-layer"})],u.prototype,"type",void 0),Object(n.a)([Object(a.b)({type:o.a,json:{write:!0}})],u.prototype,"mapLayerId",void 0),Object(n.a)([Object(a.b)({type:String,json:{write:!0}})],u.prototype,"gdbVersion",void 0),u=i=Object(n.a)([Object(c.a)("esri.layers.support.source.MapLayerSource")],u)},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(636);function n(e,t){const r=Object(i.a)(e,t),n=r.queryResult.featureResult,s=r.queryResult.queryGeometry,a=r.queryResult.queryGeometryType;if(n&&n.features&&n.features.length&&n.objectIdFieldName){const e=n.objectIdFieldName;for(const t of n.features)t.attributes&&(t.objectId=t.attributes[e])}return n&&(n.queryGeometry=s,n.queryGeometryType=a),n}},function(e,t,r){"use strict";r.d(t,"a",(function(){return P})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return x}));var i=r(11),n=r(2),s=r(590),a=r(205),o=r(599);const l=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],c=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],u=["upperLeft","lowerLeft"];function d(e){return e>=l.length?null:l[e]}function h(e){return e>=c.length?null:c[e]}function p(e){return e>=u.length?null:u[e]}function f(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function b(e,t,r){const i=t.createPointGeometry(r);for(;e.next();)switch(e.tag()){case 3:{const r=e.getUInt32(),n=e.pos()+r;let s=0;for(;e.pos()<n;)t.addCoordinatePoint(i,e.getSInt64(),s++);break}case 1:case 2:default:e.skip()}return i}function m(e,t,r){const i=t.createGeometry(r),n=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const r=e.getUInt32(),n=e.pos()+r;let s=0;for(;e.pos()<n;)t.addLength(i,e.getUInt32(),s++);break}case 3:{const r=e.getUInt32(),s=e.pos()+r;let a=0;for(t.allocateCoordinates(i);e.pos()<s;)t.addCoordinate(i,e.getSInt64(),a),a++,a===n&&(a=0);break}case 1:default:e.skip()}return i}function g(e){const t=new a.a;let r="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const r=e.getUInt32(),i=e.pos()+r;for(;e.pos()<i;)t.lengths.push(e.getUInt32());break}case 3:{const r=e.getUInt32(),i=e.pos()+r;for(;e.pos()<i;)t.coords.push(e.getSInt64());break}case 1:r=o.a[e.getEnum()];break;default:e.skip()}return{queryGeometry:t,queryGeometryType:r}}function y(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function v(e){const t={type:d(0)};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=d(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=h(e.getEnum());break;case 5:e.skip();break;case 6:t.defaultValue=e.getString();break;default:e.skip()}return t}function O(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.isSystemMaintained=e.getBool();break;default:e.skip()}return t}function j(e,t,r,i){const n=t.createFeature(r);let s=0;for(;e.next();)switch(e.tag()){case 1:{const t=i[s++].name;n.attributes[t]=e.processMessage(y);break}case 2:n.geometry=e.processMessageWithArgs(m,t,r);break;case 4:n.centroid=e.processMessageWithArgs(b,t,r);break;default:e.skip()}return n}function _(e){const t=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function w(e){const t=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function x(e){const t={originPosition:p(0)};for(;e.next();)switch(e.tag()){case 1:t.originPosition=p(e.getEnum());break;case 2:t.scale=e.processMessage(_);break;case 3:t.translate=e.processMessage(w);break;default:e.skip()}return t}function S(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function T(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function C(e,t){const r=t.createFeatureResult();r.geometryType=f(t,0);let i=!1;for(;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(S);break;case 7:r.geometryType=f(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(T,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(x);break;case 9:{const t=e.getBool();r.exceededTransferLimit=t;break}case 13:t.addField(r,e.processMessage(v));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,e.processMessageWithArgs(j,t,r,r.fields));break;case 2:r.uniqueIdField=e.processMessage(O);break;case 6:default:e.skip()}return t.finishFeatureResult(r),r}function M(e,t){const r={};let i=null;for(;e.next();)switch(e.tag()){case 4:i=e.processMessageWithArgs(g);break;case 1:r.featureResult=e.processMessageWithArgs(C,t);break;case 2:case 3:default:e.skip()}return Object(n.j)(i)&&r.featureResult&&t.addQueryGeometry(r,i),r}function P(e,t){try{const r=2,i=new s.a(new Uint8Array(e),new DataView(e)),n={};for(;i.next();)switch(i.tag()){case r:n.queryResult=i.processMessageWithArgs(M,t);break;default:i.skip()}return n}catch(r){throw new i.a("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}},function(e,t,r){"use strict";var i,n=r(0),s=r(14),a=r(17),o=r(1),l=(r(8),r(9),r(7),r(4));let c=i=class extends s.a{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new i({label:this.label,size:this.size,value:this.value})}};Object(n.a)([Object(o.b)({type:String,json:{write:!0}})],c.prototype,"label",void 0),Object(n.a)([Object(o.b)({type:Number,cast:a.j,json:{write:!0}})],c.prototype,"size",void 0),Object(n.a)([Object(o.b)({type:Number,json:{write:!0}})],c.prototype,"value",void 0),c=i=Object(n.a)([Object(l.a)("esri.renderers.visualVariables.support.SizeStop")],c);var u=c;t.a=u},function(e,t,r){"use strict";var i=r(0),n=r(38),s=r(14),a=r(1),o=(r(8),r(9),r(7),r(4));let l=class extends s.a{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new n.a}};Object(i.a)([Object(a.b)({type:String,json:{write:!0}})],l.prototype,"floorField",void 0),Object(i.a)([Object(a.b)({json:{read:!1,write:!1}})],l.prototype,"viewAllMode",void 0),Object(i.a)([Object(a.b)({json:{read:!1,write:!1}})],l.prototype,"viewAllLevelIds",void 0),l=Object(i.a)([Object(o.a)("esri.layers.support.LayerFloorInfo")],l);var c=l;t.a=c},function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return f}));r(113),r(8);var i=r(7),n=r(2),s=r(54),a=r(28),o=r(156),l=r(46),c=r(41);const u=i.a.getLogger("esri.layers.support.ElevationSampler");class d{queryElevation(e){return f(e.clone(),this)}on(){return g}projectIfRequired(e,t){return b(e,t)}}class h extends d{constructor(e,t,r){super(),this.tile=e,this.noDataValue=r,this.extent=Object(a.z)(e.tile.extent,t.spatialReference);const i=Object(s.f)(t.spatialReference),n=t.lodAt(e.tile.level).resolution*i;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(e){const t=this.projectIfRequired(e,this.spatialReference);return Object(o.e)(this.extent,t)}elevationAt(e){const t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;if(!this.contains(e)){const t=this.extent,r=`${t.xmin}, ${t.ymin}, ${t.xmax}, ${t.ymax}`;u.warn("#elevationAt()",`Point used to sample elevation (${e.x}, ${e.y}) is outside of the sampler extent (${r})`)}return this.tile.sample(t.x,t.y)}}class p extends d{constructor(e,t,r){let i;super(),"number"==typeof t?(this.noDataValue=t,i=null):(i=t,this.noDataValue=r),this.samplers=i?e.map((e=>new h(e,i,this.noDataValue))):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:e,max:t}=n.demResolution;this.demResolution={min:e,max:t};for(let r=1;r<this.samplers.length;r++){const e=this.samplers[r];this.extent.union(e.extent),this.demResolution.min=Math.min(this.demResolution.min,e.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,e.demResolution.max)}}else this.extent=Object(a.z)(Object(a.k)(),i.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(e){const t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;for(const r of this.samplers)if(r.contains(t))return r.elevationAt(t);return u.warn("#elevationAt()",`Point used to sample elevation (${e.x}, ${e.y}) is outside of the sampler`),null}}function f(e,t){const r=b(e,t.spatialReference);if(!r)return null;switch(e.type){case"point":!function(e,t,r){e.z=Object(n.t)(r.elevationAt(t),0)}(e,r,t);break;case"polyline":!function(e,t,r){m.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const a=e.paths[s],o=t.paths[s];for(let e=0;e<a.length;e++){const t=a[e],s=o[e];m.x=s[0],m.y=s[1],i&&(t[3]=t[2]),t[2]=Object(n.t)(r.elevationAt(m),0)}}e.hasZ=!0}(e,r,t);break;case"multipoint":!function(e,t,r){m.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const a=e.points[s],o=t.points[s];m.x=o[0],m.y=o[1],i&&(a[3]=a[2]),a[2]=Object(n.t)(r.elevationAt(m),0)}e.hasZ=!0}(e,r,t)}return e}function b(e,t){const r=e.spatialReference;return r.equals(t)?e:Object(l.a)(r,t)?Object(l.d)(e,t):(u.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),null)}const m=new c.a,g={remove(){}}},function(e,t,r){"use strict";function i(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}r.d(t,"a",(function(){return i}));const n=i();Object.freeze({__proto__:null,create:i,clone:function(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(e,t,r,i,n,s,a,o,l,c,u,d,h,p,f,b){const m=new Float32Array(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=i,m[4]=n,m[5]=s,m[6]=a,m[7]=o,m[8]=l,m[9]=c,m[10]=u,m[11]=d,m[12]=h,m[13]=p,m[14]=f,m[15]=b,m},createView:function(e,t){return new Float32Array(e,t,16)},IDENTITY:n})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(107),n=r(316),s=r(183),a=r(6);function o(e,t){t.multipassGeometryEnabled&&e.vertex.include(n.b),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(a.a`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?a.a`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.multipassTerrainEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.multipassTerrainEnabled&&e.fragment.include(i.a),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(s.a),e.fragment.code.add(a.a`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.multipassTerrainEnabled?a.a`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},function(e,t,r){"use strict";t.a=class{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}}},function(e,t,r){"use strict";var i=r(102),n=r(457),s=r(2),a=r(104),o=r(18),l=r(27),c=r(3),u=r(5),d=r(144),h=r(36),p=r(22),f=r(28),b=r(191),m=r(409),g=r(223);const y=new a.a(Array,(e=>Object(p.B)(e,p.c)),null,10,5),v=Object(f.k)();t.a=class{constructor(e,t,r,i,n){this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=function(e,t){const r=new Array(e);for(let i=0;i<r.length;i++)r[i]=new Array(t);return r}(2,4),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++t.referenced,this.graphics3DSymbol=t,this.graphic=e,this._graphics=r,this._featureExpressionFeature=n?Object(g.d)(n,e,i):null;for(const a of this._graphics)Object(s.j)(a)&&(this.isElevationSource=this.isElevationSource||a.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(e,t,r){this._layer=t,this._stage=e,this.forEachSymbolLayerGraphic((i=>{i.initialize(e,t,r),i.setVisibility(this.isVisible())}))}destroy(){this.forEachSymbolLayerGraphic((e=>e.destroy())),this._graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this._graphics}clearLabelGraphics(){this.forEachLabelGraphic((e=>e.destroy())),this._labelGraphics.length=0}addLabelGraphic(e,t,r){this._labelGraphics.push(e),e.initialize(t,r),e.setVisibility(this.isVisible(1))}addAuxiliaryGraphic(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this.forEachSymbolLayerGraphic((t=>{"draped"===t.type&&(e=!0)})),e}isVisible(e=0,t){for(let r=0;r<=e;r++){const e=this._visibilityFlags[r];for(let r=0;r<e.length;++r)if(!1===e[r]&&r!==t)return!1}return!0}hasVisibilityFlag(e,t){return null!=this._visibilityFlags[t][e]}setVisibilityFlag(e,t,r){const i=this.isVisible(r);this._visibilityFlags[r][e]=t;const n=this.isVisible(r);if(i===n)return!1;if(1===r)this.forEachLabelGraphic((e=>e.setVisibility(n)));else{this.forEachSymbolLayerGraphic((e=>e.setVisibility(n)));const e=this.isVisible(1);this.forEachLabelGraphic((t=>t.setVisibility(e)))}return!0}clearVisibilityFlag(e,t=0){return this.setVisibilityFlag(e,void 0,t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(Object(s.i)(t))return!1;this._extent=Object(f.k)(),Object(b.d)(t,this._extent);const r=t.spatialReference;if(!r.equals(e)&&!Object(h.o)(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===t||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=t),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return"mesh"!==i.type&&"extent"!==i.type||(i=d.a.fromExtent("mesh"===i.type?i.extent:i)),Object(m.d)(i,t,r)}get usedMemory(){let e=Object(n.a)(this.graphic.attributes);return this.forEachSymbolLayerGraphic((t=>{const r=t.graphics3DSymbolLayer.complexity;if(Object(s.i)(r))return;const i="draped"===t.type?r.memory.draped:r.memory;e+=i.bytesPerFeature,i.bytesPerCoordinate&&(e+=Object(b.k)(this.graphic.geometry)*i.bytesPerCoordinate)})),e}computeAttachmentOrigin(){const e={render:{origin:Object(u.e)(),num:0},draped:{origin:Object(l.b)(),num:0}};for(const t of this._graphics)Object(s.i)(t)||t.computeAttachmentOrigin(e);return e.render.num&&Object(c.g)(e.render.origin,e.render.origin,1/e.render.num),e.draped.num&&Object(o.b)(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,n,a){return a||(a={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),a.boundingBox?Object(p.k)(a.boundingBox):a.boundingBox=Object(p.k)(),a.requiresDrapedElevation=!1,await Object(i.b)(this._graphics,(async i=>{if(Object(s.i)(i))return;const o="draped"===i.type?t:e,l=y.acquire(),c=await i.getProjectedBoundingBox(o,r,a.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(a.requiresDrapedElevation=!0),c&&Object(p.m)(a.boundingBox,l),y.release(l)})),Object(p.d)(a.boundingBox)||Object(f.c)(Object(p.F)(a.boundingBox,v))?a:null}needsElevationUpdates(){for(const e of this._graphics)if(Object(s.j)(e)&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;for(const e of this._labelGraphics)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,t,r){this.forEachRenderedGraphic((i=>{"object3d"!==i.type&&"lod-instance"!==i.type||i.alignWithElevation(e,t,this._featureExpressionFeature,r)}))}addObjectStateSet(e,t){this.forEachSymbolLayerGraphic((r=>r.addObjectState(e,t)))}removeObjectState(e){this.forEachSymbolLayerGraphic((t=>t.removeObjectState(e)))}forEachGraphicList(e,t){e.forEach((e=>e&&t(e)))}forEachSymbolLayerGraphic(e){this.forEachGraphicList(this._graphics,e),this.forEachGraphicList(this._auxiliaryGraphics,e)}forEachLabelGraphic(e){this.forEachGraphicList(this._labelGraphics,e)}forEachRenderedGraphic(e){this.forEachSymbolLayerGraphic(e),this.forEachLabelGraphic(e)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(i.a`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add("size","float"),e.vertex.code.add(i.a`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(i.a`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.vertex.code.add(i.a`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(i.a`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add("color","vec4"),e.vertex.code.add(i.a`vec4 getColor(){
return applyOpacity(color);
}`))}},function(e,t,r){"use strict";r.r(t),r.d(t,"fetch",(function(){return C})),r.d(t,"gltfToEngineResources",(function(){return P})),r.d(t,"parseUrl",(function(){return M}));var i=r(402),n=r(2),s=r(52),a=r(83),o=r(16),l=r(20),c=r(3),u=r(5),d=r(22),h=r(21),p=r(168),f=r(528),b=r(338),m=r(486),g=r(489),y=r(529),v=r(439),O=r(100),j=r(193),_=r(199),w=r(368),x=r(475),S=r(421),T=r(376);async function C(e,t){const r=M(Object(i.a)(e));if("wosr"===r.fileType){const e=await(t.cache?t.cache.loadWOSR(r.url,t):Object(v.a)(r.url,t)),i=Object(v.b)(e,t);return{lods:[i],referenceBoundingBox:i.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:e.remove}}const s=await(t.cache?t.cache.loadGLTF(r.url,t,t.usePBR):Object(g.a)(new m.a(t.streamDataRequester),r.url,t,t.usePBR)),a=Object(n.h)(s.model.meta,"ESRI_proxyEllipsoid");s.meta.isEsriSymbolResource&&Object(n.j)(a)&&-1!==s.meta.uri.indexOf("/RealisticTrees/")&&function(e,t){for(let r=0;r<e.model.lods.length;++r){const i=e.model.lods[r];e.customMeta.esriTreeRendering=!0;for(const s of i.parts){const i=s.attributes.normal;if(Object(n.i)(i))return;const a=s.attributes.position,d=a.count,p=Object(u.e)(),f=Object(u.e)(),m=Object(u.e)(),g=Object(b.a)(h.J,d),y=Object(b.a)(h.u,d),v=Object(o.a)(Object(l.d)(),s.transform);for(let n=0;n<d;n++){a.getVec(n,f),i.getVec(n,p),Object(c.s)(f,f,s.transform),Object(c.l)(m,f,t.center),Object(c.e)(m,m,t.radius);const o=m[2],l=Object(c.r)(m),u=Math.min(.45+.55*l*l,1);Object(c.e)(m,m,t.radius),Object(c.s)(m,m,v),Object(c.t)(m,m),r+1!==e.model.lods.length&&e.model.lods.length>1&&Object(c.k)(m,m,p,o>-1?.2:Math.min(-4*o-3.8,1)),y.setVec(n,m),g.set(n,0,255*u),g.set(n,1,255*u),g.set(n,2,255*u),g.set(n,3,255)}s.attributes.normal=y,s.attributes.color=g}}}(s,a);const d=s.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:s.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},p={...t.materialParamsMixin,treeRendering:s.customMeta.esriTreeRendering};if(null!=r.specifiedLodIndex){const e=P(s,d,p,r.specifiedLodIndex);let t=e[0].boundingBox;return 0!==r.specifiedLodIndex&&(t=P(s,d,p,0)[0].boundingBox),{lods:e,referenceBoundingBox:t,isEsriSymbolResource:s.meta.isEsriSymbolResource,isWosr:!1,remove:s.remove}}const f=P(s,d,p);return{lods:f,referenceBoundingBox:f[0].boundingBox,isEsriSymbolResource:s.meta.isEsriSymbolResource,isWosr:!1,remove:s.remove}}function M(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function P(e,t,r,i){const o=e.model,l=Object(a.b)(),c=new Array,u=new Map,m=new Map;return o.lods.forEach(((e,a)=>{if(void 0!==i&&a!==i)return;const g={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(n.j)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(d.k)()};c.push(g),e.parts.forEach((e=>{const i=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),a=o.materials.get(e.material),c=Object(n.j)(e.attributes.texCoord0),v=Object(n.j)(e.attributes.normal);if(!u.has(i)){if(c){if(Object(n.j)(a.textureColor)&&!m.has(a.textureColor)){const e=o.textures.get(a.textureColor),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureColor,new j.a(e.data,t))}if(Object(n.j)(a.textureNormal)&&!m.has(a.textureNormal)){const e=o.textures.get(a.textureNormal),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureNormal,new j.a(e.data,t))}if(Object(n.j)(a.textureOcclusion)&&!m.has(a.textureOcclusion)){const e=o.textures.get(a.textureOcclusion),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureOcclusion,new j.a(e.data,t))}if(Object(n.j)(a.textureEmissive)&&!m.has(a.textureEmissive)){const e=o.textures.get(a.textureEmissive),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureEmissive,new j.a(e.data,t))}if(Object(n.j)(a.textureMetallicRoughness)&&!m.has(a.textureMetallicRoughness)){const e=o.textures.get(a.textureMetallicRoughness),t={...e.parameters,preMultiplyAlpha:!0};m.set(a.textureMetallicRoughness,new j.a(e.data,t))}}const s=a.color[0]**(1/w.a),l=a.color[1]**(1/w.a),d=a.color[2]**(1/w.a),h=a.emissiveFactor[0]**(1/w.a),p=a.emissiveFactor[1]**(1/w.a),f=a.emissiveFactor[2]**(1/w.a);u.set(i,new _.a({...t,transparent:"BLEND"===a.alphaMode,textureAlphaMode:A(a.alphaMode),textureAlphaCutoff:a.alphaCutoff,diffuse:[s,l,d],ambient:[s,l,d],opacity:a.opacity,doubleSided:a.doubleSided,doubleSidedType:"winding-order",cullFace:a.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:v?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(n.j)(a.textureColor)&&c?m.get(a.textureColor).id:void 0,colorMixMode:a.colorMixMode,normalTextureId:Object(n.j)(a.textureNormal)&&c?m.get(a.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:Object(n.j)(a.textureOcclusion)&&c?m.get(a.textureOcclusion).id:void 0,emissiveTextureId:Object(n.j)(a.textureEmissive)&&c?m.get(a.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(n.j)(a.textureMetallicRoughness)&&c?m.get(a.textureMetallicRoughness).id:void 0,emissiveFactor:[h,p,f],mrrFactors:[a.metallicFactor,a.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...r}))}const C=function(e,t){switch(t){case 4:return Object(y.c)(e);case 5:return Object(y.b)(e);case 6:return Object(y.a)(e)}}(e.indices||e.attributes.position.count,e.primitiveType),M=e.attributes.position.count,P=Object(b.a)(h.u,M);Object(p.e)(P,e.attributes.position,e.transform);const E=[["position",{data:P.typedBuffer,size:P.elementCount,exclusive:!0}]],R=[["position",C]];if(Object(n.j)(e.attributes.normal)){const t=Object(b.a)(h.u,M);Object(s.a)(l,e.transform),Object(p.a)(t,e.attributes.normal,l),E.push(["normal",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),R.push(["normal",C])}if(Object(n.j)(e.attributes.tangent)){const t=Object(b.a)(h.C,M);Object(s.a)(l,e.transform),Object(f.c)(t,e.attributes.tangent,l),E.push(["tangent",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),R.push(["tangent",C])}if(Object(n.j)(e.attributes.texCoord0)){const t=Object(b.a)(h.m,M);Object(x.b)(t,e.attributes.texCoord0),E.push(["uv0",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),R.push(["uv0",C])}if(Object(n.j)(e.attributes.color)){const t=Object(b.a)(h.J,M);if(4===e.attributes.color.elementCount)e.attributes.color instanceof h.C?Object(f.b)(t,e.attributes.color,255):e.attributes.color instanceof h.J?Object(S.a)(t,e.attributes.color):e.attributes.color instanceof h.H&&Object(f.b)(t,e.attributes.color,1/256);else{Object(S.b)(t,255,255,255,255);const r=new h.B(t.buffer,0,4);e.attributes.color instanceof h.u?Object(p.d)(r,e.attributes.color,255):e.attributes.color instanceof h.B?Object(T.a)(r,e.attributes.color):e.attributes.color instanceof h.z&&Object(p.d)(r,e.attributes.color,1/256)}E.push(["color",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),R.push(["color",C])}const I=new O.a(E,R);g.stageResources.geometries.push(I),g.stageResources.materials.push(u.get(i)),c&&(Object(n.j)(a.textureColor)&&g.stageResources.textures.push(m.get(a.textureColor)),Object(n.j)(a.textureNormal)&&g.stageResources.textures.push(m.get(a.textureNormal)),Object(n.j)(a.textureOcclusion)&&g.stageResources.textures.push(m.get(a.textureOcclusion)),Object(n.j)(a.textureEmissive)&&g.stageResources.textures.push(m.get(a.textureEmissive)),Object(n.j)(a.textureMetallicRoughness)&&g.stageResources.textures.push(m.get(a.textureMetallicRoughness))),g.numberOfVertices+=M;const D=I.boundingInfo;Object(n.j)(D)&&(Object(d.r)(g.boundingBox,D.getBBMin()),Object(d.r)(g.boundingBox,D.getBBMax()))}))})),c}function A(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":return 1;default:return 0}}},function(e,t,r){"use strict";var i=r(2),n=r(395),s=r(273);class a extends n.a{constructor(e,t,r){super(t),this.symbol=e,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return Object(i.j)(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get extentPadding(){return Object(i.j)(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this.convert(t),await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return Object(i.j)(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return Object(i.j)(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:s.e}globalPropertyChanged(e,t){return!!Object(i.j)(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return!!Object(i.j)(this.graphics3DSymbol)&&this.graphics3DSymbol.applyRendererDiff(e,t)}prepareSymbolPatch(e){Object(i.j)(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return!!Object(i.j)(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,t)}onRemoveGraphic(){}getFastUpdateStatus(){return Object(i.j)(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){Object(i.j)(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,this.abortLoad()}get destroyed(){return void 0===this.graphics3DSymbol}}t.a=a},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l}));r(113);var i=r(87),n=r(2),s=r(12),a=r(80),o=r(243);class l{constructor(e,t){this.spatialReference=e,this.view=t}getElevation(e,t,r){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,i,n){return this.view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,r,i)}}class c{constructor(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...i,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(a.b.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,t,r,n=0){return new Promise(((a,o)=>{const l={x:e,y:t,minDemResolution:n,result:{resolve:a,reject:o},signal:r};this._queries.push(l),Object(s.s)(r,(()=>{Object(i.j)(this._queries,l),o(Object(s.f)())}))}))}get running(){return this._queries.length>0}runTask(){const e=this._queries;this._queries=[];const t=this._getElevationQueryProvider();if(!t)return void e.forEach((e=>e.result.reject()));const r=e.map((e=>[e.x,e.y])),i=e.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),a=new o.a({points:r,spatialReference:this.spatialReference}),l=e.length>1&&e.some((e=>!!e.signal))?Object(s.e)():null,c=Object(n.j)(l)?l.signal:e[0].signal;if(Object(n.j)(l)){let t=0;e.forEach((r=>Object(s.s)(r.signal,(()=>{t++,r.result.reject(Object(s.f)()),t===e.length&&l.abort()}))))}const u={...this._queryOptions,minDemResolution:i,signal:c};t.queryElevation(a,u).then((t=>{e.forEach(((e,r)=>{Object(n.j)(e.signal)&&e.signal.aborted?e.result.reject(Object(s.f)()):e.result.resolve(t.geometry.points[r][2])}))})).catch((t=>{e.forEach((e=>e.result.reject(t)))}))}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask()}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));class i{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}}class n{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(2),n=r(448);class s extends n.a{constructor(e=null){super("LercWorker","_decode",e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,t,r){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},r):Promise.resolve(null)}getTransferList(e){return[e.buffer]}release(){--this.ref<=0&&(a.forEach(((e,t)=>{e===this&&a.delete(t)})),this.destroy())}}const a=new Map;function o(e=null){let t=a.get(Object(i.s)(e));return t||(Object(i.j)(e)?(t=new s((t=>e.schedule(t))),a.set(e,t)):(t=new s,a.set(null,t))),++t.ref,t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.attributes.add("position","vec2"),e.attributes.add("uv0","vec2"),e.vertex.uniforms.add("u_scale","float"),e.vertex.uniforms.add("u_offset","vec2"),e.varyings.add("v_texcoord","vec2"),e.vertex.code.add(i.a`void main(void) {
v_texcoord = uv0 * u_scale + u_offset;
gl_Position = vec4(position, 0.0, 1.0);
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.fragment.uniforms.add("u_colormap","sampler2D"),e.fragment.uniforms.add("u_colormapOffset","float"),e.fragment.uniforms.add("u_colormapMaxIndex","float"),e.fragment.code.add(i.a`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
vec4 color = texture2D(u_colormap, clrPosition);
result = vec4(color.rgb, 1.0) * color.a * u_opacity;
}
return result;
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),1===t.viewingMode?e.vertex.code.add(i.a`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(i.a`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(i.a`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e){e.vertex.code.add(i.a`vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {
float skirtLength = 0.0;
if (uv.x >= 2.0) {
skirtLength = uv.y * skirtScale;
vec2 x = vec2(uv.x) - vec2(3.5, 4.5);
uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));
}
return vpos - vnormal * skirtLength;
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add("texOffsetAndScale","vec4"),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("compositeBackground","bool"),e.fragment.uniforms.add("textureOpacity","float"),e.fragment.uniforms.add("baseOpacity","float"),t.textureFadingEnabled&&(e.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add("texNext","sampler2D"),e.fragment.uniforms.add("textureFadeFactor","float")),e.vertex.code.add(i.a`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${t.textureFadingEnabled?i.a`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:i.a``}
  }
  `),t.useGrid?(e.fragment.code.add(i.a`float lineFactorAtPosition(float value) {
float pos = value * 129.0;
if(pos < 0.5 || pos > 128.5) {
return 1.0;
}
pos = pos + 0.5;
float modulo = mod(pos, 16.0);
return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
}
float lineFactorAtUV(vec2 uv) {
return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
}
float lineFactor(vec2 uv) {
vec2 offset = fwidth(uv) * 0.25;
return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
}`),e.fragment.code.add(i.a`
    vec4 getTileColor() {
      vec4 color = ${t.textureFadingEnabled?i.a`textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:i.a`texture2D(tex, vtc);`};
      if(!compositeBackground) {
        return color;
      }

      float line = lineFactor(vtc) * 0.1 + 0.9;
      vec4 gridColor = vec4(1.0, 0.972, 0.918, 1.0) * line * baseOpacity;
      float alpha = textureOpacity * color.a;
      return mix(gridColor, color, alpha);
    }`)):t.hasBackgroundColor?(e.fragment.uniforms.add("backgroundColor","vec4"),e.fragment.code.add(i.a`
    vec4 getTileColor() {
      vec4 color = ${t.textureFadingEnabled?i.a`textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:i.a`texture2D(tex, vtc);`};
      float alpha = textureOpacity * color.a;
      return compositeBackground ? mix(backgroundColor * baseOpacity, color, alpha) : color;
    }`)):e.fragment.code.add(i.a`
    vec4 getTileColor() {
      return ${t.textureFadingEnabled?i.a`textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:i.a`texture2D(tex, vtc);`}
  }
  `)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(526),n=r(6);function s(e,t){1===t.componentData&&(e.vertex.uniforms.add("uComponentColorTex","sampler2D"),e.vertex.uniforms.add("uComponentColorTexInvDim","vec2"),e.attributes.add("componentIndex","float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(i.a),e.vertex.code.add(n.a`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y
);
return texture2D(uComponentColorTex, indexCoord);
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),e.fragment.code.add(n.a`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)),0===t.componentData&&(e.vertex.uniforms.add("uExternalColor","vec4"),e.fragment.uniforms.add("uExternalColorMixMode","int"),e.varyings.add("vExternalColor","vec4"),e.vertex.code.add(n.a`vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = uExternalColor;
castShadows = true;
return uExternalColor;
}`),e.fragment.code.add(n.a`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = uExternalColorMixMode;
}`))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){const r=e.vertex;switch(r.code.add(i.a`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case 0:r.code.add(i.a`#define vertexDiscardByOpacity(_opacity_) {}`);break;case 2:r.code.add(i.a`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case 1:r.code.add(i.a`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(398),n=r(525),s=r(6);function a(e,t){const r=e.fragment;t.baseColorTexture?(e.include(i.a,t),r.uniforms.add("uBaseColorTexture","sampler2D"),r.uniforms.add("uBaseColorTextureSize","vec2"),2===t.attributeTextureCoordinates?(e.include(n.a),r.code.add(s.a`vec4 readBaseColorTexture() {
return textureAtlasLookup(
uBaseColorTexture,
uBaseColorTextureSize,
vuv0,
vuvRegion
);
}`)):r.code.add(s.a`vec4 readBaseColorTexture() {
return texture2D(uBaseColorTexture, vuv0);
}`)):r.code.add(s.a`vec4 readBaseColorTexture() { return vec4(1.0); }`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){const r=e.fragment;r.constants.add("coverageTestThreshold","float",.01),t.antialiasing?r.code.add(i.a`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(i.a`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){const r=e.vertex;t.silhouette?(r.code.add(i.a`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?r.code.add(i.a`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(i.a`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(i.a`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(6);function n(e,t){const r=e.vertex;switch(t.mode){case 1:r.code.add(i.a`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case 2:r.code.add(i.a`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case 0:r.code.add(i.a`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(6),n=r(318),s=r(392);function a(e,t){const r=e.vertex;switch(e.include(s.a,t),n.a.usesSketchLogic(t)&&r.uniforms.add("uStrokesAmplitude","float"),t.mode){case 0:r.code.add(i.a`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case 1:r.code.add(i.a`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return uStrokesAmplitude;
}`);break;case 2:r.code.add(i.a`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return uStrokesAmplitude;
}
else {
return 0.0;
}
}`)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(183),n=r(6),s=r(318),a=r(392);function o(e,t){const r=e.vertex;e.include(a.a,t);const o=e.fragment;switch(s.a.usesSketchLogic(t)&&(r.uniforms.add("uStrokesTextureScale","vec2"),r.uniforms.add("uStrokesLog2Resolution","float"),r.uniforms.add("uStrokeVariants","float"),e.varyings.add("vStrokeUV","vec2"),o.uniforms.add("uStrokesTexture","sampler2D"),o.uniforms.add("uStrokesNormalizationScale","float"),r.code.add(n.a`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(i.a),o.code.add(n.a`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * uStrokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case 0:r.code.add(n.a`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),o.code.add(n.a`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case 1:r.code.add(n.a`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),o.code.add(n.a`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case 2:e.varyings.add("vType","float"),r.code.add(n.a`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),o.code.add(n.a`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return X}));var i=r(7),n=r(218),s=r(35),a=r(2),o=r(17),l=r(188),c=r(51),u=r(140),d=r(154),h=r(127),p=r(91),f=r(175),b=r(273),m=r(100),g=r(103),y=r(234),v=r(94),O=r(184),j=r(137),_=r(0),w=r(61),x=r(269),S=r(310),T=r(316),C=r(92),M=r(77),P=r(82),A=r(15),E=r(62),R=r(74),I=r(88),D=r(548),F=r(30);class L extends P.a{initializeProgram(e){const t=L.shader.get(),r=this.configuration,i=t.build({occlusionTestEnabled:r.occlusionTestEnabled,verticalOffsetEnabled:r.verticalOffset,screenSizePerspectiveEnabled:r.screenSizePerspective,depthHudEnabled:r.depthHudEnabled,depthHudAlignStartEnabled:r.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:e.viewingMode,isDraped:!1,multipassGeometryEnabled:r.multipassGeometryEnabled});return new R.a(e.rctx,i,E.a)}bindPass(e,t){Object(C.c)(this.program,t.camera.projectionMatrix),D.a.bindUniforms(this.program,e,t.camera.pixelRatio||1),Object(x.b)(this.program,e,t),Object(S.b)(this.program,t),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(T.a)(this.program,t),this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture"),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(C.f)(this.program,t),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform2f("pixelToNDC",2/t.camera.fullViewport[2],2/t.camera.fullViewport[3]);const r=t.camera.pixelRatio||1;this.program.setUniform1f("lineSize",Math.ceil(e.size)*r),Object(I.a)(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")}bindDraw(e){Object(C.d)(this.program,e),Object(C.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(w.c)(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e){const t=e?519:513;return this.configuration.depthHudEnabled?Object(F.g)({depthTest:{func:t},depthWrite:F.e}):Object(F.g)({blending:Object(F.h)(1,770,771,771),depthTest:{func:t},colorWrite:F.d})}initializePipeline(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)}}L.shader=new M.a(D.b,(()=>r.e(193).then(r.bind(null,1048))));class k extends A.a{constructor(){super(...arguments),this.occlusionTestEnabled=!0,this.verticalOffset=!1,this.screenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.screenCenterOffsetUnitsEnabled=0,this.slicePlaneEnabled=!1,this.multipassGeometryEnabled=!1}}Object(_.a)([Object(A.b)()],k.prototype,"occlusionTestEnabled",void 0),Object(_.a)([Object(A.b)()],k.prototype,"verticalOffset",void 0),Object(_.a)([Object(A.b)()],k.prototype,"screenSizePerspective",void 0),Object(_.a)([Object(A.b)()],k.prototype,"depthHudEnabled",void 0),Object(_.a)([Object(A.b)()],k.prototype,"depthHudAlignStartEnabled",void 0),Object(_.a)([Object(A.b)({count:2})],k.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(_.a)([Object(A.b)()],k.prototype,"slicePlaneEnabled",void 0),Object(_.a)([Object(A.b)()],k.prototype,"multipassGeometryEnabled",void 0);class z extends g.a{constructor(e){super(e,N),this.techniqueConfig=new k,this._uniqueMaterialIdentifier=z.uniqueMaterialIdentifier(this.params)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}dispose(){}getGLMaterial(e){return 0===e.output?new V(e):void 0}getPassParameters(){return this.params}getTechniqueConfig(e,t){return this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.depthHudEnabled=e,this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig}intersect(){}createBufferWriter(){return new G}validateParameterValues(e){const t=z.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}}class V extends O.a{constructor(e){super(e),this._isRenderSlot=!0,this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(L,this._material.getTechniqueConfig(!1,e),this._technique),this._depthTechnique=this._techniqueRep.releaseAndAcquire(L,this._material.getTechniqueConfig(!0,e),this._depthTechnique)}beginSlot(e){switch(e){case 20:return this._isRenderSlot=!0,!0;case 21:return this._isRenderSlot=!1,!0}return!1}get technique(){return this._isRenderSlot?this._technique:this._depthTechnique}ensureParameters(e){this.updateParameters(e)}bind(e){this.technique.bindPass(this._material.getPassParameters(),e)}}const N={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...g.b},U=Object(v.a)().vec3f("position").vec3f("normal").vec2f("uv0").vec4f("auxpos1"),B=[Object(y.b)(0,0),Object(y.b)(1,0),Object(y.b)(0,1),Object(y.b)(1,0),Object(y.b)(1,1),Object(y.b)(0,1)];class G{constructor(){this.vertexBufferLayout=U}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,r,i){Object(j.e)(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,r.position,i,6),Object(j.d)(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,r.normal,i,6),Object(j.a)(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,r.auxpos1,i,6);for(let n=0;n<B.length;++n)r.uv0.setVec(i+n,B[n])}}class q extends h.a{constructor(e,t){super(e,null,t,Q),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new z(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}perInstanceMaterialParameters(e){const t=this.materialParameters;return t.screenOffset=e.screenOffset||[0,0],t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get materialParameters(){const e=this.symbol,t=e.callout,r=Object(a.j)(t.color)?s.a.toUnitRGBA(t.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const i=Object(o.g)(t.size||0);let n=null;if(e.verticalOffset){const{screenLength:t,minWorldLength:r,maxWorldLength:i}=e.verticalOffset;n={screenLength:Object(o.g)(t),minWorldLength:r||0,maxWorldLength:null!=i?i:1/0}}const l=Object(a.j)(t.border)&&Object(a.j)(t.border.color)?s.a.toUnitRGBA(t.border.color):null,c="object"===e.symbolLayers.getItemAt(0).type,u=!c,d=c?0:void 0,h="label-3d"===e.type;return{color:r,size:i,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:l,occlusionTest:u,shaderPolygonOffset:d,depthHUDAlignStart:h,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:g.b.renderOccluded}}_defaultElevationInfoNoZ(){return $}createGraphics3DGraphic(e){const t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new u.a,t.elevationOffset||0),n=t.symbol,s="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some((e=>"object"===e.type||"text"===e.type)));if("label-3d"!==n.type&&s)return null;const o=Object(p.a)(r.geometry);return Object(a.i)(o)?null:this._createAs3DShape(o,i,t,r.uid)}layerOpacityChanged(){return Object(a.i)(this._material)||this._material.setParameterValues(this.materialParameters),!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(c.d)(q.elevationModeChangeTypes,r,i);return n!==c.a.UPDATE||e.forEach((e=>{const r=t(e);Object(a.j)(r)&&this.updateGraphicElevationContext(e.graphic,r)})),n}slicePlaneEnabledChanged(){return Object(a.i)(this._material)||this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(e,t,r=0){const i=super.setGraphicElevationContext(e,t);return i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(c.f)(t.elevationContext.mode)}updateGeometry(e,t){return!1}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:b.e.memory}}createVertexData(e){const{translation:t,centerOffset:r}=e;return[["position",t?{size:3,data:[t[0],t[1],t[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["auxpos1",r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]}_getOrCreateMaterial(e){const t=this.perInstanceMaterialParameters(e),r=z.uniqueMaterialIdentifier(t);if(Object(a.j)(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection){let i=e.materialCollection.get(r);return Object(a.i)(i)&&(i=new z(t),e.materialCollection.add(r,i)),{material:i,isUnique:!1}}return{material:new z(t),isUnique:!0}}_createAs3DShape(e,t,r,i){const n=[new m.a(this.createVertexData(r),W,1)],s=this._getOrCreateMaterial(r),a=Object(f.a)(this._context,e,n,[s.material],null,null,t,this._context.layer.uid,i);if(null===a)return null;const o=l.b,u=new d.a(this,a.object,n,s.isUnique?[s.material]:null,null,o,t);return u.metadata={elevationOffset:r.elevationOffset||0},u.alignedSampledElevation=a.sampledElevation,u.needsElevationUpdates=Object(c.f)(t.mode),Object(f.b)(u,e,this._context.elevationProvider),u}}q.elevationModeChangeTypes={definedChanged:c.a.UPDATE,staysOnTheGround:c.a.UPDATE,onTheGroundChanged:c.a.RECREATE};const H=new Uint16Array([0]),W=[["position",H],["normal",H],["auxpos1",H]],$={mode:"relative-to-ground",offset:0},Q={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};const Z=i.a.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function X(e,t){if(!Object(n.d)(e))return Z.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=J[e.callout.type];return r?new r(e,t):(Z.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const J={line:q}},function(e,t,r){"use strict";var i,n=r(0),s=r(44),a=r(14),o=r(13),l=r(1),c=r(9),u=(r(8),r(7),r(32)),d=r(4);let h=i=class extends a.a{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new i({minValue:this.minValue,maxValue:this.maxValue})}};Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],h.prototype,"minValue",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],h.prototype,"maxValue",void 0),h=i=Object(n.a)([Object(d.a)("esri.renderer.support.AuthoringInfoClassBreakInfo")],h);var p,f=h;let b=p=class extends a.a{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new p({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:Object(o.a)(this.classBreakInfos)})}};Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],b.prototype,"field",void 0),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],b.prototype,"normalizationField",void 0),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],b.prototype,"label",void 0),Object(n.a)([Object(l.b)({type:[f],json:{write:!0}})],b.prototype,"classBreakInfos",void 0),b=p=Object(n.a)([Object(d.a)("esri.renderers.support.AuthoringInfoFieldInfo")],b);var m,g=b,y=r(45);const v=new s.a({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),O=new s.a({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),j={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},_=["high-to-low","above-and-below","centered-on","extremes"],w=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],x=["seconds","minutes","hours","days","months","years"];let S=m=class extends a.a{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new m({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};Object(n.a)([Object(l.b)({types:j,json:{write:!0}})],S.prototype,"endTime",void 0),Object(n.a)([Object(y.a)("endTime")],S.prototype,"castEndTime",null),Object(n.a)([Object(l.b)({type:String,json:{write:!0}})],S.prototype,"field",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],S.prototype,"maxSliderValue",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0}})],S.prototype,"minSliderValue",void 0),Object(n.a)([Object(l.b)({types:j,json:{write:!0}})],S.prototype,"startTime",void 0),Object(n.a)([Object(y.a)("startTime")],S.prototype,"castStartTime",null),Object(n.a)([Object(l.b)({type:v.apiValues,value:null,json:{type:v.jsonValues,read:v.read,write:v.write}})],S.prototype,"style",null),Object(n.a)([Object(l.b)({type:w,value:null,json:{type:w,origins:{"web-scene":{type:_,write:{writer:(e,t)=>{_.indexOf(e)>-1&&(t.theme=e)}}}},write:!0}})],S.prototype,"theme",null),Object(n.a)([Object(l.b)({type:O.apiValues,json:{type:O.jsonValues,read:O.read,write:O.write}})],S.prototype,"type",void 0),Object(n.a)([Object(l.b)({type:x,json:{type:x,write:!0}})],S.prototype,"units",void 0),S=m=Object(n.a)([Object(d.a)("esri.renderers.support.AuthoringInfoVisualVariable")],S);var T,C=S,M=r(546);const P=new s.a({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),A=new s.a({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),E=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];let R=T=class extends a.a{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return Object(M.a)(e)}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new T({classificationMethod:this.classificationMethod,colorRamp:Object(o.a)(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:Object(o.a)(this.field1),field2:Object(o.a)(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((e=>e.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme})}};Object(n.a)([Object(l.b)({type:P.apiValues,value:null,json:{type:P.jsonValues,read:P.read,write:P.write,origins:{"web-document":{default:"manual",type:P.jsonValues,read:P.read,write:P.write}}}})],R.prototype,"classificationMethod",null),Object(n.a)([Object(l.b)({types:M.b,json:{write:!0}})],R.prototype,"colorRamp",void 0),Object(n.a)([Object(u.a)("colorRamp")],R.prototype,"readColorRamp",null),Object(n.a)([Object(l.b)({type:[String],value:null,json:{write:!0}})],R.prototype,"fields",null),Object(n.a)([Object(l.b)({type:g,value:null,json:{write:!0}})],R.prototype,"field1",null),Object(n.a)([Object(l.b)({type:g,value:null,json:{write:!0}})],R.prototype,"field2",null),Object(n.a)([Object(l.b)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],R.prototype,"focus",null),Object(n.a)([Object(l.b)({type:Number,value:null,json:{type:c.a,write:!0}})],R.prototype,"numClasses",null),Object(n.a)([Object(l.b)({type:E,json:{type:E,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],R.prototype,"lengthUnit",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],R.prototype,"maxSliderValue",void 0),Object(n.a)([Object(l.b)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],R.prototype,"minSliderValue",void 0),Object(n.a)([Object(l.b)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],R.prototype,"statistics",null),Object(n.a)([Object(l.b)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],R.prototype,"standardDeviationInterval",null),Object(n.a)([Object(l.b)({type:A.apiValues,value:null,json:{type:A.jsonValues,read:A.read,write:A.write}})],R.prototype,"type",null),Object(n.a)([Object(l.b)({type:[C],json:{write:!0}})],R.prototype,"visualVariables",void 0),Object(n.a)([Object(l.b)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],R.prototype,"univariateSymbolStyle",null),Object(n.a)([Object(l.b)({type:["high-to-low","above-and-below","above","below","90-10"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],R.prototype,"univariateTheme",null),R=T=Object(n.a)([Object(d.a)("esri.renderers.support.AuthoringInfo")],R);var I=R;t.a=I},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(6);function n(e){e.fragment.uniforms.add("u_transformGrid","sampler2D"),e.fragment.uniforms.add("u_transformSpacing","vec2"),e.fragment.uniforms.add("u_transformGridSize","vec2"),e.fragment.uniforms.add("u_targetImageSize","vec2"),e.fragment.code.add(i.a`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}function s(e){e.include(n),e.fragment.uniforms.add("u_image","sampler2D"),e.fragment.uniforms.add("u_isFloatTexture","bool"),e.fragment.uniforms.add("u_flipY","bool"),e.fragment.uniforms.add("u_applyTransform","bool"),e.fragment.uniforms.add("u_opacity","float"),e.fragment.code.add(i.a`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(132),n=r(6);function s(e){const t=n.a`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}function a(e,t){e.vertex.include(s),e.include(i.a,t);const r=e.vertex;r.uniforms.add("uDepthBias","vec2"),r.uniforms.add("uViewportDimInv","vec2"),t.legacy?(r.uniforms.add("uView","mat4"),r.uniforms.add("uProj","mat4")):r.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),t.legacy?r.code.add(n.a`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = uDepthBias.x;
float offsetZ  = uDepthBias.y;
vec4 projNormal = uProj * uView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
}`):r.code.add(n.a`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = uDepthBias.x;
float offsetZ  = uDepthBias.y;
vec4 projNormal = uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
}`),r.code.add(n.a`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = uDepthBias.y;
return sqrt(projPos.z) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}},function(e,t,r){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(678)},function(e,t,r){"use strict";r.r(t),r.d(t,"addOrUpdateResource",(function(){return l})),r.d(t,"contentToBlob",(function(){return p})),r.d(t,"fetchResources",(function(){return o})),r.d(t,"getSiblingOfSameType",(function(){return f})),r.d(t,"getSiblingOfSameTypeI",(function(){return b})),r.d(t,"removeAllResources",(function(){return u})),r.d(t,"removeResource",(function(){return c})),r.d(t,"splitPrefixFileNameAndExtension",(function(){return h}));var i=r(84),n=r(11),s=r(2),a=r(25);async function o(e,t={},r){await e.load(r);const i=Object(a.z)(e.itemUrl,"resources"),{start:n=1,num:o=10,sortOrder:l="asc",sortField:c="created"}=t,u={query:{start:n,num:o,sortOrder:l,sortField:c,token:e.apiKey},signal:Object(s.h)(r,"signal")},d=await e.portal._request(i,u);return{total:d.total,nextStart:d.nextStart,resources:d.resources.map((({created:t,size:r,resource:i})=>({created:new Date(t),size:r,resource:e.resourceFromPath(i)})))}}async function l(e,t,r,i){if(!e.hasPath())throw new n.a(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const o=e.portalItem;await o.load(i);const l=Object(a.z)(o.userItemUrl,"add"===t?"addResources":"updateResources"),[c,u]=d(e.path),h=await p(r),f=new FormData;return c&&"."!==c&&f.append("resourcesPrefix",c),f.append("fileName",u),f.append("file",h,u),f.append("f","json"),Object(s.j)(i)&&i.access&&f.append("access",i.access),await o.portal._request(l,{method:"post",body:f,signal:Object(s.h)(i,"signal")}),e}async function c(e,t,r){if(!t.hasPath())throw new n.a("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const i=Object(a.z)(e.userItemUrl,"removeResources");await e.portal._request(i,{method:"post",query:{resource:t.path},signal:Object(s.h)(r,"signal")}),t.portalItem=null}async function u(e,t){await e.load(t);const r=Object(a.z)(e.userItemUrl,"removeResources");return e.portal._request(r,{method:"post",query:{deleteAll:!0},signal:Object(s.h)(t,"signal")})}function d(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function h(e){const[t,r]=function(e){const t=Object(a.n)(e);return Object(s.i)(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[i,n]=d(t);return[i,n,r]}async function p(e){return e instanceof Blob?e:(await Object(i.default)(e.url,{responseType:"blob"})).data}function f(e,t){if(!e.hasPath())return null;const[r,,i]=h(e.path);return e.portalItem.resourceFromPath(Object(a.z)(r,t+i))}function b(e,t){if(!e.hasPath())return null;const[r,,i]=h(e.path);return e.portalItem.resourceFromPath(Object(a.z)(r,t+i))}},function(e,t,r){"use strict";r.r(t),r.d(t,"createLabelFunction",(function(){return p})),r.d(t,"formatField",(function(){return f}));var i=r(11),n=r(7),s=r(161),a=r(151),o=r(89),l=r(239),c=r(139);const u=n.a.getLogger("esri.layers.support.labelFormatUtils"),d={type:"simple",evaluate:()=>null},h={getAttribute:(e,t)=>e.field(t)};async function p(e,t,n){if(!e||!e.symbol)return d;const s=e.where,a=Object(l.b)(e),o=s?await r.e(1).then(r.bind(null,675)):null;let p;if("arcade"===a.type){const e=await Object(c.c)(a.expression,n,t);p={type:"arcade",evaluate(t){try{const r=e.evaluate({$feature:"attributes"in t?e.repurposeFeature(t):e.repurposeAdapter(t)});if(null!=r)return r.toString()}catch(n){u.error(new i.a("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:t,expression:a}))}return null},needsHydrationToEvaluate:()=>null==Object(l.e)(a.expression)}}else p={type:"simple",evaluate:e=>a.expression.replace(/{[^}]*}/g,(r=>{const i=r.slice(1,-1),n=t.get(i);if(!n)return r;let s=null;return"attributes"in e?e&&e.attributes&&(s=e.attributes[n.name]):s=e.field(n.name),null==s?"":f(s,n)}))};if(s){let e;try{e=o.WhereClause.create(s,t)}catch(b){return d}const r=p.evaluate;p.evaluate=t=>{const i="attributes"in t?void 0:h;return e.testFeature(t,i)?r(t):null}}return p}function f(e,t){if(null==e)return"";const r=t.domain;if(r)if("codedValue"===r.type||"coded-value"===r.type){const t=e;for(const e of r.codedValues)if(e.code===t)return e.name}else if("range"===r.type){const t=+e,i="range"in r?r.range[0]:r.minValue,n="range"in r?r.range[1]:r.maxValue;if(i<=t&&t<=n)return r.name}let i=e;return"date"===t.type||"esriFieldTypeDate"===t.type?i=Object(s.b)(i,Object(s.a)("short-date")):Object(o.o)(t)&&(i=Object(a.b)(+i)),i||""}},function(e,t,r){"use strict";r.r(t);var i=r(0),n=r(11),s=r(1),a=(r(8),r(9),r(7),r(4)),o=r(564),l=r(589),c=r(562);let u=class extends(Object(l.a)(Object(o.a)(c.a))){constructor(){super(...arguments),this.type="elevation-3d"}initialize(){const e=this.get("view.map.allLayers"),t=e&&e.includes(this.layer),r=this.get("view.map.ground.layers"),i=r&&r.includes(this.layer);if(t&&!i){const e=new n.a("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground");this.addResolvingPromise(Promise.reject(e))}this._addTilingSchemeMatchPromise()}};Object(i.a)([Object(s.b)({readOnly:!0,aliasOf:"layer.fullExtent"})],u.prototype,"fullExtent",void 0),Object(i.a)([Object(s.b)()],u.prototype,"layer",void 0),Object(i.a)([Object(s.b)({readOnly:!0,aliasOf:"layer.tileInfo"})],u.prototype,"tileInfo",void 0),u=Object(i.a)([Object(a.a)("esri.views.3d.layers.ElevationLayerView3D")],u);var d=u;t.default=d},function(e,t,r){"use strict";var i=r(0),n=r(157),s=(r(113),r(124)),a=r(283),o=r(122),l=r(38),c=r(202),u=r(11),d=r(155),h=r(180),p=r(8),f=r(7),b=r(2),m=r(12),g=r(128),y=r(23),v=r(370),O=r(17),j=r(1),_=r(45),w=r(4),x=r(9),S=r(5),T=r(222),C=r(36),M=r(53),P=r(28),A=r(141),E=r(465),R=r(46),I=r(214),D=r(173),F=r(42);const L={widthBreakpoint:{getValue(e){const t=e.viewSize[0],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,r=t[0],i=t[1],n=this.values;return i>=r?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},k={xsmall:544,small:768,medium:992,large:1200};function z(e,t){return t?L[e].valueToClassName[t].split(" "):[]}const V=e=>{let t=class extends e{constructor(...e){super(...e),this._breakpointsHandles=new F.a,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=k}initialize(){this._breakpointsHandles.add(Object(y.a)(this,["breakpoints","size"],this._updateClassNames))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)}set breakpoints(e){if(e===this._get("breakpoints"))return;const t=function(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e);if(!t){const e=JSON.stringify(k,null,2);console.warn("provided breakpoints are not valid, using defaults:"+e)}e=t?e:k,this._set("breakpoints",{...e})}_updateClassNames(){if(!this.container)return;const e=D.a.acquire(),t=D.a.acquire();let r,i=!1;for(r in L){const n=this[r],s=L[r].getValue({viewSize:this.size,breakpoints:this.breakpoints});n!==s&&(i=!0,this[r]=s,z(r,n).forEach((e=>t.push(e))),z(r,s).forEach((t=>e.push(t))))}i&&(this._applyClassNameChanges(e,t),D.a.release(e),D.a.release(t))}_applyClassNameChanges(e,t){const r=this.container;r&&(t.forEach((e=>r.classList.remove(e))),e.forEach((e=>r.classList.add(e))))}_removeActiveClassNames(){const e=this.container;if(!e)return;let t;for(t in L)z(t,this[t]).forEach((t=>e.classList.remove(t)))}};return Object(i.a)([Object(j.b)()],t.prototype,"breakpoints",null),Object(i.a)([Object(j.b)()],t.prototype,"orientation",void 0),Object(i.a)([Object(j.b)()],t.prototype,"widthBreakpoint",void 0),Object(i.a)([Object(j.b)()],t.prototype,"heightBreakpoint",void 0),t=Object(i.a)([Object(w.a)("esri.views.BreakpointsOwner")],t),t};var N=r(19),U=(r(226),r(459)),B=r(229);let G=class extends N.a{constructor(){super(...arguments),this.items=new l.a,this._watchUpdatingTracking=new B.a,this._callbacks=new Map,this._projector=Object(U.a)(),this._hiddenProjector=Object(U.a)()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(e=>{e.added.map((e=>{const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)})),e.removed.map((e=>{const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}))}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,r=this._hiddenProjector;let i=null;const n=()=>(i=e.render(),i);r.append(t,n),r.renderNow();const s={left:0,top:0,right:0,bottom:0};if(i&&i.domNode){const e=i.domNode.getBoundingClientRect();s.left=e.left,s.top=e.top,s.right=e.right,s.bottom=e.bottom}for(r.detach(n);t.firstChild;)t.removeChild(t.firstChild);return s}overlaps(e,t){const r=this.computeBoundingRect(e),i=this.computeBoundingRect(t);return Math.max(r.left,i.left)<=Math.min(r.right,i.right)&&Math.max(r.top,i.top)<=Math.min(r.bottom,i.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}renderCanvas(e){if(!this.items.some((e=>e.visible)))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((e=>{t.save(),e.renderCanvas(t),t.restore()})),t.restore()}};Object(i.a)([Object(j.b)({readOnly:!0})],G.prototype,"surface",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],G.prototype,"items",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],G.prototype,"needsRender",null),Object(i.a)([Object(j.b)({readOnly:!0})],G.prototype,"_watchUpdatingTracking",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],G.prototype,"updating",void 0),G=Object(i.a)([Object(w.a)("esri.views.overlay.ViewOverlay")],G);var q=G;r(340);function H(e,t,r,i){let n=null,s=1e3;"number"==typeof t?(s=t,i=r):(n=null!=t?t:null,s=r);let a,o=0;const l=()=>{o=0,e.apply(i,a)},c=(...e)=>{n&&n.apply(i,e),a=e,s?o||(o=setTimeout(l,s)):l()};return c.remove=()=>{o&&(clearTimeout(o),o=0)},c.forceUpdate=()=>{o&&(clearTimeout(o),l())},c.hasPendingUpdates=()=>!!o,c}var W=r(48),$=r(119),Q=r(633),Z=r(178),X=r(537),J=r(360),Y=r(134),K=r(161),ee=r(151),te=r(89),re=r(335),ie=r(139);const ne=f.a.getLogger("esri.widgets.Feature.support.featureUtils"),se=/href=(""|'')/gi,ae=/(\{([^\{\r\n]+)\})/g,oe=/\'/g,le=/^\s*expression\//i,ce=/(\n)/gi,ue=/[\u00A0-\u9999<>\&]/gim,de=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,he=/^(?:mailto:|tel:)/,pe="relationships/",fe=Object(K.a)("short-date-short-time");function be(e){if(!Object(b.i)(e))return e.get("sourceLayer")||e.get("layer")}async function me(e,t){return"function"==typeof e?e.call(null,t):e}function ge(e=""){if(e)return!he.test(e.trim().toLowerCase())}function ye(e,t){if(!function(e){return le.test(e)}(t)||!e)return null;const r=t.replace(le,"").toLowerCase();let i;return e.some((e=>e.name.toLowerCase()===r&&(i=e,!0))),i}function ve(e,t){const r=ye(t,null==e?void 0:e.fieldName);return r?r.title||null:e?e.label||e.fieldName:null}function Oe(e,t){const r=je(t,e);return r?r.name:e}function je(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function _e(e){return`${e}`.trim()}function we({attributes:e,globalAttributes:t,layer:r,text:i,expressionAttributes:n,fieldInfoMap:s}){return i?xe({formattedAttributes:t,template:Ce(i,{...t,...n,...e},r),fieldInfoMap:s}):""}function xe({formattedAttributes:e,template:t,fieldInfoMap:r}){return _e(function(e){return e.replace(se,"")}(Object(Y.c)(Object(Y.c)(t,(e=>function(e,t){const r=t.get(e.toLowerCase());return`{${r&&r.fieldName||e}}`}(e,r))),e)))}function Se(e,t=!1){const r={...e};return Object.keys(r).forEach((e=>function(e,t,r=!1){const i=t[e];if("string"==typeof i){const n="%27",s=(r?encodeURIComponent(i):i).replace(oe,n);t[e]=s}}(e,r,t))),r}function Te(e,t){return e.replace(ae,((e,r,i)=>{const n=je(t,i);return n?`{${n.name}}`:r}))}function Ce(e,t,r){const i=Te(e,r);return i?i.replace(de,((e,r,i)=>function(e,t,r){const i=(t=_e(t))&&"{"!==t[0];return Object(Y.c)(e,Se(r,i))}(e,r||i,t))):i}function Me(e,t){const r=t.fieldInfos,i=t.fieldName,n=Pe(r,i),s=null==n?void 0:n.clone(),a=t.preventPlacesFormatting,o=je(t.layer,i);if(s&&o&&"date"===o.type){const e=s.format||new re.a;e.dateFormat=e.dateFormat||"short-date-short-time",s.format=e}const l=s&&s.format;return"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,l))||null==e||null==l?e:a?Object(ee.b)(e,{...Object(ee.a)(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function Pe(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let i;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==r)&&(i=e,!0))),i}function Ae(e){const t=[];if(!e)return t;const{fieldInfos:r,content:i}=e;return r&&t.push(...r),i&&Array.isArray(i)?(i.forEach((e=>{if("fields"===e.type){const r=e&&e.fieldInfos;r&&t.push(...r)}})),t):t}function Ee(e){return e.replace(ue,(e=>`&#${e.charCodeAt(0)};`))}function Re(e){return"string"==typeof e?e.replace(ce,'<br class="esri-text-new-line" />'):e}function Ie(e){const{value:t,fieldName:r,fieldInfos:i,fieldInfoMap:n,layer:s,graphic:a}=e;if(null==t)return"";const o=function({fieldName:e,value:t,graphic:r,layer:i}){if(Le(e))return null;if(!i||"function"!=typeof i.getFieldDomain)return null;const n=i.getFieldDomain(e,{feature:r});return n&&"coded-value"===n.type?n.getName(t):null}({fieldName:r,value:t,graphic:a,layer:s});if(o)return o;const l=function({fieldName:e,graphic:t,layer:r}){if(Le(e))return null;if(!r||"function"!=typeof r.getFeatureType)return null;const{typeIdField:i}=r;if(!i||e!==i)return null;const n=r.getFeatureType(t);return n?n.name:null}({fieldName:r,graphic:a,layer:s});if(l)return l;if(n.get(r.toLowerCase()))return Me(t,{fieldInfos:i,fieldName:r,layer:s});const c=s&&s.fieldsIndex;return c&&c.isDateField(r)?Object(K.b)(t,fe):Re(t)}function De({fieldInfos:e,attributes:t,layer:r,graphic:i,fieldInfoMap:n,relatedInfos:s}){const a={...t};return null==s||s.forEach((e=>function(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((r=>ke({attributes:e,graphic:r,relatedInfo:t}))),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((r=>ke({attributes:e,graphic:r,relatedInfo:t}))))}(a,e))),Object.keys(a).forEach((t=>{const s=a[t];a[t]=Ie({fieldName:t,fieldInfos:e,fieldInfoMap:n,layer:r,value:s,graphic:i})})),a}async function Fe({graphic:e,popupTemplate:t,layer:r,spatialReference:i},n){if(!r||!t)return;if("function"==typeof r.load&&await r.load(n),!e.attributes)return;const s=e.attributes[r.objectIdField];if(null==s)return;const a=[s],o=await t.getRequiredFields(r.fieldsIndex),l=Object(te.h)(o,e),c=l?[]:o,u=t.returnGeometry||await async function(e){var t;if(null==(t=e.expressionInfos)||!t.length)return!1;const r=await Object(ie.e)(),{arcadeUtils:{hasGeometryFunctions:i}}=r;return i(e)}(t);if(l&&!u)return;const d=await async function(e,t){var r,i;const{layer:n,graphic:s,outFields:a,objectIds:o,returnGeometry:l,spatialReference:c}=e,u=o[0];if("number"!=typeof u&&"string"!=typeof u){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:s,objectId:u,requiredFields:a};return ne.warn(e,t),null}if(null==(r=n.capabilities)||null==(i=r.operations)||!i.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:s,requiredFields:a,returnGeometry:l};return ne.warn(e,t),null}const d=n.createQuery();return d.objectIds=o,d.outFields=null!=a&&a.length?a:[n.objectIdField],d.returnGeometry=!!l,d.outSpatialReference=c,(await n.queryFeatures(d,t)).features[0]}({layer:r,graphic:e,outFields:c,objectIds:a,returnGeometry:u,spatialReference:i},n);d&&(d.geometry&&(e.geometry=d.geometry),d.attributes&&(e.attributes={...e.attributes,...d.attributes}))}function Le(e=""){return!!e&&-1!==e.indexOf(pe)}function ke({attributes:e,graphic:t,relatedInfo:r}){e&&t&&r&&Object.keys(t.attributes).forEach((i=>{const n=function(e){return e?`relationships/${e.layerId}/${e.fieldName}`:""}({layerId:r.relation.id.toString(),fieldName:i});e[n]=t.attributes[i]}))}const ze={editing:!1,operations:{add:!0,update:!0,delete:!0}},Ve=l.a.ofType(X.a);let Ne=class extends Z.a{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...ze},this.activeAttachmentInfo=null,this.attachmentInfos=new Ve,this.graphic=null,this.mode="view",this.handles.add([Object(y.a)(this,"graphic",(()=>this._graphicChanged()))])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...ze,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||"function"!=typeof e.queryAttachments)throw new u.a("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getFeatureId(),i=new J.a({objectIds:[r],returnMetadata:!0}),n=[],s=e.queryAttachments(i).then((e=>e[r]||n)).catch((()=>n));this._getAttachmentsPromise=s,this.notifyChange("state");const a=await s;return t.removeAll(),a.length&&t.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:r,graphic:i,abilities:n}=this;if(!e)throw new u.a("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!n.operations.add)throw new u.a("invalid-abilities","addAttachment(): add abilities are required.");if(!t||"function"!=typeof t.addAttachment)throw new u.a("invalid-layer","addAttachment(): A valid layer is required.");const s=t.addAttachment(i,e).then((e=>this._queryAttachment(e.objectId))),a=await s;return r.add(a),a}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:r,graphic:i,abilities:n}=this;if(!e)throw new u.a("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!n.operations.delete)throw new u.a("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new u.a("invalid-layer","deleteAttachment(): A valid layer is required.");const s=t.deleteAttachments(i,[e.id]).then((()=>e)),a=await s;return r.remove(a),a}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:r,attachmentInfos:i,graphic:n,abilities:s}=this;if(!e)throw new u.a("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new u.a("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!s.operations.update)throw new u.a("invalid-abilities","updateAttachment(): Update abilities are required.");const a=i.findIndex((e=>e===t));if(!r||"function"!=typeof r.updateAttachment)throw new u.a("invalid-layer","updateAttachment(): A valid layer is required.");const o=r.updateAttachment(n,t.id,e).then((e=>this._queryAttachment(e.objectId))),l=await o;return i.splice(a,1,l),l}async _queryAttachment(e){if(!e)throw new u.a("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,r=this._getFeatureId(),i=new J.a({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(i).then((e=>e[r][0]))}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:r}=e,{attributes:i}=t;return i&&i[r]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:e}=this,t=be(e);this._attachmentLayer=t?"scene"===t.type&&Object(b.j)(t.associatedLayer)?t.associatedLayer:t:null}};Object(i.a)([Object(j.b)()],Ne.prototype,"abilities",void 0),Object(i.a)([Object(_.a)("abilities")],Ne.prototype,"castAbilities",null),Object(i.a)([Object(j.b)()],Ne.prototype,"activeAttachmentInfo",void 0),Object(i.a)([Object(j.b)({readOnly:!0,type:Ve})],Ne.prototype,"attachmentInfos",void 0),Object(i.a)([Object(j.b)({type:s.a})],Ne.prototype,"graphic",void 0),Object(i.a)([Object(j.b)()],Ne.prototype,"mode",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ne.prototype,"state",null),Object(i.a)([Object(j.b)({readOnly:!0})],Ne.prototype,"supportsResizeAttachments",null),Ne=Object(i.a)([Object(w.a)("esri.widgets.Attachments.AttachmentsViewModel")],Ne);var Ue=Ne,Be=r(79);var Ge=r(69),qe=r(130),He=r(24);const We={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},$e="esri-attachments",Qe="esri-attachments__loader-container",Ze="esri-attachments__loader",Xe="esri-attachments__container",Je="esri-attachments__container--list",Ye="esri-attachments__container--preview",Ke="esri-attachments__actions",et="esri-attachments__delete-button",tt="esri-attachments__add-attachment-button",rt="esri-attachments__error-message",it="esri-attachments__items",nt="esri-attachments__item",st="esri-attachments__item-button",at="esri-attachments__item-mask",ot="esri-attachments__item-mask--icon",lt="esri-attachments__image",ct="esri-attachments__image--resizable",ut="esri-attachments__label",dt="esri-attachments__filename",ht="esri-attachments__item-chevron-icon",pt="esri-attachments__item-link",ft="esri-attachments__item-link-overlay",bt="esri-attachments__item-link-overlay-icon",mt="esri-attachments__item-add-icon",gt="esri-attachments__form-node",yt="esri-attachments__file-fieldset",vt="esri-attachments__file-label",Ot="esri-attachments__file-name",jt="esri-attachments__file-input",_t="esri-attachments__metadata",wt="esri-attachments__metadata-fieldset",xt="esri-attachments__progress-bar",St="esri-widget",Tt="esri-button",Ct="esri-button--disabled",Mt="esri-button--secondary",Pt="esri-button--tertiary",At="esri-button--third",Et="esri-button--small",Rt="esri-button--half",It="esri-widget__content--empty",Dt="esri-icon-right",Ft="esri-icon-left",Lt="esri-icon-plus",kt=window.CSS;let zt=class extends $.a{constructor(e,t){super(e,t),this.abilities=null,this.displayType="list",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new Ue,this.visibleElements={...We},this._supportsImageOrientation=kt&&kt.supports&&kt.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own(Object(y.b)(this,"viewModel.attachmentInfos","change",(()=>this.scheduleRender())),Object(y.a)(this,"viewModel.mode",(()=>this._modeChanged())))}castVisibleElements(e){return{...We,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new u.a("attachments:add-attachment",this.messages.addErrorMessage,e)),e}))}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new u.a("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e}))}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((e=>{throw this._set("submitting",!1),this._set("error",new u.a("attachments:update-attachment",this.messages.updateErrorMessage,e)),e}))}render(){const{submitting:e,viewModel:t}=this,{state:r}=t;return Object(He.a)("div",{class:this.classes($e,St)},e?this.renderProgressBar():null,"loading"===r?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?Object(He.a)("div",{key:"error-message",class:rt},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return"add"===e?this.renderAddForm():"edit"===e?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return Object(He.a)("div",{class:Qe,key:"loader"},Object(He.a)("div",{class:Ze}))}renderProgressBar(){return this.visibleElements.progressBar?Object(He.a)("div",{class:xt,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,r=e||!t,i=this.visibleElements.cancelAddButton?Object(He.a)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Tt,Pt,Et,Rt,e&&Ct)},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?Object(He.a)("button",{type:"submit",disabled:r,class:this.classes(Tt,Mt,Et,Rt,{[Ct]:r})},this.messages.add):null,s=t?Object(He.a)("span",{key:"file-name",class:Ot},t.name):null,a=Object(He.a)("form",{bind:this,afterCreate:Ge.j,afterRemoved:Ge.c,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Object(He.a)("fieldset",{class:yt},s,Object(He.a)("label",{class:this.classes(vt,Tt,Mt)},t?this.messages.changeFile:this.messages.selectFile,Object(He.a)("input",{class:jt,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),n,i);return Object(He.a)("div",{key:"add-form-container",class:gt},a)}renderDetailsForm(e){const{visibleElements:t,viewModel:r,selectedFile:i,submitting:n}=this,{contentType:s,size:a,url:o}=e,{abilities:l}=r,c=n||!i,u=l.editing&&l.operations.delete&&t.deleteButton?Object(He.a)("button",{key:"delete-button",type:"button",disabled:n,bind:this,onclick:t=>this._submitDeleteAttachment(t,e),class:this.classes(Tt,Et,Pt,et,{[Ct]:n})},this.messages.delete):null,d=l.editing&&l.operations.update&&t.updateButton?Object(He.a)("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(Tt,Et,At,{[Ct]:c})},this.messages.update):null,h=this.visibleElements.cancelUpdateButton?Object(He.a)("button",{disabled:n,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Tt,Et,Pt,At,{[Ct]:n})},this.messages.cancel):null,p=i?Object(He.a)("span",{key:"file-name",class:Ot},i.name):null,f=l.editing&&l.operations.update?Object(He.a)("fieldset",{key:"file",class:yt},p,Object(He.a)("label",{class:this.classes(vt,Tt,Mt)},this.messages.changeFile,Object(He.a)("input",{class:jt,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,b=Object(He.a)("fieldset",{key:"size",class:wt},Object(He.a)("label",null,Object(Q.c)(this.messagesUnits,a))),m=Object(He.a)("fieldset",{key:"content-type",class:wt},Object(He.a)("label",null,s)),g=Object(He.a)("form",{bind:this,afterCreate:Ge.j,afterRemoved:Ge.c,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},Object(He.a)("div",{class:_t},b,m),f,Object(He.a)("div",{class:Ke},u,h,d));return Object(He.a)("div",{key:"edit-form-container",class:gt},Object(He.a)("a",{class:pt,href:o,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),Object(He.a)("div",{class:ft},Object(He.a)("span",{class:bt},Object(He.a)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},Object(He.a)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),Object(He.a)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),g)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:r}=this.viewModel,{contentType:i,name:n,url:s}=e,a=r&&function(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(i),o=this._getCSSTransform(e,a),l=o?{transform:o,"image-orientation":"none"}:{},c=-1===s.indexOf("?")?"?":"&",u=a?`${s}${c}w=${t}`:function(e){const t=Object(Be.b)("esri/themes/base/images/files/");return e?"text/plain"===e?`${t}text-32.svg`:"application/pdf"===e?`${t}pdf-32.svg`:"text/csv"===e?`${t}csv-32.svg`:"application/gpx+xml"===e?`${t}gpx-32.svg`:"application/x-dwf"===e?`${t}cad-32.svg`:"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?`${t}code-32.svg`:"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?`${t}zip-32.svg`:-1!==e.indexOf("image/")?`${t}image-32.svg`:-1!==e.indexOf("audio/")?`${t}sound-32.svg`:-1!==e.indexOf("video/")?`${t}video-32.svg`:-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?`${t}excel-32.svg`:-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?`${t}word-32.svg`:-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}(i),d={[ot]:!a},h={[ct]:r};return Object(He.a)("div",{class:this.classes(d,at)},Object(He.a)("img",{styles:l,alt:n,src:u,class:this.classes(h,lt)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:r}=this,{abilities:i}=r,{name:n,url:s}=e,a=this.renderImageMask({attachmentInfo:e,size:"list"===t?48:400}),o=i.editing?Object(He.a)("span",{"aria-hidden":"true",class:this.classes(ht,Object(Ge.h)()?Ft:Dt)}):null,l=[a,Object(He.a)("label",{class:ut},Object(He.a)("span",{class:dt},n||this.messages.noTitle),o)],c=i.editing?Object(He.a)("button",{key:"details-button",bind:this,class:st,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):Object(He.a)("a",{key:"details-link",class:st,href:s,target:"_blank"},l);return Object(He.a)("li",{class:nt,key:e},c)}renderAttachmentContainer(){const{displayType:e,viewModel:t,visibleElements:r}=this,{attachmentInfos:i,abilities:n}=t,s=i&&i.length,a={[Je]:"preview"!==e,[Ye]:"preview"===e},o=n.editing&&n.operations.add&&r.addButton?Object(He.a)("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Tt,Pt,tt),type:"button"},Object(He.a)("span",{"aria-hidden":"true",class:this.classes(mt,Lt)}),this.messages.add):null,l=s?Object(He.a)("ul",{class:it},i.toArray().map((t=>this.renderAttachmentInfo({attachmentInfo:t,displayType:e})))):Object(He.a)("div",{class:It},this.messages.noAttachments);return Object(He.a)("div",{key:"attachments-container",class:this.classes(Xe,a)},l,o)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,r=t&&t.files&&t.files.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:r}=e;return!this._supportsImageOrientation&&t&&r?[r.rotation?`rotate(${r.rotation}deg)`:"",r.mirrored?"scaleX(-1)":""].join(" "):""}};Object(i.a)([Object(W.a)("viewModel.abilities")],zt.prototype,"abilities",void 0),Object(i.a)([Object(j.b)()],zt.prototype,"displayType",void 0),Object(i.a)([Object(W.a)("viewModel.graphic")],zt.prototype,"graphic",void 0),Object(i.a)([Object(j.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],zt.prototype,"label",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/Attachments/t9n/Attachments")],zt.prototype,"messages",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/core/t9n/Units")],zt.prototype,"messagesUnits",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zt.prototype,"selectedFile",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zt.prototype,"submitting",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zt.prototype,"error",void 0),Object(i.a)([Object(j.b)({type:Ue})],zt.prototype,"viewModel",void 0),Object(i.a)([Object(j.b)()],zt.prototype,"visibleElements",void 0),Object(i.a)([Object(_.a)("visibleElements")],zt.prototype,"castVisibleElements",null),zt=Object(i.a)([Object(w.a)("esri.widgets.Attachments")],zt);var Vt=zt;let Nt=class extends Ue{constructor(e){super(e),this.description=null,this.title=null}};Object(i.a)([Object(j.b)()],Nt.prototype,"description",void 0),Object(i.a)([Object(j.b)()],Nt.prototype,"title",void 0),Nt=Object(i.a)([Object(w.a)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],Nt);var Ut=Nt,Bt=r(10);const Gt="esri-widget__heading";function qt(e,t){const r=`h${Object(Bt.e)(Math.ceil(e.level),1,6)}`;return delete e.level,Object(He.a)(r,{...e,class:Object(Ge.a)(Gt,e.class)},t)}const Ht="esri-feature-element-info",Wt="esri-feature-element-info__title",$t="esri-feature-element-info__description";let Qt=class extends $.a{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return Object(He.a)("div",{class:Ht},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?Object(He.a)(qt,{level:this.headingLevel,class:Wt},e):null}renderDescription(){const{description:e}=this;return e?Object(He.a)("div",{key:"description",class:$t},e):null}};Object(i.a)([Object(j.b)()],Qt.prototype,"description",void 0),Object(i.a)([Object(j.b)()],Qt.prototype,"headingLevel",void 0),Object(i.a)([Object(j.b)()],Qt.prototype,"title",void 0),Qt=Object(i.a)([Object(w.a)("esri.widgets.Feature.support.FeatureElementInfo")],Qt);var Zt=Qt;const Xt="esri-feature-attachments";let Jt=class extends $.a{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new Vt,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new Ut}initialize(){this._featureElementInfo=new Zt,Object(y.a)(this,["viewModel.description","viewModel.title","headingLevel"],(()=>this._setupFeatureElementInfo())),Object(y.a)(this,"viewModel.graphic",(e=>this.attachmentsWidget.graphic=e))}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var e;const{attachmentsWidget:t}=this;return Object(He.a)("div",{class:Xt},null==(e=this._featureElementInfo)?void 0:e.render(),null==t?void 0:t.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:r}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:r})}};Object(i.a)([Object(j.b)({readOnly:!0})],Jt.prototype,"attachmentsWidget",void 0),Object(i.a)([Object(W.a)("viewModel.description")],Jt.prototype,"description",void 0),Object(i.a)([Object(W.a)("attachmentsWidget.displayType")],Jt.prototype,"displayType",void 0),Object(i.a)([Object(W.a)("viewModel.graphic")],Jt.prototype,"graphic",void 0),Object(i.a)([Object(j.b)()],Jt.prototype,"headingLevel",void 0),Object(i.a)([Object(W.a)("viewModel.title")],Jt.prototype,"title",void 0),Object(i.a)([Object(j.b)({type:Ut})],Jt.prototype,"viewModel",void 0),Jt=Object(i.a)([Object(w.a)("esri.widgets.Feature.FeatureAttachments")],Jt);var Yt=Jt;let Kt=class extends(Object(Z.b)(N.a)){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(Object(y.a)(this,"creator",(e=>{this._destroyContent(),this._createContent(e)})))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:r}=this;e&&(me(r,{graphic:t}).catch((()=>null)),this._set("created",null))}async _createContent(e){const{graphic:t}=this,r=me(e,{graphic:t}).catch((()=>null));this._loadingPromise=r,this.notifyChange("state");const i=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",i))}};Object(i.a)([Object(j.b)({readOnly:!0})],Kt.prototype,"created",void 0),Object(i.a)([Object(j.b)()],Kt.prototype,"creator",void 0),Object(i.a)([Object(j.b)()],Kt.prototype,"destroyer",void 0),Object(i.a)([Object(j.b)({type:s.a})],Kt.prototype,"graphic",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Kt.prototype,"state",null),Kt=Object(i.a)([Object(w.a)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Kt);var er=Kt,tr=r(428);const rr="esri-feature-content",ir="esri-feature-content__loader-container",nr="esri-feature-content__loader";let sr=class extends $.a{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll("a")).forEach((e=>{ge(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))}}renderLoading(){return Object(He.a)("div",{class:ir,key:"loader"},Object(He.a)("div",{class:nr}))}renderCreated(){var e;const t=null==(e=this.viewModel)?void 0:e.created;return t?t instanceof HTMLElement?Object(He.a)("div",{key:t,bind:t,afterCreate:this._attachToNode}):Object(tr.b)(t)?Object(He.a)("div",{key:t},!t.destroyed&&t.render()):Object(He.a)("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}render(){var e;const t=null==(e=this.viewModel)?void 0:e.state;return Object(He.a)("div",{class:rr},"loading"===t?this.renderLoading():this.renderCreated())}_attachToNode(e){e.appendChild(this)}};Object(i.a)([Object(W.a)("viewModel.creator")],sr.prototype,"creator",void 0),Object(i.a)([Object(W.a)("viewModel.graphic")],sr.prototype,"graphic",void 0),Object(i.a)([Object(j.b)({type:er})],sr.prototype,"viewModel",void 0),sr=Object(i.a)([Object(w.a)("esri.widgets.Feature.FeatureContent")],sr);var ar=sr,or=r(479),lr=r(276);let cr=class extends N.a{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,r=[];return null==t||t.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const i=t.clone();i.label=ve(i,e),r.push(i)})),r}};Object(i.a)([Object(j.b)()],cr.prototype,"attributes",void 0),Object(i.a)([Object(j.b)({type:[or.a]})],cr.prototype,"expressionInfos",void 0),Object(i.a)([Object(j.b)()],cr.prototype,"description",void 0),Object(i.a)([Object(j.b)({type:[lr.a]})],cr.prototype,"fieldInfos",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],cr.prototype,"formattedFieldInfos",null),Object(i.a)([Object(j.b)()],cr.prototype,"title",void 0),cr=Object(i.a)([Object(w.a)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],cr);var ur=cr;const dr=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function hr(e,t){if("string"!=typeof t||!t)return t;const r=function(e){let t=null;return dr.some((r=>(r.pattern.test(e)&&(t=r),!!t))),t}(t);if(!r)return t;const i=t.match(r.pattern),n=i&&i[2],s=Object(Y.c)(Object(Y.c)(r.label,{messages:e,hierPart:n}),{appName:r.appName}),a=r.target?` target="${r.target}"`:"",o="_blank"===r.target?' rel="noreferrer"':"";return t.replace(r.pattern,`<a${a} href="$1"${o}>${s}</a>`)}const pr="esri-feature-fields",fr="esri-feature-fields__field-header",br="esri-feature-fields__field-data",mr="esri-feature-fields__field-data--date",gr="esri-widget__table";let yr=class extends $.a{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new ur,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Zt,Object(y.a)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo()))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:r}=this.viewModel,i=e.fieldName,n=e.label||i,s=r?null==r[i]?"":r[i]:"",a=!(!e.format||!e.format.dateFormat),o="number"!=typeof s||a?hr(this.messagesURIUtils,s):this._forceLTR(s),l={[mr]:a};return Object(He.a)("tr",{key:`fields-element-info-row-${i}-${t}`},Object(He.a)("th",{key:`fields-element-info-row-header-${i}-${t}`,class:fr,innerHTML:n}),Object(He.a)("td",{key:`fields-element-info-row-data-${i}-${t}`,class:this.classes(br,l),innerHTML:o}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e.length?Object(He.a)("table",{class:gr,summary:this.messages.fieldsSummary},Object(He.a)("tbody",null,e.map(((e,t)=>this.renderFieldInfo(e,t))))):null}render(){var e;return Object(He.a)("div",{class:pr},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};Object(i.a)([Object(W.a)("viewModel.attributes")],yr.prototype,"attributes",void 0),Object(i.a)([Object(W.a)("viewModel.description")],yr.prototype,"description",void 0),Object(i.a)([Object(W.a)("viewModel.expressionInfos")],yr.prototype,"expressionInfos",void 0),Object(i.a)([Object(W.a)("viewModel.fieldInfos")],yr.prototype,"fieldInfos",void 0),Object(i.a)([Object(W.a)("viewModel.title")],yr.prototype,"title",void 0),Object(i.a)([Object(j.b)({type:ur})],yr.prototype,"viewModel",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/Feature/t9n/Feature")],yr.prototype,"messages",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/support/t9n/uriUtils")],yr.prototype,"messagesURIUtils",void 0),yr=Object(i.a)([Object(w.a)("esri.widgets.Feature.FeatureFields")],yr);var vr=yr,Or=r(504),jr=r(84),_r=r(138),wr=r(254),xr=r(451),Sr=r(598);const Tr=f.a.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),Cr=new Map;function Mr(e){if(!Le(e))return null;const[t,r]=e.split("/").slice(1);return{layerId:t,fieldName:r}}function Pr(e,t){const r=function(e,t){if(!t.relationships)return null;let r=null;const{relationships:i}=t;return i.some((t=>t.id===parseInt(e,10)&&(r=t,!0))),r}(e,t);if(!r)return;const i=`${t.url}/${r.relatedTableId}`;return{url:i,queryTask:new Sr.a({url:i,sourceSpatialReference:t.spatialReference}),relation:r,relatedFields:[],outStatistics:[]}}async function Ar(e,t,r,i){const n=r.layerId.toString(),{layerInfo:s,queryTask:a,relation:o,relatedFields:l,outStatistics:c}=t,u=function({originRelationship:e,relationships:t,layerId:r}){let i;return t&&t.some((t=>(`${t.relatedTableId}`===r&&t.id===e.id&&(i=t),!!i))),i}({originRelationship:o,relationships:s.relationships,layerId:n});if(u.relationshipTableId&&u.keyFieldInRelationshipTable){const t=(await function(e,t,r,i){const n=new wr.a;return n.outFields=["*"],n.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),n.objectIds=[e.attributes[r.objectIdField]],r.queryRelatedFeatures(n,i)}(e,u,r,i))[e.attributes[r.objectIdField]];if(!t)return null;const n=t.features.map((e=>e.attributes[s.objectIdField]));if((null==c?void 0:c.length)>0&&s.supportsStatistics){const e=new _r.a;e.where=function(e,t,r){let i=0;const n=[];for(;i<t.length;)n.push(`${e} IN (${t.slice(i,r+i)})`),i+=r;return n.join(" OR ")}(s.objectIdField,n,1e3),e.outFields=l,e.outStatistics=c;const r={features:Promise.resolve(t),statsFeatures:a.execute(e)};return Object(m.k)(r)}}const d=null==u?void 0:u.keyField;if(d){const r=Object(te.o)(function(e,t){if(null!=e){t=t.toLowerCase();for(const r of e)if(r&&r.name.toLowerCase()===t)return r}return null}(s.fields,d)),n=function(e,t){const r=t.toLowerCase();for(const i in e)if(i.toLowerCase()===r)return e[i];return null}(e.attributes,o.keyField),l=r?`${d}=${n}`:`${d}='${n}'`,c=a.execute(new _r.a({where:l,outFields:t.relatedFields}),i),u=t.outStatistics&&t.outStatistics.length>0&&s.supportsStatistics?a.execute(new _r.a({where:l,outFields:t.relatedFields,outStatistics:t.outStatistics}),i):null,h={features:c};return u&&(h.statsFeatures=u),Object(m.k)(h)}return null}function Er({relatedInfos:e,layer:t},r){const i={};return e.forEach(((e,n)=>{const{relation:s}=e;if(!s){const e=new u.a("relation-required","A relation is required on a layer to retrieve related records.");throw Tr.error(e),e}const{relatedTableId:a}=s;if("number"!=typeof a){const e=new u.a("A related table ID is required on a layer to retrieve related records.");throw Tr.error(e),e}const o=`${t.url}/${a}`,l=Cr.get(o),c=l||function(e,t){return Object(jr.default)(e,{query:{f:"json"},signal:t&&t.signal})}(o,r);l||Cr.set(o,c),i[n]=c})),Object(m.k)(i)}let Rr=class extends N.a{constructor(e){super(e),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,r=(e+t)%t;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,r=t+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:r,expressionAttributes:i,fieldInfoMap:n,layer:s}=this;return null==t?void 0:t.map((t=>{if(!t)return null;if(t.title=we({attributes:e,fieldInfoMap:n,globalAttributes:r,expressionAttributes:i,layer:s,text:t.title}),t.caption=we({attributes:e,fieldInfoMap:n,globalAttributes:r,expressionAttributes:i,layer:s,text:t.caption}),t.altText=we({attributes:e,fieldInfoMap:n,globalAttributes:r,expressionAttributes:i,layer:s,text:t.altText}),"image"===t.type){const{value:e}=t;return this._setImageValue({value:e,formattedAttributes:r,layer:s}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){const{value:i}=t;return this._setChartValue({value:i,chartType:t.type,attributes:e,formattedAttributes:r,layer:s}),t}return null})).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:r,formattedAttributes:i,layer:n}=e,{linkURL:s,sourceURL:a}=r;if(a){const e=Te(a,n);r.sourceURL=xe({formattedAttributes:i,template:e,fieldInfoMap:t})}if(s){const e=Te(s,n);r.linkURL=xe({formattedAttributes:i,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:r,formattedAttributes:i,chartType:n,layer:s}=e,{popupTemplate:a,relatedInfos:o}=this,{fields:l,normalizeField:c}=t;if(t.fields=function(e,t){return e&&e.map((e=>Oe(e,t)))}(l,s),c&&(t.normalizeField=Oe(c,s)),!l.some((e=>!!(null!=i[e]||Le(e)&&o.size))))return;const u=null==a?void 0:a.fieldInfos;l.forEach((e=>{if(Le(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:u,fieldName:e,formattedAttributes:i,chartType:n,value:t})]);const s=this._getChartOption({value:t,attributes:r,chartType:n,formattedAttributes:i,fieldName:e,fieldInfos:u});t.series.push(s)}))}_getRelatedChartInfos(e){var t;const{fieldInfos:r,fieldName:i,formattedAttributes:n,chartType:s,value:a}=e,o=[],l=Mr(i),{layerId:c,fieldName:u}=l,d=null==(t=this.relatedInfos)?void 0:t.get(c.toString());if(!d)return o;const{relatedFeatures:h,relation:p}=d;if(!p||!h)return o;const{cardinality:f}=p;return h.forEach((e=>{const{attributes:t}=e;t&&Object.keys(t).forEach((e=>{e===u&&o.push(this._getChartOption({value:a,attributes:t,formattedAttributes:n,fieldName:i,chartType:s,relatedFieldName:e,fieldInfos:r}))}))})),"one-to-many"===f||"many-to-many"===f?o:[o[0]]}_getTooltip({label:e,value:t,chartType:r}){return"pie-chart"===r?e:`${e}: ${t}`}_getChartOption(e){var t;const{value:r,attributes:i,formattedAttributes:n,fieldName:s,relatedFieldName:a,fieldInfos:o,chartType:l}=e,{layer:c}=this,{normalizeField:u,tooltipField:d}=r,h=u?Le(u)?i[Mr(u).fieldName]:i[u]:null,p=a&&void 0!==i[a]?i[a]:void 0!==i[s]?i[s]:n[s],f=void 0===p?null:p&&h?p/h:p,b=new Or.a({value:f});if(Le(s)){const e=Mr(s),t=Mr(d),r=t?t.fieldName:null,n=Me(f,{fieldInfos:o,fieldName:a,layer:c,preventPlacesFormatting:!!h}),u=e?e.label||e.fieldName:a,p=r&&void 0!==i[r]?i[r]:u;return b.tooltip=this._getTooltip({label:p,value:n,chartType:l}),b}const m=Pe(o,s),g=Oe(s,c),y=d&&void 0!==n[d]?n[d]:ve(m||new lr.a({fieldName:g}),null==(t=this.popupTemplate)?void 0:t.expressionInfos),v=n[g];return b.tooltip=this._getTooltip({label:y,value:v,chartType:l}),b}};Object(i.a)([Object(j.b)()],Rr.prototype,"activeMediaInfoIndex",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Rr.prototype,"activeMediaInfo",null),Object(i.a)([Object(j.b)()],Rr.prototype,"attributes",void 0),Object(i.a)([Object(j.b)()],Rr.prototype,"description",void 0),Object(i.a)([Object(j.b)()],Rr.prototype,"fieldInfoMap",void 0),Object(i.a)([Object(j.b)()],Rr.prototype,"formattedAttributes",void 0),Object(i.a)([Object(j.b)()],Rr.prototype,"expressionAttributes",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Rr.prototype,"formattedMediaInfos",null),Object(i.a)([Object(j.b)()],Rr.prototype,"layer",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Rr.prototype,"formattedMediaInfoCount",null),Object(i.a)([Object(j.b)()],Rr.prototype,"mediaInfos",void 0),Object(i.a)([Object(j.b)()],Rr.prototype,"popupTemplate",void 0),Object(i.a)([Object(j.b)()],Rr.prototype,"relatedInfos",void 0),Object(i.a)([Object(j.b)()],Rr.prototype,"title",void 0),Rr=Object(i.a)([Object(w.a)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Rr);var Ir=Rr,Dr=Ir,Fr=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Lr=[].concat(Fr.slice(30,39),Fr.slice(28,30).reverse()),kr=[{name:"default",colors:Lr},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}],zr=r(125);const Vr="en-us",Nr=new Map([["ar",()=>r.e(93).then(r.bind(null,987)).then((function(e){return e.a}))],["bs-ba",()=>r.e(94).then(r.bind(null,988)).then((function(e){return e.b}))],["ca-es",()=>r.e(95).then(r.bind(null,989)).then((function(e){return e.c}))],["cs-cz",()=>r.e(96).then(r.bind(null,990)).then((function(e){return e.c}))],["da-dk",()=>r.e(97).then(r.bind(null,991)).then((function(e){return e.d}))],["de-de",()=>r.e(99).then(r.bind(null,992)).then((function(e){return e.d}))],["de-ch",()=>r.e(98).then(r.bind(null,993)).then((function(e){return e.d}))],["el-gr",()=>r.e(100).then(r.bind(null,994)).then((function(e){return e.e}))],["en-us",()=>r.e(102).then(r.bind(null,995)).then((function(e){return e.e}))],["en-ca",()=>r.e(101).then(r.bind(null,996)).then((function(e){return e.e}))],["es-es",()=>r.e(103).then(r.bind(null,997)).then((function(e){return e.e}))],["et-ee",()=>r.e(104).then(r.bind(null,998)).then((function(e){return e.e}))],["fi-fi",()=>r.e(105).then(r.bind(null,999)).then((function(e){return e.f}))],["fr-fr",()=>r.e(106).then(r.bind(null,1e3)).then((function(e){return e.f}))],["he-il",()=>r.e(107).then(r.bind(null,1001)).then((function(e){return e.h}))],["hr-hr",()=>r.e(108).then(r.bind(null,1002)).then((function(e){return e.h}))],["hu-hu",()=>r.e(109).then(r.bind(null,1003)).then((function(e){return e.h}))],["id-id",()=>r.e(110).then(r.bind(null,1004)).then((function(e){return e.i}))],["it-it",()=>r.e(112).then(r.bind(null,1005)).then((function(e){return e.i}))],["ja-jp",()=>r.e(113).then(r.bind(null,1006)).then((function(e){return e.j}))],["ko-kr",()=>r.e(114).then(r.bind(null,1007)).then((function(e){return e.k}))],["lt-lt",()=>r.e(115).then(r.bind(null,1008)).then((function(e){return e.l}))],["lv-lv",()=>r.e(116).then(r.bind(null,1009)).then((function(e){return e.l}))],["nb-no",()=>r.e(117).then(r.bind(null,1010)).then((function(e){return e.n}))],["nl-nl",()=>r.e(118).then(r.bind(null,1011)).then((function(e){return e.n}))],["pl-pl",()=>r.e(119).then(r.bind(null,1012)).then((function(e){return e.p}))],["pt-br",()=>r.e(120).then(r.bind(null,1013)).then((function(e){return e.p}))],["pt-pt",()=>r.e(121).then(r.bind(null,1014)).then((function(e){return e.p}))],["ro-ro",()=>r.e(122).then(r.bind(null,1015)).then((function(e){return e.r}))],["ru-ru",()=>r.e(123).then(r.bind(null,1016)).then((function(e){return e.r}))],["sk-sk",()=>r.e(124).then(r.bind(null,1017)).then((function(e){return e.s}))],["sl-sl",()=>r.e(125).then(r.bind(null,1018)).then((function(e){return e.s}))],["sr-rs",()=>r.e(126).then(r.bind(null,1019)).then((function(e){return e.s}))],["sv-se",()=>r.e(127).then(r.bind(null,1020)).then((function(e){return e.s}))],["th-th",()=>r.e(128).then(r.bind(null,1021)).then((function(e){return e.t}))],["tr-tr",()=>r.e(129).then(r.bind(null,1022)).then((function(e){return e.t}))],["uk-ua",()=>r.e(130).then(r.bind(null,1023)).then((function(e){return e.u}))],["vi-vn",()=>r.e(131).then(r.bind(null,1024)).then((function(e){return e.v}))],["zh-cn",()=>r.e(132).then(r.bind(null,1025)).then((function(e){return e.z}))],["zh-hk",()=>r.e(26).then(r.bind(null,1026)).then((function(e){return e.z}))],["zh-tw",()=>r.e(26).then(r.bind(null,1026)).then((function(e){return e.z}))]]);function Ur(e){return e?Nr.has(e.toLowerCase())?e.toLowerCase():function(e){const t=e.split("-")[0].toLowerCase();let r=null;for(const i of Nr.keys())if(i.startsWith(t)){r=i;break}return r}(e)||Vr:Vr}let Br,Gr;const qr="esri-feature-media",Hr="esri-feature-media__container",Wr="esri-feature-media__item-container",$r="esri-feature-media__item",Qr="esri-feature-media__item-title",Zr="esri-feature-media__item-caption",Xr="esri-feature-media__previous",Jr="esri-feature-media__previous-icon",Yr="esri-feature-media__previous-icon--rtl",Kr="esri-feature-media__next",ei="esri-feature-media__next-icon",ti="esri-feature-media__next-icon--rtl",ri="esri-feature-media__chart",ii="esri-feature-media__button",ni="esri-feature-media__icon",si="esri-icon-left-triangle-arrow",ai="esri-icon-right-triangle-arrow",oi=.05,li=.95;let ci=class extends $.a{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new Dr,this.messages=null}initialize(){this._featureElementInfo=new Zt,this.own(Object(y.a)(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(()=>this._setupMediaRefreshTimer())),Object(y.a)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())))}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return Object(He.a)("div",{bind:this,class:qr,onkeyup:this._handleMediaKeyup},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?Object(He.a)("div",{key:"media-element-container",class:Hr},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:i}=this.viewModel,{value:n,refreshInterval:s,altText:a,title:o,type:l}=e,{sourceURL:c,linkURL:u}=n,d=ge(u)?"_blank":"_self",h="_blank"===d?"noreferrer":"",p=s?t:null,f=p?p.timestamp:0,b=p?p.sourceURL:c,m=Object(He.a)("img",{alt:a||o,key:`media-${l}-${r}-${i}-${f}`,src:b});return(u?Object(He.a)("a",{title:o,href:u,rel:h,target:d},m):null)||m}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:r}=this.viewModel;return Object(He.a)("div",{key:`media-${e.type}-${t}-${r}`,bind:this,class:ri,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this.renderImageMediaInfo(e):-1!==e.type.indexOf("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?Object(He.a)("div",{key:"media-title",class:Qr,innerHTML:e.title}):null,r=e.caption?Object(He.a)("div",{key:"media-caption",class:Zr,innerHTML:e.caption}):null;return Object(He.a)("div",{key:"media-container",class:Wr},Object(He.a)("div",{key:"media-item-container",class:$r},this.renderMediaInfoType()),t,r)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,r=t?this.messages.previous:this.messages.next,i=t?this.classes(ii,Xr):this.classes(ii,Kr),n=t?this.classes(ni,Jr,si):this.classes(ni,ei,ai),s=t?this.classes(ni,Yr,ai):this.classes(ni,ti,si),a=t?"media-previous":"media-next",o=t?this._previous:this._next;return Object(He.a)("button",{type:"button",key:a,title:r,"aria-label":r,tabIndex:0,class:i,bind:this,onclick:o},Object(He.a)("span",{"aria-hidden":"true",class:n}),Object(He.a)("span",{"aria-hidden":"true",class:s}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getChartDependencies(e){const t=await async function(e=Object(zr.b)()){if(e=Ur(e),Br&&e===Gr)return Br;Br=r.e(111).then(r.bind(null,1027)).then((function(e){return e.i})),Gr=e;try{const[t,r]=await Promise.all([Br,Nr.get(Gr)()]);Gr===e&&(t.am4core.options.defaultLocale=r.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Br=null,Gr=null,null}return Br}(),{activeMediaInfo:i}=this.viewModel;this._renderChart({chartDiv:e,mediaInfo:i,chartsModule:t})}_handleMediaKeyup(e){const t=Object(d.a)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{chartsModule:t,chartDiv:r,mediaInfo:i}=e,{value:n,type:s}=i,{am4core:a}=t,o=function(e,t="default"){const r=kr.find((e=>e.name===t));return r?r.colors.map((t=>e.color(t))):null}(a);Object(Ge.g)()&&a.useTheme(t.am4themes_dark),a.useTheme(t.am4themes_animated),a.useTheme((function(e){e instanceof a.ColorSet&&o&&(e.list=o)}));const l="pie-chart"===s?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",i.altText||i.title),l.data=n.series.map((e=>({tooltip:e.tooltip,value:e.value}))).filter((e=>"pie-chart"!==s||e.value>0))}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:r}=e,{am4core:i,am4charts:n}=r,s=i.create(t,n.PieChart);s.rtl=Object(Ge.h)();const a=s.series.push(new n.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value="value",a.dataFields.category="tooltip",this._customizeChartTooltip(a.tooltip,i),s}_getMinSeriesValue(e){let t=0;return e.forEach((e=>t=Math.min(e.value,t))),t}_createColumnChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:n}=i,{am4core:s,am4charts:a}=r,o=e.xAxes.push(new a.CategoryAxis);o.dataFields.category="tooltip",o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,s),o.tooltip.events.on("sizechanged",(()=>{o.tooltip.dy=-o.tooltip.contentHeight}));const l=e.yAxes.push(new a.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=oi,l.renderer.maxLabelPosition=li,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,s),c.wrap=!0;const u=e.series.push(new a.ColumnSeries);u.dataFields.valueY="value",u.dataFields.categoryX="tooltip",e.cursor=new a.XYCursor,n.series.length>15&&(e.scrollbarX=new s.Scrollbar)}_createBarChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:n}=i,{am4core:s,am4charts:a}=r,o=e.yAxes.push(new a.CategoryAxis);o.dataFields.category="tooltip",o.renderer.inversed=!0,o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,s),o.tooltip.events.on("sizechanged",(()=>{o.tooltip.dx=o.tooltip.contentWidth}));const l=e.xAxes.push(new a.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=oi,l.renderer.maxLabelPosition=li,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,s),c.wrap=!0;const u=e.series.push(new a.ColumnSeries);u.dataFields.valueX="value",u.dataFields.categoryY="tooltip",e.cursor=new a.XYCursor,n.series.length>15&&(e.scrollbarY=new s.Scrollbar)}_createLineChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:n}=i,{am4core:s,am4charts:a}=r,o=e.xAxes.push(new a.CategoryAxis);o.dataFields.category="tooltip",o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,s),o.tooltip.events.on("sizechanged",(()=>{o.tooltip.dy=-o.tooltip.contentHeight}));const l=e.yAxes.push(new a.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=oi,l.renderer.maxLabelPosition=li,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,s),c.wrap=!0;const u=e.series.push(new a.LineSeries);u.dataFields.categoryX="tooltip",u.dataFields.valueY="value",e.cursor=new a.XYCursor,n.series.length>15&&(e.scrollbarX=new s.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:r,mediaInfo:i}=e,{type:n}=i,{am4core:s,am4charts:a}=r,o=s.create(t,a.XYChart);return o.rtl=Object(Ge.h)(),"column-chart"===n&&this._createColumnChart(o,e),"bar-chart"===n&&this._createBarChart(o,e),"line-chart"===n&&this._createLineChart(o,e),o}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:r}=e;if(!t)return;const i=6e4*t;this._updateMediaInfoTimestamp(r.sourceURL);const n=setInterval((()=>{this._updateMediaInfoTimestamp(r.sourceURL)}),i);this._refreshTimer=n}_getImageSource(e,t){const r=-1!==e.indexOf("?")?"&":"?",[i,n=""]=e.split("#");return`${i}${r}timestamp=${t}${n?"#":""}${n}`}};Object(i.a)([Object(W.a)("viewModel.attributes")],ci.prototype,"attributes",void 0),Object(i.a)([Object(W.a)("viewModel.activeMediaInfoIndex")],ci.prototype,"activeMediaInfoIndex",void 0),Object(i.a)([Object(W.a)("viewModel.description")],ci.prototype,"description",void 0),Object(i.a)([Object(W.a)("viewModel.fieldInfoMap")],ci.prototype,"fieldInfoMap",void 0),Object(i.a)([Object(W.a)("viewModel.layer")],ci.prototype,"layer",void 0),Object(i.a)([Object(W.a)("viewModel.mediaInfos")],ci.prototype,"mediaInfos",void 0),Object(i.a)([Object(W.a)("viewModel.popupTemplate")],ci.prototype,"popupTemplate",void 0),Object(i.a)([Object(W.a)("viewModel.relatedInfos")],ci.prototype,"relatedInfos",void 0),Object(i.a)([Object(W.a)("viewModel.title")],ci.prototype,"title",void 0),Object(i.a)([Object(j.b)({type:Dr})],ci.prototype,"viewModel",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/Feature/t9n/Feature")],ci.prototype,"messages",void 0),ci=Object(i.a)([Object(w.a)("esri.widgets.Feature.FeatureMedia")],ci);var ui=ci,di=r(250),hi=r(569);const pi=["$datastore","$map","$layer","$aggregatedfeatures"],fi=f.a.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");async function bi({graphic:e,view:t}){const{isAggregate:r,layer:i}=e;if(!r||!i||"2d"!==(null==t?void 0:t.type))return[];const n=await t.whenLayerView(i);if(!n.createQuery||!n.queryFeatures)return[];const s=n.createQuery();s.aggregateIds=[e.getObjectId()];const{features:a}=await n.queryFeatures(s);return a}async function mi({expressionAttributes:e,info:t,arcadeUtils:r,spatialReference:i,map:n,graphic:s,view:a}){const o=`expression/${t.name}`,l=r.createSyntaxTree(t.expression),c=pi.filter((e=>r.hasVariable(l,e)));await r.loadScriptDependencies(l,!0,c);const u=r.getViewInfo({spatialReference:i}),d=r.createExecContext(s,u);d.useAsync=!0,function({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:r,context:i,viewInfo:n,map:s,graphic:a}){r.forEach((r=>{const o=r.toLowerCase(),l={map:s,spatialReference:n.sr};if("$map"===o&&(i.vars[o]=t.convertMapToFeatureSetCollection(l)),"$layer"===o&&(i.vars[o]=t.convertFeatureLayerToFeatureSet(a.sourceLayer,n.sr)),"$datastore"===o&&(i.vars[o]=t.convertServiceUrlToWorkspace(a.sourceLayer.url,n.sr)),"$aggregatedfeatures"===o){const r=a.layer,{fields:s,objectIdField:l,geometryType:c,spatialReference:u,displayField:d}=r,h=new hi.default({fields:s,objectIdField:l,geometryType:c,spatialReference:u,displayField:d,..."feature"===r.type?{templates:r.templates,typeIdField:r.typeIdField,types:r.types}:null,source:e});i.vars[o]=t.convertFeatureLayerToFeatureSet(h,n.sr)}}))}({aggregatedFeatures:await bi({graphic:s,view:a}),arcadeUtils:r,featureSetVars:c,context:d,viewInfo:u,map:n,graphic:s});const h=r.createFunction(l,d),p=await r.executeAsyncFunction(h,d).catch((e=>fi.error("arcade-execution-error",{error:e,graphic:s,expressionInfo:t})));e[o]="string"==typeof p?Re(Ee(p)):Array.isArray(p)?function(e){return`<ul class="esri-widget__list">${e.map((e=>`<li>${"string"==typeof e?Re(Ee(e)):e}</li>`)).join("")}</ul>`}(p):p&&"esri.arcade.Dictionary"===p.declaredClass?function(e){return`<table class="esri-widget__table">${e.keys().map((t=>{const r=e.field(t);return`<tr><th>${t}</th><td>${"string"==typeof r?Re(Ee(r)):r}</td></tr>`})).join("")}</table>`}(p):p}async function gi({popupTemplate:e,spatialReference:t,graphic:i,map:n,view:s}){const a=e.expressionInfos,o=[],l={};if(!a||!a.length)return l;const c=await r.e(16).then(r.bind(null,693));for(const r of a)o.push(mi({expressionAttributes:l,info:r,arcadeUtils:c,spatialReference:t,map:n,graphic:i,view:s}));return await Object(m.k)(o),l}const yi="esri.widgets.FeatureViewModel",vi=f.a.getLogger(yi);let Oi=class extends N.a{constructor(e){super(e),this._handles=new F.a,this._featureAbortController=null,this.graphicChangedThrottled=H(this.graphicChanged,1,this),this._expressionAttributes=null,this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._handles.add(Object(y.a)(this,["graphic","_effectivePopupTemplate"],(()=>this.graphicChangedThrottled())))}destroy(){this._clear(),this._cancelFeatureQuery(),this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return Object(b.j)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function(e,t){const r=new Map;return e&&e.forEach((e=>{const i=Oe(e.fieldName,t);e.fieldName=i,r.set(i.toLowerCase(),e)})),r}(Ae(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return be(this.graphic)}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){void 0!==e?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const r=this.contentViewModels[e];r instanceof Dr&&r.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Dr&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Dr&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async graphicChanged(){this._cancelFeatureQuery(),this._clear();const{graphic:e}=this;if(!e)return;const t=Object(m.e)();this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(r){vi.error("error","error loading popupTemplate for graphic",{error:r,graphic:e})}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.map(((e,t)=>"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):void 0)):"string"==typeof e?this._compileText(new di.a({text:e}),0).text:e}_destroyContentViewModels(){this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_compileAttachments(e,t){const{graphic:r}=this,{description:i,title:n}=e;return this.contentViewModels[t]=new Ut({graphic:r,...this._compileTitleAndDesc({title:n,description:i})}),e}_compileCustom(e,t){const{graphic:r}=this,{creator:i,destroyer:n}=e;return this.contentViewModels[t]=new er({graphic:r,creator:i,destroyer:n}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:r,_sourceLayer:i,graphic:n,formattedAttributes:s,_expressionAttributes:a}=this,{attributes:o}=n,l=s.global;return{title:we({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:e}),description:we({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:t})}}_compileFields(e,t){const{_effectivePopupTemplate:r,formattedAttributes:i}=this,n=e.clone(),s=(null==e?void 0:e.fieldInfos)||(null==r?void 0:r.fieldInfos),a=null==r?void 0:r.expressionInfos,o={...i.global,...i.content[t]},{description:l,title:c}=n,u=new ur({attributes:o,expressionInfos:a,fieldInfos:s,...this._compileTitleAndDesc({title:c,description:l})});return this.contentViewModels[t]=u,n.fieldInfos=u.formattedFieldInfos.slice(0),n}_compileMedia(e,t){const{graphic:r,_fieldInfoMap:i,_effectivePopupTemplate:n,relatedInfos:s,_sourceLayer:a,_expressionAttributes:o}=this,{attributes:l}=r,c=this.formattedAttributes.global,u=e.clone(),{description:d,mediaInfos:h,title:p}=u,f=new Dr({activeMediaInfoIndex:u.activeMediaInfoIndex||0,attributes:l,layer:a,fieldInfoMap:i,formattedAttributes:c,expressionAttributes:o,mediaInfos:h,popupTemplate:n,relatedInfos:s,...this._compileTitleAndDesc({title:p,description:d})});return u.mediaInfos=f.formattedMediaInfos.slice(0),this.contentViewModels[t]=f,u}_compileText(e,t){const r=e.clone(),{graphic:i,_fieldInfoMap:n,_sourceLayer:s,_expressionAttributes:a}=this;if(r&&r.text){const{attributes:e}=i,t=this.formattedAttributes.global;r.text=we({attributes:e,fieldInfoMap:n,globalAttributes:t,expressionAttributes:a,layer:s,text:r.text})}return this.contentViewModels[t]=new er({graphic:i,creator:r.text}),r}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:r}=this;if(!e)return;const{lastEditInfoEnabled:i}=e,n=null==t?void 0:t.editFieldsInfo;return i&&n?function(e,t){const{creatorField:r,creationDateField:i,editorField:n,editDateField:s}=e;if(!t)return;const a=t[s];if("number"==typeof a){const e=t[n];return{type:"edit",date:Object(K.b)(a,fe),user:e}}const o=t[i];if("number"==typeof o){const e=t[r];return{type:"create",date:Object(K.b)(o,fe),user:e}}return null}(n,r.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:r,graphic:i,_expressionAttributes:n}=this,{attributes:s}=i;return we({attributes:s,fieldInfoMap:t,globalAttributes:this.formattedAttributes.global,expressionAttributes:n,layer:r,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return me(null==e?void 0:e.title,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return me(null==e?void 0:e.content,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:r,graphic:i,_effectivePopupTemplate:n,spatialReference:s,map:a,view:o}=this,{content:{value:l},title:{value:c}}=await Object(m.k)({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!i)return;await Fe({graphic:i,popupTemplate:n,layer:r,spatialReference:s},e);const{expressionAttributes:{value:u}}=await Object(m.k)({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:gi({popupTemplate:this._effectivePopupTemplate,spatialReference:s,graphic:i,map:a,view:o})});t===this._featureAbortController&&i&&(this._expressionAttributes=u,this._set("formattedAttributes",this._createFormattedAttributes(l,u)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createFormattedAttributes(e,t){const{_effectivePopupTemplate:r,graphic:i,relatedInfos:n,_sourceLayer:s,_fieldInfoMap:a}=this,o=null==r?void 0:r.fieldInfos,l={...i.attributes,...t},c={global:De({fieldInfos:o,graphic:i,attributes:l,layer:s,fieldInfoMap:a,relatedInfos:n}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&e.fieldInfos&&(c.content[t]=De({fieldInfos:e.fieldInfos,graphic:i,attributes:l,layer:s,fieldInfoMap:a,relatedInfos:n}))})),c}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:r}=this;return this._queryRelatedInfos(t,Ae(r),e)}async _queryRelatedInfos(e,t,r){const{relatedInfos:i,_sourceLayer:n}=this;i.clear();const s=Object(b.j)(n.associatedLayer)?await n.associatedLayer.load(r):n;if(!s)return;const a=t.filter((e=>e&&Le(e.fieldName)));if(!a||!a.length)return;t.forEach((e=>this._configureRelatedInfo(e,s)));const o=await Er({relatedInfos:i,layer:s},r);Object.keys(o).forEach((e=>{var t;const r=i.get(e.toString()),n=null==(t=o[e])?void 0:t.value;r&&n&&(r.layerInfo=n.data)}));const l=await function({graphic:e,relatedInfos:t,layer:r},i){const n={};return t.forEach(((t,s)=>{t.layerInfo&&(n[s]=Ar(e,t,r,i))})),Object(m.k)(n)}({graphic:e,relatedInfos:i,layer:s},r);Object.keys(l).forEach((e=>{var t;!function(e,t){if(!t)return;if(!e)return;const{features:r,statsFeatures:i}=e,n=r&&r.value;t.relatedFeatures=n?n.features:[];const s=i&&i.value;t.relatedStatsFeatures=s?s.features:[]}(null==(t=l[e])?void 0:t.value,i.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:r}=this,i=Mr(e.fieldName);if(!i)return;const{layerId:n,fieldName:s}=i;if(!n)return;const a=r.get(n.toString())||Pr(n,t);a&&(function({relatedInfo:e,fieldName:t,fieldInfo:r}){if(e.relatedFields.push(t),r.statisticType){const i=new xr.a({statisticType:r.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(i)}}({relatedInfo:a,fieldName:s,fieldInfo:e}),this.relatedInfos.set(n,a))}};Object(i.a)([Object(j.b)()],Oi.prototype,"_featureAbortController",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Oi.prototype,"_effectivePopupTemplate",null),Object(i.a)([Object(j.b)({readOnly:!0})],Oi.prototype,"_fieldInfoMap",null),Object(i.a)([Object(j.b)({readOnly:!0})],Oi.prototype,"_sourceLayer",null),Object(i.a)([Object(j.b)({readOnly:!0})],Oi.prototype,"content",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Oi.prototype,"contentViewModels",void 0),Object(i.a)([Object(j.b)({type:Boolean})],Oi.prototype,"defaultPopupTemplateEnabled",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Oi.prototype,"formattedAttributes",void 0),Object(i.a)([Object(j.b)({type:s.a,value:null})],Oi.prototype,"graphic",null),Object(i.a)([Object(j.b)({readOnly:!0})],Oi.prototype,"lastEditInfo",void 0),Object(i.a)([Object(j.b)()],Oi.prototype,"relatedInfos",void 0),Object(i.a)([Object(j.b)()],Oi.prototype,"spatialReference",null),Object(i.a)([Object(j.b)({readOnly:!0})],Oi.prototype,"title",void 0),Object(i.a)([Object(j.b)()],Oi.prototype,"map",null),Object(i.a)([Object(j.b)({readOnly:!0})],Oi.prototype,"waitingForContent",null),Object(i.a)([Object(j.b)()],Oi.prototype,"view",void 0),Oi=Object(i.a)([Object(w.a)(yi)],Oi);var ji=Oi;const _i=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>Object(tr.b)(e)&&!e.destroyed?Object(He.a)("div",{key:e},e.render()):e instanceof HTMLElement?Object(He.a)("div",{key:e,bind:e,afterCreate:this._attachToNode}):Object(tr.a)(e)?Object(He.a)("div",{key:e,bind:e.domNode,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};return t=Object(i.a)([Object(w.a)("esri.widgets.Feature.ContentMixin")],t),t};var wi=r(225);const xi="esri-icon-loading-indicator esri-rotating",Si="esri-widget",Ti="esri-feature",Ci="esri-feature__size-container",Mi="esri-feature__title",Pi="esri-feature__main-container",Ai="esri-feature__content-element",Ei="esri-feature__text",Ri="esri-feature__last-edited-info",Ii="esri-feature__loading-container",Di="esri-feature__loading-spinner",Fi={title:!0,content:!0,lastEditedInfo:!0};let Li=class extends(_i($.a)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...Fi},this.map=null,this.view=null,this.viewModel=new ji}initialize(){this.own(Object(y.a)(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...Fi,...e}}render(){const{waitingForContent:e}=this.viewModel;return Object(He.a)("div",{class:this.classes(Ti,Si)},Object(He.a)("div",{class:Ci},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderLoading(){return Object(He.a)("div",{key:"loading-container",class:Ii},Object(He.a)("span",{class:this.classes(xi,Di)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?Object(He.a)("div",{class:Pi},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?Object(He.a)(qt,{level:this.headingLevel,class:Mi,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?Object(He.a)("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:Object(He.a)("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:r}=this;if("boolean"!=typeof r.content&&!r.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:r,attachmentInfos:i}=t.viewModel;return"loading"===r||i.length>0?Object(He.a)("div",{key:this._buildKey("attachments-element",e),class:this.classes(Ai)},t.render()):null}renderCustom(e,t){const{creator:r}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:r?Object(He.a)("div",{key:this._buildKey("custom-element",t),class:Ai},i.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Object(He.a)("div",{key:this._buildKey("fields-element",e),class:Ai},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Object(He.a)("div",{key:this._buildKey("media-element",e),class:Ai},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:r}=this.viewModel;if(!r||!e.lastEditedInfo)return null;const{date:i,user:n}=r,s="edit"===r.type?n?t.lastEditedByUser:t.lastEdited:n?t.lastCreatedByUser:t.lastCreated,a=Object(wi.a)(s,{date:i,user:n});return Object(He.a)("div",{key:"edit-info-element",class:this.classes(Ri,Ai)},a)}renderText(e,t){const r=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:r?Object(He.a)("div",{key:this._buildKey("text-element",t),class:this.classes(Ai,Ei)},i.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,r=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(r))r.forEach(((r,n)=>{"attachments"===r.type&&(this._contentWidgets[n]=new Yt({displayType:r.displayType,headingLevel:t.title?e+1:e,viewModel:i[n]})),"fields"===r.type&&(this._contentWidgets[n]=new vr({viewModel:i[n]})),"media"===r.type&&(this._contentWidgets[n]=new ui({viewModel:i[n]})),"text"===r.type&&(this._contentWidgets[n]=new ar({viewModel:i[n]})),"custom"===r.type&&(this._contentWidgets[n]=new ar({viewModel:i[n]}))}),this);else{const e=i[0];e&&!e.destroyed&&(this._contentWidgets[0]=new ar({viewModel:e}))}this.scheduleRender()}};Object(i.a)([Object(W.a)("viewModel.graphic")],Li.prototype,"graphic",void 0),Object(i.a)([Object(W.a)("viewModel.defaultPopupTemplateEnabled")],Li.prototype,"defaultPopupTemplateEnabled",void 0),Object(i.a)([Object(j.b)()],Li.prototype,"headingLevel",void 0),Object(i.a)([Object(j.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Li.prototype,"label",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/Feature/t9n/Feature")],Li.prototype,"messages",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/support/t9n/uriUtils")],Li.prototype,"messagesURIUtils",void 0),Object(i.a)([Object(W.a)("viewModel.spatialReference")],Li.prototype,"spatialReference",void 0),Object(i.a)([Object(W.a)("viewModel.title")],Li.prototype,"title",void 0),Object(i.a)([Object(j.b)()],Li.prototype,"visibleElements",void 0),Object(i.a)([Object(_.a)("visibleElements")],Li.prototype,"castVisibleElements",null),Object(i.a)([Object(W.a)("viewModel.map")],Li.prototype,"map",void 0),Object(i.a)([Object(W.a)("viewModel.view")],Li.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:ji})],Li.prototype,"viewModel",void 0),Li=Object(i.a)([Object(w.a)("esri.widgets.Feature")],Li);var ki=Li,zi=r(68);let Vi=class extends zi.a.EventedAccessor{constructor(e){super(e),this._anchorHandles=new F.a,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([Object(y.e)(this,["screenLocationEnabled","location","view.size","view.stationary"],(()=>this._updateScreenPointAndHandle())),Object(y.e)(this,["view","view.ready"],(()=>this._wireUpView()))])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const e="view";if(this._anchorHandles.remove(e),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,r="3d"===t.type?"camera":"viewpoint",i=Object(y.d)(t,r,(()=>this._viewpointChange()));this._anchorHandles.add(i,e),this._viewpointHandle=i,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:e,location:t,screenLocationEnabled:r}=this;e&&(t&&r?e.resume():e.pause())}_setScreenLocation(){const{location:e,view:t,screenLocationEnabled:r}=this,i=this.get("view.ready"),n=r&&i&&Object(b.j)(e)?t.toScreen(e):null;this._set("screenLocation",n)}};Object(i.a)([Object(j.b)()],Vi.prototype,"location",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Vi.prototype,"screenLocation",void 0),Object(i.a)([Object(j.b)()],Vi.prototype,"screenLocationEnabled",void 0),Object(i.a)([Object(j.b)()],Vi.prototype,"view",void 0),Vi=Object(i.a)([Object(w.a)("esri.widgets.support.AnchorElementViewModel")],Vi);var Ni=Vi;let Ui=class extends Ni{constructor(e){super(e),this.visible=!1}};Object(i.a)([Object(j.b)()],Ui.prototype,"visible",void 0),Ui=Object(i.a)([Object(w.a)("esri.widgets.CompassViewModel")],Ui);var Bi=Ui;const Gi="esri-spinner",qi="esri-spinner--start",Hi="esri-spinner--finish";let Wi=class extends $.a{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new Bi,this.visible=!1}initialize(){this.own([Object(y.e)(this,"visible",(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:r}=e;t&&(this.viewModel.location=t),this.visible=!0;r&&r.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,r=!!t,i={[qi]:e&&r,[Hi]:!e&&r},n=this._getPositionStyles();return Object(He.a)("div",{class:this.classes(Gi,i),styles:n})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=Object(m.a)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||Object(b.i)(e))return{};const{padding:r}=t;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};Object(i.a)([Object(W.a)("viewModel.location")],Wi.prototype,"location",void 0),Object(i.a)([Object(W.a)("viewModel.view")],Wi.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:Bi})],Wi.prototype,"viewModel",void 0),Object(i.a)([Object(W.a)("viewModel.visible")],Wi.prototype,"visible",void 0),Wi=Object(i.a)([Object(w.a)("esri.widgets.Spinner")],Wi);var $i=Wi,Qi=(r(86),r(303)),Zi=r(322),Xi=r(302),Ji=r(510),Yi=r(256);function Ki(e){return e&&"opacity"in e?e.opacity*Ki(e.parent):1}var en=r(557);const tn=Object(p.a)("mac")?"Meta":"Ctrl",rn={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let nA=48;nA<58;nA++)rn[nA]=String.fromCharCode(nA);for(let nA=1;nA<25;nA++)rn[111+nA]=`F${nA}`;for(let nA=65;nA<91;nA++)rn[nA]=[String.fromCharCode(nA+32),String.fromCharCode(nA)];function nn(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class sn{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const r of this.keyModifiers)if(!t.has(r))return!1;return!0}}const an=f.a.getLogger("esri.views.input.InputHandler");class on{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?an.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,r){let i;"function"==typeof t?(r=t,i=[]):i=t||[];const n="string"==typeof e?new sn(e,i):e,s=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=e=>{const t=this._incoming[e.match.eventType];if(t){const r=t.indexOf(e);t.splice(r,1),s(),this._manager&&this._manager.updateDependencies()}},o=new ln(n,r,{onPause:a,onRemove:a,onResume:e=>{const t=this._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),s(),this._manager&&this._manager.updateDependencies())}});let l=this._incoming[n.eventType];return l||(l=[],this._incoming[n.eventType]=l),l.push(o),s(),this._manager&&this._manager.updateDependencies(),o}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new cn(e,{onEmit:(e,t,r,i)=>{this._manager.emit(e.eventType,t,r,i)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):an.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const r of t)if(r.match.matches(e)&&(r.callback(e),e.shouldStopPropagation()))break}}class ln{constructor(e,t,r){this.match=e,this._callback=t,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class cn{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,r){this._removed||this._handler.onEmit(this,e,t,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class un extends on{constructor(e){super(!0),this._onChange=e,this._value="mouse",this.registerIncoming("pointer-down",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler=this.registerIncoming("pointer-move",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler.pause()}_setValue(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}const dn=f.a.getLogger("esri.views.input.InputManager");let hn=class extends N.a{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=tn,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}installHandlers(e,t,r=fn.INTERNAL){if(this._nameToGroup[e])return void dn.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void dn.error("Can't register a group of zero handlers");const i={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=i;for(let n=i.handlers.length-1;n>=0;n--){const e=i.handlers[n];this._handlers.push(e),e.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(t,r,i,n,s)=>{this._emitInputEvent(e.priorityIndex+1,t,r,i,s,n)},setPointerCapture:(t,r)=>{this._setPointerCapture(i,e,t,r)},setEventCallback:t=>{e.eventCallback=t},setUninstallCallback:t=>{e.uninstallCallback=t},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):dn.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const e=this._handlers[r];e.priorityIndex=r,this._handlersPriority.push(e)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const i=this._handlersPriority[r];i.priorityIndex=r;let n=i.handler.hasSideEffects;if(!n)for(const t of i.handler.outgoingEventTypes)if(e.has(t)){n=!0;break}if(n)for(const r of i.handler.incomingEventMatches){e.add(r.eventType);for(const e of r.keyModifiers)nn(e)||t.add(e)}i.active=n}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const r=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,r,i)}_updateKeyModifiers(e,t){if(!t)return;let r=!1;const i=()=>{if(!r){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,r=!0}},n=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(i(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(i(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const r=t.key;this._keyModifiers.has(r)&&n(r,"key-down"===e)}const s=t.native;n("Alt",!(!s||!s.altKey)),n("Ctrl",!(!s||!s.ctrlKey)),n("Shift",!(!s||!s.shiftKey)),n("Meta",!(!s||!s.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new un((e=>this._setLatestPointerType(e))),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,fn.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],fn.INTERNAL)}_setPointerCapture(e,t,r,i){const n=e.name+"-"+t.priorityIndex,s=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,s),i?(s.add(n),1===s.size&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):s.has(n)&&(s.delete(n),0===s.size&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,r,i){this._emitInputEvent(0,e,t,r,i)}_emitInputEvent(e,t,r,i,n,s){const a=void 0!==i?i:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),o=void 0!==n&&n,l={event:new pn(t,r,a,s||this._activeKeyModifiers,o),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new en.a,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:r}=this._currentPropagation.events.pop(),i=t.data&&t.data.eventId;if(null==i||!this._stoppedPropagationEventIds.has(i))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){null!=i&&this._stoppedPropagationEventIds.add(i);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new en.a;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(r.eventType!==e.eventType)continue;const t=r.keyModifiers.filter((t=>-1!==e.keyModifiers.indexOf(t)));if(t.length===r.keyModifiers.length!==(t.length===e.keyModifiers.length))return r.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const r of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(r,t[e])>=0;)e++;t.splice(e,0,r)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,r)=>{e((()=>{this._onEventReceived(t,r)}))},disablePointerCapture:e}}};Object(i.a)([Object(j.b)({readOnly:!0})],hn.prototype,"hasPendingInputs",null),Object(i.a)([Object(j.b)()],hn.prototype,"eventSource",void 0),Object(i.a)([Object(j.b)()],hn.prototype,"recognizers",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],hn.prototype,"latestPointerType",void 0),hn=Object(i.a)([Object(w.a)("esri.views.input.InputManager")],hn);class pn{constructor(e,t,r,i,n){this.type=e,this.data=t,this.timestamp=r,this.modifiers=i,this.cancelable=n,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return 0!=(1&this._propagationState)}async(e){this._propagationState|=2;const t=(e,t)=>{this._propagationState&=-3;const r=this._resumeCallback;if(this._resumeCallback=null,r&&r(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}const fn={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};var bn=r(455);const mn="esri-icon-zoom-in-magnifying-glass",gn="esri-icon-trash",yn="esri-icon-table",vn=new Xi.a({id:"zoom-to-feature",title:"{messages.zoom}",className:mn}),On=new Xi.a({id:"remove-selected-feature",title:"{messages.remove}",className:gn}),jn=new Xi.a({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:mn}),_n=new Xi.a({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:yn}),wn=f.a.getLogger("esri.widgets.Popup.PopupViewModel"),xn=function(e){const{event:t,view:r}=e,{action:i}=t,n=r&&r.popup;if(!i)return Promise.reject(new u.a("trigger-action:missing-arguments","Event has no action"));if(!n)return Promise.reject(new u.a("trigger-action:missing-arguments","view.popup is missing"));const{disabled:s,id:a}=i;if(!a)return Promise.reject(new u.a("trigger-action:invalid-action","action.id is missing"));if(s)return Promise.reject(new u.a("trigger-action:invalid-action","Action is disabled"));if(a===vn.id)return async function(e){const{location:t,selectedFeature:r,view:i,zoomFactor:n}=e,s=Sn(e);if(!s){const e=new u.a("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:i});return wn.error(e),Promise.reject(e)}const a=i.scale/n,o=e.get("selectedFeature.geometry")||t,l=o&&"point"===o.type&&function(e,t){if("3d"!==(null==t?void 0:t.type)||!e||"esri.Graphic"!==e.declaredClass)return!0;const r=t.getViewForGraphic(e);if(r&&"whenGraphicBounds"in r){let t=!1;return r.whenGraphicBounds(e,{useViewElevation:!0}).then((e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const t=new u.a("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});wn.error(t)})),t}return!0}(r,i);vn.active=!0,vn.disabled=!0,await e.view.goTo({target:s,scale:l?a:void 0}),vn.active=!1,vn.disabled=!1,e.zoomToLocation=null,l&&(e.location=o)}(n.viewModel);if(a===jn.id)return async function(e){const{selectedFeature:t,view:r}=e;if("2d"!==(null==r?void 0:r.type)){const e=new u.a("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r});throw wn.error(e),e}if(!t.isAggregate){const e=new u.a("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw wn.error(e),e}const i=t.sourceLayer,n=await r.whenLayerView(i),s=n.createQuery();s.aggregateIds=[t.getObjectId()],jn.active=!0,jn.disabled=!0;const{extent:a}=await n.queryExtent(s);await r.goTo({target:a}),jn.active=!1,jn.disabled=!1}(n.viewModel);if(a===_n.id)return n.featureMenuOpen=!n.featureMenuOpen,n.viewModel.browseClusterEnabled=!n.viewModel.browseClusterEnabled,Promise.resolve();if(n.viewModel.browseClusterEnabled=!1,a===On.id){n.close();const{selectedFeature:e}=n;if(!e)return Promise.reject(new u.a(`trigger-action:${On.id}`,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):r.graphics.remove(e),Promise.resolve()}return Promise.resolve()};function Sn(e){const{selectedFeature:t,location:r,view:i}=e;return i?"3d"===i.type?t||r:e.get("selectedFeature.geometry")||r:null}const Tn=e=>{let t=class extends e{constructor(...e){super(...e),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}};return Object(i.a)([Object(j.b)()],t.prototype,"goToOverride",void 0),Object(i.a)([Object(j.b)()],t.prototype,"view",void 0),t=Object(i.a)([Object(w.a)("esri.widgets.support.GoTo")],t),t};var Cn=r(211),Mn=r(41);const Pn=l.a.ofType({key:"type",defaultKeyValue:"button",base:Zi.a,typeMap:{button:Xi.a,toggle:Ji.a}}),An="esri.widgets.Popup.PopupViewModel",En=f.a.getLogger(An);let Rn=class extends(Tn(Ni)){constructor(e){super(e),this._handles=new F.a,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new Pn,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new s.a({symbol:new Cn.a({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some((e=>e.waitingForContent))}initialize(){this._handles.add([Object(y.a)(this,["autoOpenEnabled","view"],(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),Object(y.e)(this,["highlightEnabled","selectedFeature","visible","view"],(()=>this._highlightFeature())),Object(y.e)(this,"view.animation.state",(e=>this._animationStateChange(e))),Object(y.e)(this,"location",(e=>this._locationChange(e))),Object(y.e)(this,"selectedFeature",(e=>this._selectedFeatureChange(e))),Object(y.e)(this,["selectedFeatureIndex","featureCount","featuresPerPage"],(()=>this._selectedFeatureIndexChange())),Object(y.e)(this,["featurePage","selectedFeatureIndex","featureCount","featuresPerPage, featureViewModels"],(()=>this._setGraphicOnFeatureViewModels())),Object(y.e)(this,"featureViewModels",(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>xn({event:e,view:this.view}))),Object(y.g)(this,"waitingForResult",(()=>this._waitingForResultChange()),!0),Object(y.e)(this,["features","view","view.map","view.spatialReference"],(()=>this._updateFeatureVMs())),Object(y.e)(this,["view.scale"],this._viewScaleChange),Object(y.g)(this,"visible",(()=>this.browseClusterEnabled=!1)),Object(y.e)(this,"browseClusterEnabled",(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new Pn;e.removeAll();const{actions:t,defaultActions:r,defaultPopupTemplateEnabled:i,includeDefaultActions:n,selectedFeature:s}=this,a=n?r.concat(t):t,o=s&&("function"==typeof s.getEffectivePopupTemplate&&s.getEffectivePopupTemplate(i)||s.popupTemplate),l=o&&o.actions,c=o&&o.overwriteActions?l:l?l.concat(a):a;return c&&c.filter(Boolean).forEach((t=>e.add(t))),e}get defaultActions(){var e;const t=this._get("defaultActions")||new Pn;return t.removeAll(),t.addMany(null!=(e=this.selectedFeature)&&e.isAggregate?[jn.clone(),_n.clone()]:[vn.clone()]),t}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:r,promiseCount:i,selectedFeatureIndex:n}=this,s=i&&t.length;s&&r&&-1===n?this.selectedFeatureIndex=0:s&&-1!==n||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Object(R.b)(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((e=>{this._pendingPromises.add(e);e.then((t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)}),(()=>this._updatePendingPromises(e)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=Sn(this);if(!t){const r=new u.a("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return En.error(r),Promise.reject(r)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:r}=this;if(!r||!e){const t=new u.a("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return En.error(t),Promise.reject(t)}return r.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:r}=t;delete t.fetchFeatures,r&&this._setFetchFeaturesPromises(t.location),this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){var e;(e=this).features=e.features.filter((e=>e.isAggregate)),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){await async function(e){const{selectedFeature:t,view:r}=e;if("2d"!==(null==r?void 0:r.type)){const e=new u.a("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:r});throw wn.error(e),e}if(!t.isAggregate){const e=new u.a("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw wn.error(e),e}const i=t.sourceLayer,n=await r.whenLayerView(i),s=n.createQuery();s.aggregateIds=[t.getObjectId()];const{extent:a}=await n.queryExtent(s);e.selectedClusterBoundaryFeature.geometry=a,r.graphics.add(e.selectedClusterBoundaryFeature)}(this),await async function(e){const{selectedFeature:t,view:r}=e;if("2d"!==(null==r?void 0:r.type)){const e=new u.a("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:r});throw wn.error(e),e}if(!t.isAggregate){const e=new u.a("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw wn.error(e),e}const i=t.sourceLayer,n=await r.whenLayerView(i),s=n.createQuery();s.aggregateIds=[t.getObjectId()],_n.active=!0,_n.disabled=!0;const{features:a}=await n.queryFeatures(s);_n.active=!1,_n.disabled=!1,r.popup.open({features:[t].concat(a),featureMenuOpen:!0})}(this)}_animationStateChange(e){this.zoomToLocation||(vn.disabled="waiting-for-target"===e)}_clearBrowsedClusterGraphics(){var e;const t=null==(e=this.view)?void 0:e.graphics;t&&(t.remove(this.selectedClusterBoundaryFeature),t.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){var e;(null!=(e=this.selectedFeature)&&e.isAggregate||this.browseClusterEnabled)&&(this.browseClusterEnabled=!1,this.visible=!1)}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:r}=this;r&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:r,featuresPerPage:i,featureViewModels:n}=this;if(null===r)return;const s=((r-1)*i+t)%t,a=s+i;n.slice(s,a).forEach(((t,r)=>{t&&!t.graphic&&(t.graphic=e[s+r])}))}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:n}=this;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),e.isAggregate)return;return e.symbol=await async function(e,t){var i,n;if(!e)return;const s=e.sourceLayer,a=null!=(i=Object(b.j)(t)&&null!=(n=t.useSourceLayer)&&n?s:e.layer)?i:s,o=Ki(a);if(Object(b.j)(e.symbol)&&(!Object(b.j)(t)||!0!==t.ignoreGraphicSymbol)){const r="web-style"===e.symbol.type?await e.symbol.fetchSymbol(Object(b.j)(t)?t.abortOptions:null):e.symbol.clone();return Object(Yi.a)(r,null,o),r}const l=Object(b.j)(t)&&t.renderer||a&&"renderer"in a&&a.renderer;let c=l&&"getSymbolAsync"in l?await l.getSymbolAsync(e,t):null;if(!c)return;if(c="web-style"===c.type?await c.fetchSymbol(Object(b.j)(t)?t.abortOptions:null):c.clone(),!("visualVariables"in l)||!l.visualVariables||!l.visualVariables.length)return Object(Yi.a)(c,null,o),c;if("arcadeRequiredForVisualVariables"in l&&l.arcadeRequiredForVisualVariables&&(Object(b.i)(t)||Object(b.i)(t.arcade))){const e={...Object(b.s)(t)};e.arcade=await Object(ie.e)(),t=e}const u=await Promise.resolve().then(r.bind(null,416)),d=[],h=[],p=[],f=[];for(const r of l.visualVariables)switch(r.type){case"color":d.push(r);break;case"opacity":h.push(r);break;case"rotation":f.push(r);break;case"size":r.target||p.push(r)}const m=!!d.length&&d[d.length-1],g=m?u.getColor(m,e,t):null,y=!!h.length&&h[h.length-1];let v=y?u.getOpacity(y,e,t):null;if(null!=o&&(v=null!=v?v*o:o),Object(Yi.a)(c,g,v),p.length){const r=u.getAllSizes(p,e,t);await Object(Yi.d)(c,r)}for(const r of f)Object(Yi.c)(c,u.getRotationAngle(r,e,t),r.axis);return c}(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature)}!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then((()=>{this.location=n.center.clone()})):this.location=Object(b.s)(this._getPointFromGeometry(e.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:r}=e,i=Promise.resolve(t),n=r.map((e=>e.promise));this.promises=[i,...n]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:r}=this;if(null!=e&&e.isAggregate||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const i=r.slice(0),n=[];t.forEach(((t,r)=>{if(!t)return;let s=null;if(i.some(((e,r)=>(e&&e.graphic===t&&(s=e,i.splice(r,1)),!!s))),s)n[r]=s;else{var a,o;const i=new ji({defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(a=this.view)?void 0:a.spatialReference,graphic:t===e?t:null,map:null==(o=this.view)?void 0:o.map,view:this.view});n[r]=i}})),i.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",n)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:r}=this;if(t.remove(e),r&&this.view){const r=this.view.on("click",(e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)}),fn.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const r=Object(m.e)(),{signal:i}=r;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");const n=this.fetchFeatures(e,{signal:i,event:t});return n.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),n}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:r}=e,{view:i}=this;this._fetchFeaturesWithController(t,e).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:n,location:s}=e,a=[Promise.resolve(t),...n.map((e=>e.promise))];return i.popup.open({location:s||r,promises:a}),e}))}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return Object(b.i)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:r,view:i,visible:n}=this;if(!(t&&i&&r&&n))return;let{layer:s,sourceLayer:a}=t;if("map-notes"!==(null==a?void 0:a.type)&&"subtype-group"!==(null==a?void 0:a.type)||(s=a),!(s&&s instanceof Qi.a))return;const o=this._getLayerView(i,s);this._highlightPromise=o;const l=await o;if(!(l&&Object(bn.b)(l)&&this._highlightPromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c="objectIdField"in s&&s.objectIdField,u=t.attributes,d=u&&c&&u[c],h=l.highlight(d||t);this._handles.add(h,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const r=e.filter((e=>-1===t.indexOf(e)));this.features=t.concat(r)}};Object(i.a)([Object(j.b)()],Rn.prototype,"featurePage",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"isLoadingFeature",null),Object(i.a)([Object(j.b)({type:Pn})],Rn.prototype,"actions",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"active",null),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"allActions",null),Object(i.a)([Object(j.b)({type:Boolean})],Rn.prototype,"defaultPopupTemplateEnabled",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"autoCloseEnabled",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"autoOpenEnabled",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"browseClusterEnabled",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"content",void 0),Object(i.a)([Object(j.b)({type:Pn,readOnly:!0})],Rn.prototype,"defaultActions",null),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"featureCount",null),Object(i.a)([Object(j.b)()],Rn.prototype,"features",null),Object(i.a)([Object(j.b)()],Rn.prototype,"featuresPerPage",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"featureViewModels",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"highlightEnabled",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"includeDefaultActions",void 0),Object(i.a)([Object(j.b)({type:Mn.a})],Rn.prototype,"location",null),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"pendingPromisesCount",null),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"selectedClusterBoundaryFeature",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"waitingForResult",null),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"promiseCount",null),Object(i.a)([Object(j.b)()],Rn.prototype,"promises",null),Object(i.a)([Object(j.b)({value:null,readOnly:!0})],Rn.prototype,"selectedFeature",null),Object(i.a)([Object(j.b)({value:-1})],Rn.prototype,"selectedFeatureIndex",null),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"selectedFeatureViewModel",null),Object(i.a)([Object(j.b)({readOnly:!0})],Rn.prototype,"state",null),Object(i.a)([Object(j.b)()],Rn.prototype,"title",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"updateLocationEnabled",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"view",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"visible",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"zoomFactor",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"zoomToLocation",void 0),Object(i.a)([Object(j.b)()],Rn.prototype,"centerAtLocation",null),Rn=Object(i.a)([Object(w.a)(An)],Rn);var In=Rn,Dn=r(163),Fn=r(491);const Ln="selected-index",kn="popup-spinner",zn="esri-icon-left-triangle-arrow",Vn="esri-icon-right-triangle-arrow",Nn="esri-icon-maximize",Un="esri-icon-dock-bottom",Bn="esri-icon-dock-left",Gn="esri-icon-dock-right",qn="esri-icon-close",Hn="esri-icon-minimize",Wn="esri-icon-check-mark",$n="esri-icon-loading-indicator",Qn="esri-icon-default-action",Zn="esri-icon-handle-horizontal",Xn="esri-rotating",Jn="esri-popup",Yn="esri-widget",Kn="esri-popup__main-container",es="esri-popup__loading-container",ts="esri-popup--is-collapsible",rs="esri-popup--is-collapsed",is="esri-popup--shadow",ns="esri-popup--is-docked",ss="esri-popup--is-docked-top-left",as="esri-popup--is-docked-top-center",os="esri-popup--is-docked-top-right",ls="esri-popup--is-docked-bottom-left",cs="esri-popup--is-docked-bottom-center",us="esri-popup--is-docked-bottom-right",ds="esri-popup--aligned-top-center",hs="esri-popup--aligned-bottom-center",ps="esri-popup--aligned-top-left",fs="esri-popup--aligned-bottom-left",bs="esri-popup--aligned-top-right",ms="esri-popup--aligned-bottom-right",gs="esri-popup--feature-menu-open",ys="esri-popup--actions-menu-open",vs="esri-popup--feature-updated",Os="esri-popup__header",js="esri-popup__header-buttons",_s="esri-popup__header-container",ws="esri-popup__header-container--button",xs="esri-popup__header-title",Ss="esri-popup__content",Ts="esri-popup__footer",Cs="esri-popup__footer--has-pagination",Ms="esri-popup__footer--has-actions",Ps="esri-popup__footer--has-actions-menu",As="esri-popup__button",Es="esri-popup__button--disabled",Rs="esri-popup__button--dock",Is="esri-popup__icon",Ds="esri-popup__icon--dock-icon",Fs="esri-popup__inline-actions-container",Ls="esri-popup__actions-menu-button",ks="esri-popup__actions",zs="esri-popup__action",Vs="esri-popup__action-image",Ns="esri-popup__action-text",Us="esri-popup__action-toggle",Bs="esri-popup__action-toggle--on",Gs="esri-popup__pointer",qs="esri-popup__pointer-direction",Hs="esri-popup__navigation",Ws="esri-popup__pagination-previous",$s="esri-popup__pagination-next",Qs="esri-popup__pagination-previous-icon",Zs="esri-popup__pagination-previous-icon--rtl",Xs="esri-popup__pagination-next-icon",Js="esri-popup__pagination-next-icon--rtl",Ys="esri-popup__feature-menu",Ks="esri-popup__feature-menu-list",ea="esri-popup__feature-menu-item",ta="esri-popup__feature-menu-viewport",ra="esri-popup__feature-menu-header",ia="esri-popup__feature-menu-item--selected",na="esri-popup__feature-menu-button",sa="esri-popup__feature-menu-title",aa="esri-popup__feature-menu-observer",oa="esri-popup__feature-menu-loader",la={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};function ca(e,t){return void 0===t?`esri-popup__${e}`:`esri-popup__${e}-${t}`}const ua="esri.widgets.Popup",da=f.a.getLogger(ua),ha={closeButton:!0,featureNavigation:!0};let pa=class extends(_i($.a)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new F.a,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([e])=>{null!=e&&e.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback),this._displaySpinnerThrottled=H((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new In,this.visible=null,this.visibleElements={...ha},this._addSelectedFeatureIndexHandle(),this.own([Object(y.e)(this,"viewModel.screenLocation",(()=>this._positionContainer())),Object(y.e)(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),Object(y.e)(this,"viewModel.screenLocation",((e,t)=>{!!e!=!!t&&this.reposition()})),Object(y.e)(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),Object(y.e)(this,"spinnerEnabled",(e=>this._spinnerEnabledChange(e))),Object(y.e)(this,"viewModel.view.size",((e,t)=>this._updateDockEnabledForViewSize(e,t))),Object(y.e)(this,"viewModel.view",((e,t)=>this._viewChange(e,t))),Object(y.e)(this,"viewModel.view.ready",((e,t)=>this._viewReadyChange(e,t))),Object(y.e)(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),Object(y.e)(this,"selectedFeatureWidget.viewModel.title",(e=>this._setTitleFromFeatureWidget(e))),Object(y.e)(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(()=>this._setContentFromFeatureWidget())),Object(y.g)(this,"collapsed",(()=>{var e,t;"xsmall"===(null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),Object(y.b)(this,"viewModel.allActions","change",(()=>this._watchActions())),Object(y.a)(this,"viewModel.allActions",(()=>this._watchActions())),Object(y.e)(this,"viewModel.featureViewModels",(()=>this._featureMenuViewportScrollTop()))])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),null==(e=this._handles)||e.destroy(),this._unobserveFeatureMenuObserver(),null==(t=this._featureMenuIntersectionObserver)||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,r,i,n;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||(null==(r=this.selectedFeatureWidget)||null==(i=r.viewModel)?void 0:i.content):null==(n=this.viewModel)?void 0:n.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||la}set dockOptions(e){const t={...la},r=this.get("viewModel.view.breakpoints"),i={};r&&(i.width=r.xsmall,i.height=r.xsmall);const n={...t,...e},s={...t.breakpoint,...i},{breakpoint:a}=n;!0===a?n.breakpoint=s:"object"==typeof a&&(n.breakpoint={...s,...a}),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:r}=this,{selectedFeatureViewModel:i}=this.viewModel,n={...t,title:!1};return i?(e?(e.viewModel=i,e.visibleElements=n):this._feature=new ki({headingLevel:r+1,viewModel:i,visibleElements:n}),this._feature):null}castVisibleElements(e){return{...ha,...e}}blur(){const{active:e}=this.viewModel;e||da.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||da.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,r;this._handles.remove(Ln);const i=!!e&&!!e.featureMenuOpen,n=!!e&&!!e.actionsMenuOpen,s={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:n,featureMenuOpen:i};"xsmall"===(null==(t=this.viewModel)||null==(r=t.view)?void 0:r.widthBreakpoint)&&(s.collapsed=!0),this.set(s),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,r,i;const{actionsMenuOpen:n,dockEnabled:s,featureMenuVisible:a,dividedActions:o,currentAlignment:l,currentDockPosition:c}=this,{active:u}=this.viewModel,{menuActions:d}=o,h=u&&d.length>1&&n,p=u&&s,f=u&&!s,b=null==(e=this.selectedFeature)||null==(t=e.layer)?void 0:t.title,m=null==(r=this.selectedFeature)||null==(i=r.layer)?void 0:i.id,g={[ds]:"top-center"===l,[hs]:"bottom-center"===l,[ps]:"top-left"===l,[fs]:"bottom-left"===l,[bs]:"top-right"===l,[ms]:"bottom-right"===l,[ns]:p,[is]:f,[ss]:"top-left"===c,[as]:"top-center"===c,[os]:"top-right"===c,[ls]:"bottom-left"===c,[cs]:"bottom-center"===c,[us]:"bottom-right"===c,[gs]:a,[ys]:h};return Object(He.a)("div",{class:this.classes(Jn,g),role:"presentation","data-layer-title":b,"data-layer-id":m,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},u?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return Object(He.a)("span",{"aria-hidden":"true",class:this.classes(Is,$n,Xn)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?Object(He.a)("div",{key:ca("loading-container"),role:"presentation",class:es,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Object(Ge.h)(),t={[Vn]:e,[Zs]:e,[zn]:!e,[Qs]:!e};return Object(He.a)("span",{"aria-hidden":"true",class:this.classes(Is,t)})}renderPreviousButton(){const{messages:e}=this;return Object(He.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(As,Ws),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Object(Ge.h)(),t={[zn]:e,[Js]:e,[Vn]:!e,[Xs]:!e};return Object(He.a)("span",{"aria-hidden":"true",class:this.classes(Is,t)})}renderNextButton(){const{messages:e}=this;return Object(He.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(As,$s),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:r}=this,{featureCount:i,selectedFeatureIndex:n}=this.viewModel;return Object(He.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(As,na),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":r.menu,title:r.menu},this._getPageText(i,n))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),r={[Hn]:e,[Ds]:!e,[Gn]:!e&&("top-right"===t||"bottom-right"===t),[Bn]:!e&&("top-left"===t||"bottom-left"===t),[Nn]:!e&&"top-center"===t,[Un]:!e&&"bottom-center"===t};return Object(He.a)("span",{"aria-hidden":"true",class:this.classes(r,Is)})}renderDockButton(){var e,t,r;const{dockEnabled:i,messages:n}=this,s=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,a=i?n.undock:n.dock;return"xsmall"!==s&&null!=(r=this.dockOptions)&&r.buttonEnabled?Object(He.a)("div",{role:"button","aria-label":a,title:a,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(As,Rs)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:r,contentCollapsed:i,messagesCommon:n}=this,s={[ws]:r},a=Object(He.a)(qt,{level:this.headingLevel,class:xs,innerHTML:e}),o=r?Object(He.a)("button",{key:`${e}--collapsible`,id:t,title:i?n.expand:n.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(_s,s),"aria-expanded":i?"false":"true",onclick:this._toggleCollapsed},a):Object(He.a)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(_s,s)},a);return e?o:null}renderCloseIcon(){return Object(He.a)("span",{"aria-hidden":"true",class:this.classes(Is,qn)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?Object(He.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:As,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return Object(He.a)("header",{class:Os},this.renderTitle(),Object(He.a)("div",{class:js},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:r}=this,{content:i}=this.viewModel;return t&&!r?Object(He.a)("article",{key:i,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:Ss},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i,messagesCommon:n}=this,s=r?n.close:n.open,{menuActions:a}=i;return a.length?Object(He.a)("div",{key:ca("actions-menu-button"),class:this.classes(As,Ls),role:"button",id:t,"aria-haspopup":"true","aria-controls":r?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":s,title:s},Object(He.a)("span",{"aria-hidden":"true",class:Zn})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i}=this,{menuActions:n,inlineActions:s}=i;return n.length&&r?Object(He.a)("ul",{id:e,role:"menu","aria-labelledby":t,key:ca("actions"),class:ks,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},n.toArray().map(((e,t)=>this.renderAction({action:e,index:t+s.length,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(((e,t)=>this.renderAction({action:e,index:t,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,r=!!e.length,i=!!t.length;return r||i?Object(He.a)("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":i.toString(),class:Fs},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?Object(He.a)("section",{key:ca("navigation"),class:this.classes(Hs)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:r,menuActions:i}=t,n=!!r.length,s=!!i.length,a={[Cs]:e,[Ms]:n,[Ps]:s};return e||n?Object(He.a)("div",{key:ca("feature-buttons"),class:this.classes(Ts,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:r}=this.viewModel,i=Object(wi.a)(e.selectedFeatures,{total:t.length});return Object(He.a)("section",{key:ca("menu"),class:Ys},Object(He.a)("strong",{class:ra},i),Object(He.a)("nav",{bind:this,class:ta,"data-node-ref":"_featureMenuViewportNode",afterCreate:Ge.j},this.renderFeatureMenu(),Object(He.a)("div",{class:aa,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?Object(He.a)("div",{class:oa},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:Object(He.a)("div",{key:ca("pointer"),class:Gs,role:"presentation"},Object(He.a)("div",{class:this.classes(qs,is)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:r,titleId:i,contentId:n,collapsible:s,hasContent:a,contentCollapsed:o,visibleElements:l}=this,{title:c}=this.viewModel,u="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===r||"top-center"===r||"top-right"===r,d="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===r||"bottom-center"===r||"bottom-right"===r,h={[is]:e,[ts]:s,[rs]:o};return Object(He.a)("div",{class:this.classes(Kn,Yn,h),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?i:"","aria-describedby":a&&!o?n:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),d?this.renderFooter():null,d?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?Object(He.a)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return Object(He.a)("span",{key:"text",class:Ns},e)}renderActionIcon(e){const t=this._getActionClass(e),r=this._getActionImage(e),i={[$n]:e.active,[Xn]:e.active,[Is]:!!t,[Vs]:!e.active&&!!r};return t&&(i[t]=!e.active),Object(He.a)("span",{key:"icon","aria-hidden":"true",class:this.classes(Is,i),styles:this._getIconStyles(r)})}renderAction(e){const{action:t,index:r,type:i}=e,n=this._getActionTitle(t),s={[zs]:"toggle"!==t.type,[Us]:"toggle"===t.type,[Bs]:"toggle"===t.type&&t.value,[Es]:t.disabled},a=[this.renderActionIcon(t),this.renderActionText(n)],o="menu-item"===i?Object(He.a)("li",{key:t.uid,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes(As,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":r,onclick:this._triggerAction,onkeydown:this._triggerAction},a):Object(He.a)("div",{key:t.uid,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes(As,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":r,onclick:this._triggerAction,onkeydown:this._triggerAction},a);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:r,messagesCommon:i}=this,{selectedFeatureIndex:n,selectedFeatureViewModel:s}=this.viewModel,a=e===s,o={[ia]:a},l=a?Object(He.a)("span",{key:ca(`feature-menu-selected-feature-${n}`),title:r.selectedFeature,"aria-label":r.selectedFeature,class:Wn}):null,c=Object(He.a)("span",{innerHTML:e.title||i.untitled});return Object(He.a)("li",{role:"menuitem",tabIndex:-1,key:ca(`feature-menu-feature-${n}`),class:this.classes(o,ea),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},Object(He.a)("span",{class:sa},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?Object(He.a)("ol",{class:Ks,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter((e=>!!e.graphic)).map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:t,selectedFeature:r,messagesCommon:i}=this,{id:n}=e,s=null==r?void 0:r.attributes,a="zoom-to-feature"===n?Object(wi.a)(e.title,{messages:t}):"remove-selected-feature"===n?Object(wi.a)(e.title,{messages:i}):"zoom-to-clustered-features"===n||"browse-clustered-features"===n?Object(wi.a)(e.title,{messages:t}):e.title;return a&&s?Object(wi.a)(a,s):a}_getActionClass(e){const{selectedFeature:t}=this,r=null==t?void 0:t.attributes,{className:i,image:n}=e,s=n||i?i:Qn;return s&&r?Object(wi.a)(s,r):s}_getActionImage(e){const{selectedFeature:t}=this,r=null==t?void 0:t.attributes,{image:i}=e;return i&&r?Object(wi.a)(i,r):i}_createFeatureUpdatedAnimation(){return Object(Ge.b)("enter",vs)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const r=Math.round(e);return Math.max(t?r-1:r,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add(Object(y.e)(e,["active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=this._getInlineActionCount(),r=null===t,i=0===t;return{inlineActions:r?e.slice(0):i?new l.a:e.slice(0,t),menuActions:r?new l.a:i?e.slice(0):e.slice(t)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(e){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.title=e||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){"Escape"===Object(d.a)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===Object(d.a)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=Object(d.a)(e),{_featureMenuNode:r}=this,i=e.currentTarget["data-feature-index"];if(!r)return;const n=r.querySelectorAll("li"),s=n.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(i+1+s)%s].focus()):(e.stopPropagation(),n[(i-1+s)%s].focus())}_handleActionMenuItemKeyup(e){const t=Object(d.a)(e),{_actionsMenuNode:r}=this,i=e.currentTarget["data-action-index"];if(!r)return;const n=r.querySelectorAll("li"),s=n.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(i+1+s)%s].focus()):(e.stopPropagation(),n[(i-1+s)%s].focus())}_handleMainKeyup(e){const t=Object(d.a)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:r}=this.viewModel;r?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}_addSelectedFeatureIndexHandle(){const e=Object(y.e)(this,"viewModel.selectedFeatureIndex",((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,Ln)}_selectedFeatureIndexUpdated(e,t){const{featureCount:r}=this;r&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:r,screenLocation:i,side:n,view:s}=e;if(isNaN(r)||isNaN(t)||!s||!i)return!1;const a=s.padding;return"right"===n&&i.x+r/2>s.width-a.right||"left"===n&&i.x-r/2<a.left||"top"===n&&i.y-t<a.top||"bottom"===n&&i.y+t>s.height-a.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:r,_mainContainerNode:i,viewModel:n}=this,{screenLocation:s,view:a}=n;if(Object(b.i)(s)||!a||!r)return"top-center";if(!this._isScreenLocationWithinView(s,a))return this._get("currentAlignment")||"top-center";function o(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const l=i?window.getComputedStyle(i,null):null,c=l?o(l.getPropertyValue("max-height")):0,u=l?o(l.getPropertyValue("height")):0,{height:d,width:h}=r.getBoundingClientRect(),p=h+t,f=Math.max(d,c,u)+t,m=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:s,side:"right",view:a}),g=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:s,side:"left",view:a}),y=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:s,side:"top",view:a}),v=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:s,side:"bottom",view:a});return g?y?"bottom-right":"top-right":m?y?"bottom-left":"top-left":y?v?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return Object(Ge.h)()&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const r=null==(t=this.viewModel)?void 0:t.view,i=Object(Ge.h)()?"top-left":"top-right";if(!r)return i;const n=r.padding||{left:0,right:0,top:0,bottom:0},s=r.width-n.left-n.right,{breakpoints:a}=r;return a&&s<=a.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:r}=e.getBoundingClientRect(),i=this._calculatePositionStyle(t,r);i&&(e.style.top=i.top,e.style.left=i.left,e.style.bottom=i.bottom,e.style.right=i.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:r}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+r:e}_calculateAlignmentPosition(e,t,r,i){const{currentAlignment:n,_pointerOffsetInPx:s}=this,a=i/2,o=r.height-t,l=r.width-e,{padding:c}=this.view;return"bottom-center"===n?{top:t+s-c.top,left:e-a-c.left}:"top-left"===n?{bottom:o+s-c.bottom,right:l+s-c.right}:"bottom-left"===n?{top:t+s-c.top,right:l+s-c.right}:"top-right"===n?{bottom:o+s-c.bottom,left:e+s-c.left}:"bottom-right"===n?{top:t+s-c.top,left:e+s-c.left}:"top-center"===n?{bottom:o+s-c.bottom,left:e-a-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:r,view:i}=this;if(!i)return;if(r)return{left:"",top:"",right:"",bottom:""};if(Object(b.i)(e)||!t)return;const n=this._calculateFullWidth(t),s=this._calculateAlignmentPosition(e.x,e.y,i,n);return s?{top:void 0!==s.top?`${s.top}px`:"auto",left:void 0!==s.left?`${s.left}px`:"auto",bottom:void 0!==s.bottom?`${s.bottom}px`:"auto",right:void 0!==s.right?`${s.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,r){const[i,n]=e,[s,a]=t,{width:o,height:l}=r;return i<=o&&s>o||i>o&&s<=o||n<=l&&a>l||n>l&&a<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},i=r.left+r.right,n=r.top+r.bottom,s=[],a=[];s[0]=e[0]-i,s[1]=e[1]-n,a[0]=t[0]-i,a[1]=t[1]-n;const{dockOptions:o}=this,l=o.breakpoint;this._dockingThresholdCrossed(s,a,l)&&this._setDockEnabledForViewSize(o),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const r=t.active&&!e;t.screenLocationEnabled=r}_shouldDockAtCurrentViewSize(e){var t,r;const i=e.breakpoint,n=null==(t=this.viewModel)||null==(r=t.view)?void 0:r.ui;if(!n)return!1;const{width:s,height:a}=n;if(isNaN(s)||isNaN(a))return!1;const o=i.hasOwnProperty("width")&&s<=i.width,l=i.hasOwnProperty("height")&&a<=i.height;return o||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Object(wi.a)(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,kn),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new $i({view:e}),e.ui.add(this._spinner,{key:kn,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget["data-action-index"],r=this.viewModel.allActions.getItemAt(t);r&&"toggle"===r.type&&(r.value=!r.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"actionsMenuId",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"actionsMenuButtonId",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"featureMenuId",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"titleId",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"contentId",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"hasContent",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"featureNavigationVisible",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"collapsible",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"featureMenuVisible",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"contentCollapsed",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"dividedActions",null),Object(i.a)([Object(W.a)("viewModel.actions")],pa.prototype,"actions",void 0),Object(i.a)([Object(j.b)()],pa.prototype,"actionsMenuOpen",null),Object(i.a)([Object(j.b)()],pa.prototype,"alignment",void 0),Object(i.a)([Object(W.a)("viewModel.autoCloseEnabled")],pa.prototype,"autoCloseEnabled",void 0),Object(i.a)([Object(W.a)("viewModel.autoOpenEnabled")],pa.prototype,"autoOpenEnabled",void 0),Object(i.a)([Object(W.a)("viewModel.defaultPopupTemplateEnabled")],pa.prototype,"defaultPopupTemplateEnabled",void 0),Object(i.a)([Object(W.a)("viewModel.content")],pa.prototype,"content",void 0),Object(i.a)([Object(j.b)()],pa.prototype,"collapsed",void 0),Object(i.a)([Object(j.b)()],pa.prototype,"collapseEnabled",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"currentAlignment",null),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"currentDockPosition",null),Object(i.a)([Object(j.b)()],pa.prototype,"dockOptions",null),Object(i.a)([Object(j.b)()],pa.prototype,"dockEnabled",void 0),Object(i.a)([Object(W.a)("viewModel.featureCount")],pa.prototype,"featureCount",void 0),Object(i.a)([Object(j.b)()],pa.prototype,"featureMenuOpen",void 0),Object(i.a)([Object(W.a)("viewModel.features")],pa.prototype,"features",void 0),Object(i.a)([Object(W.a)("viewModel.goToOverride")],pa.prototype,"goToOverride",void 0),Object(i.a)([Object(j.b)()],pa.prototype,"headingLevel",void 0),Object(i.a)([Object(W.a)("viewModel.highlightEnabled")],pa.prototype,"highlightEnabled",void 0),Object(i.a)([Object(W.a)("viewModel.location")],pa.prototype,"location",void 0),Object(i.a)([Object(j.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],pa.prototype,"label",void 0),Object(i.a)([Object(j.b)()],pa.prototype,"maxInlineActions",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/Popup/t9n/Popup")],pa.prototype,"messages",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/t9n/common")],pa.prototype,"messagesCommon",void 0),Object(i.a)([Object(W.a)("viewModel.promises")],pa.prototype,"promises",void 0),Object(i.a)([Object(W.a)("viewModel.selectedFeature")],pa.prototype,"selectedFeature",void 0),Object(i.a)([Object(W.a)("viewModel.selectedFeatureIndex")],pa.prototype,"selectedFeatureIndex",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],pa.prototype,"selectedFeatureWidget",null),Object(i.a)([Object(j.b)()],pa.prototype,"spinnerEnabled",void 0),Object(i.a)([Object(W.a)("viewModel.title")],pa.prototype,"title",void 0),Object(i.a)([Object(W.a)("viewModel.updateLocationEnabled")],pa.prototype,"updateLocationEnabled",void 0),Object(i.a)([Object(W.a)("viewModel.view")],pa.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:In}),Object(Fn.a)(["triggerAction","trigger-action"])],pa.prototype,"viewModel",void 0),Object(i.a)([Object(W.a)("viewModel.visible")],pa.prototype,"visible",void 0),Object(i.a)([Object(j.b)()],pa.prototype,"visibleElements",void 0),Object(i.a)([Object(_.a)("visibleElements")],pa.prototype,"castVisibleElements",null),Object(i.a)([Object(Dn.a)()],pa.prototype,"_close",null),Object(i.a)([Object(Dn.a)()],pa.prototype,"_toggleDockEnabled",null),Object(i.a)([Object(Dn.a)()],pa.prototype,"_toggleFeatureMenu",null),Object(i.a)([Object(Dn.a)()],pa.prototype,"_toggleActionsMenu",null),Object(i.a)([Object(Dn.a)()],pa.prototype,"_triggerAction",null),Object(i.a)([Object(Dn.a)()],pa.prototype,"_selectFeature",null),Object(i.a)([Object(Dn.a)()],pa.prototype,"_next",null),Object(i.a)([Object(Dn.a)()],pa.prototype,"_previous",null),pa=Object(i.a)([Object(w.a)(ua)],pa);var fa=pa;const ba=[0,0];function ma(e){e&&(Object(c.b)(e),e.parentNode&&e.parentNode.removeChild(e))}const ga=750,ya=e=>{let t=class extends e{constructor(...e){super(...e),this._freqInfo={freq:16,time:ga},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",(e=>{const t=this.surface;t&&t.setAttribute("data-cursor",e)})),this.watch("interacting",(e=>{const t=this.surface;t&&t.setAttribute("data-interacting",e.toString())}))])}initialize(){this.handles.add(this.watch("ui",((e,t)=>this._handleUIChange(e,t)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(e){const t=this._get("container");if(t===e)return;const r="dom-size";if(this.handles.remove(r),this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),ma(this.root),this._set("root",null),Object(c.d)(this.userContent,t),ma(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");const t=document.createElement("div");t.className="esri-view-user-storage",Object(c.d)(e,t),e.appendChild(t),this._set("userContent",t);const i=document.createElement("div");i.className="esri-view-root",e.insertBefore(i,e.firstChild),this._set("root",i);const n=document.createElement("div");n.className="esri-view-surface",n.setAttribute("role","application"),n.tabIndex=0,i.appendChild(n),this._set("surface",n);const s=new q;i.appendChild(s.surface),this._set("overlay",s),s.watch("needsRender",(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Object(g.a)({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add(Object(y.a)(this,"size",(e=>{const[t,r]=e,i="esri-view-surface--inset-outline";t>=document.body.clientWidth||r>=document.body.clientHeight?n.classList.add(i):n.classList.remove(i)})),r),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get popup(){return this._get("popup")||new fa({view:this})}set popup(e){const t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(e,t,r){const i=this.position;return e-=i[0],t-=i[1],r?(r[0]=e,r[1]=t):r=[e,t],r}containerToPage(e,t,r){const i=this.position;return e+=i[0],t+=i[1],r?(r[0]=e,r[1]=t):r=[e,t],r}_handleUIChange(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}_wireUI(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([Object(y.a)(this,"root",(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null})),Object(y.a)(this,"popup",((t,r)=>{const i="popup";r&&e.remove(r,i),t&&(t.view=e.view,e.add(t,{key:i,position:"manual"}))}))],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=16,e.time=ga,this.handles.add([(()=>{const t=()=>{e.freq=16,e.time=ga};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),Object(g.a)({prepare:e=>{const t=this._measure(),r=this._freqInfo;if(r.time+=e.deltaTime,t&&(r.freq=16,this._get("resizing")||this._set("resizing",!0)),r.time<r.freq)return;r.time=0;const i=this._position();r.freq=i||t?16:Math.min(ga,2*r.freq),!t&&r.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,r=e?e.clientHeight:0;if(0===t||0===r)return this.suspended||this._set("suspended",!0),!1;const i=this.width,n=this.height;return t===i&&r===n?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",r),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:i,oldHeight:n,width:t,height:r}),!0)}_position(){const e=this.container,t=this.position,r=function(e){const t=(e.ownerDocument||window.document).defaultView,r=e.getBoundingClientRect();return ba[0]=r.left+t.pageXOffset,ba[1]=r.top+t.pageYOffset,ba}(e);return(!t||r[0]!==t[0]||r[1]!==t[1])&&(this._set("position",[r[0],r[1]]),!0)}forceDOMReadyCycle(){}};return Object(i.a)([Object(j.b)({value:null,cast:e=>Object(c.a)(e)})],t.prototype,"container",null),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"focused",null),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"height",void 0),Object(i.a)([Object(j.b)({type:fa})],t.prototype,"popup",null),Object(i.a)([Object(j.b)({type:q})],t.prototype,"overlay",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"position",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"resizing",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"root",void 0),Object(i.a)([Object(j.b)({value:null,readOnly:!0})],t.prototype,"size",null),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"surface",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"suspended",void 0),Object(i.a)([Object(j.b)()],t.prototype,"ui",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"userContent",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"width",void 0),Object(i.a)([Object(j.b)()],t.prototype,"widthBreakpoint",void 0),t=Object(i.a)([Object(w.a)("esri.views.DOMContainer")],t),t};var va=r(156),Oa=r(639),ja=r(148),_a=r(76);const wa=f.a.getLogger("esri.views.support.GroundViewElevationSampler");let xa=class extends zi.a.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=_a.c}initialize(){this.view.basemapTerrain.on("elevation-change",(()=>this.emit("changed",{})))}get extent(){const e=this.view.basemapTerrain;return e.extent&&e.spatialReference?Object(P.z)(e.extent,e.spatialReference):null}elevationAt(e){const t=e.spatialReference,r=this.spatialReference;if(!Object(R.a)(t,r)){const e=t?t.wkid:"unknown";return wa.error(`Cannot sample elevation at a location with spatial reference (${e}) different from the view (${r.wkid})`),null}if(!Object(va.e)(this.extent,e)){const t=this.extent,r=`${t.xmin}, ${t.ymin}, ${t.xmax}, ${t.ymax}`;wa.warn("#elevationAt()",`Point used to sample elevation (${e.x}, ${e.y}) is outside of the sampler extent (${r})`)}return Object(ja.b)(this.view.elevationProvider,e)}queryElevation(e){return Object(Oa.b)(e.clone(),this)}};Object(i.a)([Object(j.b)({readOnly:!0})],xa.prototype,"demResolution",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],xa.prototype,"extent",null),Object(i.a)([Object(j.b)({readOnly:!0})],xa.prototype,"noDataValue",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],xa.prototype,"spatialReference",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],xa.prototype,"view",void 0),xa=Object(i.a)([Object(w.a)("esri.views.support.GroundViewElevationSampler")],xa);var Sa=xa;let Ta=class extends N.a{constructor(e){super(e),this.handles=new F.a,this.view=null,this.layerViews=new l.a}initialize(){this.handles.add(Object(y.f)(this,"view.map.ground",(e=>e.load()))),this.handles.add(this.layerViews.on("after-changes",(()=>this.layerViewsAfterChangesHandler())))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Sa({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some((e=>e.updating))}get suspended(){return!this.view||this.view.suspended}layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map((e=>e.watch("updating",(()=>this.updateUpdating()),!0))).toArray(),"updating"),this.updateUpdating()}updateUpdating(){this.notifyChange("updating")}};Object(i.a)([Object(j.b)({readOnly:!0})],Ta.prototype,"elevationSampler",null),Object(i.a)([Object(j.b)({type:Boolean,readOnly:!0})],Ta.prototype,"updating",null),Object(i.a)([Object(j.b)({constructOnly:!0})],Ta.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:l.a,readOnly:!0})],Ta.prototype,"layerViews",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ta.prototype,"suspended",null),Ta=Object(i.a)([Object(w.a)("esri.views.GroundView")],Ta);var Ca=Ta,Ma=r(87);const Pa=e=>{let t=class extends e{async fetchPopupFeatures(e,t){await this.when();const{location:r,queryArea:i,layerViewsAndGraphics:n,clientOnlyGraphics:s}=await this._prepareFetchPopupFeatures(e,t),a=Promise.resolve(s),o=this._queryLayerPopupFeatures({queryArea:i,layerViewsAndGraphics:n,options:t}),l=o.map((e=>e.promise));return{location:r,clientOnlyGraphics:s,allGraphicsPromise:Object(m.l)([a,...l]).then(Ma.f),promisesPerLayerView:o}}_queryLayerPopupFeatures({queryArea:e,layerViewsAndGraphics:t,options:r}){return t.map((({layerView:t,graphics:i})=>{const n={clientGraphics:i,event:Object(b.j)(r)?r.event:null,signal:Object(b.j)(r)?r.signal:null,defaultPopupTemplateEnabled:!!Object(b.j)(r)&&!!r.defaultPopupTemplateEnabled},s=t.fetchPopupFeatures(e,n);return{layerView:t,promise:s}}))}_isValidPopupGraphic(e,t){return e&&!!e.getEffectivePopupTemplate(Object(b.j)(t)&&t.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(e,t){const{clientGraphics:r,queryArea:i,location:n}=await this._popupHitTestGraphics(e,t),s=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:a,clientOnlyGraphics:o}=this._graphicsPerFetchPopupLayerView(r,s);return{clientOnlyGraphics:o,layerViewsAndGraphics:a,queryArea:i,location:n}}async _popupHitTestGraphics(e,t){const{results:r,mapPoint:i}=await this.popupHitTest(e),n=r.filter((e=>this._isValidPopupGraphic(e.graphic,t))),s=n.length?n[0].mapPoint:null;return{clientGraphics:n.map((e=>e.graphic)),queryArea:i,location:i||s}}_getFetchPopupLayerViews(){const e=[];return this.allLayerViews.forEach((t=>{this._isValidPopupLayerView(t)&&e.push(t)})),Object(b.j)(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&e.push(this.graphicsView),e.reverse()}_isValidPopupLayerView(e){return Object(b.j)(e)&&(!("layer"in e)||!e.suspended)&&"fetchPopupFeatures"in e}_graphicsPerFetchPopupLayerView(e,t){const r=[],i=new Map,n=t.map((e=>{const t=[];return"layer"in e?i.set(e.layer,t):i.set(e.graphics,t),{layerView:e,graphics:t}}));for(const s of e){const e=i.get(s.layer)||i.get(s.sourceLayer)||null;e?e.push(s):r.push(s)}return{layerViewsAndGraphics:n,clientOnlyGraphics:r}}};return t=Object(i.a)([Object(w.a)("esri.views.PopupView")],t),t};var Aa=r(531),Ea=r(221),Ra=r(268),Ia=r(159),Da=r(206),Fa=r(50),La=r(39),ka=r(43),za=r(558);let Va=class extends N.a{constructor(e){super(e),this.view=null,this.baseLayerViews=new l.a,this.referenceLayerViews=new l.a,this._loadingHandle=Object(y.a)(this,"view.map.basemap",(e=>{e&&e.load().catch((()=>{}))}))}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){return(!this.view||!this.view.suspended)&&!(!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}};Object(i.a)([Object(j.b)({constructOnly:!0})],Va.prototype,"view",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Va.prototype,"baseLayerViews",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Va.prototype,"referenceLayerViews",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Va.prototype,"suspended",null),Object(i.a)([Object(j.b)({type:Boolean,readOnly:!0})],Va.prototype,"updating",null),Va=Object(i.a)([Object(w.a)("esri.views.BasemapView")],Va);var Na=r(108);const Ua=f.a.getLogger("esri.views.LayerViewManager");class Ba{constructor(e,t,r){this.layer=e,this.view=t,this.layerViewImporter=r,this._controller=Object(m.e)(),this._deferred=Object(m.g)(),this._started=!1,this.done=!1,Object(m.s)(this._controller.signal,(()=>{const t=new u.a("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:r}=this;t.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:r}=this;this._map=r.map;try{var i,n;let a,o;if(await t.load({signal:e}),"prefetchResources"in t&&await t.prefetchResources({signal:e}),t.createLayerView)a=await t.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new u.a("layer:view-not-supported","No layerview implementation was found");const i=await this.layerViewImporter.importLayerView(t);Object(m.x)(e),a="default"in i?new i.default({layer:t,view:r}):new i({layer:t,view:r})}const l=()=>{o=Object(b.r)(o),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};o=Object(m.s)(e,l),Object(m.x)(e);try{await a.when()}catch(s){throw l(),s}if(!(null==(i=this._map)||null==(n=i.allLayers)?void 0:n.includes(t)))return l(),void this._deferred.reject(new u.a("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=a,t.emit("layerview-create",{view:r,layerView:a}),r.emit("layerview-create",{layer:t,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(s){t.emit("layerview-create-error",{view:r,error:s}),r.emit("layerview-create-error",{layer:t,error:s}),this.done=!0,this._deferred.reject(new u.a("layerview:create-error","layerview creation failed",{layer:t,error:s}))}}}let Ga=class extends Z.a{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new B.a,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var e;const t=null==(e=this.view.map)?void 0:e.allLayers;if(t)for(const r of t)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(Object(b.i)(this._workPromise)&&(this._workPromise=Object(m.g)()),this.handles.remove("reschedule"),this.handles.add(Object(g.b)(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var e,t,r;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),Object(b.i)(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const n=new Ra.a({getCollections:()=>this._rootCollectionNames.map((e=>this.get(e))),getChildrenFunction:e=>e&&"layers"in e?e.layers:null});if(!n)return this._workPromise.resolve(),void(this._workPromise=null);for(const o of n)this._createLayerView(o);this._refreshCollections();for(const[o,l]of this._layerLayerViewInfoMap)n.includes(o)||(this._layerLayerViewInfoMap.delete(l.layer),l.destroy());const s=n.filter((e=>"group"===e.type)).map((e=>e.layers)),a=[null==i||null==(e=i.ground)?void 0:e.layers,null==i||null==(t=i.basemap)?void 0:t.baseLayers,null==i||null==(r=i.basemap)?void 0:r.referenceLayers,null==i?void 0:i.layers,...s].filter((e=>!!e));this.handles.add(a.map((e=>this._watchUpdatingTracking.addOnCollectionChange(e,this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([Object(y.b)(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),Object(y.a)(this.view,["map.basemap","map.ground","map.layers","ready"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return Object(b.j)(this._workPromise)||this._watchUpdatingTracking.updating||Object(Na.b)(this._layerLayerViewInfoMap,(e=>!e.done))}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new u.a("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,r){if(!e||!t)return void(t&&t.removeAll());let i=0;for(const n of e){const e=this._layerLayerViewInfoMap.get(n);if(!e||!e.layerView)continue;const s=e.layerView;s.layer=n,s.parent=r,t.getItemAt(i)!==s&&t.splice(i,0,s),n.layers&&this._populateLayerViewsOwners(n.layers,s.layerViews,s),i+=1}i<t.length&&t.splice(i,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new Ba(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{var r,i;t&&(Object(m.n)(t)||"cancelled:layerview-create"===t.name)||Ua.error(`Failed to create layerview for layer title:'${null!=(r=e.title)?r:"no title"}', id:'${null!=(i=e.id)?i:"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};Object(i.a)([Object(j.b)()],Ga.prototype,"_workPromise",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ga.prototype,"_watchUpdatingTracking",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ga.prototype,"_layersToLayerViews",null),Object(i.a)([Object(j.b)({readOnly:!0})],Ga.prototype,"_rootCollectionNames",null),Object(i.a)([Object(j.b)()],Ga.prototype,"layerViewImporter",void 0),Object(i.a)([Object(j.b)()],Ga.prototype,"supportsGround",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ga.prototype,"updating",null),Object(i.a)([Object(j.b)({readOnly:!0})],Ga.prototype,"updatingRemaining",null),Object(i.a)([Object(j.b)({constructOnly:!0})],Ga.prototype,"view",void 0),Ga=Object(i.a)([Object(w.a)("esri.views.LayerViewManager")],Ga);var qa=Ga;let Ha=class extends N.a{constructor(e){super(e),this.factor=1.5,this.offset=Object(O.e)(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};Object(i.a)([Object(j.b)({type:Number})],Ha.prototype,"factor",void 0),Object(i.a)([Object(j.b)({nonNullable:!0})],Ha.prototype,"offset",void 0),Object(i.a)([Object(j.b)()],Ha.prototype,"position",void 0),Object(i.a)([Object(j.b)({type:Number,range:{min:0}})],Ha.prototype,"size",void 0),Object(i.a)([Object(j.b)()],Ha.prototype,"maskUrl",void 0),Object(i.a)([Object(j.b)()],Ha.prototype,"maskEnabled",void 0),Object(i.a)([Object(j.b)()],Ha.prototype,"overlayUrl",void 0),Object(i.a)([Object(j.b)()],Ha.prototype,"overlayEnabled",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ha.prototype,"version",null),Object(i.a)([Object(j.b)({type:Boolean})],Ha.prototype,"visible",void 0),Ha=Object(i.a)([Object(w.a)("esri.views.Magnifier")],Ha);var Wa=Ha,$a=r(445);let Qa=class extends zi.a.EventedAccessor{constructor(){super(...arguments),this._handles=new F.a,this._currentTick=0}initialize(){this._handles.add([this.view.allLayerViews.on("after-changes",(()=>{this.notifyChange("tickInterval"),this._handles.remove("layerViewsUpdating"),this._handles.add(this._getLayerViewHandles(),"layerViewsUpdating")})),this.watch("tickInterval",(()=>this._restartTicking())),this.watch("view.ready",(()=>this._restartTicking()))]),this._restartTicking()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)}get tickInterval(){const e=this.view.allLayerViews.filter((e=>Object($a.b)(e)));return this._getCommonInterval(e)}_restartTicking(){this._currentTick=0,this._intervalID&&clearInterval(this._intervalID),this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval((()=>{const e=Date.now();this._currentTick+=this.tickInterval,this.view.allLayerViews.forEach((t=>{if(Object($a.b)(t)){const r=Math.round(6e4*t.refreshInterval),i=this._currentTick%r==0,n=e-t.refreshTimestamp<5400;r&&i&&!n&&(t.refresh(e),this.emit("refresh",{layerView:t,timestamp:e,trigger:"interval"}))}}))}),this.tickInterval))}_getLayerViewHandles(){const e=[],t=()=>this.notifyChange("tickInterval");return this.view.allLayerViews.forEach((r=>{Object($a.b)(r)&&r.layer&&e.push(r.watch("refreshInterval",t),r.layer.on("refresh",(()=>{const e=Date.now();r.refresh(e),this.emit("refresh",{layerView:r,timestamp:e,trigger:"layer-refresh"})})))})),e}_getCommonInterval(e){const t=(e,r)=>isNaN(e)||isNaN(r)?0:r<=0?e:t(r,e%r);return e.toArray().reduce(((e,r)=>t(Math.round(6e4*r.refreshInterval),e)),0)}};Object(i.a)([Object(j.b)()],Qa.prototype,"view",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Qa.prototype,"tickInterval",null),Qa=Object(i.a)([Object(w.a)("esri.views.RefreshManager")],Qa);var Za=Qa;const Xa=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Ja={};function Ya(e){return!!Ja[e]}Xa.forEach((e=>{Ja[e]=!0}));class Ka{constructor(e){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((({handler:e,priority:t},r)=>this.inputManager.installHandlers(r,[e],t)))}disconnect(){this.inputManager&&this.handlers.forEach(((e,t)=>this.inputManager.uninstallHandlers(t))),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(e,t,r,i){const n=Array.isArray(e)?e:e.split(",");if(!function(e){for(const t of e)if(!Ya(t))return!1;return!0}(n))return n.some(Ya)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let s,a;Array.isArray(t)?a=t:(s=t,a=[]),"function"==typeof r?s=r:i=r,i=null!=i?i:fn.DEFAULT;const o=this.createUniqueGroupName(),l=new eo(this.view,n,a,s);this.handlers.set(o,{handler:l,priority:i});for(const c of n){const e=this.handlerCounts.get(c)||0;this.handlerCounts.set(c,e+1)}return this.inputManager&&this.inputManager.installHandlers(o,[l],i),{remove:()=>this.removeHandler(o,n)}}hasHandler(e){return!!this.handlerCounts.get(e)}removeHandler(e,t){if(this.handlers.has(e)){this.handlers.delete(e);for(const e of t){const t=this.handlerCounts.get(e);void 0===t?console.error("Trying to remove handler for event that has no handlers registered: ",e):1===t?this.handlerCounts.delete(e):this.handlerCounts.set(e,t-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class eo extends on{constructor(e,t,r,i){super(!0),this.view=e;for(const n of t)switch(n){case"click":this.registerIncoming("click",r,(e=>i(this.wrapClick(e))));break;case"double-click":this.registerIncoming("double-click",r,(e=>i(this.wrapDoubleClick(e))));break;case"immediate-click":this.registerIncoming("immediate-click",r,(e=>i(this.wrapImmediateClick(e))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,(e=>i(this.wrapImmediateDoubleClick(e))));break;case"hold":this.registerIncoming("hold",r,(e=>i(this.wrapHold(e))));break;case"drag":this.registerIncoming("drag",r,(e=>{const t=this.wrapDrag(e);t&&i(t)}));break;case"key-down":this.registerIncoming("key-down",r,(e=>i(this.wrapKeyDown(e))));break;case"key-up":this.registerIncoming("key-up",r,(e=>i(this.wrapKeyUp(e))));break;case"pointer-down":this.registerIncoming("pointer-down",r,(e=>i(this.wrapPointer(e,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",r,(e=>i(this.wrapPointer(e,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",r,(e=>i(this.wrapPointer(e,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,(e=>i(this.wrapPointerDrag(e))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,(e=>i(this.wrapMouseWheel(e))));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,(e=>i(this.wrapPointer(e,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,(e=>i(this.wrapPointer(e,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",r,(e=>{i(this.wrapGamepad(e))}));break;case"focus":this.registerIncoming("focus",r,(e=>{i(this.wrapFocus(e))}));break;case"blur":this.registerIncoming("blur",r,(e=>{i(this.wrapBlur(e))}))}}wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapClick(e){const{pointerType:t,button:r,buttons:i,x:n,y:s,native:a,eventId:o}=e.data,{cancelable:l,timestamp:c}=e;return{type:"click",pointerType:t,button:r,buttons:i,x:n,y:s,native:a,timestamp:c,screenPoint:Object(O.e)(n,s),mapPoint:this.getMapPoint(n,s),eventId:o,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapDoubleClick(e){const{pointerType:t,button:r,buttons:i,x:n,y:s,native:a,eventId:o}=e.data,{cancelable:l,timestamp:c}=e;return{type:"double-click",pointerType:t,button:r,buttons:i,x:n,y:s,native:a,timestamp:c,mapPoint:this.getMapPoint(n,s),eventId:o,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateClick(e){const{pointerType:t,button:r,buttons:i,x:n,y:s,native:a,eventId:o}=e.data,l=a.pointerId,{cancelable:c,timestamp:u}=e;return{type:"immediate-click",pointerId:l,pointerType:t,button:r,buttons:i,x:n,y:s,native:a,timestamp:u,mapPoint:this.getMapPoint(n,s),eventId:o,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateDoubleClick(e){const{pointerType:t,button:r,buttons:i,x:n,y:s,native:a,eventId:o}=e.data,l=a.pointerId,{cancelable:c,timestamp:u}=e;return{type:"immediate-double-click",pointerId:l,pointerType:t,button:r,buttons:i,x:n,y:s,native:a,timestamp:u,mapPoint:this.getMapPoint(n,s),eventId:o,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapHold(e){const{pointerType:t,button:r,buttons:i,x:n,y:s,native:a}=e.data,{cancelable:o,timestamp:l}=e;return{type:"hold",pointerType:t,button:r,buttons:i,x:n,y:s,native:a,timestamp:l,mapPoint:this.getMapPoint(n,s),cancelable:o,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}getMapPoint(e,t){return this.view.toMap(Object(O.e)(e,t),{exclude:[]})}wrapDrag(e){const t=e.data,{x:r,y:i}=t.center,{action:n,pointerType:s,button:a}=t;if("start"===n&&(this.latestDragStart=t),!this.latestDragStart)return;const o=t.pointer.native,l=t.buttons,{cancelable:c,timestamp:u}=e,d={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===n&&(this.latestDragStart=void 0),{type:"drag",action:n,x:r,y:i,origin:d,pointerType:s,button:a,buttons:l,radius:t.radius,angle:Object(Bt.r)(t.angle),native:o,timestamp:u,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyDown(e){const{key:t,repeat:r,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-down",key:t,repeat:r,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyUp(e){const{key:t,native:r}=e.data,{cancelable:i,timestamp:n}=e;return{type:"key-up",key:t,native:r,timestamp:n,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointer(e,t){const{x:r,y:i,button:n,buttons:s,native:a,eventId:o}=e.data,l=a.pointerId,c=a.pointerType,{cancelable:u,timestamp:d}=e;return{type:t,x:r,y:i,pointerId:l,pointerType:c,button:n,buttons:s,native:a,timestamp:d,eventId:o,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointerDrag(e){const{x:t,y:r,buttons:i,native:n,eventId:s}=e.data.currentEvent,{button:a}=e.data.startEvent,o=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,u={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:d,timestamp:h}=e;return{type:"pointer-drag",x:t,y:r,pointerId:o,pointerType:l,button:a,buttons:i,action:c,origin:u,native:n,timestamp:h,eventId:s,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapMouseWheel(e){const{cancelable:t,data:r,timestamp:i}=e,{x:n,y:s,deltaY:a,native:o}=r;return{type:"mouse-wheel",x:n,y:s,deltaY:a,native:o,timestamp:i,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapGamepad(e){const{action:t,state:r,device:i}=e.data,{cancelable:n,timestamp:s}=e,{buttons:a,axes:o}=r;return{type:"gamepad",device:i,timestamp:s,action:t,buttons:a,axes:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}}function to(e,t){const r=e.view;r&&(t&&r.ready&&r.activeTool!==e?(r.activeTool=e,function(e){return e&&"focus"in e}(r)&&r.focus()):t||r.activeTool!==e||(r.activeTool=null))}function ro(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))}function io(e){return Object(O.e)(e.x,e.y)}function no(e,t){const r=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return Object(O.e)(t.clientX-r.left,t.clientY-r.top)}function so(e,t){return t instanceof Event?no(e,t):io(t)}function ao(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;case"key-down":case"key-up":case"gamepad":case"focus":case"blur":default:return!1}return!1}function oo(e){return"mouse"===e}function lo(e){return"mouse"!==e.pointerType||0===e.button}const co={manipulator:null,tool:null};var uo=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToActiveTool=null,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":oo(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!lo(e))break;const i=io(e),n=this._intersect(i,e.pointerType,t.forEachTool);if(Object(b.i)(n))break;const s=this._findToolAndManipulatorByKey(n,t.forEachTool,co),a=Object(b.c)(s,(e=>e.manipulator)),o=Object(b.c)(s,(e=>e.tool));!(Object(b.j)(a)&&Object(b.j)(o)&&a.interactive)||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,o,e),Object(b.j)(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:n,start:i}),1===this._grabbedManipulators.size&&(this._revertToActiveTool=t.activeTool,t.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",screenPoint:i}),r());break}case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!lo(e))break;const i=this._grabbedManipulators.get(e.pointerId),n=this._draggedManipulators.get(e.pointerId),s=Object(b.c)(i||n,(({key:e})=>e)),a=this._findManipulatorByKey(s,t.forEachTool);if(Object(b.i)(a))break;const o=io(e);o.x=Object(Bt.e)(o.x,0,t.view.width),o.y=Object(Bt.e)(o.y,0,t.view.height);const l=Object(b.s)(i||n).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(a.dragging=!0,n?a.events.emit("drag",{action:"update",start:l,screenPoint:o}):a.events.emit("drag",{action:"start",start:l,screenPoint:o,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:Object(b.s)(s),start:l}));break;case"end":a.dragging=!1,n&&a.events.emit("drag",{action:"end",start:l,screenPoint:o}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}r();break}case"immediate-click":{const i=io(e),n=this._intersect(i,e.pointerType,t.forEachTool),s=this._findToolAndManipulatorByKey(n,t.forEachTool,co);if(function(e){return!!e.native.shiftKey}(e)||t.forEachTool((e=>{if((!Object(b.j)(s)||s.tool!==e||!e.selectionManagementDisabled)&&e.manipulators){let t=!1;e.manipulators.forEach((({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),Object(b.i)(s))break;const{manipulator:a,tool:o}=s;if(!a.interactive)break;a.selectable&&!o.selectionManagementDisabled&&(a.selected=!a.selected,o.manipulatorSelectionChanged&&o.manipulatorSelectionChanged());const l=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:i,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r});break}case"click":{const i=io(e),n=this._intersect(i,e.pointerType,t.forEachTool),s=this._findManipulatorByKey(n,t.forEachTool);if(Object(b.i)(s)||!s.interactive)break;const a=e.native.shiftKey;s.events.emit(e.type,{screenPoint:i,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const i=io(e),n=this._intersect(i,e.pointerType,t.forEachTool),s=this._findManipulatorByKey(n,t.forEachTool);if(Object(b.i)(s)||!s.interactive)break;const a=e.native.shiftKey;s.events.emit("double-click",{screenPoint:i,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const i=io(e),n=this._intersect(i,e.pointerType,t.forEachTool),s=this._findManipulatorByKey(n,t.forEachTool);if(Object(b.i)(s)||!s.interactive)break;const a=e.native.shiftKey;s.events.emit("immediate-double-click",{screenPoint:i,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}}this._updateCursor(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",screenPoint:io(r)}),this._grabbedManipulators.forEach((({key:r},i)=>{r.tool===t&&t.manipulators.findById(r.manipulatorId)===e&&this._grabbedManipulators.delete(i)}))}_handlePointerEnd(e,t){const r=Object(b.c)(this._grabbedManipulators.get(e.pointerId),(({key:e})=>e)),i=this._findManipulatorByKey(r,t.forEachTool);if(Object(b.j)(i)&&!i.dragging){const n=Object(b.j)(t.creatingTool)&&t.creatingTool===Object(b.s)(r).tool;1!==this._grabbedManipulators.size||0!==this._draggedManipulators.size||n||(t.setActiveTool(this._revertToActiveTool),this._revertToActiveTool=null),i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",screenPoint:io(e)})),this._grabbedManipulators.delete(e.pointerId)}}_cursorFromMap(e,t){let r=null;return Object(Na.b)(e,(({key:e})=>{const i=this._findManipulatorByKey(e,t);return!!(Object(b.j)(i)&&i.interactive&&"cursor"in i&&i.cursor)&&(r=i.cursor,!0)})),r}_updateCursor(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}clearPointers(e,t,r=!0,i){const n=t=>t.tool===e&&(Object(b.i)(i)||t.manipulatorId===i);this._grabbedManipulators.forEach((({key:e},r)=>{if(n(e)){this._grabbedManipulators.delete(r);const i=this._findManipulatorByKey(e,t);Object(b.j)(i)&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",screenPoint:null}))}})),this._draggedManipulators.forEach((({key:e},r)=>{if(n(e)){this._draggedManipulators.delete(r);const i=this._findManipulatorByKey(e,t);Object(b.j)(i)&&(i.dragging=!1,i.events.emit("drag",{action:"cancel"}))}})),r&&this._hoveredManipulators.forEach((({key:e},r)=>{if(n(e)){this._hoveredManipulators.delete(r);const i=this._findManipulatorByKey(e,t);Object(b.j)(i)&&(i.hovering=!1)}})),this._updateCursor(t)}_intersect(e,t,r){let i=null;return r((r=>{if(null==r.manipulators||!ro(r))return!1;const n=r.manipulators.intersect(e,t);return!Object(b.i)(n)&&(i={manipulatorId:n.id,tool:r},!0)})),i}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Object(O.e)(t.x,t.y),r,t.pointerType,e)}))}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!oo(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(io(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,r,i){const n=this._intersect(e,r,i);let s=this._findManipulatorByKey(n,i);const a=Object(b.c)(this._hoveredManipulators.get(t),(({key:e})=>e)),o=this._findManipulatorByKey(a,i);Object(b.j)(s)&&!s.interactive&&(s=null),o!==s&&(Object(b.j)(o)&&(o.hovering=!1),Object(b.j)(s)?(s.hovering=!0,this._hoveredManipulators.set(t,{key:Object(b.s)(n)})):this._hoveredManipulators.delete(t),this._updateCursor(i))}_findManipulatorByKey(e,t){return this._findToolAndManipulatorByKey(e,t,co)?co.manipulator:null}_findToolAndManipulatorByKey(e,t,r){return Object(b.i)(e)?null:(r.tool=null,r.manipulator=null,t((t=>{if(t!==e.tool||null==t.manipulators||!ro(t))return!1;const i=t.manipulators.findById(e.manipulatorId);return!!Object(b.j)(i)&&(r.manipulator=i,r.tool=t,!0)})),r.manipulator?r:null)}};const ho=f.a.getLogger("esri.views.ToolViewManager"),po="manipulators",fo="tools";let bo=class extends Z.a{constructor(e){super(e),this._creatingTool=null,this._manipulatorState=new uo,this.tools=function(){const e=new l.a;return e.on("after-add",(e=>{const t=e.item;t.view&&t.view.ready&&t.attach()})),e.on("after-remove",(e=>{const t=e.item;to(t,!1),t.destroyed||t.detach()})),e}(),this.cursor=null,this._forEachTool=e=>{if(!Object(b.j)(this._creatingTool)||!e(this._creatingTool))for(const t of this.tools.items)if(e(t))return}}initialize(){this.handles.add([this.view.on(Xa,(e=>{this._handleInputEvent(e)}),fn.TOOL),this.tools.on("before-add",(e=>{const t=e.item;null==t||this.tools.includes(t)?e.preventDefault():null==t.created||t.created||(ho.error("tools","Tool can not be added to view before it has been created"),e.preventDefault())})),this.tools.on("before-remove",(({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this._forEachTool((e=>e.destroy()))}set activeTool(e){!Object(b.j)(e)||this.view.ready?(function(e,t,r){const i=e.activeTool;t!==i&&(Object(b.j)(i)&&i.deactivate&&i.deactivate(),r(t),Object(b.j)(t)&&t.activate&&t.activate())}(this,e,(t=>{this._set("activeTool",t),this._removeIncompleteTools(e),this._forEachTool((e=>{const t=Object(b.i)(this.activeTool)||e===this.activeTool;e.setEditableFlag&&e.setEditableFlag(1,t);const r=ro(e);!Object(b.i)(this.activeTool)&&r||this._manipulatorState.clearPointers(e,this._forEachTool,!r)})),this._updateCursor()})),this._creatingTool!==e&&this._rejectCreatingTool()):ho.error("#activeTool=","cannot set active tool while view is not ready")}get updating(){return this.updatingHandles.updating||this.tools.some((e=>e.updating))}async createTool(e,t,r){const i="Tool creation was interrupted by another tool being created",{abortHandle:n,tool:s}=await this.updatingHandles.addPromise((async()=>{await this.view.whenReady(),Object(m.x)(r,i);const n=Object(m.s)(r,(()=>this.activeTool=null)),s=function(e){return Object(b.i)(e)?{}:"function"==typeof e?e():e}(t),a=new e({...s,view:this.view});return await a.whenCreationStarted(),Object(m.x)(r,i),{abortHandle:n,tool:a}})());return this._rejectCreatingTool(i),this._creatingTool=s,s.attach(),this._refreshToolWatchers(),to(s,!0),await s.when(),Object(b.j)(n)&&n.remove(),this._creatingTool=null,Object(m.x)(r,i),this.tools.add(s),s instanceof N.a&&null!=s.completed&&Object(y.j)(s,"completed").then((()=>{to(s,!1)})),s}attach(){this._forEachTool((e=>e.attach())),"3d"===this.view.type?this.handles.add([this.view.state.watch("camera",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(e=>{this.forEachManipulator((t=>{null!=t.onElevationChange&&t.onElevationChange(e)}))}))],po):this.handles.add(this.view.watch("extent",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})))}detach(){this.activeTool=null,this._forEachTool((e=>{e.detach(),e.destroy()})),this.tools.removeAll(),this.handles.remove(po)}forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((({manipulator:r})=>e(r,t)))}))}_handleInputEvent(e){let t=!1;const r={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};Object(b.j)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool((e=>{!t&&!1!==e.visible&&e.handleInputEvent&&e.handleInputEvent(r)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},creatingTool:this._creatingTool,view:this.view}),!t&&Object(b.j)(this.activeTool)&&this.activeTool.handleInputEventAfter&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(fo),this._forEachTool((e=>{if(e instanceof N.a){const t=Object(y.e)(e,["cursor","visible","editable"],(()=>{ro(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()}));this.handles.add(t,fo)}e.manipulators&&this.handles.add(e.manipulators.on("change",(t=>{t.removed.forEach((({id:t})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,t)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),fo)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let e=null;this._forEachTool((t=>null!=t.cursor&&!1!==t.visible&&(e=t.cursor,!0))),e||(e=this._manipulatorState.cursor),this._get("cursor")!==e&&this._set("cursor",e)}_rejectCreatingTool(e){const t=this._creatingTool;Object(b.i)(t)||(this._manipulatorState.clearPointers(t,this._forEachTool),t.rejectCreation&&t.rejectCreation(Object(m.f)(e)),to(t,!1),"destroyed"!==t.toolState&&t.destroy(),this._creatingTool=null,this._refreshToolWatchers())}_removeIncompleteTools(e){this.tools.filter((t=>(Object(b.i)(e)||t!==e)&&null!=t.completed&&!t.completed)).forEach((e=>{this.tools.remove(e)}))}};Object(i.a)([Object(j.b)({constructOnly:!0,nonNullable:!0})],bo.prototype,"view",void 0),Object(i.a)([Object(j.b)({value:null})],bo.prototype,"activeTool",null),Object(i.a)([Object(j.b)({readOnly:!0,type:l.a})],bo.prototype,"tools",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],bo.prototype,"cursor",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],bo.prototype,"updating",null),bo=Object(i.a)([Object(w.a)("esri.views.ToolViewManager")],bo);var mo=bo;let go=class extends N.a{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===e.mapping?this._detectedDeviceType="standard":yo.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return vo[this.deviceType]}};Object(i.a)([Object(j.b)({nonNullable:!0,readOnly:!0})],go.prototype,"nativeIndex",void 0),Object(i.a)([Object(j.b)({type:String,readOnly:!0})],go.prototype,"deviceType",null),Object(i.a)([Object(j.b)({type:Number,readOnly:!0})],go.prototype,"axisThreshold",null),go=Object(i.a)([Object(w.a)("esri.views.input.gamepad.GamepadInputDevice")],go);const yo=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),vo={standard:.15,spacemouse:.025,unknown:0};var Oo=go;let jo=class extends N.a{constructor(...e){super(...e),this.devices=new l.a,this.enabledFocusMode="document"}};Object(i.a)([Object(j.b)({type:l.a.ofType(Oo),readOnly:!0})],jo.prototype,"devices",void 0),Object(i.a)([Object(j.b)({type:["document","view","none"]})],jo.prototype,"enabledFocusMode",void 0),jo=Object(i.a)([Object(w.a)("esri.views.input.gamepad.GamepadSettings")],jo);var _o=jo;let wo=class extends N.a{constructor(){super(...arguments),this.gamepad=new _o}};Object(i.a)([Object(j.b)({readOnly:!0})],wo.prototype,"gamepad",void 0),wo=Object(i.a)([Object(w.a)("esri.views.input.Input")],wo);var xo=wo;let So=class extends N.a{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};Object(i.a)([Object(j.b)({type:Boolean,nonNullable:!0})],So.prototype,"enabled",void 0),Object(i.a)([Object(j.b)({type:Oo})],So.prototype,"device",void 0),Object(i.a)([Object(j.b)({type:["pan","zoom"],nonNullable:!0})],So.prototype,"mode",void 0),Object(i.a)([Object(j.b)({type:["forward-down","forward-up"],nonNullable:!0})],So.prototype,"tiltDirection",void 0),Object(i.a)([Object(j.b)({type:Number,nonNullable:!0})],So.prototype,"velocityFactor",void 0),So=Object(i.a)([Object(w.a)("esri.views.navigation.gamepad.GamepadSettings")],So);var To=So;let Co=class extends N.a{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new To,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};Object(i.a)([Object(j.b)({type:Boolean})],Co.prototype,"browserTouchPanEnabled",void 0),Object(i.a)([Object(j.b)({type:To,nonNullable:!0})],Co.prototype,"gamepad",void 0),Object(i.a)([Object(j.b)({type:Boolean})],Co.prototype,"momentumEnabled",void 0),Object(i.a)([Object(j.b)({type:Boolean})],Co.prototype,"mouseWheelZoomEnabled",void 0),Co=Object(i.a)([Object(w.a)("esri.views.navigation.Navigation")],Co);var Mo,Po=Co,Ao=r(329);const Eo=f.a.getLogger("esri.views.support.DefaultsFromMap");let Ro=Mo=class extends N.a{constructor(){super(...arguments),this._handles=new F.a,this._waitTask=null,this._extentProjectController=null,this._spatialReferenceCandidates=null,this._extentCandidates=null,this.logDebugInformation=!1,this.isSpatialReferenceDone=!1,this.isTileInfoDone=!1,this.isHeightModelInfoSearching=!1,this.spatialReference=null,this.extent=null,this.heightModelInfo=null,this.vcsWkid=null,this.latestVcsWkid=null,this.mapCollectionPaths=Mo.DefaultMapCollectionPaths.slice(),this.tileInfo=null}initialize(){this.watch("mapCollectionPaths",(()=>{this._running&&(this.reset(),this.start())}))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null),this._cancelLoading()}get _running(){return!!(this._handles&&this._handles.size>0)}reset(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null}start(){this._handles.removeAll();const e=this._updateLayerChange.bind(this);for(const t of this.mapCollectionPaths)this._handles.add(Object(y.b)(this.view,`map.${t}`,"change",e,e,e,!0));this._handles.add(Object(y.f)(this,"isSpatialReferenceDone",(()=>this._updateTileInfo()),!0))}_ownerNameFromCollectionName(e){const t=e.lastIndexOf(".");return-1===t?"view":"view."+e.slice(0,t)}_ensureLoadedOwnersFromCollectionName(e){const t=this._ownerNameFromCollectionName(e).split(".");let r;for(let i=0;i<t.length&&(r=this.get(t.slice(0,i+1).join(".")),r);i++)if(r.load&&!r.isFulfilled())return{collectionName:e,owner:null,loading:r.load().catch((()=>{}))};return{collectionName:e,owner:r}}_cancelLoading(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)}_updateWhen(e){let t=!0,r=!1;const i=e.catch((()=>{})).then((()=>{t?r=!0:i===this._waitTask&&this._update()}));return t=!1,r||(this._waitTask=i),r}_updateLayerChange(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()}_update(){if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");const e=this._processMapCollections((e=>this._processSpatialReferenceSource(e)));if(this._debugLog(`Search ended with status '${Do(e)}'`),0!==e){let e=null,t=this._spatialReferenceCandidates;if(!t||t.length<1?(e=this.defaultSpatialReference,this._debugLog(`No spatial reference found, locking to default (${Io(e)})`)):(this.defaultSpatialReference&&t.length>1&&t.findIndex((e=>e.equals(this.defaultSpatialReference)))>-1&&(t=[this.defaultSpatialReference]),e=t[0],this._debugLog(`Locking to ${Io(e)}`)),this._set("spatialReference",e),e)if(this.extent)this._set("isSpatialReferenceDone",!0);else{const t=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections((t=>this._findExtent(t,e))),this.logDebugInformation=t,this._projectExtentCandidate().catch((()=>{})).then((()=>this._set("isSpatialReferenceDone",!0)))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");const e=this._processMapCollections((e=>this._processHeightModelInfoSource(e)),(e=>Object(Ao.b)(e)));this._debugLog(`Search ended with status ${Do(e)}`),this._set("isHeightModelInfoSearching",0===e)}this._updateTileInfo()}}_processMapCollections(e,t){this._preloadMapCollections(t);let r=2;return this._forAllMapCollectionSources((e=>{if(2!==r)return!1;const{collectionName:t}=e;return this._debugLog(`Processing collection ${t}...`),!(e.loading&&!this._updateWhen(e.loading))||(this._debugLog(`Collection ${e.collectionName} owner is loading -> wait`),r=0,!1)}),(i=>2===r&&(null==t||t(i)?!i.load||i.isFulfilled()||this._updateWhen(i.load())?!((!i.load||i.isResolved())&&e(i))||(r=1,!1):(this._debugLog(`Source ${i.id} is loading -> wait`),r=0,!1):(this._debugLog(`Source ${i.id} is skipped due to predicate`),!1)))),r}_preloadMapCollections(e){let t=10;const r=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources((()=>!0),(i=>0!==t&&(!(null!=e&&!e(i))&&(i.load&&!i.isFulfilled()&&(this.logDebugInformation=r,this._debugLog(`Pre-loading source ${i.id}`),this.logDebugInformation=!1,i.load().catch((()=>{})),t--),!0)))),this.logDebugInformation=r}_forAllMapCollectionSources(e,t){for(const r of this.mapCollectionPaths){const i=`map.${r}`,n=this._ensureLoadedOwnersFromCollectionName(i);if(!1===e(n))continue;const s=n.owner;if(!s||s.isRejected&&s.isRejected()){this._debugLog(`Collection ${i} owner is invalid or rejected -> skip`);continue}const a=this.view.get(i);a?this._forEachSource(a,t):this._debugLog(`Collection ${i} does not exist -> skip`)}}_forEachSource(e,t){for(const r of e.items)!1!==t(r)&&"layers"in r&&r.layers&&this._forEachSource(r.layers,t)}_processSpatialReferenceSource(e){let t=this._getSupportedSpatialReferences(e);return 0!==t.length&&(this._spatialReferenceCandidates?(t=Object(Ma.h)(t,this._spatialReferenceCandidates,((e,t)=>e.equals(t))),t.length>0?this._spatialReferenceCandidates=t:this._debugLog(`Layer ${e.id} is ignored because its supported spatial\n          references are not compatible with the previous candidates`)):this._spatialReferenceCandidates=t,1===this._spatialReferenceCandidates.length)}_findExtent(e,t){const r="fullExtents"in e&&e.fullExtents||(e.fullExtent?[e.fullExtent]:[]),i=r.find((e=>e.spatialReference.equals(t)));if(i)return this._set("extent",i),!0;if(this._getSupportedSpatialReferences(e).length>0){const t=r.map((t=>({extent:t,layer:e}))),i=this._extentCandidates||[];this._extentCandidates=i.concat(t)}return!1}async _projectExtentCandidate(){if(!this._extentCandidates||!this._extentCandidates.length)return;const e=this.spatialReference,t=this._extentCandidates.find((t=>Object(R.a)(t.extent.spatialReference,e)));if(t)this._set("extent",Object(R.d)(t.extent,e));else{const t=this._extentCandidates[0];this._extentProjectController=Object(m.e)();const i=await Promise.resolve().then(r.bind(null,568));try{const r=await i.projectGeometry(t.extent,e,t.layer.portalItem,this._extentProjectController.signal);this._set("extent",r)}catch{}this._extentProjectController=null}}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return this._debugLog(`Layer ${e.id} is ignored because it does not have any spatial references`),[];const r=t.filter((t=>this.view.isSpatialReferenceSupported(t,e,(e=>this._debugLog(e)))));return 0===r.length?this._debugLog(`Layer ${e.id} has spatial references but none of them are supported (or layer doesn't require locking)`):this._debugLog(`Layer ${e.id} has spatial references. Resulting candidate set: ${r.map(Io).join(", ")}`),r}_processHeightModelInfoSource(e){const t=Object(Ao.a)(e);return!!t&&(this._set("heightModelInfo",t),this._set("isHeightModelInfoSearching",!1),e.spatialReference&&(this._set("vcsWkid",e.spatialReference.vcsWkid),this._set("latestVcsWkid",e.spatialReference.latestVcsWkid)),!0)}_updateTileInfo(){if(null!=this.tileInfo)return;if(!this.view.isTileInfoRequired())return void this._set("isTileInfoDone",!0);if(!this.isSpatialReferenceDone)return;const e=this.get("view.map");if(!e)return void this._debugLog("updateTileInfo: no map");const t=e.basemap,r=e.get("layers.0");let i=null;if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: basemap still loading");const e=t&&t.get("baseLayers.0");if(e&&"failed"!==e.loadStatus){if(!e.loaded)return this._updateWhen(e.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");i="tileInfo"in e&&e.tileInfo}else{if(!r||"failed"===r.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!r.loaded)return this._updateWhen(r.load()),void this._debugLog("updateTileInfo: first operational layer still loading");i="tileInfo"in r&&r.tileInfo}}else if(r&&"failed"!==r.loadStatus){if(!r.loaded)return this._updateWhen(r.load()),void this._debugLog("updateTileInfo: first operational layer still loading");i="tileInfo"in r&&r.tileInfo}i&&!i.spatialReference.equals(this.spatialReference)&&(i=null),this._debugLog(`updateTileInfo: setting ${i}`),this._set("tileInfo",i),this._set("isTileInfoDone",!0)}_debugLog(e){this.logDebugInformation&&Eo.info(e)}};function Io(e){return e?JSON.stringify(e.toJSON()):"undefined"}function Do(e){switch(e){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}Ro.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],Object(i.a)([Object(j.b)()],Ro.prototype,"logDebugInformation",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ro.prototype,"isSpatialReferenceDone",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ro.prototype,"isTileInfoDone",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ro.prototype,"isHeightModelInfoSearching",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Ro.prototype,"view",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ro.prototype,"spatialReference",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ro.prototype,"extent",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ro.prototype,"heightModelInfo",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ro.prototype,"vcsWkid",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ro.prototype,"latestVcsWkid",void 0),Object(i.a)([Object(j.b)()],Ro.prototype,"mapCollectionPaths",void 0),Object(i.a)([Object(j.b)()],Ro.prototype,"defaultSpatialReference",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Ro.prototype,"tileInfo",void 0),Ro=Mo=Object(i.a)([Object(w.a)("esri.views.support.DefaultsFromMap")],Ro);var Fo,Lo=Ro;const ko=f.a.getLogger("esri.views.View");let zo=Fo=class extends(Object(Z.b)(zi.a.EventedMixin(Object(Da.b)(N.a)))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new Ra.a({getCollections:()=>{var e,t,r;return[null==(e=this.basemapView)?void 0:e.baseLayerViews,null==(t=this.groundView)?void 0:t.layerViews,this.layerViews,null==(r=this.basemapView)?void 0:r.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.defaultsFromMap=new Lo({view:this}),this.fatalError=null,this.extent=null,this.graphics=new za.a,this.navigating=!1,this.layerViews=new l.a,this.magnifier=new Wa,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.renderContext=null,this.input=new xo,this.navigation=new Po,this.layerViewManager=null,this.refreshManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Ka(this),this.persistableViewModels=new l.a,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",(e=>{e?(this._currentSpatialReference=this.spatialReference,Fo.views.add(this)):(this._currentSpatialReference=null,Fo.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.layerViewManager.clear(),this.toolViewManager.detach(),this._teardown()):e&&!this.ready&&(this._startup(),this.toolViewManager.attach())}),!0))}initialize(){let e;this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,Object(y.j)(this,"ready"))))),this.basemapView=new Va({view:this}),this.layerViewManager=new qa({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.refreshManager=new Za({view:this}),this.toolViewManager=new mo({view:this}),this._resetInitialViewPropertiesFromContent(),Object(y.a)(this.defaultsFromMap,"isSpatialReferenceDone",(t=>{const r=!!(this.map&&this.map.allLayers.length>0);if(t&&!this.spatialReference&&r||!e){if(t&&!this.spatialReference&&r&&!e){const t=e=Object(m.a)(this.spatialReferenceWarningDelay);e.then((()=>{t===e&&ko.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})).catch((()=>{}))}}else e=null}),!0)}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics.destroy(),this.graphics=null,this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager.destroy(),this.toolViewManager=null,this.refreshManager.destroy(),this.refreshManager=null,this.layerViewManager.destroy(),this.layerViewManager=null,this.basemapView.destroy(),this.basemapView=null,this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,null==e||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ko.error("#toMap()","Not implemented on this instance of View"),null}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!Ia.a.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}set map(e){var t;e!==this._get("map")&&(null!=(t=e)&&t.destroyed&&(ko.warn("#map","The provided map is already destroyed",{map:e}),e=null),Ia.a.isLoadable(e)&&e.load().catch((()=>{})),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){this._userSpatialReference=e,this._set("spatialReference",e)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap&&this.defaultsFromMap.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return Object(b.j)(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){return this.get("defaultsFromMap.spatialReference")}getDefaultHeightModelInfo(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null}importLayerView(e){throw new u.a("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}isSpatialReferenceSupported(e,t,r){return!0}isTileInfoRequired(){return!1}when(e,t){return this.isResolved()&&!this.ready&&ko.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),super.when(e,t)}forceReadyCycle(){this.ready&&(this._readyCycleForced=!0,Object(y.h)(this,"preconditionsReady",(()=>this._readyCycleForced=!1)))}createTool(e,t,r){return this.toolViewManager.createTool(e,t,r)}tryFatalErrorRecovery(){this.fatalError=null}_resetInitialViewPropertiesFromContent(){if(!this.defaultsFromMap)return;const e=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([Object(y.e)(this,"spatialReference",((t,r)=>{Object(ka.c)(t,r)||e()})),Object(y.e)(this,"initialExtentRequired",e),Object(g.b)(e)],"defaultsFromMap")}};zo.views=new l.a,Object(i.a)([Object(W.a)("toolViewManager.activeTool")],zo.prototype,"activeTool",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"allLayerViews",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"groundView",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"animation",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"basemapView",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"defaultsFromMap",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"fatalError",void 0),Object(i.a)([Object(j.b)({type:Fa.a})],zo.prototype,"extent",void 0),Object(i.a)([Object(j.b)(Object(za.b)())],zo.prototype,"graphics",void 0),Object(i.a)([Object(j.b)({readOnly:!0,type:T.a,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],zo.prototype,"heightModelInfo",null),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"interacting",null),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"navigating",void 0),Object(i.a)([Object(j.b)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"]})],zo.prototype,"preconditionsReady",null),Object(i.a)([Object(j.b)({type:l.a,readOnly:!0})],zo.prototype,"layerViews",void 0),Object(i.a)([Object(j.b)({type:Wa})],zo.prototype,"magnifier",void 0),Object(i.a)([Object(j.b)({value:null,type:Aa.a})],zo.prototype,"map",null),Object(i.a)([Object(j.b)()],zo.prototype,"padding",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"ready",void 0),Object(i.a)([Object(j.b)({type:La.a})],zo.prototype,"spatialReference",null),Object(i.a)([Object(j.b)()],zo.prototype,"spatialReferenceWarningDelay",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"stationary",null),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"supportsGround",void 0),Object(i.a)([Object(j.b)({type:Ea.a})],zo.prototype,"timeExtent",void 0),Object(i.a)([Object(W.a)("toolViewManager.tools")],zo.prototype,"tools",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"toolViewManager",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"type",void 0),Object(i.a)([Object(j.b)({type:Number})],zo.prototype,"scale",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"updating",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"initialExtentRequired",void 0),Object(i.a)([Object(j.b)({readOnly:!0,type:Fa.a})],zo.prototype,"initialExtent",null),Object(i.a)([Object(j.b)()],zo.prototype,"cursor",null),Object(i.a)([Object(j.b)()],zo.prototype,"renderContext",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"input",void 0),Object(i.a)([Object(j.b)({type:Po,nonNullable:!0})],zo.prototype,"navigation",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"layerViewManager",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"width",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"height",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"resizing",void 0),Object(i.a)([Object(j.b)({value:null,readOnly:!0})],zo.prototype,"size",null),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"suspended",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"viewEvents",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zo.prototype,"persistableViewModels",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"_isValid",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"_readyCycleForced",void 0),Object(i.a)([Object(j.b)()],zo.prototype,"_currentSpatialReference",void 0),zo=Fo=Object(i.a)([Object(w.a)("esri.views.View")],zo);var Vo=zo;let No=class extends Da.a{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise(((e,t)=>this._dfd={resolve:e,reject:t})))}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new u.a("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=Object(m.q)(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};Object(i.a)([Object(j.b)({readOnly:!0})],No.prototype,"done",null),Object(i.a)([Object(j.b)({readOnly:!0,type:String})],No.prototype,"state",void 0),Object(i.a)([Object(j.b)()],No.prototype,"target",void 0),No=Object(i.a)([Object(w.a)("esri.views.ViewAnimation")],No),(No||(No={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};var Uo=No;function Bo(e){return"global"===e?1:2}const Go=()=>r.e(87).then(r.bind(null,1173)),qo=()=>Promise.resolve().then(r.bind(null,670)),Ho={"base-dynamic":()=>r.e(73).then(r.bind(null,1034)),"base-elevation":qo,"base-tile":Go,"bing-maps":Go,"building-scene":()=>Promise.all([r.e(1),r.e(2),r.e(3),r.e(7),r.e(37)]).then(r.bind(null,1164)),csv:()=>Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(52)]).then(r.bind(null,1035)),"direct-line-measurement":()=>Promise.all([r.e(4),r.e(17),r.e(92)]).then(r.bind(null,1162)),"area-measurement":()=>Promise.all([r.e(4),r.e(17),r.e(90)]).then(r.bind(null,1156)),elevation:qo,feature:()=>Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(53)]).then(r.bind(null,1036)),geojson:()=>Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(54)]).then(r.bind(null,1037)),graphics:()=>Promise.all([r.e(3),r.e(48)]).then(r.bind(null,1038)),group:()=>r.e(208).then(r.bind(null,1039)),imagery:()=>r.e(63).then(r.bind(null,1174)),"integrated-mesh":()=>Promise.all([r.e(3),r.e(7),r.e(41)]).then(r.bind(null,1040)),"line-of-sight":()=>r.e(79).then(r.bind(null,1163)),"map-image":()=>r.e(43).then(r.bind(null,1175)),"ogc-feature":()=>Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(55)]).then(r.bind(null,1176)),"open-street-map":Go,"point-cloud":()=>Promise.all([r.e(7),r.e(44)]).then(r.bind(null,1160)),voxel:()=>r.e(175).then(r.bind(null,1166)),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?Promise.all([r.e(1),r.e(2),r.e(3),r.e(7),r.e(38)]).then(r.bind(null,1041)):Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(39)]).then(r.bind(null,1177)),stream:()=>Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(46)]).then(r.bind(null,1169)),tile:Go,"imagery-tile":()=>r.e(21).then(r.bind(null,1178)),"vector-tile":()=>Promise.all([r.e(6),r.e(12),r.e(42)]).then(r.bind(null,1153)),wcs:()=>r.e(21).then(r.bind(null,1178)),"web-tile":Go,wfs:()=>Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(56)]).then(r.bind(null,1042)),wms:()=>r.e(62).then(r.bind(null,1179)),wmts:()=>r.e(176).then(r.bind(null,1043)),slice:()=>r.e(40).then(r.bind(null,1158)),"geo-rss":null,kml:null,"map-notes":null,route:null,"subtype-group":null,unknown:null,unsupported:null};const Wo=e=>Object(b.j)(Ho[e.type]),$o=e=>{const t=Ho[e.type];if(!Object(b.j)(t))throw function(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new u.a(`${r}:view-not-supported`,`${t} is not supported in 3D`)}(e);return t(e)};var Qo=r(295),Zo=r(57),Xo=r(67);const Jo=f.a.getLogger("esri.views.3d.state.Constraints");let Yo=class extends N.a{constructor(e){super(e),this.collision=new rl,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return 2===this.mode?null:this._get("altitude")||null}set altitude(e){2!==this.mode?this._set("altitude",e):Jo.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Object(Bt.e)(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const r=this.tilt(e);return Object(Bt.e)(t,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return 2===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,r=tl)=>(r.min=el.min,r.max=e,r)}createDefaultTiltLocal(){const e=this.collision.enabled?Object(Xo.h)([[4e3,el.max],[1e4,Object(Bt.g)(88)],[6e6,Object(Bt.g)(88)]]):()=>el.max;return(t,r=tl)=>(r.min=el.min,r.max=e(t),r)}createDefaultTiltGlobal(){const e=this.collision.enabled?Object(Xo.h)([[4e3,el.max],[5e4,Object(Bt.g)(88)],[6e6,Object(Bt.g)(88)],[2e7,el.min]]):Object(Xo.h)([[3e5,el.max],[3e6,Object(Bt.g)(88)],[6e6,Object(Bt.g)(88)],[2e7,el.min]]);return(t,r=tl)=>(r.min=el.min,r.max=e(t),r)}};Object(i.a)([Object(j.b)()],Yo.prototype,"altitude",null),Object(i.a)([Object(j.b)({readOnly:!0})],Yo.prototype,"collision",void 0),Object(i.a)([Object(j.b)()],Yo.prototype,"distance",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Yo.prototype,"minimumPoiDistance",void 0),Object(i.a)([Object(j.b)()],Yo.prototype,"tilt",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Yo.prototype,"mode",void 0),Yo=Object(i.a)([Object(w.a)("esri.views.3d.state.Constraints")],Yo);const Ko=function(e){return{min:-2e5,max:4*e.radius}}(Zo.a),el={min:Object(Bt.g)(.5),max:Object(Bt.g)(179.5)},tl={min:0,max:0};let rl=class extends N.a{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};Object(i.a)([Object(j.b)({type:Boolean})],rl.prototype,"enabled",void 0),Object(i.a)([Object(j.b)({type:Number})],rl.prototype,"elevationMargin",void 0),rl=Object(i.a)([Object(w.a)("esri.views.3d.state.Constraints.CollisionConstraint")],rl);var il=Yo;let nl=class extends N.a{constructor(){super(...arguments),this.min=Ko.min,this.max=Ko.max}set mode(e){Object(Qo.a)(f.a.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})}get mode(){return Object(Qo.a)(f.a.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"}),"manual"}};Object(i.a)([Object(j.b)({type:Number})],nl.prototype,"min",void 0),Object(i.a)([Object(j.b)({type:Number})],nl.prototype,"max",void 0),nl=Object(i.a)([Object(w.a)("esri.views.3d.constraints.AltitudeConstraint")],nl);var sl=nl;let al=class extends N.a{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){"auto"===this.mode&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};Object(i.a)([Object(j.b)({type:Number,value:1e-8})],al.prototype,"near",null),Object(i.a)([Object(_.a)("near")],al.prototype,"castNear",null),Object(i.a)([Object(j.b)({type:Number,value:1e-8})],al.prototype,"far",null),Object(i.a)([Object(_.a)("far")],al.prototype,"castFar",null),Object(i.a)([Object(j.b)({type:["auto","manual"]})],al.prototype,"mode",void 0),al=Object(i.a)([Object(w.a)("esri.views.3d.constraints.ClipDistanceConstraint")],al);var ol=al;const ll={min:Object(Bt.r)(el.min),max:Object(Bt.r)(el.max)};let cl=class extends N.a{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Object(Bt.e)(e,ll.min,ll.max)}autoUpdate(e){"auto"===this.mode&&this._get("max")!==e&&this._set("max",e)}};Object(i.a)([Object(j.b)({type:["auto","manual"]})],cl.prototype,"mode",void 0),Object(i.a)([Object(j.b)({type:Number,value:ll.max})],cl.prototype,"max",null),Object(i.a)([Object(_.a)("max")],cl.prototype,"castMax",null),cl=Object(i.a)([Object(w.a)("esri.views.3d.constraints.TiltConstraint")],cl);var ul=cl;let dl=class extends N.a{constructor(){super(...arguments),this.tilt=new ul,this.altitude=new sl,this.clipDistance=new ol}};Object(i.a)([Object(j.b)({type:ul})],dl.prototype,"tilt",void 0),Object(i.a)([Object(j.b)({type:sl})],dl.prototype,"altitude",void 0),Object(i.a)([Object(j.b)({type:ol})],dl.prototype,"clipDistance",void 0),dl=Object(i.a)([Object(w.a)("esri.views.3d.constraints.Constraints")],dl);var hl,pl=dl,fl=r(13);let bl=hl=class extends N.a{set quality(e){-1!==["low","high"].indexOf(e)&&this._set("quality",e)}clone(){return new hl({quality:this.quality})}};Object(i.a)([Object(j.b)({type:["low","high"],value:"low"})],bl.prototype,"quality",null),bl=hl=Object(i.a)([Object(w.a)("esri.views.3d.environment.SceneViewAtmosphere")],bl);var ml,gl=bl,yl=r(217);let vl=ml=class extends(zi.a.EventedMixin(yl.a)){constructor(e){super(e),this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0},this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1;const t=(new Date).getFullYear(),r=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}static fromWebsceneLighting(e){return new ml({...e.cloneConstructProperties()})}get defaultDate(){return new Date(this._get("defaultDate").getTime())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){null!=e&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const r=Ol(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let i=null;null!=e&&(this.positionTimezoneInfo.autoUpdated=!0,i=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const n=Ol(this.positionTimezoneInfo);if(r!==n&&(jl.target=this,jl.timezoneOffset=n,this.emit("timezone-will-change",jl)),null!=e)return i!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new ml({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return null!=e.date&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};function Ol({hours:e,minutes:t,seconds:r}){return Math.round(e+t/60+r/3600)}Object(i.a)([Object(j.b)({type:Boolean})],vl.prototype,"cameraTrackingEnabled",void 0),Object(i.a)([Object(j.b)({type:Boolean})],vl.prototype,"ambientOcclusionEnabled",void 0),Object(i.a)([Object(j.b)({type:Boolean})],vl.prototype,"waterReflectionEnabled",void 0),Object(i.a)([Object(j.b)({type:Date})],vl.prototype,"defaultDate",null),Object(i.a)([Object(j.b)({type:Date})],vl.prototype,"date",null),vl=ml=Object(i.a)([Object(w.a)("esri.views.3d.environment.SceneViewLighting")],vl);const jl={target:null,timezoneOffset:0};var _l,wl=r(284);let xl=_l=class extends wl.a{constructor(e){super(e),this.atmosphere=new gl}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new _l({...t,lighting:vl.fromWebsceneLighting(t.lighting)})}castLighting(e){return this.convertLighting(e)}applyLighting(e){this.lighting=this.convertLighting(e)}convertLighting(e){return e?e instanceof vl?e:e instanceof yl.a?this.lighting?this.lighting.cloneWithWebsceneLighting(e):vl.fromWebsceneLighting(e):Object(x.m)(vl,e):new vl}clone(){return new _l({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Object(fl.a)(this.background)})}cloneWithWebsceneEnvironment(e){return new _l({atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Object(fl.a)(this.background),...e.cloneConstructProperties(),lighting:null!=this.lighting?this.lighting.cloneWithWebsceneLighting(e.lighting):vl.fromWebsceneLighting(e.lighting)})}};Object(i.a)([Object(j.b)({type:gl,json:{read:!1}})],xl.prototype,"atmosphere",void 0),Object(i.a)([Object(j.b)()],xl.prototype,"lighting",void 0),Object(i.a)([Object(_.a)("lighting")],xl.prototype,"castLighting",null),xl=_l=Object(i.a)([Object(w.a)("esri.views.3d.environment.SceneViewEnvironment")],xl);var Sl=xl,Tl=r(35),Cl=r(3),Ml=r(31),Pl=r(16),Al=r(20),El=r(142),Rl=r(604),Il=r(77),Dl=r(82),Fl=r(15),Ll=r(62),kl=r(74),zl=r(30);class Vl extends Dl.a{initializeProgram(e){const t=Vl.shader.get(),r=this.configuration,i=t.build({geometry:r.geometry});return new kl.a(e.rctx,i,Ll.a)}initializePipeline(){return 1===this.configuration.geometry?Object(zl.g)({blending:Object(zl.h)(770,1,771,771),culling:zl.b,depthTest:{func:515},colorWrite:zl.d}):Object(zl.g)({blending:Object(zl.h)(770,1,771,771),depthTest:{func:515},colorWrite:zl.d})}}Vl.shader=new Il.a(Rl.a,(()=>r.e(172).then(r.bind(null,1044))));class Nl extends Fl.a{constructor(){super(...arguments),this.geometry=0}}Object(i.a)([Object(Fl.b)({count:3})],Nl.prototype,"geometry",void 0);var Ul="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=",Bl=r(129),Gl=r(94),ql=r(92),Hl=r(160),Wl=r(66),$l=r(47),Ql=r(78),Zl=r(90);const Xl=f.a.getLogger("esri.views.3d.environment.PanoramicAtmosphere");const Jl=Object(Al.d)(),Yl=Object(Gl.a)().vec3f("position");var Kl=class{constructor(){this.slot=14,this._atmosphereTechniqueConfig=new Nl,this._readyResolver=Object(m.h)(),this._readyController=Object(m.e)()}get canRender(){return null!=this._texture}destroy(){this._readyResolver.reject(),this._texture=Object(b.f)(this._texture),this._vao=Object(b.f)(this._vao),this._readyController=Object(b.a)(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(e){this._atmosphereTechniqueConfig.geometry=1,this._atmosphereTechnique=e.shaderTechniqueRep.acquire(Vl,this._atmosphereTechniqueConfig);const t=e.renderContext.rctx;this._vao=this._createVertexArrayObject(t),this._vaoCount=Object(Ql.f)(this._vao,"geometry"),Object(El.a)(Ul,{signal:this._readyController.signal}).then((r=>{this._texture=new $l.a(t,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},r),e.requestRender(),this._readyController=null,this._readyResolver.resolve()})).catch((e=>{Object(m.n)(e)||Xl.error("Unable to initialize atmosphere: image request failed",e),this._readyResolver.reject()}))}uninitializeRenderContext(){this.destroy()}render(e){if(e.slot!==this.slot||0!==e.pass)return!1;const t=e.rctx,r=this._atmosphereTechnique.program;return t.useProgram(r),this._atmosphereTechnique.bindPipelineState(t),r.bindTexture(this._texture,"tex"),Object(ql.c)(r,e.camera.projectionMatrix),function(e,t){Object(Pl.d)(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}(Jl,e.camera.viewMatrix),r.setUniformMatrix4fv("view",Jl),r.setUniform4f("color",1,1,1,1),e.scenelightingData.setLightDirectionUniform(r),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(4,0,this._vaoCount),!0}_createVertexArrayObject(e){const t=Hl.a.createPolySphereGeometry(1,2,!1),r=t.indices.get("position");for(let a=0;a<r.length;a+=3){const e=r[a];r[a]=r[a+2],r[a+2]=e}const i=t.vertexAttributes.get("position").data,n=Yl.createBuffer(r.length),s=n.position;for(let a=0;a<r.length;++a){const e=3*r[a];s.set(a,0,i[e]),s.set(a,1,i[e+1]),s.set(a,2,i[e+2])}return new Zl.a(e,Ll.a,{geometry:Object(Bl.a)(Yl)},{geometry:Wl.a.createVertex(e,35044,n.buffer)})}},ec=r(18),tc=r(27),rc=r(40);function ic(e){const t=1e5;return Math.min(1,Math.max(0,(e-t)/9e5))}var nc=r(605);class sc extends Dl.a{initializeProgram(e){const t=sc.shader.get(),r=this.configuration,i=t.build({haze:r.haze});return new kl.a(e.rctx,i,Ll.a)}initializePipeline(){return this.configuration.haze?Object(zl.g)({blending:Object(zl.h)(1,0,769,1),colorWrite:zl.d}):Object(zl.g)({blending:Object(zl.h)(770,1,771,771),depthTest:{func:515},colorWrite:zl.d})}}sc.shader=new Il.a(nc.a,(()=>r.e(171).then(r.bind(null,1045))));class ac extends Fl.a{constructor(){super(...arguments),this.haze=!1}}Object(i.a)([Object(Fl.b)()],ac.prototype,"haze",void 0);class oc{constructor(e){this._view=e,this.canRender=!0,this._skyslot=14,this._hazeSlot=15,this._renderData={texDepth:Object(tc.b)(),cameraPosition:Object(S.e)(),projectionInverse:Object(Al.d)(),viewInverse:Object(Al.d)(),heightParameters:Object(Ml.e)(),atmosphereParameters1:Object(Ml.e)(),atmosphereParameters2:Object(Ml.e)(),atmosphereParameters3:Object(S.e)(),invWavelength:uc,invWavelengthScaled:dc,radii:Object(tc.b)(),scale:0,scaleDepth:hc,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,oneOverScaleDepth:0,scaleDepthBlue:pc,oneOverScaleDepthBlue:bc,scaleOverScaleDepthBlue:0,g:mc,g2:mc*mc,miePhaseCoefficients:gc,nearFar:Object(tc.b)(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0},this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=Zo.a.radius,this._updateRadius(Zo.a.radius)}destroy(){this._handles&&(this._handles.destroy(),this._handles=null),this._vao&&(this._vao.dispose(),this._vao=null)}when(){return Promise.resolve()}initializeRenderContext(e){const t=e.renderContext.rctx;this._handles=new F.a,this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"}),this._handles.add(Object(y.b)(this._view,"basemapTerrain","elevation-change",(e=>this._updateElevation(e)),(()=>this._updateElevation()))),this._handles.add(Object(y.b)(this._view,"basemapTerrain","elevation-bounds-change",(()=>this._updateVisibleElevationBounds()),(()=>this._updateVisibleElevationBounds())));const r=new ac;r.haze=!1,this._atmosphereTechnique=e.shaderTechniqueRep.acquire(sc,r),r.haze=!0,this._atmosphereHazeTechnique=e.shaderTechniqueRep.acquire(sc,r),this._vao=this._createVertexArrayObject(t)}uninitializeRenderContext(){this.destroy()}render(e){return(e.slot===this._hazeSlot||e.slot===this._skyslot)&&0===e.pass&&(this._update(e.camera),e.slot===this._skyslot&&this._renderSky(e),e.slot===this._hazeSlot&&this._renderHaze(e),!0)}_renderSky(e){const t=e.rctx,r=this._atmosphereTechnique.program;t.useProgram(r),this._atmosphereTechnique.bindPipelineState(t),r.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3),this._renderCommon(r,e)}_renderHaze(e){const t=e.rctx,r=e.offscreenRenderingHelper,i=this._atmosphereHazeTechnique.program;t.useProgram(i),this._atmosphereHazeTechnique.bindPipelineState(t),r.renderDepthDetached((()=>{const t=r.depthTexture;i.bindTexture(t,"depthTex"),this._renderCommon(i,e)}))}_renderCommon(e,t){const r=t.rctx;e.setUniform3fv("invWavelength",this._renderData.invWavelength),e.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled),t.scenelightingData.setLightDirectionUniform(e),e.setUniform4fv("heightParameters",this._renderData.heightParameters),e.setUniform3fv("cameraPosition",this._renderData.cameraPosition),e.setUniformMatrix4fv("projectionInverse",this._renderData.projectionInverse),e.setUniformMatrix4fv("viewInverse",this._renderData.viewInverse),e.setUniform2fv("nearFar",this._renderData.nearFar),e.setUniform2fv("radii",this._renderData.radii),e.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1),e.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2),e.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance),e.setUniform1f("altitudeFade",this._renderData.altitudeFade),r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(5,0,4)}_createVertexArrayObject(e){const t=yc.createBuffer(4);return t.position.setVec(0,[-1,-1]),t.position.setVec(1,[1,-1]),t.position.setVec(2,[-1,1]),t.position.setVec(3,[1,1]),t.uv0.setVec(0,[0,0]),t.uv0.setVec(1,[1,0]),t.uv0.setVec(2,[0,1]),t.uv0.setVec(3,[1,1]),new Zl.a(e,Ll.a,{geometry:Object(Bl.a)(yc)},{geometry:Wl.a.createVertex(e,35044,t.buffer)})}_adjustRadiusForTesselation(e){const t=Math.PI/16/16;return e*Math.cos(t)}_updateElevation(e){const t=e?e.tile:this._view.basemapTerrain.rootTiles[0];if(0!==t.lij[0])return;const r=this._adjustRadiusForTesselation(Zo.a.radius+t.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Zo.a.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||e<this._lowerBoundEarthRadius)&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e;const t=e,r=t/10*10.25,i=1/(r-t),n=i/hc,s=i/pc,a=.3*(r-t)+t,o=this._renderData;Object(rc.l)(o.atmosphereParameters1,i,hc,n,fc),Object(rc.l)(o.atmosphereParameters2,mc,pc,s,bc),Object(Cl.y)(o.atmosphereParameters3,mc*mc,gc,a),Object(ec.r)(o.radii,t,r),o.scale=i,o.lowerAlphaBlendBound=a,o.scaleOverScaleDepth=n,o.scaleOverScaleDepthBlue=s;o.innerFadeDistance=2*Math.sqrt(1e4*(2*t-1e4))}_update(e){e&&(this._renderData.cameraHeight=Object(Cl.r)(e.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=Object(Ml.g)(this._renderData.cameraHeight,this._renderData.cameraHeightSq,this._renderData.C,this._renderData.CSur),Object(Cl.m)(this._renderData.cameraPosition,e.eye),Object(Pl.a)(this._renderData.projectionInverse,e.projectionMatrix),Object(Pl.a)(this._renderData.viewInverse,e.viewMatrix),Object(ec.r)(this._renderData.nearFar,e.near,e.far),this._renderData.altitudeFade=ic(this._renderData.cameraHeight-this._lowerBoundEarthRadius))}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}}const lc=.02*Math.PI,cc=.004*Math.PI,uc=Object(S.g)(1/.65**4,1/.57**4,1/.475**4),dc=Object(S.c)(uc);Object(Cl.g)(dc,dc,lc),Object(Cl.h)(dc,dc,Object(S.g)(cc,cc,cc));const hc=.25,pc=.05,fc=1/hc,bc=1/pc,mc=-.99999,gc=(1-mc*mc)/(2+mc*mc)*1.5,yc=Object(Gl.a)().vec2f("position").vec2f("uv0");var vc=r(111),Oc=r(33);const jc=f.a.getLogger("esri.views.3d.environment.SimpleAtmosphere"),_c=128,wc=-1e4,xc=Object(Xo.h)([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);function Sc(e,t,r,i,n){const s=Object(Cl.r)(e),a=i*Math.sqrt(s*s-i*i)/s,o=Math.sqrt(i*i-a*a),l=n.silCircleV1,c=n.silCircleV2;return Object(Cl.g)(n.silCircleCenter,e,o/s),Object(Cl.i)(l,e,t),Object(Cl.v)(l)<1&&Object(Cl.i)(l,e,r),Object(Cl.g)(l,l,a/Object(Cl.r)(l)),Object(Cl.i)(c,l,e),Object(Cl.g)(c,c,a/Object(Cl.r)(c)),a}const Tc=Object(Al.d)(),Cc=Object(S.e)(),Mc=Object(S.e)();const Pc=Object(Gl.a)().vec3f("position");var Ac=class{constructor(e){this.view=e,this.slot=14,this._renderData={texV:Object(tc.b)(),silCircleCenter:Object(S.e)(),silCircleV1:Object(S.e)(),silCircleV2:Object(S.e)(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._fadeVaoCount=0,this._readyResolver=Object(m.h)(),this._readyController=Object(m.e)(),this.texV1=1,this.isOnMars=Object(ka.h)(e.spatialReference);const t=Object(M.e)(e.spatialReference);this.planetRadius=t.radius,this.outerRimWidth=t.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+wc)/this.planetRadius,this.middleRimFactor=(this.planetRadius+0)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=0/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}get canRender(){return null!=this._texture}when(){return this._readyResolver.promise}initializeRenderContext(e){const t=e.renderContext.rctx;this._cameraChangeHandle=Object(y.a)(this.view,"state.camera",(()=>e.requestRender()),!0);const r=new Nl;r.geometry=0,this._atmosphereConeTechnique=e.shaderTechniqueRep.acquire(Vl,r),r.geometry=2,this._atmosphereUndergroundTechnique=e.shaderTechniqueRep.acquire(Vl,r),this._vao=this._createRibbon(t),this._vaoCount=Object(Ql.f)(this._vao,"geometry"),this._fadeVao=Object(vc.d)(t),this._fadeVaoCount=Object(Ql.f)(this._fadeVao,"geometry"),Object(El.a)(this.isOnMars?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==":Ul,{signal:this._readyController.signal}).then((r=>{this._texture=new $l.a(t,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},r),e.requestRender(),this._readyController=null,this._readyResolver.resolve()})).catch((e=>{Object(m.n)(e)||jc.error("Unable to initialize simple atmosphere: image request failed",e),this._readyResolver.reject()}))}uninitializeRenderContext(){this.destroy()}destroy(){this._readyResolver.reject(),this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null),this._texture&&(this._texture.dispose(),this._texture=null),this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null),this._vao&&(this._vao.dispose(),this._vao=null),this._readyController&&(this._readyController.abort(),this._readyController=null)}render(e){if(e.slot!==this.slot||0!==e.pass)return!1;this._update(e.camera);const t=e.rctx;if(this._atmosphereConeTechnique.bindPipelineState(t),this._renderData.undergroundFadeAlpha<1){const r=this._atmosphereConeTechnique.program;t.useProgram(r),r.setUniformMatrix4fv("proj",e.camera.projectionMatrix),r.setUniformMatrix4fv("view",e.camera.viewMatrix),r.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),r.setUniform3fv("silCircleV1",this._renderData.silCircleV1),r.setUniform3fv("silCircleV2",this._renderData.silCircleV2),r.setUniform2fv("texV",this._renderData.texV),r.bindTexture(this._texture,"tex"),e.scenelightingData.setLightDirectionUniform(r),r.setUniform1f("altitudeFade",this._renderData.altitudeFade),r.setUniform1f("innerScale",this._renderData.innerScale),t.bindVAO(this._vao),t.drawArrays(4,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const r=this._atmosphereUndergroundTechnique.program;t.useProgram(r),r.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),e.scenelightingData.setLightDirectionUniform(r),r.setUniform3fv("cameraPosition",e.camera.eye),t.bindVAO(this._fadeVao),t.drawArrays(5,0,this._fadeVaoCount)}return!0}_update(e){const t=Object(S.e)(),r=this.planetRadius,i=Object(Cl.r)(e.eye),n=i-r;if(n<0){const e=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=e}else this._renderData.undergroundFadeAlpha=0;const s=Math.max(50,n),a=r+wc;this._renderData.innerScale=function(e,t,r){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-r*r)+t*r)}(r+s,r,a)-1,this._renderData.altitudeFade=ic(n),Object(Cl.g)(t,e.eye,(r+50)/i),Sc(t,e.center,e.up,r,this._renderData);const o=this._computeScreenRimWidth(e,t,e.up,this._renderData),l=1-511/512,c=xc(n);let u=this.texV0+l*this.texVScale,d=this.texV0+o*c*this.texVScale;if(n>50){Sc(e.eye,e.center,e.up,r,this._renderData);const t=this._computeScreenRimWidth(e,e.eye,e.up,this._renderData),i=Object(Bt.e)((t-1.5)/(o-1.5),0,1);u=this.texV0+i*l*this.texVScale,d=this.texV0+Object(Bt.m)(this.texV1,o*c,i)*this.texVScale}Object(ec.r)(this._renderData.texV,u,d)}_createRibbon(e){const t=new Float32Array(1155),r=new Uint32Array(1920);t[0]=0,t[1]=0,t[2]=-1;for(let s=0;s<_c;s++){const e=9*s+3;t[e+0]=s,t[e+1]=this.innerRimFactor,t[e+2]=-1,t[e+3]=s,t[e+4]=this.middleRimFactor,t[e+5]=0,t[e+6]=s,t[e+7]=this.outerRimFactor,t[e+8]=1;const i=3*s+1,n=127===s?1:i+3,a=15*s;r[a+0]=i,r[a+1]=i+1,r[a+2]=n+1,r[a+3]=n+1,r[a+4]=n,r[a+5]=i,r[a+6]=i+1,r[a+7]=i+2,r[a+8]=n+2,r[a+9]=n+2,r[a+10]=n+1,r[a+11]=i+1,r[a+12]=i,r[a+13]=n,r[a+14]=0}const i=Pc.createBuffer(r.length),n=i.position;for(let s=0;s<r.length;++s){const e=3*r[s];n.set(s,0,t[e]),n.set(s,1,t[e+1]),n.set(s,2,t[e+2])}return new Zl.a(e,Ll.a,{geometry:Object(Bl.a)(Pc)},{geometry:Wl.a.createVertex(e,35044,i.buffer)})}_computeScreenRimWidth(e,t,r,i){return Object(Cl.h)(Cc,i.silCircleCenter,i.silCircleV2),Object(Cl.g)(Mc,Cc,this.outerRimFactor),Object(Pl.l)(Tc,t,Cc,r),Object(Oc.j)(Cc,Tc,e.projectionMatrix,e.viewport),Object(Oc.j)(Mc,Tc,e.projectionMatrix,e.viewport),Object(Cl.o)(Cc,Mc)/e.height}},Ec=r(606);class Rc extends Dl.a{initializeProgram(e){const t=Rc.shader.get().build();return new kl.a(e.rctx,t,Ll.a)}initializePipeline(){return Object(zl.g)({blending:Object(zl.h)(770,1,771,771),depthTest:{func:515},colorWrite:zl.d})}bindPass({camera:e,modelMatrix:t}){const r=this.makeInfiniteProjectionMatrix(e.projectionMatrix,e.near,Ic);Object(Pl.m)(r,r,e.viewMatrix),Object(Pl.m)(r,r,t),this.program.setUniformMatrix4fv("transform",r),this.program.setUniform4fv("viewport",e.fullViewport),this.program.setUniform1f("pixelRatio",e.pixelRatio)}makeInfiniteProjectionMatrix(e,t,r){const i=24e-8;return Object(Pl.d)(r,e),r[10]=i-1,r[11]=-1,r[14]=(i-2)*t,r}}Rc.shader=new Il.a(Ec.a,(()=>r.e(173).then(r.bind(null,1046))));const Ic=Object(Al.d)(),Dc=f.a.getLogger("esri.views.3d.environment.Stars");let Fc=class extends N.a{constructor(e){super(e),this.slot=14,this._loadDataTask=null,this._numPoints=0,this._modelMatrix=Object(Al.d)(),this._updatingTracking=new B.a,this._requestRender=()=>{}}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return Object(b.j)(this._loadDataTask)&&!this._loadDataTask.finished}get canRender(){return!this.loading}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Object(b.a)(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Object(b.f)(this._technique),this._vao=Object(b.f)(this._vao),this._requestRender=null}initializeRenderContext(e){this._requestRender=e.requestRender}uninitializeRenderContext(){this.destroy()}render(e){if(e.slot!==this.slot||0!==e.pass)return!1;if(this._ensureResources(e),Object(b.i)(this._technique)||Object(b.i)(this._vao))return!0;const t=e.rctx,r=this._technique.program;return t.useProgram(r),this._technique.bindPass({camera:e.camera,modelMatrix:this._modelMatrix}),this._technique.bindPipelineState(t),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(0,0,this._numPoints),!0}_ensureResources(e){if(Object(b.j)(this._technique)||Object(b.i)(Uc))return;const t=e.rctx;this._technique=new Rc({rctx:t,viewingMode:this.view.state.viewingMode},null),this._numPoints=Uc.byteLength/Vc;const r=new Float32Array(Uc,0,2*this._numPoints),i=new Uint8Array(Uc,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e.rctx,r,i,this._numPoints),this._updatingTracking.add(this.view,"environment.lighting.date",(e=>this._update(e)),2)}_computeDayDuration(e){const t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),i=this._modelMatrix;Object(Pl.d)(i,zc),Object(Pl.r)(i,i,-r*Math.PI),Object(Pl.m)(i,kc,i),Object(Pl.r)(i,i,-t*Math.PI),this._requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,r,i){const n=Nc.createBuffer(i),s=n.position,a=n.color,o=n.size;for(let l=0;l<i;l++){const e=t[2*l+0],i=t[2*l+1];s.set(l,0,-Math.cos(e)*Math.sin(i)),s.set(l,1,-Math.sin(e)*Math.sin(i)),s.set(l,2,-Math.cos(i));const n=this._unpackUint8Attributes(r[l]),c=this._hexToRGB(Lc[n[1]]);a.set(l,0,255*c[0]),a.set(l,1,255*c[1]),a.set(l,2,255*c[2]),a.set(l,3,255),o.set(l,n[0])}return new Zl.a(e,Ll.a,{geometry:Object(Bl.a)(Nc)},{geometry:Wl.a.createVertex(e,35044,n.buffer)})}_createLoadDataTask(){if(Object(b.j)(Uc))return null;const e=Object(m.i)((async e=>{const{data:t}=await Object(Be.a)("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:e});this._verifyStarData(t),Uc=t}));return e.promise.catch((e=>{Object(m.n)(e)||Dc.error(e)})).then((()=>{this.destroyed||(this._requestRender(),this.notifyChange("updating"))})),e}_verifyStarData(e){if(!e)throw new u.a("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/Vc;if(t%1!=0||t>5e4||t<5e3)throw new u.a("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};Object(i.a)([Object(j.b)({constructOnly:!0})],Fc.prototype,"view",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Fc.prototype,"updating",null),Object(i.a)([Object(j.b)()],Fc.prototype,"_loadDataTask",void 0),Object(i.a)([Object(j.b)()],Fc.prototype,"_updatingTracking",void 0),Fc=Object(i.a)([Object(w.a)("esri.views.3d.environment.Stars")],Fc);const Lc=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],kc=Object(Al.e)(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),zc=Object(Al.e)(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Vc=9,Nc=Object(Gl.a)().vec3f("position").vec4u8("color").f32("size");let Uc=null;const Bc=[14,15];let Gc=class extends N.a{constructor(){super(...arguments),this._handles=new F.a,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null,this._stars=null}get canRender(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode}get updating(){return Object(b.j)(this._pendingAtmosphere)||Object(b.j)(this._stars)&&this._stars.updating}initialize(){this.view._stage.addRenderPlugin(Bc,this)}destroy(){this._pendingAtmosphere=Object(b.e)(this._pendingAtmosphere),this._atmosphere=Object(b.e)(this._atmosphere),this._stars=Object(b.e)(this._stars),this._handles=Object(b.e)(this._handles),this.view&&null!=this.view._stage&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))}initializeRenderContext(e){this._context=e,this.setup()}setup(){this._handles.add(Object(y.f)(this.view,"basemapTerrain",(()=>this._updateBasemapTerrain()),!0)),this._handles.add([Object(y.a)(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],(()=>this._updateAtmosphere()),!0),Object(y.a)(this.view,"environment.starsEnabled",(()=>this._updateStars()),!0)])}uninitializeRenderContext(){Object(b.j)(this._stars)&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null),Object(b.j)(this._atmosphere)&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)}render(e){let t=!0;return Object(b.j)(this._stars)&&this._stars.canRender&&(t=this._stars.render(e)&&t),Object(b.j)(this._atmosphere)&&this._atmosphere.canRender&&(t=this._atmosphere.render(e)&&t),t}_setNeedsRender(){this._context&&this._context.requestRender()}_updateStars(){var e,t,r;const i=null!=(e=null==(t=this.view)||null==(r=t.environment)?void 0:r.starsEnabled)&&e;i&&Object(b.i)(this._stars)?(this._stars=new Fc({view:this.view}),this._stars.initializeRenderContext(this._context),this._setNeedsRender()):!i&&Object(b.j)(this._stars)&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())}_updateAtmosphere(){const e=this._getAtmosphereType();if(this.atmosphereType===e)return;this.atmosphereType=e,Object(b.j)(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return Object(b.j)(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const r=new t(this.view);r.initializeRenderContext(this._context),Object(b.i)(this._atmosphere)&&(this._atmosphere=r,this._setNeedsRender()),this._pendingAtmosphere=r,r.when().then((()=>{Object(b.j)(this._atmosphere)&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()})).catch((()=>{this._pendingAtmosphere===r&&(this._pendingAtmosphere=null)}))}_getAtmosphereClass(){const e=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(e);switch(e){case"none":return null;case"realistic":return oc;case"panoramic":return Kl;case"simple":return Ac;default:return}}_getAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),r=this.view.viewingMode;return!e||null==t||Object(ka.i)(this.view.spatialReference)?"none":"local"===r?"panoramic":"high"===t&&oc.isSupported(this._context)&&!Object(ka.h)(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){const e=this.view.basemapTerrain;e&&(e.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)}get test(){return{atmosphere:this._atmosphere}}};Object(i.a)([Object(j.b)({constructOnly:!0})],Gc.prototype,"view",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Gc.prototype,"atmosphereClassFromType",void 0),Object(i.a)([Object(j.b)()],Gc.prototype,"updating",null),Object(i.a)([Object(j.b)()],Gc.prototype,"_pendingAtmosphere",void 0),Object(i.a)([Object(j.b)()],Gc.prototype,"_stars",void 0),Gc=Object(i.a)([Object(w.a)("esri.views.3d.environment.EnvironmentRenderer")],Gc);var qc,Hc,Wc=Gc,$c=r(358),Qc={exports:{}};qc=Qc,void 0!==(Hc=function(){var e=Math.PI,t=Math.sin,r=Math.cos,i=Math.tan,n=Math.asin,s=Math.atan2,a=Math.acos,o=e/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function h(e){return new Date((e+.5-c)*l)}function p(e){return function(e){return e.valueOf()/l-.5+c}(e)-u}var f=23.4397*o;function b(e,n){return s(t(e)*r(f)-i(n)*t(f),r(e))}function m(e,i){return n(t(i)*r(f)+r(i)*t(f)*t(e))}function g(e,n,a){return s(t(e),r(e)*t(n)-i(a)*r(n))}function y(e,i,s){return n(t(i)*t(s)+r(i)*r(s)*r(e))}function v(e,t){return o*(280.16+360.9856235*e)-t}function O(e){return o*(357.5291+.98560028*e)}function j(e){return o*(1.9148*t(e)+.02*t(2*e)+3e-4*t(3*e))}function _(t,r){return t+r+102.9372*o+e}function w(e,t){var r=O(e),i=_(r,j(r));return t||(t={dec:0,ra:0}),t.dec=m(i,0),t.ra=b(i,0),t}var x={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(e,t,r,i){var n=o*-r,s=o*t,a=p(e),l=w(a,d),c=v(a,n)-l.ra;return i||(i={azimuth:0,altitude:0}),i.azimuth=g(c,s,l.dec),i.altitude=y(c,s,l.dec),i}},S=[[-.83,"sunrise","sunset"]];x.addTime=function(e,t,r){S.push([e,t,r])};var T=9e-4;function C(t,r){return Math.round(t-T-r/(2*e))}function M(t,r,i){return T+(t+r)/(2*e)+i}function P(e,r,i){return u+e+.0053*t(r)-.0069*t(2*i)}function A(e,i,n){return a((t(e)-t(i)*t(n))/(r(i)*r(n)))}function E(e){var i=o*(134.963+13.064993*e),n=o*(93.272+13.22935*e),s=o*(218.316+13.176396*e)+6.289*o*t(i),a=5.128*o*t(n),l=385001-20905*r(i);return{ra:b(s,a),dec:m(s,a),dist:l}}return x.getTimes=function(e,i,n){var s=o*-n,a=o*i,l=C(p(e),s),c=M(0,s,l),u=O(c),d=j(u),f=_(u,d),b=m(f,0),g=P(c,u,f);function y(e){return P(M(A(e,a,b),s,l),u,f)}var v,w,T,E,R,I={solarNoon:h(g),nadir:h(g-.5),polarException:x.POLAR_EXCEPTION.NORMAL};for(v=0,w=S.length;v<w;v+=1)R=g-((E=y((T=S[v])[0]*o))-g),I[T[1]]=h(R),I[T[2]]=h(E);return I.polarException=function(e){var i=(t(e)-t(a)*t(b))/(r(a)*r(b));return i<-1?x.POLAR_EXCEPTION.MIDNIGHT_SUN:i>1?x.POLAR_EXCEPTION.POLAR_NIGHT:x.POLAR_EXCEPTION.NORMAL}(S[0][0]*o),I},x.getMoonPosition=function(e,t,r){var n=o*-r,s=o*t,a=p(e),l=E(a),c=v(a,n)-l.ra,u=y(c,s,l.dec);return u+=.017*o/i(u+10.26*o/(u+5.1*o)),{azimuth:g(c,s,l.dec),altitude:u,distance:l.dist}},x.getMoonFraction=function(e){var i=p(e),n=w(i),o=E(i),l=149598e3,c=a(t(n.dec)*t(o.dec)+r(n.dec)*r(o.dec)*r(n.ra-o.ra)),u=s(l*t(c),o.dist-l*r(c));return(1+r(u))/2},x}())&&(qc.exports=Hc);var Zc=Qc.exports;const Xc={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8e5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function Jc(e,t){const r=t[2],i=tu;Object(Cl.y)(i.ambient.color,1,1,1),i.ambient.intensity=Xc.global.ambient,Object(Cl.y)(i.diffuse.color,1,1,1),i.diffuse.intensity=Xc.global.diffuse;let n=(Math.abs(r)-Xc.local.altitude)/(Xc.global.altitude-Xc.local.altitude);n=Object(Bt.e)(n,0,1),i.globalFactor=n;const s=Zc.getTimes(e,t[1],t[0]);if(n<1){const t=function(e,t){const r=e.valueOf();let i,n;t.polarException===Zc.POLAR_EXCEPTION.MIDNIGHT_SUN?(i=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=i+432e6):t.polarException===Zc.POLAR_EXCEPTION.POLAR_NIGHT?(i=r-2,n=r-1):(i=t.sunrise.valueOf(),n=t.sunset.valueOf());const s=n-i,a=i+s/2,o=s/4,l=a-o,c=a+o,u=.06*s,d=i-u/2,h=i+u/2,p=n-u/2,f=n+u/2,b=Xc.local,m=[.01,b.ambientAtNight],g=[.8,.8,1],y=[.01,.01,.01],v=[b.diffuseAtTwilight,b.ambientAtTwilight],O=[1,.75,.75],j=[.8,.8,1],_=[.9*b.diffuseAtNoon,b.ambientAtNoon],w=[1,.98,.98],x=[.98,.98,1],T=[b.diffuseAtNoon,b.ambientAtNoon],C=[1,1,1],M=[1,1,1],P=_,A=w,E=x,R=v,I=O,D=j;let F,L,k=[0,0],z=[0,0,0],V=[0,0,0];return r<d||r>f?(k=m,z=y,V=g,L="night"):r<h?(F=h-d,k=ru(r-d,F,m,v),z=ru(r-d,F,y,O),V=ru(r-d,F,g,j),L="sun rising"):r<l?(F=l-h,k=ru(r-h,F,v,_),z=ru(r-h,F,O,w),V=ru(r-h,F,j,x),L="early morning"):r<a?(F=a-l,k=ru(r-l,F,_,T),z=ru(r-l,F,w,C),V=ru(r-l,F,x,M),L="late morning"):r<c?(F=c-a,k=ru(r-a,F,T,P),z=ru(r-a,F,C,A),V=ru(r-a,F,M,E),L="early afternoon"):r<p?(F=p-c,k=ru(r-c,F,P,R),z=ru(r-c,F,A,I),V=ru(r-c,F,E,D),L="late afternoon"):r<f&&(F=f-p,k=ru(r-p,F,R,m),z=ru(r-p,F,I,y),V=ru(r-p,F,D,g),L="sun setting"),{diffuse:{intensity:k[0],color:Object(S.g)(z[0],z[1],z[2])},ambient:{intensity:k[1],color:Object(S.g)(V[0],V[1],V[2])},timeOfDay:L}}(e,s);Object(Cl.k)(i.ambient.color,t.ambient.color,i.ambient.color,n),i.ambient.intensity=Object(Bt.m)(t.ambient.intensity,i.ambient.intensity,n),Object(Cl.k)(i.diffuse.color,t.diffuse.color,i.diffuse.color,n),i.diffuse.intensity=Object(Bt.m)(t.diffuse.intensity,i.diffuse.intensity,n)}return i.noonFactor=function(e,t){const r=e.valueOf();let i,n;t.polarException===Zc.POLAR_EXCEPTION.MIDNIGHT_SUN?(i=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=i+432e6):t.polarException===Zc.POLAR_EXCEPTION.POLAR_NIGHT?(i=r-2,n=r-1):(i=t.sunrise.valueOf(),n=t.sunset.valueOf());const s=i+(n-i)/2;return 1-Object(Bt.e)(Math.abs(r-s)/432e5,0,1)}(e,s),i}function Yc(e,t,r,i){i||(i=Object(S.e)());const n=eu,s=Object(Pl.i)(Kc);if("global"===r)Zc.getPosition(e,0,0,n),Object(Cl.y)(i,0,0,-1),Object(Pl.b)(s,s,-n.azimuth),Object(Pl.j)(s,s,-n.altitude),Object(Cl.s)(i,i,s);else{const r=Xc.planarDirection,a=r.globalAngles,o=t[2];let l=(Math.abs(o)-r.localAltitude)/(r.globalAltitude-r.localAltitude);l=Object(Bt.e)(l,0,1),l<1?(Zc.getPosition(e,t[1],t[0],n),n.azimuth=(1-l)*n.azimuth+l*a.azimuth,n.altitude=(1-l)*n.altitude+l*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),Object(Cl.y)(i,0,-1,0),Object(Pl.r)(s,s,-n.azimuth),Object(Pl.b)(s,s,-n.altitude),Object(Cl.s)(i,i,s)}return i}const Kc=Object(Al.d)(),eu={azimuth:0,altitude:0},tu={ambient:{color:Object(S.e)(),intensity:0},diffuse:{color:Object(S.e)(),intensity:0,directionToLightSource:Object(S.e)()},globalFactor:0,noonFactor:0};function ru(e,t,r,i){const n=[];for(let s=0;s<r.length;s++)n[s]=(i[s]-r[s])*e/t+r[s];return n}new Date(0);var iu=r(220),nu=r(502);const su=Object(S.g)(.5773502691896258,-.5773502691896258,.5773502691896258);let au=class extends zi.a.EventedAccessor{constructor(...e){super(...e),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new F.a,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this.referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new iu.c,this._ambientLight=new iu.a,this._moonLight=new iu.b,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get updating(){return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){this._renderer||(this._view=e,this._renderer=new Wc({view:e}),this._viewHandles.add([e.watch("environment.lighting.date",(e=>this._lightingDateHandler(e)),!0),e.watch("stationary",(()=>this._interactingStationaryHandler())),e.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.lighting.waterReflectionEnabled","environment.background.color"],(()=>this._updateRenderParamsHandler()),!0),e.watch("spatialReference",(()=>this._resetReferencePosition(!0)),!0),Object(y.a)(e,"viewingMode",(()=>this._resetReferencePosition(!0)),!0),Object(y.a)(e,"environment.lighting.cameraTrackingEnabled",(e=>this._updateCameraTracking(e)),!0),Object(y.a)(e,"state.camera",(()=>this._cameraHandler(null)),!0),this.watch("disableQueries",(()=>this._cameraHandler(null)))]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))}disconnectView(){this._renderer&&(this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer.destroy(),this._renderer=null,this._view=null)}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const e=this._view.environment.lighting;e&&(e.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){if(!e)return;const t=this._view.environment.lighting;if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Object(C.a)(r)){const e=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(e))return void this._requestReferencePositionUpdate(e)}if(this._preupdateTracking(e),Object(b.j)(this._referencePosWGS84Comparable)){const e=Object($c.c)(this._referencePosWGS84Comparable,lu);Object(b.j)(e)&&(t.autoUpdate(null,e),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLightParams(e)}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){if(!this._view.ready)return;const t=this._view.camera;t&&(this._cameraHandlerClientSide(t,e)||this._cameraHandlerServerSide(t))}_cameraHandlerClientSide(e,t){const r=Object(ka.f)(this._view.spatialReference);if(r&&!Object(C.a)(this._view.spatialReference))return!1;const i=e.position;return Object(b.i)(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=Object(S.e)()),r?Object(C.v)(i,this._referencePosWGS84Comparable):Object(Cl.y)(this._referencePosWGS84Comparable,i.longitude,i.latitude,i.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLightParams(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLightParams(e){const t=this._view.environment.lighting;e=e||t.date;const r=this._view._stage;let i;Object(b.j)(this._referencePosWGS84Comparable)?(i=Jc(e,this._referencePosWGS84Comparable),Yc(e,this._referencePosWGS84Comparable,this._view.viewingMode,i.diffuse.directionToLightSource)):i={diffuse:{color:[1,1,1],intensity:.55,directionToLightSource:su},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0},Object(Cl.g)(this._mainLight.intensity,i.diffuse.color,i.diffuse.intensity*Math.PI),Object(Cl.m)(this._mainLight.direction,i.diffuse.directionToLightSource),Object(Cl.g)(this._ambientLight.intensity,i.ambient.color,i.ambient.intensity),Object(Cl.k)(this._moonLight.intensity,cu,uu,i.globalFactor);const n=(1-.5*i.globalFactor)*(1-.4*i.noonFactor*(1-i.globalFactor));Object(Cl.g)(this._moonLight.intensity,this._moonLight.intensity,n),Object(Cl.m)(this._moonLight.direction,i.diffuse.directionToLightSource),r.renderView.updateLightSources([this._mainLight,this._ambientLight,this._moonLight],1-i.noonFactor,i.globalFactor),this._updateRenderParamsHandler()}_autoUpdateTimezone(e,t=null){if(!this._view.environment.lighting.cameraTrackingEnabled||Object(b.i)(e))return!1;const r=ou;r.setTime((t||this._view.environment.lighting.date).getTime());const i=Object($c.c)(e,lu);if(Object(b.i)(i))return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===i.hours&&n.minutes===i.minutes&&n.seconds===i.seconds)return!1}else n=i;const s=r.getUTCHours()-(i.hours-n.hours),a=r.getUTCMinutes()-(i.minutes-n.minutes),o=r.getUTCSeconds()-(i.seconds-n.seconds);return r.setUTCHours(s),r.setUTCMinutes(a),r.setUTCSeconds(o),!t&&this._view.environment.lighting.autoUpdate(r,i)}_updateRenderParamsHandler(){const e=this._view._stage;if(!e)return;const t=Object(b.m)(this._referencePosWGS84Comparable,!0,(e=>function(e,t){if("global"===t)return!0;{const t=Xc.planarDirection,r=e[2];return Math.abs(r)<t.localAltitude}}(e,this._view.viewingMode))),r=this._view.environment.background,i=r instanceof nu.a?{type:"color",color:Object(Ml.d)(Tl.a.toUnitRGBA(r.color))}:{type:"color",color:Object(Ml.g)(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,background:i})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler(null)}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&this._view.stationary)){const e=this._referencePosUpdateQuery=Object(m.a)(this._referencePointUpdateDelay).then((()=>{if(this._referencePosUpdateQuery===e){const t=()=>this._referencePosUpdateQuery!==e;return this._doReferencePositionUpdateQuery(t)}})).catch((e=>{"mapcoordshelper:missing-geometry-service"===e.name&&(this.disableQueries=!0)})).then((()=>{this._referencePosUpdateQuery===e&&(this._referencePosUpdateQuery=null,this.referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))})),t=this.referencePosUpdateTimer=Object(m.a)(this._referencePointUpdateInterval).then((()=>{this.referencePosUpdateTimer===t&&(this.referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())}));this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const e=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=e):this._referencePosWGS84Comparable=[t[0],t[1],e],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this.referencePosUpdateTimer=null,e}get test(){const e=this;return{renderer:this._renderer,set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e.referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t}}}};au.FIXED_LIGHT_DIRECTION=su,Object(i.a)([Object(j.b)({type:Boolean,readOnly:!0})],au.prototype,"updating",null),Object(i.a)([Object(j.b)()],au.prototype,"disableQueries",void 0),Object(i.a)([Object(j.b)()],au.prototype,"referencePositionWGS84Comparable",null),Object(i.a)([Object(j.b)()],au.prototype,"_renderer",void 0),Object(i.a)([Object(j.b)()],au.prototype,"_referencePosWGS84Comparable",void 0),au=Object(i.a)([Object(w.a)("esri.views.3d.environment.SceneViewEnvironmentManager")],au);const ou=new Date,lu={hours:0,minutes:0,seconds:0},cu=Object(S.g)(.22,.22,.33),uu=Object(S.g)(.22,.22,.22);var du=au,hu=r(60),pu=r(55),fu=r(64);function bu(e,t){return 0!=(e&t)}function mu(e,t,r,i,n,s){0!==e&&(r?(s.min=Math.min(s.min,t),s.max=Math.max(s.max,t)):null!=i?(s.min-=Math.max(0,(t-s.min)*(1-i)),s.max+=Math.max(0,(t-s.max)*(1-i))):n&&(s.min-=Math.max(0,t-s.min-n),s.max+=Math.max(0,t-s.max-n)))}const gu={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};function yu(e,t,r,i){return t=t||e.viewForward,Object(Cl.m)(i,t),Object(Cl.g)(i,i,Object(Bt.t)(Object(Cl.j)(t,r))),i}var vu=r(514);function Ou(e,t,r=gu){if(!function(e,t){const r=e.state.constraints.altitude;return!(!e.state.isGlobal||!r)&&(2!==t.interactionType||!bu(t.selection,1))}(e,r))return 0;const i=function(e,t){return t.min=e.min,t.max=e.max,t}(e.state.constraints.altitude,ju);!function(e,t,r){const i=t.interactionType;if(0===i)return;const{min:n,max:s}=r,{interactionStartCamera:a,interactionFactor:o}=t,l=2===i||1===i,c=Ou(e,a),u=0===c?0:e.renderCoordsHelper.getAltitude(a.eye);r.min=n,r.max=s,mu(c,u,l,o,.05*u,r)}(e,r,i);const n=e.renderCoordsHelper.getAltitude(t.eye),s=Object(Bt.e)(n,i.min,i.max)-n;return Math.abs(s)<=1e-6?0:s}const ju={min:0,max:0},_u=Object(S.e)(),wu=Object(S.e)(),xu=Object(S.e)(),Su=Object(S.e)();function Tu(e,t,r=gu){if(!e.state.isLocal)return 0;const i=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;Mu.min=0,Mu.max=i,function(e,t,r){const i=t.interactionType;if(0===i)return;const{min:n,max:s}=r,{interactionStartCamera:a,interactionFactor:o}=t,l=1===i||4===i,c=Tu(e,a),u=0===c?0:Cu(e,a);r.min=n,r.max=s,mu(c,u,l,o,.05*u,r)}(e,r,Mu);const n=Cu(e,t),s=Mu.max-n;return s>=-1e-6?0:s}function Cu(e,t){const r=e.pointsOfInterest.surfaceOrigin;return Object(Cl.o)(t.eye,r.renderLocation)}const Mu={min:0,max:0},Pu=Object(S.e)(),Au=Object(S.e)(),Eu=Object(S.e)(),Ru=Object(S.e)(),Iu=Object(S.e)();var Du=r(162);function Fu(e,t,r=0){const i=e.state.constraints;if(!i.collision.enabled)return!1;const n=Object(Du.c)(e,t.eye),s=e.renderCoordsHelper.getAltitude(t.eye),a=n+i.collision.elevationMargin;if(s>=a)return!1;const o=Object(Cl.r)(t.eye);if(Object(Cl.l)(Lu,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(ku,a,t.eye),1===r)t.center=Object(Cl.h)(Lu,t.eye,Lu);else if(2===r){const e=(o-s+a)/o;t.center=Object(Cl.g)(Lu,t.center,e)}return!0}const Lu=Object(S.e)(),ku=Object(S.e)();var zu=r(120);function Vu(e,t,r){e.worldUpAtPosition(t,Nu),Object(Cl.l)(Uu,r,t);const i=Object(Cl.r)(Uu);return 0===i?0:Object(Bt.b)(Object(Cl.j)(Uu,Nu)/i)}const Nu=Object(S.e)(),Uu=Object(S.e)();function Bu(e,t,r=gu,i=gu,n){if(!e.state.constraints.tilt)return 0;const s=t.distance,a=e.state.constraints.tilt(s,Xu);return function(e,t,r){if(0===t.interactionType)return;const{interactionStartCamera:i,interactionFactor:n}=t,{min:s,max:a}=r,o=Bu(e,i,gu,t),l=0===o?0:Vu(e.renderCoordsHelper,i.center,i.eye);r.min=s,r.max=a,2===t.interactionType?(bu(t.selection,2)&&Hu(e,i,r),mu(o,l,!0,n,Zu,r)):mu(o,l,!1,n,Zu,r)}(e,r,a),2===i.interactionType&&bu(i.selection,2)&&Hu(e,i.interactionStartCamera,a),1===r.tiltMode||1===i.tiltMode?function(e,t,r,i){switch(i&&(i.requiresTwoSteps=!1),e.viewingMode){case"global":return function(e,t,r,i){const n=function(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=i+Object(M.e)(e.spatialReference).radius,s=e.renderCoordsHelper.intersectManifold(t.ray,i,Qu);return r.eyeCenterDistance=t.distance,r.centerIsOnSurface=!1,Object(b.j)(s)?(r.eyeCenterDistance=Object(Cl.o)(t.eye,s),r.tiltAtCenter=Vu(e.renderCoordsHelper,s,t.eye),r.centerIsOnSurface=!0):e.state.isLocal?r.tiltAtCenter=Vu(e.renderCoordsHelper,t.center,t.eye):(Object(pu.b)(Object(pu.e)(n),t.ray,Qu),r.eyeCenterDistance=Object(Cl.o)(t.eye,Qu),r.tiltAtCenter=Object(Bt.b)(-Object(Cl.j)(t.viewForward,Object(Cl.t)(Qu,Qu)))),r.radius=n,r.eyeRadius=Object(Cl.r)(t.eye),r.constraints=e.state.constraints,r}(e,t,Ju),s=Object(Bt.e)(n.tiltAtCenter,r.min,r.max);if(!Gu(n.tiltAtCenter-s))return 0;let a,o;return n.centerIsOnSurface?(a=function(e){const{constraints:t,eyeCenterDistance:r,tiltAtCenter:i}=e;let n=i,s=t.clampTilt(r,i);const a=qu(e,s);if(t.clampTilt(a,i)===s)return s;let o=0;for(;o<10&&Gu(s-n);){const r=(n+s)/2,i=qu(e,r);Gu(t.clampTilt(i,r)-r)?n=r:s=r,o++}return s}(n),o=function(e,t){const r=Object(Bt.c)(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),i=Object(Bt.c)(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?r-i:i-r}(n,a)):(a=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),i&&a<Math.PI/2&&(i.requiresTwoSteps=!0,a=Math.PI/2-1e-5),o=function(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}(n,a)),i&&(i.eyeCenterDistance=qu(n,a)),o}(e,t,r,i);case"local":return function(e,t,r,i){const n=Vu(e.renderCoordsHelper,t.center,t.eye),s=Object(Bt.e)(n,r.min,r.max),a=n-s;if(!Gu(a))return 0;if(i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=e.renderCoordsHelper.getAltitude(t.eye)-r,a=Math.cos(s);Math.abs(a)>1e-4?i.eyeCenterDistance=n/a:i.eyeCenterDistance=t.distance}return a}(e,t,r,i);default:return void Object(zu.a)(e.viewingMode)}}(e,t,a,n):function(e,t,r){const i=Vu(e.renderCoordsHelper,t.center,t.eye),n=i-Object(Bt.e)(i,r.min,r.max);return Gu(n)?n:0}(e,t,a)}function Gu(e){return Math.abs(e)>1e-9}function qu(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const r=Math.PI-Object(Bt.e)(t,0,Math.PI),i=Object(Bt.c)(e.radius/e.eyeRadius*Math.sin(r)),n=Math.PI-r-i,s=Math.sin(n)/Math.sin(r);if(e.eyeRadius<e.radius&&s>1){const t=Math.PI-i,n=Math.PI-r-t;return Math.sin(n)/Math.sin(r)*e.eyeRadius}return s*e.eyeRadius}function Hu(e,t,r){if(e.state.isLocal)return;const i=e.state.constraints;if(!i.altitude)return;const n=Object(Cl.v)(t.center),s=Math.sqrt(n),a=t.distance,o=Object(M.e)(e.spatialReference).radius,l=i.altitude.min+o,c=i.altitude.max+o,u=(l*l-a*a-n)/(-2*s*a),d=(c*c-a*a-n)/(-2*s*a);r.min=Math.max(r.min,Math.min(Math.PI-Object(Bt.b)(d),r.max)),r.max=Math.min(r.max,Math.PI-Object(Bt.b)(u))}const Wu=Object(S.e)(),$u=Object(Al.d)(),Qu=Object(S.e)(),Zu=Object(Bt.g)(5),Xu={min:0,max:0},Ju={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},Yu={eyeCenterDistance:0,requiresTwoSteps:!1};const Ku=e=>e*e,ed=e=>1-Ku(1-e),td=e=>e*e*e,rd=e=>1-td(1-e),id=e=>e<.5?td(2*e)/2:(rd(2*(e-.5))+1)/2,nd=e=>e*e*e*e,sd=e=>1-nd(1-e),ad=e=>e*e*e*e*e,od=e=>1-ad(1-e),ld=e=>1-Math.cos(e*Math.PI/2),cd=e=>1-ld(1-e),ud=e=>2**(10*(e-1)),dd=e=>1-ud(1-e),hd=e=>-(Math.sqrt(1-e*e)-1),pd=e=>1-hd(1-e);function fd(e){const t=2*(e-Math.sqrt((e-1)*e)),r=t/2/e;return i=>i<r?e*i*i:t*i-t+1}function bd(e,t){return(r,i)=>r<t?t*e(r/t,i):1-e((1-r)/(1-t),i)*(1-t)}const md=bd(fd(1),1),gd=bd(fd(1),0),yd=bd(fd(1),.5),vd=bd(fd(2),1),Od=bd(fd(2),0),jd=bd(fd(2),.5),_d=bd(fd(3),1),wd=bd(fd(3),0),xd=bd(fd(3),.5),Sd=bd(fd(4),1),Td=bd(fd(4),0),Cd=bd(fd(4),.5),Md={linear:function(e){return e},"in-quad":Ku,"out-quad":ed,"in-out-quad":e=>e<.5?Ku(2*e)/2:(ed(2*(e-.5))+1)/2,"in-coast-quad":md,"out-coast-quad":gd,"in-out-coast-quad":yd,"in-cubic":td,"out-cubic":rd,"in-out-cubic":id,"in-coast-cubic":vd,"out-coast-cubic":Od,"in-out-coast-cubic":jd,"in-quart":nd,"out-quart":sd,"in-out-quart":e=>e<.5?nd(2*e)/2:(sd(2*(e-.5))+1)/2,"in-coast-quart":_d,"out-coast-quart":wd,"in-out-coast-quart":xd,"in-quint":ad,"out-quint":od,"in-out-quint":e=>e<.5?ad(2*e)/2:(od(2*(e-.5))+1)/2,"in-coast-quint":Sd,"out-coast-quint":Td,"in-out-coast-quint":Cd,"in-sine":ld,"out-sine":cd,"in-out-sine":e=>e<.5?ld(2*e)/2:(cd(2*(e-.5))+1)/2,"in-expo":ud,"out-expo":dd,"in-out-expo":e=>e<.5?ud(2*e)/2:(dd(2*(e-.5))+1)/2,"in-circ":hd,"out-circ":pd,"in-out-circ":e=>e<.5?hd(2*e)/2:(pd(2*(e-.5))+1)/2};function Pd(e,t,r=Rd,i=t){let n=!1;i!==t&&i.copyFrom(t),i.computeUp(e.state.viewingMode);for(let o=0;o<Id;o++){let t=0;for(const s of Ed)if(bu(r.selection,s.type)){const a=Math.abs(s.error(e,i,r));s.apply(e,i,r)&&(n=!0,t+=a)}if(0===t)break}const s=bu(r.selection,8),a=function(e,t){switch(e){case 4:return 1;case 5:return t.state.isGlobal?2:1;default:return 0}}(r.interactionType,e);return s&&Fu(e,i,a)&&(n=!0),n&&i.computeUp(e.state.viewingMode),n}function Ad(e,t){const r="number"==typeof e?e:Object(ec.d)(e,t),i=Math.min(1,r/150);return id(i)}const Ed=[{type:1,error:function(e,t,r){return Bu(e,t,r)*t.distance},apply:function e(t,r,i=gu,n=!0){Yu.eyeCenterDistance=0,Yu.requiresTwoSteps=!1;const s=Bu(t,r,i,void 0,Yu);if(0===s)return!1;switch(Object(Pl.i)($u),Object(Pl.c)($u,$u,-s,r.viewRight),i.tiltMode){case 1:Object(Cl.s)(Wu,r.viewForward,$u),Object(Cl.g)(Wu,Wu,Yu.eyeCenterDistance),r.center=Object(Cl.h)(Qu,r.eye,Wu);break;case 0:Object(Cl.l)(Wu,r.center,r.eye),Object(Cl.s)(Wu,Wu,$u),r.eye=Object(Cl.l)(Qu,r.center,Wu);break;default:Object(zu.a)(i.tiltMode)}return r.up=Object(Cl.s)(Qu,r.up,$u),!Yu.requiresTwoSteps||!n||e(t,r,i,!1)}},{type:2,error:Ou,apply:function(e,t,r=gu){const i=Ou(e,t,r);if(0===i)return!1;const n=e.renderCoordsHelper,s=n.getAltitude(t.eye)+i,a=yu(t,r.interactionDirection,function(e,t,r,i){return e.renderCoordsHelper.worldUpAtPosition(t.eye,i),Object(Cl.g)(i,i,r),i}(e,t,Object(Bt.t)(i),wu),_u),o=Object(Cl.m)(xu,t.viewForward),l=n.intersectInfiniteManifold(Object(fu.g)(t.eye,a),s,Su);return t.eye=Object(b.j)(l)?l:n.setAltitude(Su,s,t.eye),t.center=Object(vu.a)(Su,t.eye,o,t.center),!0}},{type:4,error:Tu,apply:function(e,t,r=gu){const i=Tu(e,t,r);if(0===i)return!1;const n=e.pointsOfInterest.surfaceOrigin,s=Cu(e,t)+i,a=Object(Cl.m)(Pu,t.eye),o=yu(t,r.interactionDirection,function(e,t,r){const i=e.pointsOfInterest.surfaceOrigin;return Object(Cl.x)(r,t.eye,i.renderLocation)}(e,t,Ru),Eu);if(!Object(pu.i)(Object(pu.k)(n.renderLocation,s),Object(fu.g)(t.eye,o),Iu))return!1;t.eye=Iu;const l=Object(Cl.l)(Au,t.eye,a);t.center=Object(Cl.h)(Iu,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),u=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,Iu);return Object(b.j)(u)&&(t.center=u),!0}}],Rd={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},Id=5;var Dd=r(52),Fd=r(83);const Ld=Object(S.e)(),kd=Object(S.e)(),zd=Object(S.e)(),Vd=Object(S.e)(),Nd=Object(S.e)(),Ud=Object(S.e)(),Bd={upward:Object(S.g)(0,0,1),forward:Object(S.g)(0,1,0),sideway:Object(S.g)(1,0,0)},Gd=Object(Fd.b)();var qd=class{constructor(e=1){this.viewingMode=e,this.center=Object(S.e)(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Object(S.c)(Bd.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,t){if(t||(t={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),1===this.viewingMode){const r=(Object(Cl.r)(this.center)+Object(Cl.r)(e.center))/2;t.pan=Object(Xo.b)(this.center,e.center)*r}else t.pan=Object(Cl.o)(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const i=Math.abs(e.pitch-this.pitch);return t.rotate=Math.max(r,i),t.sourceZoom=this.distance,t.targetZoom=e.distance,t}interpolate(e,t,r){1===this.viewingMode?Object(Xo.m)(e.center,t.center,r.pan,this.center):Object(Cl.k)(this.center,e.center,t.center,r.pan),this.distance=Object(Bt.m)(e.distance,t.distance,r.zoom),this.pitch=Object(Bt.m)(e.pitch,t.pitch,r.rotate);let i=e.yaw;const n=t.yaw;Math.abs(n-i)>=Math.PI&&(i+=2*(i<n?1:-1)*Math.PI),this.yaw=Object(Bt.m)(i,n,r.rotate)}copyFrom(e){Object(Cl.m)(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,Object(Cl.m)(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const t=this._lookAtOrientation(e.center,Gd);Object(Cl.m)(this.center,e.center),Object(Cl.l)(Vd,e.center,e.eye),Object(Cl.z)(Vd,Vd,t),Object(Cl.z)(Nd,e.up,t),this.distance=Object(Cl.r)(Vd),Vd[0]/=this.distance,Vd[1]/=this.distance,Vd[2]/=this.distance,this.pitch=this._eyeUpToPitch(Vd),this.yaw=this._eyeUpToYaw(Vd,Nd),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const t=this._lookAtOrientation(this.center,Gd);Object(Dd.n)(t,t),this._axisAngleVec3(Bd.sideway,this.pitch-Math.PI/2,Bd.forward,Vd),this._axisAngleVec3(Bd.upward,this.yaw,Vd),this._axisAngleVec3(Bd.sideway,this.pitch-Math.PI/2,Bd.upward,Nd),this._axisAngleVec3(Bd.upward,this.yaw,Nd),Object(Cl.g)(Vd,Vd,this.distance),Object(Cl.z)(Vd,Vd,t),Object(Cl.z)(Nd,Nd,t),e.center=this.center,e.eye=Object(Cl.l)(Vd,this.center,Vd),e.up=Nd}_axisAngleVec3(e,t,r,i=r){const n=Math.cos(t),s=Math.sin(t);return Object(Cl.g)(Ld,r,n),Object(Cl.i)(kd,e,r),Object(Cl.g)(kd,kd,s),Object(Cl.g)(zd,e,(1-n)*Object(Cl.j)(e,r)),Object(Cl.h)(i,Object(Cl.h)(i,Ld,kd),zd)}_lookAtOrientation(e,t=Object(Fd.b)()){return this._upAtLookAt(e,zd),Object(Cl.i)(Ld,this.lookAtDirection,zd),Object(Cl.t)(Ld,Ld),0===Ld[0]&&0===Ld[1]&&0===Ld[2]&&Object(Cl.m)(Ld,Bd.sideway),Object(Cl.i)(kd,zd,Ld),Object(Cl.t)(kd,kd),t[0]=Ld[0],t[1]=kd[0],t[2]=zd[0],t[3]=Ld[1],t[4]=kd[1],t[5]=zd[1],t[6]=Ld[2],t[7]=kd[2],t[8]=zd[2],t}_upAtLookAt(e,t){return 2===this.viewingMode?Object(Cl.m)(t,Bd.upward):Object(Cl.t)(t,e)}_eyeUpToPitch(e){return Math.PI-Object(Xo.b)(Bd.upward,e)}_eyeUpToYaw(e,t){const r=Ud;return Math.abs(t[2])<.5?(Object(Cl.m)(r,t),e[2]>0&&Object(Cl.g)(r,r,-1)):Object(Cl.m)(r,e),Object(Cl.i)(kd,r,Bd.upward),Object(Cl.t)(kd,kd),Object(Xo.b)(Bd.sideway,kd,Bd.upward)}},Hd=r(72);const Wd=2,$d=Object(hu.a)(500),Qd=Object(hu.a)(8e3);class Zd{constructor(e){this.createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:Wd},this.source=e(),this.target=e()}clone(){const e=new Zd(this.createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,t,r){this.source!==e&&this.source.copyFrom(e),this.target!==t&&this.target.copyFrom(t),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=null!=r.desiredScreenFlow?r.desiredScreenFlow:Wd,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class Xd{constructor(){this.segments=[]}get time(){return this.segments.reduce(((e,t)=>Object(hu.c)(e+t.time)),Object(hu.c)(0))}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,i=0;const n=this.definition;for(let s=0;s<this.segments.length;s++){const a=this.segments[s],o=a.definition;if(e<=a.time||s===this.segments.length-1){t=this.segmentInterpolateComponentsAt(a,e/a.time,t),n.hasPan?t.pan=(r+o.compared.pan*t.pan)/n.compared.pan:t.pan=1,n.hasRotate?t.rotate=(i+o.compared.rotate*t.rotate)/n.compared.rotate:t.rotate=1;const s=t.zoom*(o.compared.targetZoom-o.compared.sourceZoom)+o.compared.sourceZoom,l=this.segments[0].definition.compared.sourceZoom,c=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?t.zoom=(s-l)/(c-l):t.zoom=1,t}e-=a.time,r+=o.compared.pan,i+=o.compared.rotate}}segmentInterpolateComponentsAt(e,t,r){return e.interpolateComponentsAt(t,r)}}class Jd{constructor(e){e&&this.update(e)}get time(){return this._time}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,t=e.compared,r=t.sourceZoom,i=t.targetZoom;this._zoomSign=r>i?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(i))/2;this._rotatePixels=t.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,{hasZoom:r,hasPan:i,hasRotate:n}=this.definition;let s=0,a=0;r&&(i&&(s=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const o=this.definition.desiredPixelFlow;if(r&&i&&n){const e=s+a+s*a;this._zoomPixelFlow=s*a/e*o,this._panPixelFlow=a/e*o,this._rotatePixelFlow=s/e*o}else if(r&&i){const e=1+s;this._zoomPixelFlow=s/e*o,this._panPixelFlow=1/e*o}else if(r&&n){const e=1+a;this._zoomPixelFlow=a/e*o,this._rotatePixelFlow=1/e*o}else if(i&&n){const e=this._panPixelsAtSource/this._rotatePixels,t=1+e;this._panPixelFlow=e/t*o,this._rotatePixelFlow=1/t*o}else i?this._panPixelFlow=o:r?this._zoomPixelFlow=o:n&&(this._rotatePixelFlow=o);this._time=n?this.rotateTime:r?this.zoomTime:i?this.panTime:Object(hu.c)(0)}get rotateTime(){return this.definition.hasRotate?Object(hu.c)(this._rotatePixels/this._rotatePixelFlow):Object(hu.c)(0)}get zoomTime(){return this.definition.hasZoom?Object(hu.c)(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):Object(hu.c)(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return Object(hu.c)(Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return Object(hu.c)(this._panPixelsAtSource/this._panPixelFlow)}return Object(hu.c)(0)}_interpolateComponentsZoom(e){if(0===e||1===e)return e;if(this.definition.hasZoom){const t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(t*(t/r)**-e-t)/(r-t)}return e}_interpolateComponentsPan(e){if(0===e||1===e)return e;if(this.definition.hasPan&&this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(t*e*this._time)-1))/(t*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),i=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return t?(t.zoom=r,t.pan=i,t.rotate=n):t={zoom:r,pan:i,rotate:n},t}}function Yd(e,t,r){const i=t-e.compared.sourceZoom,n=e.halfWindowPanAtZoom(i);return-e.halfWindowSize*(r.ascensionFactor*Math.LN2*e.compared.pan+n)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*n)}function Kd(e,t,r){const i=1/t,n=Math.log(e.compared.sourceZoom*i),s=1/e.desiredPixelFlow,a=1/Math.LN2,o=t-e.compared.sourceZoom,l=1/o,c=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(o))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*i*s*a*l*c-e.halfWindowSize*n*s*a*l+e.halfWindowSize*n*s*a*c/(o*o)}function eh(e,t,r){const i=t-e.compared.sourceZoom,n=1/i,s=1/t,a=Math.log(e.compared.sourceZoom*s),o=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(i))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*o+2*n*a+2*s-2*a*o/(i*i)-o/(t*t))/(e.desiredPixelFlow*Math.LN2)}function th(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function rh(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function ih(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function nh(e,t,r){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function sh(e,t,r){const i=Math.log(t/e.compared.targetZoom),n=1/e.desiredPixelFlow,s=1/Math.LN2,a=-t+e.compared.targetZoom,o=1/a,l=(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*i*n*s*o+e.halfWindowSize*i*n*s*l/(a*a)+e.halfWindowSize*n*s*o*l/t}function ah(e,t,r){const i=t-e.compared.targetZoom,n=1/i,s=1/t,a=Math.log(t/e.compared.targetZoom),o=(e.halfWindowPanAtZoom(t)+r.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*o-2*n*a+2*s+2*a*o/(i*i)-o/(t*t))/(e.desiredPixelFlow*Math.LN2)}function oh(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function lh(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function ch(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function uh(e,t){let r=function(e,t){const r=Math.max(e.compared.sourceZoom,e.compared.targetZoom),i=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return i<r?null!=t.maximumDistance?r+(t.maximumDistance-r)/2:1.5*r:t.maximumDistance?Math.min(t.maximumDistance,i):i}(e,t);const i={ascensionFactor:null!=t.ascensionFactor?t.ascensionFactor:.5,descensionFactor:null!=t.descensionFactor?t.descensionFactor:.5},n=0===i.ascensionFactor,s=0===i.descensionFactor,a=n?th:Yd,o=n?rh:Kd,l=n?ih:eh,c=s?oh:nh,u=s?lh:sh,d=s?ch:ah,h=t=>a(e,t,i)+function(e,t,r){return-e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}(e,t,i)+c(e,t,i),p=t=>o(e,t,i)+function(e,t,r){return e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}(e,t,i)+u(e,t,i),f=t=>l(e,t,i)+function(e,t,r){return-2*e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}(e,t,i)+d(e,t,i);let b=h(r);const m=function(e){const t=Math.LN2*e.compared.pan,r=e.compared.sourceZoom-e.compared.targetZoom,i=e.halfWindowPanAtZoom(r),n=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*i);return e.compared.sourceZoom<=e.compared.targetZoom?n*(t-i):n*(t+i)}(e);let g;const y=t.maximumIterations||20,v=null!=t.maximumDistance?t.maximumDistance:1/0;for(g=0;g<y;g++){const t=1e-6,i=(p(r)+t)/f(r);if(isNaN(i)||r>=v&&i<0){if(!isFinite(v))return null;r=v,b=h(r);break}if(r-=i,r<e.compared.sourceZoom||r<e.compared.targetZoom)return null;const n=h(r);if(Math.abs(n-b)/b<=.005)break;b=n}return b>.7*m||r<e.compared.sourceZoom||r<e.compared.targetZoom?null:r}class dh extends Xd{constructor(e,t){super(),this._preallocSegments=[new Jd,new Jd,new Jd],this.update(e,t)}update(e,t){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;t&&t.apex&&(r=uh(e,t.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,null==r?this._updateWithoutApex():this._updateWithApex(r,t.apex)}segmentInterpolateComponentsAt(e,t,r){return r=e.interpolateComponentsAt(t,r),e===this._ascensionSegment?r.zoom=ed(r.zoom):e===this._descensionSegment&&(r.zoom=Ku(r.zoom)),r}_updateWithApex(e,t){const[r,i,n]=this._preallocSegments,s=null!=t.ascensionFactor?t.ascensionFactor:.5,a=Math.min(1-s,null!=t.ascensionFactor?t.descensionFactor:.5),o=1-s-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*s,r.definition.compared.rotate=this.definition.compared.rotate*s,r.update(),this._ascensionSegment=r,this.segments.push(r),o>0&&(i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.copyFrom(this.definition),i.definition.compared.sourceZoom=e,i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this.segments.push(i)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}}const hh={zoom:0,pan:0,rotate:0};class ph{constructor(e){this.createCamera=e,this._time=Object(hu.a)(0),this.definition=new Zd(e),this.path=new dh}get time(){return this._time}update(e,t,r){this.definition.update(e,t,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(Object(hu.b)(this.path.time),r),this._easing=r.easing?r.easing:this._time>=1e3?yd:dd}cameraAt(e,t){t=t||this.createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,hh);return t.interpolate(this.definition.source,this.definition.target,r),t}_normalizedEasing(e){const t=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(r-t)}_applyTimeSettings(e,t){const r=null!=t.speedFactor?t.speedFactor:1;null!=t.duration?e=t.duration:null!=t.speedFactor&&(e=Object(hu.a)(e/r));const i=null!=t.minDuration?t.minDuration:$d/r,n=null!=t.maxDuration?t.maxDuration:Qd/r;return Object(hu.a)(Math.min(Math.max(i,e),n))}}const fh=Object(S.e)();class bh{constructor(e){this.currentTime=Object(hu.a)(0),this._animation=new ph((()=>new qd(e))),this._current=new qd(e)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(e,t,r){const i=this._animation.definition.source,n=this._animation.definition.target,s=Object(Cl.l)(fh,t.center,e.center),a=Object(Cl.r)(s);a>=1e-5?(s[0]/=a,s[1]/=a,s[2]/=a):(s[0]=0,s[1]=1,s[0]=0),Object(Cl.m)(i.lookAtDirection,s),Object(Cl.m)(n.lookAtDirection,s),i.copyFromRenderCamera(e),n.copyFromRenderCamera(t),this._current.copyFrom(i),this._animation.update(i,n,r),this.currentTime=Object(hu.a)(0),e.almostEquals(t)&&(this.currentTime=this._animation.time)}cameraAt(e,t){return this._animation.cameraAt(e,this._current),t=t||new Hd.a,this._current.copyToRenderCamera(t),t}step(e,t){return this.finished||(this.currentTime=Object(hu.a)(this.currentTime+Object(hu.b)(e)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,t)}}var mh,gh;(gh=mh||(mh={})).Ready="ready",gh.Rejected="rejected",gh.Running="running",gh.Stopped="stopped",gh.Finished="finished";let yh=class extends N.a{constructor(){super(...arguments),this.state=mh.Ready}get active(){return this.state===mh.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=mh.Stopped,!0)}finishController(){this.state=mh.Finished}get steppingFinished(){return!1}};Object(i.a)([Object(j.b)({readOnly:!0})],yh.prototype,"active",null),Object(i.a)([Object(j.b)()],yh.prototype,"state",void 0),yh=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.CameraController")],yh);let vh=class extends yh{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Object(m.f)()),this._asyncResult=null),this.state===mh.Finished||this.state===mh.Stopped?this.state===mh.Finished?e.resolve():e.reject(Object(m.f)()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=mh.Running,Object(b.j)(this.viewAnimation)&&this.viewAnimation.when((()=>this.updateStateFromViewAnimation()),(()=>this.updateStateFromViewAnimation()))}updateStateFromViewAnimation(){!Object(b.j)(this.viewAnimation)||this.state!==mh.Ready&&this.state!==mh.Running||(this.viewAnimation.state===Uo.State.FINISHED?this.finish():this.viewAnimation.state===Uo.State.STOPPED&&(this.state=mh.Stopped))}onControllerEnd(){Object(b.j)(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===mh.Finished?this.viewAnimation.finish():this.state===mh.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===mh.Finished?this._asyncResult.resolve():this._asyncResult.reject(Object(m.f)()))}finish(){this.finishController()}};vh=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.AnimationController")],vh);var Oh=r(131);let jh=class extends vh{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new bh(this.view.state.viewingMode),this.viewAnimation="interaction"===this.mode?null:new Uo}get isInteractive(){return"interaction"===this.mode}begin(e,t){this.hasTarget=!0;const r=this.animationSettings(t);_h.copyFrom(this.view.state.camera);const i=new Oh.a(this.view.state.viewingMode);this.intersectionHelper.intersectRay(_h.ray,i,wh)&&(_h.center=wh),this.animation.update(_h,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:"string"==typeof e.easing?Md[e.easing]:e.easing}}};Object(i.a)([Object(j.b)({constructOnly:!0})],jh.prototype,"view",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],jh.prototype,"mode",void 0),jh=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.PointToPointAnimationController")],jh);const _h=new Hd.a,wh=Object(S.e)();var xh=r(182),Sh=r(185),Th=r(198),Ch=r(34);function Mh(e=Rh){return[e[0],e[1],e[2],e[3]]}function Ph(e,t){return Ah(e[0],e[1],e[2],t,Ch.d.get())}function Ah(e,t,r,i,n=Mh()){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Eh(e,t,r=Mh()){return Object(Cl.i)(r,e,t),Object(Cl.t)(r,r),r[3]=Object(Th.a)(e,t),r}const Rh=[0,0,1,0];Object(Sh.b)(),Object(Sh.b)();function Ih(e,t,r=function(e){return{operations:e,value:e.create()}}(e)){return r.operations=e,e.copy(t,r.value),r}const Dh=2**50;function Fh(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}function Lh(e,t,r){return e.operations.elevate(e.value,t,r.value)}const kh=Object(S.e)();function zh(e,t,r,i,n){return n[0]=Object(Cl.j)(e,t),n[1]=Object(Cl.j)(e,r),n[2]=Object(Cl.j)(e,i),n}function Vh(e,t,r,i,n){Object(Cl.m)(r,e),Object(Cl.m)(Nh,t),Object(Cl.t)(Nh,Nh),Object(Cl.i)(i,Nh,r),Object(Cl.i)(n,i,r)}const Nh=Object(S.e)();var Uh=r(26),Bh=r(196);function Gh(e,t,r,i){const n=Object(Bh.d)(t,r,qh);return Object(pu.i)(e,n,i)}const qh=Object(fu.c)();function Hh(e,t,r){return r[0]=t[0]/(e.fullWidth/e.pixelRatio),r[1]=t[1]/(e.fullHeight/e.pixelRatio),r}function Wh(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function $h(e,t,r){const i=Ch.a.get();Object(Pl.i)(i),Object(Pl.c)(i,i,r[3],r),Object(Cl.l)(zp,e.eye,t),Object(Cl.s)(zp,zp,i),e.eye=Object(Cl.h)(zp,zp,t),Object(Cl.l)(zp,e.center,t),Object(Cl.s)(zp,zp,i),e.center=Object(Cl.h)(zp,zp,t),e.up=Object(Cl.s)(zp,e.up,i)}function Qh(e,t,r,i){return Object(Uh.m)(e,Object(Bh.c)(t,r,Gp),i)}function Zh(e,t,r,i){const n=Ch.c.get();let s=1-r;Object(Cl.l)(n,t,e.eye);const a=Object(Cl.r)(n);let o=a*(1-s);s>=0&&o<i&&(o=i,s=-(o-a)/a),Math.abs(a-o)<1e-6||(Object(Cl.g)(n,n,s),e.eye=Object(Cl.h)(zp,e.eye,n),e.center=Object(Cl.k)(zp,e.center,t,s))}function Xh(e,t,r){t.getScreenCenter(Jh),Gh(e,t,Jh,zp)&&(t.center=zp);const i=t.distance,n=i*r;if(Math.abs(i-n)<1e-6)return;const s=Object(Cl.g)(Ch.c.get(),t.viewForward,n);t.eye=Object(Cl.l)(zp,t.center,s)}const Jh=Object(O.f)();function Yh(e,t){Object(Cl.y)(t,0,0,0);for(const r of e)Object(Cl.h)(t,t,r);Object(Cl.g)(t,t,1/e.length)}function Kh(e,t,r,i){return Math.sin(e/Object(Cl.r)(t))*(r+i.radius)}function ep(e,t,r,i){return Kh(Math.PI/2,t,r,i)+(e-Math.PI/2)}var tp;!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(tp||(tp={}));const rp=3e4,ip=Object(Bt.g)(6),np={Pole:.95,Angle:Object(Bt.g)(18),Tilt:45},sp=Object(Bt.g)(80);function ap(e,t,r,i,n){const s=Object(S.e)(),a=Object(pu.c)();let o=!0,l=!0;return e.intersectScreen(r,s)?a[3]=Object(Cl.r)(s):(l=!1,t.aboveGround?a[3]=Math.max(Object(Cl.r)(t.center),.9*n.radius):a[3]=Object(Cl.r)(t.eye)-t.relativeElevation,i?up(a,t,r,s):o=Gh(a,t,r,s)),{sphere:a,scenePickPoint:o?s:null,hasGeometryIntersection:l}}function op(e,t,r,i){return Object(Cl.r)(e.eye)-i.radius>rp?tp.Horizontal:r?(Object(Bh.d)(e,t,qp),-Object(Bt.t)(e.relativeElevation)*(.5*Math.PI+Object(Th.a)(e.eye,qp.direction))<ip?tp.Vertical:tp.Horizontal):tp.Vertical}function lp(e,t,r){Object(Cl.l)(cp,r,t),e.eye=Object(Cl.l)(zp,e.eye,cp),e.center=Object(Cl.l)(zp,e.center,cp)}const cp=Object(S.e)();function up(e,t,r,i){const n=Object(Bh.d)(t,r,Gp);return!Object(b.i)(n)&&(Object(pu.b)(e,n,dp),Object(pu.i)(e,n,i)?!(Object(Cl.n)(dp,n.origin)<Object(Cl.n)(i,n.origin))||(Object(Cl.m)(i,dp),!1):(Object(Cl.l)(hp,t.eye,t.center),Object(Cl.t)(hp,hp),Object(Uh.f)(hp,-Object(Cl.j)(Object(Cl.t)(hp,hp),dp),pp),Object(Uh.m)(pp,n,i),!1))}const dp=Object(S.e)(),hp=Object(S.e)(),pp=Object(Uh.d)();function fp(e,t,r,i,n,s){let a;if(Object(Cl.i)(Up,e,t),Object(Cl.l)(Vp,e,t),Object(Cl.r)(e)<=n||!i.aboveGround){Object(Cl.i)(r,Vp,i.eye);const o=Object(Cl.j)(e,t)/(Object(Cl.r)(e)*Object(Cl.r)(t)),l=Math.cos(Object(Bt.e)(Xo.f.normalize(Object(Bt.g)(s)),0,sp));a=-Object(Bt.b)(o)-Math.max(0,Object(Cl.r)(t)-n)/(l*n)}else Object(Cl.l)(bp,i.eye,i.center),Object(Cl.i)(r,Vp,bp),a=-Object(Cl.r)(Vp)/n;return Object(Cl.t)(r,r),Object(Cl.g)(r,r,Object(Cl.r)(Up)),a}const bp=Object(S.e)();function mp(e,t,r,i){let n,s;const a=Math.cos(Object(Bt.e)(Xo.f.normalize(Object(Bt.g)(i)),0,sp));return n=t>r?-(t-r)/(a*r):t<-r?Math.PI-(t+r)/(a*r):Object(Bt.b)(t/r),s=e>r?-(e-r)/(a*r):e<-r?Math.PI-(e+r)/(a*r):Object(Bt.b)(e/r),(s-n)*r}function gp(e,t,r,i,n,s,a,o,l,c){Object(Cl.i)(Up,e,t),Vh(s.up,s.eye,Cp,Mp,Pp),Vh([0,0,1],s.eye,xp,Sp,Tp),Object(Cl.m)(r,Sp),Object(Cl.m)(i,xp),Object(Cl.t)(r,r),Object(Cl.g)(r,r,Object(Cl.r)(Up)),zh(e,Object(Cl.t)(Mp,Mp),Object(Cl.t)(Pp,Pp),Object(Cl.t)(Cp,Cp),Ap),zh(t,Mp,Pp,Cp,Ep),function(e,t,r,i,n,s,a,o,l,c){const u=mp(e[2],t[2],a[3],l),d=c?mp(e[0],t[0],a[3],180):t[0]-e[0],h=Math.sin(o)*d-Math.cos(o)*u,p=Math.cos(o)*d+Math.sin(o)*u;Object(Cl.t)(zp,n);const f=c?h/Math.sqrt(Math.abs(a[3]**2-Object(Cl.j)(r,zp)**2)):h/a[3],b=p/Math.sqrt(Math.abs(a[3]**2-Object(Cl.j)(r,i)**2));Object(ec.r)(s,f,b)}(Ap,Ep,e,xp,Sp,n,a,o,l,c)}function yp(e,t,r,i,n,s,a){Object(Pl.i)(Dp),Object(Pl.i)(Fp),Object(Pl.i)(Lp),Object(Pl.c)(Dp,Dp,n,i),Object(Pl.c)(Fp,Fp,a,s),Object(Pl.m)(Lp,Dp,Fp),Object(Cl.l)(t,e,r),Object(Cl.s)(t,t,Lp),Object(Cl.h)(t,t,r)}function vp(e,t,r,i,n,s){Object(Pl.i)(Dp),Object(Pl.i)(Fp),Object(Pl.i)(Lp),Object(Pl.c)(Dp,Dp,i,r),Object(Pl.c)(Fp,Fp,s,n),Object(Pl.m)(Lp,Dp,Fp),Object(Cl.l)(zp,e.eye,t),Object(Cl.s)(zp,zp,Lp),e.eye=Object(Cl.h)(zp,zp,t),Object(Cl.l)(zp,e.center,t),Object(Cl.s)(zp,zp,Lp),e.center=Object(Cl.h)(zp,zp,t),Object(Cl.l)(zp,e.up,t),Object(Cl.s)(zp,zp,Lp),e.up=Object(Cl.h)(zp,zp,t)}function Op(e,t,r,i,n,s,a=np.Pole,o=np.Angle){const l=Math.abs(i)>Math.PI-o||Math.abs(i)<o,c=Math.abs(e[2])<r*a||Math.abs(t)>r;return!!(l&&c&&s.aboveGround&&n<np.Tilt)}function jp(e,t,r,i,n,s){if(s)Eh(r,i,Ip),$h(t,e,Ip);else{const s=fp(r,i,Bp,t,e[3],n);$h(t,e,Ph(Bp,s))}}function _p(e,t,r,i,n,s,a){const o=a?20:1;let l,c;Object(Cl.m)(kp,i),Np.copyFrom(t);for(let u=0;u<o&&Object(Cl.n)(r,kp)>1e-12&&(l=Object(Cl.n)(r,kp),gp(r,kp,Sp,xp,Rp,Np,e,n,s,a),vp(Np,e,xp,Rp[1],Sp,Rp[0]),yp(kp,kp,e,xp,Rp[1],Sp,Rp[0]),c=Object(Cl.n)(r,kp),c<l||0===u);u++)t.copyFrom(Np)}function wp(e,t,r,i,n,s,a,o,l){Op(e.center,Object(Cl.j)(e.up,e.center),Object(Cl.r)(e.center),-Xo.f.normalize(Object(Bt.g)(s)),a,t)?function(e,t,r,i,n,s){const{eye:a}=e;Vh([0,0,1],a,xp,Sp,Tp);const o=t.translation[0]*r.pan,l="zoom"===n.mode?0:t.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-Object(Cl.j)(e.center,xp)**2/Object(Cl.r)(e.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*o)/c,d=-Math.cos(s)*l+Math.sin(s)*o;switch(Object(Pl.c)(i.pan.matrix,i.pan.matrix,u,xp),i.pan.enabled=!0,n.mode){case"pan":Object(Pl.c)(i.pan.matrix,i.pan.matrix,d,Sp),i.pan.enabled=!0;break;case"zoom":i.zoom=-t.translation[1]*r.zoom}}(t,r,i,o,l,-Xo.f.normalize(Object(Bt.g)(n))):function(e,t,r,i,n){const{eye:s,viewRight:a}=e,o=Object(Cl.i)(Ch.c.get(),a,s),l=t.translation[0]*r.pan;switch(0!==l&&(Object(Pl.c)(i.pan.matrix,i.pan.matrix,-l,o),i.pan.enabled=!0),n.mode){case"pan":{const e=t.translation[1]*r.pan;0!==e&&(Object(Pl.c)(i.pan.matrix,i.pan.matrix,e,a),i.pan.enabled=!0);break}case"zoom":i.zoom=-t.translation[1]*r.zoom}}(t,r,i,o,l)}const xp=Object(S.e)(),Sp=Object(S.e)(),Tp=Object(S.e)(),Cp=Object(S.e)(),Mp=Object(S.e)(),Pp=Object(S.e)(),Ap=Object(S.e)(),Ep=Object(S.e)(),Rp=Object(tc.b)(),Ip=Mh(),Dp=Object(Al.d)(),Fp=Object(Al.d)(),Lp=Object(Al.d)(),kp=Object(S.e)(),zp=Object(S.e)(),Vp=Object(S.e)(),Np=new Hd.a,Up=Object(S.e)(),Bp=Object(S.e)(),Gp={origin:Object(S.e)(),direction:Object(S.e)()},qp={origin:Object(S.e)(),direction:Object(S.e)()};let Hp=class extends jh{constructor(){super(...arguments),this.zoomLocation=Object(S.e)(),this.tmpCamera=new Hd.a,this.tmpViewDir=Object(S.e)(),this.tmpRayDir={origin:Object(S.e)(),direction:Object(S.e)()},this.targetOnSphere=Object(S.e)(),this.tmpCenter=Object(S.e)(),this.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new Hd.a,interactionDirection:null,tiltMode:0},this.sphere=Object(pu.c)()}initialize(){this.intersector=new Oh.a(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this.constraintOptions;this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i);let n=!1,s=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation)&&(n=e>0,s=!0),this.tmpCamera.copyFrom(r.camera),n?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:Object(Cl.m)(this.zoomLocation,this.tmpCamera.center),this.updateCamera(this.tmpCamera,e,this.zoomLocation,t,s),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:Object(hu.a)(600),easing:dd}}updateCamera(e,t,r,i,n){if(op(e,i,n,Object(M.e)(this.view.spatialReference))===tp.Horizontal||Object(p.a)("disable-feature:context-navigation")){let n=.6**t;this.sphere[3]=Object(Cl.r)(r),Object(Cl.l)(this.tmpViewDir,e.center,e.eye);const s=Object(Cl.r)(this.tmpViewDir);let a=s*n;if(n<=1&&a<4&&(a=4,n=a/s),Math.abs(s-a)<1e-6)return;const o=Object(Cl.r)(e.center);if(this.sphere[3]!==o){const t=this.sphere[3]+n*(o-this.sphere[3]);e.center=Object(Cl.g)(Wp,e.center,t/o)}Object(Cl.g)(this.tmpViewDir,this.tmpViewDir,-n),e.eye=Object(Cl.h)(Wp,e.center,this.tmpViewDir),Pd(this.view,e,this.constraintOptions),Object(Cl.n)(r,e.center)>1e-12&&Gh(this.sphere,e,i,this.targetOnSphere)&&function(e,t,r,i,n,s,a){Op(r,Object(Cl.j)(t.up,r),e[3],-Xo.f.normalize(Object(Bt.g)(n)),s,t,np.Pole,np.Angle)?_p(e,t,r,i,-Xo.f.normalize(Object(Bt.g)(n)),s,a):jp(e,t,r,i,s,a)}(this.sphere,e,r,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let n=.6**Math.abs(t);const s=t>0?1:-1;let a;Object(Bh.d)(e,i,this.tmpRayDir),Object(Cl.t)(this.tmpRayDir.direction,this.tmpRayDir.direction),this.view.camera.position.hasZ&&(a=Math.abs(this.view.camera.position.z));let o=Math.max(12*a,20);const l=this.view._stage.renderView.getMinimalDepthForArea(i[0],i[1],this.view.state.camera,60);o=o>l?l:o,Object(Cl.g)(this.tmpRayDir.direction,this.tmpRayDir.direction,o),Object(Cl.h)(r,this.tmpRayDir.origin,this.tmpRayDir.direction);let c=o*n;if(t>0&&c<4&&(c=4,n=c/o),Math.abs(o-c)<1e-6)return;Object(Cl.g)(this.tmpRayDir.direction,this.tmpRayDir.direction,s*(1-n)),e.eye=Object(Cl.h)(Wp,e.eye,this.tmpRayDir.direction),e.center=Object(Cl.h)(Wp,e.center,this.tmpRayDir.direction)}Fu(this.view,e)}};Hp=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.global.ZoomStepController")],Hp);const Wp=Object(S.e)();var $p=r(314);let Qp=class extends jh{constructor(){super(...arguments),this.zoomLocation=Object(S.e)(),this.tmpCamera=new Hd.a,this.tmpRayDir=Object(S.e)(),this.tmpCenter=Object(S.e)(),this.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new Hd.a,interactionDirection:null,tiltMode:0}}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this.constraintOptions;this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i),this.tmpCamera.copyFrom(r.camera);const n=new Oh.a(this.view.state.viewingMode);e>0?(this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,n,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,n,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:Object(Cl.m)(this.zoomLocation,this.tmpCamera.center);const s=.6**e;if(!Object($p.a)()){let e=this.view._stage.renderView.getMinimalDepthForArea(t[0],t[1],this.view.state.camera,60);const r=Math.max(14*Math.abs(this.view.camera.position.z),20);if(e=e?Math.min(e,r):r,e){const t=Object(S.e)();Object(Cl.l)(t,this.zoomLocation,this.tmpCamera.eye),e<Object(Cl.r)(t)&&(Object(Cl.t)(t,t),Object(Cl.h)(this.zoomLocation,this.tmpCamera.eye,Object(Cl.g)(t,t,e)))}}this.updateCamera(this.tmpCamera,s,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:Object(hu.a)(600),easing:dd}}updateCamera(e,t,r){Object(Cl.l)(this.tmpRayDir,r,e.eye);const i=Object(Cl.r)(this.tmpRayDir);let n=i*t;t<=1&&n<4&&(n=4,t=n/i),Math.abs(i-n)<1e-6||(Object(Cl.g)(this.tmpRayDir,this.tmpRayDir,t),e.eye=Object(Cl.l)(Zp,r,this.tmpRayDir),e.center=Object(Cl.k)(Zp,e.center,r,1-t),Pd(this.view,e,this.constraintOptions))}};Qp=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.local.ZoomStepController")],Qp);const Zp=Object(S.e)();function Xp(e,t){if("touch"===e.pointerType)return!1;switch(t){case"primary":return 0===e.button;case"secondary":return 2===e.button;case"tertiary":return 1===e.button}}class Jp extends on{constructor(e,t){super(!0),this.view=e,this.registerIncoming("double-click",t,(e=>this.handleDoubleClick(e)))}handleDoubleClick(e){const t=e.data;if(function(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}}(t,"primary")){const r=this.view.state.isGlobal?new Hp({view:this.view,mode:"animation"}):new Qp({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Object(O.f)(t.x,t.y)),e.stopPropagation()}}}let Yp=class extends yh{constructor(){super(...arguments),this.startCamera=new Hd.a,this.currentCamera=new Hd.a}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=mh.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};Yp=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.InteractiveController")],Yp);let Kp=class extends Yp{constructor(e){super(e),this.view=null,this.pivot=0,this.lastPoint=Object(tc.b)(),this.tmpWorldUp=Object(S.e)(),this.tmpViewDir=Object(S.e)(),this.tmpRotCurPoint=Object(tc.b)(),this.tmpTransf=Object(Al.d)(),this.tmpAxis=Object(S.e)(),this.tmpPivotPoint=Object(S.e)(),this.pivotPos=Object(S.e)(),this.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=0===this.pivot?3:1.5}begin(e){if(this.active){switch(this.pivot){case 1:Object(Cl.m)(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=3,this.constraintOptions.tiltMode=1,this.constraintOptions.selection=0;break;case 0:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||Object(Cl.m)(this.pivotPos,this.startCamera.center),Object(p.a)("disable-feature:context-navigation")||this.constrainPivotPoint(e),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.startCamera,Hh(this.startCamera,e,this.lastPoint)}}constrainPivotPoint(e){const t=this.startCamera,r=Object(S.e)();Object(Cl.l)(r,this.pivotPos,t.eye);let i=Object(Cl.r)(r);this.view.camera.position.hasZ&&(i=Math.min(i,7*Math.abs(this.view.camera.position.z)));const n=Object(M.e)(this.view.spatialReference),s=Object(O.f)(t.width/t.pixelRatio*.5,t.height/t.pixelRatio*.5),a=op(this.startCamera,s,!0,n);let o=this.view._stage.renderView.getMinimalDepthForArea(t.fullWidth/t.pixelRatio*.5,t.fullHeight/t.pixelRatio*.5,t,225,90),l=this.view._stage.renderView.getMinimalDepthForArea(e[0],e[1],t,90);void 0===o&&void 0===l||(o=void 0===o?l:o,l=void 0===l||a===tp.Horizontal?o:l,i=o>l?l:o),Object(Cl.t)(r,r),Object(Cl.m)(this.pivotPos,Object(Cl.h)(this.tmpPivotPoint,t.eye,Object(Cl.g)(this.tmpPivotPoint,r,i)))}update(e){if(this.active){switch(this.pivot){case 1:this.currentCamera.center=this.applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case 0:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this.applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}Pd(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}applyRotation(e,t,r,i){this.view.renderCoordsHelper.worldUpAtPosition(i,this.tmpWorldUp),Hh(e,t,this.tmpRotCurPoint);let n=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,s=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;Object(Cl.l)(this.tmpViewDir,r,i);const a=Object(Cl.r)(this.tmpViewDir),o=Object(Bt.b)(Object(Cl.j)(this.tmpViewDir,this.tmpWorldUp)/a);if(1===this.pivot){n*=-.5;const e=.5*Math.PI-o,t=.5*Math.PI*.99;n=e-Math.max(-t,Math.min(t,e+n))}return n=Object(Bt.e)(n+o,el.min,el.max)-o,Object(Pl.i)(this.tmpTransf),Object(Cl.i)(this.tmpAxis,e.up,this.tmpViewDir),0===this.pivot&&(s=-s),Object(Pl.c)(this.tmpTransf,this.tmpTransf,s,this.tmpWorldUp),Object(Pl.c)(this.tmpTransf,this.tmpTransf,n,this.tmpAxis),Object(Cl.s)(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=Object(Cl.s)(ef,e.up,this.tmpTransf),Object(Cl.h)(ef,i,this.tmpViewDir),Object(ec.c)(this.lastPoint,this.tmpRotCurPoint),ef}};Object(i.a)([Object(j.b)({constructOnly:!0})],Kp.prototype,"view",void 0),Object(i.a)([Object(j.b)()],Kp.prototype,"pivot",void 0),Kp=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.RotateController")],Kp);const ef=Object(S.e)();class tf extends on{constructor(e,t,r,i){super(!0),this.view=e,this.pointerAction=t,this.pivot=r,this.registerIncoming("drag",i,(e=>this.handleDrag(e)))}handleDrag(e){const t=e.data;if(t.pointers.size>1)return;if(!Xp(e.data,this.pointerAction))return;const r=Object(O.f)(t.center.x,t.center.y);switch(t.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new Kp({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}}let rf=class extends Yp{constructor(e){super(e),this.view=null,this.pickPoint=Object(S.e)(),this.tmpP0=Object(tc.b)(),this.panAxisAngle=Mh(),this.tmpRayDir=Object(S.e)(),this.targetOnSphere=Object(S.e)(),this.tmpRay={origin:Object(S.e)(),direction:Object(S.e)()},this.dragBeginPoint=Object(O.f)(),this.normalizedAnchorPoint=Object(tc.b)(),this.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},this.sphere=Object(pu.c)(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Object(ec.c)(this.dragBeginPoint,e),Hh(this.startCamera,e,this.normalizedAnchorPoint);const t=Object(M.e)(this.view.spatialReference),r=ap(this.intersectionHelper,this.startCamera,e,!1,t);if(this.navMode=op(this.startCamera,e,r.hasGeometryIntersection,t),this.navMode===tp.Horizontal||Object(p.a)("disable-feature:context-navigation"))this.hasPickPoint=!!r.scenePickPoint,this.pickPoint=r.scenePickPoint,this.sphere=r.sphere;else{let t;Object(Bh.d)(this.startCamera,e,this.tmpRay),Object(Cl.t)(this.tmpRay.direction,this.tmpRay.direction),this.view.camera.position.hasZ&&(t=Math.abs(this.view.camera.position.z));let r=30*t;const i=this.view._stage.renderView.getMinimalDepthForArea(e[0],e[1],this.view.state.camera,70);r=r>i?i:r,this.hasPickPoint=!0,Object(Cl.g)(this.tmpRay.direction,this.tmpRay.direction,r),Object(Cl.h)(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===tp.Horizontal||Object(p.a)("disable-feature:context-navigation")){Object(Cl.l)(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Object(Cl.r)(this.tmpRayDir);Hh(this.currentCamera,e,this.tmpP0);const r=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let i=t*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<n&&(i=n),Math.abs(t-i)<1e-6)return;if(this.hasPickPoint&&i<t){const e=1-(1-i/t)*(1-this.sphere[3]/Object(Cl.r)(this.currentCamera.center));this.currentCamera.center=Object(Cl.g)(nf,this.currentCamera.center,e)}Object(Cl.g)(this.tmpRayDir,this.tmpRayDir,-i/t),this.currentCamera.eye=Object(Cl.h)(nf,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=Ad(this.dragBeginPoint,e),Pd(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(up(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),Eh(this.pickPoint,this.targetOnSphere,this.panAxisAngle),$h(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Object(Cl.r)(this.tmpRay.direction);Hh(this.currentCamera,e,this.tmpP0);const r=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let i=t*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<n&&(i=n),Math.abs(t-i)<1e-6)return;Object(Cl.g)(this.tmpRayDir,this.tmpRay.direction,1-i/t),this.currentCamera.eye=Object(Cl.h)(nf,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=Object(Cl.h)(nf,this.currentCamera.center,this.tmpRayDir)}Fu(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};Object(i.a)([Object(j.b)({constructOnly:!0})],rf.prototype,"view",void 0),rf=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.global.ZoomController")],rf);const nf=Object(S.e)();let sf=class extends Yp{constructor(e){super(e),this.view=null,this.tmpP=Object(S.e)(),this.tmpDir=Object(S.e)(),this.tmpN=Object(S.e)(),this.tmpP0=Object(tc.b)(),this.tmpPoi=Object(S.e)(),this.tmpRayDir=Object(S.e)(),this.dragBeginPoint=Object(O.f)(),this.normalizedAnchorPoint=Object(tc.b)(),this.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:Object(S.e)(),tiltMode:0},this.plane=Object(Uh.d)()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;let t;Object(ec.c)(this.dragBeginPoint,e),Hh(this.startCamera,e,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP),Object(Cl.l)(this.tmpDir,this.tmpP,this.startCamera.eye),Object(Cl.t)(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(t=Math.abs(this.view.camera.position.z));let r=30*t;const i=this.view._stage.renderView.getMinimalDepthForArea(e[0],e[1],this.view.state.camera,70);r=r>i?i:r,Object(Cl.g)(this.tmpDir,this.tmpDir,r),Object(Cl.h)(this.tmpP,this.startCamera.eye,this.tmpDir),Object(Cl.l)(this.tmpN,this.startCamera.eye,this.startCamera.center),Object(Cl.t)(this.tmpN,this.tmpN),this.tmpN[1]<0&&Object(Cl.u)(this.tmpN,this.tmpN),Object(Uh.h)(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Qh(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||Object(Cl.m)(this.tmpPoi,this.currentCamera.center),Hh(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);Object(ec.c)(this.normalizedAnchorPoint,this.tmpP0),Object(Cl.l)(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const r=Object(Cl.r)(this.tmpRayDir);let i=r*(1-t);Object(Cl.m)(this.constraintOptions.interactionDirection,this.tmpRayDir),Object(Cl.g)(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Object(Bt.t)(t)/r);const n=this.view.state.constraints.minimumPoiDistance;t>=0&&i<n&&(i=n,t=-(i-r)/r),Math.abs(r-i)<1e-6||(Object(Cl.g)(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=Object(Cl.h)(af,this.currentCamera.eye,this.tmpRayDir),Object(Cl.k)(af,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?af[2]=Math.max(this.startCamera.center[2],af[2]):af[2]=Math.min(this.startCamera.center[2],af[2]),this.currentCamera.center=af,this.constraintOptions.interactionFactor=Ad(this.dragBeginPoint,e),Pd(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};Object(i.a)([Object(j.b)({constructOnly:!0})],sf.prototype,"view",void 0),sf=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.local.ZoomController")],sf);const af=Object(S.e)();class of extends on{constructor(e,t,r){super(!0),this.view=e,this.pointerAction=t,this.registerIncoming("drag",r,(e=>this.handleDrag(e)))}handleDrag(e){const t=e.data;if(t.pointers.size>1)return;if(!Xp(e.data,this.pointerAction))return;const r=Object(O.f)(t.center.x,t.center.y);switch(t.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new rf({view:this.view}):this.cameraController=new sf({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}}var lf=r(71),cf=r(332);function uf(e){let t=e*e;return e<0&&(t*=-1),t}function df(e,t,r){const i=r,n=e.state,s=e.device,a="forward-down"===t.tiltDirection?1:-1;return"standard"===s.deviceType?(i.translation[0]=uf(n.axes[0]),i.translation[1]=uf(n.axes[1]),i.translation[2]=uf(n.buttons[7])-uf(n.buttons[6]),i.heading=uf(n.axes[2]),i.tilt=uf(n.axes[3])):"spacemouse"===s.deviceType&&(i.translation[0]=1.2*uf(n.axes[0]),i.translation[1]=1.2*uf(n.axes[1]),i.translation[2]=2*-uf(n.axes[2]),i.heading=1.2*uf(n.axes[5]),i.tilt=1.2*uf(n.axes[3])),i.tilt*=a,Object(Cl.g)(i.translation,i.translation,1),i}function hf(e,t){const r=t;return r.translation[0]=e[1]-e[0],r.translation[1]=e[3]-e[2],r.translation[2]=e[4]-e[5],r.heading=e[7]-e[6],r.tilt=e[8]-e[9],r.zoom=e[10]-e[11],r}function pf(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}let ff=class extends Yp{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new Hd.a,this.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new Hd.a,interactionFactor:0,interactionDirection:null,tiltMode:1}}handleEventGamepad(e){const t=df(e,this.view.navigation.gamepad,this.transformation);("end"===e.action||pf(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,hf(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;pf(hf(this.keysButtonState,this.transformation))&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z;this.filteredSurfaceElevation+=1*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this.updateStartHeading(),this.updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this.updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this.calculateControlTransformation(e,this.currentCamera,_f),this.applyDisabledMovementTypes(_f),this.applyPan(_f.pan),this.applyRotate(_f.rotate),this.applyZoom(_f.zoom),this.applyAscend(_f.ascend),this.constraintOptions.interactionType=0,this.constraintOptions.selection=8,Pd(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}updateStartHeading(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)}applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;Object(Cl.l)(wf,t.center,t.eye),Object(Cl.s)(wf,wf,e.matrix),t.center=Object(Cl.h)(wf,wf,t.eye),t.up=Object(Cl.s)(wf,t.up,e.matrix),this.constraintOptions.interactionType=3,this.constraintOptions.selection=7,Pd(this.view,t,this.constraintOptions)}applyPan(e,t=this.currentCamera){e.enabled&&(t.eye=Object(Cl.s)(wf,t.eye,e.matrix),t.center=Object(Cl.s)(wf,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Object(Cl.s)(wf,t.up,e.matrix)),this.constraintOptions.interactionType=4,this.constraintOptions.selection=15,Pd(this.view,t,this.constraintOptions))}applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=Object(Cl.h)(wf,this.currentCamera.eye,Object(Cl.g)(Ch.c.get(),t,e)),Object(Cl.m)(xf,t),Object(Cl.u)(xf,xf),this.constraintOptions.interactionDirection=xf,this.constraintOptions.interactionType=1,this.constraintOptions.selection=7,Pd(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ch.c.get());if(this.constraintOptions.interactionDirection=Object(Cl.m)(xf,t),this.view.state.isGlobal){const t=Object(Cl.r)(this.currentCamera.eye),r=(t+e)/t;this.currentCamera.eye=Object(Cl.g)(wf,this.currentCamera.eye,r),this.currentCamera.center=Object(Cl.g)(wf,this.currentCamera.center,r)}else{const r=Object(Cl.g)(Ch.c.get(),t,e);this.currentCamera.eye=Object(Cl.h)(wf,this.currentCamera.eye,r),this.currentCamera.center=Object(Cl.h)(wf,this.currentCamera.center,r)}this.updateCameraCenter(),this.constraintOptions.interactionType=5,this.constraintOptions.selection=8,Pd(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter(),this.constraintOptions.selection=7,Pd(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}calculateControlTransformation(e,t,r){!function(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,Object(Pl.i)(e.pan.matrix),e.rotate.enabled=!1,Object(Pl.i)(e.rotate.matrix)}(r);const i=this.computeVelocities(e);this.view.state.isLocal?this.calculateControlTransformationLocal(i,t,r):this.calculateControlTransformationGlobal(i,t,r)}updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(r,e,wf)}calculateControlTransformationLocal(e,t,r){const{viewRight:i,viewForward:n}=t,s=this.transformation,a=this.view.navigation.gamepad,o=Object(Cl.y)(Ch.c.get(),n[0],n[1],0);Object(Cl.t)(o,o);const l=s.translation[0]*e.pan;if(0!==l){const e=Object(Cl.g)(Ch.c.get(),i,l);Object(Pl.t)(r.pan.matrix,r.pan.matrix,e),r.pan.enabled=!0}switch(a.mode){case"pan":{const t=-s.translation[1]*e.pan;if(0!==t){const e=Object(Cl.g)(Ch.c.get(),o,t);Object(Pl.t)(r.pan.matrix,r.pan.matrix,e),r.pan.enabled=!0}r.zoom=s.zoom*e.zoom;break}case"zoom":r.zoom=(-s.translation[1]+s.zoom)*e.zoom;break;default:Object(zu.a)(a.mode)}const c=s.translation[2]*e.ascend;r.ascend=c;const u=-s.heading*e.rotate;0!==u&&(Object(Pl.c)(r.rotate.matrix,r.rotate.matrix,u,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Ch.c.get())),r.rotate.enabled=!0);const d=s.tilt*e.rotate,h=Vu(this.view.renderCoordsHelper,t.center,t.eye),p=Object(Bt.e)(h+d,el.min,el.max)-h;p&&(Object(Pl.c)(r.rotate.matrix,r.rotate.matrix,p,i),r.rotate.enabled=!0)}calculateControlTransformationGlobal(e,t,r){const{eye:i,viewRight:n}=t,s=this.transformation,a=this.view.navigation.gamepad,o=Object(Cl.i)(Ch.c.get(),n,i);Object(Cl.t)(o,o),Object(Cl.u)(o,o),wp(this.startCamera,t,s,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,r,a),this.tmpCamera.copyFrom(this.currentCamera),this.applyPan(_f.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=s.translation[2]*e.ascend;r.ascend=c;const u=-s.heading*e.rotate;0!==u&&(Object(Pl.c)(r.rotate.matrix,r.rotate.matrix,u,this.tmpCamera.eye),r.rotate.enabled=!0);const d=s.tilt*e.rotate,h=this.clampTiltDeltaGlobalToValidRange(d,t.ray,l);0!==h&&(Object(Pl.c)(r.rotate.matrix,r.rotate.matrix,h,this.tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=s.zoom*e.zoom}clampTiltDeltaGlobalToValidRange(e,t,r){const i=Object(M.e)(this.view.spatialReference),n=Kh(el.min,t.origin,r,i);let s=0,a=0;const o=Ch.c.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,o)){s=Kh(Vu(this.view.renderCoordsHelper,o,t.origin),t.origin,r,i),a=Kh(el.max,t.origin,r,i)}else{Object(pu.b)(Object(pu.e)(r+i.radius),t,o);s=ep(Object(Bt.b)(-Object(Cl.j)(t.direction,Object(Cl.t)(o,o))),t.origin,r,i),a=ep(el.max,t.origin,r,i)}return Object(Bt.e)(s+e,n,a)-s}getPointAbsoluteSurfaceElevation(e,t,r){const{renderCoordsHelper:i}=this.view,n=i.getAltitude(e),s=t+Math.abs(n-t);return i.setAltitude(r,s,e),s}clampedDistanceToSurface(e,t){const{renderCoordsHelper:r}=this.view,{camera:i}=this.view.state,{direction:n}=Object(lf.j)(this.view,t,0,mf,Sf),s=r.intersectManifoldClosestSilhouette(Object(fu.g)(t,n),e,Ch.c.get()),a=Object(Cl.o)(t,s),o=r.intersectManifoldClosestSilhouette(Object(fu.g)(t,Object(Cl.x)(Ch.c.get(),t,i.center)),e,Ch.c.get()),l=Object(Cl.o)(t,o);return Math.min(a,l)}computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:r}=this.view,{camera:i,isGlobal:n}=r,s=t.intersectManifoldClosestSilhouette(i.ray,this.filteredSurfaceElevation,Ch.c.get());if(n){const t=Object(Cl.l)(Ch.c.get(),e,s),r=Object(Cl.r)(t);Object(Cl.g)(t,t,1/r);const i=Object(Cl.t)(Ch.c.get(),e),n=Object(Bt.b)(Object(Cl.j)(i,t));return r*Math.sin(Math.min(gf,n))}{const r=Object(Cl.m)(Ch.c.get(),e);return t.setAltitude(r,this.filteredSurfaceElevation),Object(Cl.o)(s,r)}}minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:vf}computeVelocities(e){const t=this.filteredSurfaceElevation,r=t+Object(M.e)(this.view.spatialReference).radius,{camera:i,isGlobal:n}=this.view.state,s=Ch.c.get(),a=this.getPointAbsoluteSurfaceElevation(i.eye,t,s),o=this.clampedDistanceToSurface(t,s),l=i.width/2,c=yf*i.width,u=yf*i.width,d=o*Math.tan(.5*i.fovX)/l,h=d/r,p=d/this.computeHeadingRotateRadius(s),f=a-t;return{pan:(n?h:d)*c*e,ascend:Math.max(this.minimumAscendVelocity()*e,2**(c*e/l)*f-f),zoom:2**(c*e/l)*o-o,rotate:Object(Bt.e)(p*u,Of,jf)*e}}applyDisabledMovementTypes(e){!Object(b.j)(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Object(Pl.i)(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Object(Pl.i)(e.rotate.matrix))}static activatesFor(e,t){const r=df(t,e.navigation.gamepad,bf);return!("end"===t.action||pf(r))}};Object(i.a)([Object(j.b)({constructOnly:!0})],ff.prototype,"view",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],ff.prototype,"gamepadDevice",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],ff.prototype,"disableMovements",void 0),ff=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.GamepadKeyboardController")],ff);const bf={translation:[0,0,0],heading:0,tilt:0,zoom:0},mf=80,gf=Object(Bt.g)(mf),yf=.75,vf=5,Of=Object(Bt.g)(30),jf=Object(Bt.g)(80),_f={zoom:0,ascend:0,pan:{enabled:!1,matrix:Object(Al.d)()},rotate:{enabled:!1,matrix:Object(Al.d)()}},wf=Object(S.e)(),xf=Object(S.e)(),Sf=Object(cf.a)();class Tf extends on{constructor(e){super(!0),this.view=e,this.watchHandles=new F.a,this.handle=this.registerIncoming("gamepad",(e=>this.handleEventGamepad(e))),this.handle.pause()}onInstall(e){super.onInstall(e),this.watchHandles.add([Object(y.a)(this.view.navigation.gamepad,"enabled",(e=>{e?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))})),this.view.navigation.gamepad.watch("device",(e=>{this.cameraControllerGamepad&&e&&this.cameraControllerGamepad.gamepadDevice!==e&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)}))])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}handleEventGamepad(e){const t=this.view.navigation.gamepad.device;if(t&&e.data.device!==t)return;const r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||ff.activatesFor(this.view,e.data)){if(!r){const t=new ff({view:this.view,gamepadDevice:e.data.device});this.view.state.switchCameraController(t)&&(this.cameraControllerGamepad=t)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===e.data.device&&this.cameraControllerGamepad.handleEventGamepad(e.data)}}}class Cf extends on{constructor(e,t){super(!0),this.view=e,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:2},this.keyToNumber={[t.left]:0,[t.right]:1,[t.forward]:2,[t.backward]:3,[t.up]:4,[t.down]:5,[t.headingLeft]:6,[t.headingRight]:7,[t.tiltUp]:8,[t.tiltDown]:9,[t.zoomIn]:10,[t.zoomOut]:11},this.registerIncoming("key-down",null,(e=>this.handleKeyDown(e))),this.registerIncoming("key-up",null,(e=>this.handleKeyUp(e))),this.registerIncoming("blur",null,(()=>this.handleBlur()))}handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this.keyToNumber[e.data.key];null!=t&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new ff({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(t),e.stopPropagation()))}handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this.keyToNumber[e.data.key];null!=t&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(t),e.stopPropagation())}}class Mf extends on{constructor(e,t){super(!0),this.view=e,this.registerIncoming("mouse-wheel",t,(e=>this.handleMouseWheel(e)))}handleMouseWheel(e){if(!this.view.navigation.mouseWheelZoomEnabled)return;const t=e.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new Hp({view:this.view,mode:"interaction"}):new Qp({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*t.deltaY,Object(O.f)(t.x,t.y)),e.preventDefault(),e.stopPropagation()}}class Pf{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return void 0===this._value?0:this._value}update(e){void 0===this._value?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}}let Af=class extends vh{constructor(e){super(e),this.view=null,this.beginCamera=new Hd.a,this.elapsedTimeSec=0,this.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new Hd.a,interactionDirection:null,tiltMode:0}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new Uo}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),Pd(this.view,t,this.constraintOptions)}};Object(i.a)([Object(j.b)({constructOnly:!0})],Af.prototype,"view",void 0),Af=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.momentum.MomentumController")],Af);let Ef=class extends Af{constructor(e){super(e),this.interactionType=4,this.tmpPan=Object(S.e)()}momentumStep(e,t){const r=this.momentum.value(e);Object(Cl.g)(this.tmpPan,this.momentum.direction,r),t.eye=Object(Cl.l)(Rf,t.eye,this.tmpPan),t.center=Object(Cl.l)(Rf,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};Object(i.a)([Object(j.b)({constructOnly:!0})],Ef.prototype,"momentum",void 0),Ef=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],Ef);const Rf=Object(S.e)(),If=Object(S.e)(),Df=Object(S.e)();let Ff=class extends Af{constructor(e){super(e),this.interactionType=4}momentumStep(e,t){const r=this.momentum.value1(e),i=this.momentum.value2(e);Object(Cl.m)(Df,t.eye),Object(Cl.t)(Df,Df),Object(Cl.i)(this.momentum.axis2,Df,this.momentum.axis1),vp(t,If,this.momentum.axis1,r,this.momentum.axis2,i)}};Object(i.a)([Object(j.b)({constructOnly:!0})],Ff.prototype,"momentum",void 0),Ff=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],Ff);let Lf=class extends Af{constructor(e){super(e),this.interactionType=2}set center(e){this._set("center",Object(S.c)(e))}set axis(e){this._set("axis",Object(S.c)(e))}momentumStep(e,t){const r=this.momentum.value(e);$h(t,this.center,Ph(this.axis,r))}};Object(i.a)([Object(j.b)({constructOnly:!0})],Lf.prototype,"momentum",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Lf.prototype,"center",null),Object(i.a)([Object(j.b)({constructOnly:!0})],Lf.prototype,"axis",null),Lf=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.momentum.MomentumController")],Lf);let kf=class extends Af{constructor(e){super(e),this.interactionType=1,this.constraintOptions.interactionDirection=Object(S.e)()}set zoomCenter(e){this._set("zoomCenter",Object(S.c)(e))}momentumStep(e,t){Object(Cl.m)(this.constraintOptions.interactionDirection,t.eye);const r=this.momentum.valueDelta(0,e);Zh(t,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=Object(Cl.x)(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};Object(i.a)([Object(j.b)({constructOnly:!0})],kf.prototype,"momentum",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],kf.prototype,"zoomCenter",null),kf=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],kf);let zf=class extends Af{constructor(e){super(e),this.interactionType=1,this.radius=0,this.tmpSceneCenter=Object(S.e)(),this.tmpZoomAxisAngle=Mh(),this.sphere=Object(pu.c)()}set screenCenter(e){this._set("screenCenter",Object(O.f)(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Object(S.c)(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const r=this.momentum.valueDelta(0,e);Xh(this.sphere,t,r),this.constraintOptions.interactionType=1,Pd(this.view,t,this.constraintOptions),up(this.sphere,t,this.screenCenter,this.tmpSceneCenter),Eh(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),$h(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=4}};Object(i.a)([Object(j.b)({constructOnly:!0})],zf.prototype,"momentum",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],zf.prototype,"screenCenter",null),Object(i.a)([Object(j.b)({constructOnly:!0})],zf.prototype,"sceneCenter",null),Object(i.a)([Object(j.b)({constructOnly:!0})],zf.prototype,"radius",void 0),zf=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],zf);class Vf{constructor(e){this.gain=e}update(e){if(this.hasLastValue){const t=this.computeDelta(e);this.updateDelta(t)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return void 0!==this.lastValue}get hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(e){return e-this.lastValue}updateDelta(e){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*e:this.filteredDelta=e}}class Nf{constructor(e,t,r){this._initialVelocity=e,this._stopVelocity=t,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,t){const r=this.value(e);return this.value(e+t)-r}valueFromInitialVelocity(e,t){t=Math.min(t,this.duration);const r=1-this.friction;return e*(r**t-1)/Math.log(r)}}class Uf extends Nf{constructor(e,t,r,i,n){super(e,t,r),this.sceneVelocity=i,this.direction=n}value(e){return super.valueFromInitialVelocity(this.sceneVelocity,e)}}class Bf{constructor(e=300,t=12,r=.84){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=r,this.enabled=!0,this.time=new Vf(.6),this.screen=[new Vf(.4),new Vf(.4)],this.scene=[new Vf(.6),new Vf(.6),new Vf(.6)],this.tmpDirection=Object(S.e)()}add(e,t,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,r=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(e,t,r){Object(Cl.y)(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const i=Object(Cl.r)(this.tmpDirection);i>0&&Object(Cl.g)(this.tmpDirection,this.tmpDirection,1/i);const n=i/this.time.filteredDelta;return new Uf(e,t,r,n,this.tmpDirection)}}class Gf{constructor(e){this.gain=e}update(e){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}const qf=1e-5;class Hf extends Nf{constructor(e,t,r,i,n,s=0,a){super(e,t,r),this.angularVelocity1=i,this.axis1=n,this.angularVelocity2=s,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this.angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}}class Wf{constructor(e=300,t=12,r=.84){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=r,this.enabled=!0,this.tmpAxis1=Object(S.e)(),this.tmpAxis2=Object(S.e)(),this.tmpAngles=Object(tc.b)(),this.time=new Vf(.3),this.screen=[new Vf(.4),new Vf(.4)],this.angle1=new Gf(.6),this.angle2=new Gf(.6),this.axis1=Object(S.e)(),this.axis2=Object(S.e)(),this.lastScene=Object(S.e)()}addMomentumDirectRotation(e,t,r,i,n,s){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;let e=fp(this.lastScene,t,this.tmpAxis2,i,n,s);this.angle2.update(0),Object(Cl.v)(this.tmpAxis2)<qf?e=0:Object(Cl.t)(this.axis1,this.tmpAxis2),this.angle1.update(e),Object(Cl.m)(this.lastScene,t)}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.time.update(r)}}addMomentumPreserveHeading(e,t,r,i,n,s,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;gp(this.lastScene,t,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,i,n,s,a,!1),Object(Cl.v)(this.tmpAxis2)<qf?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),Object(Cl.t)(this.axis1,this.tmpAxis1),Object(Cl.t)(this.axis2,this.tmpAxis2)),Object(Cl.m)(this.lastScene,t)}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,r=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(e,t,r){const i=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new Hf(e,t,r,i,this.axis1,n,this.axis2)}}class $f{constructor(e=2.5,t=.01,r=.95,i=12){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=r,this.maxVelocity=i,this.enabled=!0,this.value=new Vf(.8),this.time=new Vf(.3)}add(e,t){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta){const t=this.value.computeDelta(e);this.value.filteredDelta*t<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Object(Bt.e)(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)}createMomentum(e,t,r){return new Nf(e,t,r)}}class Qf extends $f{constructor(e=3,t=.01,r=.95,i=12){super(e,t,r,i)}add(e,t){if(this.value.hasLastValue){const t=this.value.lastValue;let r=e-t;for(;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;e=t+r}super.add(e,t)}}class Zf extends Nf{constructor(e,t,r){super(e,t,r)}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const r=super.value(e),i=super.value(e+t)-r;return Math.exp(i)}}class Xf extends $f{constructor(e=2.5,t=.01,r=.95,i=12){super(e,t,r,i)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,r){return new Zf(e,t,r)}}let Jf=class extends Yp{constructor(e){super(e),this.view=null,this.smoothRotation=new Pf(.05),this.rotationAxis=Object(S.e)(),this.panningPlane=Object(Uh.d)(),this.smoothScaling=new Pf(.05),this.zoomCenterScreen=Object(O.f)(),this.zoomMomentumEstimator=new Xf,this.rotationMomentumEstimator=new Qf,this.panSphericalMomentumEstimator=new Wf,this.panPlanarMomentumEstimator=new Bf,this.adjustedSphere=Object(pu.c)(),this.tmp3d=Object(S.e)(),this.tmpScreenPointArray=Object(O.f)(),this.beginScreenPoint=Object(O.f)(),this.beginScenePoint=Object(S.e)(),this.screenPickPoint=Object(O.f)(),this.navMode=tp.Horizontal,this.tmpInteractionDirection=Object(S.e)(),this.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new Hd.a,interactionDirection:null,tiltMode:0}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-Xo.f.normalize(Object(Bt.g)(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),Object(O.i)(e.center,this.screenPickPoint),Object(ec.c)(this.beginScreenPoint,this.screenPickPoint);const r=Object(M.e)(this.view.spatialReference),i=ap(this.intersectionHelper,this.startCamera,this.screenPickPoint,!0,r);this.scenePickPoint=i.scenePickPoint,this.sphere=i.sphere,Object(Cl.m)(this.beginScenePoint,this.scenePickPoint),this.navMode=op(this.startCamera,this.screenPickPoint,i.hasGeometryIntersection,r),this.navMode===tp.Vertical&&this.preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}preparePlanarPanMode(e){const t=Object(Cl.u)(this.tmp3d,this.startCamera.viewForward);Object(Uh.h)(this.scenePickPoint,t,this.panningPlane);const r=Object(O.f)(this.screenPickPoint[0],0),i=Object(S.e)(),n=Object(Cl.r)(this.startCamera.eye);this.adjustedSphere[3]=n<this.sphere[3]?n-100:this.sphere[3],up(this.adjustedSphere,this.startCamera,r,i);const s=Object(O.d)();this.startCamera.projectToRenderScreen(i,s);const a=.9*s[1];if(this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],a),this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&Object(Uh.h)(this.scenePickPoint,Object(Uh.s)(this.panningPlane),this.panningPlane),!Object($p.a)()){const e=Object(S.e)(),t=Object(S.e)(),r=Object(S.e)(),i=80,n=5,s=50;Object(Cl.l)(e,this.scenePickPoint,this.currentCamera.eye),Object(Cl.t)(e,e);const a=n*Math.max(Math.abs(this.view.camera.position.z),s),o=this.view._stage.renderView.getMinimalDepthForArea(this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,i),l=o?Math.min(o,a):a;Object(Cl.m)(r,Object(Cl.h)(t,this.currentCamera.eye,Object(Cl.g)(t,e,l))),this.panningPlane[3]=-Object(Cl.j)(this.panningPlane,r),this.startCamera.center=Object(Cl.h)(t,this.startCamera.eye,Object(Cl.g)(t,this.startCamera.viewForward,l))}const o=Object(O.i)(e.center,this.tmpScreenPointArray);Qh(this.panningPlane,this.startCamera,o,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===tp.Horizontal?(t&&this.zoomSpherical(e),this.panningSpherical(e),t&&this.rotateSpherical(e)):(t&&this.zoomPlanar(e),this.panningPlanar(e),t&&this.rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===tp.Horizontal?new zf({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new kf({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const r=this.rotationMomentumEstimator.evaluateMomentum();if(r)return new Lf({view:this.view,momentum:r,center:this.sphere,axis:this.rotationAxis});if(this.navMode===tp.Horizontal){const e=this.panSphericalMomentumEstimator.evaluateMomentum();if(e)return new Ff({view:this.view,momentum:e})}else{const e=this.panPlanarMomentumEstimator.evaluateMomentum();if(e)return new Ef({view:this.view,momentum:e})}return null}zoomSpherical(e){const t=this.beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=r,this.smoothScaling.update(t),Xh(this.sphere,this.currentCamera,this.smoothScaling.value),Object(O.i)(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=Ad(e.radius-this.beginRadius),Pd(this.view,this.currentCamera,this.constraintOptions)}panningSpherical(e){const t=Object(O.i)(e.center,this.tmpScreenPointArray);up(this.sphere,this.currentCamera,t,this.tmp3d),Op(this.beginScenePoint,Object(Cl.j)(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(_p(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(jp(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=Ad(this.screenPickPoint,t),Pd(this.view,this.currentCamera,this.constraintOptions)}rotateSpherical(e){Object(Cl.t)(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||Object(Cl.u)(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,r=t+Wh(e.angle-t),i=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=i,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),$h(this.currentCamera,this.sphere,Ph(this.rotationAxis,n)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=Ad(e.radius*r),Pd(this.view,this.currentCamera,this.constraintOptions)}panningPlanar(e){const t=Object(O.i)(e.center,this.tmpScreenPointArray);Qh(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(lp(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=Ad(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),Pd(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}zoomPlanar(e){const t=this.beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=r,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),Zh(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=Ad(e.radius-this.beginRadius),Pd(this.view,this.currentCamera,this.constraintOptions)}rotatePlanar(e){Object(Cl.m)(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||Object(Cl.u)(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let r=e.angle-t;r=Wh(r);const i=t+r,n=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=n,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),$h(this.currentCamera,this.sphere,Ph(this.rotationAxis,s)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=Ad(e.radius*s),Pd(this.view,this.currentCamera,this.constraintOptions)}};Object(i.a)([Object(j.b)({constructOnly:!0})],Jf.prototype,"view",void 0),Jf=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.global.PinchAndPanController")],Jf);const Yf=Object(S.g)(0,0,1),Kf=16/180*Math.PI;let eb=class extends Yp{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new Pf(.05),this.scalingValueSmooth=new Pf(.05),this.planeHorizontal=Object(Uh.d)(),this.planeVertical=Object(Uh.d)(),this.rotationMomentumEstimator=new Qf,this.panMomentumEstimator=new Bf(300,12,.9),this.zoomMomentumEstimator=new Xf,this.beginCenter=Object(S.e)(),this.tmpPoints=[],this.beginCenterScreen=Object(O.f)(),this.tmpCentroid3d=Object(S.e)(),this.tmpCentroid2d=Object(O.f)(),this.tmp2d=Object(O.f)(),this.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new Hd.a,interactionDirection:null,tiltMode:0}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),Object(O.i)(e.center,this.beginCenterScreen),Object(Uh.f)(Yf,0,this.planeHorizontal);const r=Object(S.e)();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,r);const i=Object(S.e)();Object(Cl.u)(i,this.startCamera.viewForward);const n=Object(S.e)();Object(Cl.m)(n,Yf);const s=Object(Cl.j)(i,n),a=Object(Bt.c)(s<0?-s:s);if(this.panMode=a>=Kf?tp.Horizontal:tp.Vertical,Object(Uh.v)(this.planeHorizontal,r,this.planeHorizontal),this.startCamera.aboveGround||Object(Uh.r)(this.planeHorizontal,this.planeHorizontal),this.panMode===tp.Vertical){if(Object(Cl.g)(n,n,s),Object(Cl.l)(this.planeVertical,i,n),Object(Cl.t)(this.planeVertical,this.planeVertical),Object(Uh.v)(this.planeVertical,r,this.planeVertical),!Object($p.a)()){const e=Object(S.e)(),t=Object(S.e)(),i=Object(S.e)();Object(Cl.l)(e,r,this.currentCamera.eye),Object(Cl.t)(e,e);const n=5*Math.max(Math.abs(this.view.camera.position.z),50),s=this.view._stage.renderView.getMinimalDepthForArea(this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,80),a=s?Math.min(s,n):n;Object(Cl.m)(i,Object(Cl.h)(t,this.currentCamera.eye,Object(Cl.g)(t,e,a))),this.planeVertical[3]=-Object(Cl.j)(this.planeVertical,i)}this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),Yh(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),Yh(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,r=this.panMode===tp.Horizontal?this.planeHorizontal:this.planeVertical,i=this.beginCenter;if(t){const t=this.beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=r,this.scalingValueSmooth.update(t),Zh(this.currentCamera,i,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=Ad(Math.abs(e.radius-this.beginRadius)),Pd(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,r,this.currentCamera,this.tmpPoints),Yh(this.tmpPoints,this.tmpCentroid3d),Object(O.i)(e.center,this.tmpCentroid2d),lp(this.currentCamera,i,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=Ad(this.beginCenterScreen,this.tmpCentroid2d),Pd(this.view,this.currentCamera,this.constraintOptions),t){const t=this.planeHorizontal,r=i,n=this.rotationValueSmooth.value,s=n+Wh(e.angle-n),a=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=a,this.rotationValueSmooth.update(s);const o=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(o,.001*e.timestamp),$h(this.currentCamera,r,Ph(t,o)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=Ad(Math.abs(e.radius*o)),Pd(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new kf({view:this.view,momentum:t,zoomCenter:this.beginCenter});const r=this.rotationMomentumEstimator.evaluateMomentum();if(r)return new Lf({view:this.view,momentum:r,center:this.beginCenter,axis:Object(Uh.s)(this.planeHorizontal)});const i=this.panMomentumEstimator.evaluateMomentum();return i?new Ef({view:this.view,momentum:i}):null}computePlanePoints(e,t,r,i){i.length=e.size;const n=this.tmp2d;let s=0;return e.forEach((e=>{n[0]=e.x,n[1]=e.y,void 0===i[s]&&(i[s]=Object(S.e)()),Qh(t,r,n,i[s]),s+=1})),i}};Object(i.a)([Object(j.b)({constructOnly:!0})],eb.prototype,"view",void 0),eb=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.local.PinchAndPanController")],eb);class tb extends on{constructor(e,t,r){super(!0),this.view=e,this.pointerAction=t,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",r,(e=>this.handleDrag(e)))}handleDrag(e){if("mouse"===e.data.pointerType&&!Xp(e.data,this.pointerAction))return;const t=e.timestamp-this.lastEndTimestamp,r=this.momentum&&this.momentum.active&&t<40;switch(e.data.action){case"start":case"update":if(r)break;this.controller&&this.controller.active?e.data.timestamp-this.lastTimestamp>2&&(this.controller.update(e.data),this.lastTimestamp=e.timestamp):this.startController(e);break;case"end":case"removed":this.endController(e,!0);break;case"added":this.endController(e,!1),this.startController(e)}e.stopPropagation()}endController(e,t){if(this.controller&&this.controller.active){this.lastEndTimestamp=e.timestamp;const r=this.controller.end(e.data);t&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null}startController(e){this.controller=this.createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(e.data),this.lastTimestamp=e.timestamp}createController(){return this.view.state.isGlobal?new Jf({view:this.view}):new eb({view:this.view})}}class rb extends on{constructor(e,t){super(!0),this.view=e,this.registerIncoming("pointer-down",t,(()=>this.view.state.stopActiveCameraController()))}}class ib extends on{constructor(e,t){super(!0),this.key=e,this.registerIncoming("key-down",t,(e=>this._handleKeyDown(e)))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}}class nb extends ib{constructor(e,t,r){super(t,r),this.view=e,this.key=t}activate(){this.view.goTo({heading:0}).catch((()=>{}))}}class sb extends ib{constructor(e,t,r){super(t,r),this.view=e,this.key=t}activate(){this.view.goTo({tilt:0}).catch((()=>{}))}}class ab extends on{constructor(e,t=!1){super(!0),this.view=e,this.invert=t,this.registerIncoming("vertical-two-finger-drag",(e=>this.handleTwoFinger(e)))}handleTwoFinger(e){var t,r,i;const n=this.invert?-1:1,s=Object(O.f)(0,e.data.delta*n);switch(e.data.action){case"begin":null==(t=this.cameraController)||t.end(),this.cameraController=new Kp({view:this.view,pivot:0}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(s);break;case"update":null==(r=this.cameraController)||r.update(s);break;case"end":null==(i=this.cameraController)||i.end(),this.cameraController=null}}}function ob(e){const t=e.native;return t?{buttons:t.buttons.map((e=>e.pressed?e.value?e.value:1:0)),axes:t.axes.map((t=>function(e,t){const r=Math.abs(e);return r<t?0:Object(Bt.t)(e)*(r-t)/(1-t)}(t,e.axisThreshold)))}:{buttons:[],axes:[]}}class lb{constructor(e,t){this.element=e,this.input=t,this._hasEventListeners=!1,this.onConnectGamepad=e=>{this.connectGamepad(e.gamepad)},this.onDisconnectGamepad=e=>{const t=e.gamepad,r=t.index,i=this.inputDevices[r];i&&(this.emitGamepadEvent(t,ob(i),!1),this.inputDevices.splice(r,1),this.latestUpdate.splice(r,1),this.input.gamepad.devices.remove(i),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const r="getGamepads"in window.navigator,i=window.isSecureContext;this.supported=r&&i,this.supported&&(this.forEachGamepad(this.connectGamepad),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this.callback=e}connectGamepad(e){const t=new Oo(e);"unknown"!==t.deviceType&&(this.inputDevices[e.index]=t,this.input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this.startPolling():this.stopPolling()}startPolling(){null==this.frameTask&&(this.frameTask=Object(g.a)({update:()=>this.readGamepadState()}))}stopPolling(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}readGamepadState(){const e=document.hasFocus(),t=this.element.contains(document.activeElement),r="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!t;this.forEachGamepad((e=>{const t=this.inputDevices[e.index];if(!t)return;const i=this.latestUpdate[e.index],n=ob(t),s=r||function(e){for(let t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(let t=0;t<e.buttons.length;t++)if(0!==e.buttons[t])return!1;return!0}(n);if(i){if(i.timestamp===e.timestamp)return;if(!i.active&&s)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(let r=0;r<e.axes.length;r++)if(e.axes[r]!==t.axes[r])return!1;for(let r=0;r<e.buttons.length;r++)if(e.buttons[r]!==t.buttons[r])return!1;return!0}(i.state,n))return}this.emitGamepadEvent(e,n,!s)}))}forEachGamepad(e){const t=window.navigator.getGamepads();for(let r=0;r<t.length;r++){const i=t[r];this.validate(i)&&e(i)}}emitGamepadEvent(e,t,r){const i=this.latestUpdate[e.index],n=i&&i.active;if(!n&&!r)return;const s=!n&&r?"start":n&&r?"update":"end";this.latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:r},this.callback&&this.callback({device:this.inputDevices[e.index],state:t,action:s})}validate(e){if(!e)return!1;if(!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}}const cb=Object(p.a)("trident"),ub=Object(p.a)("edge"),db=Object(p.a)("chrome"),hb=Object(p.a)("ff"),pb=Object(p.a)("safari"),fb="esri-view-surface--touch-none",bb="esri-view-surface--touch-pan";class mb{constructor(e,t){this.input=t,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new lb(e,this.input),this._gamepadSource.onEvent=e=>this._callback("gamepad",e)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((e=>{this._releasePointerCaptureSafe(e)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const e=this._active[t];this._element.removeEventListener(gb[t],e),delete this._active[t]}e&&e.forEach((e=>{if(!this._active[e]&&gb[e]){const t=(this._eventHandlers[e]||this._handleDefault).bind(this,e);this._element.addEventListener(gb[e],t),this._active[e]=t}})),this._gamepadSource.hasEventListeners=e&&e.has("gamepad")}setPointerCapture(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?fb:bb),this._element.classList.add(this._browserTouchPanningEnabled?bb:fb)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(fb),this._element.classList.remove(bb),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(t){}}_updateNormalizedPointerLikeEvent(e,t){const r=no(this._element,e);return mb.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),t.x=r.x,t.y=r.y,t}_handleKey(e,t){const r=function(e){if(void 0!==e.key)return Object(d.a)(e);const t=rn[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}(t);r&&"key-up"===e&&this._keyDownState.delete(r);const i={native:t,key:r,repeat:r&&this._keyDownState.has(r)};r&&"key-down"===e&&this._keyDownState.add(i.key),this._callback(e,i)}_handlePointer(e,t){const r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,t){const r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,t){let r=t.deltaY;switch(t.deltaMode){case 0:(cb||ub)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}cb||ub?r*=.7:db||pb?r*=.6:hb&&(r*=1.375);const i=Math.abs(r);if(i>100){const e=.02;r=r/i*200/(1+Math.exp(-e*(i-100)))}const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:r});this._callback(e,n)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const r={native:t};t.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){"Alt"===e.key&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}}mb.test={disableSubpixelCoordinates:!1};const gb={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class yb extends on{constructor(){super(!0),this.registerIncoming("context-menu",(e=>{e.data.native.preventDefault()}))}}var vb;function Ob(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}class jb extends on{constructor(e){super(!1),this.navigationTouch=e,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this.handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this.handlePointerUpAndPointerLost.bind(this))}createPayload(e,t,r,i){return{action:e,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:i,pointers:xb(this.activePointerMap),pointer:t,angle:r.angle,radius:r.radius,center:r.center}}addPointer(e){const t=e.native.pointerId,r=wb(this.activePointerMap).angle,i={event:e,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,i);const n=Sb(i,_b(this.activePointerMap));i.initialAngle=n,i.lastAngle=n,this.updatePointerAngles(r)}updatePointer(e){if(e&&null==e.x&&null==e.y)return;const t=e.native.pointerId,r=this.activePointerMap.get(t);r?r.event=e:this.addPointer(e)}removePointer(e){const t=wb(this.activePointerMap).angle;this.activePointerMap.delete(e),this.updatePointerAngles(t)}updatePointerAngles(e){const t=wb(this.activePointerMap);this.activePointerMap.forEach((r=>{r.initialAngle=Sb(r,t)-e,r.lastAngle=Sb(r,t)-e}))}emitEvent(e,t,r){const i=wb(this.activePointerMap);this.drag.emit(this.createPayload(e,t,i,r),void 0,this.startStateModifiers)}handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,r=Object(hu.a)(e.timestamp);this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this.updatePointer(e.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",e.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.removePointer(t)):(this.removePointer(t),this.emitEvent("removed",e.data,Object(hu.a)(e.timestamp))))}handlePointerDrag(e){const t=e.data,r=t.currentEvent,i=Object(hu.a)(e.timestamp);switch(t.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this.updatePointer(r),!this.isCurrentDragSuppressed&&this.emitEvent("update",r,i)):(this.addPointer(r),this.emitEvent("added",r,i),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(r),this.pointerType=e.data.startEvent.pointerType,this.mouseButton=e.data.startEvent.button,this.startStateModifiers=e.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",r,i))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}function _b(e){const t=[];return e.forEach((e=>{t.push(Object(O.e)(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:Object(O.e)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){const[r,i]=e,[n,s]=[i.x-r.x,i.y-r.y];return t.radius=Math.sqrt(n*n+s*s)/2,t.center.x=(r.x+i.x)/2,t.center.y=(r.y+i.y)/2,t}let r=0,i=0;for(let v=0;v<e.length;v++)r+=e[v].x,i+=e[v].y;r/=e.length,i/=e.length;const n=e.map((e=>e.x-r)),s=e.map((e=>e.y-i));let a=0,o=0,l=0,c=0,u=0,d=0,h=0;for(let v=0;v<n.length;v++){const e=n[v],t=s[v],r=e*e,i=t*t;a+=r,o+=i,l+=e*t,c+=r*e,u+=i*t,d+=e*i,h+=t*r}const p=.5*(c+d),f=.5*(u+h),b=a*o-l*l,m=(p*o-f*l)/b,g=(a*f-l*p)/b,y=Object(O.e)(m+r,g+i);return{radius:Math.sqrt(m*m+g*g+(a+o)/e.length),center:y}}(t)}function wb(e){const t=_b(e);let r=0;return e.forEach((e=>{let i=Sb(e,t),n=i-e.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;i=e.lastAngle+n,e.lastAngle=i;const s=i-e.initialAngle;r+=s})),r/=e.size||1,{angle:r,radius:t.radius,center:t.center}}function xb(e){const t=new Map;return e.forEach(((e,r)=>t.set(r,e.event))),t}function Sb(e,t){const r=e.event,i=r.x-t.center.x,n=r.y-t.center.y;return Math.atan2(n,i)}!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(vb||(vb={}));var Tb=r(319);const Cb=250,Mb=10,Pb=350,Ab=35;class Eb extends on{constructor(e=Cb,t=Mb,r=Pb,i=Ab,n=Tb.a){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=i,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach((e=>{null!=e.doubleClickTimeout&&(e.doubleClickTimeout.remove(),e.doubleClickTimeout=null)}))}get hasPendingInputs(){return Object(Na.b)(this._pointerState,(e=>null!=e.doubleClickTimeout))}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_handleImmediateClick(e){const t=e.data,r=this._pointerId(t),i=this._pointerState.get(r);if(i){const n="touch"===t.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Ob(i.event.data,t)>n?(this._clearDoubleClickTimeout(r,!0),this._startClick(e)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(i.event.data,void 0,i.event.modifiers))}else this._startClick(e)}_startClick(e){const t=this._pointerId(e.data),r="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(t,{event:e,doubleClickTimeout:this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(t)),r)}),this.refreshHasPendingInputs()}_handlePointerDrag(e){const t=this._pointerId(e.data.currentEvent);this._clearDoubleClickTimeout(t,!0)}_handleDrag(e){const t=this._pointerId(e.data.pointer);this._clearDoubleClickTimeout(t,!0)}_clearDoubleClickTimeout(e,t){const r=this._pointerState.get(e);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,t&&this._doubleClickTimeoutExceeded(e),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}}class Rb extends on{constructor(e=Cb,t=Mb,r=Pb,i=Ab,n=Tb.a){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=i,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")}))}onUninstall(){this._pointerState.forEach((e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(e){const t=e.data,r=this._pointerId(t);if(!this._pointerState.has(r)){const e={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(r,e),this.startCapturingPointer(t.native)}}_handlePointerLoss(e,t){const r=e.data,i=this._pointerId(r),n=this._pointerState.get(i);if(n&&"pointer-up"===t&&n.downButton===r.native.button){const t=n.immediateDoubleClick;if(t){t.timeoutHandle.remove();const i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Ob(t,e.data)>i?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,t.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,t){const r="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(e.data)),r)}}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_removeState(e){const t=this._pointerId(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}const Ib=300,Db=1.5,Fb=6,Lb=6,kb=500;class zb extends on{constructor(e=Ib,t=Db,r=Fb,i=Lb,n=kb,s=Tb.a){super(!1),this.maximumClickDelay=e,this.movementUntilMouseDrag=t,this.movementUntilPenDrag=r,this.movementUntilTouchDrag=i,this.holdDelay=n,this._clock=s,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((e=>{null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null)})),super.onUninstall()}_handlePointerDown(e){const t=e.data,r=t.native.pointerId;let i=null;0===this._pointerState.size&&(i=this._clock.setTimeout((()=>{const t=this._pointerState.get(r);if(t){if(!t.isDragging){const r=t.previousEvent;this._pointerHold.emit(r,void 0,e.modifiers),t.holdEmitted=!0}t.holdTimeout=null}}),this.holdDelay));const n={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:i,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(e)}_createPointerDragData(e,t,r){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:r}}_handlePointerMove(e){const t=e.data,r=t.native.pointerId,i=this._pointerState.get(r);i&&(i.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",i,t),void 0,i.modifiers):function(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}(t,i.startEvent)>this._getDragThreshold(t.native.pointerType)&&this.startDragging(e),i.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;case"mouse":default:return this.movementUntilMouseDrag}}startDragging(e){const t=e.data,r=t.native.pointerId;this._pointerState.forEach((i=>{null!=i.holdTimeout&&(i.holdTimeout.remove(),i.holdTimeout=null),i.isDragging||(i.modifiers=e.modifiers,i.isDragging=!0,r===i.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",i,t)):this._pointerDrag.emit(this._createPointerDragData("start",i,i.previousEvent),e.timestamp))}))}_handlePointerLoss(e,t){const r=e.data,i=r.native.pointerId,n=this._pointerState.get(i);n&&(null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,"pointer-up"===t?r:n.previousEvent),void 0,n.modifiers):"pointer-up"===t&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(i),this.stopCapturingPointer(r.native),0===this._pointerState.size&&this._moveHandle.pause())}}class Vb{constructor(e){this.callbacks=e,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(e){const t=e.data,r=t.pointers.size;switch(t.action){case"start":this.currentCount=r,this.emitStart(e);break;case"added":this.emitEnd(this.previousEvent),this.currentCount=r,this.emitStart(e);break;case"update":this.emitUpdate(e);break;case"removed":this.startEvent&&this.emitEnd(this.previousEvent),this.currentCount=r,this.emitStart(e);break;case"end":this.emitEnd(e),this.currentCount=0}this.previousEvent=e}emitStart(e){this.startEvent=e,this.callbacks.condition(this.currentCount,e)&&this.callbacks.start(this.currentCount,e,this.startEvent)}emitUpdate(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.update(this.currentCount,e,this.startEvent)}emitEnd(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.end(this.currentCount,e,this.startEvent),this.startEvent=null}}class Nb extends on{constructor(e=20,t=40){super(!1),this._threshold=e,this._maxDelta=t,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new Vb({start:(e,t)=>this.observeStart(e,t),update:(e,t,r)=>this.observeUpdate(e,t,r),end:(e,t)=>this.observeEnd(t)}),this.registerIncoming("drag",(e=>this.dragEventSeparator.handle(e)))}get failed(){return"failed"===this.state}observeStart(e,t){1===e&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),t.stopPropagation()),this.state=2===e?"ready":"failed"}observeUpdate(e,t,r){if("failed"!==this.state&&2===e)return"active"===this.state?(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void t.stopPropagation()):void(this.checkMovementWithinLimits(t.data,r.data)?this.checkVerticalThresholdReached(t.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=t.data.center,this._artificalDrag.emit({action:"end",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),t.stopPropagation()):this.state="failed")}observeEnd(e){"active"===this.state&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",e.stopPropagation())}checkMovementWithinLimits(e,t){let r=-1/0,i=1/0,n=-1/0,s=1/0;t.pointers.forEach((e=>{r=Math.max(r,e.x),i=Math.min(i,e.x),n=Math.max(n,e.y),s=Math.min(s,e.y)}));let a=-1/0,o=1/0,l=-1/0,c=1/0;e.pointers.forEach((e=>{a=Math.max(a,e.x),o=Math.min(o,e.x),l=Math.max(l,e.y),c=Math.min(c,e.y)}));const u=r-i,d=n-s,h=a-o,p=l-c;return Math.abs(e.center.x-t.center.x)<this._threshold&&Math.abs(h-u)<=this._maxDelta&&Math.abs(p-d)<=this._maxDelta}checkVerticalThresholdReached(e,t){let r=Math.abs(e.center.y-t.center.y);return e.pointers.forEach(((e,i)=>{const n=t.pointers.get(i);r=Math.min(r,Math.abs(e.y-n.y))})),r>=this._threshold}}let Ub=class extends N.a{constructor(){super(...arguments),this._handles=new F.a}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){"pan"!==e&&"rotate"!==e||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){"default"!==e&&"pro"!==e||e===this._get("mode")||(this._set("mode",e),this._updateMode())}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new mb(this.view.surface,e.input);const t=[new Rb,new zb,new Eb,new jb(this.view.navigation),new Nb],r=new hn({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new yb],fn.INTERNAL),this._modeDragPan=new tb(e,"primary"),this._modeDragRotate=new tf(e,"secondary",0),this._modeDragZoom=new of(e,"tertiary");const i="b",n={left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},s="n",a="p";r.installHandlers("navigation",[new rb(e),new Jp(e),new Tf(e),new Cf(e,n),new Mf(e),new sb(e,a),new nb(e,s),new tf(e,"primary",1,[i]),new tf(e,"secondary",0,[i]),new tb(e,"tertiary",[i]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new ab(e)],fn.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),Object(y.a)(this.view.navigation,"browserTouchPanEnabled",(e=>{this._source.browserTouchPanningEnabled=!e}))}_updateMode(){const e=this.mode,t=this.primaryDragAction,r=Bb.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};Object(i.a)([Object(j.b)()],Ub.prototype,"view",void 0),Object(i.a)([Object(j.b)({value:"pan"})],Ub.prototype,"primaryDragAction",null),Object(i.a)([Object(j.b)({value:"default"})],Ub.prototype,"mode",null),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],Ub.prototype,"hasPendingInputs",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],Ub.prototype,"latestPointerType",void 0),Object(i.a)([Object(j.b)()],Ub.prototype,"_inputManager",void 0),Ub=Object(i.a)([Object(w.a)("esri.views.3d.input.SceneInputManager")],Ub);const Bb=new Map,Gb=new Map,qb=new Map;Gb.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Gb.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),qb.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),qb.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),Bb.set("default",Gb),Bb.set("pro",qb);var Hb=Ub,Wb=r(59),$b=r(70);let Qb,Zb,Xb=!1,Jb=!1,Yb=!1,Kb=!1,em=null;function tm(e){Yb=$b.a.DECONFLICTOR_SHOW_VISIBLE,Kb=$b.a.DECONFLICTOR_SHOW_INVISIBLE,Xb=Yb||Kb,Jb=$b.a.DECONFLICTOR_SHOW_GRID,em=null,Xb||Jb?em=()=>function(e){null==Qb&&(Qb=document.createElement("canvas"),Qb.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Qb));const t=e.width*e.pixelRatio,r=e.height*e.pixelRatio;Qb.setAttribute("width",`${t}px`),Qb.setAttribute("height",`${r}px`),Qb.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${e.width}px;height:${e.height}px`),Zb=Qb.getContext("2d"),Zb.clearRect(0,0,e.width,e.height),Zb.font="12px Arial"}(e):Qb&&(Qb.parentElement.removeChild(Qb),Qb=null)}function rm(){em&&(em(),em=null)}function im(e,t,r,i,n){rm();const s=Qb.height,a=Zb;a.beginPath(),a.lineWidth=1,a.strokeStyle=n,a.moveTo(e,s-r),a.lineTo(t,s-r),a.stroke(),a.lineTo(t,s-i),a.stroke(),a.lineTo(t,s-r),a.stroke(),a.lineTo(e,s-r),a.stroke(),a.lineTo(e,s-r),a.stroke(),a.closePath()}function nm(e,t){Xb&&(t&&Yb||!t&&Kb)&&im(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var sm=r(219),am=r(282);const om=Object(S.e)(),lm=Object(Ml.e)(),cm=Object(Ml.e)(),um=Object(S.e)(),dm=Object(Al.d)(),hm=Object(pu.c)(),pm=Object(fu.c)(),fm=Object(S.e)(),bm=Object(P.k)();class mm{constructor(){this.aabr=Object(P.k)(),this.distance=0,this.culled=!1,this.visible=!1}}class gm{constructor(e,t,r={}){this.graphics3DGraphic=e,this.slicePlaneEnabled=t,this.info=r}}class ym{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class vm{}class Om{constructor(){this.sortArray=new Wb.a({allocator:e=>e||new vm})}}class jm{constructor(){this.camera=new Hd.a,this.slicePlane=Object(A.b)(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Object(A.d)(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let _m=class extends N.a{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new jm,this._state=0,this.graphics=new ym,this.iterators=new Om,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return 0!==this._state||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/4;return this._dirty?.5*e:e}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(e){switch(this._state){case 0:this.startUpdate(),e.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(e))return;case 2:if(this._state=2,!this.sortVisibleGraphics(e))return;case 3:if(this._state=3,!this.deconflictVisibleGraphics(e))return;default:(function(e,t){if(!Jb||!Zb)return;rm();const r=Zb;let i=0;for(let n=0;n<e.accBinsNumX;n++)for(let t=0;t<e.accBinsNumY;t++){const s=e.accBins[n][e.accBinsNumY-1-t];i+=s.length;const a=n*e.accBinsSizeX,o=(n+1)*e.accBinsSizeX,l=t*e.accBinsSizeY,c=(t+1)*e.accBinsSizeY;r.fillText(s.length.toFixed(),a+5,l+15),im(a,o,l,c,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+t.size,70,50),r.fillText("total numTests: "+e.accNumTests,70,30)})(this,this.graphics.visible),this._state=0,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach((e=>this.addToActiveGraphics(e))):e.forEach((e=>this.removeFromActiveGraphics(e))),this.setDirty()}layerSupportsDeconfliction(e){if(Object(b.i)(e)||"object3d"!==e.type)return!1;const t=e.stageObject;return 1===(t?t.getNumGeometryRecords():0)&&t.getGeometryRecord(0).material instanceof am.a}startUpdate(){tm(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this.initBins(e,t),this.resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new mm,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this.removeFromVisibleGraphics(e),function(e,t){const r=e.graphics3DGraphic;r.destroyed||r.clearVisibilityFlag(3,t)}(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}processActiveGraphics(e){const t=this.ensureActiveGraphicsIterator(),r=Object(Pl.a)(dm,this._runningViewState.camera.projectionMatrix),i="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._runningViewState.camera.relativeElevation>0?hm:null;let n=0;for(Object(b.j)(i)&&(Object(Cl.s)(i,S.b,this._runningViewState.camera.viewMatrix),i[3]=Object(M.e)(this.view.spatialReference).radius,n=Object(pu.d)(i,S.b));!e.done;){e.madeProgress();const s=t.next();if(s.done)return this.resetActiveGraphicsIterator(),!0;const a=s.value,o=a&&a.info[this.visibilityGroup];o&&(this.collectGraphics3DGraphics(a,r,i,n),o.culled?this.removeFromVisibleGraphics(a):this.addToVisibleGraphics(a))}return!1}sortVisibleGraphics(e){const t=this.ensureSortGraphicsIterator();for(;!e.done;){const r=t.next();if(e.madeProgress(),r.done)return this.resetSortGraphicsIterator(),!0}return!1}deconflictVisibleGraphics(e){const t=this.ensureVisibleGraphicsIterator(),r=1===this.visibilityGroup;for(;!e.done;){e.madeProgress();const i=t.next();if(i.done)return this.resetVisibleGraphicsIterator(),!0;const n=i.value,s=n.info[this.visibilityGroup];if(!s||s.culled)continue;const a=n.graphics3DGraphic,o=(!r||a.isVisible())&&!this.isConflicted(n);o&&this.addToBins(n),s.visible=o,this.setGraphicVisibility(n,o),nm(s,o)}return!1}resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=wm(this.graphics.active)),this.iterators.active}resetActiveGraphicsIterator(){this.iterators.active=null}ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=wm(this.graphics.visible)),this.iterators.visible}resetVisibleGraphicsIterator(){this.iterators.visible=null}ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=function*(e,t,r){t.clear(),e.forEach(((e,i)=>{const n=t.pushNew();n.id=i,n.prio=e.info?-e.info[r].distance:Number.MAX_VALUE})),yield;const i=t.iterableSort(((e,t)=>t.prio-e.prio));for(let n=i.next();!n.done;n=i.next())yield;t.forAll((t=>{const r=e.get(t.id);r&&(e.delete(t.id),e.set(t.id,r))})),t.clear()}(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}resetSortGraphicsIterator(){this.iterators.sort=null}collectGraphics3DGraphics(e,t,r,i){const n=e.graphics3DGraphic;if(n.destroyed)return;const s=e.info[this.visibilityGroup];if(!n.isVisible(0,3))return void(s.culled=!0);const a=this.getGraphicsLayers(n);Object(P.m)(s.aabr);let o=null;for(const l of a){if(!this.layerSupportsDeconfliction(l))continue;const n=l.stageObject.getGeometryRecord(0).material;if(Object(b.i)(o)){if(o=this.getProjectionInfo(l,t,Sm),o.isOutsideScreen||this.isCulledBySlice(e,om)||Object(b.j)(r)&&this.isCulledByHorizon(o,r,i))return void(s.culled=!0);!$b.a.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&s.visible&&(o.distance*=.7)}this.expandBoundingRect(s,l,n,o)}Object(b.i)(o)?s.culled=!0:(s.distance=o.distance,s.culled=!1)}getProjectionInfo(e,t,r){const i=this._runningViewState.camera,n=e.stageObject,s=n.getGeometryRecord(0),a=s.material,o=Object(pu.g)(n.boundingVolumeWorldSpace.bounds);Object(Cl.s)(om,o,i.viewMatrix);const l=s.geometry.vertexAttributes,c=l.get("normal").data,u=l.get("auxpos1").data;return a.applyShaderOffsetsView(om,c,n.transformation,u,i,r.scaleInfo,om),Object(rc.l)(lm,om[0],om[1],om[2],1),Object(rc.m)(cm,lm,i.projectionMatrix),Object(Cl.g)(r.positionNDC,cm,1/cm[3]),a.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,um),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(um[2]),r.distance=um[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),Object(rc.l)(cm,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),Object(rc.m)(lm,cm,t),Object(rc.b)(lm,lm,1/lm[3]),Object(Cl.y)(r.positionView,om[0],om[1],om[2]),r}isCulledByHorizon(e,t,r){return Object(Cl.m)(pm.direction,e.positionView),Object(Cl.y)(pm.origin,0,0,0),!!Object(pu.i)(t,pm,fm)&&e.distanceWithoutPolygonOffset>r}isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&Object(A.f)(this._runningViewState.slicePlane,t)}expandBoundingRect(e,t,r,{positionNDC:i,scaleInfo:n}){const s=this._runningViewState.camera,a=t.getScreenSize(xm);Object(sm.a)(a,n.factor,a),a[0]*=s.pixelRatio,a[1]*=s.pixelRatio;const o=Object(P.x)(r.calculateRelativeScreenBounds(a,n.factorAlignment.scale,bm),Object(Bt.m)(0,s.fullWidth,.5+.5*i[0]),Object(Bt.m)(0,s.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(0!==l){const e=l*Math.min(Object(P.A)(o),Object(P.t)(o));o[0]-=e,o[1]-=e,o[2]+=e,o[3]+=e}Object(P.o)(e.aabr,o)}isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,r=e.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this.accBinsSizeX);i<=Math.floor(r.aabr[2]/this.accBinsSizeX);i++)if(!(i<0||i>=this.accBinsNumX))for(let e=Math.floor(r.aabr[1]/this.accBinsSizeY);e<=Math.floor(r.aabr[3]/this.accBinsSizeY);e++){if(e<0||e>=this.accBinsNumY)continue;const n=this.accBins[i][e];for(let e=0;e<n.length;e++){const i=n.data[e],s=i.info[this.visibilityGroup];if(s&&s.visible&&i.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,Object(P.v)(s.aabr,r.aabr)))return!0}}return!1}initBins(e,t){if(null==this.accBins){this.accBins=[];for(let e=0;e<this.accBinsNumX;e++){this.accBins.push([]);const e=this.accBins[this.accBins.length-1];for(let t=0;t<this.accBinsNumY;t++)e.push(new Wb.a)}}else for(let r=0;r<this.accBinsNumX;r++)for(let e=0;e<this.accBinsNumY;e++)this.accBins[r][e].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}addToBins(e){const t=e.info[this.visibilityGroup],r=Math.floor(t.aabr[0]/this.accBinsSizeX),i=Math.floor(t.aabr[2]/this.accBinsSizeX),n=Math.floor(t.aabr[1]/this.accBinsSizeY),s=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let a=r;a<=i;a++)if(!(a<0||a>=this.accBinsNumX))for(let t=n;t<=s;t++)t<0||t>=this.accBinsNumY||this.accBins[a][t].push(e)}setGraphicVisibility(e,t){const r=e.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(3,t,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(r,t))}};function*wm(e){if(Map.prototype.entries){const t=e.entries();for(let e=t.next();!e.done;e=t.next())yield e.value[1]}else yield*e.values()}Object(i.a)([Object(j.b)({constructOnly:!0})],_m.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:Boolean,readOnly:!0})],_m.prototype,"updating",null),_m=Object(i.a)([Object(w.a)("esri.views.3d.layers.graphics.Deconflictor")],_m);const xm=Object(tc.b)();const Sm=new class{constructor(){this.positionView=Object(S.e)(),this.positionNDC=Object(S.e)(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}};let Tm=class extends _m{constructor(){super(...arguments),this.visibilityGroup=1,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(2===e.state||t-this._lastDeconfliction>2e3)&&(super.runTask(e),0===this.state&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};Object(i.a)([Object(j.b)({constructOnly:!0})],Tm.prototype,"parent",void 0),Tm=Object(i.a)([Object(w.a)("esri.views.3d.layers.graphics.LabelDeconflictor")],Tm);var Cm=r(80);let Mm=class extends _m{constructor(){super(...arguments),this._handles=new F.a,this._contexts=new Map,this._viewState=new jm,this.visibilityGroup=0,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([this.view.watch("state.camera",(()=>{this.updateViewState(),this.setDirty()})),this.view.watch("map.ground.opacity",((e,t)=>{1!==e&&1!==t||this.setDirty()})),Object(y.a)(this.view,"slicePlane",(()=>{this.updateSlicePlane(),this.slicePlaneChanged()}))]),this._frameTask=this.view.resourceController.scheduler.registerTask(Cm.b.GRAPHICS_DECONFLICTOR,this),this._labels=new Tm({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const r=!(this._graphicSupportsDeconfliction(t)&&Pm(e));t.setVisibilityFlag(3,r,0)}updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this.updateSlicePlane())}updateSlicePlane(){const e=this.view?this.view.slicePlane:null;Object(b.j)(e)&&Object(A.k)(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=Object(b.j)(e)}slicePlaneChanged(){Object(Na.b)(this._contexts,((e,t)=>t.symbolCreationContext.slicePlaneEnabled))&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return null==t&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:r=>this.addGraphic(e,t,r),removeGraphic:e=>this.removeGraphic(t,e),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach((e=>this.removeGraphic(t,e.graphics3DGraphic)))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach((e=>this.removeGraphic(t,e.graphics3DGraphic))),this._contexts.delete(e),this.setDirty())}addGraphic(e,t,r){const i=r.graphic.uid,n=new gm(r,e.symbolCreationContext.slicePlaneEnabled);t.set(i,n),Pm(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}removeGraphic(e,t){const r=t.graphic.uid,i=e.get(r);i&&(this.removeFromActiveGraphics(i),this._labels.removeFromActiveGraphics(i),e.delete(r),this.setDirty())}enabledChanged(e,t){const r=Pm(e);r||function(e){const t=e.graphics3DGraphics;t&&t.forEach((e=>e.clearVisibilityFlag(3)))}(e),this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(e,t){const r=e.symbolCreationContext.slicePlaneEnabled;t.forEach((e=>e.slicePlaneEnabled=r)),this.setDirty()}getGraphicsLayers(e){return e._graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e._graphics;if(!t||!t.length)return!1;for(const r of t)if(this.layerSupportsDeconfliction(r))return!0;return!1}};function Pm(e){const t=e.layer;return!(!t||!t.featureReduction||"selection"!==t.featureReduction.type)}Mm=Object(i.a)([Object(w.a)("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Mm);var Am=r(102),Em=r(339),Rm=r(669),Im=r(218),Dm=r(663),Fm=r(642),Lm=r(627),km=r(646);function zm(e){return e instanceof km.a?e.graphics3DSymbol:e instanceof Lm.a?e:null}var Vm=r(22);const Nm=f.a.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Um(e){const t=function(e){const t=e.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=e,n=zm(i.graphics3DSymbol),s=Object(b.j)(n)?n.symbol:null,a=$m[t]||qm(e);return"point-3d"===s.type&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Wm(s.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||"point-3d"===s.type&&s.supportsCallout()&&s.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:function(e){switch(e){case"above-center":return!0;default:return!1}}(a.placement)?{placement:"above-center",verticalOffset:Wm(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(Nm.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null)}(e);if(Object(b.i)(t))return null;const r=function(e,t){if(t.anchor)return t;const r=e.labelClass.labelPlacement,i=$m[r],n=i||qm(e);return r&&!i&&Nm.warnOncePerTick(`the requested label placement '${r}' is not currently supported in SceneView`),function(e,t){const r=t.graphics3DGraphic.graphic.geometry;if(Object(b.i)(r))return null;if(Object(b.j)(t.disablePlacement))return t.labelClass.labelPlacement?(Nm.warnOncePerTick(Gm(e.placement,t.disablePlacement.logEntityDescription)),qm(t)):e;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return Nm.warnOncePerTick(Gm(e.placement,`'${i}' geometries`)),qm(t);break;case"point":case"mesh":return e}return e}(n,e)}(e,t);if(Object(b.i)(r))return null;const i=r.anchor,n=!!t.hasLabelVerticalOffset;return function(e,t,r){const i=r.graphics3DGraphic.graphic.geometry;if(Object(b.i)(i))return null;switch(i.type){case"point":!function(e,t,r){const i=Bm(r);if(Object(b.i)(i))return;const n=r.graphics3DGraphic._graphics[0];switch(Object(b.j)(n)?n.getCenterObjectSpace(e.translation):Object(Cl.y)(e.translation,0,0,0),i.type){case"icon":case"text":!function(e,t,r,i){const{graphics3DGraphic:n}=r,s=Object(b.j)(i)?i.getScreenSize():null;if(!n.isDraped&&Object(b.j)(s)){const i=function(e,t=Xm){const{graphics3DGraphic:r}=e,i=r._graphics[0],n=Object(b.j)(i)?i.stageObject.geometryRecords[0].material:null;if(n&&n instanceof am.a){const e=n.params.anchorPos;t[0]=2*(e[0]-.5),t[1]=2*(e[1]-.5)}else t[0]=0,t[1]=0;return t}(r);Zm[0]=s[0]/2*(t.normalizedOffset[0]-i[0]),Zm[1]=s[1]/2*(t.normalizedOffset[1]-i[1]),e.screenOffset[0]=Zm[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=Zm[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=Zm[1]}else e.hasLabelVerticalOffset||"center"===e.anchor||($m[r.labelClass.labelPlacement]&&Nm.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}(e,t,r,n);break;case"object":Hm(e,t,n)}}(e,t,r);break;case"polygon":!function(e,t,r){const i=Bm(r);if(!Object(b.i)(i))switch(i.type){case"extrude":{const i=r.graphics3DGraphic._graphics[0];Object(b.j)(i)?(i.getBoundingBoxObjectSpace(Jm),Object(Vm.e)(Jm,e.translation),e.translation[2]=Object(Vm.u)(Jm)/2):Object(Cl.y)(e.translation,0,0,0),Hm(e,t,i);break}}}(e,t,r);break;case"mesh":Hm(e,t,r.graphics3DGraphic._graphics[0])}return e}({anchor:i,verticalOffset:t.verticalOffset,screenOffset:Object(tc.b)(),centerOffset:Object(Ml.g)(0,0,0,-1),centerOffsetUnits:"world",translation:Object(S.e)(),elevationOffset:0,hasLabelVerticalOffset:n},r,e)}function Bm(e){const t=zm(e.graphics3DGraphic.graphics3DSymbol);return Object(b.j)(t)?t.symbol.symbolLayers.getItemAt(0):null}function Gm(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView`}function qm(e){const t=e.graphics3DGraphic.graphic.geometry;if(Object(b.i)(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const t=Bm(e);return Object(b.j)(t)&&"extrude"===t.type?$m["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return $m["above-center"];default:return}}function Hm(e,t,r){const i=Object(b.j)(r)?r.getBoundingBoxObjectSpace(Jm):Jm,n=Object(S.g)(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);e.centerOffset[0]=s/2*t.normalizedOffset[0];const a=e.translation[2],o=n[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=a+o;const l=Object(Cl.r)(n);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function Wm(e){const{screenLength:t,minWorldLength:r,maxWorldLength:i}=e;return{screenLength:t,minWorldLength:r,maxWorldLength:i}}const $m={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Qm={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const nA in Qm){const e=Qm[nA],t=$m[nA];e.forEach((e=>{$m[e]=t}))}Object.freeze&&(Object.freeze($m),Object.keys($m).forEach((function(e){Object.freeze($m[e]),Object.freeze($m[e].normalizedOffset)})));const Zm=[0,0],Xm=[0,0],Jm=Object(Vm.h)();class Ym{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,t){this._materials.set(e,t),this._stage.add(t)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}var Km,eg=r(440),tg=r(530),rg=r(171);const ig=4096;let ng=Km=class extends N.a{constructor(e){super(e),this.type=4,this.id=Object(rg.b)(),this.events=new zi.a,this.glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this.create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(e),this.update2DCanvasSize(),this.resetAtlasCursor()}unload(){Object(b.j)(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}createDescriptor(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}load(e){if(Object(b.j)(this.glTexture))return this.glTexture;this.glTexture=new $l.a(e,this.createDescriptor(e),this.canvas);const t=this.view.resourceController.scheduler;return this.frameWorker=t.registerTask(Cm.b.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this.glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=Object(b.r)(this.frameWorker),this.glTexture&&(this.stage.remove(this),this.glTexture=null),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",512..toString()),e.setAttribute("height",512..toString()),e}update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}createAtlasRegion(e=512){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}computeAtlasResolution(e,t){let r=Math.max(e,t);return r+=256,r=Object(Bt.p)(r),r=Math.min(r,ig),r}resizeAtlas(e,t){t=t||e;const r=this.atlas;r.size.width=e,r.size.height=t,Object(b.j)(this.glTexture)&&this.glTexture.resize(e,t),this.update2DCanvasSize()}resetAtlasCursor(){const e=this.atlas;e.cursor.x=sg,e.cursor.y=sg+ag,e.lineHeight=0,this.needsClear=!0}getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,r=this.elements.size;return this.getAtlasUsage()/r*(r+t-e)}addAtlasElement(e,t,r,i){const n=this.atlas,{renderedWidth:s,renderedHeight:a,displayWidth:o,displayHeight:l}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,e.placement.size.width=s,e.placement.size.height=a,e.placement.size.displayWidth=o,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+s)/n.size.width,1-e.placement.offset.y/n.size.height],n.cursor.x+=r,n.lineHeight=Math.max(n.lineHeight,i),this.elements.set(t,e)}removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,r=e.placement.size;this.ctx.clearRect(t.x,t.y,r.width,r.height),this.elements.delete(e.textId)}}ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const r=new Set;return this.stageObjects.set(e,r),r}addStageObject(e,t){this.ensureStageObjects(e).add(t)}removeStageObject(e,t){const r=this.stageObjects.get(e);r&&r.delete(t)&&(t.geometries[0].vertexAttributes.get("size").data=[0,0],t.geometryVertexAttrsUpdated(0))}_processAddition(e,t){const r=this.atlas,i=e.textId,n=e.textRenderer.renderedWidth,s=e.textRenderer.renderedHeight,a=n+sg,o=s+sg+ag;if(r.cursor.x+a<r.size.width&&r.cursor.y+o<r.size.height)this.addAtlasElement(e,i,a,o),this.elementsToRender.set(i,e),this.elementsToAddOrUpdate.delete(i);else{if(!(r.cursor.y+o+r.lineHeight<r.size.height)){const e=this.getExpectedAtlasUsage(),i=e>.85&&r.size.width<ig;return i&&this.resizeAtlas(2*r.size.width,2*r.size.height),!t||!i&&e>.95&&r.size.width===ig?(this.processRemovals(),0):(this.repack(),1)}r.cursor.x=sg,r.cursor.y+=r.lineHeight,r.lineHeight=0,this.addAtlasElement(e,i,a,o),this.elementsToRender.set(i,e),this.elementsToAddOrUpdate.delete(i)}return 0}processRemovals(){this.elementsToRemove.forEach(((e,t)=>{const r=this.stageObjects.get(t);r&&0!==r.size||this.removeAtlasElement(e),r&&0===r.size&&this.stageObjects.delete(t)})),this.elementsToRemove.clear()}repack(){this.processRemovals(),this.elements.forEach(((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)})),this.elements.clear(),this.resetAtlasCursor(),this.elementsToRender.clear()}processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach((t=>{t.geometries[0].vertexAttributes.get("uv0").data=new Float32Array(e.placement.uvMinMax),t.geometries[0].vertexAttributes.get("size").data=[e.placement.size.displayWidth,e.placement.size.displayHeight],t.geometryVertexAttrsUpdated(0)})),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this.glTexture)return;let r=!1;if(Object(Na.b)(this.elementsToAddOrUpdate,((e,i)=>{const n=this.elements.get(i);if(n&&n.rendered){const e=this.stageObjects.get(i);return e&&e.forEach((e=>{const t=e.geometries[0].vertexAttributes,r=this.elements.get(i);t.get("uv0").data=new Float32Array(r.placement.uvMinMax),t.get("size").data=new Float32Array([r.placement.size.displayWidth,r.placement.size.displayHeight]),e.geometryVertexAttrsUpdated(0)})),this.elementsToAddOrUpdate.delete(i),!1}return 1===this._processAddition(this.elementsToAddOrUpdate.get(i),t)&&(r=!0,!0)})),r)return void this.runTask(Cm.d,!1);let i=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),Object(Na.b)(this.elementsToRender,((t,r)=>(this.processRenderingRequest(t),this.elementsToRender.delete(r),i=!0,e.madeProgress(),e.done))),i&&Object(b.j)(this.glTexture)&&this.glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&Km.test.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const r=e.key;this.elementsToAddOrUpdate.has(r)||this.elementsToAddOrUpdate.set(r,{textId:r,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this.addStageObject(r,t),this.elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,t){const r=e.key;this.elementsToRemove.set(r,this.elements.get(r)),this.removeStageObject(r,t)}setDirty(){this.updating=!0}repackOrdered(){if(0===this.elements.size)return;const e=[];this.elements.forEach(((t,r)=>e.push({element:t,key:r})));let t=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort(((e,t)=>e.key.localeCompare(t.key))),this.elements.clear();for(const{element:t,key:r}of e)this.elements.set(r,t);this.repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:r,atlas:i}=this,n=this;return{elements:e,stageObjects:t,elementsToRemove:r,atlas:i,resizeAtlas:(e,t)=>n.resizeAtlas(e,t),run:(e,t)=>n.runTask(e,t)}}};ng.test={orderedRepackingEnabled:!1},Object(i.a)([Object(j.b)({constructOnly:!0})],ng.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:Boolean})],ng.prototype,"updating",void 0),ng=Km=Object(i.a)([Object(w.a)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],ng);const sg=2,ag=2;var og=ng,lg=r(267);const cg=f.a.getLogger("esri.views.3d.layers.graphics.Labeler");let ug=class extends N.a{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new F.a,this._handles.add([this.view.watch("state.camera",(()=>this.setDirty())),this.view.watch("pixelRatio",(()=>this._resetAllLabels())),this.view.resourceController.scheduler.registerTask(Cm.b.LABELER,this)]),this._textTextureAtlas=new og({view:this.view}),this._hudMaterialCollection=new Ym(this.view._stage),this._calloutMaterialCollection=new Ym(this.view._stage)}dispose(){this._handles=Object(b.e)(this._handles),this._textTextureAtlas=Object(b.f)(this._textTextureAtlas),this._hudMaterialCollection=Object(b.f)(this._hudMaterialCollection),this._calloutMaterialCollection=Object(b.f)(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach(((e,t)=>{this._labels.set(t,e),e.graphics3DGraphic.setVisibilityFlag(0,!0,1)})),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach(((e,t)=>{e.graphics3DGraphic.setVisibilityFlag(0,!1,1),this.setLabelGraphicVisibility(e.graphics3DGraphic,!1),this._labels.delete(t)})),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];r&&this._textTextureAtlas.addTextTexture(r,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];r&&this._textTextureAtlas.removeTextTexture(r,t.stageObject)}e.rendered=!1}get running(){var e;return!!this.view.ready&&(this._dirty||(null==(e=this._textTextureAtlas)?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(dg(t)){if(!pg(t)){if(fg(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),hg(t)){this._dirty=!0;continue}if(!pg(t))continue}Object(Na.b)(t.labelsToInitialize,((r,i)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(i,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.hasTextTextureResources||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(i),e.madeProgress()),e.done)))&&(this._dirty=!0)}this._labelsToRemove.forEach((e=>this._removeLabelTextureFromAtlas(e))),this._labelsToAdd.forEach((e=>this._addLabelTextureToAtlas(e))),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),Object(m.x)(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,i=r.layer,n=i.labelingInfo&&i.labelingInfo.filter((e=>!!e.symbol));if(!n||0===n.length)return;const s=new Array(n.length);let a=!1;await Object(Am.b)(n,(async(i,n)=>{const o=i.symbol,l=zm(r.getOrCreateGraphics3DSymbol(o));if(Object(b.i)(l))return void cg.error("Failed to create Graphics3DSymbol for label");await l.load(),Object(m.x)(t);let c=null;Object(Im.d)(o)&&o.hasVisibleCallout()&&(c=Object(Dm.a)(o,r.symbolCreationContext),await c.load(),Object(m.x)(t));const u=await Object(Am.d)(Object(Rm.createLabelFunction)(i,e.layer.fieldsIndex,this.view.spatialReference));Object(m.x)(t),!0===u.ok?s[n]={labelClass:i,labelFunction:u.value,graphics3DSymbol:l,graphics3DCalloutSymbolLayer:c,calloutSymbolLayerIndex:0,textRenderParameters:this._createTextRenderParameters(l.symbol)}:(cg.error(`Label expression failed to evaluate: ${u.error}`),a=!0)})),Object(m.x)(t),a||(e.labelClassContexts=s)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch((t=>{if(Object(m.n)(t))throw t;e.labelClassContexts=null})).then((()=>{e.labelClassAbortController=null,this.notifyChange("updating")})).catch((()=>{})),this.notifyChange("updating")),e.labelClassPromise}_createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&"text"===t.type?tg.a.fromSymbol(t,this.view.pixelRatio):null}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced,r.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=Object(m.e)(),t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,r,i,n){const s={text:e.text,centerOffset:r.centerOffset,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,anchor:r.anchor,centerOffsetUnits:r.centerOffsetUnits,verticalOffset:r.verticalOffset,debugDrawBorder:$b.a.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return bg.graphic=t,bg.renderingInfo=null,bg.layer=i,n.createLabel(bg,s,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,r,i,n){const s={symbol:t,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffset:i.centerOffset,centerOffsetUnits:i.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return bg.graphic=e,bg.renderingInfo=s,bg.layer=n,r.createGraphics3DGraphic(bg)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,i=r.labelClassContexts;if(!i||0===i.length||!r.emptySymbolLabelSupported&&0===t._graphics.length)return!1;let n=!1;const s=t.graphic,a=r.layer,o=Object(I.a)(r.layer),l=this.view._stage;for(let c=0;c<i.length;c++){const u=e.textRenderers[c];if(!u)continue;const d=i[c],h=d.graphics3DSymbol;let p=null;h.symbol&&"label-3d"===h.symbol.type&&(p=h.symbol);const f=h.symbolLayers[0];if(!f)continue;const m=d.labelClass,g=Um({graphics3DGraphic:t,labelSymbol:p,labelClass:m,disablePlacement:r.disablePlacement});if(Object(b.i)(g))continue;f.setElevationInfoOverride(r.elevationInfoOverride);const y=this._createTextSymbolGraphic(u,s,g,a,f);if(!y)return!1;y._labelClass=m,y._labelIndex=c,t.addLabelGraphic(y,l,r.stageLayer),t.setVisibilityFlag(0,o,1),t.clearVisibilityFlag(1,1),t.setVisibilityFlag(3,!1,1),n=!0;const v=d.graphics3DCalloutSymbolLayer;if(v&&g.hasLabelVerticalOffset){v.setElevationInfoOverride(r.elevationInfoOverride);const e=this._createLineCalloutGraphic(s,p,v,g,a);e&&(d.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(e,l,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelGraphics){if(null==r._labelClass)continue;const e=t[r._labelIndex].graphics3DSymbol.symbolLayers[0];null!=e&&e.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.hasTextTextureResources)return;const t=e.labelingContext,r=t.labelClassContexts;if(!r||0===r.length)return;const i=e.graphics3DGraphic.graphic;for(let s=0;s<r.length;s++){const a=r[s];if(e.textRenderers[s]=null,!a.textRenderParameters)continue;const o=a.labelFunction;let l;if("arcade"===o.type)try{const e=o.needsHydrationToEvaluate()?Object(Em.c)(i,t.layer):i;l=o.evaluate(e)}catch(n){l=null}else l=o.evaluate(i);Object(b.i)(l)||""===l||/^\s+$/.test(l)||(e.textRenderers[s]=new eg.a(l,a.textRenderParameters))}e.hasTextTextureResources=!0}_destroyTextTextureResources(e){e.textRenderers=[],e.hasTextTextureResources=!1}_addGraphic(e,t){const r={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textRenderers:[]},i=t.graphic.uid;e.labels.set(i,r),e.labelsToInitialize.set(i,r),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const r=t.graphic.uid,i=e.labels.get(r);i&&(this._destroyGraphic(i,r),e.labels.delete(r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.hasTextTextureResources&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of t){const t=e.labels.get(r);t&&(this._removeGraphic(e,t.graphics3DGraphic),this._addGraphic(e,t.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const r of t.labelClassContexts){const i=new Map;t.labels.forEach((e=>{const t=e.graphics3DGraphic;i.set(t.graphic.uid,t)}));const n=e=>e.labelGraphics[0];if(Object(b.s)(r.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(e,i,n),r.graphics3DCalloutSymbolLayer){const t=e=>e.labelGraphics[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,i,t)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach(((t,r)=>{this._destroyGraphic(t,r),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(r,t)})),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,r){const i=r&&r.emptySymbolLabelSupported||!1,n=r&&r.elevationInfoOverride||null,s=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,o={graphics3DCore:e,layer:a,scaleVisibility:t,emptySymbolLabelSupported:i,elevationInfoOverride:n,disablePlacement:s,active:a.labelsVisible,labelClassPromise:null,labelClassAbortController:Object(m.e)(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new lg.a({isPickable:!0},a.uid)};return this.view._stage.add(o.stageLayer),this._labelingContexts.push(o),this.setDirty(),{addGraphic:e=>this._addGraphic(o,e),removeGraphic:e=>this._removeGraphic(o,e),featureReductionChange:()=>{},layerLabelsEnabled:()=>Object(I.a)(o.layer),labelingInfoChange:e=>this._labelingInfoChange(o,e),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",o),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",o),visibilityInfoChange:()=>this._visibilityInfoChange(o),reset:()=>this._resetLabels(o),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const r=this._labelingContexts.indexOf(t);this._labelingContexts.splice(r,1),t.labels.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic))),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const r=e.graphic.uid,i=this._labels.get(r);i&&i.visible!==t&&(t&&!i.rendered?(this._labelsToAdd.set(r,i),this._labelsToRemove.delete(r),i.hasTextTextureResources||i.labelingContext.labelsToInitialize.set(r,i)):!t&&i.rendered&&(this._labelsToRemove.set(r,i),this._labelsToAdd.delete(r)),i.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||(null==(e=this._textTextureAtlas)?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some((e=>hg(e)))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce(((e,t)=>e+(hg(t)?0:1)),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function dg(e){return e.active&&Object(I.a)(e.layer)}function hg(e){return e.labelClassPromise&&!!e.labelClassAbortController}function pg(e){return e.labelClassContexts&&e.labelClassContexts.length}function fg(e){return null===e.labelClassContexts}Object(i.a)([Object(j.b)({constructOnly:!0})],ug.prototype,"view",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],ug.prototype,"deconflictor",void 0),Object(i.a)([Object(j.b)()],ug.prototype,"_textTextureAtlas",void 0),Object(i.a)([Object(j.b)({type:Boolean,readOnly:!0})],ug.prototype,"updating",null),ug=Object(i.a)([Object(w.a)("esri.views.3d.layers.graphics.Labeler")],ug);const bg=new Fm.a(null,null,null);var mg=r(486),gg=r(489),yg=r(439);class vg{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new F.a}loadGLTF(e,t,r){const i=r?`gltfPBR:${e}`:`gltf:${e}`;return this.fromCache(this.gltfCache,i,(t=>Object(gg.a)(new mg.a(t.streamDataRequester),e,t,r)),t)}loadWOSR(e,t){const r=`wosr:${e}:${t.disableTextures}`;return this.fromCache(this.wosrCache,r,(t=>Object(yg.a)(e,t)),t)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}fromCache(e,t,r,i){return new Promise(((n,s)=>{if(Object(m.o)(i))return void s(Object(m.f)());const a=Object(m.s)(i,(()=>{this.remove(e,t),s(Object(m.f)())})),o=e.get(t);if(o)return this.evictHandles.remove(t),o.refCount++,void o.item.then(n,s);const l=Object(m.e)(),c={...i,signal:l.signal},u={refCount:1,abortController:l,item:r(c).then((r=>(u.abortController=null,r.remove=()=>this.remove(e,t),r)))};e.set(t,u),u.item.then((e=>{Object(b.j)(a)&&a.remove(),n(e)}),(e=>{Object(b.j)(a)&&a.remove(),s(e)}))}))}remove(e,t){const r=e.get(t);r&&(r.refCount--,0===r.refCount&&this.evictHandles.add(Object(h.c)((()=>{e.delete(t),Object(b.j)(r.abortController)&&r.abortController.abort()}),Og),t))}}let Og=1e4;class jg{constructor(e,t,r,i=null){this.lij=[0,0,0],this.extent=Object(P.k)(),this.resolution=0,this.loadPriority=0,this.measures={visibility:2,screenRect:Object(P.k)(),distance:0,shouldSplit:!1},this.used=!1,i&&this.acquire(e,t,r,i)}acquire(e,t,r,i){this.tilingScheme=i,this.id=jg.id(e,t,r),this.lij[0]=e,this.lij[1]=t,this.lij[2]=r,i.getExtent(e,t,r,this.extent),this.resolution=i.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const t=this.lij[0]+1,r=2*this.lij[1],i=2*this.lij[2];return e?(e[0].acquire(t,r,i,this.tilingScheme),e[1].acquire(t,r+1,i,this.tilingScheme),e[2].acquire(t,r,i+1,this.tilingScheme),e[3].acquire(t,r+1,i+1,this.tilingScheme),e):[new jg(t,r,i,this.tilingScheme),new jg(t,r+1,i,this.tilingScheme),new jg(t,r,i+1,this.tilingScheme),new jg(t,r+1,i+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Object(P.y)(e.measures.screenRect,this.measures.screenRect)}static id(e,t,r){return`${e}/${t}/${r}`}}var _g=r(432),wg=r(104),xg=r(105);class Sg{constructor(e){this.renderCoordsHelper=e,this.frustum=Object(xg.c)(),this._points=Object(xg.d)(),this.lines=new Array(12),this._origin=Object(S.e)(),this._direction=Object(S.e)(),this._altitude=null;for(let t=0;t<12;t++)this.lines[t]={origin:null,direction:Object(S.e)(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(e){Object(xg.e)(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),Object(Cl.m)(this._origin,e.eye),Object(Cl.m)(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this.updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)Object(Cl.m)(this._points[t],e[t]);Object(xg.a)(this.frustum,this._points),this.updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Object(xg.j)(this.frustum,e)}intersectsRay(e){return Object(xg.i)(this.frustum,e)}intersectsLineSegment(e,t){return Object(xg.g)(this.frustum,e,t)}intersectsPoint(e){return Object(xg.h)(this.frustum,e)}updateLines(){const e=this._points;for(let t=0;t<4;t++){const r=t+4;Tg(this.lines[t],e[t],e[r]),Tg(this.lines[t+4],e[t],3===t?e[0]:e[t+1]),Tg(this.lines[t+8],e[r],3===t?e[4]:e[r+1])}}}function Tg(e,t,r){e.origin=t,e.endpoint=r,Object(Cl.x)(e.direction,t,r)}Sg.planePointIndices=xg.k,Sg.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];var Cg=r(616);class Mg{constructor(e){this.renderCoordsHelper=e,this.surfaceElevation=0,this.cache=new Map,this.frustum=new Sg(e),this.extendedFrustum=new Sg(e),this.intersector=new Cg.a({renderCoordsHelper:e}),this.renderCoordsHelper=e}begin(e,t){this.surfaceElevation=t,this.aboveGround=this.renderCoordsHelper.getAltitude(e.eye)>t,this.frustum.update(e),this.shortenFrustumFarPlane(this.frustum),this.updateExtendedFrustum(e)}end(){this.cache.clear()}calculate(e){if(this.allTilesInvisible)return 0;const t=1===this.renderCoordsHelper.viewingMode&&e.lij[0]>=Pg&&e.lij[0]<Ag,r=this.getOrCalculateSingleTileVisibility(e,!t);return 0!==r&&t?this.calculateAggregatedChildrenVisibility(e):r}shortenFrustumFarPlane(e){const t=Sg.nearFarLineIndices,r=e.mutablePoints;for(const i of t){const[e,t]=i,n=r[e],s=r[t];Object(Cl.l)(Dg,s,n),Object(Cl.g)(Dg,Dg,Rg),Object(Cl.h)(r[t],n,Dg)}e.updatePoints(r)}calculateAggregatedChildrenVisibility(e){let t=0;const r=this.cache.get(e.id);if(null!=r)return r;const i=kg.acquire();e.getChildren(i);for(const n of i){const e=this.calculate(n);if(0!==e&&(t=e,2===e))break}return kg.release(i),this.cache.set(e.id,t),t}getOrCalculateSingleTileVisibility(e,t){const r=this.cache.get(e.id);if(null!=r)return r;const i=this.calculateSingleTileVisibility(e);return t&&this.cache.set(e.id,i),i}calculateSingleTileVisibility(e){return!this.aboveGround&&1===this.renderCoordsHelper.viewingMode&&e.lij[0]<Eg?0===this.calculateSingleTileVisibilitySided(e,!1)?this.calculateSingleTileVisibilitySided(e,!0):void 0:this.calculateSingleTileVisibilitySided(e,this.aboveGround)}calculateSingleTileVisibilitySided(e,t){this.intersector.update(e.extent,e.tilingScheme.spatialReference,this.surfaceElevation,t);const r=Object(M.e)(e.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,r)?this.intersector.isVisibleInFrustum(this.frustum,r,!0)?2:1:0}updateExtendedFrustum(e){this.extendedFrustum.update(e),this.shortenFrustumFarPlane(this.extendedFrustum);const t=this.renderCoordsHelper.worldUpAtPosition(e.eye,Dg);this.aboveGround||Object(Cl.u)(t,t);const r=Object(Bt.b)(-Object(Cl.j)(t,e.viewForward));if(this.allTilesInvisible=r>(Math.PI+e.fovY)/2,this.allTilesInvisible)return;if(this.hasExtendedFrustum=r>e.fovY/2,!this.hasExtendedFrustum)return;const i=this.extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let s=0;s<4;s++){const e=i.pointIndices[s],t=n[e],r=this.renderCoordsHelper.getAltitude(t);if(i.needsAltitudeAdjustment(r)){switch(this.renderCoordsHelper.worldUpAtPosition(t,Dg),e){case 4:case 7:case 0:case 3:Object(Uh.u)(this.extendedFrustum.planes[0],Dg,Dg);break;case 5:case 6:case 1:case 2:Object(Uh.u)(this.extendedFrustum.planes[1],Dg,Dg)}Object(Cl.g)(Dg,Dg,i.direction),this.renderCoordsHelper.intersectInfiniteManifold(Object(fu.g)(t,Dg),i.zWithMargin,t)}}if(this.extendedFrustum.updatePoints(n),Object(Uh.g)(n[0],n[1],n[2],Fg),Object(Uh.g)(n[1],n[2],n[3],Lg),Object(Cl.j)(Object(Uh.s)(Fg),Object(Uh.s)(Lg))<0){const e=this.extendedFrustum.mutablePoints;this.aboveGround?[e[0],e[1]]=[e[1],e[0]]:[e[3],e[2]]=[e[2],e[3]],this.extendedFrustum.updatePoints(e)}}extendedFrustumParameters(){return this.aboveGround?this.extendedFrustumParametersAboveSurface():this.extendedFrustumParametersBelowSurface()}extendedFrustumParametersAboveSurface(){const e=this.surfaceElevation-Ig;return{zWithMargin:e,pointIndices:Sg.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:t=>t>e}}extendedFrustumParametersBelowSurface(){const e=this.surfaceElevation+Ig;return{zWithMargin:e,pointIndices:Sg.planePointIndices.top,direction:1,needsAltitudeAdjustment:t=>t<e}}}const Pg=2,Ag=6,Eg=12,Rg=.95,Ig=1,Dg=Object(S.e)(),Fg=Object(Uh.d)(),Lg=Object(Uh.d)(),kg=new wg.a(Array,(e=>{4!==e.length&&(e[0]=new jg,e[1]=new jg,e[2]=new jg,e[3]=new jg)}),(e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()}));class zg{constructor(e){this.camera=new Hd.a,this.focusOnMap=[0,0],this.screenRect=Object(P.k)(),this.tileSize=e.tileSize,this.renderCoordsHelper=e.renderCoordsHelper,this.tilingScheme=e.tilingScheme,this.visibility=new Mg(e.renderCoordsHelper)}begin(e,t,r){this.camera.copyFrom(e),this.surfaceElevation=r,this.focusOnMap[0]=t.x,this.focusOnMap[1]=t.y,Object(P.s)(0,0,e.fullWidth,e.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)}end(){this.visibility.end()}updateTile(e){e.measures.visibility=this.visibility.calculate(e),e.measures.distance=Object(P.l)(e.extent,this.focusOnMap),0!==e.measures.visibility&&this.updateScreenMeasure(e)}updateScreenMeasure(e){const t=Ug,r=1<<t,i=e.measures.screenRect;Object(P.m)(i);let n=0;const s=e.lij[0]+t,a=e.lij[1]<<t,o=e.lij[2]<<t,l=this.tileSizeWithBias(e),c=l*l;for(let u=0;u<r;u++)for(let t=0;t<r;t++)if(n+=this.computeScreenArea(e,s,a+u,o+t,i),n>c)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}tileSizeWithBias(e){return 1===e.measures.visibility?this.tileSize*Bg:this.tileSize}computeScreenArea(e,t,r,i,n){const s=1===e.measures.visibility;this.projectToScreen(t,r,i,s,Gg),Object(P.m)(Vg);for(let a=0;a<4;a++)Object(P.p)(Vg,Gg[a]);return Object(P.o)(n,Vg),Object(P.u)(Vg,this.screenRect,Ng),Object(_g.a)(Gg[0],Gg[1],Gg[2])+Object(_g.a)(Gg[0],Gg[2],Gg[3])}projectToScreen(e,t,r,i,n){this.tilingScheme.ensureMaxLod(e),this.tilingScheme.getExtent(e,t,r,qg),this.toRenderCoords(qg,0,3,Wg[0]),this.toRenderCoords(qg,2,3,Wg[1]),this.toRenderCoords(qg,2,1,Wg[2]),this.toRenderCoords(qg,0,1,Wg[3]),i&&(this.projectToPlane(Wg,this.camera.frustum[4]),this.projectToPlane(Wg,this.camera.frustum[3]),this.projectToPlane(Wg,this.camera.frustum[2]));for(let s=0;s<4;s++)this.camera.projectToRenderScreen(Wg[s],Qg),this.camera.renderToScreen(Qg,n[s])}projectToPlane(e,t){for(let i=0;i<4;i++)$g[i]=Object(Uh.w)(t,e[i]);const r=Math.max($g[0],$g[1],$g[2],$g[3]);if(r>0){const i=Object(Cl.g)(Hg,Object(Uh.s)(t),-r);for(let t=0;t<4;t++)Object(Cl.h)(e[t],e[t],i)}}toRenderCoords(e,t,r,i){return Hg[0]=e[t],Hg[1]=e[r],Hg[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(Hg,this.tilingScheme.spatialReference,i),i}}const Vg=Object(P.k)(),Ng=Object(P.k)(),Ug=2,Bg=5,Gg=[Object(O.f)(),Object(O.f)(),Object(O.f)(),Object(O.f)()],qg=Object(P.k)(),Hg=Object(S.e)(),Wg=[Object(S.e)(),Object(S.e)(),Object(S.e)(),Object(S.e)()],$g=[0,0,0,0],Qg=Object(O.d)();var Zg=r(449);const Xg=f.a.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let Jg=class extends N.a{constructor(e){super(e),this.tiles=new l.a,this.tileSize=512,this._idToTile=new Map,this._handles=new F.a,this._clients=new Set,this._dirty=!1,this._newTiles=new Wb.a}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e&&!e.spatialReference.equals(this.viewState.spatialReference))return void Xg.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||t&&e&&t.equals(e))return;const r=e?e.clone():null;this._set("filterExtent",r),this._setDirty()}get filterExtentRect(){if(!this.filterExtent||!this.tilingScheme)return null;const e=Object(P.k)();return Object(Zg.b)(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add(this.watch(["tilingScheme","tileSize"],(()=>this._reset()),!0)),this._handles.add(Object(y.a)(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.contentCamera","focus.location"],(()=>this._setDirty()),!0)),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Cm.b.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Object(b.r)(this._frameWorker),this._handles=Object(b.e)(this._handles)}addClient(){const e=Yg++;return this._clients.add(e),1===this._clients.size&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Cm.d))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),Object(b.j)(this._frameWorker)&&(this._frameWorker.priority=Cm.b.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&Object(b.j)(this._frameWorker)&&(this._frameWorker.priority=Cm.b.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new zg({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map((e=>new jg(e[0],e[1],e[2],this.tilingScheme)))}_purgeHorizonTiles(e){e.sort(((e,t)=>{const r=e.measures.screenRect,i=t.measures.screenRect;return r[1]+r[3]-(i[1]+i[3])})),Object(P.m)(Kg);for(let t=0;t<e.length;t++)if(Object(P.o)(Kg,e.data[t].measures.screenRect),Object(P.t)(Kg)>ey)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!Object(P.v)(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),0!==t.measures.visibility&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const i of this.tiles.items)i.used=!1;const t=e.filter((e=>{const t=this._idToTile.get(e.id);return t?(t.copyMeasurementsFrom(e),t.used=!0):this._idToTile.set(e.id,e),!t})),r=this.tiles.items.filter((e=>!e.used&&(this._idToTile.delete(e.id),!0)));this.tiles.removeMany(r),this.tiles.addMany(t),this.sortTiles()}sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort(((e,t)=>e.measures.visibility!==t.measures.visibility?2===e.measures.visibility?-1:1:e.measures.distance-t.measures.distance)),this.tiles.forEach(((e,t)=>e.loadPriority=t))}};Object(i.a)([Object(j.b)({constructOnly:!0})],Jg.prototype,"scheduler",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Jg.prototype,"renderCoordsHelper",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Jg.prototype,"tilingSchemeOwner",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Jg.prototype,"cameraOnSurface",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Jg.prototype,"focus",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Jg.prototype,"viewState",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Jg.prototype,"terrain",void 0),Object(i.a)([Object(j.b)()],Jg.prototype,"tiles",void 0),Object(i.a)([Object(j.b)()],Jg.prototype,"tileSize",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Jg.prototype,"tilingScheme",null),Object(i.a)([Object(j.b)()],Jg.prototype,"filterExtent",null),Object(i.a)([Object(j.b)({readOnly:!0})],Jg.prototype,"filterExtentRect",null),Object(i.a)([Object(j.b)({readOnly:!0})],Jg.prototype,"rootTileIds",null),Object(i.a)([Object(j.b)({value:!1})],Jg.prototype,"suspended",null),Object(i.a)([Object(j.b)({readOnly:!0})],Jg.prototype,"updating",null),Jg=Object(i.a)([Object(w.a)("esri.views.3d.layers.support.FeatureTileTree3D")],Jg);let Yg=0;const Kg=Object(P.k)(),ey=10;var ty=Jg,ry=r(298),iy=r(197);let ny=class extends N.a{constructor(){super(...arguments),this._propertiesPool=new iy.a({camera:Hd.a},this),this._lastSeenCameraProjectionValues=new Hd.a,this.events=new zi.a,this.viewingMode=1,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new il({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new iy.a({camera:Hd.a},this)}createInitialCamera(){if(1===this.viewingMode){const e=Object(M.e)(this.spatialReference).radius;this.camera=new Hd.a(Object(S.g)(4*e,0,0),Object(S.g)(e,0,0),Object(S.g)(0,0,1))}else this.camera=new Hd.a(Object(S.g)(0,0,100),Object(S.g)(0,0,0),Object(S.g)(0,1,0))}get animation(){return this.cameraController instanceof vh&&Object(b.j)(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==ay&&ay.copyFrom(e),ay.computeUp(this.viewingMode),oy.camera=ay,this.events.emit("before-camera-change",oy);const t=this._get("camera");if(this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,ay)&&(this._lastSeenCameraProjectionValues.copyFrom(ay),ly.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",ly)),(!t||!t.equals(ay))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(ay)),this._cameraChanged=!t||!t.almostEquals(ay),this._cameraChanged)){const e=Object(ry.a)((()=>{this._cameraChanged=!1,e.remove()}))}}get contentCamera(){return Object(b.j)(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=Object(b.j)(e)?e.clone():null}get fixedContentCamera(){return!!Object(b.j)(this._contentCamera)}get isGlobal(){return 1===this.viewingMode}get isLocal(){return 2===this.viewingMode}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(e.watch("state",(t=>{t!==mh.Finished&&t!==mh.Stopped||(this._set("cameraController",null),this.updateCamera((t=>e.onControllerEnd(t))))}),!0),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=mh.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==mh.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this.processUpdateQueue()}processUpdateQueue(){if(0===this.updateQueue.length||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();ay.copyFrom(this._get("camera")),e(ay),this.camera=ay,this.processingUpdates=!1,this.processUpdateQueue()}cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[0]!==t.padding[0]||e.padding[1]!==t.padding[1]||e.padding[2]!==t.padding[2]||e.padding[3]!==t.padding[3]}};Object(i.a)([Object(j.b)({readOnly:!0,type:Uo})],ny.prototype,"animation",null),Object(i.a)([Object(j.b)({type:Hd.a})],ny.prototype,"camera",null),Object(i.a)([Object(j.b)({})],ny.prototype,"_contentCamera",void 0),Object(i.a)([Object(j.b)({type:Hd.a})],ny.prototype,"contentCamera",null),Object(i.a)([Object(j.b)({readOnly:!0})],ny.prototype,"fixedContentCamera",null),Object(i.a)([Object(j.b)({readOnly:!0})],ny.prototype,"constraints",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],ny.prototype,"events",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],ny.prototype,"isGlobal",null),Object(i.a)([Object(j.b)({readOnly:!0})],ny.prototype,"isLocal",null),Object(i.a)([Object(j.b)({readOnly:!0})],ny.prototype,"viewingMode",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],ny.prototype,"spatialReference",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],ny.prototype,"navigating",null),Object(i.a)([Object(j.b)({readOnly:!0})],ny.prototype,"stationary",null),Object(i.a)([Object(j.b)()],ny.prototype,"_cameraChanged",void 0),Object(i.a)([Object(j.b)()],ny.prototype,"cameraController",null),ny=Object(i.a)([Object(w.a)("esri.views.3d.state.ViewState")],ny);var sy=ny;const ay=new Hd.a,oy={camera:null},ly={camera:null};var cy=sy,uy=r(54);class dy{constructor(e,t){this.elevationProvider=e,this._referenceEllipsoid=Object(M.e)(t),this.unitInMeters=Object(uy.f)(t,this._referenceEllipsoid.metersPerDegree)}compute(e,t,r,i,n){n||(n={near:0,far:0});let s=e[2]*this.unitInMeters;const a=s,o=s-i,l=this.elevationProvider?this.elevationProvider.elevationBounds:null;l&&(s=o>=0?a-this.unitInMeters*l.min:this.unitInMeters*l.max-a);const c={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},u=Math.max(c.x,c.y,c.z);Object(Cl.l)(vy,t,e),yy[0]=vy[0]>0?r.xmax:r.xmin,yy[1]=vy[1]>0?r.ymax:r.ymin,yy[2]=vy[2]>0?u/2:-u/2,Object(Cl.l)(yy,yy,e),Object(Cl.t)(vy,vy);const d=1.1*Object(Cl.j)(yy,vy)*this.unitInMeters,h=Math.sqrt(s*(s+2*this._referenceEllipsoid.radius)),p=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),f=p*my*this.unitInMeters,b=p*gy*this.unitInMeters;let m=Object(Bt.e)((s-b)/(f-b),0,1);m*=m*m;let g=Object(Bt.m)(h,d,m);return g*=Math.max(Math.log(Math.abs(o)),1),g=Math.min(g,Math.max(34064e4,u)),g/=this.unitInMeters,py(g,fy,this.unitInMeters,n)}}class hy{constructor(e){this._referenceEllipsoid=Object(M.e)(e)}compute(e,t,r,i,n){n||(n={near:0,far:0});const s=Object(Cl.r)(e)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,i),o=Math.abs(s-i),l=Math.max(o,Math.abs(s));return py(1.2*Math.sqrt(l*(l+2*a)),Object(Bt.e)(2e4-(Math.log(l)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function py(e,t,r,i){const n=by/r;return e/t>n?(i.far=e,i.near=i.far/t):(i.near=n,i.far=i.near*t),i}const fy=2e4,by=2,my=.001,gy=1e-4,yy=Object(S.e)(),vy=Object(S.e)();let Oy=class extends N.a{constructor(e){super(e),this.handles=new F.a}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",(e=>this.handleElevationChangeEvent(e))))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;Object(Du.b)(this.view,t,e.extent,e.spatialReference)&&this.applyToCurrentCamera()}applyToCurrentCamera(){this.view.state.updateCamera((e=>{Fu(this.view,e,1)}))}};Object(i.a)([Object(j.b)({constructOnly:!0})],Oy.prototype,"view",void 0),Oy=Object(i.a)([Object(w.a)("esri.views.3d.state.ElevationCollisionConstraint")],Oy);var jy=Oy;let _y=class extends N.a{constructor(e){super(e),this._handles=new F.a,this.nearFarHeuristic=function(e,t,r){return 1===e?new hy(r):new dy(t,r)}(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],(()=>this._clipDistanceNearFarChanged())),this.view.watch("constraints.clipDistance.mode",(()=>this._updateNearFar())),this.view.state.events.on("before-camera-change",(e=>this._updateCameraNearFar(e.camera))),this.view.watch("dataExtent",(()=>this._updateNearFar()),!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],(()=>this._updateAltitude()),!0),this.view.watch("constraints.tilt.max",(()=>this._updateTiltMax()),!0),this.view.watch("constraints.tilt.mode",(()=>this._updateTilt()),!0),this.view.watch("state.camera",(()=>this._updateTiltAutoMax()),!0),this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],(()=>this._updateCollision()),!0)]),this.view.state.isLocal&&this._handles.add(Object(y.a)(this.view,"dataExtent",(e=>this._updateLocalSurfaceDistance(e)))),this._updateNearFar(),2!==this.view.state.viewingMode&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new jy({view:this.view}))}destroy(){this._handles=Object(b.e)(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints&&this.view.constraints.clipDistance;e&&"auto"!==e.mode&&this.view.state.updateCamera((t=>(this._updateCameraNearFarManual(t,e),!0)))}_updateNearFar(){this.view.state.updateCamera((e=>(this._updateCameraNearFar(e),!0)))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(t?t.mode:"auto")?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.dataExtent,Object(Du.c)(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var e,t,r;const i=null==(e=this.view.map)||null==(t=e.ground)||null==(r=t.navigationConstraint)?void 0:r.type,n=!i||"stay-above"===i,s=this.view.state.constraints.collision;if(n!==s.enabled){s.enabled=n,n&&this._reapplyConstraints(8);const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&2!==this.view.state.viewingMode?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;"manual"===(e?e.mode:"auto")?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Object(Bt.g)(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||"auto"!==e.mode)return;const t=this.view.state.constraints;if(t.tilt){const r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Object(Bt.r)(r))}}_updateLocalSurfaceDistance(e){let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const r=this.view.state,i=3*t/Math.atan(r.camera.fov/2);i!==r.constraints.distance&&(r.constraints.distance=i)}_reapplyConstraints(e=15){this.view.state.updateCamera((t=>Pd(this.view,t,{selection:e,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})))}};Object(i.a)([Object(j.b)({constructOnly:!0})],_y.prototype,"view",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],_y.prototype,"surfaceCollisionConstraint",void 0),_y=Object(i.a)([Object(w.a)("esri.views.3d.state.ConstraintsManager")],_y);var wy=_y;let xy=class extends yh{constructor(e){super(e),this.handles=new F.a}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=mh.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",(e=>this.handleElevationChangeEvent(e)))),this.applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}handleElevationChangeEvent(e){Object(Du.b)(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this.applyCorrection()}applyCorrection(){this.view.state.updateCamera((e=>{e.copyViewFrom(this.desiredCamera),Fu(this.view,e,1)||this.constraintEnabled||(this.state=mh.Stopped)}))}};Object(i.a)([Object(j.b)({constructOnly:!0})],xy.prototype,"view",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],xy.prototype,"desiredCamera",null),xy=Object(i.a)([Object(w.a)("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],xy);var Sy=r(355);class Ty{constructor(e,t,r){this.target=e,this.options=t,this.view=r,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise(((e,t)=>{this.resolveCallback=e,this.rejectCallback=t;const r=Object(m.e)();Object(b.j)(this.options.signal)&&Object(m.s)(this.options.signal,(()=>{this.abort()})),this.abortController=r,this.waitForReady()}))}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}resolve(e){return this.state="finished",this.resolveCallback(e)}reject(e){return this.state="finished",this.rejectCallback(e)}abort(e=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(Object(m.f)());break;case"wait-for-animation-finish":!e&&Object(b.j)(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(Object(m.f)())}}waitForReady(){this.state="wait-for-ready",this.view.ready?this.createViewPoint():Object(y.j)(this.view,"ready",this.abortController.signal).then((()=>{this.createViewPoint()}),(e=>{this.reject(e)}))}createViewPoint(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this.getAnimationController():null,Object(Sy.a)(this.view,this.target,this.abortController.signal).then((e=>{if("finished"===this.state)return;const t=this.getCameraFromViewpoint(e);if(!Object(b.i)(t))if(this.options.animate){if(Object(b.i)(this.animationController))return;this.startAnimation(t,this.animationController)}else this.view.stateManager.setStateCamera(t.camera,{applyConstraints:!t.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}),(e=>{this.reject(e)})))}getCameraFromViewpoint(e){const t=!!(this.target instanceof o.a&&this.target.camera||this.target instanceof n.a),r=e.camera;if(Object(b.i)(r))return null;if(!this.view.stateManager.isCompatible(r)){const e=r.position,t=e&&e.spatialReference,i=t?t.wkid:"none",n=this.view.spatialReference.wkid;return this.reject(new u.a("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${i}, view: ${n})`,{camera:r})),null}const i=Object(lf.e)(this.view,r);return Object(b.i)(i)?(this.reject(new u.a("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:i,isFullySpecified:t}}startAnimation(e,t){this.state="wait-for-animation-finish";const r=t.viewAnimation;if(Object(b.i)(r))return void this.reject(new u.a("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!t.active||Object(b.i)(t.viewAnimation)||t.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==t)return this.abort();let i;e.isFullySpecified?(i=new xy({view:this.view,desiredCamera:e.camera}),Fu(this.view,e.camera,1)):Pd(this.view,e.camera),t.begin(e.camera,this.options);const n=e=>{if(!Object(b.i)(this.view.state))switch(t.state){case mh.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case mh.Ready:case mh.Rejected:case mh.Running:case mh.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(e)}}};r.when((()=>{const r=this.view.state.cameraController;i&&(r&&r.active?r instanceof jh&&Object(b.j)(r.viewAnimation)&&r.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=i):Object(b.j)(t.viewAnimation)&&t.viewAnimation.target===e.viewpoint&&"finished"===t.state&&(this.view.state.cameraController=i))}),(e=>n(e))),t.asyncResult={resolve:()=>n(),reject:e=>n(e)}}getAnimationController(){let e,t=null;const r=this.view.state.cameraController;return r instanceof jh&&(r.updateStateFromViewAnimation(),r.active&&(e=r,t=e.viewAnimation)),null!=e||(e=new jh({view:this.view,mode:"animation"}),t=e.viewAnimation,this.view.state.switchCameraController(e))?e:(Object(b.j)(t)&&t.stop(),this.reject(new u.a("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const Cy=f.a.getLogger("esri.views.3d.state.ViewStateManager");let My=class extends N.a{constructor(e){super(e),this.propertiesPool=new iy.a({frustum:Sg},this),this.handles=new F.a,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this.updateDevicePixelRatio=null,this.test={contentCameraResetState:new Map}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=Object(lf.k)(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this.updatePropertyBeforeReady("camera",e)||this.setStateCamera(Object(lf.e)(this.view,e),{applyConstraints:!1})||Cy.error("#camera=","Invalid camera",e)}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=Object(lf.k)(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this.updatePropertyBeforeReady("contentCamera",e))return;const t=Object(lf.e)(this.view,e);Object(b.i)(t)?this.view.state.contentCamera=null:(this.updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,r=this.view.state.camera.distance**2,i=Object(S.f)(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.handles.add([this.watch("contentCamera",(()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())})),this.watch("zoom",(e=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(e-t)/2),Math.abs(e-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})),this.view.state.watch("camera",(e=>{const t=Object(Cl.n)(i,e.center);this.test.contentCameraResetState.set("camera.center",t/r),t>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)}))],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this.updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this.centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Cy.error("#center=","Invalid center",e):Cy.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Cy.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=Object(lf.o)(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return Object(b.j)(t)?t:this._get("extent")}set extent(e){this.updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this.extentToCamera(e),{applyConstraints:!0})||Cy.error("#extent=","Invalid extent",e):Cy.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Cy.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Object(lf.d)(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this.updatePropertyBeforeReady("scale",e)||this.setStateCamera(this.scaleToCamera(e),{applyConstraints:!0})||Cy.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,r=e.pixelRatio,i=this._get("padding"),n=Math.round(t[0]/r),s=Math.round(t[1]/r),a=Math.round(t[2]/r),o=Math.round(t[3]/r);return null!=i&&i.top===n&&i.right===s&&i.bottom===a&&i.left===o?i:{top:n,right:s,bottom:a,left:o}}set padding(e){this.updatePropertyBeforeReady("padding",e)||(this.paddingToArray(e,this.view.state.camera.pixelRatio,Fy),this.view.state.updateCamera((e=>e.padding=Fy)))}paddingToArray(e,t,r){e?Object(rc.l)(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Object(rc.l)(r,0,0,0,0);for(let i=0;i<4;i++)r[i]=Math.round(r[i]*t)}get screenCenter(){const e=this.padding;return Object(O.e)((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Object(Sy.b)(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this.updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this.viewpointToCamera(e),{applyConstraints:!e.camera})||Cy.error("#viewpoint=","Invalid viewpoint",e);else{const t=Object(b.j)(e.camera)?e.camera.position:e.targetGeometry,r=Object(b.j)(t)&&t.spatialReference;Cy.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else Cy.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Object(lf.n)(this.view,this.scale):this._get("zoom")}set zoom(e){this.updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this.zoomToCamera(e),{applyConstraints:!0})||Cy.error("#zoom=","Invalid zoom",e)}initialize(){this.handles.add([Object(y.b)(this.view,"state.events","before-camera-change",(e=>this.updateElevation(e.camera)))]),Object(y.c)(this.view.state,"camera",(e=>this.updateElevation(e)),!0),this.handles.add(Object(g.a)({prepare:()=>this.prepareFrame()})),this.handles.add(this.view.state.watch("cameraController",(()=>{this.cameraSetByUser=!0,this.handles.remove(Ly)}))),this.handles.add(Object(y.b)(this.view,"state.events","camera-projection-changed",(()=>this.notifyChange("scale"))))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new wy({view:this.view}),this.prepareFrame();const e=this.getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const e=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;e&&this.isCompatible(e)?this.setInitialView(e):2===this.view.state.viewingMode&&this.handles.add(Object(y.j)(this.view.basemapTerrain,"ready",(()=>{this.handles.remove(Ly),this.setInitialView(this.view.groundExtent)})),Ly)}}deinit(){this.cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(Ly),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const r={animate:!0,...t};return Object(b.j)(this.gotoOperation)&&this.gotoOperation.abort(r.animate),this.gotoOperation=new Ty(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Object(Du.a)(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,r=t&&this.view.state.cameraController;r&&(t.updateCamera((t=>{r.stepController(e,t)})),r.steppingFinished&&r.finishController())}cancelGoToOperation(){Object(b.j)(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}getInitialProperties(){const e=new Set,t=[];for(const{propertyName:r,overrides:i}of Ey){const n=e.has(r),s=this._isOverridden(r);!n&&s&&t.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||s)&&i.forEach((t=>e.add(t)))}return t}setInitialView(e){if(!e||this.cameraSetByUser)return;if(e instanceof n.a)return void this.setStateCamera(Object(lf.e)(this.view,e),{applyConstraints:!1});if(e instanceof o.a){if(e.targetGeometry instanceof Fa.a){const t=Object(lf.h)(this.view,e.targetGeometry,0,.5,0);return void(Object(b.j)(t)&&this.setStateCamera(Object(lf.e)(this.view,t),{applyConstraints:!0}))}const t={applyConstraints:!e.camera},r=this.viewpointToCamera(e);return void this.setStateCamera(r,t)}const t=Object(lf.h)(this.view,e,0,.5,0);Object(b.j)(t)&&this.setStateCamera(Object(lf.e)(this.view,t),{applyConstraints:!0})}updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&-1!==Ay.indexOf(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!Object(b.i)(e)&&(e instanceof o.a?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof n.a?this.isCompatible(e.position):e.spatialReference&&Object(R.a)(e.spatialReference,this.view.spatialReference))}getPreservingHeadingTilt(e=Ry){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}centerPointAtDistanceToCamera(e,t,r=Dy){const{heading:i,tilt:n}=this.getPreservingHeadingTilt(),s=Object(lf.i)(this.view,i,n,e,t,1);return Object(b.i)(s)?null:(r.copyFrom(this.view.state.camera),r.eye=s.eye,r.center=s.center,r.up=s.up,r)}centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.distance;return this.centerPointAtDistanceToCamera(e,r)}extentToCamera(e){const{heading:t,tilt:r}=this.getPreservingHeadingTilt(),i=Object(lf.h)(this.view,e,t,r,1,Iy);return Object(b.j)(i)?Object(lf.e)(this.view,i):null}scaleToCamera(e){if(null==e)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.renderLocation,i=t.location.latitude,n=Object(lf.l)(this.view,e,i);return this.centerPointAtDistanceToCamera(r,n)}zoomToCamera(e){return this.scaleToCamera(Object(lf.p)(this.view,e))}viewpointToCamera(e){return Object(lf.e)(this.view,Object(Sy.c)(this.view,e))}setStateCamera(e,t){return!(Object(b.i)(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this.cancelGoToOperation(),this.view.state.updateCamera((r=>{t.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),t.applyConstraints&&Pd(this.view,r)})),t.applyConstraints||(this.view.state.cameraController=new xy({view:this.view,desiredCamera:e})),!0)}prepareFrame(){const{container:e,canvas:t}=this.view;if(!e||!t)return;Object(b.j)(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();const r=this.view.pixelRatio,i=Math.round(e.clientWidth*r),n=Math.round(e.clientHeight*r);if(0!==i&&0!==n&&(t.width===i&&t.height===n||(t.width=i,t.height=n),this.view.state)){const e=this.view.state.camera;e.fullWidth===i&&e.fullHeight===n&&e.pixelRatio===r||(Dy.copyFrom(e),Dy.pixelRatio!==r&&(this.paddingToArray(this.padding,r,Fy),Dy.padding=Fy),Dy.fullWidth=i,Dy.fullHeight=n,Dy.pixelRatio=r,this.view.state.camera=Dy)}}updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=this.view.renderCoordsHelper.getAltitude(e.eye),i=t?Object(Du.c)(this.view,e.eye):0;e.relativeElevation=r-i}};Object(i.a)([Object(j.b)({type:n.a,dependsOn:["view.state.camera","ready"]})],My.prototype,"camera",null),Object(i.a)([Object(j.b)({type:n.a,dependsOn:["view.state.contentCamera","ready"]})],My.prototype,"contentCamera",null),Object(i.a)([Object(j.b)({type:Mn.a})],My.prototype,"center",null),Object(i.a)([Object(j.b)({type:Fa.a})],My.prototype,"extent",null),Object(i.a)([Object(j.b)({readOnly:!0})],My.prototype,"frustum",null),Object(i.a)([Object(j.b)({readOnly:!0})],My.prototype,"hasInitialView",null),Object(i.a)([Object(j.b)({readOnly:!0,type:Boolean})],My.prototype,"ready",void 0),Object(i.a)([Object(j.b)({type:Number})],My.prototype,"scale",null),Object(i.a)([Object(j.b)()],My.prototype,"padding",null),Object(i.a)([Object(j.b)({readOnly:!0})],My.prototype,"screenCenter",null),Object(i.a)([Object(j.b)({constructOnly:!0})],My.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:o.a})],My.prototype,"viewpoint",null),Object(i.a)([Object(j.b)({type:Number})],My.prototype,"zoom",null),Object(i.a)([Object(j.b)({constructOnly:!0})],My.prototype,"updateDevicePixelRatio",void 0),My=Object(i.a)([Object(w.a)("esri.views.3d.state.ViewStateManager")],My);var Py=My;const Ay=["camera","viewpoint","extent","scale","center","zoom"],Ey=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Ry={heading:0,tilt:0},Iy=new n.a,Dy=new Hd.a,Fy=Object(Ml.e)(),Ly="pending-initial-view";var ky=Py,zy=r(233);class Vy{constructor(e,t,r){this.viewingMode=e,this.layerProvider=t,this.view=r,this.externalIntersectionHandlers=new Wb.a,this.tolerance=Oh.a.DEFAULT_TOLERANCE,this.tmpRay=Object(fu.c)(),this.validateHUDIntersector=new Oh.a(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(e,t){return this.intersectRay(this.getPickRay(e,this.tmpRay),By(this.viewingMode),t)}intersectScreenFreePointFallback(e,t){return this.intersectRayFreePointFallback(this.getPickRay(e,this.tmpRay),t)}intersectRayFreePointFallback(e,t){return this.intersectRay(e,By(this.viewingMode),t)||this.intersectRayFreePointLocal(e,t)}intersectRay(e,t,r,i){return t.options.selectionMode=!1,t.options.store=0,this.computeIntersection(e,t,i),!!t.results.min&&t.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,t,r=.5,i=.5){return e.getRenderCenter(Wy,r,i),Wy[0]+=.0466,Wy[1]-=.0123,Object(Bh.b)(e,Wy,t)}intersectIntersectorScreen(e,t,r){this.computeIntersection(this.getPickRay(e,this.tmpRay),t,r)}intersectToolIntersectorScreen(e,t,r){const i=this.getPickRay(e,this.tmpRay);this.intersectToolIntersectorRay(i,t,r)}intersectToolIntersectorRay(e,t,r){t.options.selectionMode=!0,this.computeIntersection(e,t,r);const i=t.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.opaque||i.hasIntersectionPoint&&"TerrainRenderer"!==i.intersector||(t.options.selectionMode=!1,this.computeIntersection(e,t,r))}setTolerance(e=Oh.a.DEFAULT_TOLERANCE){this.tolerance=e}addIntersectionHandler(e){this.externalIntersectionHandlers.push(e),this.externalIntersectionHandlers.sort(((e,t)=>"Terrain"===e.type?1:"Terrain"===t.type?-1:0))}removeIntersectionHandler(e){this.externalIntersectionHandlers.removeUnordered(e),this.externalIntersectionHandlers.sort(((e,t)=>"Terrain"===e.type?1:"Terrain"===t.type?-1:0))}getPickRay(e,t=Object(fu.c)()){const r=this.view.state.camera;return Object(Bh.c)(r,e,t)}intersectRayFreePointLocal(e,t){if(2!==this.viewingMode||Object(b.i)(e))return!1;const r=this.view.dataExtent,i={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},n=Math.max(i.x,i.y,i.z);if(0===n)return Object(Cl.h)(t,e.origin,Object(Cl.t)(Ch.c.get(),e.direction)),!0;const s=this.view.state.camera,a=Math.max(0,r.xmin-s.eye[0],s.eye[0]-r.xmax),o=Math.max(0,r.ymin-s.eye[1],s.eye[1]-r.ymax),l=Math.sqrt(a*a+o*o),c=Math.abs(s.relativeElevation)+Number.MIN_VALUE,u=Math.max(0,Math.log(n/c))**2;let d=n/Math.max(1,u);d=Math.max(d,Math.min(l,n));const h=Object(Cl.g)(Ch.c.get(),e.direction,d/Object(Cl.r)(e.direction));return Object(Cl.h)(t,e.origin,h),!0}intersectElevationFromScreen(e,t,r=0,i=null){return this.intersectElevation(this.getPickRay(e,this.tmpRay),t,r,i)}intersectElevation(e,t,r=0,i=null){if(Object(b.i)(e))return null;const n=Object(b.j)(t)?t.mode:"absolute-height",s=Object(b.j)(t)?Object(b.t)(t.offset,0):0,a="on-the-ground"!==n?s+r:0,o=a/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===n){if(this.view.renderCoordsHelper.intersectInfiniteManifold(e,a,Hy)){const e=this.view.computeMapPointFromVec3d(Hy);return e.z-=s,e}return null}const l=this.view.state.camera,c=Object(O.b)(Ch.c.get());l.projectToRenderScreen(e.origin,c);const u=this.prepareFilters(null,Gy),d=this.view.slicePlane,h=Object(b.j)(d)?Object(zy.c)(d):null,p=new Oh.a(this.viewingMode);p.options.store=0,p.options.verticalOffset=o;const f=e.origin,m=Object(Cl.h)(Ch.c.get(),f,e.direction);p.reset(f,m),p.point=c,p.camera=l,p.filterPredicate=null;const g=Object(b.j)(i)?"type"in i&&"graphics"===i.type?e=>e.metadata.layerUid!==i.uid:e=>e.metadata.graphicUid!==i.uid:null;switch(n){case"relative-to-scene":{const e=e=>(Object(b.i)(g)||g(e))&&e.metadata&&e.metadata.isElevationSource;p.intersect(u.layers,c,l,this.tolerance,null,e),this.externalIntersectionHandlers.forAll((e=>{if("I3S"===e.type||"Terrain"===e.type){const t=e.slicePlane?h:null;e.intersect(p,t,p.rayBeginPoint,p.rayEndPoint,c)}}))}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll((e=>{if(e.isGround){const t=e.slicePlane?h:null;e.intersect(p,t,p.rayBeginPoint,p.rayEndPoint,c)}}))}if(p.results.min.getIntersectionPoint(Hy)){const e=this.view.computeMapPointFromVec3d(Hy);return e.z=r,e}return null}computeIntersection(e,t,r){if(Object(b.i)(e))return;const i=this.view.state.camera,n=Object(O.b)(Ch.c.get());i.projectToRenderScreen(e.origin,n);const s=this.prepareFilters(r,Gy);t.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=e.origin,o=Object(Cl.h)(Ch.c.get(),e.origin,e.direction);t.reset(a,o),t.intersect(s.layers,n,i,this.tolerance);const l=this.view.slicePlane,c=Object(b.j)(l)?Object(zy.c)(l):null;t.intersect(s.sliceableLayers,n,i,this.tolerance,c);const u=r&&(r.requiresGroundFeedback||r.enableDraped);this.externalIntersectionHandlers.forAll((e=>{if(t.options.isFiltered=!s.filterLayerUid(e.intersectionHandlerId),e.isGround&&u||!t.options.isFiltered){const r=e.slicePlane?c:null;e.intersect(t,r,a,o,n)}}));const d=Ch.c.get();if(r&&r.enableDraped&&t.results.ground.getIntersectionPoint(d)){const e=this.view.basemapTerrain.overlayManager.renderer,r=this.view.renderCoordsHelper.spatialReference,i=Ch.c.get();this.view.renderCoordsHelper.fromRenderCoords(d,i,this.view.spatialReference),i[2]=Object(b.t)(this.view.elevationProvider.getElevation(d[0],d[1],d[2],r,"ground"),0),e.intersect(t,i,s.filterRenderGeometry)}t.sortResults();const h=t.results.hud;if(h.hasIntersectionPoint){const e=Object(O.b)(Ch.c.get()),r=Ch.c.get(),n=Ch.c.get();this.unprojectHUDResultRay(h.center,e,r,n);const a=Object(Cl.o)(h.center,r)/Object(Cl.o)(r,n)*.99;this.validateHUDIntersector.reset(r,n),this.validateHUDIntersector.intersect(s.layers,e,i,this.tolerance),this.validateHUDIntersector.intersect(s.sliceableLayers,e,i,this.tolerance,c),this.externalIntersectionHandlers.forAll((t=>{if(!s.filterLayerUid(t.intersectionHandlerId))return;const i=t.slicePlane?c:null;t.intersect(this.validateHUDIntersector,i,r,n,e)}));const o=this.validateHUDIntersector.results.min;(null==o.dist||a<=o.dist)&&(t.results.min.copyFrom(h),t.results.all.splice(0,0,h))}}prepareFilters(e,t){const r=[],i=[];return this.layerProvider.forEachLayer((e=>{e.isPickable&&(e.isSliceable?i:r).push(e)})),t.include=e&&e.include,t.exclude=e&&e.exclude,t.layers.length=0,t.sliceableLayers.length=0,Ny(r,t.filterLayer,t.layers),Ny(i,t.filterLayer,t.sliceableLayers),t}unprojectHUDResultRay(e,t,r,i){const n=this.view.state.camera;n.projectToRenderScreen(e,t);const s=Object(O.b)(Ch.c.get());s[0]=t[0],s[1]=t[1],s[2]=0,n.unprojectFromRenderScreen(s,r),s[2]=1,n.unprojectFromRenderScreen(s,i)}}function Ny(e,t,r){for(const i of e)t&&!t(i)||r.push(i);return r}let Uy;function By(e){return Uy||(Uy=new Oh.a(e)),Uy.viewingMode=e,Uy}const Gy={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer:e=>Gy.filterLayerUid(e.apiLayerUid),filterLayerUid(e){const{include:t,exclude:r}=Gy;return Object(b.i)(e)?null==t&&null==r:(null==t||t.has(e))&&(null==r||!r.has(e))},filterRenderGeometry:e=>Gy.filterLayerUid(e.layerUid)};function qy(e){return"object"==typeof e&&"intersect"in e}const Hy=Object(S.e)(),Wy=Object(O.c)();var $y=r(647);let Qy=class extends(zi.a.EventedMixin(N.a)){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map}destroy(){this._elevationQuery=Object(b.e)(this._elevationQuery)}get elevationQuery(){return Object(b.i)(this._elevationQuery)&&(this._elevationQuery=new $y.a(this.view.resourceController.scheduler,this.view.spatialReference,(()=>this.view.map&&this.view.map.ground),{maximumAutoTileRequests:4})),this._elevationQuery}getElevation(e,t,r,i,n){let s=null;return s=Zy(s,this.im,e,t,r,i,n),Object(b.i)(s)&&(s=Zy(s,this.ground,e,t,r,i,n)),"scene"===n&&(s=Zy(s,this.scene,e,t,r,i,n)),s}queryElevation(e,t,r,i,n,s=null,a=0){const o=Object(m.h)();return this.elevationQuery.queryElevation(e,t,s,a).then((s=>{"scene"===n&&(s=Zy(s,this.scene,e,t,r,i,n)),o.resolve(s)})).catch((s=>{Object(m.n)(s)?o.reject(s):o.resolve(this.getElevation(e,t,r,i,n))})),o.promise}register(e,t){this.handles.set(t,t.on("elevation-change",(e=>this.emit("elevation-change",e)))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const r=t.indexOf(e);r>-1&&t.splice(r,1)}}};function Zy(e,t,r,i,n,s,a){for(const o of t){const t=o.getElevation(r,i,n,s,a);Object(b.j)(t)&&(e=Object(b.j)(e)?Math.max(t,e):t)}return e}Object(i.a)([Object(j.b)({constructOnly:!0})],Qy.prototype,"view",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],Qy.prototype,"spatialReference",void 0),Qy=Object(i.a)([Object(w.a)("esri.views.3d.support.CombinedElevationProvider")],Qy);class Xy{static isValidProfile(e){return e in Xy.profiles}static getDefaultProfile(){return Object(p.a)("trident")||Object(p.a)("esri-iPhone")?"low":"medium"}static apply(e,t){const r=Xy.profiles[e];t.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,t.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,t.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,t.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor;{const e=t.sceneService["3dObject"],i=r.sceneService["3dObject"];e.lodFactor=i.lodFactor,e.lodCrossfadeinDuration=i.lodCrossfadeinDuration,e.lodCrossfadeoutDuration=i.lodCrossfadeoutDuration,e.lodCrossfadeUncoveredDuration=i.lodCrossfadeUncoveredDuration}t.sceneService.point.lodFactor=r.sceneService.point.lodFactor,t.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,t.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,t.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,t.tiledSurface.lodBias=r.tiledSurface.lodBias,t.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,t.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,t.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,t.antialiasingEnabled=r.antialiasingEnabled,t.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,t.highQualityTransparency=r.highQualityTransparency,t.memoryLimit=r.memoryLimit,t.additionalCacheMemory=r.additionalCacheMemory,t.frameRate=r.frameRate,t.maximumRenderResolution=r.maximumRenderResolution,t.maximumPixelRatio=r.maximumPixelRatio}}function Jy(){const e=!!Object(p.a)("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Object(p.a)("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Object(p.a)("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}Xy.debug={reset(){const e=Jy();for(const t in e)Xy.profiles[t]=e[t]}},function(e){e.profiles=Jy()}(Xy||(Xy={}));var Yy=Xy,Ky=r(192);let ev=class extends N.a{constructor(){super(...arguments),this.color=new Tl.a([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new Tl.a([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=Tl.a.toUnitRGBA(e.color),r=Object(b.j)(e.haloColor)?Tl.a.toUnitRGBA(e.haloColor):t,i=Tl.a.toUnitRGBA(e.shadowColor);return{color:Object(Ky.c)(t[0],t[1],t[2],t[3]),haloColor:Object(Ky.c)(r[0],r[1],r[2],r[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:Object(Ky.c)(i[0],i[1],i[2],i[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};Object(i.a)([Object(j.b)({type:Tl.a})],ev.prototype,"color",void 0),Object(i.a)([Object(j.b)({type:Tl.a})],ev.prototype,"haloColor",void 0),Object(i.a)([Object(j.b)()],ev.prototype,"haloOpacity",void 0),Object(i.a)([Object(j.b)()],ev.prototype,"fillOpacity",void 0),Object(i.a)([Object(j.b)()],ev.prototype,"shadowOpacity",void 0),Object(i.a)([Object(j.b)({type:Tl.a})],ev.prototype,"shadowColor",void 0),Object(i.a)([Object(j.b)()],ev.prototype,"shadowDifference",void 0),ev=Object(i.a)([Object(w.a)("esri.views.3d.support.HighlightOptions")],ev);var tv=ev,rv=r(568),iv=r(488);class nv{constructor(e,t,r=null){this.spatialReference=t,this.unitInMeters=Object(uy.f)(this.spatialReference,Object(M.e)(this.spatialReference).metersPerDegree),this._geometryServicePromise=Object(Am.d)(this.loadGeometryService(e,r))}async loadGeometryService(e,t){if(t)return t;try{return await Object(rv.create)(e&&e.get("portalItem"))}catch{throw new u.a("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")}}async awaitGeometryService(){const e=await this._geometryServicePromise;if(!0===e.ok)return e.value;throw e.error}async toGeographic(e){const t=await this.awaitGeometryService();let r,i=!0;Array.isArray(e[0])&&"number"!=typeof e[0]?r=e:(r=[e],i=!1);const n=r.map((e=>e instanceof Mn.a?e:new Mn.a(e,this.spatialReference))),s=new iv.a({geometries:n,outSpatialReference:La.a.WGS84}),a=(await t.project(s)).map((e=>"point"===e.type?[e.x,e.y]:void 0));return i?a:a[0]}}let sv=class extends N.a{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.polygonLodFactor=1,this.polylineLodFactor=1}};Object(i.a)([Object(j.b)()],sv.prototype,"minTotalNumberOfFeatures",void 0),Object(i.a)([Object(j.b)()],sv.prototype,"maxTotalNumberOfFeatures",void 0),Object(i.a)([Object(j.b)()],sv.prototype,"maxTotalNumberOfPrimitives",void 0),Object(i.a)([Object(j.b)()],sv.prototype,"polygonLodFactor",void 0),Object(i.a)([Object(j.b)()],sv.prototype,"polylineLodFactor",void 0),sv=Object(i.a)([Object(w.a)("esri.views.3d.support.QualitySettings.Graphics3DSettings")],sv);let av=class extends N.a{constructor(){super(...arguments),this.lodFactor=1}};Object(i.a)([Object(j.b)()],av.prototype,"lodFactor",void 0),av=Object(i.a)([Object(w.a)("esri.views.3d.support.QualitySettings.LoDFactorSettings")],av);let ov=class extends av{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};ov=Object(i.a)([Object(w.a)("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],ov);let lv=class extends N.a{constructor(){super(...arguments),this["3dObject"]=new ov,this.point=new av,this.integratedMesh=new av,this.pointCloud=new av,this.uncompressedTextureDownsamplingEnabled=!1}};Object(i.a)([Object(j.b)({type:ov})],lv.prototype,"3dObject",void 0),Object(i.a)([Object(j.b)({type:av})],lv.prototype,"point",void 0),Object(i.a)([Object(j.b)({type:av})],lv.prototype,"integratedMesh",void 0),Object(i.a)([Object(j.b)({type:av})],lv.prototype,"pointCloud",void 0),Object(i.a)([Object(j.b)()],lv.prototype,"uncompressedTextureDownsamplingEnabled",void 0),lv=Object(i.a)([Object(w.a)("esri.views.3d.support.QualitySettings.SceneServiceSettings")],lv);let cv=class extends N.a{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};Object(i.a)([Object(j.b)()],cv.prototype,"lodBias",void 0),Object(i.a)([Object(j.b)()],cv.prototype,"angledSplitBias",void 0),Object(i.a)([Object(j.b)()],cv.prototype,"reduceTileLevelDifferences",void 0),Object(i.a)([Object(j.b)()],cv.prototype,"textureFadeDuration",void 0),cv=Object(i.a)([Object(w.a)("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],cv);let uv=class extends N.a{constructor(){super(...arguments),this.graphics3D=new sv,this.sceneService=new lv,this.tiledSurface=new cv,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};Object(i.a)([Object(j.b)({type:sv})],uv.prototype,"graphics3D",void 0),Object(i.a)([Object(j.b)({type:lv})],uv.prototype,"sceneService",void 0),Object(i.a)([Object(j.b)({type:cv})],uv.prototype,"tiledSurface",void 0),Object(i.a)([Object(j.b)()],uv.prototype,"antialiasingEnabled",void 0),Object(i.a)([Object(j.b)()],uv.prototype,"physicallyBasedRenderingEnabled",void 0),Object(i.a)([Object(j.b)()],uv.prototype,"highQualityTransparency",void 0),Object(i.a)([Object(j.b)()],uv.prototype,"memoryLimit",void 0),Object(i.a)([Object(j.b)()],uv.prototype,"additionalCacheMemory",void 0),Object(i.a)([Object(j.b)()],uv.prototype,"frameRate",void 0),Object(i.a)([Object(j.b)()],uv.prototype,"maximumRenderResolution",void 0),Object(i.a)([Object(j.b)()],uv.prototype,"maximumPixelRatio",void 0),uv=Object(i.a)([Object(w.a)("esri.views.3d.support.QualitySettings.QualitySettings")],uv);var dv=uv,hv=r(359);class pv{constructor(e,t,r,i){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=r,this.coordinateSystem=i,this._coordinateSystem=function(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}}(i)}set extent(e){e&&function(e,t,r){e.operations.setExtent(e.value,t,r.value)}(this.coordinateSystem,e,this.coordinateSystem)}getAltitude(e){return function(e,t){return e.operations.altitudeAt(e.value,t)}(this.coordinateSystem,e)}setAltitude(e,t,r=e){return Fh(this.coordinateSystem,r,t,e)}setAltitudeOfTransformation(e,t){!function(e,t,r,i){t!==i&&Object(Pl.d)(i,t),Object(Cl.y)(kh,i[12],i[13],i[14]),Fh(e,kh,r,kh),i[12]=kh[0],i[13]=kh[1],i[14]=kh[2]}(this.coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return function(e,t,r){return e.operations.axisAt(e.value,t,2,r)}(this.coordinateSystem,e,t)}worldBasisAtPosition(e,t,r){return function(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)}(this.coordinateSystem,e,t,r)}basisMatrixAtPosition(e,t){const r=this.worldBasisAtPosition(e,0,Ch.c.get()),i=this.worldBasisAtPosition(e,1,Ch.c.get()),n=this.worldBasisAtPosition(e,2,Ch.c.get());return Object(Pl.h)(t,r[0],r[1],r[2],0,i[0],i[1],i[2],0,n[0],n[1],n[2],0,0,0,0,1),t}intersectManifoldClosestSilhouette(e,t,r){return Lh(this.coordinateSystem,t,this._coordinateSystem),function(e,t,r){e.operations.intersectRayClosestSilhouette(e.value,t,r)}(this._coordinateSystem,e,r),r}intersectManifold(e,t,r){Lh(this.coordinateSystem,t,this._coordinateSystem);const i=Ch.c.get();return function(e,t,r){return e.operations.intersectRay(e.value,t,r)}(this._coordinateSystem,e,i)?Object(Cl.m)(r,i):null}intersectInfiniteManifold(e,t,r){if(1===this.viewingMode)return this.intersectManifold(e,t,r);Lh(this.coordinateSystem,t,this._coordinateSystem);const i=this._coordinateSystem.value,n=Ch.c.get();return Object(Uh.m)(i.plane,e,n)?Object(Cl.m)(r,n):null}toRenderCoords(e,t,r){return Object(hv.a)(e)?Object(C.u)(e,t,this.spatialReference):Object(C.z)(e,t,r,this.spatialReference)}fromRenderCoords(e,t,r=null){return Object(hv.a)(t)?(Object(b.j)(r)&&(t.spatialReference=r),Object(C.x)(e,this.spatialReference,t)):t instanceof La.a?Object(C.y)(e,this.spatialReference,t):Object(C.z)(e,this.spatialReference,t,r)?t:null}static create(e,t){switch(e){case 2:return new pv(2,t,Object(uy.f)(t),Ih(A.c,Object(A.g)([0,0,0],[Dh,0,0],[0,Dh,0])));case 1:return new pv(1,t,1,function(e){return Ih(pu.l,Object(pu.f)(0,0,0,Object(M.e)(e).radius))}(t))}}}var fv=r(544),bv=r(343);function mv(e){return"function"==typeof e.getUsedMemory}const gv=f.a.getLogger("esri.views.3d.support.MemoryController");class yv{constructor(e){this._view=e,this.events=new zi.a,this.minQuality=.1,this._maxMemory=500,this._additionalCacheMemory=100,this._quality=1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryUsed=0,this._memoryPredicted=0,this._cacheStorage=new bv.c,this._numQualityChanges=0,this._updating=!1}destroy(){this.events=null,this._cacheStorage.destroy()}getMemCache(e,t){return new bv.b(e,this._cacheStorage,t)}set maxMemory(e){null!=e&&e>0&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(1),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){null!=e&&e>=0&&(this._additionalCacheMemory=e)}disableMemCache(){this._additionalCacheMemory=-4096}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}resetStableQuality(){this._stableQuality=0}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<.6&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(1);else if(e)(this._memoryPredicted>1.1||this._memoryUsed>1)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>1)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<.75&&this._quality<1){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this.updating!==e&&(this._updating=e,this.events.emit("updating-changed",this.updating))}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),1))!==this._quality&&(this._quality=e,this.events.emit("quality-changed",this._quality),++this._numQualityChanges,!0)}_layersUpdating(){return this._view.allLayerViews.some((e=>!!e.updating))}_updateMemory(){let e=0,t=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(e+=this._view.basemapTerrain.getUsedMemory());const r=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;Object(b.j)(r)&&(e+=r.usedMemory),this._view.allLayerViews&&this._view.allLayerViews.forEach((r=>{if(mv(r)){const i=r.ignoresMemoryFactor()?this._quality:1;e+=r.getUsedMemory()*i,t+=r.getUnloadedMemory()*i}}));const i=null==this._warnMemoryUsage||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this._maxMemory;if(e>n&&i){this._warnMemoryUsage=e;const r=e=>(e/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",i=Math.round(100*this._quality);gv.warn(`Memory Limit exceeded! Limit: ${r(n)} Current: ${r(e)} Projected: ${r(e+t)} Quality: ${i}%`)}this._memoryUsed=e/n,this._memoryPredicted=(e+t)/n;const s=n-e;this._cacheStorage.maxSize=Math.max(0,s+1048576*this._additionalCacheMemory),this.events.emit("memory-used",this._memoryUsed)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}}var vv=r(296);let Ov=class extends N.a{constructor(){super(...arguments),this.updating=!1}};var jv;Object(i.a)([Object(j.b)({readOnly:!0})],Ov.prototype,"updating",void 0),Ov=Object(i.a)([Object(w.a)("esri.views.3d.support.ResourceController")],Ov),function(e){let t=class extends Ov{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._cameraChangeTime=0,this._handles=new F.a,this._frameTask=null,this._scheduleTask=Cm.a}initialize(){this._cameraChangeTime=this.now(),this._scheduler=Object(Cm.c)(this.now),this._memoryController=function(e){return new yv(e)}(this.view),this._streamDataLoader=new vv.b,this._streamDataLoader.setup(fv.b,fv.a,this._scheduler),this._handles.add([this.view.watch("state.camera",((e,t)=>this._cameraChangedHandler(e,t)),!0),this.view.watch("stationary",(()=>this._stationaryChangedHandler())),this._memoryController.events.on("updating-changed",(()=>this.notifyChange("updating")))]),this._frameTask=Object(g.a)({update:e=>this.frame(e)}),this._scheduleTask=this._scheduler.registerTask(Cm.b.RESOURCE_CONTROLLER)}destroy(){this._handles=Object(b.e)(this._handles),this._scheduleTask.remove(),this._frameTask=Object(b.r)(this._frameTask),this._streamDataLoader=Object(b.e)(this._streamDataLoader),this._memoryController=Object(b.e)(this._memoryController),this._scheduler=Object(b.e)(this._scheduler)}get updating(){var e,t;return!!(null!=(e=this._memoryController)&&e.updating||null!=(t=this._streamDataLoader)&&t.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(e,t,r){return this._scheduleTask.schedule(e,t,r)}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(r,i,n)=>t.request(r,i,e,n),get busy(){return!t.hasDownloadSlots(e)}}}frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(Object(hu.d)(e.deltaTime)),!this._scheduler)||(this._scheduler.state=this.state,this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=this._scheduler.now,this._scheduler.state=this.state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get state(){const e=this.view;return e.animation?0:e.interacting||this._scheduler.now-this._cameraChangeTime<=r?1:2}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e),state:this.state}}};Object(i.a)([Object(j.b)({constructOnly:!0})],t.prototype,"view",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],t.prototype,"now",void 0),Object(i.a)([Object(j.b)()],t.prototype,"_scheduler",void 0),Object(i.a)([Object(j.b)()],t.prototype,"_memoryController",void 0),Object(i.a)([Object(j.b)()],t.prototype,"_streamDataLoader",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],t.prototype,"updating",null),t=Object(i.a)([Object(w.a)("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const r=300}(jv||(jv={}));var _v=r(63);var wv=class{constructor(e,t){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=Object(_v.j)(e)?t.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),"performanceInfo"in e){const t=e.performanceInfo;this.displayedNumberOfFeatures=t.displayedNumberOfFeatures,this.maximumNumberOfFeatures=t.maximumNumberOfFeatures,this.totalNumberOfFeatures=t.totalNumberOfFeatures}}};var xv=class{constructor(e){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const t=e.resourceController.memoryController;this.totalMemory=1048576*t.maxMemory,this.usedMemory=Math.round(t.usedMemory*this.totalMemory),this.quality=t.memoryFactor,this.load=e.resourceController.scheduler.load,this.terrainMemory=e.basemapTerrain?e.basemapTerrain.getUsedMemory():0;const r=e._stage&&e._stage.renderView&&e._stage.renderView.edgeView;this.edgesMemory=Object(b.j)(r)?r.usedMemory:0,e.allLayerViews.items.forEach((t=>{(mv(t)||Object(_v.j)(t))&&this.layerPerformanceInfos.push(new wv(t,e))})),this.layerPerformanceInfos.sort(((e,t)=>t.memory-e.memory))}},Sv=r(25),Tv=r(193),Cv=r(297);class Mv{constructor(e,t,r,i){this._streamDataRequester=e,this._stage=t,this._textureOptions=r,this._textureRequests=new Map,this._frameTask=Object(b.j)(i)?i.registerTask(Cm.b.TEXTURE_UNLOAD):Cm.a}destroy(){this._frameTask.remove(),this._textureRequests.forEach((e=>this.releaseTextureRequest(e))),this._textureRequests.clear()}async fromUrl(e,t,r){Object(m.x)(r);const i=Object(b.j)(r)&&r.signal,n=this.makeUid(e,t);let s=this._textureRequests.get(n);if(!s){const r=Object(m.e)(),i=this._streamDataRequester.request(e,"image",{uid:n,signal:r.signal});s={referenceCount:0,texture:null,textureAsync:null,abortController:r},this._textureRequests.set(n,s),s.textureAsync=i.then((r=>{const i=this.createTexture(e,r,t);return s.texture=i,s.abortController=null,this.addToStage(i),{uid:n,texture:i}}),(e=>{throw s.abortController=null,e}))}return s.referenceCount++,new Promise(((e,t)=>{Object(m.s)(i,(()=>{t(Object(m.f)())})),s.textureAsync.then(e,t)})).catch((e=>{throw this.release(n),e}))}fromData(e,t){const r=this.makeUid(e);let i=this._textureRequests.get(r);return i||(i={referenceCount:0,texture:t(),textureAsync:null,abortController:null},this.addToStage(i.texture),this._textureRequests.set(r,i)),i.referenceCount++,{uid:r,texture:i.texture}}release(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule((()=>this.releaseNow(e)))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this.releaseTextureRequest(t),this._textureRequests.delete(e))}releaseTextureRequest(e){e.texture?this.removeFromStage(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}createTexture(e,t,r){const i={...this._textureOptions,powerOfTwoResizeMode:2};if(Object(Sv.x)(e)){if(r||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;r=r||64,e>1?(t.width=Math.round(r/e),t.height=r):(t.width=r,t.height=Math.round(r*e))}this._stage.renderView&&Object(Cv.b)(this._stage.renderView.renderingContext).svgAlwaysPremultipliesAlpha&&(i.preMultiplyAlpha=!1)}return i.width=t.width,i.height=t.height,new Tv.a(t,i)}addToStage(e){this._stage.add(e)}removeFromStage(e){this._stage.remove(e)}makeUid(e,t){return null!=t?`${e}.${t}px`:e}}class Pv{constructor(e){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=e.viewState,this.view=e.view,this.pointsOfInterest=e.pointsOfInterest,this.objectResourceCache=e.objectResourceCache,this.streamDataRequester=e.resourceController.createStreamDataRequester(4),this.textures=new Mv(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}},e.resourceController.scheduler);const t=Object(M.e)(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=Object(sm.d)(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=Object(sm.c)(e.viewingMode,t)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return{remove(){}};this.graphicsOwners.push(e);const t="layer"in e?e.watch("layer.screenSizePerspectiveEnabled",(()=>this.updateScreenSizePerspectiveEnabled())):null;return this.updateScreenSizePerspectiveEnabled(),{remove:()=>{t&&(t.remove(),Object(Ma.k)(this.graphicsOwners,e),this.updateScreenSizePerspectiveEnabled())}}}updateScreenSizePerspectiveEnabled(){const e=this.graphicsOwners.some((e=>!0===e.get("layer.screenSizePerspectiveEnabled")));if(e&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new F.a;const e=()=>this.updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",e,!0),this.viewState.events.on("camera-projection-changed",e)]),this.updateScreenSizePerspectiveSettings()}else!e&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}updateScreenSizePerspectiveSettings(){const e=this.pointsOfInterest;Av.distance=e.centerOnSurfaceInfrequent.distance,Av.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(Av),this.screenSizePerspectiveSettingsLabels.update(Av),this.view._stage.renderView.setNeedsRender()}}const Av={distance:0,fovY:0};var Ev=r(207),Rv=r(190),Iv=r(208);class Dv{constructor(e,t,r=""){this.graphics=e,this._symbol=new Ev.a({symbolLayers:[new Rv.a({material:{color:t},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Iv.a({text:r,halo:{color:"white",size:1/.75},material:{color:t},size:12})]})}showPoint(e,t){if(Object(b.i)(t))return;this.remove();const r=new Mn.a({x:e[0],y:e[1],z:e[2],spatialReference:t});this._graphic=new s.a({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}remove(){Object(b.j)(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let Fv=class extends N.a{constructor(e){super(e),this.handles=new F.a}destroy(){this.handles.destroy()}};Object(i.a)([Object(j.b)({constructOnly:!0})],Fv.prototype,"renderCoordsHelper",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Fv.prototype,"surface",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Fv.prototype,"state",void 0),Fv=Object(i.a)([Object(w.a)("esri.views.3d.support.PointOfInterest")],Fv);const Lv=Array;let kv=class extends Fv{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new iy.a({location:Mn.a,renderLocation:Lv},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=Object(S.e)(),this.tmpPoint=new Mn.a}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Object(y.b)(this.map,"ground.layers","change",e,e,e))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Object(Cl.o)(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Object(lf.d)(r,t,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=Object(m.e)();this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then((e=>this._updateSurfaceAltitude(e.geometry.z))).catch((e=>{Object(m.n)(e)||this._updateSurfaceAltitude(0)})).catch((()=>{})).then((()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null})),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(zv,this._estimatedSurfaceAltitude,this._camera.eye),Object(Cl.q)(this._get("renderLocation"),zv)||this._set("renderLocation",Object(Cl.m)(this._propertiesPool.get("renderLocation"),zv))}};Object(i.a)([Object(j.b)({constructOnly:!0})],kv.prototype,"scheduler",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],kv.prototype,"cache",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],kv.prototype,"task",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],kv.prototype,"cameraName",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],kv.prototype,"location",null),Object(i.a)([Object(j.b)({constructOnly:!0})],kv.prototype,"map",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],kv.prototype,"renderLocation",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],kv.prototype,"scale",null),Object(i.a)([Object(j.b)({readOnly:!0})],kv.prototype,"updating",null),kv=Object(i.a)([Object(w.a)("esri.views.3d.support.CameraOnSurface")],kv);const zv=Object(S.e)();var Vv=kv;const Nv=Array;let Uv=class extends Fv{constructor(e){super(e),this._propertiesPool=new iy.a({location:Mn.a,renderLocation:Nv},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=Object(S.e)(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null),this._propertiesPool.destroy(),this._propertiesPool=null}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=Gv;let t=this.calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&r&&(t=this.calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const i=qv;if(t&&this.latestSurfaceAltitudeChangesDistanceSignificantly(e,i)&&(Object(Cl.m)(e,i),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t)this.distance=Object(Cl.o)(this.state.camera.eye,e);else{const t=this.state.camera;Object(Cl.g)(e,t.viewForward,this._get("distance")),Object(Cl.h)(e,e,t.eye)}Object(Cl.q)(this._get("renderLocation"),e)||this._set("renderLocation",Object(Cl.m)(this._propertiesPool.get("renderLocation"),e))}calculateSurfaceIntersection(e,t){const r=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,t))return!1;if(this.state.isGlobal){const i=Object(M.e)(this.renderCoordsHelper.spatialReference).radius,n=i+e,s=Object(Cl.v)(r.eye),a=s<n*n,o=Object(Cl.o)(r.eye,t);if(a&&o>i/4){const e=n-Math.sqrt(s);return Object(Cl.g)(t,r.viewForward,e),Object(Cl.h)(t,t,r.eye),!0}}else{const e=this.surface.ready&&this.surface.extent;e&&(t[0]=Object(Bt.e)(t[0],e[0],e[2]),t[1]=Object(Bt.e)(t[1],e[1],e[3]))}return!0}latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==e)return!1;if(this.calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if($b.a.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;const r=this.state.camera.eye,i=Object(Cl.o)(r,e),n=Object(Cl.o)(r,t);if(Math.abs(n-i)/i>Bv)return!0}return!1}};Object(i.a)([Object(j.b)({constructOnly:!0})],Uv.prototype,"scheduler",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Uv.prototype,"task",void 0),Object(i.a)([Object(j.b)()],Uv.prototype,"distance",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Uv.prototype,"estimateSurfaceAltitudeAtCenter",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Uv.prototype,"location",null),Object(i.a)([Object(j.b)({readOnly:!0})],Uv.prototype,"renderLocation",void 0),Object(i.a)([Object(j.b)()],Uv.prototype,"updating",void 0),Uv=Object(i.a)([Object(w.a)("esri.views.3d.support.CenterOnSurface")],Uv);const Bv=.05,Gv=Object(S.e)(),qv=Object(S.e)();var Hv=Uv;class Wv{constructor(e){this.handles=new F.a,this.events=new zi.a,this.contentLayerViews=e.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",(e=>this.layerViewsChanged(e)))),this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}layerViewsChanged(e){e.added.forEach((e=>{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this.handles.add(e.on("visible-geometry-changed",(()=>this.contentChanged())),e.uid)})),e.removed.forEach((e=>this.handles.remove(e.uid)))}contentChanged(){this.events.emit("request-update",$v)}}const $v={};const Qv=Array;let Zv=class extends Fv{constructor(e){super(e),this._propertiesPool=new iy.a({location:Mn.a,renderLocation:Qv},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([this.centerOnSurface.watch("renderLocation",(()=>this.updateRenderLocation())),this.state.watch("camera",(()=>this.updateRenderLocation()))]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Cm.b.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,i=this.state.camera;this._dirty=!1,r.worldUpAtPosition(t,Xv);const n=Math.max(0,(Math.acos(Object(Cl.j)(Xv,i.viewForward))-.5*Math.PI)*(i.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!Object(Cl.F)(e,t)){const e=this._propertiesPool.get("renderLocation");Object(Cl.m)(e,t),this._set("renderLocation",e)}return}const s=1-Object(Bt.e)(n/(.5*Math.PI),0,1),a=s*s*s;this._calculateScreenHorizontalEdgeOnSurface(Yv);const o=this._propertiesPool.get("renderLocation");Object(Cl.k)(o,t,Yv,a),e&&Object(Cl.F)(e,o)||this._set("renderLocation",o)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.camera,r=t.getRenderCenter(Object(O.d)());if(r[1]=t.aboveGround?t.padding[2]:t.fullHeight-t.padding[0],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const i=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,Jv)){Object(Cl.l)(Jv,Jv,t.eye);const r=Object(Cl.t)(Jv,Jv);if(this.renderCoordsHelper.intersectManifold(Object(fu.g)(t.eye,r),i,e))return e}return this.renderCoordsHelper.setAltitude(e,i,t.eye)}updateRenderLocation(){this._dirty=!0}};Object(i.a)([Object(j.b)()],Zv.prototype,"_dirty",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Zv.prototype,"scheduler",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Zv.prototype,"centerOnSurface",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Zv.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],Zv.prototype,"updating",null),Object(i.a)([Object(j.b)({readOnly:!0})],Zv.prototype,"location",null),Object(i.a)([Object(j.b)({readOnly:!0})],Zv.prototype,"renderLocation",void 0),Zv=Object(i.a)([Object(w.a)("esri.views.3d.support.CenterOnSurface")],Zv);const Xv=Object(S.e)(),Jv=Object(S.e)(),Yv=Object(S.e)();var Kv=Zv;let eO=class extends N.a{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new F.a}get renderLocation(){if(!this.location)return null;const e=Object(S.e)();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],(()=>this._update())),Object(y.b)(this,"surface.layers","change",(()=>this._update()))]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||!this.surfaceView.extent||!this.surfaceView.spatialReference)return void this._set("location",null);const e=Object(P.e)(this.surfaceView.extent),t=new Mn.a({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=Object(m.e)(),this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then((e=>{this._updateController=null,this._set("location",e.geometry)})).catch((e=>{Object(m.n)(e)||e&&"elevation-query:invalid-layer"===e.name||console.error("StableSurfaceCenter failed to update: ",e)}))):this._set("location",t)}};Object(i.a)([Object(j.b)({constructOnly:!0})],eO.prototype,"view",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],eO.prototype,"cache",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"view.map.ground"})],eO.prototype,"surface",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"view.basemapTerrain"})],eO.prototype,"surfaceView",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],eO.prototype,"location",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],eO.prototype,"renderLocation",null),eO=Object(i.a)([Object(w.a)("esri.views.3d.terrain.StableSurfaceCenter")],eO);let tO=class extends N.a{constructor(){super(...arguments),this.handles=new F.a,this._tileGeometryUpdateExtent=Object(P.m)(),this._tileGeometryUpdateSpatialReference=null,this.events=new zi.a,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",(e=>this._tileGeometryChanged(e))),this.scheduler.registerTask(Cm.b.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",rO),Object(P.m)(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Object(P.o)(this._tileGeometryUpdateExtent,e.tile.extent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.camera.eye,i=sO,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,iO,t),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,nO,t),iO[0]<nO[0]?(i[0]=iO[0],i[2]=nO[0]):(i[0]=nO[0],i[2]=iO[0]),iO[1]<nO[1]?(i[1]=iO[1],i[3]=nO[1]):(i[1]=nO[1],i[3]=iO[1]),Object(P.v)(i,e)}};Object(i.a)([Object(j.b)({constructOnly:!0})],tO.prototype,"state",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],tO.prototype,"centerOnSurfaces",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],tO.prototype,"renderCoordsHelper",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],tO.prototype,"scheduler",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],tO.prototype,"surface",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],tO.prototype,"updating",void 0),tO=Object(i.a)([Object(w.a)("esri.views.3d.support.SurfaceGeometryUpdates")],tO);const rO={},iO=Object(S.e)(),nO=Object(S.e)(),sO=Object(P.m)();var aO=tO,oO=r(172);let lO=class extends N.a{constructor(e){super(e),this._handles=new F.a,this._tmpRay=Object(fu.c)(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new iy.a({renderPointOfView:cO},this),this.renderPointOfView=Object(S.e)(),this._pois=new Array,this._debugCenters=new Map}initialize(){var e;const{state:t,basemapTerrain:r,renderCoordsHelper:i,map:n}=this.view;this._surfaceIntersector=new Oh.a(t.viewingMode),t.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=0,this._contentIntersector=new Oh.a(t.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),a=this.view.resourceController.scheduler,o=Object(b.s)(null==(e=this.view.basemapTerrain)?void 0:e.elevationQueryCache),l={state:t,scheduler:a,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Hv({...l,task:Cm.b.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Hv({...l,task:Cm.b.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Hv({...l,task:Cm.b.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Vv({...l,cache:o,task:Cm.b.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("contentCameraOnSurface",new Vv({...l,cache:o,task:Cm.b.POINT_OF_INTEREST_INFREQUENT,map:n,cameraName:"contentCamera"})),this._set("surfaceGeometryUpdates",new aO({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Wv({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new eO({cache:o,view:this.view})),this._set("focus",new Kv({state:t,scheduler:a,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(e,t)=>this._estimateSurfaceIntersectionAtRenderPoint(e,t)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Dv(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Dv(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Dv(c,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new Dv(c,"blue","CameraOfInterestOnSurface")),this._debugCenters.set(this.focus,new Dv(c,"green","Focus")),this._handles.add([t.watch("camera",(e=>this._cameraChanged(e)),!0),r.watch("extent",(()=>this._updateCenterPointsOfInterest())),Object(y.g)(r,"updating",(()=>this._updateCenterPointsOfInterest()),!0),this.surfaceGeometryUpdates.events.on("request-update",(()=>this._updateCenterPointsOfInterest())),this.contentGeometryUpdates.events.on("request-update",(()=>this._updateCenterOnContent())),Object(y.a)($b.a,"SHOW_POI",(e=>this._setDebug(e)))]),this._cameraChanged(this.view.state.camera);for(const u of this._pois)u.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!!(null!=(e=this.surfaceGeometryUpdates)&&e.updating||this._pois.some((e=>e.updating)))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return Object(b.i)(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,uO,hO)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(uO):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(Object(b.i)(e))return this._surfaceAltitudeAtCenter;const t=e.origin,r=Object(Cl.h)(uO,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e),this._surfaceIntersector.camera=this.view.state.camera,this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(uO)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(uO)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t){const r=Object(Bh.b)(this.view.state.camera,e,dO);if(Object(b.i)(r))return null;const i=r.origin,n=Object(Cl.h)(uO,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r),this._surfaceIntersector.camera=this.view.state.camera,this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,n),this._surfaceIntersector.results.min.getIntersectionPoint(t)?t:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;Object(Cl.q)(this.renderPointOfView,t)||this._set("renderPointOfView",Object(Cl.m)(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach((e=>e.remove())),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(Object(y.a)(t,"renderLocation",(e=>this._debugCenters.get(t).showPoint(e,t.renderCoordsHelper.spatialReference))),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"centerOnContent",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"centerOnSurfaceFrequent",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"centerOnSurfaceInfrequent",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"cameraOnSurface",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"contentCameraOnSurface",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"focus",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"renderPointOfView",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"surfaceOrigin",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"contentGeometryUpdates",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"surfaceGeometryUpdates",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],lO.prototype,"view",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],lO.prototype,"updating",null),lO=Object(i.a)([Object(w.a)("esri.views.3d.support.PointsOfInterest")],lO);const cO=Array,uO=Object(S.e)(),dO=Object(fu.c)(),hO={exclude:new Set([oO.b])};var pO=lO;class fO{constructor(e){this.store=e}destroy(){this.store.destroy()}get(e){return this.store.get(e)}put(e,t){this.store.put(e,t,t.values.byteLength+256)}}var bO=r(649),mO=r(353),gO=r(670),yO=r(413);class vO{constructor(e=0,t=0){this.min=e,this.max=t,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}}class OO{constructor(e,t,r){this.samplerData=null,this.level=e[0],this.i=e[1],this.j=e[2],this.extent=t;const i=r.noDataValue,n=r.values;let s=1/0,a=-1/0,o=!0,l=!1;for(let c=0;c<n.length;c++){const e=n[c];e!==i?(s=e<s?e:s,a=e>a?e:a,o=!1):l=!0}o&&(s=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:i,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(t[2]-t[0]),dy:(r.width-1)/(t[3]-t[1]),x0:t[0],y1:t[3]},this.bounds=[s,a],this.hasNoDataValues=l}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(e,t,r,i){i.min=1/0,i.max=-1/0,i.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return i;const s=2**n;if(Math.floor(t/s)!==this.i||Math.floor(r/s)!==this.j)return i;let a=1/0,o=-1/0;const l=this.samplerData.width,c=this.samplerData.pixelData,u=.5*_a.c;let d=(l-1)/s,h=(r-this.j*s)*d,p=(t-this.i*s)*d;if(d<1){const e=Math.floor(h),t=Math.floor(p),r=e+t*l,n=c[r],s=c[r+1],a=c[r+l],o=c[r+l+1];if(n+s+a+o<u){const r=h-e,l=p-t,c=Object(Xo.c)(n,s,a,o,r,l),u=Object(Xo.c)(n,s,a,o,r+d,l),f=Object(Xo.c)(n,s,a,o,r,l+d),b=Object(Xo.c)(n,s,a,o,r+d,l+d);return i.min=Math.min(c,u,f,b),i.max=Math.max(c,u,f,b),i}h=e,p=t,d=1}else h=Math.floor(h),p=Math.floor(p),d=Math.ceil(d);for(let f=h;f<=h+d;f++)for(let e=p;e<=p+d;e++){const t=c[f+e*l];t<u?(a=Math.min(a,t),o=Math.max(o,t)):i.hasNoDataValues=!0}return i.min=a,i.max=o,i}static sample(e,t,r){for(const i of r){if(!i)continue;const r=i.safeWidth,n=i.width,s=i.pixelData;let a=Object(Bt.e)(i.dy*(i.y1-t),0,r),o=Object(Bt.e)(i.dx*(e-i.x0),0,r);const l=Math.floor(a),c=Math.floor(o),u=l*n+c,d=u+n,h=s[u],p=s[d],f=s[u+1],b=s[d+1];if(h+p+f+b<.5*_a.c){a-=l,o-=c;const e=h+(f-h)*o;return e+(p+(b-p)*o-e)*a}}return null}}const jO=Object(hu.a)(40),_O=Object(hu.a)(50);var wO=r(434),xO=r(255),SO=r(281),TO=r(56);function CO(){var e;const t=null==(e=TO.a.require)?void 0:e.modules;if(t){const e=Object.keys(t);for(const r of e)-1!==r.search(".glsl")&&delete t[r]}}const MO=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let PO,AO=class extends N.a{constructor(e){super(e),this._handles=new F.a,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Map,this._drapeTargets=new Set,this._renderedAltitude=0,this._displayOpacity=0,this._displayOpacityTime=-1,this._placementDirty=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._layerViewsDirty=!0,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=Object(p.a)("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return(this._placementDirty||this._layerViewsDirty)&&(this._drapeSources.size>0||this.view.graphics.length>0||$b.a.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view,t=e.state.isGlobal&&Object(b.j)(this._spatialReference)?Object(uy.f)(this._spatialReference):1;this.renderer=new xO.b({view:e,globalUnitScale:t,spatialReference:this._spatialReference}),this.renderer.onHasHighlightsChanged=()=>{this._setDrawTexturesDirty(),this.notifyChange("hasHighlights")},this.renderer.onRendersOccludedChanged=()=>{this._setDrawTexturesDirty(),this.notifyChange("rendersOccluded")},this.renderer.onContentChanged=()=>this._setDrawTexturesDirty(),this.renderer.onHasWaterChanged=t=>{var r;return null==(r=e._stage)?void 0:r.renderView.setRenderParameters({hasOverlayWater:t})},this.groundIntersector=new Oh.a(this.view.state.viewingMode),this.groundIntersector.options.backfacesTerrain=!0,this.groundIntersector.options.invisibleTerrain=!0,this.groundIntersector.options.hud=!1,this._handles.add([e.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],(()=>this.setOverlayPlacementDirty())),this.surface.on("elevation-change",(()=>this.setOverlayPlacementDirty())),e.allLayerViews.on("after-changes",(()=>this._layerViewsDirty=!0)),e.on("resize",(()=>this.setOverlayPlacementDirty())),Object(g.a)({preRender:e=>{this.renderer.processSyncLayers(),this._updateLayerViews(),this.renderer.hasOverlays&&(this._dispatchRendererUpdate(e),this._drawOverlayTextures(this.renderer.overlays)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(Cm.b.OVERLAY_MANAGER,this),e._stage.renderView.events.on("force-camera-for-screenshot",(e=>{this._updateOverlays(e),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays)}))]),this._updateLayerViews()}destroy(){this._drapeSources.forEach(((e,t)=>this.unregisterDrapeSource(t))),this._drapeTargets.forEach((e=>this._unregisterDrapeTarget(e))),this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),Object(b.j)(PO)&&(PO.remove(),PO=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;Object(b.j)(e)&&Object(b.j)(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Xo.a(-20037508.342787,20037508.342787):new Xo.a(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.globalUnitScale=this._isSpherical&&Object(b.j)(this._spatialReference)?Object(uy.f)(this._spatialReference):1)):this.renderer.disposeOverlays()}getGpuMemoryUsage(){return this.renderer.gpuMemoryUsage}_updateLayerViews(){if(!this._layerViewsDirty)return;const e=new Set;for(const t of this.view.allLayerViews.items)e.add(t.uid),"drapeSourceType"in t&&!this._drapeSources.has(t)&&this._registerDrapeSource(t,0),"drapeTargetType"in t&&!this._drapeTargets.has(t)&&this._registerDrapeTarget(t);this._drapeSources.forEach(((t,r)=>{0!==t||e.has(r.uid)||this.unregisterDrapeSource(r)})),this._drapeTargets.forEach((t=>{e.has(t.uid)||this._unregisterDrapeTarget(t)})),this.renderer.updateLayerOrder(),this._setDrawTexturesDirty(),this._layerViewsDirty=!1}registerDrapeSource(e){this._registerDrapeSource(e,1)}_registerDrapeSource(e,t){this._drapeSources.set(e,t),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources),this.renderer.overlays.forEach((t=>{this._updateDrapeSource(e,t)})),this._setOverlayContentDirty(),this.notifyChange("running")}_updateDrapeSource(e,t){Object(b.j)(e.setDrapingExtent)&&Object(b.j)(this._spatialReference)&&e.setDrapingExtent(t,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setOverlayContentDirty(),this.notifyChange("running"))}_registerDrapeTarget(e){this._drapeTargets.add(e),this._updateDrapeTarget(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}_updateDrapeTarget(e){this.renderer.overlays.forEach((t=>e.setDrapingTextures(t)))}_unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setOverlayContentDirty(){this.setOverlayPlacementDirty(),this._setDrawTexturesDirty()}setOverlayPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera)}_updateOverlays(e){if(!this._spatialReference)return;this._updateLayerViews();const t=Object(wO.b)(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,t,IO);const r=Object(P.A)(IO.inner)/Object(P.A)(IO.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const i=this._updateOverlay(0,IO.inner,t,1),n=this._updateOverlay(1,IO.outer,t,r);(i||n)&&(this.surface.updateTileOverlayParams(),this._setDrawTexturesDirty()),this._placementDirty=!1,this.surface.updateOverlayOpacity()}_updateOverlay(e,t,r,i){if(0===this.renderer.overlays.length)return!1;const n=this.renderer.overlays[e];if(!function(e,t){const r=1e-5,i=$b.a.TESTS_DISABLE_UPDATE_THRESHOLDS?0:r*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);for(let n=0;n<4;n++)if(Math.abs(t[n]-e[n])>i)return!0;return!1}(t,n.extent)&&r===n.resolution&&n.pixelRatio===i)return!1;Object(P.y)(n.extent,t),n.resolution=r,n.pixelRatio=i;const s=Object(P.e)(n.extent);return n.renderLocalOrigin=Object(SO.a)(s[0],s[1],0,"OV_"+this._latestOriginId++),this._drapeSources.forEach(((e,t)=>this._updateDrapeSource(t,n))),!0}computeOpacity(e){if(!this.renderer.hasOverlays)return this._displayOpacity=0,this._displayOpacityTime=-1,1;if(3.5*e<this._renderedAltitude){const t=(e-this._renderedAltitude/10)/(this._renderedAltitude/3.5-this._renderedAltitude/10);this._displayOpacity=Math.sqrt(Object(Bt.e)(t,0,1)),this._displayOpacityTime=performance.now()}else if(1!==this._displayOpacity){const e=performance.now();this._displayOpacityTime=this._displayOpacityTime>0?this._displayOpacityTime:e;const t=e-this._displayOpacityTime,r=this.surface.textureFadeDuration;if(t<r)return this._displayOpacity+(1-this._displayOpacity)*(t/r);this._displayOpacity=1,this._displayOpacityTime=-1}return this._displayOpacity}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[0],i=this.renderer.overlays[1],n=Object(P.u)(e.extent,e.surface.extent,DO);this._rectInsideRect(n,r.extent)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,i.extent)?(this._setTileOverlayData(n,0,t),this._setTileOverlayData(n,1,t)):(this._clearTileOverlayData(0,t),this._clearTileOverlayData(1,t))}else this._clearTileOverlayData(0,t),this._clearTileOverlayData(1,t)}overlayPixelSizeInMapUnits(e){if(0===this.renderer.overlays.length)return 0;const t=this.renderer.overlays[0],r=this.renderer.overlays[1],i=this._pointIsInExtent(e,t.extent)?t:r;return(i.extent[2]-i.extent[0])/i.resolution}_setTileOverlayData(e,t,r){if(0===this.renderer.overlays.length)return;const i=this.renderer.overlays[t].extent;r.setScale(t,(e[2]-e[0])/(i[2]-i[0]),(e[3]-e[1])/(i[3]-i[1]));let n=e[0];if(this._longitudeCyclical){n=this._longitudeCyclical.minimalMonotonic(i[0],n);const t=this._longitudeCyclical.minimalMonotonic(i[0],e[2]);n>t&&(n=t-(e[2]-e[0]))}r.setOffset(t,(n-i[0])/(i[2]-i[0]),(e[1]-i[1])/(i[3]-i[1]))}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){CO(),await this.renderer.reloadShaders(),this.runTask()}stopAnimationsAtTime(e){this.renderer.stopAnimationsAtTime(e),this._drawTexturesAnimateDirty=!0}_dispatchRendererUpdate(e){const t=Object(hu.a)(e.time-this._animationTimeLast);t<_O||(this._animationTimeLast=e.time,this.renderer.updateLogic({dt:t,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0))}_setDrawTexturesDirty(){this.renderer.hasOverlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()}_intersectGroundFromView(e,t,r,i){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,LO,t,r);if(Object(b.i)(n))return!1;const s=n.origin,a=Object(Cl.h)(RO,n.origin,n.direction);return this.groundIntersector.reset(s,a),this.groundIntersector.intersect([],null,e),this.view.basemapTerrain.intersect(this.groundIntersector,null,s,a),this.groundIntersector.results.min.getIntersectionPoint(i)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const i=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),s=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,o=Object(Bt.e)(s.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),l=e.aboveGround;if("global"===this.view.viewingMode){const t=RO;Object(pu.b)(Object(pu.e)(Object(M.e)(this.view.spatialReference).radius+o),Object(fu.g)(e.eye,e.viewForward),t),Object(Cl.l)(t,t,e.eye);const n=Xo.f.normalize(Object(Th.b)(e.viewForward,t,e.viewRight))/e.fovY+.5,s=n<=0||n>=1?.5:i;r=l?s*n:n+s*(1-n)}else{const t=.5*Math.PI-Math.acos(-e.viewForward[2]),n=Math.tan(t),s=Object(Ml.g)(0,n,1,0),a=Object(rc.m)(s,s,e.projectionMatrix)[1],o=Object(Bt.e)(.5+.5*a,0,1);r=1===o||0===o?.5:l?o*i:1-(1-o)*i}return!!this._intersectGroundFromView(e,.5,r,t)&&Object(Cl.E)(t,e.eye)<s.distance*s.distance}_computeOverlayExtents(e,t,r){const i=this.surface.extent,n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=Object(S.e)();this._findHorizonBasedPointOfInterest(e,s)||Object(Cl.m)(s,n),this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(e.eye);const a=Object(Cl.o)(e.eye,s),o=Vu(this.view.renderCoordsHelper,n,e.eye),l=Math.PI/2-Math.abs(o-Math.PI/2);$b.a.OVERLAY_SHOW_CENTER?(Object(b.i)(PO)&&(PO=new Dv(this.view.graphics,"red")),PO.showPoint(s,this._renderSR)):Object(b.j)(PO)&&PO.remove(),this._overlaySREqualsRenderSR||Object(C.z)(s,this._renderSR,s,this._spatialReference);let c=t*e.perRenderPixelRatio*a/2,u=!1,d=1/0;this._isSpherical&&Object(b.j)(this._spatialReference)&&(this._spatialReference.isWebMercator?(c/=Math.cos(Object(R.h)(s[1])),d=this.surface.extent[3]):(u=!0,c/=Object(M.e)(this._spatialReference).metersPerDegree,d=90),c>=d&&(c=d,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let h=1;u&&(h=1/Math.max(.2,Math.cos(Math.abs(Object(Bt.g)(s[1])))),c*h>180&&(h=180/c));const p=Math.log(2)/12;c=Math.exp(Math.round(Math.log(c)/p)*p);const f=c*h,m=.5*t/(32*f),g=.5*t/(32*c);s[0]=Math.round(s[0]*m)/m,s[1]=Math.round(s[1]*g)/g;const y=r.inner;y[0]=s[0]-f,y[1]=s[1]-c,y[2]=s[0]+f,y[3]=s[1]+c,this._isSpherical&&this._shiftExtentToFitBounds(y,1/0,d);const v=r.outer;if(Object(P.y)(v,y),6*f>i[2]-i[0])Object(P.y)(v,i);else if(l<=.25*Math.PI)v[0]-=f,v[1]-=c,v[2]+=f,v[3]+=c;else{Object(C.z)(e.eye,this._renderSR,RO,this._spatialReference),Object(ec.a)(EO,s,RO);let t=-Math.atan2(EO[1],EO[0])+.125*Math.PI;t<0&&(t+=2*Math.PI);const r=Math.floor(t/(.25*Math.PI));Object(rc.b)(EO,MO[r],2*c),EO[0]*=h,EO[2]*=h,Object(rc.a)(v,v,EO)}if(this._isSpherical&&(v[0]=this._longitudeCyclical.clamp(v[0]),v[2]=this._longitudeCyclical.clamp(v[2]),v[1]=Math.max(v[1],-d),v[3]=Math.min(v[3],d)),!this._isSpherical&&i){const e=Object(P.u)(y,i,DO),t=Object(P.u)(v,i,FO);Object(P.g)(e,t)&&(v[2]=v[0],v[3]=v[1])}}_drawOverlayTextures(e){if(0===e.length||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const t=this._drawOverlay(e[0]),r=this._drawOverlay(e[1]);0!==t&&0!==r||this.surface.updateTileOverlayParams(),this._collectUnusedRenderTargetMemory(),this._drapeTargets.forEach((e=>this._updateDrapeTarget(e))),this._drawTexturesAnimateDirty=!1,this._drawTexturesDirty?(this._drawTexturesDirty=!1,this.surface.requestRender(),this.surface.requestUpdate()):this.surface.requestRender(0)}_drawOverlay(e){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,this.view.state.camera.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):Object(P.v)(e,t)}_rectInsideRect(e,t){return this._longitudeCyclical?this._longitudeCyclical.contains(t[0],t[2],e[0])&&this._longitudeCyclical.contains(t[0],t[2],e[2])&&e[1]>t[1]&&e[3]<t[3]:Object(P.g)(t,e)}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,i=e.y;return r>t[0]&&r<t[2]&&i>t[1]&&i<t[3]}_shiftExtentToFitBounds(e,t,r){let i=0,n=0;e[0]<-t?i=e[0]+t:e[2]>t&&(i=t-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),Object(P.x)(e,i,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};Object(i.a)([Object(j.b)()],AO.prototype,"_spatialReference",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],AO.prototype,"running",null),Object(i.a)([Object(j.b)()],AO.prototype,"_placementDirty",void 0),Object(i.a)([Object(j.b)()],AO.prototype,"_layerViewsDirty",void 0),Object(i.a)([Object(j.b)()],AO.prototype,"renderer",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],AO.prototype,"surface",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"surface.suspended"})],AO.prototype,"suspended",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],AO.prototype,"updating",null),Object(i.a)([Object(j.b)({type:Boolean})],AO.prototype,"hasHighlights",null),Object(i.a)([Object(j.b)({type:Boolean})],AO.prototype,"rendersOccluded",null),AO=Object(i.a)([Object(w.a)("esri.views.3d.terrain.OverlayManager")],AO);const EO=Object(Ml.e)(),RO=Object(S.e)(),IO={inner:Object(P.k)(),outer:Object(P.k)()},DO=Object(P.k)(),FO=Object(P.k)(),LO=Object(fu.c)();class kO{constructor(e,t){this._factoryCallback=e,this._lengthCallback=t,this._pool=new Map}acquire(e){if(!kO.test.disabled){const t=this._pool.get(e);if(t&&0!==t.length)return t.pop()}try{return this._factoryCallback(e)}catch(t){const r=window.performance&&window.performance.memory;let i="";throw r&&(i=`\n  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+t+i),t}}release(e){if(kO.test.disabled)return;const t=this._lengthCallback(e);let r=this._pool.get(t);r||(r=new Wb.a({shrink:!0}),this._pool.set(t,r)),r.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}kO.test={disabled:!1};var zO=r(88);const VO=Object(Gl.a)().vec3f("position").vec2f("uv0"),NO=new kO((e=>VO.createBuffer(e)),(e=>e.count));class UO{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Object(Vm.k)(),this.numSurfaceIndices=0,this.numSkirtIndices=0,this.numWithoutSkirtIndices=0,this.numVertsPerRow=0,this.skirtLength=0,this.uvOffsetAndScale=Object(Ml.e)()}}class BO{constructor(e,t,r){this.values=e,this.numSurfaceIndices=t,this.numSkirtIndices=r}}const GO=new Map;function qO(e,t,r,i){const n=(2&r)>0,s=t+(i?1024:0)+(n?2048:0);let a=GO.get(s);a||(a=function(e,t,r){const i=e-1,n=e-1,s=e*e,a=2*i+2*n;let o=i*n*2*3,l=6*a,c=6*(2*i+n-1);r&&(o*=2,l*=2,c*=2);const u=s+a>65536?new Uint32Array(o+l):new Uint16Array(o+l);let d,h,p,f,b=0,m=0,g=o,y=0;for(let v=0;v<=n;v++){t&&(y=0===v?c:v===n?-c:0),g+=y;for(let e=0;e<=i;e++){const t=$O(e,v,i,n);if(t>-1){const a=QO(e,v,i,n);0!==a&&(d=b,h=s+t,p=s+(0===e&&1===v?0:t+1),f=b+a,r?(u[g+0]=d,u[g+1]=h,u[g+2]=h,u[g+3]=p,u[g+4]=p,u[g+5]=d,u[g+6]=p,u[g+7]=f,u[g+8]=f,u[g+9]=d,u[g+10]=d,u[g+11]=p,g+=12):(u[g+0]=d,u[g+1]=h,u[g+2]=p,u[g+3]=p,u[g+4]=f,u[g+5]=d,g+=6))}++b,e<i&&v<n&&(d=v*(i+1)+e,h=d+1,p=h+(i+1),f=p-1,r?(u[m+0]=d,u[m+1]=h,u[m+2]=h,u[m+3]=p,u[m+4]=p,u[m+5]=d,u[m+6]=p,u[m+7]=f,u[m+8]=f,u[m+9]=d,u[m+10]=d,u[m+11]=p,m+=12):(u[m+0]=d,u[m+1]=h,u[m+2]=p,u[m+3]=p,u[m+4]=f,u[m+5]=d,m+=6))}g-=y}return new BO(u,o,l)}(t,n,i),GO.set(s,a)),e.indices=a.values,e.numSurfaceIndices=a.numSurfaceIndices,e.numSkirtIndices=a.numSkirtIndices,e.numWithoutSkirtIndices=e.numSurfaceIndices+(r?6*(t-1)*(i?2:1):0)}function HO(e,t,r,i){e<i[0]&&(i[0]=e),e>i[3]&&(i[3]=e),t<i[1]&&(i[1]=t),t>i[4]&&(i[4]=t),r<i[2]&&(i[2]=r),r>i[5]&&(i[5]=r)}function WO(e,t){const r=t>e?1:0;return 2+4*r+(1-2*r)*(e+t)}function $O(e,t,r,i){return 0===t?e:e===r?r+t:t===i?r+i+(r-e):0===e&&t>0?2*r+i+(i-t):-1}function QO(e,t,r,i){return 0===t&&e!==r?1:e===r&&t!==i?r+1:t===i&&0!==e?-1:0===e&&0!==t?-(r+1):0}const ZO=new Array(_a.h+1),XO=new Array(_a.h+1),JO=new Array(_a.h+1),YO=new Array(_a.h+1),KO=Object(S.e)(),ej=Object(S.e)();var tj=r(126);class rj{get updating(){return!!this._tileRequested}init(e,t,r,i){this.tile=e,this._layerIdx=t,this._layerClass=r,this._suspended=i,this._tileLayerInfo=e.getLayerInfo(t,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return Object(b.j)(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,t=this._layerClass,r=this.tile.surface.layerViewByIndex(e,t),i=Object(_v.c)(r),{minLevel:n,maxLevel:s}=r.dataLevelRange,a=this._desiredMinLevelDelta,o=this._progressiveLevelModulo+a,l=this._scaleRangeEnabled?tj.e:()=>!0;let c=this.tile;const u=c.level;let d;const h=this._tileLayerInfo.upsampleInfo,p=h?h.tile.level:-1,f=Object(b.h)(i,"tilemapCache");for(;c&&l(c,i,!1)&&c.level>=n;){const r=c.level,i=u-r,l=c.layerInfo[t][e];if(l.data&&i>=a){r>p&&this._setUpsampleTile(c),l.dataInvalidated&&(d=c);break}if((Object(b.i)(f)||"unavailable"!==f.getAvailability(c.lij[0],c.lij[1],c.lij[2]))&&r<=s&&!l.data&&!l.dataMissing&&((Object(b.i)(d)||c.level===n||r%_a.j==0||u-d.level<a)&&(d=c),i>=o))break;c=c.parent}return Object(b.j)(d)&&u-d.level<a&&this._tileLayerInfo.upsampleInfo&&(d=null),d}_findAncestorWithData(){const e=this.tile.vlevel,t=this._desiredMinLevelDelta;let r;for(let i=this.tile;i;i=i.parent)if(i.hasLayerData(this._layerIdx,this._layerClass)){if(e-i.level>=t)return i;r=i}return r}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}const ij=new Error("Abstract method called on TileAgent"),nj=new class extends rj{get _desiredMinLevelDelta(){throw ij}get _progressiveLevelModulo(){throw ij}dispose(){}};var sj=class extends rj{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return _a.b-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};var aj=class extends rj{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return _a.j}},oj=r(427);class lj{constructor(){this.waitingAgents=new Wb.a,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const t=cj.acquire();return t._init(e),t}release(){this.dispose(),uj.delete(this),cj.release(this)}dispose(){this.loadingAgent=Object(b.f)(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=Object(_v.p)(this._data)}static prune(){cj.prune(0)}_init(e){this.waitingAgents.clear(),this._data=Object(_v.p)(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Object(b.a)(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,t){if(e===t||Object(b.i)(t))this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===t)return;this._upsampleInfo.tile.unrefMapData()}t.refMapData(),Object(tj.d)(e,t,this._upsampleInfo)}}get data(){return this._data}set data(e){Object(_v.p)(this._data),this._data=e}}const cj=new wg.a(lj,null,(()=>{})),uj=new Map;var dj=r(241);const hj=Object(S.e)(),pj=Object(S.e)(),fj=Object(S.e)(),bj=Object(Ml.e)();class mj{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}function gj(e,t,r,i){const n=0===r?Oj.acquire():vj.acquire();return n.init(e,t,r,i),n}function yj(e){e.dispose(),e instanceof sj?Oj.release(e):e instanceof aj&&vj.release(e)}const vj=new wg.a(aj),Oj=new wg.a(sj),jj=new vO,_j=-1;var wj=class{constructor(e){this._numSubdivisionAtLevel=e,this.lij=[0,0,0],this._children=[null,null,null,null],this._dirty=!0,this._previouslyRendered=!1,this.extent=Object(P.k)(),this._elevationBounds=Object(tc.b)(),this.layerInfo=[[],[]],this.extentInRadians=Object(P.k)(),this.centerAtSeaLevel=Object(S.e)(),this._center=[Object(S.e)(),Object(pu.c)(),Object(S.e)()],this.up=Object(S.h)(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=_j,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){vj.prune(0),Oj.prune(0),lj.prune()}get usedMemory(){return this._usedMemory===_j&&this._updateMemoryUsed(),this._usedMemory+(this.isCached?0:this.mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){this._usedMemory===_j&&this._updateMemoryUsed();let e=this._mapTileMemory;for(const{data:t}of this.layerInfo[1])t instanceof mO.a&&(e+=t.memoryUsage);return e}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get numSubdivisionsAtLevel(){return this._numSubdivisionAtLevel}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get edgeLen(){return this._edgeLen}get radius(){return this._center[1][3]}get screenDepth(){return this._screenDepth}get visible(){if(this._dirty){this._dirty=!1;const e=this._isVisible(this.surface.frustum);e!==this._visible&&(this._visible=e,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender()),this.updateAgentSuspension()}return this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setNeedsRender()),e}get shouldLoad(){if(!this.loadable)return!1;if(1===this._surface.lodSnapping){const e=this.level-this._surface.snapLevel;if(0===e)return!0;if(1===e)return!1}return this.isLeaf}init(e,t,r){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=Object(M.e)(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(Object(tj.i)(this)),this._edgeLen=0,this._edgeLen2=0,this._center[1][3]=0,this.vlevel=e?e[0]:0,t&&t.elevationBounds?Object(ec.c)(this._elevationBounds,t.elevationBounds):Object(ec.r)(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=t,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const i of _a.f){const e=r.numLayers(i),t=this.layerInfo[i];for(const r of t)r.release();t.length=e;for(let r=0;r<e;r++)t[r]=lj.acquire(this._surface.upsampleInfoPool),0===i&&this.findElevationBoundsForLayer(r,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,_a.h)}release(){Object(_v.s)(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(Object(tj.i)(this));for(const e of _a.f){for(const t of this.layerInfo[e])t.release();this.layerInfo[e].length=0}this._parent=null,this._surface=null,this._usedMemory=_j}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(Object(tj.i)(this))}unrefMapData(){if(--this._mapDataRefCount,this.isCached){const e=this.cachedMemory;e>0&&(this._surface.upsampleMapCache.put(Object(tj.i)(this),this,e),this.setMemoryDirty())}}setMemoryDirty(){this._usedMemory=_j}get cpuImageMemorySize(){const e=this._surface.tilingScheme.pixelSize;return e*e*4}_updateMemoryUsed(){this._usedMemory=0,this._mapTileMemory=0;const e=this.cpuImageMemorySize;for(const{data:t}of this.layerInfo[1])t instanceof dj.a?this._mapTileMemory+=Object(Ql.c)(t.texture):t instanceof HTMLImageElement||t instanceof vv.a?this._mapTileMemory+=e:t instanceof oj.a&&(this._mapTileMemory+=t.memoryUsage);for(const t of this.layerInfo[0])this._usedMemory+=t.data?e:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=Object(Ql.c)(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(Object(tj.i)(this),this,this.cachedMemory)}getUsedMemoryForLayer(e,t){const r=this.layerInfo[e][t];if(!r||!r.data)return 0;if(1!==e||this.isCached){if(0===e)return this.cpuImageMemorySize}else{const e=r.data;if(e instanceof dj.a)return Object(Ql.c)(e.texture);if(e instanceof HTMLImageElement||e instanceof vv.a)return this.cpuImageMemorySize;if(e instanceof mO.a||e instanceof oj.a)return e.memoryUsage}return 0}updateScreenDepth(e){Object(Cl.m)(bj,this._center[1]),bj[3]=1,Object(rc.m)(bj,bj,e),this._screenDepth=bj[2]<0?0:bj[2]/bj[3]}shouldSplit(e,t,r){if(Object(b.j)(e.frustum)&&!this._isVisible(e.frustum))return 0;const i=this.level;Object(Cl.l)(hj,this._center[1],t);let n=Object(Cl.v)(hj),s=1;Object(Cl.l)(pj,this._center[0],t);const a=Object(Cl.v)(pj);a<n&&(n=a,s=0),Object(Cl.l)(pj,this._center[2],t);const o=Object(Cl.v)(pj);if(o<n&&(n=o,s=2),this._edgeLen2>n&&i<e.maxLod)return 2;const l=Math.sqrt(n),c=e.fovX*l*2,u=this._edgeLen/c,d=()=>{const t=i+Math.ceil(-Object(Bt.n)(e.relativeWidthLimit/u));return t!==this.vlevel?(this.vlevel=t,4):1};if(1===r&&1===this._surface.snapLevel-i)return i>=e.maxLod?d():2;const h=Object(Cl.j)(this.up,hj),p=this._elevationBounds[1]-this._elevationBounds[0],f=p/this.edgeLen;if(e.aboveGround&&h>0&&f<.001&&h/l-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-f>0)return 0;if(u<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,4):0;if(i>=e.maxLod)return d();if(i>6){Object(Cl.l)(pj,this._center[s],t),Object(Cl.g)(fj,this.up,h),Object(Cl.l)(fj,fj,pj);const r=Object(Cl.v)(fj);if(r>this.radius*this.radius){Object(Cl.g)(fj,fj,this.radius/Math.sqrt(r)),Object(Cl.h)(fj,fj,this._center[s]),Object(Cl.l)(fj,t,fj);const i=Math.min(1,(Math.abs(Object(Cl.j)(fj,this.up))+.5*p+this._curvatureHeight)/Object(Cl.r)(fj)),n=.1/e.angledSplitBias,a=e.fovY*l*2;if(i*(this._edgeLen/a)<n*e.relativeHeightLimit)return 0}}return 2}setChildren(e,t,r,i){Object(_v.s)(!!(e&&t&&r&&i),"Null child passed"),this._children[0]=e,this._children[1]=t,this._children[2]=r,this._children[3]=i}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}load(e){this.refMapData();for(const t of _a.f)this._createOrUpdateAgents(0,t);e.loadTile(this)}unload(e){e.unloadTile(this);for(const t of _a.f){const e=this.layerInfo[t];for(const t of e)t.loadingAgent&&t.loadingAgent!==nj&&(yj(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0}this.resetPendingUpdate(32),this.resetPendingUpdate(64),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[1];for(const t of e)t.loadingAgent&&t.loadingAgent!==nj&&(yj(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Object(P.n)(e,this._clippingArea))return!1;const t=this._intersectsClippingArea,r=this._isWithinClippingArea;Object(b.j)(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const i=r&&this._isWithinClippingArea,n=!(r||t||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||i||n||this.setPendingUpdate(32),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,t){return this.layerInfo[t][e]}hasLayerData(e,t){const r=this.layerInfo[t][e];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of _a.f){const t=this.layerInfo[e];for(const e of t)if(e.loadingAgent&&e.loadingAgent!==nj&&e.loadingAgent.updating)return!0}return!1}isSuspended(e){return!!this.hasPendingUpdate(2)||0!==e&&!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,2===e||8===e?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,t,r){const i=this.layerInfo[t][e];if(i.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),t,e),!0;if(i.waitingAgents.push(r),i.data&&!i.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),t,e),r.dataArrived(this),!0;if(i.requestPromise)return!0;Object(b.a)(i.requestAbort),i.requestAbort=Object(m.e)();const n=this._surface.requestTileData(this,e,t,i.requestAbort);if(!n)return i.requestAbort=null,!1;const s=()=>{i.requestPromise===n&&(i.requestPromise=null,i.requestAbort=null)};return i.requestPromise=n,n.then(s,s),!0}get isLeaf(){return null==this._children[0]}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;if(this.isLeaf)return null;return this._children[0].findByLij(e)||this._children[1].findByLij(e)||this._children[2].findByLij(e)||this._children[3].findByLij(e)||null}distanceToSquared(e){return Object(Cl.v)(Object(Cl.l)(fj,this._center[1],e))}containsPoint(e){const t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]}unrequestLayerData(e,t,r){const i=this.layerInfo[t][e],n=i.waitingAgents,s=null!=n.removeUnordered(r);Object(_v.s)(s,"agent has not requested this piece of map data"),n.length<1&&(i.abortRequest(),this._updateMemoryUsed())}dataArrived(e,t,r){const i=this.layerInfo[t][e];i.data=r,i.dataInvalidated=!1,i.waitingAgents.forAll((e=>e.dataArrived(this))),i.waitingAgents.clear(),this._updateMemoryUsed()}dataMissing(e,t,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${t}/${e} error ${r}`);const i=this.layerInfo[t][e];i.dataMissing=!0,i.waitingAgents.forAll((e=>e.dataMissing())),i.waitingAgents.clear(),this._updateMemoryUsed()}updateRenderData(e){switch(e){case 1:return this.updateTexture();case 0:return this.updateGeometry()}}updateTexture(){this.renderData&&this.setPendingUpdate(64)}updateGeometry(){this.setPendingUpdate(32);for(const e of this.layerInfo[0])e.pendingUpdates|=32}invalidateLayerData(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t)}computeElevationBounds(){Object(ec.r)(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);const e=this.layerInfo[0];let t=!0;for(const r of e)Object(b.j)(r.elevationBounds)&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],r.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],r.elevationBounds.max),r.elevationBounds.hasNoDataValues||(t=!1));t&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const e=.5*(this._elevationBounds[0]+this._elevationBounds[1]);Object(Cl.g)(fj,this.up,e),Object(Cl.h)(this._center[1],this.centerAtSeaLevel,fj),Object(Cl.g)(fj,this.up,this._elevationBounds[0]),Object(Cl.h)(this._center[0],this.centerAtSeaLevel,fj),Object(Cl.g)(fj,this.up,this._elevationBounds[1]),Object(Cl.h)(this._center[2],this.centerAtSeaLevel,fj)}findElevationBoundsForLayer(e,t){const r=this.layerInfo[0][e];if(Object(b.j)(r.elevationBounds)&&r.elevationBounds.level>=t)return;const i=this._surface.layerViewByIndex(e,0),n=Object(_v.c)(i);if(!Object(tj.e)(this,n,!1))return;const s=jj;let a=!1;if(r.data){const e=r.data;s.min=e.bounds[0],s.max=e.bounds[1],s.hasNoDataValues=e.hasNoDataValues,s.level=this.lij[0],a=!0}else{let t,r,i=0;for(let n=this._parent;n&&(!r||i<_a.b)&&(i=this.vlevel-n.level,t=r||t,r=n.layerInfo[0][e].data,!(!r&&t&&i>=_a.b));n=n.parent);r=r||t,r&&(r.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],s),s.min!==1/0&&(s.level=r.level,a=!0))}a&&(Object(b.i)(r.elevationBounds)&&(r.elevationBounds=new vO),r.elevationBounds.copyFrom(s))}modifyLayers(e,t,r){const i=this.layerInfo[r];for(const a of i)a.loadingAgent&&a.loadingAgent!==nj&&(yj(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<i.length;++a)void 0===e[a]&&i[a].release();const n=new Array(...i),s=t.length;i.length=s;for(let a=0;a<s;a++){const e=t[a];i[a]=e>-1?n[e]:lj.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e))}updateAgents(e){if(this.renderData){const t=this.layerInfo[e];for(const e of t)e.loadingAgent===nj&&(e.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of _a.f){const t=this.isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==nj&&(r.loadingAgent.setSuspension(t),r.loadingAgent===nj&&this.updateRenderData(e))}}removeLayerAgent(e,t){const r=this.layerInfo[t][e];r.loadingAgent&&r.loadingAgent!==nj&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,t){const r=this.layerInfo[t][e];r.loadingAgent=nj,r.data||r.upsampleInfo||this._createOrUpdateAgents(e+1,t)}_createOrUpdateAgents(e,t){const r=this.isSuspended(t),i=this.layerInfo[t];for(let n=e;n<i.length;++n){const e=i[n];let s=!1;const a=this._surface.layerViewByIndex(n,t),o=Object(_v.c)(a);if(e.loadingAgent?Object(tj.e)(this,o,!1)?(e.loadingAgent!==nj&&e.loadingAgent.setSuspension(r),e.loadingAgent!==nj&&(s=e.loadingAgent.update())):e.dispose():Object(tj.e)(this,o,!1)&&(e.loadingAgent=gj(this,n,t,r),s=e.loadingAgent.startLoading(),s?e.loadingAgent===nj&&this.setPendingUpdate(32):(yj(e.loadingAgent),e.loadingAgent=nj)),e.loadingAgent===nj&&this.updateRenderData(t),s&&a.isOpaque)return}}_isWithinExtent(e){const t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]}intersectsExtent(e){const t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]}get test(){return{cachedMemory:this.cachedMemory}}};class xj extends wj{constructor(e,t,r){super(xj.NumSubdivisionsAtLevel),void 0!==e&&this.init(e,t,r)}init(e,t,r){super.init(e,t,r),this._edgeLen=this.extent[2]-this.extent[0],this._edgeLen2=this._edgeLen*this._edgeLen,this.centerAtSeaLevel[0]=Object(Bt.m)(this.extent[0],this.extent[2],.5),this.centerAtSeaLevel[1]=Object(Bt.m)(this.extent[1],this.extent[3],.5),this.centerAtSeaLevel[2]=0,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=(this.extent[2]-this.extent[0])*Math.SQRT1_2,t=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._center[1][3]=Math.sqrt(e*e+t*t)}_isVisible(e){return this.intersectsClippingArea&&Object(xg.f)(e,Object(Vm.H)(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))}createGeometry(e,t){(function(e,t,r,i){const n=t[0],s=t[1],a=t[2]-n,o=t[3]-s,l=e.clippingArea,c=Object(b.j)(l)?Math.max(0,(l[0]-t[0])/a):0,u=Object(b.j)(l)?Math.max(0,(l[1]-t[1])/o):0,d=Object(b.j)(l)?Math.min(1,(l[2]-t[0])/a):1,h=Object(b.j)(l)?Math.min(1,(l[3]-t[1])/o):1,p=d>c?1/(d-c):1,f=h>u?1/(h-u):1,m=-c*p,g=-u*f,y=.1*a,v=e.numVertsPerRow-1,O=e.numVertsPerRow-1,j=e.numVertsPerRow*e.numVertsPerRow,_=2*v+2*O,w=NO.acquire(j+_),x=w.position.typedBuffer,S=w.uv0.typedBuffer,T=i.geometryInfo.boundingBox;Object(Vm.k)(T);let C=0;for(let M=0;M<=O;M++){const t=M/O;let i=g+t*f,c=s+t*o;Object(b.j)(l)&&(c<l[1]?(c=l[1],i=0):c>l[3]&&(c=l[3],i=1));for(let s=0;s<=v;s++){const t=s/v;let o=m+t*p,u=n+t*a;Object(b.j)(l)&&(u<l[0]?(u=l[0],o=0):u>l[2]&&(u=l[2],o=1));const d=e.samplerData&&OO.sample(u,c,e.samplerData)||0,h=u-r[0],f=c-r[1],g=d-r[2];HO(h,f,g,T);const O=_a.e*C;x[O+0]=h,x[O+1]=f,x[O+2]=g,S[O+0]=o,S[O+1]=i;const _=$O(s,M,v,v);if(_>-1){const e=_a.e*(j+_);x[e+0]=h,x[e+1]=f,x[e+2]=g,S[e+0]=WO(o,i),S[e+1]=y}++C}}i.geometryInfo.numVertsPerRow=e.numVertsPerRow,i.geometryInfo.vertexAttributes=w,i.geometryInfo.skirtLength=y,Object(rc.l)(i.geometryInfo.uvOffsetAndScale,c,u,d-c,h-u),qO(i.geometryInfo,e.numVertsPerRow,0,e.wireframe)})(e,this.extent,t,this.renderData),this.setMemoryDirty()}}xj.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];class Sj extends wj{constructor(e,t,r){super(Tj),this.obb=new Array(8),this.isWebMercator=!1;for(let i=0;i<8;i++)this.obb[i]=Object(S.e)();void 0!==e&&this.init(e,t,r)}init(e,t,r){super.init(e,t,r),this.isWebMercator=r.tilingScheme.spatialReference.isWebMercator;const i=this.ellipsoid.radius,n=this.extentInRadians[0],s=this.extentInRadians[1],a=this.extentInRadians[2],o=this.extentInRadians[3],l=e[0],c=Object(Bt.m)(s,o,.5),u=Object(Bt.m)(n,a,.5),d=0===l?0:Math.min(Math.abs(s),Math.abs(o));this._edgeLen=(a-n)*Math.cos(d)*i,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=i-Math.sqrt(i*i-this._edgeLen2/4),Object(C.l)(this.centerAtSeaLevel,u,c,this.ellipsoid.radius,0);const h=Object(S.f)(this.centerAtSeaLevel);Object(Cl.t)(h,h),this.up=h,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(0===this.lij[0])Object(Cl.y)(this._center[1],0,0,0),Object(Cl.y)(this._center[0],0,0,0),Object(Cl.y)(this._center[2],0,0,0),this.ellipsoid||(this.ellipsoid=Object(M.e)(this.surface.tilingScheme.spatialReference)),this._center[1][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const e=Math.max(Object(Cl.n)(this._center[1],this.obb[0]),Object(Cl.n)(this._center[1],this.obb[1]));this._center[1][3]=Math.sqrt(e)}}_isVisible(e){if(!this.intersectsClippingArea)return!1;if(this.lij[0]<10)return Object(xg.j)(e,this._center[1]);const t=this.obb;for(let r=0;r<6;r++){let i,n=e[r];for(4===r&&(n=Object(Uh.c)(n,Cj),Cj[3]-=this.surface.view.state.camera.near),i=0;i<8&&!Object(Uh.p)(n,t[i]);i++);if(8===i)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(e,t){const r=this._isPole(this.lij[1],this.lij[0]);(function(e,t,r,i,n,s,a,o){const l=n[0],c=n[1],u=n[2],d=n[3],h=.1*a.radius*(d-c),p=e.numVertsPerRow-1,f=e.numVertsPerRow-1,b=e.numVertsPerRow*e.numVertsPerRow,m=2*p+2*f,g=NO.acquire(b+m),y=g.position.typedBuffer,v=g.uv0.typedBuffer,O=i.geometryInfo.boundingBox;Object(Vm.k)(O);const j=t[2]-t[0],_=t[3]-t[1],w=u-l,x=r[0],S=r[1],T=r[2];for(let A=0;A<=p;A++){const e=A/p,r=l+e*w;ZO[A]=Math.sin(r),XO[A]=Math.cos(r),JO[A]=e,YO[A]=t[0]+e*j}const C=s&&!!(1&o),M=s&&!!(2&o);let P=0;for(let A=0;A<=f;A++){let r=A/f;const i=Object(Bt.m)(c,d,r),n=Math.cos(i),o=Math.sin(i);let l;s?(l=a.halfSemiMajorAxis*Math.log((1+o)/(1-o)),r=(l-t[1])/_):l=180*i/Math.PI;for(let t=0;t<=p;t++){const i=JO[t],s=ZO[t],c=XO[t];let u=a.radius;e.samplerData&&(u+=OO.sample(YO[t],l,e.samplerData)||0);const d=c*n*u-x,m=s*n*u-S,g=o*u-T;HO(d,m,g,O);const j=_a.e*P;y[j+0]=d,y[j+1]=m,y[j+2]=g,v[j+0]=i,v[j+1]=r;const _=$O(t,A,p,f);if(_>-1){const e=_a.e*(b+_),t=C&&0===A?-1:M&&A===f?1:0,n=0===t?d:-x,s=0===t?m:-S,o=0===t?g:a.radius*t-T;y[e+0]=n,y[e+1]=s,y[e+2]=o,v[e+0]=0===t?WO(i,r):i,v[e+1]=0===t?h:r,0!==t&&HO(n,s,o,O)}++P}}i.geometryInfo.numVertsPerRow=e.numVertsPerRow,i.geometryInfo.vertexAttributes=g,i.geometryInfo.skirtLength=h,Object(rc.l)(i.geometryInfo.uvOffsetAndScale,0,0,1,1),qO(i.geometryInfo,e.numVertsPerRow,s?o:0,e.wireframe)})(e,this.extent,t,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,r),this.setMemoryDirty()}_updateOBB(){const e=this.extentInRadians,t=this.obb;for(let r=0;r<2;r++){const i=this.elevationBounds[r];let n=4*r;Object(C.l)(t[n++],e[0],e[1],this.ellipsoid.radius,i),Object(C.l)(t[n++],e[0],e[3],this.ellipsoid.radius,i),Object(C.l)(t[n++],e[2],e[3],this.ellipsoid.radius,i),Object(C.l)(t[n++],e[2],e[1],this.ellipsoid.radius,i)}if(this.isWebMercator){const e=this._isPole(this.lij[1],this.lij[0]);2===e?(Object(Cl.y)(t[1],0,0,this.ellipsoid.radius),Object(Cl.y)(t[2],0,0,this.ellipsoid.radius),Object(Cl.y)(t[5],0,0,this.ellipsoid.radius),Object(Cl.y)(t[6],0,0,this.ellipsoid.radius)):1===e&&(Object(Cl.y)(t[0],0,0,-this.ellipsoid.radius),Object(Cl.y)(t[3],0,0,-this.ellipsoid.radius),Object(Cl.y)(t[4],0,0,-this.ellipsoid.radius),Object(Cl.y)(t[7],0,0,-this.ellipsoid.radius))}}_isPole(e,t){let r=0;return e===(1<<t)-1&&(r+=1),0===e&&(r+=2),r}}const Tj=[128,64,32,16,16,8,8,4],Cj=Object(Uh.d)();let Mj=class extends N.a{constructor(e){super(e),this._handles=new F.a}initialize(){this._handles.add([this.layerViews.on("change",(()=>this.notifyChange("stencilEnabledExtents")))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}set spatialReference(e){this.tilingScheme||this._set("spatialReference",e)}set tilingScheme(e){this._set("tilingScheme",e),this._set("spatialReference",e.spatialReference)}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach((t=>{const r=t.layer;if("IntegratedMeshLayer"===r.operationalLayerType&&null!=this.spatialReference){const t=Ej(r.fullExtent,this.spatialReference);null!=t&&e.push(Object(P.r)(t))}})),e}};Object(i.a)([Object(j.b)({readOnly:!0,dependsOn:[]})],Mj.prototype,"layerViewsExtent",null),Object(i.a)([Object(j.b)({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],Mj.prototype,"tiledLayersExtent",null),Object(i.a)([Object(j.b)({readOnly:!0,dependsOn:["spatialReference"]})],Mj.prototype,"stencilEnabledExtents",null),Object(i.a)([Object(j.b)()],Mj.prototype,"spatialReference",null),Object(i.a)([Object(j.b)()],Mj.prototype,"tilingScheme",null),Object(i.a)([Object(j.b)()],Mj.prototype,"defaultTiledLayersExtent",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Mj.prototype,"layers",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Mj.prototype,"layerViews",void 0),Mj=Object(i.a)([Object(w.a)("esri.views.3d.terrain.SurfaceExtentHelperBase")],Mj);let Pj=class extends Mj{_computeLayerViewsExtent(){return this._getGlobalExtent()}_computeTiledLayersExtent(){return this._getGlobalExtent()}_getGlobalExtent(){return this.spatialReference.isWebMercator?_a.m:_a.d}};Object(i.a)([Object(j.b)({dependsOn:["spatialReference"]})],Pj.prototype,"layerViewsExtent",void 0),Pj=Object(i.a)([Object(w.a)("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],Pj);let Aj=class extends Mj{initialize(){this._handles.add([this.layers.on("change",(e=>this._handleLayersChanged(e))),this.layerViews.on("change",(()=>this.notifyChange("layerViewsExtent")))])}_handleLayersChanged(e){for(const t of e.removed)this._handles.remove(t.uid);for(const t of e.added)this._handles.add(Object(y.a)(t,"loaded",(()=>this.notifyChange("tiledLayersExtent"))),t.uid)}_computeLayerViewsExtent(){const e=Object(P.m)(),t=this.spatialReference;this.layerViews.forEach((r=>{const i=r.layer;if(r.isResolved()&&("graphics"!==i.type||!i.internal)){const i=Ej("fullExtentInLocalViewSpatialReference"in r&&r.fullExtentInLocalViewSpatialReference||r.layer.fullExtent,t);i&&Object(P.o)(e,i)}}));const r=Object(P.c)(e)?e:null,i=this._get("layerViewsExtent");return Object(P.n)(r,i)?i:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.spatialReference,r=Object(P.m)();this.layers.forEach((function(i){if(i.loaded&&Object(I.c)(i)){const{tileInfo:n,fullExtent:s}=Object(_v.d)(i,t,2);(n&&Object(_v.h)(i)&&s||n&&e.compatibleWith(n)&&s&&s.spatialReference.equals(t))&&Object(P.o)(r,s)}})),this.defaultTiledLayersExtent&&Object(P.o)(r,this.defaultTiledLayersExtent);const i=Object(P.c)(r)?r:null,n=this._get("tiledLayersExtent");return Object(P.n)(i,n)?n:i}};function Ej(e,t){return e&&!e.spatialReference.equals(t)&&(e=Object(R.a)(e.spatialReference,t)?Object(R.d)(e,t):null),e}Aj=Object(i.a)([Object(w.a)("esri.views.3d.terrain.SurfaceExtentHelperLocal")],Aj);var Rj=r(195);let Ij=class extends N.a{constructor(e){super(e),this._handles=new F.a}initialize(){this._handles.add(this.layers.on("change",(()=>this._update()))),this._handles.add(this.extentHelper.watch("layerViewsExtent",(()=>this._setAdHocTilingScheme()))),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles.destroy(),this._handles=null,this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this._set("tilingSchemeDone",!1),this.layers.some((t=>!(!Object(I.c)(t)||t.isRejected())&&!(t.isFulfilled()&&!function(e,t,r){return!!Object(_v.d)(e,t,r).tileInfo}(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!Object(_v.m)(t)&&!Object(_v.h)(t)))),e)if(e.isResolved()){const t=e,{tileInfo:r}=Object(_v.d)(t,this.viewSpatialReference,this.viewingMode),i=new Rj.a(r);this._set("tilingSchemeDone",!0),this._lockTilingScheme(i)}else this._updateWhen(e);else this._set("tilingSchemeDone",!0)}_updateWhen(e){const t=e.when().catch((e=>e)).then((()=>{t!==this._waitTask||this.destroyed||this._update()}));this._waitTask=t}_lockTilingScheme(e){if(1===this.viewingMode){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Rj.a.makeWebMercatorAuxiliarySphere(t):Object(C.a)(e.spatialReference)&&(e=Rj.a.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(this.extentHelper.watch("tiledLayersExtent",(()=>this._updateTiledLayerExtent())))}_updateTiledLayerExtent(){this.extent=this.extentHelper.tiledLayersExtent}_setAdHocTilingScheme(){if(1===this.viewingMode){const e=this.extentHelper.spatialReference,t=Object(C.a)(e)||Object(ka.h)(e)||Object(ka.i)(e);e.isWebMercator?this.tilingScheme=Rj.a.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Rj.a.makeGCSWithTileSize(e,256)),this.extent=this.extentHelper.layerViewsExtent}else{const e=this.extentHelper.layerViewsExtent;e&&(this.tilingScheme=Rj.a.fromExtent(e,this.extentHelper.spatialReference),this.extent=e)}}};Object(i.a)([Object(j.b)()],Ij.prototype,"tilingScheme",void 0),Object(i.a)([Object(j.b)()],Ij.prototype,"extent",void 0),Object(i.a)([Object(j.b)({value:!1})],Ij.prototype,"tilingSchemeLocked",void 0),Object(i.a)([Object(j.b)({readOnly:!0,value:!1})],Ij.prototype,"tilingSchemeDone",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Ij.prototype,"viewSpatialReference",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Ij.prototype,"layers",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Ij.prototype,"extentHelper",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],Ij.prototype,"viewingMode",void 0),Ij=Object(i.a)([Object(w.a)("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],Ij);var Dj=r(21);class Fj{constructor(e,t,r,i){this.texture=e,e.retain(),this.offsetAndScale=Object(Ml.g)(t,r,i,i)}destroy(){this.texture.release()}}var Lj=class{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Object(b.e)(this._current),this._next=Object(b.e)(this._next),this._waiting=Object(b.e)(this._waiting),this._delayed=Object(b.e)(this._delayed)}get current(){if(Object(b.i)(this._current))return null;if(!this._isFading){const e=this._delayed||this._waiting||this._next||this._current;e!==this._current&&(this._current=null,this.clear(),this._current=e)}let e=0;if(Object(b.j)(this._delayed)&&(e=performance.now(),e>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null)),Object(b.j)(this._next)){e=e||performance.now();const t=this._fadeDuration;e-this._fadeStart>=t&&(Object(b.e)(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(Object(b.i)(this._next))return 1;const e=Math.max(0,performance.now()-this._fadeStart),t=this._fadeDuration;return e>t?0:1-e/t}get isFading(){return Object(b.j)(this._next)||Object(b.j)(this._delayed)}push(e,t,r,i,n=0){this._delayed=Object(b.e)(this._delayed);const s=Object(b.j)(e)?new Fj(e,t,r,i):null;this._push(s,n)}_push(e,t){if(this._isFading||this.clear(),Object(b.i)(this._current))return void(this._current=e);const r=performance.now();return 0!==t?(this._delayed=e,void(this._delayedTime=r+t)):Object(b.i)(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(Object(b.i)(e)||(Object(b.e)(this._waiting),this._waiting=e))}get _fadeDuration(){return Object(b.i)(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const t=this._getFadeDuration();return e+t-e%t}get _isFading(){return this._getFadeDuration()>0}};var kj=class{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,t,r){this._scales[2*e]=t,this._scales[2*e+1]=r}setOffset(e,t,r){this._offsets[2*e]=t,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};class zj{constructor(){this.geometryInfo=new UO,this._textureRef=new Lj((()=>this.tile.surface.textureFadeDuration)),this.overlay=new kj}init(e){this.tile=e,this.clear();const t=this.geometryInfo;t.indices=null,t.vertexAttributes=null,Object(Vm.k)(t.boundingBox),t.numSurfaceIndices=0,t.numSkirtIndices=0,t.numWithoutSkirtIndices=0,t.numVertsPerRow=0,this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},this.opacity=1,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometry(e,t){return!!this._updateGeometryState(t)&&(this._releaseGeometry(),this._createGeometry(e),!0)}releaseGeometry(){return!!this._releaseGeometry()&&(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0)}ensureTexture(e,t){return Object(b.j)(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),Object(b.i)(this._texture)&&(this._texture=t(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){Object(b.j)(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_updateGeometryState(e){const t=this._getElevationInfo(),r=this.tile.level;let i=r<8?this.tile.numSubdivisionsAtLevel[r]+1:2;if(t.samplerData){const e=this.tile.vlevel-r,n=Math.max(r-t.maxTileLevel,_a.b-e),s=this.tile.maxTesselation;i=Object(Bt.e)(1+(s>>n),2,s+1)}let n=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(n=null);const s=this.geometryState;let a=!1;return s.numVertsPerRow!==i&&(s.numVertsPerRow=i,a=!0),t.changed&&(s.samplerData=t.samplerData,a=!0),Object(Ma.e)(s.clippingArea,n)||(s.clippingArea=n,a=!0),s.wireframe!==e&&(s.wireframe=e,a=!0),a}_createGeometry(e){this.tile.createGeometry(this.geometryState,this.localOrigin);const t=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,i=e.gl;this._vao=new Zl.a(e,Ll.a,{geometry:Object(Bl.a)(t.layout)},{geometry:Wl.a.createVertex(e,i.STATIC_DRAW,t.buffer)},Wl.a.createIndex(e,i.STATIC_DRAW,r))}_releaseGeometry(){return!!this._vao&&(this._vao.dispose(),this._vao=null,function(e){NO.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(e,t,r,i,n=0){e!==this._texture&&this.releaseTexture(),this._textureRef.push(e,t,r,i,n)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,t=this.tile.layerInfo[0],r=t.length;let i=new Array(r),n=0,s=0,a=!1;for(let o=0;o<r;o++){const r=t[o];if(r.upsampleInfo){const t=r.upsampleInfo.tile,l=t.layerInfo[0][o].data,c=l&&l.samplerData;e&&e[n]===c||(a=!0),i[n++]=c,s=Math.max(s,t.lij[0])}else if(r.data){const t=this.tile.surface.layerViewByIndex(o,0);if(Object(tj.e)(this.tile,t.layer,!1)){const t=r.data;e&&e[n]===t.samplerData||(a=!0),i[n++]=t.samplerData,s=this.tile.lij[0]}}}return e&&e.length!==n&&(a=!0),n>0?i.length=n:i=null,{changed:a,samplerData:i,maxTileLevel:s}}get estimatedGeometryMemoryUsage(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength}get textureDescriptor(){return Object(b.j)(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:null!=this._texture}}}var Vj=r(93),Nj=(r(109),r(145)),Uj=(r(228),r(14)),Bj=r(49),Gj=r(165),qj=r(586);function Hj(){return[1,0,0,1,0,0]}Object.freeze({__proto__:null,create:Hj,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]},fromValues:function(e,t,r,i,n,s){return[e,t,r,i,n,s]},createView:function(e,t){return new Float64Array(e,t,6)}});var Wj=r(213),$j=r(234);function Qj(e){return(t=e)instanceof Float32Array&&t.length>=2||function(e){return Array.isArray(e)&&e.length>=2}(e);var t}r(146);const Zj=39.37,Xj=180/Math.PI;function Jj(e,t,r,i){return i&&r&&!i.equals(r)&&Object(R.a)(i,r)&&i.isWebMercator?i.isWebMercator?function(e,t){let r=t[1];return r>89.99999?r=89.99999:r<-89.99999&&(r=-89.99999),r=Math.sin(Object(Bj.d)(r)),Object(ec.r)(e,Object(Bj.d)(t[0])*Zo.a.radius,.5*Zo.a.radius*Math.log((1+r)/(1-r)))}(e,t):function(e,t,r){const i=Object(Bj.c)(t[0]/Zo.a.radius);return Object(ec.r)(e,r?i:i-360*Math.floor((i+180)/360),Object(Bj.c)(.5*Math.PI-2*Math.atan(Math.exp(-1*t[1]/Zo.a.radius))))}(e,t):Object(ec.c)(e,t)}function Yj(e){return e.wkid?e:e.spatialReference||La.a.WGS84}function Kj(e,t){return t.type?Object(ec.r)(e,t.x,t.y):Object(ec.c)(e,t)}function e_(e){return Object(uy.f)(e)}function t_(e,t){const r=e.targetGeometry,i=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const r_=function(){const e=Object(tc.b)();return function(t,r,i){const n=r.targetGeometry;Kj(e,n);const s=.5*s_(r);return t.xmin=e[0]-s*i[0],t.ymin=e[1]-s*i[1],t.xmax=e[0]+s*i[0],t.ymax=e[1]+s*i[1],t.spatialReference=n.spatialReference,t}}();const i_=function(){const e=Object(tc.b)();return function(t,r,i){return Object(ec.e)(t,function(e,t){return Object(ec.b)(e,t,.5)}(t,r),function(e,t,r){return r?Object(ec.r)(e,.5*(t[0]-r.right+r.left),.5*(t[1]-r.bottom+r.top)):Object(ec.b)(e,t,.5)}(e,r,i))}}(),n_=function(){const e=[1,0,0,1,0,0],t=Object(tc.b)();return function(r,i,n,s){const a=s_(i),o=a_(i);return Object(ec.r)(t,a,a),Object(Gj.c)(e,t),Object(Gj.f)(e,e,o),Object(Gj.h)(e,e,i_(t,n,s)),Object(Gj.h)(e,e,[0,s.top-s.bottom]),Object(ec.r)(r,e[4],e[5])}}();function s_(e){return e.scale*function(e){return Object(b.j)(e)&&Object(ka.j)(e.spatialReference)?1/(e_(e.spatialReference)*Zj*96):1}(e.targetGeometry)}function a_(e){return Object(Bj.d)(e.rotation)||0}const o_=function(){const e=Object(tc.b)(),t=Object(tc.b)(),r=Object(tc.b)();return function(i,n,s,a,o,l){return Object(ec.n)(e,n),Object(ec.b)(t,s,.5*l),Object(ec.r)(r,1/a*l,-1/a*l),Object(Gj.d)(i),Object(Gj.h)(i,i,t),o&&Object(Gj.f)(i,i,o),Object(Gj.g)(i,i,r),Object(Gj.h)(i,i,e),i}}(),l_=function(){const e=Object(tc.b)();return function(t,r,i,n){const s=s_(r),a=a_(r);return Kj(e,r.targetGeometry),o_(t,e,i,s,a,n)}}(),c_=function(){const e=Object(tc.b)();return function(t,r,i,n){const s=s_(r);return Kj(e,r.targetGeometry),o_(t,e,i,s,0,n)}}();function u_(e,t){return Math.round(function(e){if(e.isWrappable){const t=Object(ka.d)(e);return t.valid[1]-t.valid[0]}return 0}(e)/t)}(function(){const e=Object(tc.b)(),t=Object(tc.b)(),r=[0,0,0]})(),function(){const e=Object(tc.b)()}(),function(){const e=Object(tc.b)()}(),function(){const e=Object(tc.b)()}();!function(){const e=Object(tc.b)()}();const d_=function(){const e=Object(tc.b)();return function(t,r,i,n,s){return t_(t,r),isNaN(i)||0===i||(p_(e,n,r,s),t.scale=r.scale*i,f_(e,e,t,s),b_(t,t,Object(ec.r)(e,e[0]-n[0],n[1]-e[1]))),t}}();const h_=function(){const e=Object(tc.b)();return function(t,r,i,n,s,a){return t_(t,r),isNaN(i)||0===i||(p_(e,s,r,a),t.scale=r.scale*i,t.rotation+=n,f_(e,e,t,a),b_(t,t,Object(ec.r)(e,e[0]-s[0],s[1]-e[1]))),t}}(),p_=(function(){const e=Object(tc.b)(),t=Object(tc.b)()}(),function(){const e=[1,0,0,1,0,0];return function(t,r,i,n){return Object(ec.s)(t,r,function(e,t,r,i){return l_(e,t,r,i),Object(Gj.a)(e,e)}(e,i,n,1))}}()),f_=function(){const e=[1,0,0,1,0,0];return function(t,r,i,n){return Object(ec.s)(t,r,l_(e,i,n,1))}}(),b_=function(){const e=Object(tc.b)(),t=[1,0,0,1,0,0];return function(r,i,n){t_(r,i);const s=s_(i),a=r.targetGeometry;return Object(Gj.b)(t,a_(i)),Object(Gj.g)(t,t,Object(tc.f)(s,s)),Object(ec.s)(e,n,t),a.x+=e[0],a.y+=e[1],r}}();var m_;const g_=[0,0];let y_=m_=class extends Uj.a{constructor(e){super(e),this._viewpoint2D={center:Object(tc.b)(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new Fa.a,this.id=0,this.inverseTransform=[1,0,0,1,0,0],this.resolution=0,this.rotation=0,this.scale=0,this.transform=[1,0,0,1,0,0],this.transformNoRotation=[1,0,0,1,0,0],this.displayMat3=Object(Wj.b)(),this.displayViewMat3=Object(Wj.b)(),this.viewMat3=Object(Wj.b)(),this.viewMat2d=Object(qj.a)(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,r=e.targetGeometry;t.center[0]=r.x,t.center[1]=r.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=r.spatialReference}this._update()}copy(e){const t=this.size,r=this.viewpoint;return r&&t?(this.viewpoint=t_(r,e.viewpoint),this._set("size",Object(ec.c)(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new m_({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,r){return Qj(t)?Object(ec.s)(e,t,this.inverseTransform):(g_[0]=t,g_[1]=r,Object(ec.s)(e,g_,this.inverseTransform))}toScreen(e,t,r){return Qj(t)?Object(ec.s)(e,t,this.transform):(g_[0]=t,g_[1]=r,Object(ec.s)(e,g_,this.transform))}toScreenNoRotation(e,t,r){return Qj(t)?Object(ec.s)(e,t,this.transformNoRotation):(g_[0]=t,g_[1]=r,Object(ec.s)(e,g_,this.transformNoRotation))}getScreenTransform(e,t){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,n=this._get("size");return o_(e,r,n,t,0,i),e}_update(){const{center:e,spatialReference:t,scale:r,rotation:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),a=new o.a({targetGeometry:new Mn.a(e[0],e[1],t),scale:r,rotation:i});if(this._set("viewpoint",a),!s||!t||!r)return;this.resolution=s_(a),this.rotation=i,this.scale=r,this.spatialReference=t,Object(ec.c)(this.center,e);const l=0!==s[0]?2/s[0]:0,c=0!==s[1]?-2/s[1]:0;Object(Dd.m)(this.displayMat3,l,0,0,0,c,0,-1,1,1);const u=Object(Dd.b)(this.viewMat3),d=Object($j.b)(s[0]/2,s[1]/2),h=Object($j.b)(-s[0]/2,-s[1]/2),p=Object(Bj.d)(i);Object(Dd.c)(u,u,d),Object(Dd.l)(u,u,p),Object(Dd.c)(u,u,h),Object(Dd.j)(this.displayViewMat3,this.displayMat3,u);const f=Object(Gj.d)(this.viewMat2d);return Object(Gj.h)(f,f,d),Object(Gj.f)(f,f,p),Object(Gj.h)(f,f,h),r_(this.extent,a,s),l_(this.transform,a,s,n),Object(Gj.a)(this.inverseTransform,this.transform),c_(this.transformNoRotation,a,s,n),this.worldScreenWidth=u_(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};Object(i.a)([Object(j.b)({readOnly:!0})],y_.prototype,"id",void 0),Object(i.a)([Object(j.b)({value:1,json:{write:!0}})],y_.prototype,"pixelRatio",null),Object(i.a)([Object(j.b)({json:{write:!0}})],y_.prototype,"size",null),Object(i.a)([Object(j.b)({type:o.a,json:{write:!0}})],y_.prototype,"viewpoint",null),y_=m_=Object(i.a)([Object(w.a)("esri.views.2d.ViewState")],y_);var v_=y_;class O_{constructor(){this._renderParams={context:null,drawPhase:1,state:new v_({viewpoint:new o.a({targetGeometry:new Mn.a(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,driverTestResult:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(e,t,r,i,n,s,a,o,l,c){const u=s.adjustLevel(t[0]),d=this._renderParams;d.context=e,d.painter=i,d.glyphMosaic=i.glyphMosaic,d.spriteMosaic=i.spriteMosaic,d.pixelRatio=c,d.displayLevel=u,d.requiredLevel=u;const h=s.getScale(t[0]),[p,f]=s.getShift(t,a*h),b=.125*a*h/l,m=r.transforms.dvs;m[0]=b,m[4]=-b,m[6]=-1-p-o[0]*a*2,m[7]=1+f+(1-o[1])*a*2-2,d.state.size[0]=l,d.state.size[1]=l,r.stage||r.attachWithContext(e),r.triangleCount=0,i.drawTile(d,r,n)}}var j_=r(617);class __ extends Dl.a{initializeProgram(e){const t=__.shader.get().build();return new kl.a(e.rctx,t,Ll.a)}initializePipeline(){const e=2===this.configuration.mode?Object(zl.i)(1,771):1===this.configuration.mode?Object(zl.i)(0,770):null;return Object(zl.g)({blending:e,colorWrite:zl.d})}}__.shader=new Il.a(j_.a,(()=>r.e(182).then(r.bind(null,1058))));class w_ extends Fl.a{constructor(){super(...arguments),this.mode=0}}Object(i.a)([Object(Fl.b)({count:3})],w_.prototype,"mode",void 0);var x_=r(618),S_=r(176);class T_ extends Dl.a{get uniformLocationInfos(){return this._uniformLocationInfos||(this._uniformLocationInfos=Object(S_.i)(this._context,this.program)),this._uniformLocationInfos}initializeProgram(e){const t=T_.shader.get(),r=this.configuration,i=t.build({output:r.colorizerType,applyColormap:r.applyColormap});return this._context=e.rctx,new kl.a(e.rctx,i,Ll.a)}initializePipeline(){const e=2===this.configuration.mode?Object(zl.i)(1,771):1===this.configuration.mode?Object(zl.i)(0,770):null;return Object(zl.g)({blending:e,colorWrite:zl.d})}bindPass(e){Object(S_.k)(this.program,this.uniformLocationInfos,e.basic),Object(S_.k)(this.program,this.uniformLocationInfos,e.common),Object(b.j)(e.colormap)&&Object(S_.k)(this.program,this.uniformLocationInfos,e.colormap),0===this.configuration.colorizerType&&Object(b.j)(e.stretch)?Object(S_.k)(this.program,this.uniformLocationInfos,e.stretch):2===this.configuration.colorizerType&&Object(b.j)(e.hillshade)&&Object(S_.k)(this.program,this.uniformLocationInfos,e.hillshade)}}T_.shader=new Il.a(x_.a,(()=>r.e(180).then(r.bind(null,1059))));class C_ extends Fl.a{constructor(){super(...arguments),this.mode=2,this.colorizerType=0,this.applyColormap=!0}}Object(i.a)([Object(Fl.b)({count:3})],C_.prototype,"mode",void 0),Object(i.a)([Object(Fl.b)({count:3})],C_.prototype,"colorizerType",void 0),Object(i.a)([Object(Fl.b)()],C_.prototype,"applyColormap",void 0);class M_{constructor(e){this.renderingContext=e,this._pools=new Map}acquire(e){return this.getPool(e).acquire()}release(e){this.getPool(e.width).release(e)}clear(){this._pools.forEach((e=>e.destroy())),this._pools.clear()}getPool(e){let t=this._pools.get(e);if(!t){const r=Vj.a.bind(Vj.a,this.renderingContext,{colorTarget:0,depthStencilTarget:1,width:e,height:e});t=new wg.a(r),this._pools.set(e,t)}return t}}var P_=r(257);class A_{constructor(e,t,r){this._rctx=e,this.tileSize=t,this._backgroundIsGrid=!1,this._backgroundTexture=null,this._backgroundColor=null,this._blackTex=null,this._vectorTileHelper=new O_,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._vaoQuad=Object(vc.d)(this._rctx,P_.b);const i=new w_;i.mode=2,this._blendLayersTechnique=r.acquire(__,i),i.mode=1,this._applyOpacityTechnique=r.acquire(__,i),this._techniqueRep=r,this._blackTex=new dj.a(Object(vc.a)(this._rctx,[0,0,0,1])),this._fboPool=new M_(this._rctx)}dispose(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null),this._vaoQuad=Object(b.f)(this._vaoQuad),this._backgroundTexture=Object(b.q)(this._backgroundTexture),this._blackTex=Object(b.q)(this._blackTex),this._blendLayersTechnique=Object(b.f)(this._blendLayersTechnique),this._applyOpacityTechnique=Object(b.f)(this._applyOpacityTechnique),this._vectorTileHelper=Object(b.f)(this._vectorTileHelper)}updateTileTexture(e){const t=e.layerInfo[1];for(const p of t)p.pendingUpdates&=-65;if(!e.renderData)return;const r=e.surface,i=r.baseOpacity;let n=0,s=0,a=this.tileSize,o=!1;const l=r.view.pixelRatio;let c=t.length,u=0;for(;u<t.length&&!o;u++){const d=r.layerViewByIndex(u,1),h=d.fullOpacity;if(R_[u]=h,Object(I.b)(d.layer)&&c>=t.length&&(c=u),0===h)continue;++s;const p=E_(e,u,I_);p&&(Object(_v.n)(d)?a=Math.max(a,this.tileSize*l):1===i&&1===h&&(d.isOpaque||this._dataToTexture(p)&&Object(b.j)(p.sourceLayerInfo.data)&&p.sourceLayerInfo.data.descriptor.isOpaque)&&(o=!0),++n)}this._cleanupFBOPool(l,t.length),a=function(e){const t=Object(Bt.p)(e),r=t*t,i=e*e;if(r===i)return e;const n=t/2;return r-i<i-n*n?t:n}(a);const d=a/this.tileSize,h=u-1;if(0===n){let t=0;return(e.surface.view.layerViewManager.updating||s>0)&&(t=5e3),this._backgroundTexture&&Object(b.i)(e.renderData.textureReference)&&(t=0),void this._useBackgroundTexture(e,t)}1===n&&(o||this._backgroundIsGrid||Object(b.j)(this._backgroundColor))&&this._useLayerTexture(e,h,c,R_[h])||this._composeMapLayers(e,h,c,o,R_,a,d)}setBackground(e,t){Object(b.q)(this._backgroundTexture),this._backgroundIsGrid=t,e instanceof HTMLImageElement?(this._backgroundTexture=this._buildTexture(e),this._backgroundColor=null):(this._backgroundTexture=new dj.a(Object(vc.a)(this._rctx,e)),this._backgroundColor=Object(Ml.g)(e[0]||0,e[1]||0,e[2]||0,e[3]||0))}get backgroundIsGrid(){return this._backgroundIsGrid}get backgroundColor(){return this._backgroundColor}_buildTexture(e,t=9987){if(Object(b.i)(e))return null;const r={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:t,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},i=this._rctx;let n;if("number"==typeof e)r.width=r.height=e,n=new dj.a(new $l.a(i,r));else if(e instanceof vv.a)r.isOpaque=e.isOpaque,n=new dj.a(new $l.a(i,r,e.image)),e.release();else try{n=new dj.a(new $l.a(i,r,e))}catch(a){n=new dj.a(Object(vc.c)(i)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const s=i.bindTexture(n.texture,$l.a.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),i.bindTexture(s,$l.a.TEXTURE_UNIT_FOR_UPDATES),n}_drawQuad(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(5,0,Object(Ql.f)(this._vaoQuad,"geometry"))}_drawRasterData(e,t,r,i,n=1){if(Object(b.i)(t))return;const s=this._rctx,a=e.program;s.setPipelineState(e.pipeline),s.useProgram(a),a.bindTexture(t,"tex"),a.setUniform1f("scale",r),a.setUniform2f("offset",i[0],i[1]),a.setUniform1f("opacity",n),this._drawQuad(a)}hasNearestInterpolation(e){const t=e.sourceLayerInfo.data;return!(Object(b.i)(t)||!t.source)&&"nearest"===t.interpolation}_drawImageryTileData(e,t=1){const r=e.sourceLayerInfo.data;if(Object(b.i)(r)||!r.source)return;e.tile.surface.layerViewByIndex(e.layerIndex,1).ensureSymbolizerParameters(r);const i=this._getRasterColorizerTechnique(r.symbolizerParameters.type,!!r.symbolizerParameters.colormap),n=this._rctx,s=i.program;if(n.setPipelineState(i.pipeline),n.useProgram(s),!r.bind(n))return;r.opacity=t,r.scale=e.scale,r.offset=e.offset;const{names:a,textures:o}=r.getTextures();a.forEach(((e,t)=>s.bindTexture(o[t],e))),i.bindPass(r.getUniforms()),this._drawQuad(s),n.bindVAO()}_getRasterColorizerTechnique(e,t){const r=["stretch","lut","hillshade"].indexOf(e);return this._rasterColorizerConfig||(this._rasterColorizerConfig=new C_,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.colorizerType=r,this._rasterColorizerConfig.applyColormap=t,this._rasterColorizerTechnique=this._techniqueRep.releaseAndAcquire(T_,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}_drawVectorData(e,t,r,i,n,s,a){const o=t.sourceLayerInfo.data;if(Object(b.i)(o))return a;const l=this._rctx,c=t.tile.surface.layerViewByIndex(t.layerIndex,1);let u;return l.setPipelineState(e.pipeline),i<1?(u=this._fboPool.acquire(n),l.bindFramebuffer(u),l.setClearColor(1,1,1,0),l.clearSafe(16640)):a&&l.clearSafe(256),this._vectorTileHelper.render(l,t.sourceLod,o,c.painter,c.layer.styleRepository,c.schemaHelper,Math.round(1/t.scale),t.offset,this.tileSize,r),!Object(b.j)(u)||(l.bindFramebuffer(s),this._drawRasterData(e,u.colorTexture,1,[0,0],i),this._fboPool.release(u),a)}_useBackgroundTexture(e,t){e.renderData.opacity=e.surface.baseOpacity,e.renderData.compositeBackgroundInShader=!1,e.renderData.layerOpacity=1,e.renderData.baseOpacity=1,e.renderData.setTextureReference(this._backgroundTexture,0,0,1,t)}_useLayerTexture(e,t,r,i){const n=t<r;e.renderData.opacity=n?1:e.surface.baseOpacity,e.renderData.compositeBackgroundInShader=!0,e.renderData.layerOpacity=i,e.renderData.baseOpacity=n?e.surface.baseOpacity:1;const s=E_(e,t,I_);if(this._dataToTexture(s)){const t=s.offset;return e.renderData.setTextureReference(s.sourceLayerInfo.data,t[0],t[1],s.scale),!0}return!1}_composeMapLayers(e,t,r,i,n,s,a){const o=this._rctx,l=this._fboPool.acquire(s);o.bindFramebuffer(l),o.setViewport(0,0,s,s),o.setClearColor(0,0,0,0),o.setClearDepth(1),o.clearSafe(16640);let c=!1;!i&&Object(b.j)(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,this._backgroundTexture.texture,1,tc.a);const u=e.surface.baseOpacity;let d=!1,h=9987;for(let g=t;g>=0;g--){const t=E_(e,g,I_);t&&(g<r&&u<1&&!d&&(this._drawRasterData(this._applyOpacityTechnique,this._blackTex.texture,1,tc.a,u),d=!0),0!==n[g]&&(Object(_v.o)(t)?c=this._drawVectorData(this._blendLayersTechnique,t,a,n[g],s,l,c):Object(_v.g)(t)?(this._drawImageryTileData(t,n[g]),this.hasNearestInterpolation(t)&&(h=9728)):this._dataToTexture(t)&&Object(b.j)(t.sourceLayerInfo.data)&&this._drawRasterData(this._blendLayersTechnique,t.sourceLayerInfo.data.texture,t.scale,t.offset,n[g])))}const p=e.renderData.ensureTexture(s,(()=>this._buildTexture(s,h))),f=o.bindTexture(p.texture,$l.a.TEXTURE_UNIT_FOR_UPDATES),m=p.descriptor;o.gl.copyTexImage2D(o.gl.TEXTURE_2D,0,m.pixelFormat,0,0,m.width,m.height,0),p.generateMipmap(),o.bindTexture(f,$l.a.TEXTURE_UNIT_FOR_UPDATES),o.bindFramebuffer(null),this._fboPool.release(l),e.renderData.opacity=d?1:u,e.renderData.compositeBackgroundInShader=!1,e.renderData.layerOpacity=1,e.renderData.baseOpacity=1,e.renderData.setTextureReference(p,0,0,1)}_dataToTexture(e){return Object(_v.i)(e)&&this._rasterDataToTexture(e),Object(_v.k)(e)}_rasterDataToTexture(e){const t=e.sourceLayerInfo;t.data=this._buildTexture(t.data),e.tile.setMemoryDirty()}_cleanupFBOPool(e,t){e===this._lastPixelRatio&&t===this._lastNumLayers||(this._fboPool.clear(),this._lastPixelRatio=e,this._lastNumLayers=t)}get test(){return{backgroundTexture:this._backgroundTexture}}}function E_(e,t,r){r.layerIndex=t;const i=e.layerInfo[1][t];if(i.data)return Object(ec.r)(r.offset,0,0),r.tile=e,r.scale=1,r.sourceLod=e.lij,r.sourceLayerInfo=i,r;const n=i.upsampleInfo;if(n){const e=n.tile.layerInfo[1][t];return r.tile=n.tile,Object(ec.c)(r.offset,n.offset),r.scale=n.scale,r.sourceLod=n.tile.lij,r.sourceLayerInfo=e,r}return null}const R_=new Array,I_={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};var D_=r(61),F_=r(326),L_=r(619),k_=r(97);class z_ extends Dl.a{initializeProgram(e){const t=z_.shader.get(),r=this.configuration,i=t.build({overlayMode:r.overlayMode,output:r.output,viewingMode:e.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:r.textureFadingEnabled&&!r.renderOccluded,hasBackgroundColor:r.hasBackgroundColor,useGrid:r.useGrid,receiveShadows:r.receiveShadows&&!r.renderOccluded,receiveAmbientOcclusion:!1,atmosphere:r.atmosphere,tileBorders:r.tileBorders,screenSizePerspective:r.screenSizePerspective,pbrMode:0,ssrEnabled:r.ssrEnabled,highStepCount:!1});return new kl.a(e.rctx,i,Ll.a)}initializePipeline(){const e=this.configuration,t=e.backfaceCullingEnabled&&!e.renderOccluded;return Object(zl.g)({blending:e.renderOccluded?Object(zl.i)(1,771):null,culling:t&&zl.b,depthTest:!e.renderOccluded&&{func:513},depthWrite:!e.renderOccluded&&zl.e,colorWrite:zl.d,stencilTest:e.stencilEnabled?Object(k_.c)(1):null})}}z_.shader=new Il.a(L_.a,(()=>r.e(181).then(r.bind(null,1060))));class V_ extends Fl.a{constructor(){super(...arguments),this.output=0,this.overlayMode=0,this.atmosphere=!1,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.hasBackgroundColor=!1,this.useGrid=!1,this.renderOccluded=!1,this.ssrEnabled=!1,this.tileBorders=!1,this.screenSizePerspective=!1}}Object(i.a)([Object(Fl.b)({count:8})],V_.prototype,"output",void 0),Object(i.a)([Object(Fl.b)({count:3})],V_.prototype,"overlayMode",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"atmosphere",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"receiveShadows",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"slicePlaneEnabled",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"backfaceCullingEnabled",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"stencilEnabled",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"textureFadingEnabled",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"hasBackgroundColor",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"useGrid",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"renderOccluded",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"ssrEnabled",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"tileBorders",void 0),Object(i.a)([Object(Fl.b)()],V_.prototype,"screenSizePerspective",void 0);const N_=Object(Vm.h)(),U_=Object(Ml.e)();class B_{constructor(){this.extent=Object(Ml.e)(),this.minLevel=0,this.maxLevel=0,this.callback=null}}let G_=class extends N.a{constructor(e){super(e),this.type="Terrain",this.isGround=!0,this.tileSize=256,this.rctx=null,this._isTransparent=!1,this.renderDataPool=new wg.a(zj),this._patchGroups=new Wb.a({allocator:e=>e||{root:null,origin:null,patches:new Wb.a},deallocator:e=>(e.root=null,e.origin=null,e.patches.clear(),e)}),this.patchGroupsDirty=!0,this.patchGroupsMap=new Map,this.tileIterator=new tj.b,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._skirtScale=1,this._velvetOverground=!0,this.castShadows=!0,this._ssrEnabled=!1,this.emptyTex=null,this.tileRenderer=null,this.tileBackgroundInitialized=!1,this.tileBackgroundUpdating=!1,this.stencilEnabledLayerExtents=[],this.numTrianglesRendered=0,this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.clippingExtent=null,this.overlayOpacity=1,this.needsHighlight=!1,this.renderOccludedFlags=1,this.visibleScaleRangeQueries=new Wb.a({initialSize:10}),this.visibleScaleRangeQueriesInvPtr=0,this.visibleScaleRangeQueryQueue=new Wb.a({initialSize:30}),this.visibleScaleRangeQueryPool=new wg.a(B_)}get isGlobal(){return 1===this.stage.viewingMode}initialize(){this.stage.addRenderPlugin([2,7,9],this)}destroy(){this.stage.removeRenderPlugin(this),NO.clear(),GO.clear()}get updating(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}get canRender(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get needsLinearDepth(){return this.overlayRenderer.hasWater}get opaque(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}set skirtScale(e){e!==this._skirtScale&&(this._skirtScale=e,this.setNeedsRender())}get skirtScale(){return this._skirtScale}get renderPatchBorders(){return!!this.shaderTechniqueConfig.tileBorders}set renderPatchBorders(e){this.shaderTechniqueConfig.tileBorders!==e&&(this.shaderTechniqueConfig.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this.shaderTechniqueConfig.backfaceCullingEnabled}set cullBackFaces(e){this.shaderTechniqueConfig.backfaceCullingEnabled!==e&&(this.shaderTechniqueConfig.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get intersectionHandlerId(){return oO.b}get slicePlane(){return this.shaderTechniqueConfig.slicePlaneEnabled}set slicePlane(e){this.shaderTechniqueConfig.slicePlaneEnabled!==e&&(this.shaderTechniqueConfig.slicePlaneEnabled=e,this.setNeedsRender())}set textureFadingEnabled(e){this.shaderTechniqueConfig.textureFadingEnabled!==e&&(this.shaderTechniqueConfig.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this.shaderTechniqueConfig.screenSizePerspective!==e&&(this.shaderTechniqueConfig.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this.rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?xO.c:1,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,this.tileRenderer&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}loadTile(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e)),this.updateTileGeometry(e),this.updateTileTexture(e)}queryVisibleLevelRange(e,t,r,i){const n=this.visibleScaleRangeQueryPool.acquire();Object(rc.c)(n.extent,e),n.minLevel=t||-Number.MAX_VALUE,n.maxLevel=null!=r?r:Number.MAX_VALUE,n.callback=i,this.visibleScaleRangeQueryQueue.push(n),this.setNeedsRender()}updateTileTexture(e){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(e),this.setNeedsRender(),e.resetPendingUpdate(64))}updateTileGeometry(e){for(const t of e.layerInfo[0])t.pendingUpdates&=-33;e.resetPendingUpdate(32),e.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){e.renderData&&(e.renderData.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(e.renderData),e.renderData.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=Math.max(0,7*Math.floor((e.lij[0]-3)/7));if(this.isGlobal&&0===t)return S.b;for(;e.parent&&e.lij[0]>t;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll((t=>{var r;return null==(r=t.renderData)?void 0:r.updateGeometry(this.rctx,e)})),this.setNeedsRender())}setNeedsRender(e=1){this.patchGroupsDirty=!0,this.context.requestRender(e)}setTileBackground(e){this.tileBackground=e,this._updateTileBackground()}initializeRenderContext(e){this.context=e,this.rctx=e.renderContext.rctx,this.shaderTechniques=e.shaderTechniqueRep,this.shaderTechniqueConfig=new V_,this.tileRenderer=new A_(this.rctx,this.tileSize,this.shaderTechniques),this.tileBackground&&this._updateTileBackground(),this.emptyTex=Object(vc.c)(this.rctx)}uninitializeRenderContext(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null),this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)}intersect(e,t,r,i){if(!this.rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const n=Q_,s=Z_;Object(Cl.l)(n,i,r),Object(Cl.y)(s,1/n[0],1/n[1],1/n[2]);const a=e.results.min,o=e.results.max,l=e.results.ground,c=0===e.options.store,u=!!e.results.ground.target;let d;const h=Object(oO.e)(e.verticalOffset),p=this.clippingExtent;this.allTiles.forAll((f=>{if(null===f.renderData||u&&this._useStencilForTile(f))return;if(e.options.invisibleTerrain){if(!f.visible&&p&&!f.intersectsExtent(p))return}else if(!f.visible)return;const m=f.renderData.geometryInfo;Object(Vm.B)(N_,m.boundingBox);const g=f.renderData.localOrigin;Object(b.j)(h)&&(h.localOrigin=g,h.applyToAabb(N_));const y=-this._skirtScale*m.skirtLength;if(0!==y){const e=f.up;Object(Vm.p)(N_,y*e[0],y*e[1],y*e[2])}const v=N_;Object(Cl.l)(X_,r,g);const O=c&&null!=a.dist?a.dist:1/0;if(!Object(zO.g)(v,X_,s,e.tolerance,O))return;const j=(e,t,r,i)=>{e.set(void 0,Object(tj.i)(t),r,i,Al.a,void 0),e.intersector=Y_,e.target={type:"external",metadata:{tile:t}}},_=(s,c)=>{if(s>=0&&(e.options.backfacesTerrain||Object(Cl.j)(c,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||null==t||t(r,i,s))){if((null==l.dist||s<l.dist)&&j(l,f,s,c),e.options.isFiltered)return;2===e.options.store&&(Object(b.i)(d)?(d=new zy.a(e.ray),j(d,f,s,c),e.results.all.push(d)):s<d.dist&&j(d,f,s,c)),(null==a.dist||s<a.dist)&&j(a,f,s,c),0!==e.options.store&&(null==o.dist||s>o.dist)&&j(o,f,s,c)}},w=J_;Object(Cl.l)(w,i,g);const x=m.indices,S=m.vertexAttributes,T={data:S.getField("position",Dj.u).typedBuffer,size:3,stride:S.stride/4},C=m.numWithoutSkirtIndices/3;if(Object(zO.j)(X_,w,0,C,x,T,null,h,_),0!==y){const e=this.isGlobal?e=>Object(Cl.g)(e,e,y/Object(Cl.r)(Object(Cl.h)(e,e,g))):e=>Object(Cl.y)(e,0,0,y),t=x.length/3;!function(e,t,r,i,n,s,a,o,l){const c=s.position,u=s.uv0,d=e[0],h=e[1],p=e[2],f=t[0]-d,m=t[1]-h,g=t[2]-p;i*=3;for(let y=r*=3;y<i;y+=3){const e=n[y],t=n[y+1],r=n[y+2];let i=c.get(e,0),s=c.get(e,1),v=c.get(e,2),O=c.get(t,0),j=c.get(t,1),_=c.get(t,2),w=c.get(r,0),x=c.get(r,1),S=c.get(r,2);u.get(e,0)>=2&&(Object(Cl.y)(KO,i,s,v),a(KO),i+=KO[0],s+=KO[1],v+=KO[2]),u.get(t,0)>=2&&(Object(Cl.y)(KO,O,j,_),a(KO),O+=KO[0],j+=KO[1],_+=KO[2]),u.get(r,0)>=2&&(Object(Cl.y)(KO,w,x,S),a(KO),w+=KO[0],x+=KO[1],S+=KO[2]),Object(b.j)(o)&&([i,s,v]=o.applyToVertex(i,s,v),[O,j,_]=o.applyToVertex(O,j,_),[w,x,S]=o.applyToVertex(w,x,S));const T=O-i,C=j-s,M=_-v,P=w-i,A=x-s,E=S-v,R=m*E-A*g,I=g*P-E*f,D=f*A-P*m,F=T*R+C*I+M*D;if(Math.abs(F)<=Number.EPSILON)continue;const L=d-i,k=h-s,z=p-v,V=L*R+k*I+z*D;if(F>0){if(V<0||V>F)continue}else if(V>0||V<F)continue;const N=k*M-C*z,U=z*T-M*L,B=L*C-T*k,G=f*N+m*U+g*B;if(F>0){if(G<0||V+G>F)continue}else if(G>0||V+G<F)continue;const q=(P*N+A*U+E*B)/F;q>=0&&l(q,Object(zO.d)(T,C,M,P,A,E,ej))}}(X_,w,C,t,x,S,e,h,_)}}))}prepareRender(){this.overlayOpacity<1&&this.updateOverlayOpacity()}render(e){if(9===e.slot){if(0==(e.renderOccludedMask&xO.c))return!1}else{const t=this.opaque?2:7;if(e.slot!==t)return!1}const t=e.pass,r=1===e.scenelightingData.globalFactor,i=this._updatePatchGroups();switch(t){case 0:{const t=e.shadowMap&&e.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==t&&(this.shaderTechniqueConfig.receiveShadows=t);const r=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==r&&(this.shaderTechniqueConfig.overlayMode=r);const n=9===e.slot?3:1;this._renderMaterialPass(e,0,i,n);break}case 4:case 6:this.castShadows&&r&&this._renderAuxiliaryPass(e,3,i,0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,1,i,0);break;case 3:this._renderAuxiliaryPass(e,2,i,0);break;case 5:this.needsHighlight&&(this._renderAuxiliaryPass(e,4,i,2),e.rctx.clearSafe(256))}return 0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender(),!0}_renderMaterialPass(e,t,r,i){const{rctx:n,camera:s}=e;this._ssrEnabled=e.ssrParams.ssrEnabled,this._setTerrainTechnique(t,3===i);const a=this.shaderTechnique.program;n.useProgram(a),0!==this.shaderTechniqueConfig.overlayMode&&1===i&&e.ssrParams&&Object(F_.b)(a,e.ssrParams),e.shadowMap.bind(a),e.ssaoHelper.bind(a),this._bindOverlayData(a,i),a.setUniformMatrix4fv("viewNormal",s.viewInverseTransposeMatrix),Object(ql.c)(a,s.projectionMatrix),e.scenelightingData.setUniforms(a,!0);const o=s.viewMatrix;Object(Cl.y)($_,o[12],o[13],o[14]),Object(Cl.t)($_,$_),a.setUniform3fv("viewDirection",$_),this.numTilesRendered=0,this.numTilesCulled=0,this.numTrianglesRendered=0,this.numOriginsRendered=0,this._prepareScaleRangeQueries(),this.opaque?this._renderPatchGroups(e,a,r,i):e.offscreenRenderingHelper.renderToTargets((()=>this._renderPatchGroups(e,a,r,i)),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._processScaleRangeQueries()}_renderAuxiliaryPass(e,t,r,i){this._setTerrainTechnique(t,3===i);const n=e.rctx,s=this.shaderTechnique.program;if(n.useProgram(s),5===e.pass){const t=e.offscreenRenderingHelper;s.bindTexture(t.depthTexture,"depthTex"),s.setUniform4f("highlightViewportPixelSz",0,0,1/t.width,1/t.height)}else s.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),2!==e.pass&&4!==e.pass&&6!==e.pass||s.setUniform2fv("nearFar",e.camera.nearFar);this._renderPatchGroupsAuxiliary(e,s,r,i)}_updateTileBackground(){if(!this.tileRenderer)return;this.tileBackgroundUpdating=!0;const e=()=>{this.tileBackgroundInitialized=!0,this.tileBackgroundUpdating=!1,this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid,this.shaderTechniqueConfig.hasBackgroundColor=!this.tileRenderer.backgroundIsGrid&&!!Object(b.j)(this.tileRenderer.backgroundColor),this.allTiles.forAll((e=>this.tileRenderer.updateTileTexture(e))),this.setNeedsRender()};if("string"==typeof this.tileBackground){const t=this.tileBackground;Object(El.a)(t).then((r=>{t===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(r,this.tileBackground===_a.a),e())}))}else{const t=this.tileBackground?Tl.a.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(t,!1),e()}}_updatePatchGroups(){const e=this._patchGroups;if(!this.patchGroupsDirty)return e;if(this.highestVisibleLODTile=null,this._renderCollectOrigins(e),0!==this.renderOrder){for(let t=0;t<e.length;t++)Object(tj.g)(this.renderOrder,e.data[t].patches);e.sort(((e,t)=>function(e,t,r){return 0===e.patches.length?-r:0===t.patches.length?r:Object(tj.c)(e.patches.data[0],t.patches.data[0],r)}(e,t,this.renderOrder)))}return this.patchGroupsDirty=!1,e}_renderCollectOrigins(e){const t=this.rootTiles,r=this.isGlobal;e.clear();for(const i of t){const t=e.pushNew();t.root=i,t.origin=r?S.b:i.centerAtSeaLevel,t.patches.clear(),this._renderCollectOriginsForRoot(e,t)}e.filterInPlace((e=>e.patches.length>0))}_renderCollectOriginsForRoot(e,t){const r=this.tileIterator;r.resetOne(t.root);const i=this.patchGroupsMap;for(i.clear(),i.set(t.origin,t);!r.done;){const t=r.next(),n=t.renderData;if(!n||t.visible){if(t.lij[0]%7==0){const r=e.pushNew();r.root=t,r.origin=t.centerAtSeaLevel,i.set(t.centerAtSeaLevel,r),r.patches.clear()}if(t.rendered){if(n){const e=i.get(n.localOrigin);e&&e.patches.push(t),(!this.highestVisibleLODTile||t.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=t),r.skipSubtree()}}else this.numTilesCulled++}else this.numTilesCulled++,r.skipSubtree()}}_scaleQueriesForTile(e){const t=e.extent,r=e.lij[0];let i=0;for(;i<this.visibleScaleRangeQueriesInvPtr;){const e=this.visibleScaleRangeQueries.data[i],n=e.extent;r>=e.minLevel&&r<=e.maxLevel&&n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]?(this.visibleScaleRangeQueries.swapElements(i,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):i++}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,r,i){this.shaderTechnique.bindPipelineState(e.rctx);const n=this.stencilEnabledLayerExtents.length>0;t.setUniformMatrix4fv("proj",e.camera.projectionMatrix),t.setUniform1f("skirtScale",this._skirtScale),0!==i&&this._bindOverlayData(t,i);for(let s=0;s<r.length;s++){const a=r.data[s];this._bindPatchGroupData(t,a,e.camera.eye,e.camera.viewMatrix);for(let r=0;r<a.patches.length;r++)this._renderPatch(e.rctx,t,a.patches.data[r],4,n,i)}e.rctx.bindVAO(null)}_renderPatchGroups(e,t,r,i){const n=e.rctx,s=e.camera,a=s.viewMatrix;if(this.shaderTechnique.bindPipelineState(n),this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){const e=Object(sm.d)(this.stage.viewingMode,this.ellipsoidRadius),r=this.pointsOfInterest.centerOnSurfaceFrequent.distance;e.update({distance:r,fovY:s.fovY}),Object(zO.a)(e,t,"screenSizePerspective")}const o=this.stencilEnabledLayerExtents.length>0,l=3===i;l&&(t.bindTexture(this.emptyTex,"tex"),t.setUniform1f("blend",1),t.setUniform4fv("texOffsetAndScale",Ml.b));const c=Object(b.j)(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:Ml.b;this.shaderTechniqueConfig.hasBackgroundColor&&t.setUniform4fv("backgroundColor",c);const u=l?0:this._skirtScale;t.setUniform1f("skirtScale",u);const d=this.wireframe?1:4;this.shaderTechniqueConfig.textureFadingEnabled&&t.bindTexture(this.emptyTex,"texNext");for(let h=0;h<r.length;h++){const c=r.data[h],u=c.patches;this._bindPatchGroupData(t,c,s.eye,a);const p=e.sliceHelper&&e.sliceHelper.plane;Object(D_.b)(t,this.shaderTechnique.configuration,p,c.origin),e.shadowMap&&e.shadowMap.bindView(t,c.origin),this.numOriginsRendered++;for(let e=0;e<u.length;e++){const r=u.data[e],s=r.renderData.textureReference;if(Object(b.i)(s))continue;if(!l){this._scaleQueriesForTile(r),H_(r.renderData.geometryInfo.uvOffsetAndScale,s.offsetAndScale,U_),t.setUniform4fv("texOffsetAndScale",U_),t.bindTexture(s.texture.texture,"tex");const e=r.renderData.textureFadeFactor,i=e<1?r.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&Object(b.j)(i)&&e<1?(H_(r.renderData.geometryInfo.uvOffsetAndScale,i.offsetAndScale,U_),t.setUniform1f("textureFadeFactor",e),t.setUniform4fv("nextTexOffsetAndScale",U_),t.bindTexture(i.texture.texture,"texNext")):t.setUniform1f("textureFadeFactor",1),r.renderData.textureIsFading&&this.setNeedsRender(),t.setUniform1f("opacity",r.renderData.opacity),t.setUniform1i("compositeBackground",r.renderData.compositeBackgroundInShader?1:0),t.setUniform1f("textureOpacity",r.renderData.layerOpacity),t.setUniform1f("baseOpacity",r.renderData.baseOpacity)}const a=this._renderPatch(n,t,r,d,o,i);r.renderOrder=this.numTilesRendered,this.numTilesRendered++,this.numTrianglesRendered+=a/3}}n.bindVAO(null)}_renderPatch(e,t,r,i,n,s){if(Object(b.i)(r.renderData.vao.indexBuffer))return 0;0!==s&&this._bindOverlayPatchData(t,r.renderData.overlay),n&&(this._useStencilForTile(r)?this.stencilShaderTechnique.bindPipelineState(e):this.shaderTechnique.bindPipelineState(e));const a=0===this._skirtScale?r.renderData.geometryInfo.numWithoutSkirtIndices:r.renderData.vao.indexBuffer.size;return e.bindVAO(r.renderData.vao),t.assertCompatibleVertexAttributeLocations(r.renderData.vao),e.drawElements(i,a,r.renderData.vao.indexBuffer.indexType,0),a}_bindPatchGroupData(e,t,r,i){e.setUniform3fv("origin",t.origin),Object(Pl.t)(W_,i,t.origin),e.setUniformMatrix4fv("view",W_),e.setUniform3f("camPos",r[0]-t.origin[0],r[1]-t.origin[1],r[2]-t.origin[2])}_bindOverlayData(e,t){if(0===this.shaderTechniqueConfig.overlayMode)return;e.setUniform1f("overlayOpacity",this.overlayOpacity);const r=this.overlayRenderer.overlays;if(r.length>0){const i=r[0],n=i.getColorTexture(t);if(e.bindTexture(Object(b.j)(n)?n:this.emptyTex,"ovColorTex"),2===this.shaderTechniqueConfig.overlayMode){const r=i.getNormalTexture(t);e.bindTexture(Object(b.j)(r)?r:this.emptyTex,"ovWaterTex")}}}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_setTerrainTechnique(e,t){this.shaderTechniqueConfig.output=e,0===e&&(this.shaderTechniqueConfig.atmosphere=this.isGlobal&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled),this.shaderTechniqueConfig.renderOccluded=t,this.shaderTechniqueConfig.stencilEnabled=!1,this.shaderTechnique=this.shaderTechniques.releaseAndAcquire(z_,this.shaderTechniqueConfig,this.shaderTechnique),this.shaderTechniqueConfig.stencilEnabled=!0,this.stencilShaderTechnique=this.shaderTechniques.releaseAndAcquire(z_,this.shaderTechniqueConfig,this.stencilShaderTechnique)}_prepareScaleRangeQueries(){const e=this.visibleScaleRangeQueries,t=this.visibleScaleRangeQueryQueue;for(;e.length<e.data.length&&t.length>0;){const r=t.pop();e.push(r)}this.visibleScaleRangeQueriesInvPtr=e.length}_processScaleRangeQueries(){const e=this.visibleScaleRangeQueries,t=this.visibleScaleRangeQueryPool;for(let r=0;r<e.length;r++){const i=e.data[r];t.release(i),i.callback(r>=this.visibleScaleRangeQueriesInvPtr),i.callback=null}e.clear()}get test(){return{tileRenderer:this.tileRenderer}}};Object(i.a)([Object(j.b)()],G_.prototype,"tileBackgroundInitialized",void 0),Object(i.a)([Object(j.b)()],G_.prototype,"tileBackgroundUpdating",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],G_.prototype,"overlayRenderer",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],G_.prototype,"stage",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],G_.prototype,"isGlobal",null),Object(i.a)([Object(j.b)({constructOnly:!0})],G_.prototype,"updateOverlayOpacity",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],G_.prototype,"allTiles",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],G_.prototype,"ellipsoidRadius",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],G_.prototype,"updating",null),Object(i.a)([Object(j.b)({value:!1})],G_.prototype,"renderingDisabled",null),Object(i.a)([Object(j.b)()],G_.prototype,"renderPatchBorders",null),Object(i.a)([Object(j.b)()],G_.prototype,"cullBackFaces",null),Object(i.a)([Object(j.b)({value:1})],G_.prototype,"renderOrder",null),Object(i.a)([Object(j.b)()],G_.prototype,"wireframe",null),G_=Object(i.a)([Object(w.a)("esri.views.3d.terrain.TerrainRenderer")],G_);var q_=G_;function H_(e,t,r){const i=e[0]*t[2]+t[0],n=e[1]*t[3]+t[1],s=e[2]*t[2],a=e[3]*t[3];Object(rc.l)(r,i,n,s,a)}const W_=Object(Al.d)(),$_=Object(S.e)(),Q_=Object(S.e)(),Z_=Object(S.e)(),X_=Object(S.e)(),J_=Object(S.e)(),Y_="TerrainRenderer";var K_=q_;var ew=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}};class tw{constructor(){this.offset=Object(tc.b)(),this.scale=0,this.tile=null}init(e,t,r,i){this.tile=e,this.offset[0]=t,this.offset[1]=r,this.scale=i}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const rw=f.a.getLogger("esri.views.3d.terrain.TerrainSurface");let iw=class extends(zi.a.EventedMixin(N.a)){constructor(e){super(e),this._elevationBounds=new vO,this._rootExtent=Object(P.k)(),this._iteratorPool=new wg.a(tj.b,(e=>e.remove=()=>this._iteratorPool.release(e))),this._postorderIterator=new tj.a,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=ow,this._performanceInfo=new ew,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._overlayOpacity=1,this._eyePosRenderSR=Object(S.e)(),this._eyePosSurfaceSR=Object(S.e)(),this._splitLimits=new mj,this._snapLevel=1/0,this._frustum=Object(xg.c)(),this._viewProjectionMatrix=Object(Al.d)(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new F.a,this._watchUpdatingTracking=new B.a,this._allTiles=new Wb.a,this._upsampleInfoPool=new wg.a(tw),this._getElevationData={spatialReference:null,rootTiles:null},this._maxNumUpdating=1,this.maxTextureScale=1.2,this.rootTiles=null,this.backgroundImage=_a.a,this.backgroundColor=null,this._layerViewsDirty=!1}initialize(){this._lercDecoder=Object(bO.a)(this.view.resourceController),this._tilePool=this.view.state.isLocal?new wg.a(xj):new wg.a(Sj);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.getMemCache("esri.views.3d.terrain.upsample",(e=>e.unloadMapData())),this._elevationQueryCache=new fO(e.getMemCache("elevation-query")),this._set("overlayManager",new AO({surface:this})),this._handles.add([this.watch("overlayManager.hasHighlights",(e=>this._renderer.setNeedsHighlight(e))),this.watch("overlayManager.rendersOccluded",(e=>this._renderer.setRenderOccludedOverlay(e)))],"overlayManager"),this._renderer=new K_({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:Object(M.e)(this.view.spatialReference).radius,stage:this.view._stage,updateOverlayOpacity:()=>this.updateOverlayOpacity(),allTiles:this._allTiles}),this._handles.add([Object(y.a)(this,"baseOpacity",(e=>{this._handleLayerViewChanges(),this._updateBaseOpacity(e)}),!0),Object(y.a)(this,"_background",(()=>{this._handleLayerViewChanges(),this._renderer.setTileBackground(this._background)}),!0),this.view.watch("pointsOfInterest",(e=>{this._renderer.pointsOfInterest=e,this._watchUpdatingTracking.removeAll(),e&&this._watchUpdatingTracking.add(e.focus,"renderLocation",(()=>()=>this._allTilesSorted=!1))})),Object(y.a)($b.a,"TERRAIN_TILE_TREE_SHOW_TILES",(e=>{e&&!this._treeDebugger?r.e(142).then(r.bind(null,1057)).then((({TerrainTileTree3DDebugger:e})=>{!this._treeDebugger&&$b.a.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new e({view:this.view}))})):e||!this._treeDebugger||$b.a.TERRAIN_TILE_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)}))]);const t={layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,spatialReference:this.view.spatialReference};this.extentHelper=function(e,t){return 1===e?new Pj(t):new Aj(t)}(this.viewingMode,t),this._handles.add(Object(y.a)(this.extentHelper,"stencilEnabledExtents",(e=>this._renderer.setStencilEnabledLayerExtents(e))),"extentHelper");const i=this.view.defaultsFromMap?new Ra.a({getCollections:()=>{var e,t,r;return null==(e=this.view)||null==(t=e.defaultsFromMap)||null==(r=t.mapCollectionPaths)?void 0:r.map((e=>this.view.map.get(e)))},getChildrenFunction:e=>e&&"layers"in e?e.layers:null}):this.view.map.allLayers,n=new Ij({layers:i,extentHelper:this.extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",n),this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",(()=>this._updateTilingSchemeAndExtent()),!0),this.tilingSchemeLogic.watch("extent",(()=>this._updateTilingSchemeAndExtent()),!0)],"tilingSchemeLogic"),this._updateTilingSchemeAndExtent(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(Cm.b.TERRAIN_SURFACE,this),this.view.resourceController.memoryController.events.on("quality-changed",(()=>this._viewChangeUpdate())),this._handles.add([this.view.on("resize",(()=>this._viewChangeUpdate())),this.view.watch("state.camera",(()=>this._viewChangeUpdate()),!0),this.view.watch("state.contentCamera",(()=>this.view.state.fixedContentCamera&&this._viewChangeUpdate()),!0),this.view.watch("qualitySettings.tiledSurface.lodBias",(()=>this._viewChangeUpdate())),Object(y.a)(this.view,"qualitySettings.tiledSurface.textureFadeDuration",(e=>this._renderer.textureFadingEnabled=e>0)),this.view.watch("lodSnapping",(()=>this._viewChangeUpdate())),this.view.watch("clippingArea",(()=>this._clippingChanged()))]),this._handles.add(this.view.allLayerViews.on("after-changes",(()=>this._layerViewsDirty=!0))),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._updateClippingExtent(),this.notifyChange("extent")}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Object(b.q)(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Object(b.e)(this._upsampleMapCache),this._elevationQueryCache=Object(b.e)(this._elevationQueryCache),this._set("tilingSchemeLogic",Object(b.e)(this.tilingSchemeLogic)),this.extentHelper=Object(b.e)(this.extentHelper),this._basemapLayerViewHandles.forEach(((e,t)=>this._unregisterTiledLayerView(t))),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Object(b.e)(this.overlayManager)),this._tilePool=Object(b.e)(this._tilePool),wj.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=Object(b.e)(this._renderer),this._iteratorPool=Object(b.e)(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=Object(b.e)(this._upsampleInfoPool),Object(mO.b)(),uj.size>0&&(console.log(`${uj.size} live TilePerLayerInfo allocations:`),uj.forEach((e=>console.log(e,"\n"))))}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,t;const r=null==(e=this.view.pointsOfInterest)||null==(t=e.contentCameraOnSurface)?void 0:t.scale;if(r){const e=this.view.state.contentCamera;let t=Object(lf.c)(this.view,e.eye,e.viewForward,e.up).tilt;t>90&&(t=180-t);const i=2*(t/90)**2,n=Object(lf.n)(this.view,r)-i;Math.abs(this._snapLevel-n)>.25&&(Math.round(n)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=n)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?1:0}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get extent(){return Object(b.t)(this._clippingExtent,this._rootExtent)}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return!!this.rootTiles}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}set skirtScale(e){this._renderer.skirtScale=e}get skirtScale(){return this._renderer.skirtScale}get spatialReference(){var e,t;return null!=(e=null==(t=this.tilingScheme)?void 0:t.spatialReference)?e:null}get _background(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage}set slicePlaneEnabled(e){var t,r;this._renderer.slicePlane=e,this._set("slicePlaneEnabled",e),null==(t=this.view)||null==(r=t._stage)||r.renderView.setRenderParameters({opaqueTerrain:this.opaque})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,r,i){this._renderer.intersect(e,t,r,i)}getElevation(e,t,r,i){const n=lw,s=this.getTileWithElevation(e,t,r,i,n);return Object(b.i)(s)?null:OO.sample(n[0],n[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,r,i,n=lw){const s=this._getElevationData.rootTiles;if(!s||!s.length)return null;if(0===s[0].layerInfo[0].length)return null;if(n[0]=e,n[1]=t,n[2]=r,!Object(C.z)(n,i,n,this._getElevationData.spatialReference))return rw.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let a of s){if(!a.containsPoint(n))continue;for(;a&&!a.rendered&&!a.isLeaf;){let e=0;n[0]>.5*(a.extent[0]+a.extent[2])&&(e+=1),n[1]<.5*(a.extent[1]+a.extent[3])&&(e+=2),a=a.children[e]}const e=a.renderData;return e&&e.geometryState&&e.geometryState.samplerData?a:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!Object(C.u)(e,lw,this.spatialReference))return rw.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(t)for(let e of t)if(e.containsPoint(lw)){for(;null!=e.children[0];){let t=0;lw[0]>e.children[0].extent[2]&&(t+=1),lw[1]<e.children[0].extent[1]&&(t+=2),e=e.children[t]}return this._getLodBiasCorrectedScale(e.level)}}return 1e100}queryVisibleScaleRange(e,t,r,i){const n=t?this.tilingScheme.levelAtScale(t):0,s=r?this.tilingScheme.levelAtScale(r):1/0,a=this.lodBias;this._renderer.queryVisibleLevelRange(e,n+a,s+a,i)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1,this._renderer.isTransparent=this._allTransparentSurfaceLayers();const r=t!==this._renderer.opaque;var i,n;r&&(null==(i=this.view)||null==(n=i._stage)||n.renderView.setRenderParameters({opaqueTerrain:this.opaque})),this._updateTileTextures(r)}_updateTilingSchemeAndExtent(){const e=this.tilingSchemeLogic.extent,t=e&&!Object(P.n)(e,this._dataExtent);t&&(Object(b.j)(this._dataExtent)?Object(P.y)(this._dataExtent,e):this._dataExtent=Object(P.k)(e));const r=this.tilingSchemeLogic.tilingScheme,i=r!==this.tilingScheme;var n;i&&(Object(_v.s)(!!r,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",r),this._updateClippingExtent(),r&&(this._updateTiledLayers(),this._renderer.setTileSize(r.pixelSize),this.overlayManager.setSpatialReference(r.spatialReference)),this._getElevationData.spatialReference=null!=(n=null==r?void 0:r.spatialReference)?n:null),(t||i)&&this._updateRootTiles()}_acquireTile(e,t,r,i){const n=this._tilePool.acquire();return uw[0]=e,uw[1]=t,uw[2]=r,n.init(uw,i,this),n}_updateRootTiles(){const e=this._clippingExtent||this._dataExtent,t=this.tilingScheme;if(Object(b.i)(e)||!t)return;const r=cw;let i=t.rootTilesInExtent(e,r,5*_a.i);const n=e=>{const t=this._acquireTile(0,e[1],e[2],null);return 2===t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&t.setPendingUpdate(2),this._loadTile(t),t};if(this.rootTiles){if(i.length>_a.i)return void rw.warn(_a.k);const e=this.rootTiles.map((e=>e.lij)),t=Object(Ma.d)(e,i,sw);if(t.removed.length>0||t.added.length>0){const e=this.rootTiles.filter((e=>!(t.removed.findIndex(sw.bind(null,e.lij))>-1)||(this._purgeTile(e),!1)));t.added.forEach((t=>e.push(n(t)))),this._setRootTiles(e)}}else i.length>_a.i&&(rw.warn(_a.l),i=t.rootTilesInExtent(e,r,_a.i)),this._setRootTiles(i.map((e=>n(e))));Object(P.n)(r,this._rootExtent)||(this._rootExtent=Object(P.k)(r),this._hasFixedExtent()||this.notifyChange("extent")),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setOverlayPlacementDirty(),this.notifyChange("ready")}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),e){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._getElevationData.rootTiles=e,this._renderer.setRootTiles(this.rootTiles),this._updateTileVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this.updateOverlayOpacity(),this._updateTileVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this._clippingExtent)&&e.resetPendingUpdate(32)&&this._updateTileGeometry(e)}_updateTileVisibility(e){if(!e)return;const t=this._iteratorPool.acquire();t.reset(e);const r=Object(tj.f)(e);let i=r?this._elevationBounds.min:1/0,n=r?this._elevationBounds.max:-1/0;for(;!t.done;){const e=t.next();this._updateClippingStatus(e),e.updateVisibility(),e.setPendingUpdate(16),e.loadable?(e.updateScreenDepth(this._viewProjectionMatrix),e.renderData&&(i=Math.min(e.elevationBounds[0],i),n=Math.max(e.elevationBounds[1],n))):t.skipSubtree()}t.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(n)&&(this._elevationBounds.min===i&&this._elevationBounds.max===n||(this._elevationBounds.min=i,this._elevationBounds.max=n,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,r=Math.tan(.5*t.fovX),i=Math.tan(.5*t.fovY),n=this.tilingScheme.pixelSize,s=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(Object(b.i)(this._splitLimits.frustum)&&(this._splitLimits.frustum=Object(xg.c)()),Object(xg.b)(t.frustum,this._splitLimits.frustum)):this._splitLimits.frustum=null,Object(xg.b)(e.frustum,this._frustum),Object(Pl.m)(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),Object(Cl.m)(this._eyePosRenderSR,t.eye),Object(C.z)(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateSkirts(){const e=this.view.state.camera,t=this.view.state.constraints.collision.enabled?0:1.11*e.near;this.skirtScale=Object(_v.b)(this,this._eyePosSurfaceSR,t)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(aw(e)?this._loadChildren(e):function(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._elevationUpdate(e),this._usedMemory=ow}_elevationUpdate(e){hw.spatialReference=this.spatialReference,hw.tile=e,hw.extent=e.extent,this.emit("elevation-change",hw),Object(P.h)(e.extent,this._eyePosSurfaceSR)&&this._updateSkirts()}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run((()=>this._updateElevation(e))),e.run((()=>this._updateTextures(e))),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const e=t.next();if(e.loadable){const r=e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===r){e.resetPendingUpdate(8),e.isLeaf&&(e.setPendingUpdate(2),t.skipSubtree());continue}e.resetPendingUpdate(2)&&e.updateAgentSuspension(),4===r&&e.updateAgents(0)}if(t.skipSubtree(),!e.isLeaf){e.setPendingUpdate(8),e.resetPendingUpdate(2);const t=this._iteratorPool.acquire();t.resetOne(e);for(let e=t.next();!t.done;e=t.next())this._updateClippingStatus(e),e.updateVisibility(),e.loadable&&e.updateScreenDepth(this._viewProjectionMatrix);t.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(Object(tj.h)(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_mergeAndSplit(e,t){if(this.suspended||!this._allTilesDirty||e.done)return;this._allTilesDirty=!1,this.requestUpdate();let r=0;for(;!e.done;){let i=!1;r=0;const n=!this._allTiles.some((n=>{if(r+=n.usedMemory,n.resetPendingUpdate(8)){if(!t)return n.setPendingUpdate(8),e.done;this._mergeTile(n),i=!0,e.madeProgress()}else n.resetPendingUpdate(2)&&(this._splitTile(n),i=!0,e.madeProgress());return n.resetPendingUpdate(16)&&(this._updateRenderData(n),e.madeProgress()),e.done}));if(i&&(this._allTilesSorted=!1,this._allTilesDirty=!0),n){if(this._usedMemory=r,!i)break}else this._allTilesDirty=!0}0===r&&(this._allTilesDirty=!0),this._sortTiles(e)}_updateElevation(e){return this._allTiles.some((t=>(t.resetPendingUpdate(32)&&(this._updateTileGeometry(t),t.resetPendingUpdate(64)&&(this._renderer.updateTileTexture(t),this._usedMemory=ow),e.madeProgress()),e.done))),e.hasProgressed}_updateTextures(e){return this._allTiles.some((t=>(t.resetPendingUpdate(64)&&(this._renderer.updateTileTexture(t),this._usedMemory=ow,e.madeProgress()),e.done))),e.hasProgressed}_updateClippingExtent(){if(!this.spatialReference)return!1;const e=Object(P.k)();let t=null;return Object(Zg.b)(this.view.clippingArea,e,this.spatialReference)&&(t=e),!Object(P.n)(t,this._clippingExtent)&&(this._clippingExtent=t,this._renderer.clippingExtent=t,this.notifyChange("extent"),this.updateTileOverlayParams(),this.overlayManager.setOverlayPlacementDirty(),!0)}_clippingChanged(){this._updateClippingExtent()&&this._updateRootTiles()}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*_a.g}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,r=Object(Bt.e)(e-this.lodBias,0,t.length-1),i=r-Math.floor(r);return t[Math.floor(r)].scale*(1-i)+t[Math.ceil(r)].scale*i}_removeAllTiles(){this.rootTiles&&(this.rootTiles.forEach((e=>this._purgeTile(e))),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeChildTiles(e){if(e.isLeaf)return!1;let t=this._purgeTile(e.children[0]);return t=this._purgeTile(e.children[1])||t,t=this._purgeTile(e.children[2])||t,t=this._purgeTile(e.children[3])||t,e.unsetChildren(),t}_purgeTile(e){const t=this._purgeChildTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),e.unload(this._renderer),this._tilePool.release(e),t}_splitTile(e){Object(_v.s)(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,r=2*e.lij[1],i=2*e.lij[2];e.setChildren(this._createTile(t,r,i,e),this._createTile(t,r,i+1,e),this._createTile(t,r+1,i,e),this._createTile(t,r+1,i+1,e)),e.setPendingUpdate(16),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){pw.spatialReference=this.spatialReference,pw.extent=e.extent,pw.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",pw)}_createTile(e,t,r,i){Object(_v.s)(!!i,"_createTile sanity check");const n=this._acquireTile(e,t,r,i);return n.updateClippingStatus(this._clippingExtent),n.loadable&&(n.updateScreenDepth(this._viewProjectionMatrix),2===n.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&n.setPendingUpdate(2)),n}_mergeTile(e){Object(_v.s)(!e.hasPendingUpdate(2),"_mergeTile sanity check"),this._purgeChildTiles(e)&&(Object(_v.s)(!e.renderData,"_mergeTile sanity check"),this._loadTile(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_loadChildren(e){Object(_v.s)(e.rendered,"parent should be rendered"),e.unload(this._renderer),this._loadTile(e.children[0]),this._loadTile(e.children[1]),this._loadTile(e.children[2]),this._loadTile(e.children[3])}_loadParent(e){const t=e.parent;this._unloadChildren(t),this._loadTile(t)}_unloadChildren(e){e.isLeaf||(this._unloadChildren(e.children[0]),e.children[0].unload(this._renderer),this._unloadChildren(e.children[1]),e.children[1].unload(this._renderer),this._unloadChildren(e.children[2]),e.children[2].unload(this._renderer),this._unloadChildren(e.children[3]),e.children[3].unload(this._renderer))}_loadTile(e){e.load(this._renderer),e.setPendingUpdate(16),this.requestUpdate(),this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_elevationDataArrived(e,t,r){const i=new OO(e.lij,e.extent,r);e.dataArrived(t,0,i);const n=[e],s=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const e=a.next();e.findElevationBoundsForLayer(t,s),e.computeElevationBounds()}a.remove(),this._updateTileVisibility(n)}_handleLayerViewChanges(e=Cm.d){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const r=new Set;let i=-1;for(const n of this.view.allLayerViews.items)if(r.add(n.uid),Object(_v.j)(n))if(this._basemapLayerViewHandles.has(n.uid)){const e=this.layerClassFromLayerView(n),r=this._layerIndexByUid[e].get(n.uid);r<i&&(t=!0),i=r}else this._registerTiledLayerView(n),n.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach(((e,i)=>{r.has(i)||(this._unregisterTiledLayerView(i),t=!0)})),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allTransparentSurfaceLayers(),e.madeProgress()}_allTransparentSurfaceLayers(){let e=0===this.view.map.ground.opacity;for(const t of this.view.allLayerViews.items)if(Object(_v.j)(t)&&!Object(_v.e)(t)&&!Object(I.b)(t.layer)&&0!==t.fullOpacity)return e=!1,e;return e}layerClassFromLayerView(e){return Object(_v.e)(e)?0:1}_registerTiledLayerView(e){const t=[],r=this.layerClassFromLayerView(e);t.push(e.watch("suspended",(()=>this._updateTiledLayers()))),t.push(e.watch("fullOpacity",(()=>this._updateTileTextures(!1)))),t.push(e.layer.watch("scaleRangeId",(()=>this._restartAllAgents(r)))),e.on("data-changed",(()=>{const t=this._layerIndexByUid[r].get(e.uid);null!=t&&this._invalidateLayerData(t,r)})),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let e=0;e<t.length;e++)t[e].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let r=null;const i=Object(P.m)();e.forEach((e=>{const n=e.layer;if(!n||e.suspended||!Object(_v.j)(e))return;const s=e.fullExtent;if(!s)return void rw.warn("Terrain: Map or elevation layer does not have fullExtent: "+n.id);if(!this.tilingScheme.compatibleWith(e.tileInfo))return void rw.warn("Terrain: tiling scheme of layer "+n.id+" is incompatible with other tiled layers, will not be drawn");Object(P.o)(i,s);const a=this.layerClassFromLayerView(e);if(1===a){const t=e.displayLevelRange;t.maxLevel!==1/0&&(null===r||t.maxLevel>r)&&(r=t.maxLevel)}t[a].push(e)}));for(const n of _a.f){const e=this._layerViews[n],r=t[n];r.reverse();const i=r.length;let s=e.length!==i;const a=new Array(i),o=new Array(e.length);this._layerIndexByUid[n].clear();for(let t=0;t<i;t++){const i=r[t].uid;this._layerIndexByUid[n].set(i,t);const l=e.indexOf(r[t]);a[t]=l,t!==l&&(s=!0),l>-1&&(o[l]=t)}if(s){const e=this._postorderIterator;for(e.reset(this.rootTiles);!e.done;)e.next().modifyLayers(o,a,n);this._layerViews[n]=r,this._restartAllAgents(n),this._updateTileVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const r=t.next();r.restartAgents(e),0===e&&r.computeElevationBounds()}}_hasFixedExtent(){return!!this._clippingExtent}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll((t=>{t.updateAgents(1),e?this.renderer.updateTileTexture(t):t.updateRenderData(1)})),this._renderer.isTransparent=this._allTransparentSurfaceLayers()}_invalidateLayerData(e,t){this._allTiles.forAll((r=>r.removeLayerAgent(e,t))),this._allTiles.forAll((r=>r.invalidateLayerData(e,t)))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=1){this.renderer.setNeedsRender(e)}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(e,t,r,i){const n=this.layerViewByIndex(t,r),s=n.layer;return!s.tilemapCache||Object(_v.n)(n)?this._requestTileData(e,r,n,i):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...i,timeout:6e3}).then((()=>--this._asyncWorkItems)).catch((t=>{throw--this._asyncWorkItems,Object(m.n)(t)||this._dataMissing(e,r,n,{notInTilemap:!0}),t})).then((()=>this._frameTask.schedule((()=>this._requestTileData(e,r,n,i)),i.signal))))}_requestTileData(e,t,r,i){return 0===t?this._requestElevationTileData(e,r,i):this._requestMapTileData(e,r,i)}_requestElevationTileData(e,t,r){if(!Object(_v.e)(t))return void Object(_v.s)(!1,"_requestElevationTileData can only be called for elevation layer views");const i=i=>{if(--this._asyncWorkItems,Object(m.o)(r))return;const n=this._layerIndexByUid[0].get(t.uid);null!=n?(this._usedMemory=ow,this.requestUpdate(),this._elevationDataArrived(e,n,i)):rw.warn("TerrainSurface: received data from unknown layer %d %s",0,e.lij.toString())},n=r=>{--this._asyncWorkItems,Object(m.n)(r)||(this._dataMissing(e,0,t,r),this.requestUpdate())};if(++this._asyncWorkItems,Object(_v.r)(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:_a.c,signal:r.signal}).then((e=>{if(Object(m.o)(r))return rw.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void n(Object(m.f)());this._frameTask.schedule((()=>i(e)),r.signal)}),n);const s=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(s,"binary",r).then((e=>this._lercDecoder.decode(e,{noDataValue:_a.c},r.signal))).then((e=>{i({values:e.pixelData,width:e.width,height:e.height,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue})}),n)}_requestMapTileData(e,t,r){if(t instanceof gO.default)return Promise.reject();++this._asyncWorkItems;const i=(i,n)=>{--this._asyncWorkItems,Object(_v.p)(n),Object(m.o)(r)||(this._dataMissing(e,1,t,i),this.requestUpdate())},n=e=>t=>i(t,e),s=i=>this._frameTask.schedule((()=>{--this._asyncWorkItems,this.requestUpdate(),Object(m.o)(r)?Object(_v.p)(i):this._mapTileDataArrived(e,t,i)}),r.signal,n(i)).catch(n(i)),a=(e,t=null)=>this._frameTask.schedule((()=>i(e,t))).catch(n(t));if(Object(_v.n)(t)){const i=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(i[0],i[1],i[2],r).then(s,a)}if(Object(_v.f)(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(s,a);if(Object(_v.l)(t)&&Object(_v.r)(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then((e=>{if(Object(m.o)(r))return rw.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Object(m.f)());s(e)}),a);let o=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);(function(e){return null!=e.refreshInterval})(t)&&t.refreshTimestamp&&(o+=`${o.indexOf("?")>-1?"&":"?"}_ts=${t.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(o,l,r).then(s,a)}_mapTileDataArrived(e,t,r){const i=this._layerIndexByUid[1].get(t.uid);null!=i?e.dataArrived(i,1,r):(Object(_v.p)(r),rw.warn("TerrainSurface: received data from unknown layer"))}_dataMissing(e,t,r,i){const n=this._layerIndexByUid[t].get(r.uid);null!=n?e.dataMissing(n,t,i):rw.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll((e=>{e.renderData&&this.overlayManager.setTileParameters(e)})),this._renderer.setNeedsRender())}updateOverlayOpacity(){if(!this.overlayManager)return;const e=this._eyePosSurfaceSR[2],t=this.overlayManager.computeOpacity(e);this._overlayOpacity!==t&&(this._overlayOpacity=t,this._renderer.overlayOpacity=t,this._renderer.setNeedsRender())}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll((t=>{t.isLeaf&&e.numLeaves++;const r=t.level;t.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))})),e}getUsedMemory(){return this.tilingScheme?(this._usedMemory===ow&&(this._usedMemory=0,this._allTiles.forAll((e=>this._usedMemory+=e.usedMemory))),this._usedMemory):0}getUsedMemoryForLayerView(e){let t=0;const r=this.layerClassFromLayerView(e),i=this._layerIndexByUid[r].get(e.uid);return this._allTiles.forAll((e=>t+=e.getUsedMemoryForLayer(r,i))),t}getTile(e){if(Object(b.i)(e))return null;const t=e.split("/").map((e=>+e));if(0===t[0])return this.rootTiles.find((e=>e.lij[1]===t[1]&&e.lij[2]===t[2]));const r=2**t[0],i=Math.floor(t[1]/r),n=Math.floor(t[2]/r);let s;if(this.rootTiles.some((e=>e.lij[1]===i&&e.lij[2]===n&&(s=e,!0))),s){let e=1<<t[0]-1;for(;s.lij[0]<t[0];){let r=t[1]&e?2:0;if((t[2]&e)>0&&r++,!s.children[r])return null;s=s.children[r],e>>=1}return Object(_v.s)(s.lij[0]===t[0]&&s.lij[1]===t[1]&&s.lij[2]===t[2],"not the right tile?"),s}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate()},getTiles:()=>e._allTiles.toArray(),getRenderedTiles:()=>(dw.clear(),e._allTiles.forAll((e=>{e.visible&&e.rendered&&dw.push(e)})),Object(tj.g)(e.renderOrder,dw),dw.toArray())}}};Object(i.a)([Object(j.b)()],iw.prototype,"_renderer",void 0),Object(i.a)([Object(j.b)()],iw.prototype,"_hasPendingUpdates",void 0),Object(i.a)([Object(j.b)()],iw.prototype,"_asyncWorkItems",void 0),Object(i.a)([Object(j.b)()],iw.prototype,"_allTilesDirty",void 0),Object(i.a)([Object(j.b)()],iw.prototype,"_allTilesSorted",void 0),Object(i.a)([Object(j.b)()],iw.prototype,"_viewChanged",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"_watchUpdatingTracking",void 0),Object(i.a)([Object(j.b)()],iw.prototype,"_frameTask",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"snapLevel",null),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"lodSnapping",null),Object(i.a)([Object(j.b)({constructOnly:!0})],iw.prototype,"view",void 0),Object(i.a)([Object(W.a)("_renderer.cullBackFaces")],iw.prototype,"cullBackFaces",void 0),Object(i.a)([Object(j.b)({readOnly:!0,dependsOn:[]})],iw.prototype,"extent",null),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"updating",null),Object(i.a)([Object(j.b)(yO.a)],iw.prototype,"updatingProgress",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"updatingProgressValue",null),Object(i.a)([Object(j.b)()],iw.prototype,"_maxNumUpdating",void 0),Object(i.a)([Object(j.b)({aliasOf:"view.map.ground.opacity"})],iw.prototype,"baseOpacity",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"overlayManager",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"viewingMode",null),Object(i.a)([Object(j.b)()],iw.prototype,"maxTextureScale",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"ready",null),Object(i.a)([Object(j.b)({value:1})],iw.prototype,"renderOrder",null),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"rootTiles",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"spatialReference",null),Object(i.a)([Object(j.b)()],iw.prototype,"backgroundImage",void 0),Object(i.a)([Object(j.b)({type:Tl.a,aliasOf:"view.map.ground.surfaceColor"})],iw.prototype,"backgroundColor",void 0),Object(i.a)([Object(j.b)()],iw.prototype,"_background",null),Object(i.a)([Object(j.b)({value:!1})],iw.prototype,"slicePlaneEnabled",null),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"tilingScheme",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],iw.prototype,"tilingSchemeLocked",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],iw.prototype,"tilingSchemeDone",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],iw.prototype,"tilingSchemeLogic",void 0),Object(i.a)([Object(j.b)({value:!0})],iw.prototype,"velvetOverground",null),Object(i.a)([Object(W.a)("_renderer.wireframe")],iw.prototype,"wireframe",void 0),Object(i.a)([Object(j.b)({value:!1})],iw.prototype,"suspended",null),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],iw.prototype,"textureFadeDuration",void 0),Object(i.a)([Object(j.b)()],iw.prototype,"_layerViewsDirty",void 0),Object(i.a)([Object(W.a)("_renderer.renderPatchBorders")],iw.prototype,"renderPatchBorders",void 0),Object(i.a)([Object(W.a)("_renderer.renderingDisabled")],iw.prototype,"renderingDisabled",void 0),iw=Object(i.a)([Object(w.a)("esri.views.3d.terrain.TerrainSurface")],iw);var nw=iw;function sw(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function aw(e){return!e.isLeaf&&(e.children[0].shouldLoad||e.children[1].shouldLoad||e.children[2].shouldLoad||e.children[3].shouldLoad||aw(e.children[0])||aw(e.children[1])||aw(e.children[2])||aw(e.children[3]))}const ow=-1,lw=Object(Ml.e)(),cw=Object(P.k)(),uw=[0,0,0],dw=new Wb.a,hw={spatialReference:null,tile:null,extent:null,context:"ground"},pw={spatialReference:null,extent:null,scale:0};var fw=nw,bw=r(106),mw=r(397),gw=r(331);let yw=class extends N.a{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach(((t,r)=>this.commitLayer(r,e)))}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach(((r,i)=>{const n=this._ensureGeomRecord(e,i);r.forEach(((e,r)=>{const s=e[0],a=e[1],o=e[2];let l=!1;if(2&a){const e=n.get(r);if(e){const r=e[1];if(4&o){const e=this.model.getObject(i);this.model.updateRenderGeometryTransformation(e,s,r)&&(l=!0)}l||t.updates.push({renderGeometry:r,updateType:o})}else Object(Oc.a)(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(4&a||l){const e=n.get(r);e?(t.removes.push(e[1]),n.delete(r),e[0].disposed&&gw.a.pool.release(e[0])):4===a&&Object(Oc.a)(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(1&a||l){const e=this.model.getObject(i),a=this.model.getRenderGeometry(e,s),o=[s,a];t.adds.push(a),n.set(r,o)}})),0===n.size&&this._residentGeomRecords.get(e).delete(i)})),0===this._residentGeomRecords.get(e).size&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach((e=>e.forEach((e=>t.push(e[1])))))}_objectStateChanged(e,t){for(const r of t.geometryRecords)this._updateOrCreateDirtyRecord(t,r,null,2,0,0,2,5,e)}visibilityChanged(e){this._objectStateChanged(1,e)}highlightChanged(e){this._objectStateChanged(8,e)}occlusionChanged(e){this._objectStateChanged(16,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,2,0,0,2,5,2)}layerAdded(e){e.objects.forAll((t=>this._layerObjectAdded(e,t)))}layerRemoved(e){e.objects.forAll((t=>this._layerObjectRemoved(e,t)))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const r=e.id,i=t.geometryRecords;for(let n=0;n<i.length;n++)this._objectGeometryAdded(t,i[n],r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const r=e.id,i=t.geometryRecords;for(let n=0;n<i.length;n++)this._objectGeometryRemoved(t,i[n],r)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach(((e,t)=>{const r=this.model.getObject(t);r&&r.hasVolativeTransformation()&&e.forEach((e=>{e[1].shaderTransformationChanged()}))}))}objectTransformation(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach((r=>{this._updateOrCreateDirtyRecord(e,r[0],t,2,0,0,2,5,4)}))}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,1,4,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,4,1,2,0,0)}_updateOrCreateDirtyRecord(e,t,r,i,n,s,a,o,l){r=Object(b.t)(r,this._getParentLayerId(e));const c=e.id,u=t.id,d=this._ensureDirtyRecord(r,c),h=d.get(u);if(h){const e=h[1];e&n?(d.delete(u),h[0].disposed&&gw.a.pool.release(h[0])):e&s?(h[1]=i,h[2]=l):e&a?h[2]|=l:e&o||Object(Oc.a)(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else d.set(u,[t,i,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}get _hasDirtyGeometryRecords(){return Object(Na.b)(this._dirtyGeomRecords,(e=>Object(Na.b)(e,(e=>e&&e.size>0))))}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}_getParentLayerId(e){return Object(b.j)(e.parentLayer)?e.parentLayer.id:rg.a}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach(((r,i)=>{r.forEach(((r,n)=>{t.length>0&&(t+="\n"),t+=i+"."+n;const s=[];r.forEach((e=>{const t=e[1];s[t]||(s[t]=[]),s[t].push(e[0].geometry.id)}));for(let i=0;i<s.length;i++)if(s[i]){t+=" "+e[i-1]+": ";for(let e=0;e<s[i].length;e++)t+=s[i][e]+", "}}))})),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce(((e,t)=>e+t.size),0)}}}};Object(i.a)([Object(j.b)({constructOnly:!0})],yw.prototype,"model",void 0),Object(i.a)([Object(j.b)()],yw.prototype,"dirty",void 0),yw=Object(i.a)([Object(w.a)("esri.views.3d.webgl-engine.lib.ModelDirtySet")],yw);var vw=yw,Ow=r(248);const jw=Oc.a,_w=Oc.h;let ww=class extends N.a{constructor(){super(),this.dirtySet=new vw({model:this}),this._id2origin=new Map,this._content=new Map}getObject(e){return this._content.get(e)}add(e){const t=e.id;jw(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),Object(lg.b)(e)&&this.dirtySet.layerAdded(e)}remove(e){jw(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),Object(lg.b)(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)jw(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t)}removeMany(e){for(const t of e)jw(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}forEachOfType(e,t){this._content.forEach((r=>{r.type===e&&t(r)}))}_getOrigin(e){let t=0;const r=10*e[3]/1e4;r>1&&(t=Math.ceil(_w(r,2)));const i=2**t*1e4,n=Math.round(e[0]/i),s=Math.round(e[1]/i),a=Math.round(e[2]/i),o=t+"_"+n+"_"+s+"_"+a;let l=this._id2origin.get(o);return null==l&&(l=Object(SO.a)(n*i,s*i,a*i,o),this._id2origin.set(o,l)),l}getRenderGeometry(e,t){const{geometry:r,material:i,id:n,shaderTransformation:s,origin:a,instanceParameters:o}=t,l=new Ow.a(r,i,null,null,n,r.boundingInfo,s,e.castShadow);return l.updateTransformation((r=>e.getCombinedStaticTransformation(t,r))),l.origin=a||this._getOrigin(l.boundingSphere),l.instanceParameters=o,l}updateRenderGeometryTransformation(e,t,r){r.updateTransformation((r=>e.getCombinedStaticTransformation(t,r)));const i=this._getOrigin(r.boundingSphere);return r.origin!==i}getStats(){const e={},t=Array.from(this._content.values());for(let r=0;r<5;++r)e[r]=t.filter((e=>e.type===r)).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};Object(i.a)([Object(j.b)({constructOnly:!0})],ww.prototype,"dirtySet",void 0),ww=Object(i.a)([Object(w.a)("esri.views.3d.webgl-engine.parts.Model")],ww);var xw=r(420),Sw=r(411),Tw=r(81);class Cw{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}componentCount(){const e=this._indexRanges;let t=0;for(let r=0;r<e.length;r+=2)t+=e[r+1];return t}reset(e){"all"===e||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=function(e){const t=new Array;if(0===e.length)return t;let r=e[0],i=1;for(let n=1;n<e.length;n++){const s=e[n];r+i===s?i+=1:(t.push(r),t.push(i),r=s,i=1)}return t.push(r),t.push(i),t}(e)}forEachComponent(e){const t=this._indexRanges;for(let r=0;r<t.length;r+=2){const i=t[r],n=i+t[r+1];for(let t=i;t<n;t++)if(!e(t))return!1}return!0}forEachComponentRange(e){const t=this._indexRanges;for(let r=0;r<t.length;r+=2){const i=t[r];if(!e(i,i+t[r+1]))return!1}return!0}computeOffsetRanges(e){const t=new Array(this._indexRanges.length),r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i],s=n+r[i+1],a=e[n],o=e[s];t[i]=a,t[i+1]=o-a}return t}}class Mw extends bw.a{constructor(e,t){super(),this.pickability=null,this.highlightCounts=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=Object(Tw.m)(t);const r=this.count;this.visibility=new Cw(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let i=0;i<r;i++)this.materialDataIndices[i]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return Object(b.i)(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return Object(b.i)(this.highlightCounts)?null:(this.updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return Object(b.i)(this.highlightCounts)?this.geometryRanges:(this.updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}updateCachedHighlightRanges(){if((Object(b.i)(this.cachedHighlightRanges)||Object(b.i)(this.cachedDefaultRanges))&&Object(b.j)(this.highlightCounts)){const{highlightRanges:e,defaultRanges:t}=function(e,t,r){const i=[],n=[];let s=r.length,a=r.length;return t.forEachComponent((t=>(e[t]>0?(s!==t-1&&(i.length&&i.push(r[s+1]-i[i.length-1]),i.push(r[t])),s=t):(a!==t-1&&(n.length&&n.push(r[a+1]-n[n.length-1]),n.push(r[t])),a=t),!0))),i.length&&i.push(r[s+1]-i[i.length-1]),n.length&&n.push(r[a+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=t}}}var Pw=Mw;class Aw extends bw.a{constructor(){super(...arguments),this._bucket=null,this._bucketIndex=0}get bucketKey(){return this._bucket.key}}class Ew{constructor(){this._buckets=new Map}add(e,t){const r=this._getBucket(e);t._bucket=r,t._bucketIndex=r.count,r.data.push(t),++r.statistics.added}remove(e){++e._bucket.statistics.removed;const t=e._bucket.data,r=t[t.length-1];t[e._bucketIndex]=r,r._bucketIndex=e._bucketIndex,t.pop(),e._bucket=null,e._bucketIndex=0}updateKey(e,t){this.remove(e),this.add(t,e)}getBucket(e){return this._getBucket(e).data}getPerformanceInfo(e){return this._getBucket(e).statistics}forEach(e){this._buckets.forEach((t=>e(t.data,t.key)))}get count(){let e=0;return this._buckets.forEach((t=>e+=t.count)),e}_getBucket(e){const t=this._buckets.get(e);if(t)return t;const r=new Rw(e);return this._buckets.set(e,r),r}}class Rw{constructor(e){this.key=e,this.data=new Array,this.statistics={added:0,removed:0}}get count(){return this.data.length}}class Iw extends Aw{get visible(){return!!(1&this.bucketKey)}}Object(i.a)([Object(bw.c)()],Iw.prototype,"renderable",void 0),Object(i.a)([Object(bw.c)()],Iw.prototype,"components",void 0);var Dw=Iw;const Fw=1e-6;class Lw{constructor(e,t,r,i,n){this.aabb=e,this.axis=t,this.d=r,this.midStartIndex=i,this.rightStartIndex=n}}class kw{constructor(e,t,r,i){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=t,this.positionAttribute=i,this.bspNodeTree=new Array,this.vertexPositionBuffer=i.data,this.vertexPositionStride=i.stride;const n=r-t,s=n<=Uw?new Uint16Array(n):new Uint32Array(n);this.indices=s;for(let a=0;a<n;++a)s[a]=a;{const a=function(e,t,r,i,n){const s=r-t,a=new Float32Array(6*s);for(let o=0;o<s;++o){const r=3*(o+t),s=e[r+0]*n,l=e[r+1]*n,c=e[r+2]*n;for(let e=0;e<3;++e){const t=i[s+e],r=i[l+e],n=i[c+e];a[6*o+e]=Math.min(t,r,n),a[6*o+3+e]=Math.max(t,r,n)}}return a}(e,t,r,i.data,i.stride),o=(e,t,r)=>{const i=function(e,t,r,i){if(i<=r)return Object(Vm.t)(NaN,NaN,NaN,NaN,NaN,NaN);{const i=6*e[r];for(let e=0;e<3;++e)Vw[e]=t[i+0+e],Nw[e]=t[i+3+e]}for(let n=r+1;n<i;++n){const r=6*e[n];for(let e=0;e<3;++e)Vw[e]=Math.min(Vw[e],t[r+0+e]),Nw[e]=Math.max(Nw[e],t[r+3+e])}return Object(Vm.t)(Vw[0],Vw[1],Vw[2],Nw[0],Nw[1],Nw[2])}(s,a,e,t),n=t-e;if(n<=20){const r=new Lw(i,void 0,0,e,t);return this.bspNodeTree.push(r),r}const{axis:l,midValue:c}=function(e){const t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2],n=t>r?t>i?0:r>i?1:2:r>i?1:i>t?2:0;return{axis:n,midValue:(e[n]+e[n+3])/2}}(i),u=function(e,t,r,i,n,s){let a=r,o=i;for(;a<o;){const r=e[a];t[6*r+n+3]<=s?++a:(--o,e[a]=e[o],e[o]=r)}let l=a;for(o=i;l<o;){const r=e[o-1];t[6*r+n]>=s?--o:(e[o-1]=e[l],e[l]=r,++l)}return{next:a,mid:l}}(s,a,e,t,l,c),d=(e,t)=>{if(r>15)return;const i=t-e;return i<20||i>=.8*n?void 0:o(e,t,r+1)},h=new Lw(i,l,c,u.next,u.mid);return this.bspNodeTree.push(h),h.leftNode=d(e,u.next),h.rightNode=d(u.mid,t),h};o(0,n,0),this.triangleVertexIndices=function(e,t,r,i){const n=i-r;let s=0;for(let o=r;o<i;++o)for(let e=0;e<3;++e)s=Math.max(t[3*o+e],s);const a=s<=Uw?new Uint16Array(3*n):new Uint32Array(3*n);for(let o=0;o<n;++o){const i=3*(e[o]+r);for(let e=0;e<3;++e){const r=t[i+e];a[3*o+e]=r}}return a}(s,e,t,r)}}intersectRayTriangleRange(e,t){{if(e>=t)return;const r=this.triangleVertexIndices,i=this.positionAttribute.data,n=this.positionAttribute.stride,s=this.rayOrigin,a=s[0],o=s[1],l=s[2],c=this.rayDirection,u=c[0],d=c[1],h=c[2];for(let p=e,f=3*e;p<t;++p){const e=r[f]*n,t=i[e],s=i[e+1],c=i[e+2],b=r[f+1]*n,m=i[b],g=i[b+1],y=i[b+2],v=r[f+2]*n,O=i[v],j=i[v+1],_=i[v+2];f+=3;const w=m-t,x=g-s,S=y-c,T=O-t,C=j-s,M=_-c,P=d*M-C*h,A=h*T-M*u,E=u*C-T*d,R=w*P+x*A+S*E;if(Math.abs(R)<=Number.EPSILON)continue;const I=a-t,D=o-s,F=l-c,L=I*P+D*A+F*E;if(R>0){if(L<0||L>R)continue}else if(L>0||L<R)continue;const k=D*S-x*F,z=F*w-S*I,V=I*x-w*D,N=u*k+d*z+h*V;if(R>0){if(N<0||L+N>R)continue}else if(N>0||L+N<R)continue;const U=(T*k+C*z+M*V)/R;if(U>=0){const e=this.indices[p]+this.firstTriangleIndex,t=Object(zO.d)(w,x,S,T,C,M,zw);this.callback(U,t,e)}}}kw.numFacesTested+=t-e}intersectRay(e,t){kw.numFacesTested=0;const r=Object(S.g)(e.r0[0],e.r0[1],e.r0[2]),i=function(e,t){const r=Object(S.e)();return Object(Cl.C)(r,e,t),r}(Object(S.g)(e.r1[0],e.r1[1],e.r1[2]),r);if(Object(Cl.v)(i)<Fw)return;this.rayOrigin=r,this.rayDirection=i;const n=this.triangleVertexIndices.length/3;this.callback=t;const s=this.bspNodeTree[0];this.intersectRayBSP(s,0,n)}intersectRayBSP(e,t,r){const i=this.rayOrigin,n=this.rayDirection;if(!function(e,t,r){const i=t,n=r;let s=0,a=1/0;for(let o=0;o<3;++o){{const t=e[o];if(i[o]<t){if(n[o]<=Fw)return!1;const e=(t-i[o])/n[o];s=Math.max(s,e)}else if(n[o]<=-1e-6){const e=(t-i[o])/n[o];a=Math.min(a,e)}if(s>=a)return!1}{const t=e[o+3];if(i[o]>t){if(n[o]>=-1e-6)return!1;const e=(t-i[o])/n[o];s=Math.max(s,e)}else if(n[o]>=Fw){const e=(t-i[o])/n[o];a=Math.min(a,e)}if(s>=a)return!1}}return!0}(e.aabb,i,n))return;const s=e.axis,a=e.d;if(i[s]<a||n[s]<0){const r=t,i=e.midStartIndex;if(r<i){const t=e.leftNode;void 0!==t?this.intersectRayBSP(t,r,i):this.intersectRayTriangleRange(r,i)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),i[s]>a||n[s]>0){const t=e.rightStartIndex,i=r;if(t<i){const r=e.rightNode;void 0!==r?this.intersectRayBSP(r,t,i):this.intersectRayTriangleRange(t,i)}}}}kw.numFacesTested=0;const zw=Object(S.e)(),Vw=Object(S.g)(1/0,1/0,1/0),Nw=Object(S.g)(-1/0,-1/0,-1/0);const Uw=65535;function Bw(e,t,r,i){if(r>=t)return e;null==e&&(e=function(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}());const n=e.isVisibleBit;let s=e.data;const a=qw(s),o=r/a|0,l=r-a*o,c=(t-1)/a|0,u=s,d=i===n;if(!(r<u.length*a)&&d){const e=1.5,t=o+1,r=Math.ceil(u.length*e),i=c+1;let n=Math.max(t,r);n=Math.min(n,i),s=new Uint32Array(n),s.set(u)}return o<s.length&&(s[o]=function(e,t,r){return e&~(1<<t)|(r?1:0)<<t}(s[o],l,d)),e.data=s,e}function Gw(e,t){if(null==e)return!0;const{isVisibleBit:r,data:i}=e,n=qw(i);return t<i.length*n?function(e,t,r,i){const n=r/i|0,s=r-n*i;return function(e,t){return 0!=(e&1<<t)}(t[n],s)===e}(r,i,t,n):!e.isVisibleBit}function qw(e){return 8*e.BYTES_PER_ELEMENT}var Hw=r(136);const Ww=Object(S.e)(),$w=Object(Vm.h)();var Qw=class{constructor(e,t){this._indices=Object(b.j)(e.indices)?e.indices:Object(Hw.d)(e.positions.length/3),this._positions=new Dj.u(e.positions),this._components=t,this._componentIntersectionData=new Array(t.count)}getComponentAabb(e,t){if(Object(b.j)(this._perComponentAabbs)){for(let r=0;r<6;r++)t[r]=this._perComponentAabbs[6*e+r];return t}return this._computePerComponentAabbs(),this.getComponentAabb(e,t)}getComponentPositions(e,t){t.indices=this._indices,t.data=this._positions.typedBuffer,t.stride=this._positions.typedBufferStride,t.startIndex=this._components.offsets[e],t.endIndex=this._components.offsets[e+1]}intersect(e,t,r,i,n,s){const a={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},o=this._indices,l=this._components.offsets,c=Object(zO.c)(e,t,Ww);this._components.visibility.forEachComponent((u=>{if(!Gw(this._components.pickability,u))return!0;const d=this.getComponentAabb(u,$w);if(Object(b.j)(n)&&n.applyToAabb(d),!Object(zO.f)(d,e,c,r))return!0;const h=l[u]/3,p=l[u+1]/3,f=(e,t,r)=>{s(u,e,Object(Cl.z)(t,t,i),r)},m=p-h;return Object(b.i)(n)&&m>40?(null==this._componentIntersectionData[u]&&(this._componentIntersectionData[u]=new kw(this._indices,h,p,a)),this._componentIntersectionData[u].intersectRay({r0:e,r1:t},f)):Object(zO.j)(e,t,h,p,o,a,void 0,n,f),!0}))}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);for(let t=0;t<e;t++)this._computeAABB(t)}_computeAABB(e){const t=this._indices,r=this._positions,i=this._components.offsets,n=i[e],s=i[e+1],a=[0,0,0],o=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(let u=n;u<s;u++){const e=t[u];r.getVec(e,a),Object(Cl.a)(o,o,a),Object(Cl.b)(l,l,a)}let c=6*e;this._perComponentAabbs[c++]=o[0],this._perComponentAabbs[c++]=o[1],this._perComponentAabbs[c++]=o[2],this._perComponentAabbs[c++]=l[0],this._perComponentAabbs[c++]=l[1],this._perComponentAabbs[c]=l[2]}get positions(){return this._positions}get indices(){return this._indices}};class Zw{constructor(e,t,r,i){this.material=e,this.drawParameters=t,this.geometry=r,this.meta=i}dispose(){this.material.dispose(),this.geometry.dispose()}}class Xw extends bw.a{constructor(e,t,r,i){super(),this.primitiveType=t,this.parameters=r,this.indexed=i,this.vao=e}}function Jw(e){return e?Yw(e,1/0,-1/0):function(e,t){return{near:e,far:t}}(1/0,-1/0)}function Yw(e,t,r){return e.near=t,e.far=r,e}function Kw(e,t,r=e){return r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}function ex(e,t){return e.near<=t&&t<=e.far}Object(i.a)([Object(bw.c)()],Xw.prototype,"vao",void 0);const tx={near:0,far:0};const rx=new Wb.a({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),ix=Jw(),nx=Object(S.e)(),sx=Object(S.e)(),ax=new Wb.a({deallocator:null}),ox=new Wb.a({deallocator:null});function lx(e,t,r){r.length=0;const i=t.length-3;cx(nx,t,i);const n=Object(Uh.w)(e,nx);n<=0&&(r.push(nx[0]),r.push(nx[1]),r.push(nx[2]));let s=0,a=n;for(;s<i;s+=3){cx(sx,t,s);const i=Object(Uh.w)(e,sx);a*i<0&&(Object(Cl.k)(nx,sx,nx,i/(i-a)),ux(r,nx)),i<=0&&ux(r,sx),a=i,Object(Cl.m)(nx,sx)}a*n<0&&(cx(sx,t,i),Object(Cl.k)(nx,sx,nx,n/(n-a)),ux(r,nx))}function cx(e,t,r){return Object(Cl.y)(e,t.data[r+0],t.data[r+1],t.data[r+2])}function ux(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function dx(e,t,r,i){Object(xh.b)(mx,e.quaternion),Object(Cl.C)(gx,t,e.center),Object(Cl.w)(gx,gx,mx);const n=8*((gx[0]<-e.halfSize[0]?-1:gx[0]>e.halfSize[0]?1:0)+3*(gx[1]<-e.halfSize[1]?-1:gx[1]>e.halfSize[1]?1:0)+9*(gx[2]<-e.halfSize[2]?-1:gx[2]>e.halfSize[2]?1:0)+13),s=hx[n];if(0===s)return s;Object(Dd.h)(bx,e.quaternion),Object(Dd.d)(bx,bx,e.halfSize);const a=(t,r)=>{const i=hx[n+r+1];return Object(Cl.y)(t,((1&i)<<1)-1,(2&i)-1,((4&i)>>1)-1),Object(Cl.z)(t,t,bx),Object(Cl.h)(t,e.center,t)};return r.length=0,ux(r,a(yx,0)),ux(r,a(vx,1)),ux(r,a(gx,2)),ux(r,a(Ox,3)),i(r),1===s||(r.length=0,ux(r,yx),ux(r,Ox),ux(r,a(gx,4)),ux(r,a(jx,5)),i(r),2===s||(r.length=0,ux(r,yx),ux(r,jx),ux(r,a(gx,6)),ux(r,vx),i(r))),s}const hx=(()=>{const e=new Int8Array(216);let t=0;const r=r=>{for(let i=0;i<r.length;i++)e[t+i]=r[i];t+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),e})(),px=4;function fx(e,t){let r=0;for(let i=0;i<px;i++){const n=Object(Sw.g)(e,t[i]);if(n>0)return-1;0===n&&(r|=1<<i)}return r}const bx=Object(Fd.b)(),mx=Object(Sh.b)(),gx=Object(S.e)(),yx=Object(S.e)(),vx=Object(S.e)(),Ox=Object(S.e)(),jx=Object(S.e)();class _x{constructor(e){this._objects=e}submit(e,t){this._objects.preSubmit(t);const r=this._objects.visibleObjects;for(let i=0;i<r.length;i++){const t=r[i];t.renderable.material.submit(e,t)}}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?function(e,t){const r=Jw(),{eye:i,frustum:n,viewForward:s}=e;for(let a=0;a<t.length;a++){const e=t[a].obb,o=Object(Cl.j)(Object(Cl.C)(gx,e.center,i),s),l=Object(Sw.k)(e,s);if(ex(r,o-l)&&ex(r,o+l))continue;const c=fx(e,n);if(-1===c)continue;if(0===c){ix.far=o+l,ix.near=o-l,Kw(r,ix);continue}const u=rx.pushNew();u.near=o-l,u.far=o+l,u.mask=c,u.object=t[a]}for(let a=0;a<rx.length;a++){const e=rx.data[a];ex(r,e.near)&&ex(r,e.far)||(ix.far=e.far,ix.near=1/0,0===dx(e.object.obb,i,ax,(t=>{let r=ox;for(let i=0;i<px&&t.length>0;i++){if(0==(e.mask&1<<i))continue;lx(n[i],t,r);const s=t;t=r,r=s}for(let e=0;e<t.length;e+=3){Object(Cl.y)(nx,t.data[e+0],t.data[e+1],t.data[e+2]);const r=Object(Cl.j)(Object(Cl.C)(nx,nx,i),s);ix.near=Math.min(ix.near,r)}}))&&(ix.near=0),Kw(r,ix))}return rx.length=0,r}(e,this._objects.visibleObjects):null}}var wx=r(597),xx=r(58),Sx=r(462),Tx=r(132),Cx=r(96),Mx=r(262),Px=r(216),Ax=r(75);class Ex extends Dl.a{bindPass(e){const t=this.program;Tx.a.bindViewProjTransform(t,e.viewTransform),Object(D_.b)(this.program,this.configuration,e.slicePlane),0===e.identifier&&(void 0!==e.ssrParams&&Object(F_.b)(this.program,e.ssrParams),t.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",e.transformNormal_ViewFromGlobal),2===e.subPass&&t.setUniform2fv("cameraNearFar",e.cameraNearFar),0===e.subPass&&e.lighting.setUniforms(this.program,e.integratedMesh)),1===e.identifier&&this.program.setUniform2fv("cameraNearFar",e.cameraNearFar)}bindMaterial(e,t){const r=this.program;r.setUniform4fv("uBaseColor",e.baseColor),r.setUniform1f("uObjectOpacity",e.objectOpacity),r.setUniform1f("textureAlphaCutoff",e.alphaCutoff),1===e.componentParameters.type?e.componentParameters.texture.bind(r,"uComponentColorTex","uComponentColorTexInvDim"):(r.setUniform4fv("uExternalColor",e.componentParameters.externalColor),r.setUniform1i("uExternalColorMixMode",e.componentParameters.externalColorMixMode)),Object(b.j)(e.baseColorTexture)&&e.baseColorTexture.bind(r,"uBaseColorTexture","uBaseColorTextureSize"),0!==this.configuration.output&&7!==this.configuration.output||(Object(Mx.c)(this.program,e,this.configuration.isSchematic),Object(b.j)(e.metallicRoughnessTexture)&&e.metallicRoughnessTexture.bind(r,"texMetallicRoughness","texMetallicRoughnessSize"),Object(b.j)(e.emissionTexture)&&e.emissionTexture.bind(r,"texEmission","texEmissionSize"),Object(b.j)(e.occlusionTexture)&&e.occlusionTexture.bind(r,"texOcclusion","texOcclusionSize"),Object(b.j)(e.normalTexture)&&e.normalTexture.bind(r,"normalTexture","normalTextureSize")),e.isIntegratedMesh&&(0===t.identifier&&0===t.subPass?(r.bindTexture(e.overlayColor,"ovColorTex"),r.bindTexture(e.overlayNormal,"ovNormalTex")):2===t.identifier&&r.bindTexture(e.overlayHighlight,"ovColorTex"),r.setUniform1f("overlayOpacity",1)),2===t.identifier&&Object(Cx.b)(this.program,t),0===t.identifier&&0===t.subPass&&(t.ambientOcclusionEnabled&&t.bindAmbientOcclusion(r),t.shadowsEnabled&&t.bindShadowMap(r)),0!==t.identifier||0!==t.subPass&&1!==t.subPass||!t.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("cameraNearFar",t.cameraNearFar),r.setUniform2fv("inverseViewport",t.inverseViewport),t.multipassTerrainParams.terrainLinearDepthTexture&&r.bindTexture(t.multipassTerrainParams.terrainLinearDepthTexture,"terrainDepthTexture"))}bindDraw(e,t){if(Tx.a.bindModelTransform(this.program,e),this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",e.transformNormal_GlobalFromModel),this.program.rebindTextures(),t.isIntegratedMesh){const r=t.overlayTexScale,i=t.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[e.toMapSpace[0]*r[0]+i[0],e.toMapSpace[1]*r[1]+i[1],e.toMapSpace[0]*r[2]+i[2],e.toMapSpace[1]*r[3]+i[3]]),this.program.setUniform4fv("overlayTexScale",[e.toMapSpace[2]*r[0],e.toMapSpace[3]*r[1],e.toMapSpace[2]*r[2],e.toMapSpace[3]*r[3]])}}initializeProgram(e){const t=Ex.shader.get(),r=this.configuration,i=t.build({multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround,OITEnabled:0===r.transparencyPassType,output:r.output,normalType:0===r.integratedMeshMode?r.hasNormals?1:3:2,attributeColor:r.hasVertexColors,attributeTextureCoordinates:r.vertexTextureCoordinates,componentData:r.componentData,alphaDiscardMode:r.alphaDiscardMode,baseColorTexture:r.baseColorTexture,doubleSidedMode:r.doubleSidedMode,receiveAmbientOcclusion:r.receiveAmbientOcclusion,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:e.viewingMode,vertexDiscardMode:r.vertexDiscardMode,pbrMode:3===r.integratedMeshMode?4:r.usePBR?r.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,vertexTangents:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:Object(Px.b)(e.rctx),overlayEnabled:2===r.integratedMeshMode||3===r.integratedMeshMode,ssrEnabled:r.ssrEnabled,highStepCount:!1,ellipsoidMode:r.ellipsoidMode});return new kl.a(e.rctx,i,t.attributeLocations)}setPipelineState(e){const t=this.configuration,r=0!==t.integratedMeshMode,i=3===e,n=2===e;return Object(zl.g)({blending:0!==t.output&&7!==t.output||!t.blendingEnabled?null:i?Ax.f:Object(Ax.a)(e),culling:Object(zl.c)(t.cullFace),depthTest:{func:Object(Ax.b)(e)},depthWrite:i||n?zl.e:null,colorWrite:zl.d,stencilWrite:r||t.sceneHasOcludees?k_.j:null,stencilTest:r?Object(k_.d)(1):t.sceneHasOcludees?k_.e:null,polygonOffset:i||n?t.polygonOffsetEnabled?{factor:2,units:2}:null:Ax.d})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}Ex.shader=new Il.a(Sx.a,(()=>r.e(178).then(r.bind(null,1061))));class Rx extends Tx.a.ModelTransform{constructor(){super(...arguments),this.transformNormal_GlobalFromModel=Object(Fd.b)(),this.toMapSpace=Object(Ml.e)()}}class Ix extends Fl.a{constructor(){super(...arguments),this.output=0,this.hasVertexColors=!1,this.hasNormals=!1,this.vertexTextureCoordinates=0,this.componentData=0,this.slicePlaneEnabled=!1,this.cullFace=2,this.baseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.vertexDiscardMode=0,this.doubleSidedMode=2,this.blendingEnabled=!0,this.alphaDiscardMode=1,this.integratedMeshMode=0,this.ssrEnabled=!1,this.polygonOffsetEnabled=!1,this.usePBR=!1,this.isSchematic=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.ellipsoidMode=1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(i.a)([Object(Fl.b)({count:8})],Ix.prototype,"output",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"hasVertexColors",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"hasNormals",void 0),Object(i.a)([Object(Fl.b)({count:3})],Ix.prototype,"vertexTextureCoordinates",void 0),Object(i.a)([Object(Fl.b)({count:2})],Ix.prototype,"componentData",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"slicePlaneEnabled",void 0),Object(i.a)([Object(Fl.b)({count:3})],Ix.prototype,"cullFace",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"baseColorTexture",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"receiveAmbientOcclusion",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"receiveShadows",void 0),Object(i.a)([Object(Fl.b)({count:3})],Ix.prototype,"vertexDiscardMode",void 0),Object(i.a)([Object(Fl.b)({count:3})],Ix.prototype,"doubleSidedMode",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"blendingEnabled",void 0),Object(i.a)([Object(Fl.b)({count:4})],Ix.prototype,"alphaDiscardMode",void 0),Object(i.a)([Object(Fl.b)({count:4})],Ix.prototype,"integratedMeshMode",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"ssrEnabled",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"polygonOffsetEnabled",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"usePBR",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"isSchematic",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"hasEmissionTexture",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"hasOcclusionTexture",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"hasNormalTexture",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"sceneHasOcludees",void 0),Object(i.a)([Object(Fl.b)({count:4})],Ix.prototype,"transparencyPassType",void 0),Object(i.a)([Object(Fl.b)({count:4})],Ix.prototype,"ellipsoidMode",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"multipassTerrainEnabled",void 0),Object(i.a)([Object(Fl.b)()],Ix.prototype,"cullAboveGround",void 0);class Dx{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Fx(e={}){return(t,r)=>{var i;const n=null!=(i=t._parameterCount)?i:0;if(t._parameterCount=n+1,e.vectorOps){const i=e.vectorOps;Object.defineProperty(t,r,{get(){return this[n]},set(e){const t=this[n];if(null==t)this[n]=e;else{if(i.equals(t,e))return;i.copy(t,e)}this._setDirty()}})}else Object.defineProperty(t,r,{get(){return this[n]},set(t){this[n]!==t&&(e.dispose&&this[n]&&this[n].dispose(),this[n]=t,this._setDirty())}})}}function Lx(){return(e,t)=>{var r;const i=null!=(r=e._parameterCount)?r:0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(e){this[i]!==e&&(this[i]=e,this._setDirty())}})}}var kx=r(95);class zx extends class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,null!=this._parameterBlocks)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==this._parameterBlocks)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}}{constructor(){super(...arguments),this.baseColor=Object(Ky.c)(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Object(xx.d)(1,1,.5),this.emissiveFactor=Object(xx.d)(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.overlayTexOffset=Object(Ml.g)(-1,-1,-1,-1),this.overlayTexScale=Object(Ml.g)(0,0,0,0),this.overlayColor=null,this.overlayHighlight=null,this.overlayNormal=null,this.objectOpacity=1,this.commonMaterialParameters=new Vx,this.componentParameters=new Nx,this.alphaCutoff=kx.b,this.alphaDiscardMode=1,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=1,this.sceneHasOcludees=!1,this._techniqueConfig=new Ix}dispose(){this._technique=Object(b.q)(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}getTechnique(e,t,r){const i=this._techniqueConfig;if(i.hasVertexColors=r.colors,i.hasNormals=r.normals,i.vertexTextureCoordinates=r.textureCoordinates,i.usePBR=this.usePBR,i.hasMetalnessAndRoughnessTexture=Object(b.j)(this.metallicRoughnessTexture),i.hasEmissionTexture=Object(b.j)(this.emissionTexture),i.hasOcclusionTexture=Object(b.j)(this.occlusionTexture),i.hasNormalTexture=Object(b.j)(this.normalTexture),i.transparencyPassType=0===t.identifier&&null!=t.transparencyPassType?t.transparencyPassType:3,i.multipassTerrainEnabled=0===t.identifier&&null!=t.multipassTerrainParams&&t.multipassTerrainParams.multipassTerrainEnabled,i.cullAboveGround=0===t.identifier&&null!=t.multipassTerrainParams&&t.multipassTerrainParams.cullAboveGround,i.ellipsoidMode=this.ellipsoidMode,this.dirty){i.componentData=this.componentParameters.type,i.cullFace=this.commonMaterialParameters.cullFace,i.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,i.baseColorTexture=Object(b.j)(this.baseColorTexture),i.isSchematic=this.hasParametersFromSource&&!Object(b.j)(this.baseColorTexture);const e=this._computeWhichMaterialPass();i.blendingEnabled=1===e||2===e,i.alphaDiscardMode=this.alphaDiscardMode,i.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.overlayNormal?3:2:1:0,i.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean()}return i.slicePlaneEnabled=t.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled,1===t.identifier?(i.output=3,i.vertexDiscardMode=0):2===t.identifier?(i.output=4,i.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?i.vertexDiscardMode=t.transparent?2:1:i.vertexDiscardMode=0,i.output=function(e){switch(e){case 0:return 0;case 1:return 7;case 2:return 1;case 3:return 2;case 4:return 8}}(t.subPass),1===t.subPass&&(i.sceneHasOcludees=t.sceneHasOcludees),0===t.subPass?(i.receiveAmbientOcclusion=t.ambientOcclusionEnabled,i.sceneHasOcludees=t.sceneHasOcludees,i.receiveShadows=t.shadowsEnabled,i.ssrEnabled=t.ssrParams.ssrEnabled):(i.receiveAmbientOcclusion=!1,i.receiveShadows=!1)),this._technique=e.releaseAndAcquire(Ex,i,this._technique),this._technique}submit(e,t){if(0===this.objectOpacity)return;const r=t.renderable.geometry,i=t.components,n=t.renderable.drawParameters,s=t.renderable.meta.cameraDepthSquared,a=i.geometryRanges,o=i.highlightRanges,l=i.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case 0:e.materialOpaque.submitDraw(this,r,a,n,s);break;case 1:e.materialTransparent.submitDraw(this,r,a,n,s);break;case 2:e.materialOpaque.submitDraw(this,r,a,n,s),e.materialTransparent.submitDraw(this,r,a,n,s);break;case 3:e.materialIntegratedMesh.submitDraw(this,r,a,n,s),this.overlayHighlight&&e.highlightIntegratedMesh.submitDraw(this,r,a,n,s)}Object(b.j)(e.shadowMap)&&2!==this.componentParameters.castShadows&&e.shadowMap.submitDraw(this,r,a,n,s),Object(b.j)(e.highlight)&&Object(b.j)(o)&&e.highlight.submitDraw(this,r,o,n,s),Object(b.j)(e.highlightShadowMap)&&2!==this.componentParameters.castShadows&&Object(b.j)(o)&&e.highlightShadowMap.submitDraw(this,r,o,n,s),Object(b.j)(e.defaultShadowMap)&&2!==this.componentParameters.castShadows&&Object(b.j)(l)&&e.defaultShadowMap.submitDraw(this,r,l,n,s)}get attributeLocations(){return Sx.b}_computeWhichMaterialPass(){return this.isIntegratedMesh?3:this.objectOpacity<1?1:0===this.componentParameters.opaqueOverride?0:this.baseColor[3]<1||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2}}Object(i.a)([Fx({vectorOps:rc.n})],zx.prototype,"baseColor",void 0),Object(i.a)([Fx()],zx.prototype,"usePBR",void 0),Object(i.a)([Fx()],zx.prototype,"hasParametersFromSource",void 0),Object(i.a)([Fx({vectorOps:Cl.c})],zx.prototype,"mrrFactors",void 0),Object(i.a)([Fx({vectorOps:Cl.c})],zx.prototype,"emissiveFactor",void 0),Object(i.a)([Fx({dispose:!0})],zx.prototype,"baseColorTexture",void 0),Object(i.a)([Fx({dispose:!0})],zx.prototype,"metallicRoughnessTexture",void 0),Object(i.a)([Fx({dispose:!0})],zx.prototype,"emissionTexture",void 0),Object(i.a)([Fx({dispose:!0})],zx.prototype,"occlusionTexture",void 0),Object(i.a)([Fx({dispose:!0})],zx.prototype,"normalTexture",void 0),Object(i.a)([Fx({vectorOps:{equals:rc.g,copy:rc.c}})],zx.prototype,"overlayTexOffset",void 0),Object(i.a)([Fx({vectorOps:{equals:rc.g,copy:rc.c}})],zx.prototype,"overlayTexScale",void 0),Object(i.a)([Fx()],zx.prototype,"overlayColor",void 0),Object(i.a)([Fx()],zx.prototype,"overlayHighlight",void 0),Object(i.a)([Fx()],zx.prototype,"overlayNormal",void 0),Object(i.a)([Fx()],zx.prototype,"objectOpacity",void 0),Object(i.a)([Lx()],zx.prototype,"commonMaterialParameters",void 0),Object(i.a)([Lx()],zx.prototype,"componentParameters",void 0),Object(i.a)([Fx()],zx.prototype,"alphaCutoff",void 0),Object(i.a)([Fx()],zx.prototype,"alphaDiscardMode",void 0),Object(i.a)([Fx()],zx.prototype,"isIntegratedMesh",void 0),Object(i.a)([Fx()],zx.prototype,"polygonOffsetEnabled",void 0),Object(i.a)([Fx()],zx.prototype,"ellipsoidMode",void 0),Object(i.a)([Fx()],zx.prototype,"sceneHasOcludees",void 0);class Vx extends Dx{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=2,this.slicePlaneEnabled=!0}}Object(i.a)([Fx()],Vx.prototype,"doubleSided",void 0),Object(i.a)([Fx()],Vx.prototype,"cullFace",void 0),Object(i.a)([Fx()],Vx.prototype,"slicePlaneEnabled",void 0);class Nx extends Dx{constructor(){super(...arguments),this.externalColor=Object(Ky.c)(1,1,1,1),this.externalColorMixMode=1,this.castShadows=0}get transparent(){return this.externalColor[3]<1?0:2}get opaqueOverride(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2}get visible(){return this.externalColor[3]>0?0:2}get type(){return 0}}Object(i.a)([Fx({vectorOps:rc.n})],Nx.prototype,"externalColor",void 0),Object(i.a)([Fx()],Nx.prototype,"externalColorMixMode",void 0),Object(i.a)([Fx()],Nx.prototype,"castShadows",void 0);class Ux extends Dx{constructor(){super(...arguments),this.texture=null,this.transparent=2,this.opaqueOverride=2,this.castShadows=2}get type(){return 1}}Object(i.a)([Fx()],Ux.prototype,"texture",void 0),Object(i.a)([Fx()],Ux.prototype,"transparent",void 0),Object(i.a)([Fx()],Ux.prototype,"opaqueOverride",void 0),Object(i.a)([Fx()],Ux.prototype,"castShadows",void 0);class Bx{constructor(e){this._low=Object(xx.c)(),this._high=Object(xx.c)(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const t=this._low,r=this._high;Object(Cl.m)(t,e),Object(Cl.C)(r,e,t)}setElements(e,t,r){Object(Cl.y)(Gx,e,t,r),this.set(Gx)}get(e){return Object(Cl.h)(e,this._low,this._high)}getLowScaled(e){return Object(Cl.g)(e,this._low,1)}}const Gx=Object(S.e)();class qx{constructor(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this.recycledIndices.push(e)}}class Hx{constructor(e,t=1){this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new $l.a(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new Dj.J(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(e,t,r,i,n,s){const a=e*this.fieldCount+t;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,i),this.data.set(a,2,n),this.data.set(a,3,s)}setDataElement(e,t,r,i){const n=e*this.fieldCount+t;this.dirty=!0,this.data.set(n,r,i)}resizeToFit(e){const t=e*this.fieldCount;if(t>=this.data.count){const e=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,r=new Dj.J(new ArrayBuffer(4*e));r.typedBuffer.set(this.data.typedBuffer),this.data=r}}updateTexture(){if(!this.dirty)return;const e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(e,t,r){e.bindTexture(this.texture,t),e.setUniform2f(r,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}class Wx{constructor(e,t=1){this.textureBuffer=new Hx(e,t),this.indexManager=new qx(65536)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const e=this.indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this.indexManager.release(e)}}class $x{constructor(e,t=1){this.rctx=e,this.fieldCount=t,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter((e=>0!==e.activeCount||(e.dispose(),!1)))}destroy(){this.buffers.forEach((e=>e.dispose())),this.buffers=[]}getBuffer(e){for(const r of this.buffers)if(r.availableCount>=e)return r;if(e>65536)return null;const t=new Wx(this.rctx,this.fieldCount);return this.buffers.push(t),t}updateTextures(){for(const e of this.buffers)e.textureBuffer.updateTexture()}}const Qx=f.a.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Zx{constructor(e){this._renderManager=e,this._objects=new Ew,this._renderSubmit=new _x(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new $x(e.rctx)}dispose(){Object(Oc.a)(0===this._objects.count,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const t=new Dw;return t.toMapSpace=e.toMapSpace.slice(),t.transform=e.transform,t.obb=Object(Sw.b)(e.obb),t.components=new Pw(this._componentBufferManager,e.geometry.componentOffsets),t.renderable=this._createRenderable(e,t.components),t.intersectionGeometry=new Qw(e.geometry.positionData,t.components),this._objects.add(e.visible?1:0,t),t}destroyObject(e){const t=e;this._objects.remove(t),t.dispose(),this._notifyDirty()}setObjectVisibility(e,t){const r=e;if(t!==r.visible){const e=t?1|r.bucketKey:-2&r.bucketKey;this._objects.updateKey(r,e),this._notifyDirty()}}preSubmit(e){const t=e.camera.eye;this._objects.forEach(((e,r)=>{1&r&&e.forEach((e=>{const r=Object(Cl.n)(t,e.obb.center);e.renderable.meta.cameraDepthSquared=r}))}))}getMaterial(e){return e.renderable.material}updateMaterial(e,t){const r=e.renderable.material;t(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,t){const r=e;r.components.visibility.reset(t),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,t){return e.components.visibility.forEachComponent(t)}getComponentCount(e){const t=e,r=t.components.visibility.componentCount();return{visible:r,invisible:t.components.count-r}}setComponentData(e,t){const r=e,i=r.renderable.material;if("function"==typeof t){const e=r.components,n=e.materialDataBuffer,s=e.materialDataIndices,a={castShadows:!0,pickable:!0,externalColor:Object(Ky.b)(),externalColorMixMode:1},o=n.textureBuffer,l=new Uint8Array(4),c=new Uint32Array(l.buffer);let u=0,d=0,h=0,p=!1,f=0;for(let r=0;r<e.count;r++)t(r,a),u+=+(a.externalColor[3]<1),d+=+(3===a.externalColorMixMode&&1===a.externalColor[3]),h+=+a.castShadows,Object(xw.a)(a.externalColor,a.externalColorMixMode,l),l[2]=254&l[2]|+a.castShadows,o.setData(s[r],0,l[0],l[1],l[2],l[3]),p=p||r>0&&f!==c[0],f=c[0],a.pickable!==Gw(e.pickability,r)&&(e.pickability=Bw(e.pickability,e.count,r,a.pickable));p?(i.componentParameters=new Ux,i.componentParameters.castShadows=Jx(h,e.count),i.componentParameters.transparent=Jx(u,e.count),i.componentParameters.opaqueOverride=Jx(d,e.count),i.componentParameters.texture=o,o.updateTexture()):(i.componentParameters=new Nx,i.componentParameters.castShadows=a.castShadows?0:2,i.componentParameters.externalColor=a.externalColor,i.componentParameters.externalColorMixMode=a.externalColorMixMode)}else i.componentParameters=new Nx,i.componentParameters.castShadows=t.castShadows?0:2,i.componentParameters.externalColor=t.externalColor,i.componentParameters.externalColorMixMode=t.externalColorMixMode;this._notifyDirty()}getComponentAabb(e,t,r){return e.intersectionGeometry.getComponentAabb(t,r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,t,r){return e.intersectionGeometry.getComponentPositions(t,r)}intersect(e,t,r,i,n,s){const a=e;Object(b.j)(n)&&(n.localOrigin=a.transform.position);const o=Object(Dd.e)(Yx,a.transform.rotationScale);Object(Cl.C)(Kx,t,a.transform.position),Object(Cl.C)(eS,r,a.transform.position),Object(Cl.z)(Kx,Kx,o),Object(Cl.z)(eS,eS,o);const l=Object(Dd.n)(Yx,o);return a.intersectionGeometry.intersect(Kx,eS,i,l,n,s)}addEdges(e,t,r,i){const n=e,{indices:s,positions:a}=n.intersectionGeometry,o=n.components.offsets;return t.addComponentObject(e,n.transform,n.obb.center,a,s,o,r,i)}addComponentHighlight(e,t){const r=e.components;Object(b.i)(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),0===r.highlightCounts[t]++&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,t){const r=e.components;if(Object(b.i)(r.highlightCounts))return void Qx.warn("Removing non-existing highlight.");const i=r.highlightCounts[t],n=r.highlightCounts[r.count];if(0!==i){if(i>1)return r.highlightCounts[t]=i-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[t]=0,r.highlightsDirty(),this._notifyDirty(),1===n?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else Qx.warn("Removing non-existing highlight.")}clearHighlights(e){const t=e.components;Object(b.j)(t.highlightCounts)&&(t.highlightCounts=null,t.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects.getBucket(1)}get performanceInfo(){const e=this._objects.getPerformanceInfo(1);return{shown:e.added,hidden:e.removed}}_createRenderable(e,t){const r=this._renderManager.rctx,i=e.geometry,n=i.vertices.layoutParameters,s=Wl.a.createVertex(r,35044,i.vertices.data),a=Object(b.c)(i.indices,(e=>Wl.a.createIndex(r,35044,e))),o=Object(Bl.a)(Object(wx.a)(n)),l=new Uint16Array(i.vertices.count);for(let y=0;y<t.count;y++){const e=t.offsets[y],r=t.offsets[y+1],n=t.materialDataIndices[y];if(Object(b.j)(i.indices))for(let t=e;t<r;t++)l[i.indices[t]]=n;else for(let t=e;t<r;t++)l[t]=n}const c=Wl.a.createVertex(r,35044,l.buffer),u=new Bx(e.transform.position),d=Object(Wj.a)(e.transform.rotationScale);Object(Dd.e)(d,d),Object(Dd.n)(d,d);const h=new Rx;Object(Cl.m)(h.worldFromModel_TL,u.low),Object(Cl.m)(h.worldFromModel_TH,u.high),Object(Dd.g)(h.worldFromModel_RS,e.transform.rotationScale),Object(Dd.g)(h.transformNormal_GlobalFromModel,d),Object(rc.c)(h.toMapSpace,e.toMapSpace);const p=new zx,f=new Zl.a(r,p.attributeLocations,{data:o,componentIndices:Xx},{data:s,componentIndices:c},Object(b.s)(a)),m=new Xw(f,4,n,Object(b.j)(a)),g={cameraDepthSquared:.5,gpuMemoryEstimate:s.byteSize+c.byteSize+(Object(b.j)(a)?a.byteSize:0)};return new Zw(p,h,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}}const Xx=Object(Bl.a)(Object(Gl.a)().u16("componentIndex"));function Jx(e,t){return e===t?0:0===e?2:1}const Yx=Object(Wj.b)(),Kx=Object(S.e)(),eS=Object(S.e)();var tS=r(516),rS=r(620);class iS extends Dl.a{initializeProgram(e){const t=iS.shader.get().build(this.configuration);return new kl.a(e.rctx,t,Ll.a)}initializePipeline(){if(1===this.configuration.function)return Object(zl.g)({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return Object(zl.g)({colorWrite:zl.d});case 1:return Object(zl.g)({blending:Object(zl.h)(770,1,771,771),colorWrite:zl.d});default:return Object(zl.g)({blending:Object(zl.i)(1,771),colorWrite:zl.d})}}}iS.shader=new Il.a(rS.a,(()=>r.e(188).then(r.bind(null,1062))));class nS extends Fl.a{constructor(){super(...arguments),this.function=0,this.alphaMode=0,this.hasOpacityFactor=!1}}Object(i.a)([Object(Fl.b)({count:4})],nS.prototype,"function",void 0),Object(i.a)([Object(Fl.b)({count:3})],nS.prototype,"alphaMode",void 0),Object(i.a)([Object(Fl.b)()],nS.prototype,"hasOpacityFactor",void 0);const sS=new nS;var aS=class{constructor(e,t){this._rctx=e,this._techniqueRepository=t}dispose(){this._vao=Object(b.f)(this._vao)}compositeTransparent(e,t,r,i=1){const n=this._rctx;sS.alphaMode=1,sS.function=2,sS.hasOpacityFactor=1!==i;const s=this._techniqueRepository.acquire(iS,sS);n.useProgram(s.program),s.bindPipelineState(n),s.program.bindTexture(e,"colorTexture"),s.program.bindTexture(t,"alphaTexture"),s.program.bindTexture(r,"frontFaceTexture");const a=this.ensureVAO();n.bindVAO(a),n.drawArrays(5,0,Object(Ql.f)(a,"geometry")),s.release()}compositeSpecial(e,t){this.composite(e,0,1,t)}composite(e,t=0,r=1,i=0,n=0){const s=this._rctx;sS.alphaMode=t,sS.function=i,sS.hasOpacityFactor=1!==r;const a=this._techniqueRepository.acquire(iS,sS);s.useProgram(a.program),a.bindPipelineState(s),a.program.bindTexture(e,"tex"),sS.hasOpacityFactor&&a.program.setUniform1f("opacity",r),3===i&&a.program.setUniform1i("overlayIdx",n);const o=this.ensureVAO();s.bindVAO(o),s.drawArrays(5,0,Object(Ql.f)(o,"geometry")),a.release()}ensureVAO(){return Object(b.i)(this._vao)&&(this._vao=Object(vc.d)(this._rctx)),this._vao}};function oS(e,t,r){return Object(Oc.n)(t,e)*(r[1]-r[0])+r[0]}function lS(e,t,r){if(t.size<1e4)return gS.compute(e,t);const i=Jw();return r.forAll((t=>{t.isVisible&&Kw(i,function(e,t){if(!t.isVisible)return;const r=Jw(),i=t.getSpatialQueryAccelerator();return Object(b.j)(i)?function(e,t,r){const i=t.eye,n=t.viewForward,s=t.frustum,a=e=>e.isVisible,o=r.objectCount;if(o<500)Yw(bS,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,n,1,bS,((r,i)=>{cS(e,t,r),bS.far=e.near,i.setRange(bS)}),s,a),Yw(bS,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,n,-1,bS,((r,i)=>{cS(e,t,r),bS.near=e.far,i.setRange(bS)}),s,a);else{const i=Math.max(Math.min(o,500),Math.ceil(.1*o)),l=r.findClosest(n,1,s,a,i),c=r.findClosest(n,-1,s,a,i);l&&c&&(dS(e,t,l.boundingVolumeWorldSpace.bounds),dS(e,t,c.boundingVolumeWorldSpace.bounds))}}(r,e,i):function(e,t,r){mS.clear(),r.forAll((e=>{e.isVisible&&0!==e.getNumGeometryRecords()&&mS.add(e)})),mS.empty||(mS.sort(t),Yw(bS,t.near,Math.min(e.near,t.far)),mS.forEachInDepthRange(bS,1,((r,i)=>{i<e.near&&cS(e,t,r)})),Yw(bS,Math.max(e.far,t.near),t.far),mS.forEachInDepthRange(bS,-1,((t,r,i)=>{e.far=Math.max(e.far,i)})))}(r,e,t.objects),r}(e,t))})),i}function cS(e,t,r){if(!r.isVisible)return;if(!Object(xg.j)(t.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,n=fS;r.geometryRecords.forEach((r=>{Object(Pl.m)(n,i,r.getShaderTransformation());const s=Object(Xo.i)(n);uS(e,t,r.geometry.boundingInfo,n,s)}))}function uS(e,t,r,i,n){if(Object(b.i)(r))return;const s=t.eye,a=t.viewForward;Object(Cl.s)(pS,r.center,i);const o=a[0]*(pS[0]-s[0])+a[1]*(pS[1]-s[1])+a[2]*(pS[2]-s[2]);if(pS[3]=r.radius*n,!(o-pS[3]>e.near&&o+pS[3]<e.far)&&Object(xg.j)(t.frustum,pS))if(r.radius>100&&r.getChildren()){const s=r.getChildren();for(let r=0;r<8;++r)s[r]&&uS(e,t,s[r],i,n)}else yS.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function dS(e,t,r){const i=t.eye,n=t.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];e.near=Math.min(e.near,s-r[3]),e.far=Math.max(e.far,s+r[3])}const hS=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],pS=Object(pu.c)(),fS=Object(Al.d)(),bS=Jw(),mS=new class{constructor(){this._items=new Wb.a({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const t=e.eye,r=e.viewForward;this._items.forAll((e=>{const i=e.obj.boundingVolumeWorldSpace.bounds,n=(i[0]-t[0])*r[0]+(i[1]-t[1])*r[1]+(i[2]-t[2])*r[2];e.distance=n,e.near=n-i[3],e.far=n+i[3]})),this._items.sort(((e,t)=>e.distance-t.distance))}forEachInDepthRange(e,t,r){if(1===t)for(let i=0;i<this._items.length;++i){const t=this._items.data[i];t.far<e.near||t.near>e.far||r(t.obj,t.near,t.far)}else for(let i=this._items.length-1;i>=0;--i){const t=this._items.data[i];t.far<e.near||t.near>e.far||r(t.obj,t.near,t.far)}}},gS=new class{constructor(){this.view=Object(Al.d)(),this.viewProj=Object(Al.d)(),this.frustum=Object(xg.c)(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(e,t){this.reset(),Object(Pl.d)(this.view,e.viewMatrix),Object(Pl.m)(this.viewProj,e.projectionMatrix,this.view),Object(xg.b)(e.frustum,this.frustum);const r=this.view,i=r[2],n=r[6],s=r[10],a=r[14],o=this.range;let l=0;if(t.forEach((e=>{if(!e.instanceParameters.visible)return;if(!e.castShadow)return;let t;e.hasShaderTransformation?(e.computeBoundingSphere(e.getShaderTransformation(),pS,1),t=pS):t=e.boundingSphere;const r=i*t[0]+n*t[1]+s*t[2]+a,o=r-t[3],c=r+t[3];this.geometries[l]=e,this.near[l]=-c,this.far[l]=-o,++l})),0===this.geometries.length)return o;for(let h=0;h<this.geometries.length;++h)this.near[h]>o.far&&(o.far=this.near[h]),this.near[h]>2&&this.far[h]<o.near&&(o.near=this.far[h]);const c=this.looseRange;c.near=Math.max(.5*o.near,2),c.far=2*o.far;let u=0,d=0;for(let h=0;h<this.geometries.length;++h)this.near[h]<o.near&&(this.near[h]>=c.near?o.near=this.near[h]:this.nearCandidates[u++]=h),this.far[h]>o.far&&(this.far[h]<=c.far?o.far=this.far[h]:this.farCandidates[d++]=h);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return o;this.nearCandidates.sort(((e,t)=>this.near[e]<this.near[t]?-1:this.near[e]>this.near[t]?1:0)),this.farCandidates.sort(((e,t)=>this.far[e]<this.far[t]?1:this.far[e]>this.far[t]?-1:0));for(let h=0;h<this.nearCandidates.length;++h){const e=this.nearCandidates[h];if(this.near[e]<o.near){const t=this.geometries[e],r=t.boundingInfo;this.includeNearBoundingInfoRec(r,t.getShaderTransformation())}}for(let h=0;h<this.farCandidates.length;++h){const e=this.farCandidates[h];if(this.far[e]>o.far){const t=this.geometries[e],r=t.boundingInfo;this.includeFarBoundingInfoRec(r,t.getShaderTransformation())}}return o}reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}includeNearBoundingInfoRec(e,t){if(Object(b.i)(e))return;const r=e.getCenter();Object(Cl.s)(pS,r,t);const i=Object(Xo.i)(t),n=pS[0],s=pS[1],a=pS[2],o=e.getBSRadius()*i,l=this.frustum;if(l[0][0]*n+l[0][1]*s+l[0][2]*a+l[0][3]>o||l[1][0]*n+l[1][1]*s+l[1][2]*a+l[1][3]>o||l[2][0]*n+l[2][1]*s+l[2][2]*a+l[2][3]>o||l[3][0]*n+l[3][1]*s+l[3][2]*a+l[3][3]>o)return;const c=this.view[2]*n+this.view[6]*s+this.view[10]*a+this.view[14],u=c+o;if(!(-(c-o)<2||-u>=this.range.near))if(-u>this.looseRange.near)this.range.near=-u;else{if(o>100){const r=e.getChildren();if(void 0!==r){for(let e=0;e<8;++e)void 0!==r[e]&&this.includeNearBoundingInfoRec(r[e],t);return}}yS.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}includeFarBoundingInfoRec(e,t){if(Object(b.i)(e))return;let r=e.getBSRadius();const i=e.getCenter();Object(Cl.s)(pS,i,t);const n=Object(Xo.i)(t),s=pS[0],a=pS[1],o=pS[2];r*=n;const l=this.frustum;if(l[0][0]*s+l[0][1]*a+l[0][2]*o+l[0][3]>r||l[1][0]*s+l[1][1]*a+l[1][2]*o+l[1][3]>r||l[2][0]*s+l[2][1]*a+l[2][2]*o+l[2][3]>r||l[3][0]*s+l[3][1]*a+l[3][2]*o+l[3][3]>r)return;const c=this.view[2]*s+this.view[6]*a+this.view[10]*o+this.view[14]-r;if(!(-c<=this.range.far))if(-c<this.looseRange.far)this.range.far=-c;else{if(r>100){const r=e.getChildren();if(void 0!==r){for(let e=0;e<8;++e)void 0!==r[e]&&this.includeFarBoundingInfoRec(r[e],t);return}}yS.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},yS=new class{constructor(){this.modelViewProj=Object(Al.d)(),this.clipPosition=[Object(Ml.e)(),Object(Ml.e)(),Object(Ml.e)(),Object(Ml.e)(),Object(Ml.e)(),Object(Ml.e)(),Object(Ml.e)(),Object(Ml.e)()]}unionDepthRangeWithAABB(e,t,r,i,n){const s=this.modelViewProj;Object(Pl.m)(s,t,r);let a=!1;for(let o=0;o<8;++o){const e=this.clipPosition[o],t=0===o||3===o||4===o||7===o?i[0]:n[0],r=0===o||1===o||4===o||5===o?i[1]:n[1],a=o<4?i[2]:n[2];e[0]=s[0]*t+s[4]*r+s[8]*a+s[12],e[1]=s[1]*t+s[5]*r+s[9]*a+s[13],e[2]=s[2]*t+s[6]*r+s[10]*a+s[14],e[3]=s[3]*t+s[7]*r+s[11]*a+s[15]}for(let o=0;o<12;++o){const t=this.clipPosition[hS[o][0]],r=this.clipPosition[hS[o][1]],i=this.clipPosition[hS[o][2]],n=this.clipTriangle(t,r,i);let s=!0;for(let e=0;e<n.length;++e)if(n[e][3]>=2){s=!1;break}if(!s){a=!0;for(let t=0;t<n.length;++t){const r=n[t][3];r<e.near&&(e.near=r),r>e.far&&(e.far=r)}}}return a}inside(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void Object(Oc.a)(!1)}intersect(e,t,r){let i=0;return 0===r?i=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?i=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?i=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(i=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),Object(rc.j)(Object(Ml.e)(),e,t,i)}clipTriangle(e,t,r){let i=[e,t,r];for(let n=0;n<4;++n){const e=i;i=[];for(let t=0;t<e.length;++t){const r=e[t],s=e[(t+1)%e.length];this.inside(s,n)?(this.inside(r,n)||i.push(this.intersect(r,s,n)),i.push(s)):this.inside(r,n)&&i.push(this.intersect(r,s,n))}}return i}};var vS=r(535),OS=r(6),jS=r(73);let _S=class extends N.a{constructor(){super(...arguments),this._handles=new F.a,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this.events=new zi.a,this.attributeLocations=new Map([["position",0]]),this.tmpScreenPoint=Object(O.f)(),this.tmpRenderPoint=Object(O.c)()}get updating(){return Object(b.i)(this._imageSources)&&Object(b.j)(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this.updateResourceLoading(),this.events.emit("request-render")};Object(b.j)(this._magnifier)&&this._handles.add(this._magnifier.watch("version",t)),t()}get enabled(){return Object(b.j)(this._validMagnifier)}get _validMagnifier(){return Object(b.j)(this._magnifier)&&this._magnifier.visible&&Object(b.j)(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return Object(b.j)(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),Object(b.j)(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this.disposeResources()}render(e,t){const r=this._validMagnifier;if(Object(b.i)(r))return;const i=t.camera.pixelRatio,n=Math.ceil(i*r.size);if(this.updateResources(e,n),Object(b.i)(this._resources))return;const s=this._resources.program;e.useProgram(s);const a=this._resources.textures,o=Math.ceil(1/this.factor*n);a.input.resize(o,o);const l=t.camera.fullWidth,c=t.camera.fullHeight;Object(O.i)(r.position,this.tmpScreenPoint);const u=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),d=.5*o,h=.5*o;u[0]=Object(Bt.e)(u[0],d,l-d-1),u[1]=Object(Bt.e)(u[1],h,c-h-1);const p=Math.floor(u[0]-d),f=Math.floor(u[1]-h);s.bindTexture(a.input,"textureInput"),e.gl.copyTexImage2D(a.input.descriptor.target,0,a.input.descriptor.pixelFormat,p,f,o,o,0);const m=r.offset.x*i,g=r.offset.y*i,y=(u[0]+m)/l*2-1,v=(u[1]-g)/c*2-1,j=n/l*2,_=n/c*2;e.bindVAO(this._resources.vao),s.bindTexture(a.overlay,"textureOverlay"),s.bindTexture(a.mask,"textureMask"),s.setUniform4f("drawPosition",y,v,j,_),s.setUniform1i("maskEnabled",r.maskEnabled?1:0),s.setUniform1i("overlayEnabled",r.overlayEnabled?1:0),e.setPipelineState(this._resources.pipelineState),e.drawArrays(5,0,4)}updateResourceLoading(){const e=this._validMagnifier;if(Object(b.i)(e))return;const t=e.maskUrl,i=e.overlayUrl;!Object(b.j)(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),Object(b.j)(this._imageSources)||Object(b.j)(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:Object(m.i)((async e=>{const n=Object(b.i)(t)||Object(b.i)(i)?async function(e){const t=r.e(209).then(r.bind(null,1063)),i=r.e(210).then(r.bind(null,1064)),n=Object(El.a)((await t).default,{signal:e}),s=Object(El.a)((await i).default,{signal:e}),a={mask:await n,overlay:await s};return Object(m.x)(e),a}(e):null,s=Object(b.j)(t)?Object(El.a)(t,{signal:e}):n.then((e=>e.mask)),a=Object(b.j)(i)?Object(El.a)(i,{signal:e}):n.then((e=>e.overlay));this._imageSources={mask:await s,overlay:await a},this.disposeResources(),this.events.emit("request-render")}))},this._imageLoadTask.task.promise.then((()=>this.notifyChange("updating")),(()=>this.notifyChange("updating"))))}updateResources(e,t){if(!this.enabled)return void this.disposeResources();if(Object(b.j)(this._resources)){if(this._resources.textures.size!==t){const r=this.createTextureResources(e,t);if(Object(b.i)(r))return void this.disposeResources();this.disposeTextureResources(this._resources.textures),this._resources.textures=r}return}const r=this.createTextureResources(e,t);Object(b.i)(r)||(this._resources={textures:r,program:this.createProgram(e),vao:Object(vc.d)(e,P_.a,this.attributeLocations,0,1),pipelineState:Object(zl.g)({blending:Object(zl.i)(1,771),depthTest:null,depthWrite:null,colorWrite:zl.d})})}disposeResources(){Object(b.i)(this._resources)||(this.disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}createTextureResources(e,t){if(Object(b.i)(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const r=new $l.a(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0,preMultiplyAlpha:!Object(Sv.x)(this._imageSources.overlay.src)||!Object(Cv.b)(e).svgAlwaysPremultipliesAlpha},this._imageSources.overlay),i=new $l.a(e,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},this._imageSources.mask);return{input:new $l.a(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1}),mask:i,overlay:r,size:t}}createProgram(e){const t=function(){const e=new jS.a;return e.attributes.add("position","vec2"),e.vertex.uniforms.add("proj","mat4"),e.vertex.uniforms.add("drawPosition","vec4"),e.varyings.add("vUV","vec2"),e.vertex.code.add(OS.a`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add("textureInput","sampler2D"),e.fragment.uniforms.add("textureMask","sampler2D"),e.fragment.uniforms.add("textureOverlay","sampler2D"),e.fragment.uniforms.add("maskEnabled","bool"),e.fragment.uniforms.add("overlayEnabled","bool"),e.fragment.code.add(OS.a`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}();return new kl.a(e,t,this.attributeLocations)}};Object(i.a)([Object(j.b)()],_S.prototype,"_imageSources",void 0),Object(i.a)([Object(j.b)()],_S.prototype,"_imageLoadTask",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],_S.prototype,"updating",null),_S=Object(i.a)([Object(w.a)("esri/views/3d/webgl-engine/lib/MagnifierHelper")],_S);class wS{constructor(e,t=.9){this._alpha=.9,this._startTime=0,this._count=0,this._sum=0,this._smooth=0,this._min=0,this._max=0,this._name=e,this._alpha=t,this.reset()}reset(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0}get name(){return this._name}get count(){return this._count}get average(){return this._count>0?this._sum/this._count:0}get smooth(){return this._smooth}get min(){return this._min}get max(){return this._max}begin(){this._startTime=performance.now()}end(){const e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)}toJSON(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}}}!function(e){const t={},r={};function i(r){return r in t||(t[r]=new e(r)),t[r]}function n(e){console.log(i(e).toJSON())}e.get=i,e.begin=function(e){i(e).begin()},e.end=function(e,t=!0){i(e).end();const s=performance.now();t&&(!(e in r)||s>=r[e]+1e3)&&(n(e),r[e]=s)},e.log=n,e.logAll=function(){for(const e in t)n(e)}}(wS||(wS={}));var xS=wS;class SS{constructor(){this.identifier=0,this.transparent=!1,this.integratedMesh=!1,this.viewTransform=new Tx.a.ViewProjectionTransform,this.transformNormal_ViewFromGlobal=Object(Fd.b)(),this.cameraNearFar=Object(tc.b)(),this.inverseViewport=Object(tc.b)(),this.slicePlane=Object(A.b)(),this.slicePlaneEnabled=!0,this.ambientOcclusionEnabled=!0,this.shadowsEnabled=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3}}class TS{constructor(){this.identifier=1,this.viewTransform=new Tx.a.ViewProjectionTransform,this.cameraNearFar=Object(tc.b)(),this.slicePlane=Object(A.b)()}}class CS{constructor(){this.identifier=2,this.viewTransform=new Tx.a.ViewProjectionTransform,this.slicePlane=Object(A.b)(),this.inverseViewport=Object(tc.b)(),this.viewport=Object(Ml.e)()}}class MS{constructor(e,t,r=0){this._rctx=e,this._techniqueRepository=t,this._sorting=r,this._draws=new Wb.a({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._passBoundTechniques=new Set,this._previouslyBoundMaterials=new Map,this._previouslyBoundDraw=new Map}submitDraw(e,t,r,i,n){const s=this._draws.pushNew();s.geometry=t,s.geometryRanges=r,s.material=e,s.bindDrawParams=i,s.depthSquaredHint=n,s.indexType=t.indexed?Object(b.s)(t.vao.indexBuffer).indexType:0}dispatch(e){const t=this._rctx;this._passBoundTechniques.clear(),this._previouslyBoundMaterials.clear(),this._previouslyBoundDraw.clear();let r=null;const i=this._draws.length;for(let n=0;n<i;n++){const i=this._draws.data[n],s=i.geometry,a=i.material.getTechnique(this._techniqueRepository,e,s.parameters);a===r&&3===a.configuration.transparencyPassType||(t.useProgram(a.program),t.setPipelineState(a.pipeline),r=a),this._passBoundTechniques.has(a)||(a.bindPass(e),this._passBoundTechniques.add(a)),t.bindVAO(s.vao),this._previouslyBoundMaterials.get(a)!==i.material&&(a.bindMaterial(i.material,e),this._previouslyBoundMaterials.set(a,i.material)),this._previouslyBoundDraw.get(a)!==i.bindDrawParams&&(a.bindDraw(i.bindDrawParams,i.material,e),this._previouslyBoundDraw.set(a,i.bindDrawParams));const o=i.geometryRanges,l=o.length;if(0!==i.indexType){const e=PS.get(i.indexType);for(let r=0;r<l;r+=2){const n=o[r],a=o[r+1];t.drawElements(s.primitiveType,a,i.indexType,n*e)}}else for(let e=0;e<l;e+=2){const r=o[e],i=o[e+1];t.drawArrays(s.primitiveType,r,i)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=0===this._sorting?1:-1;this._draws.sort(((t,r)=>{const i=e*(t.depthSquaredHint-r.depthSquaredHint);return 0!==i?i:t.geometry.vao.size-r.geometry.vao.size}))}get count(){return this._draws.length}}const PS=new Map;PS.set(5121,1),PS.set(5123,2),PS.set(5125,4);class AS{constructor(e,t){this.rctx=e,this.shaderTechniqueRepository=t,this.canRender=!0,this._materialPassParams=new SS,this._shadowPassParams=new TS,this._highlightPassParams=new CS,this._systems=new Set,this._passes=new Array,this._shadowMapPass=this._registerPass(new MS(e,this.shaderTechniqueRepository)),this.passes={materialOpaque:this._registerPass(new MS(e,this.shaderTechniqueRepository)),materialTransparent:this._registerPass(new MS(e,this.shaderTechniqueRepository,1)),materialIntegratedMesh:this._registerPass(new MS(e,this.shaderTechniqueRepository)),shadowMap:this._shadowMapPass,highlight:this._registerPass(new MS(e,this.shaderTechniqueRepository)),highlightIntegratedMesh:this._registerPass(new MS(e,this.shaderTechniqueRepository)),highlightShadowMap:this._registerPass(new MS(e,this.shaderTechniqueRepository)),defaultShadowMap:this._registerPass(new MS(e,this.shaderTechniqueRepository))}}register(e){this._systems.add(e)}prepareRender(e){0!==this._systems.size&&(this._passes.forEach((e=>e.prepareSubmit())),this._systems.forEach((t=>t.submit(this.passes,{camera:e}))),this._passes.forEach((e=>e.finishSubmit())),this.shaderTechniqueRepository.frameUpdate())}render(e){if(0===this._systems.size)return!1;if(4===e.slot)switch(this._configure(e),e.pass){case 0:this._materialPassParams.subPass=0,this._configureMaterialColorPass(e),this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=3,this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 5:this.passes.highlight.dispatch(this._highlightPassParams);break;case 4:this._shadowMapPass.dispatch(this._shadowPassParams);break;case 7:Object(b.j)(this.passes.highlightShadowMap)&&this.passes.highlightShadowMap.dispatch(this._shadowPassParams);break;case 6:Object(b.j)(this.passes.defaultShadowMap)&&this.passes.defaultShadowMap.dispatch(this._shadowPassParams)}if(6===e.slot)switch(this._configure(e),e.pass){case 0:this._materialPassParams.subPass=0,this._configureMaterialColorPass(e),this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1,this._configureMaterialColorPass(e),this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=3,this.passes.materialTransparent.dispatch(this._materialPassParams)}if(1===e.slot)switch(this._configure(e),e.pass){case 0:this._materialPassParams.subPass=0,this._configureMaterialColorPass(e),this._materialPassParams.ssrParams=e.ssrParams,this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=3,this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 5:this.passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return!0}notifyDirty(){this.context.requestRender()}slots(){return[4,6,1]}initializeRenderContext(e){this.context=e}uninitializeRenderContext(){}queryDepthRange(e){const t={near:1/0,far:-1/0};return this._systems.forEach((r=>{const i=r.queryShadowCasterDepthRange(e);Object(b.j)(i)&&Kw(t,i,t)})),t}get shadowCastingEnabled(){return Object(b.j)(this.passes.shadowMap)}set shadowCastingEnabled(e){e?(this._materialPassParams.shadowsEnabled=!0,this.passes.shadowMap=this._shadowMapPass):(this._materialPassParams.shadowsEnabled=!1,this.passes.shadowMap=null)}get screenSpaceReflectionsEnabled(){return Object(b.j)(this._materialPassParams.ssrParams.ssrEnabled)}set screenSpaceReflectionsEnabled(e){this._materialPassParams.ssrParams.ssrEnabled=!!e}_configureMaterialColorPass(e){this._materialPassParams.bindShadowMap=t=>{e.shadowMap.bind(t);const r=this._materialPassParams.viewTransform;Object(Cl.h)(ES,r.worldFromView_TL,r.worldFromView_TH),e.shadowMap.bindView(t,ES)},this._materialPassParams.bindAmbientOcclusion=t=>e.ssaoHelper.bind(t),this._materialPassParams.ambientOcclusionEnabled=!!e.ssaoHelper&&e.ssaoHelper.ready,this._materialPassParams.sceneHasOcludees=e.hasOccludees}_configure(e){const t=4===e.pass||7===e.pass||6===e.pass?this._shadowPassParams:5===e.pass?this._highlightPassParams:this._materialPassParams;this._updateParameters(e,t)}_updateParameters(e,t){const r=e.camera,i=r.viewInverseTransposeMatrix;Object(Cl.y)(ES,i[3],i[7],i[11]),IS.set(ES),Object(Cl.m)(t.viewTransform.worldFromView_TH,IS.high),Object(Cl.m)(t.viewTransform.worldFromView_TL,IS.low),Object(Dd.f)(t.viewTransform.viewFromCameraRelative_RS,r.viewMatrix),Object(Pl.d)(t.viewTransform.projFromView,r.projectionMatrix),0===t.identifier?(this._materialPassParams.transparent=6===e.slot,this._materialPassParams.integratedMesh=1===e.slot,this._materialPassParams.lighting=e.scenelightingData,Object(Dd.n)(RS,t.viewTransform.viewFromCameraRelative_RS),Object(Dd.e)(t.transformNormal_ViewFromGlobal,RS),Object(ec.r)(t.cameraNearFar,r.near,r.far)):1===t.identifier?Object(ec.r)(t.cameraNearFar,r.near,r.far):2===t.identifier&&(t.highlightDepthTexture=e.highlightDepthTexture,Object(rc.c)(t.viewport,r.fullViewport)),0!==t.identifier&&2!==t.identifier||(t.inverseViewport[0]=1/r.fullViewport[2],t.inverseViewport[1]=1/r.fullViewport[3]),Object(A.e)(e.sliceHelper.plane,t.slicePlane),Object(Cl.l)(t.slicePlane.origin,t.slicePlane.origin,ES),t.slicePlaneEnabled=e.sliceHelper.isEnabled,this._materialPassParams.transparencyPassType=e.transparencyPassType,this._materialPassParams.multipassTerrainParams=e.multipassTerrainParams}_registerPass(e){return this._passes.push(e),e}get needsHighlight(){return this.passes.highlight.count>0||this.passes.highlightIntegratedMesh.count>0}}const ES=Object(S.e)(),RS=Object(Fd.b)(),IS=new Bx;var DS=r(513),FS=r(621);class LS extends Dl.a{initializeProgram(e){const t=LS.shader.get().build(this.configuration);return new kl.a(e.rctx,t,Ll.a)}bindApplyPass(e){this.program.setUniform4fv("color",e.color),this.program.setUniform4fv("haloColor",e.haloColor),this.program.setUniform1f("outlineSize",8.6),this.program.setUniform1f("blurSize",.4),this.program.setUniform4f("opacities",e.haloOpacity,e.haloOpacityOccluded,e.fillOpacity,e.fillOpacityOccluded)}initializePipeline(){return 1===this.configuration.highlightStage?Object(zl.g)({blending:Object(zl.h)(770,1,771,771),colorWrite:zl.d}):Object(zl.g)({colorWrite:zl.d})}get primitiveType(){return this.configuration.gridOptimization?4:5}}LS.shader=new Il.a(FS.a,(()=>r.e(191).then(r.bind(null,1065))));class kS extends Fl.a{constructor(){super(...arguments),this.highlightStage=0,this.gridOptimization=!1}}Object(i.a)([Object(Fl.b)({count:3})],kS.prototype,"highlightStage",void 0),Object(i.a)([Object(Fl.b)()],kS.prototype,"gridOptimization",void 0);var zS=class{constructor(e,t){this._techniqueRep=e,this._rctx=t,this.viewportToRestore=Object(Ml.e)(),this.defaultOptions={color:Object(Ky.c)(1,0,1,1),haloColor:Object(Ky.c)(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05,shadowColor:Object(Ky.c)(1,0,1,1),shadowOpacity:.15,occludedShadowOpacity:.075},this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}assertResources(){if(this.quadVAO)return;this.quadVAO=Object(vc.d)(this._rctx);const e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new Vj.a(this._rctx,e,t),this.blur1Fbo=new Vj.a(this._rctx,e,t);const r=new kS;r.highlightStage=0,r.gridOptimization=!1,this.blurTechnique=this._techniqueRep.acquire(LS,r),r.highlightStage=0,r.gridOptimization=!0,this.blurGridTechnique=this._techniqueRep.acquire(LS,r),r.highlightStage=1,r.gridOptimization=!1,this.applyTechnique=this._techniqueRep.acquire(LS,r),r.highlightStage=1,r.gridOptimization=!0,this.applyGridTechnique=this._techniqueRep.acquire(LS,r),r.highlightStage=2,r.gridOptimization=!1,this.downsampleTechnique=this._techniqueRep.acquire(LS,r)}dispose(){if(this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=Object(b.f)(this.blur0Fbo),this.blur1Fbo=Object(b.f)(this.blur1Fbo)}get profilingCallback(){return $b.a.HIGHLIGHTS_PROFILE_TO_CONSOLE?e=>console.log(e):null}setDefaultOptions(e){this.defaultOptions=e}render(e,t,r){const i=e.pixelRatio,n=$b.a.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED,s=this._rctx;this.assertResources(),Object(rc.c)(this.viewportToRestore,e.fullViewport);const a=e.fullWidth,o=e.fullHeight,l=Math.ceil(a/i),c=Math.ceil(o/i);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c),s.bindVAO(this.quadVAO);let u=null;const d=n?this.blurGridTechnique:this.blurTechnique;d.bindPipelineState(s),s.useProgram(d.program),n?(this._gridUpdateResources(t,32),this._gridComputeMipmap(),u=this._grid.vao,d.program.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex")):u=this.quadVAO,s.bindVAO(u),s.bindFramebuffer(this.blur0Fbo),s.setViewport(0,0,l,c),s.setClearColor(0,0,0,0),s.clear(16384),d.program.bindTexture(t.colorTexture,"tex"),d.program.setUniform2f("blurSize",1/l,0),s.drawArrays(d.primitiveType,0,Object(Ql.f)(u,"geometry")),s.bindFramebuffer(this.blur1Fbo),s.clear(16384),d.program.bindTexture(this.blur0Fbo.colorTexture,"tex"),d.program.setUniform2f("blurSize",0,1/c),s.drawArrays(d.primitiveType,0,Object(Ql.f)(u,"geometry"));const h=n?this.applyGridTechnique:this.applyTechnique;if(s.bindFramebuffer(r),h.bindPipelineState(s),s.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),s.useProgram(h.program),h.program.bindTexture(this.blur1Fbo.colorTexture,"tex"),h.program.bindTexture(t.colorTexture,"origin"),n){const e=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;h.program.bindTexture(e,"coverageTex")}h.bindApplyPass(this.defaultOptions),s.drawArrays(h.primitiveType,0,Object(Ql.f)(u,"geometry")),s.bindVAO(null)}_gridUpdateResources(e,t){const r=this._rctx,i=this._grid;let n=!1;if(null===i.coverageMipmap&&(i.coverageMipmap=[e],n=!0),i.viewportWidth===e.width&&i.viewportHeight===e.height||(n=!0,i.viewportWidth=e.width,i.viewportHeight=e.height),i.coverageMipmap[0]=e,i.cellPixelSize!==t&&(i.cellPixelSize=t,n=!0),n){for(let e=1;e<i.coverageMipmap.length;e++)i.coverageMipmap[e].dispose();i.mipmapLevels=Math.ceil(Math.log(i.cellPixelSize)*Math.LOG2E),i.coverageMipmap.length=i.mipmapLevels+1;for(let e=0;e<i.mipmapLevels;e++){const t=i.coverageMipmap[e],n={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(t.width/2),height:Math.ceil(t.height/2)},s={colorTarget:0,depthStencilTarget:0,width:Math.ceil(t.width/2),height:Math.ceil(t.height/2)};i.coverageMipmap[e+1]=new Vj.a(r,s,n)}}const s=Math.ceil(e.height/i.cellPixelSize),a=Math.ceil(e.width/i.cellPixelSize);if(!i.vao||i.verticalCellCount!==s||i.horizontalCellCount!==a){i.verticalCellCount=s,i.horizontalCellCount=a;const e=s+1,t=a+1,n=1/s,o=1/a,l=6,c=4,u=new Float32Array(l*c*e*t);let d=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++)u[d+0]=(e-.5)*o*2-1,u[d+1]=(r-.5)*n*2-1,u[d+2]=e*o,u[d+3]=r*n,u[d+4]=(e+.5)*o*2-1,u[d+5]=(r-.5)*n*2-1,u[d+6]=e*o,u[d+7]=r*n,u[d+8]=(e-.5)*o*2-1,u[d+9]=(r+.5)*n*2-1,u[d+10]=e*o,u[d+11]=r*n,u[d+12]=(e-.5)*o*2-1,u[d+13]=(r+.5)*n*2-1,u[d+14]=e*o,u[d+15]=r*n,u[d+16]=(e+.5)*o*2-1,u[d+17]=(r-.5)*n*2-1,u[d+18]=e*o,u[d+19]=r*n,u[d+20]=(e+.5)*o*2-1,u[d+21]=(r+.5)*n*2-1,u[d+22]=e*o,u[d+23]=r*n,d+=l*c;i.vao&&i.vao.dispose(!0),i.vao=new Zl.a(r,Ll.a,{geometry:P_.b},{geometry:Wl.a.createVertex(r,35044,u)})}}_gridComputeMipmap(){const e=this._rctx,t=this._grid,r=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(e),e.bindVAO(this.quadVAO),e.useProgram(r);for(let i=0;i<t.mipmapLevels;i++){e.bindFramebuffer(t.coverageMipmap[i+1]),r.bindTexture(t.coverageMipmap[i].colorTexture,"tex");const n=t.coverageMipmap[i+1].width,s=t.coverageMipmap[i+1].height;r.setUniform2f("invFramebufferDim",1/n,1/s),e.setViewport(0,0,n,s),e.drawArrays(5,0,Object(Ql.f)(this.quadVAO,"geometry"))}}getGpuMemoryUsage(){let e=(Object(b.j)(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(Object(b.j)(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const t of this._grid.coverageMipmap)e+=t.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}},VS=r(103),NS=r(367);const US={dataType:5121,internalFormat:6408},BS={};class GS{constructor(e){this.rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this._nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach((e=>e.dispose())),this._depthBuffers.clear(),this._depthTextures.forEach((e=>e.dispose())),this._depthTextures.clear(),this._colorTextures.forEach((e=>e.dispose())),this._colorTextures.clear(),this._framebuffers.forEach((e=>e.dispose())),this._framebuffers.clear()}disposeTargetResource(e){const t=e.id;this._activeTargets.has(t)&&(this._activeTargets.delete(t),this.disposeWithFramebuffers(this._depthTextures,t),this.disposeWithFramebuffers(this._depthBuffers,t),this.disposeWithFramebuffers(this._colorTextures,t))}disposeWithFramebuffers(e,t){const r=e.get(t);r&&(this._framebuffers.forEach(((e,t)=>{e.colorAttachment!==r&&e.depthStencilAttachment!==r||(e.detachAll(),e.dispose(),this._framebuffers.delete(t))})),r.dispose(),e.delete(t))}getDepthTexture(e,t){if(!this.depthTextureSupported)return;let r=this._depthTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new $l.a(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this._depthTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,t){if(this.depthTextureSupported)return;let r=this._depthBuffers.get(e.id);return r?r.descriptor.width===t.width&&r.descriptor.height===t.height||r.resize(t.width,t.height):(r=new NS.a(this.rctx,{internalFormat:34041,...t}),this._depthBuffers.set(e.id,r),this._activeTargets.add(e.id)),r}getColorTexture(e,t){let r=this._colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new $l.a(this.rctx,{target:3553,pixelFormat:6408,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:null!=e.samplingMode?e.samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this._colorTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:this._nextId++,...BS,...e}}registerColorTarget(e={}){return{id:this._nextId++,...US,...e}}getFramebuffer(e,t,r){const i=this.getKey(t,r);let n=this._framebuffers.get(i);const s=this.getColorTexture(t,e);if(this.depthTextureSupported){const t=r?this.getDepthTexture(r,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==s||n.depthStencilTexture!==t)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(s),n.attachDepthStencilTexture(t)),n):(n=r?new Vj.a(this.rctx,{colorTarget:0,depthStencilTarget:4},s,t):new Vj.a(this.rctx,{colorTarget:0,depthStencilTarget:0},s),this._framebuffers.set(i,n),n)}const a=r?this.getDepthBuffer(r,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==s)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(s),n.attachDepthStencilBuffer(a)),n):(n=new Vj.a(this.rctx,{colorTarget:0,depthStencilTarget:r?3:0},s,a),this._framebuffers.set(i,n),n)}getKey(e,t){return`${e.id}_${t?t.id:"X"}_${e.name}${t?"_"+t.name:""}`}getGpuMemoryUsage(){let e=0;const t=new Set,r=r=>{t.has(r)||(t.add(r),e+=Object(Ql.c)(r))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),e}}class qS{constructor(e,t){this._rctx=e,this._compositingHelper=t,this._currentRenderTarget=0,this.dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const r=this._rctx,i="webgl2"===r.webglVersion;this.renderTargetHelper=new GS(r);const n=this.renderTargetHelper;this.mainColorTarget0=n.registerColorTarget({name:"mainColorTarget0"}),this.mainColorTarget1=n.registerColorTarget({name:"mainColorTarget1"}),this.frontFaceTarget=n.registerColorTarget({name:"frontFaceTarget"});const s=e=>n.registerColorTarget({name:e,dataType:5126,internalFormat:i?34836:6408,samplingMode:9728});this.colorFloatTarget=s("colorFloatTarget"),this.alphaFloatTarget=s("alphaFloatTarget"),this.mainDepth=n.registerDepthTarget({name:"mainDepth"}),this.linearDepth=n.registerColorTarget({name:"linearDepth",samplingMode:9728}),this.terrainLinearDepth=n.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=n.registerColorTarget({name:"geometryLinearDepth"}),this.normal=n.registerColorTarget({name:"normal"}),this.highlight=n.registerColorTarget({name:"highlight",internalFormat:i?32854:6408,dataType:32819}),this.hudVisibility=n.registerColorTarget({name:"hudVisibility",internalFormat:i?32854:6408,dataType:32819}),this.tmpColor=n.registerColorTarget({name:"tmpColor"}),this.tmpDepth=n.registerDepthTarget({name:"tmpDepth"}),this.hudColor=n.registerColorTarget({name:"hudColor"})}dispose(){this.renderTargetHelper.dispose()}get width(){return this.dimensions.width}get height(){return this.dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return 0===this._currentRenderTarget?this.mainColorTarget0:this.mainColorTarget1}get previousColorTarget(){return 0===this._currentRenderTarget?this.mainColorTarget1:this.mainColorTarget0}get currentRenderTarget(){return this._currentRenderTarget}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,t){return this.renderTargetHelper.getFramebuffer(this.dimensions,e,t)}get colorTexture(){return this.renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this.renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this.renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this.renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this.renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this.getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this.getColorTexture(this.tmpColor)}get hudColorTexture(){return this.getColorTexture(this.hudColor)}get mainColorTexture(){return this.getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._currentRenderTarget=0===this._currentRenderTarget&&this._needLastFrameColorTexture?1:0}initializeFrame(e){const t=this._rctx;this.dimensions.width=e.fullWidth,this.dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),t.setClearStencil(0);const r=this._background.color;t.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),t.clearSafe(17664)}composite(){this._compositingHelper.composite(this.colorTexture,0)}renderTmpAndCompositeToMain(e,t,r=!1){this.renderToTargets(e,this.tmpColor,r?this.tmpDepth:this.mainDepth,HS),this._compositingHelper.composite(this.getColorTexture(this.tmpColor),t)}renderHUDVisibility(e,t=!1){this.renderToTargets(e,this.hudVisibility,t?this.tmpDepth:this.mainDepth,WS)}compositeTransparentTerrainOntoHUDVisibility(){this.renderToTargets((()=>{this._compositingHelper.compositeSpecial(this.getColorTexture(this.tmpColor),1)}),this.hudVisibility,this.tmpDepth)}renderOITPass(e,t,r){let i,n;switch(t){case 0:i=this.colorFloatTarget,n=[0,0,0,0];break;case 1:i=this.alphaFloatTarget,n=[1,1,1,1];break;case 2:i=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(e,i,this.tmpDepth,n,!0,!0):this.renderToTargets(e,i,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(){this.bindFramebuffer(),this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)}compositeOccludedOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,e)}compositeTransparentOntoOpaque(e){e?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(16384)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(this.getColorTexture(this.colorFloatTarget),this.getColorTexture(this.alphaFloatTarget),this.getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this.renderTargetHelper.disposeTargetResource(e)}set needLastFrameColorTexture(e){!e&&this._needLastFrameColorTexture&&(this._currentRenderTarget=0,this.disposeTarget(this.mainColorTarget1)),this._needLastFrameColorTexture=e}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(e,t,r,i,n=!1,s=!1){const a=this._rctx,o=this.bindTarget(t,r);let l=0;if(i){const e=1e-13,t=Math.max(e,i[3]);a.setClearColor(i[0],i[1],i[2],t),l|=16384}return n&&(l|=256),!1===s?s=0:(!0===s&&(s=255),l|=1024),l&&a.clearSafe(l,s),e(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),o}bindTarget(e,t){const r=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);return this._rctx.bindFramebuffer(r),r}getColorTexture(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)}getGpuMemoryUsage(){let e=0;return this.renderTargetHelper&&(e+=this.renderTargetHelper.getGpuMemoryUsage()),e}}const HS=[0,0,0,0],WS=[0,1,0,1];var $S=r(519),QS=r(520);class ZS{constructor(e){this.context=e,this.renderPlugins=new Array,this.slots=[];for(let t=0;t<23;++t)this.slots[t]=[]}add(e,t,r=null){const i=t.initializeRenderContext(this.context,r),n=()=>{this.renderPlugins.push(t);for(let r=0;r<e.length;++r){const i=e[r];this.slots[i].push(t)}this.context.requestRender()};if(Object(m.p)(i))return i.then(n);n()}remove(e){const t=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter((t=>t!==e)),Object(Oc.a)(this.renderPlugins.length<t,"Removing non-added render plugin");for(let r=0;r<this.slots.length;++r)this.slots[r]=this.slots[r].filter((t=>t!==e));e.uninitializeRenderContext(),this.context.requestRender()}prepareRender(e,t){for(const r of this.renderPlugins)r.prepareRender&&r.prepareRender(e,t)}render(){const e=this.slots[this.context.renderContext.slot];let t=!1;for(const r of e)r.canRender&&r.render(this.context.renderContext)&&(t=!0);return t}queryDepthRange(e){const t=XS;t.near=1/0,t.far=-1/0;for(const r of this.renderPlugins)if(r.queryDepthRange){const i=r.queryDepthRange(e);i&&Kw(t,i,t)}return t}get needsHighlight(){return this.renderPlugins.some((e=>e.needsHighlight))}get needsLinearDepth(){return this.renderPlugins.some((e=>e.needsLinearDepth))}get needsLaserlineWithContrastControl(){const e=this.slots[17];return!!e&&e.length>0}get renderOccludedFlags(){let e=0;return this.renderPlugins.forEach((t=>{t.renderOccludedFlags&&(e|=t.renderOccludedFlags)})),e}}const XS={near:0,far:0};var JS=r(289),YS=r(463);class KS extends Dl.a{initializeProgram(e){const t=KS.shader.get().build(this.configuration);return new kl.a(e.rctx,t,Ll.a)}initializePipeline(e){return 0===this.configuration.pass?Object(zl.g)({blending:Object(zl.h)(1,1,1,1),colorWrite:zl.d,depthTest:null,depthWrite:null}):1===this.configuration.pass||2===this.configuration.pass?Object(zl.g)({blending:Ax.f,colorWrite:zl.d,depthTest:null,depthWrite:null}):Object(zl.g)({})}bindPass(e){if(0===this.configuration.pass||2===this.configuration.pass){const t=e;this.program.bindTexture(t.linearDepthTexture,"depthMap"),t.shadowMap.bind(this.program),t.shadowMap.bindView(this.program,t.camera.center),this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",t.inverseView),this.program.setUniform4fv("projInfo",t.projInfo),this.program.setUniform2fv("zScale",t.zScale)}else if(1===this.configuration.pass){const t=e;if(this.program.bindTexture(t.shadowAccumulationMap,"shadowAccumulationMap"),this.program.setUniform1f("sampleScale",t.sampleScale),this.program.setUniform1f("opacityFromElevation",t.opacityFromElevation),0===this.configuration.visualization){const t=e;this.program.bindTexture(t.colorRamp,"colorRamp"),this.program.setUniform1f("rampSize",t.rampSize),this.configuration.bandsEnabled&&this.program.setUniform1f("bandSize",t.bandSize)}else if(1===this.configuration.visualization){const t=e;this.program.setUniform1f("threshold",t.threshold),this.program.setUniform4fv("colors",t.colors)}}}get primitiveType(){return 5}}KS.shader=new Il.a(YS.a,(()=>r.e(203).then(r.bind(null,1066))));class eT extends Fl.a{constructor(){super(...arguments),this.pass=0,this.visualization=0,this.bandsEnabled=!1}}Object(i.a)([Object(Fl.b)({count:3})],eT.prototype,"pass",void 0),Object(i.a)([Object(Fl.b)()],eT.prototype,"visualization",void 0),Object(i.a)([Object(Fl.b)()],eT.prototype,"bandsEnabled",void 0);const tT=[Object(Ml.g)(.01,0,.25,0),Object(Ml.g)(.01,0,.25,1)],rT=1/512;class iT{constructor(e,t,r,i){this._techniqueRep=e,this._rctx=t,this._shadowAccumulator=r,this._requestRender=i,this._enabled=!1,this._vao=Object(vc.d)(t),this._visualizationConfig=new eT,this._visualizationConfig.pass=1,this._visualizationConfig.visualization=0,this._visualizeAccumulationTechnique=e.acquire(KS,this._visualizationConfig);const n={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:tT.length,height:1};this._colorRampTexture=new $l.a(this._rctx,n,nT(tT)),this._visualizationParams={shadowAccumulationMap:this._accumulationTexture,sampleScale:0,colorRamp:this._colorRampTexture,rampSize:n.width,threshold:.5,bandSize:.1,colors:Object(Ma.f)([Object(Ml.g)(0,1,0,.5),Object(Ml.g)(1,0,0,.5)]),opacityFromElevation:1}}dispose(){this._stop(),this._vao=Object(b.f)(this._vao),this._visualizeAccumulationTechnique=Object(b.f)(this._visualizeAccumulationTechnique),this._colorRampTexture=Object(b.f)(this._colorRampTexture),this._shadowAccumulator=null}render(){this._isRenderingVisualization&&(this._sampleScale=1/this._computedSamples,this._rctx.bindVAO(this._vao),this._rctx.useProgram(this._visualizeAccumulationTechnique.program),this._visualizeAccumulationTechnique.bindPipelineState(this._rctx),this._visualizeAccumulationTechnique.bindPass(this._visualizationParams),this._rctx.drawArrays(this._visualizeAccumulationTechnique.primitiveType,0,Object(Ql.f)(this._vao,"geometry")))}setOptions(e){void 0!==e.enabled&&this._setEnabled(e.enabled),void 0!==e.gradientColorRamp&&this._setColorRamp(e.gradientColorRamp),void 0!==e.threshold&&(this._threshold=e.threshold),void 0!==e.thresholdColors&&this._setThresholdColors(e.thresholdColors),void 0!==e.visualization&&(this._visualization=e.visualization),void 0!==e.bandSize&&(this._bandSize=e.bandSize),void 0!==e.bandsEnabled&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._visualizationParams.opacityFromElevation}set opacityFromElevation(e){this._visualizationParams.opacityFromElevation=e}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>rT}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _accumulationTexture(){return this._shadowAccumulator.accumulationTexture}get _sampleScale(){return this._visualizationParams.sampleScale}set _sampleScale(e){this._visualizationParams.sampleScale=e}get _threshold(){return this._visualizationParams.threshold}set _threshold(e){this._threshold!==e&&(this._visualizationParams.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._visualizationConfig.visualization}set _visualization(e){if(e===this._visualization)return;const t=this._visualizationConfig;t.visualization=e,this._visualizeAccumulationTechnique=this._techniqueRep.releaseAndAcquire(KS,t,this._visualizeAccumulationTechnique),this._requestRenderIfRunning()}get _bandSize(){return this._visualizationParams.bandSize}set _bandSize(e){e!==this._bandSize&&(this._visualizationParams.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._visualizationConfig.bandsEnabled}set _bandsEnabled(e){if(e===this._bandsEnabled)return;const t=this._visualizationConfig;t.bandsEnabled=e,this._visualizeAccumulationTechnique=this._techniqueRep.releaseAndAcquire(KS,t,this._visualizeAccumulationTechnique),this._requestRenderIfRunning()}_setColorRamp(e){const t=e.length,r=nT(e);this._colorRampTexture.resize(t,1),this._colorRampTexture.setData(r),this._visualizationParams.rampSize=t,this._requestRenderIfRunning()}_setThresholdColors(e){const t=this._visualizationParams.colors,r=Object(Ma.f)(e);Object(Ma.e)(t,r)||(this._visualizationParams.colors=r,this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}}function nT(e){const t=e.length,r=new Uint8Array(4*t);for(let i=0;i<t;++i){const t=e[i];r[4*i+0]=255*t[0],r[4*i+1]=255*t[1],r[4*i+2]=255*t[2],r[4*i+3]=255*t[3]}return r}class sT{constructor(){this.camera=new Hd.a,this.lightMat=Object(Al.d)()}}const aT=Object(Al.d)(),oT=Object(Al.d)(),lT=Object(Al.d)(),cT=Object(Ml.e)(),uT=[];for(let nA=0;nA<8;++nA)uT.push(Object(Ml.e)());const dT=Object(S.e)(),hT=Object(S.e)(),pT=Object(tc.b)(),fT=Object(tc.b)(),bT=Object(tc.b)(),mT=Object(tc.b)(),gT=Object(tc.b)(),yT=Object(Al.d)(),vT=Object(S.e)(),OT=[],jT=Object(Al.d)(),_T=new Float32Array(64),wT=Object(tc.b)(),xT=Object(tc.b)(),ST=[Object(tc.b)(),Object(tc.b)(),Object(tc.b)(),Object(tc.b)()],TT=Object(tc.b)(),CT=Object(tc.b)(),MT=Object(tc.b)(),PT=Object(tc.b)(),AT=Object(tc.b)(),ET=Object(tc.b)(),RT=Object(tc.b)();function IT(e,t){return 3*t+e}const DT=Object(tc.b)();function FT(e,t){return Object(ec.r)(DT,e[t],e[t+3]),DT}const LT=Object(tc.b)(),kT=Object(Fd.b)();var zT=class{constructor(e,t,r=0){this.rctx=e,this.viewingMode=t,this._enabled=!1,this._snapshots=new Array,this.textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.maxTextureSize=this.rctx.parameters.maxTextureSize;for(let i=0;i<4;++i)this.cascades.push(new sT);this.snapshotCount=r}dispose(){this.discardDepthTexture(),this.discardAllSnapshots()}set maxCascades(e){this.maxNumCascades=Object(Bt.e)(Math.floor(e),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(e){this._enabled=e,e||(this.discardDepthTexture(),this.discardAllSnapshots())}get enabled(){return this._enabled}get snapshotCount(){return this._snapshots.length}set snapshotCount(e){const t=this._snapshots.length;if(e>t){const r=e-t;this._snapshots.length=e;for(let e=0;e<r;++e)this._snapshots[t+e]=null}else if(e<this.snapshotCount){const r=t-e;for(let t=0;t<r;++t)this.discardSnapshot(e+t);this._snapshots.length=e}}getSnapshot(e){return this.enabled?this._snapshots[e]:null}getCascades(){for(let e=0;e<this.numCascades;++e)OT[e]=this.cascades[e];return OT.length=this.numCascades,OT}start(e,t,r){Object(Oc.a)(this.enabled),this.textureSize=this.computeTextureSize(e.fullWidth,e.fullHeight),this.ensureDepthTexture();const{near:i,far:n}=this.clampNearFar(r);this.computeCascadeDistances(n,i),this.setupMatrices(e,t);const s=e.viewMatrix,a=e.projectionMatrix;for(let o=0;o<this.numCascades;++o)this.constructCascade(o,a,s,t);this.lastOrigin=null,this.clear()}finish(e){Object(Oc.a)(this.enabled),this.rctx.bindFramebuffer(e)}bind(e){this.enabled?(this._depthTextureUnit=e.bindTexture(this._depthTexture,"uShadowMapTex"),e.setUniform1f("uDepthHalfPixelSz",.5/this.textureSize),e.setUniform1i("uShadowMapNum",this.numCascades),e.setUniform4f("uShadowMapDistance",this.cascadeDistances[0],this.numCascades>1?this.cascadeDistances[1]:1/0,this.numCascades>2?this.cascadeDistances[2]:1/0,this.numCascades>3?this.cascadeDistances[3]:1/0)):e.setUniform1f("uDepthHalfPixelSz",-1)}bindView(e,t){if(!this.enabled)return;const r=this.lastOrigin;if(!r||r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]){this.lastOrigin=this.lastOrigin||Object(S.e)(),Object(Cl.m)(this.lastOrigin,t);for(let e=0;e<this.numCascades;++e){Object(Pl.t)(jT,this.cascades[e].lightMat,t);for(let t=0;t<16;++t)_T[16*e+t]=jT[t]}}e.setUniformMatrix4fv("uShadowMapMatrix",_T)}takeCascadeSnapshotTo(e,t){Object(Oc.a)(this.enabled),this.ensureSnapshot(t),this._bindFbo();const r=this.rctx,i=r.bindTexture(this._snapshots[t],$l.a.TEXTURE_UNIT_FOR_UPDATES);r.gl.copyTexSubImage2D(3553,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),r.bindTexture(i,$l.a.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this.rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(16640)}computeTextureSize(e,t){const r=.5*Math.log(e*e+t*t)*Math.LOG2E,i=2**Math.round(r+.35);return Math.min(this.maxTextureSize,2*i)}ensureDepthTexture(){if(null!=this._depthTexture&&this._depthTexture.descriptor.width===this.textureSize)return;this.discardDepthTexture();const e={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize};this._depthTexture=new $l.a(this.rctx,e),this.fbo=new Vj.a(this.rctx,{colorTarget:0,depthStencilTarget:1,width:this.textureSize,height:this.textureSize},this._depthTexture)}ensureSnapshot(e){const t=this._snapshots[e];if(Object(b.j)(t)&&t.descriptor.width===this.textureSize)return;this.discardSnapshot(e);const r={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize};this._snapshots[e]=new $l.a(this.rctx,r)}discardDepthTexture(){this.fbo=Object(b.f)(this.fbo),this._depthTexture=Object(b.f)(this._depthTexture)}discardSnapshot(e){this._snapshots[e]=Object(b.f)(this._snapshots[e])}discardAllSnapshots(){for(let e=0;e<this.snapshotCount;++e)this.discardSnapshot(e)}_bindFbo(){const e=this.rctx;Object(b.j)(this._depthTextureUnit)&&(e.bindTexture(null,this._depthTextureUnit),this._depthTextureUnit=null),e.bindFramebuffer(this.fbo)}constructCascade(e,t,r,i){const n=this.cascades[e],s=-this.cascadeDistances[e],a=-this.cascadeDistances[e+1],o=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]),l=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]);Object(Oc.a)(o<l);for(let u=0;u<8;++u){Object(rc.l)(cT,u%4==0||u%4==3?-1:1,u%4==0||u%4==1?-1:1,u<4?o:l,1),Object(rc.m)(uT[u],cT,lT);for(let e=0;e<3;++e)uT[u][e]/=uT[u][3]}Object(Cl.u)(vT,uT[0]),Object(Pl.t)(aT,yT,vT),n.camera.viewMatrix=aT;for(let u=0;u<8;++u)Object(Cl.s)(uT[u],uT[u],n.camera.viewMatrix);Object(Cl.m)(dT,uT[0]),Object(Cl.m)(hT,uT[0]);for(let u=1;u<8;++u)for(let e=0;e<3;++e)dT[e]=Math.min(dT[e],uT[u][e]),hT[e]=Math.max(hT[e],uT[u][e]);dT[2]-=200,hT[2]+=200,n.camera.near=-hT[2],n.camera.far=-dT[2],this.warp?this.constructTrapezoidalProjection(r,i,n):this.constructOrthogonalProjection(n),Object(Pl.m)(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const c=this.textureSize/2;n.camera.viewport[0]=e%2==0?0:c,n.camera.viewport[1]=0===Math.floor(e/2)?0:c,n.camera.viewport[2]=c,n.camera.viewport[3]=c}constructOrthogonalProjection(e){Object(Pl.o)(e.camera.projectionMatrix,dT[0],hT[0],dT[1],hT[1],e.camera.near,e.camera.far)}constructTrapezoidalProjection(e,t,r){const i=1/uT[0][3],n=1/uT[4][3];Object(Oc.a)(i<n);let s=i+Math.sqrt(i*n);const a=Math.sin(Object(Bt.b)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));s/=a,function(e,t,r,i,n,s,a,o){Object(ec.r)(wT,0,0);for(let j=0;j<4;++j)Object(ec.i)(wT,wT,e[j]);Object(ec.b)(wT,wT,.25),Object(ec.r)(xT,0,0);for(let j=4;j<8;++j)Object(ec.i)(xT,xT,e[j]);Object(ec.b)(xT,xT,.25),Object(ec.m)(ST[0],e[4],e[5],.5),Object(ec.m)(ST[1],e[5],e[6],.5),Object(ec.m)(ST[2],e[6],e[7],.5),Object(ec.m)(ST[3],e[7],e[4],.5);let l=0,c=Object(ec.j)(ST[0],wT);for(let j=1;j<4;++j){const e=Object(ec.j)(ST[j],wT);e<c&&(c=e,l=j)}Object(ec.a)(TT,ST[l],e[l+4]);const u=TT[0];let d,h;TT[0]=-TT[1],TT[1]=u,Object(ec.a)(CT,xT,wT),Object(ec.h)(CT,TT)<0&&Object(ec.n)(TT,TT),Object(ec.m)(TT,TT,CT,r),Object(ec.f)(TT,TT),d=h=Object(ec.h)(Object(ec.a)(MT,e[0],wT),TT);for(let j=1;j<8;++j){const t=Object(ec.h)(Object(ec.a)(MT,e[j],wT),TT);t<d?d=t:t>h&&(h=t)}Object(ec.c)(i,wT),Object(ec.b)(MT,TT,d-t),Object(ec.i)(i,i,MT);let p=-1,f=1,b=0,m=0;for(let j=0;j<8;++j){Object(ec.a)(PT,e[j],i),Object(ec.f)(PT,PT);const t=TT[0]*PT[1]-TT[1]*PT[0];t>0?t>p&&(p=t,b=j):t<f&&(f=t,m=j)}Object(Oc.o)(p>0,"leftArea"),Object(Oc.o)(f<0,"rightArea"),Object(ec.b)(AT,TT,d),Object(ec.i)(AT,AT,wT),Object(ec.b)(ET,TT,h),Object(ec.i)(ET,ET,wT),RT[0]=-TT[1],RT[1]=TT[0];const g=Object(Oc.l)(i,e[m],ET,Object(ec.i)(MT,ET,RT),1,n),y=Object(Oc.l)(i,e[b],ET,MT,1,s),v=Object(Oc.l)(i,e[b],AT,Object(ec.i)(MT,AT,RT),1,a),O=Object(Oc.l)(i,e[m],AT,MT,1,o);Object(Oc.o)(g,"rayRay"),Object(Oc.o)(y,"rayRay"),Object(Oc.o)(v,"rayRay"),Object(Oc.o)(O,"rayRay")}(uT,s,a,pT,fT,bT,mT,gT),function(e,t,r,i,n){Object(ec.a)(LT,r,i),Object(ec.b)(LT,LT,.5),kT[0]=LT[0],kT[1]=LT[1],kT[2]=0,kT[3]=LT[1],kT[4]=-LT[0],kT[5]=0,kT[6]=LT[0]*LT[0]+LT[1]*LT[1],kT[7]=LT[0]*LT[1]-LT[1]*LT[0],kT[8]=1,kT[IT(0,2)]=-Object(ec.h)(FT(kT,0),e),kT[IT(1,2)]=-Object(ec.h)(FT(kT,1),e);let s=Object(ec.h)(FT(kT,0),r)+kT[IT(0,2)],a=Object(ec.h)(FT(kT,1),r)+kT[IT(1,2)],o=Object(ec.h)(FT(kT,0),i)+kT[IT(0,2)],l=Object(ec.h)(FT(kT,1),i)+kT[IT(1,2)];s=-(s+o)/(a+l),kT[IT(0,0)]+=kT[IT(1,0)]*s,kT[IT(0,1)]+=kT[IT(1,1)]*s,kT[IT(0,2)]+=kT[IT(1,2)]*s,s=1/(Object(ec.h)(FT(kT,0),r)+kT[IT(0,2)]),a=1/(Object(ec.h)(FT(kT,1),r)+kT[IT(1,2)]),kT[IT(0,0)]*=s,kT[IT(0,1)]*=s,kT[IT(0,2)]*=s,kT[IT(1,0)]*=a,kT[IT(1,1)]*=a,kT[IT(1,2)]*=a,kT[IT(2,0)]=kT[IT(1,0)],kT[IT(2,1)]=kT[IT(1,1)],kT[IT(2,2)]=kT[IT(1,2)],kT[IT(1,2)]+=1,s=Object(ec.h)(FT(kT,1),t)+kT[IT(1,2)],a=Object(ec.h)(FT(kT,2),t)+kT[IT(2,2)],o=Object(ec.h)(FT(kT,1),r)+kT[IT(1,2)],l=Object(ec.h)(FT(kT,2),r)+kT[IT(2,2)],s=-.5*(s/a+o/l),kT[IT(1,0)]+=kT[IT(2,0)]*s,kT[IT(1,1)]+=kT[IT(2,1)]*s,kT[IT(1,2)]+=kT[IT(2,2)]*s,s=Object(ec.h)(FT(kT,1),t)+kT[IT(1,2)],a=Object(ec.h)(FT(kT,2),t)+kT[IT(2,2)],o=-a/s,kT[IT(1,0)]*=o,kT[IT(1,1)]*=o,kT[IT(1,2)]*=o,n[0]=kT[0],n[1]=kT[1],n[2]=0,n[3]=kT[2],n[4]=kT[3],n[5]=kT[4],n[6]=0,n[7]=kT[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=kT[6],n[13]=kT[7],n[14]=0,n[15]=kT[8]}(pT,fT,mT,gT,r.camera.projectionMatrix),r.camera.projectionMatrix[10]=2/(dT[2]-hT[2]),r.camera.projectionMatrix[14]=-(dT[2]+hT[2])/(dT[2]-hT[2])}setupMatrices(e,t){Object(Pl.m)(oT,e.projectionMatrix,e.viewMatrix),Object(Pl.a)(lT,oT);const r=1===this.viewingMode?e.eye:Object(Cl.y)(vT,0,0,1);Object(Pl.l)(yT,[0,0,0],[-t[0],-t[1],-t[2]],r)}clampNearFar(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}computeCascadeDistances(e,t){this.numCascades=Math.min(1+Math.floor(Object(Oc.h)(e/t,4)),this.maxNumCascades);const r=(e-t)/this.numCascades,i=(e/t)**(1/this.numCascades);let n=t,s=t;for(let a=0;a<this.numCascades+1;++a)this.cascadeDistances[a]=Object(Bt.m)(n,s,this.splitSchemeLambda),n*=i,s+=r}getGpuMemoryUsage(){var e,t;return this._snapshots.reduce(((e,t)=>e+Object(Ql.c)(t)),null!=(e=null==(t=this.fbo)?void 0:t.gpuMemoryUsage)?e:0)}get test(){const e=this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,depthTexture:this._depthTexture,set splitSchemeLambda(t){e.splitSchemeLambda=t},get splitSchemeLambda(){return e.splitSchemeLambda},set warp(t){e.warp=t},get warp(){return e.warp}}}};class VT{constructor(e,t,r,i,n,s){this._rctx=e,this._stage=r,this._prepareForShadowMapPass=i,this._renderToShadowMap=n,this._requestRender=s,this._progress=0,this._sampleCount=0,this._cachedCamera=new Hd.a,this._contentCamera=new Hd.a,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=tx,this._previewing=!1,this._handles=new F.a,this._cameraForcedForScreenshot=!1,this._shadowMap=new zT(e,r.viewingMode),this._shadowMap.enabled=!0,this._vao=Object(vc.d)(e);const a={rctx:e,viewingMode:r.viewingMode},o=new eT;o.pass=0,this._accumulationTechnique=new KS(a,o);this._fbo=new Vj.a(e,{colorTarget:0,depthStencilTarget:0,width:0,height:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0}),this._accumulationParams={camera:this._cachedCamera,linearDepthTexture:null,shadowMap:this._shadowMap,inverseView:Object(Al.d)(),projInfo:Object(Ml.e)(),zScale:Object(tc.b)()},this._accumulationRenderer=new iT(t,e,this,s);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(Cm.b.SHADOW_ACCUMULATOR,this)),this._handles.add(Object(JS.d)((()=>r.renderView),(e=>{this._handles.remove(VT.renderViewHandleKey),Object(b.i)(e)||this._handles.add(e.events.on("force-camera-for-screenshot",(()=>this._cameraForcedForScreenshot=!0)),VT.renderViewHandleKey)})))}get computedSamples(){return this._progress}get accumulationTexture(){return this._fbo.colorTexture}get running(){return this._isRefining&&this._canAccumulate}get isAccumulating(){return this._isPreviewing||this._isRefining}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get _canAccumulate(){return null!==this._accumulationParams.linearDepthTexture&&this._depthRange!==tx&&this._opacityFromElevation>rT}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(Object(Ma.e)(t,e,Cl.F))return;const r=e.length;t.length=r,this._sampleCount=Math.min(YS.c,r);for(let i=0;i<r;++i){const r=e[i],n=t[i]||Object(S.e)();Object(Cl.m)(n,r),t[i]=n}this._invalidate()}get _projInfo(){return this._accumulationParams.projInfo}get _zScale(){return this._accumulationParams.zScale}get _inverseView(){return this._accumulationParams.inverseView}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}runTask(e){for(this._prepareForShadowMapPass(this._cachedCamera,this._contentCamera);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}accumulateFixedSamples(){if(!this.isAccumulating||!this._canAccumulate)return;(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();const e=this._cameraForcedForScreenshot?this._sampleCount:Math.min(VT.previewSamples,this._sampleCount-this._progress);for(let t=0;t<e;++t)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(){this._accumulationRenderer.render()}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Object(b.f)(this._accumulationRenderer),this._shadowMap=Object(b.f)(this._shadowMap),this._fbo=Object(b.f)(this._fbo),this._vao=Object(b.f)(this._vao),this._accumulationTechnique=Object(b.f)(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){void 0!==e.enabled&&this._setEnabled(e.enabled),void 0!==e.previewing&&this.setPreviewing(e.previewing),void 0!==e.lightDirections&&this.setLightDirections(e.lightDirections),this._accumulationRenderer.setOptions(e)}setPreviewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}setLightDirections(e){this._lightDirections=e}setAccumulationDependencies(e,t,r,i){this._accumulationParams.linearDepthTexture=e,this._depthRange=t,this._updateCamera(r),this._contentCamera=i}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const r=NT;return this._fbo.readPixels(e,t,1,1,6408,5121,r),r[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(16384),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress],t=this._cachedCamera;this._renderToShadowMap(this._shadowMap,e,t,this._depthRange),this._rctx.bindFramebuffer(this._fbo),this._rctx.useProgram(this._accumulationTechnique.program),this._accumulationTechnique.bindPipelineState(this._rctx),this._accumulationTechnique.bindPass(this._accumulationParams),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(this._accumulationTechnique.primitiveType,0,Object(Ql.f)(this._vao,"geometry")),this._progress++}_updateCamera(e){if(e.equals(this._cachedCamera))return;const{fullWidth:t,fullHeight:r,projectionMatrix:i,viewMatrix:n,center:s}=e;this._cachedCamera.copyFrom(e),this._fbo.resize(t,r),Object(Oc.f)(i,t,r,this._projInfo,this._zScale),Object(Pl.t)(this._inverseView,n,s),Object(Pl.a)(this._inverseView,this._inverseView),this._opacityFromElevation=1-Object(Bt.u)(4e4,5e4,e.relativeElevation)}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}}VT.previewSamples=6,VT.renderViewHandleKey="renderView";const NT=new Uint8Array(4);var UT=r(622);class BT extends Dl.a{constructor(){super(...arguments),this.opacityElevation=1,this.dayNightTerminator=1,this.highlightShadowMapSlot=0,this.defaultSnapshotSlot=1}initializeProgram(e){const t=BT.shader.get();this._viewingMode=e.viewingMode;const r=t.build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new kl.a(e.rctx,r,Ll.a)}initializePipeline(e){return Object(zl.g)({blending:Object(zl.h)(770,1,771,771),colorWrite:zl.d,depthTest:null,depthWrite:null})}bindPass(e,t){this.opacityElevation=1-Object(Bt.u)(4e4,5e4,t.camera.relativeElevation);const r=1===this._viewingMode?Object(Cl.t)(GT,t.camera.center):Object(Cl.y)(GT,0,0,1),i=Object(Cl.j)(r,t.lighting.lightingMainDirection);this.dayNightTerminator=Object(Bt.u)(0,1,Object(Bt.e)(30*i,0,1)),this.program.bindTexture(t.linearDepthTexture,"depthMap"),this.program.bindTexture(t.highlightColorTexture,"highlightMap"),Object(Cl.s)(qT,t.lighting.lightingMainDirection,t.camera.viewInverseTransposeMatrix),Object(Cl.t)(qT,qT),Object(Oc.f)(t.camera.projectionMatrix,t.camera.fullWidth,t.camera.fullHeight,WT,HT),Object(Pl.t)($T,t.camera.viewMatrix,t.camera.center),Object(Pl.a)($T,$T),this.program.setUniform4fv("color",e.shadowColor),this.program.setUniform1f("opacity",e.shadowOpacity),this.program.setUniform1f("occludedOpacity",e.occludedShadowOpacity),this.program.setUniform1f("terminationFactor",this.opacityElevation*this.dayNightTerminator),this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",$T),this.program.setUniform4fv("projInfo",WT),this.program.setUniform2fv("zScale",HT),this.program.setUniform3fv("lightingMainDirectionView",qT),this.program.setUniform2f("texelSize",1/t.linearDepthTexture.descriptor.width,1/t.linearDepthTexture.descriptor.height),t.shadowMap.bind(this.program),t.shadowMap.bindView(this.program,t.camera.center);let n=t.shadowMap.getSnapshot(this.highlightShadowMapSlot);Object(b.j)(n)&&this.program.bindTexture(n,"highlightDepthTex"),n=t.shadowMap.getSnapshot(this.defaultSnapshotSlot),Object(b.j)(n)&&this.program.bindTexture(n,"defaultDepthTex")}get primitiveType(){return 5}}BT.shader=new Il.a(UT.a,(()=>r.e(204).then(r.bind(null,1067))));const GT=Object(S.e)(),qT=Object(S.e)(),HT=Object(tc.b)(),WT=Object(Ml.e)(),$T=Object(Al.d)();class QT{constructor(e,t){this._rctx=e,this._maxOpacity=1,this._defaultOptions={shadowColor:Object(Ky.c)(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1},this._technique=new BT({rctx:e,viewingMode:t},null),this._vao=Object(vc.d)(this._rctx)}render(e,t){e.shadowMap.enabled&&e.linearDepthTexture&&this.isVisible&&(this._rctx.bindFramebuffer(t),this._rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this._rctx),this._technique.bindPass(this._defaultOptions,e),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(this._technique.primitiveType,0,Object(Ql.f)(this._vao,"geometry")))}getGpuMemoryUsage(){return this._vao?this._vao.size:0}setDefaultOptions(e){this._defaultOptions=e,this._updateMaxOpacity()}get highlightShadowMapSlot(){return this._technique.highlightShadowMapSlot}get defaultSnapshotSlot(){return this._technique.defaultSnapshotSlot}dispose(){this._vao=Object(b.f)(this._vao),this._technique=Object(b.f)(this._technique)}get isVisible(){return this._maxOpacity*this._technique.opacityElevation*this._technique.dayNightTerminator>=.001953125}_updateMaxOpacity(){const e=this._defaultOptions,t=e.shadowColor,r=Math.max(e.shadowOpacity,e.occludedShadowOpacity);this._maxOpacity=r*t[3]}}const ZT=Object(A.b)();var XT=class{constructor(){this._worldPlane=ZT}get isEnabled(){return this.plane!==ZT}get plane(){return this._worldPlane}set plane(e){this._worldPlane=e||ZT}},JT=r(623);class YT extends Dl.a{initializeProgram(e){const t=YT.shader.get(),r=this.configuration,i=t.build({output:r.output,threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16});return new kl.a(e.rctx,i,Ll.a)}initializePipeline(){return Object(zl.g)({colorWrite:zl.d})}}YT.shader=new Il.a(JT.a,(()=>r.e(200).then(r.bind(null,1069))));class KT extends Fl.a{constructor(){super(...arguments),this.output=0}}Object(i.a)([Object(Fl.b)({count:3})],KT.prototype,"output",void 0);class eC{constructor(e,t){this.rctx=e,this._techniqueRep=t,this.resourceLoadingPromise=null,this.isEnabled=!1}loadResources(e){if(!this.data||!this.textureArea||!this.textureSearch){const t=this.resourceLoadingPromise||this.loadDataModule().then((()=>this.loadTextures()));return e&&t.then(e),this.resourceLoadingPromise||(this.resourceLoadingPromise=t,t.then((()=>this.resourceLoadingPromise=null))),!1}return!0}loadDataModule(){return this.data?Promise.resolve():r.e(185).then(r.bind(null,1068)).then((e=>{this.data=e}))}loadTextures(){return Promise.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then((([e,t])=>{this.textureArea=e,this.textureSearch=t}))}get isLoadingResources(){return null!=this.resourceLoadingPromise}enable(){if(this.isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeights||!this._blur){const e=new KT,t=(e,t)=>this._techniqueRep.releaseAndAcquire(YT,e,t);e.output=0,this._edgeDetectTechnique=t(e,this._edgeDetectTechnique),e.output=1,this._blendWeights=t(e,this._blendWeights),e.output=2,this._blur=t(e,this._blur)}return!!this.loadResources()&&(this.vao=Object(vc.e)(this.rctx),this.edges=new Vj.a(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4}),this.blend=new Vj.a(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4}),this.isEnabled=!0,!0)}disable(){this.isEnabled&&(this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.blend.dispose(),this.blend=null,this.edges.dispose(),this.edges=null,this.isEnabled=!1)}render(e){this.enable();const t=this.rctx,r=t.getBoundFramebufferObject(),i={x:0,y:0,width:e.colorTexture.descriptor.width,height:e.colorTexture.descriptor.height};t.bindVAO(this.vao),t.setPipelineState(this._edgeDetectTechnique.pipeline),t.setViewport(i.x,i.y,i.width,i.height),this.edges.resize(i.width,i.height),t.bindFramebuffer(this.edges),t.setClearColor(0,0,0,1),t.clear(16384),t.useProgram(this._edgeDetectTechnique.program),this._edgeDetectTechnique.program.bindTexture(e.colorTexture,"tColor"),this._edgeDetectTechnique.program.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),t.drawArrays(4,0,3),this.blend.resize(i.width,i.height),t.bindFramebuffer(this.blend),t.setClearColor(0,0,1,1),t.clear(16384),t.useProgram(this._blendWeights.program),this._blendWeights.program.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),this._blendWeights.program.bindTexture(this.textureSearch,"tSearch"),this._blendWeights.program.bindTexture(this.textureArea,"tArea"),this._blendWeights.program.bindTexture(this.edges.colorTexture,"tEdges"),t.drawArrays(4,0,3),t.bindFramebuffer(r),t.setClearColor(0,1,0,1),t.clear(16384),t.useProgram(this._blur.program),this._blur.program.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),this._blur.program.bindTexture(e.colorTexture,"tColor"),this._blur.program.bindTexture(this.blend.colorTexture,"tBlendWeights"),t.drawArrays(4,0,3)}loadTextureFromBase64(e,t,r){const i=new $l.a(this.rctx,{pixelFormat:r,dataType:5121,wrapMode:33071,samplingMode:t},null);return Object(El.a)(e).then((e=>(i.resize(e.width,e.height),i.setData(e),i)))}}var tC=r(624);class rC extends Dl.a{initializeProgram(e){const t=rC.shader.get(),r=this.configuration,i=3===r.samples?64:2===r.samples?32:1===r.samples?16:8,n=t.build({output:r.output,samples:i,radius:4});return new kl.a(e.rctx,n,Ll.a)}initializePipeline(){return Object(zl.g)({colorWrite:zl.d})}}rC.shader=new Il.a(tC.a,(()=>r.e(201).then(r.bind(null,1071))));class iC extends Fl.a{constructor(){super(...arguments),this.output=0,this.samples=3}}Object(i.a)([Object(Fl.b)({count:2})],iC.prototype,"output",void 0),Object(i.a)([Object(Fl.b)()],iC.prototype,"samples",void 0);const nC=Object(tc.b)(),sC=Object(Ml.e)();var aC=class{constructor(e,t,r){this._techniqueRep=e,this._rctx=t,this._requestRender=r,this._enabled=!1,this._ssaoTechniqueConfig=new iC,this.quadVAO=null,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=Object(Ml.e)()}dispose(){this.quadVAO=Object(b.f)(this.quadVAO)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enabled}set attenuation(e){this._attenuation=e}get attenuation(){return this._attenuation}set radius(e){this._radius=e}get radius(){return this._radius}set samples(e){this._samples=e,this._enabled&&this._selectPrograms()}get samples(){return this._samples}get ready(){return this.enabled&&Object(b.j)(this._noiseTexture)&&Object(b.j)(this._ssaoFBO)&&Object(b.j)(this._blur0FBO)&&Object(b.j)(this._blur1FBO)}computeSSAO(e,t,r){if(!this.enabled||Object(b.i)(this._noiseTexture)||Object(b.i)(this._ssaoFBO)||Object(b.i)(this._blur0FBO)||Object(b.i)(this._blur1FBO))return;const i=this._rctx,n=e.fullViewport,s=n[2],a=n[3],o=s/this._BLUR_F,l=a/this._BLUR_F;this._ssaoFBO.resize(s,a),this._blur0FBO.resize(o,l),this._blur1FBO.resize(o,l);const c=1*s,u=1*a;Object(rc.c)(this._viewportToRestore,e.fullViewport),i.bindFramebuffer(this._ssaoFBO),i.setViewport(0,0,s,a);const d=this._ssaoTechnique.program;i.useProgram(d),i.setPipelineState(this._ssaoTechnique.pipeline),d.setUniform2f("rnmScale",s/this._noiseTexture.descriptor.width,a/this._noiseTexture.descriptor.height),d.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64);const h=this._data.minDiscrepancy,p=this._samples<h.length?h[this._samples]:5779;d.setUniform1f("numSpiralTurns",p);const f=sC,m=nC;Object(Oc.f)(e.projectionMatrix,e.fullWidth,e.fullHeight,f,m),d.setUniform4fv("projInfo",f),d.setUniform2fv("zScale",m),d.setUniform2f("nearFar",e.near,e.far);let g=1/e.computeRenderPixelSizeAtDist(1);d.setUniform1f("projScale",1*g),d.setUniform2f("screenDimensions",c,u);const y=Object(Cl.o)(e.eye,e.center);let v=20*e.computeRenderPixelSizeAtDist(y);v=Math.max(.1,v),d.setUniform1f("radius",v),d.setUniform1f("intensity",4*this._attenuation/v**6),d.bindTexture(this._noiseTexture,"rnm"),d.bindTexture(r,"normalMap"),d.bindTexture(t,"depthMap"),Object(b.i)(this.quadVAO)&&(this.quadVAO=Object(vc.d)(this._rctx));const O=this.quadVAO;i.bindVAO(O),i.drawArrays(5,0,Object(Ql.f)(O,"geometry"));const j=this._blurTechnique.program;i.useProgram(j),j.bindTexture(this._ssaoFBO.colorTexture,"tex"),j.bindTexture(r,"normalMap"),j.bindTexture(t,"depthMap"),i.setViewport(0,0,c/this._BLUR_F,u/this._BLUR_F),i.bindFramebuffer(this._blur0FBO),j.setUniform2f("screenDimensions",c,u),j.setUniform2f("blurSize",0,1*this._BLUR_F/u),j.setUniform1i("radius",4),j.setUniform1f("g_BlurFalloff",.08),j.setUniform2f("nearFar",e.near,e.far),y>5e4&&(g=Math.max(0,g-(y-5e4))),j.setUniform1f("projScale",g),j.setUniform2f("zScale",1,0),i.drawArrays(5,0,Object(Ql.f)(O,"geometry")),j.setUniform2f("blurSize",1*this._BLUR_F/c,0),i.bindFramebuffer(this._blur1FBO),j.bindTexture(this._blur0FBO.colorTexture,"tex"),i.drawArrays(5,0,Object(Ql.f)(O,"geometry")),i.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}bind(e){this.enabled&&Object(b.j)(this._blur1FBO)&&Object(b.j)(this._ssaoFBO)?(e.bindTexture(this._blur1FBO.colorTexture,"ssaoTex"),e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height)):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)}_selectPrograms(){const e=this._samples<=8?0:this._samples<=16?1:this._samples<=32?2:3;this._ssaoTechniqueConfig.samples=e,this._ssaoTechniqueConfig.output=0,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(rC,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=1,this._blurTechnique=this._techniqueRep.releaseAndAcquire(rC,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources((()=>{this._enabled&&this._initialize()})))}_loadResources(e){this._data?e():r.e(184).then(r.bind(null,1070)).then((t=>{this._data=t,e()}))}_initialize(){const e={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},t={colorTarget:0,depthStencilTarget:0};Object(El.a)(this._data.noiseTexture).then((r=>{this._enabled&&(this._ssaoFBO=new Vj.a(this._rctx,t,e),this._blur0FBO=new Vj.a(this._rctx,t,e),this._blur1FBO=new Vj.a(this._rctx,t,e),this._noiseTexture=new $l.a(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:r.width,height:r.height},r),this._requestRender())})),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Object(b.f)(this._noiseTexture),this._blur1FBO=Object(b.f)(this._blur1FBO),this._blur0FBO=Object(b.f)(this._blur0FBO),this._ssaoFBO=Object(b.f)(this._ssaoFBO)}get gpuMemoryUsage(){return(Object(b.j)(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(Object(b.j)(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(Object(b.j)(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}},oC=r(376),lC=r(485);class cC{constructor(e){this.factory=e,this.originData=new Map}acquire(e){return this.register(this.factory.getOrigin(e))}register(e){const t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:Object(Al.d)(),origin:e}),e)}release(e){const t=this.originData.get(e.id);t&&(t.refCount--,0===t.refCount&&this.originData.delete(e.id))}updateViewMatrices(e){this.originData.forEach((t=>{Object(Pl.d)(t.viewMatrix,e),function(e,t){const r=t,i=e[0],n=e[1],s=e[2];r[12]+=i*r[0]+n*r[4]+s*r[8],r[13]+=i*r[1]+n*r[5]+s*r[9],r[14]+=i*r[2]+n*r[6]+s*r[10],r[14]+=i*r[3]+n*r[7]+s*r[11]}(t.origin.vec3,t.viewMatrix)}))}getViewMatrix(e){return this.originData.get(e.id).viewMatrix}}var uC=r(149),dC=r(158),hC=r(405),pC=r(98),fC=r(625);class bC extends Dl.a{bindPass(e){const t=this.program,{edgeRenderParameters:r,bindParameters:i}=e;Tx.a.bindViewProjTransform(t,r.viewProjectionTransform),t.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",r.transformNormal_ViewFromGlobal),t.setUniformMatrix4fv("uProj",i.camera.projectionMatrix),t.setUniform2f("uDepthBias",.5,-4e-4),t.setUniform2f("uPixelToNDC",2/i.camera.fullViewport[2],2/i.camera.fullViewport[3]),t.setUniform2f("uNDCToPixel",i.camera.fullViewport[2]/2,i.camera.fullViewport[3]/2),t.setUniform1f("uDistanceFalloffFactor",r.distanceFalloffFactor),t.setUniform2f("uViewportDimInv",1/i.camera.fullViewport[2],1/i.camera.fullViewport[3]),t.setUniform1f("uPixelRatio",i.camera.pixelRatio||1)}initializeProgram(e){const t=bC.shader.get(),r=this.configuration,i=t.build({slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,silhouette:r.silhouette,legacy:r.legacy,antialiasing:r.antialiasing,mode:r.mode,doublePrecisionRequiresObfuscation:r.doublePrecisionRequiresObfuscation,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new kl.a(e.rctx,i,dC.b)}initializePipeline(e){const t=e.rctx.capabilities.blendMinMax;return Object(zl.g)(t?{blending:Object(zl.h)(1,1,0,1,32774,t.MAX),depthTest:{func:515},colorWrite:zl.d}:{depthTest:{func:515},depthWrite:zl.e,colorWrite:zl.d})}}bC.shader=new Il.a(fC.a,(()=>r.e(207).then(r.bind(null,1072)))),function(e){class t extends Fl.a{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.mode=0,this.doublePrecisionRequiresObfuscation=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(i.a)([Object(Fl.b)()],t.prototype,"slicePlaneEnabled",void 0),Object(i.a)([Object(Fl.b)()],t.prototype,"silhouette",void 0),Object(i.a)([Object(Fl.b)()],t.prototype,"legacy",void 0),Object(i.a)([Object(Fl.b)()],t.prototype,"antialiasing",void 0),Object(i.a)([Object(Fl.b)({count:3})],t.prototype,"mode",void 0),Object(i.a)([Object(Fl.b)()],t.prototype,"doublePrecisionRequiresObfuscation",void 0),Object(i.a)([Object(Fl.b)()],t.prototype,"multipassTerrainEnabled",void 0),Object(i.a)([Object(Fl.b)()],t.prototype,"cullAboveGround",void 0),e.Configuration=t}(bC||(bC={}));const mC={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};class gC{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const yC={solid:0,sketch:1,uber:2};class vC{constructor(e,t,r){this.rctx=e,this.shaderTechniqueRepository=t,this.config=new bC.Configuration,this.technique=null,this.refCount=new gC,this.renderables=new Set,this.sortedRenderables={1:{1:new Wb.a,2:new Wb.a},2:{1:new Wb.a,2:new Wb.a}},this.renderablesDirty=!1,this.settings={...mC,...r},this.key=vC.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);const i=this.settings.strokesTexture.variants;this.writerSettings={variants:i,reducedPrecision:$b.a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES},this.config.legacy=this.settings.legacy,this.config.mode=yC[this.settings.type],this.config.silhouette=!1,this.config.antialiasing=!!this.rctx.capabilities.blendMinMax,this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled,this.config.doublePrecisionRequiresObfuscation=Object(Px.b)(e)}dispose(){this.technique=Object(b.q)(this.technique)}addRenderable(e){this.renderables.add(e),this.renderablesDirty=!0}removeRenderable(e){this.renderables.delete(e),this.renderablesDirty=!0}setRenderablesDirty(){this.renderablesDirty=!0}forEachRenderable(e,t){this.renderablesDirty&&this.sortRenderables(),this.sortedRenderables[t][1].forAll(e),this.sortedRenderables[t][2].forAll(e)}setMultipassParameters(e){this.config.multipassTerrainEnabled=!!e.multipassTerrainEnabled&&e.multipassTerrainEnabled,this.config.cullAboveGround=!!e.cullAboveGround&&e.cullAboveGround}bindRegularEdges(e,t){this.setMultipassParameters(e),this.config.silhouette=!1,this.technique=this.shaderTechniqueRepository.releaseAndAcquire(bC,this.config,this.technique),this.technique.bindPass({bindParameters:e,edgeRenderParameters:t}),this.rctx.setPipelineState(this.technique.pipeline),this.rctx.useProgram(this.technique.program)}bindSilhouetteEdges(e,t){this.setMultipassParameters(e),this.config.silhouette=!0,this.technique=this.shaderTechniqueRepository.releaseAndAcquire(bC,this.config,this.technique),this.technique.bindPass({bindParameters:e,edgeRenderParameters:t}),this.rctx.setPipelineState(this.technique.pipeline),this.rctx.useProgram(this.technique.program)}renderRegularEdges(e,t,r){this.render(e,e.regular.vao,t,r)}renderSilhouetteEdges(e,t,r){this.render(e,e.silhouette.vao,t,r)}render(e,t,r,i){this.setUniforms(e,r),this.rctx.bindVAO(t),this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,i)}setUniforms(e,t){const r=this.technique.program;if(e.components.buffer.textureBuffer.bind(r,OC,jC),t.multipassTerrainEnabled&&(r.setUniform2fv("cameraNearFar",t.camera.nearFar),r.setUniform2fv("inverseViewport",t.inverseViewport),Object(pC.a)(r,t)),"origin"in e.transform)r.setUniformMatrix4fv("uView",t.localViewMatrixForEdges),r.setUniformMatrix4fv("uModel",e.transform.modelMatrix),Object(D_.b)(r,this.settings,t.slicePlane,e.transform.origin.vec3);else{const i=new Bx(e.transform.position),n=Object(Dd.n)(_C,Object(Dd.e)(_C,e.transform.rotationScale)),s=new Rx;Object(Cl.m)(s.worldFromModel_TL,i.low),Object(Cl.m)(s.worldFromModel_TH,i.high),Object(Dd.g)(s.worldFromModel_RS,e.transform.rotationScale),Object(Dd.g)(s.transformNormal_GlobalFromModel,n),Tx.a.bindModelTransform(r,s),r.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",s.transformNormal_GlobalFromModel);const a=t.camera.viewInverseTransposeMatrix,o=Object(Cl.y)(wC,a[3],a[7],a[11]);Object(D_.b)(r,this.settings,t.slicePlane,o)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(r),r.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[3]/2))}setSketchUniforms(e){const t=this.settings.strokesTexture,r=t.texture;Object(b.i)(r)||(e.bindTexture(r,"uStrokesTexture"),e.setUniform2f("uStrokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",Object(Bt.n)(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants))}sortRenderables(){this.renderablesDirty=!1,this.sortedRenderables[1][1].clear(),this.sortedRenderables[1][2].clear(),this.sortedRenderables[2][1].clear(),this.sortedRenderables[2][2].clear(),this.renderables.forEach((e=>{0!==e.objectTransparency&&0!==e.edgeTransparency&&this.sortedRenderables[e.objectTransparency][e.edgeTransparency].push(e)}));const e=(e,t)=>"origin"in e.transform&&"origin"in t.transform?e.transform.origin.id<t.transform.origin.id?-1:e.transform.origin.id>t.transform.origin.id?1:0:0;this.sortedRenderables[1][1].sort(e),this.sortedRenderables[1][2].sort(e),this.sortedRenderables[2][1].sort(e),this.sortedRenderables[2][2].sort(e)}static getKey(e,t,r){return`edges-t:${e}:${t}:${r}`}}const OC="uComponentDataTex",jC="uComponentDataTexInvDim",_C=Object(Wj.b)(),wC=Object(S.e)();var xC=r(448),SC=r(406),TC=r(673);class CC extends xC.a{constructor(e){super("EdgeProcessingWorker","wrappedWork",e)}async process(e,t,r){if(r)return Object(TC.work)(e);const i=this._packInput(e),n=await this.invoke(i,t);return this._unpackOutput(n)}getTransferList(e){return[e.dataBuffer]}_packInput(e){return{dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate,indicesBuffer:e.indices.buffer,indicesType:Object(Tw.j)(e.indices)?"Uint32Array":"Uint16Array",indicesLength:e.indicesLength}}_unpackOutput(e){return{regular:{instancesData:Object(SC.b)(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:Object(SC.b)(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}}var MC=CC;function PC(e,t){if(!e)return null;const r=e.length/2,i=AC*r,n=new Array(r);let s=0;const a=1===t;for(let o=0;o<e.length;o+=2){const t=(e[o]+e[o+1])/2;n[s++]=a?Math.min(i,1-(1-t)*EC):Math.min(i,t*EC)}return n}const AC=.1,EC=.5;class RC{constructor(e,t,r,i,n){this.resolution=e,this.normalizationScale=t,this.amplitude=r,this.variants=i,this.texture=n}dispose(){this.texture=Object(b.f)(this.texture)}}const IC={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function DC(e){let t=null;for(const r of e){const e=r.type;if(kC(r))if(Object(b.i)(t))t=e;else if(t!==e)return"uber"}return Object(b.j)(t)?t:"solid"}function FC(e){let t=0;for(const{material:r}of e)if(kC(r)){if(r.color[3]*r.opacity<1)return 1;t=2}return t}function LC(e){let t=0;for(const{material:r}of e)if(kC(r)){switch(r.objectTransparency){case 1:case 0:return 1;case 2:if(r.opacity<1)return 1}t=2}return t}function kC(e){return e.size*e.color[3]*e.opacity>0}function zC(e,t,r,i){return r*(i/e)*2*Math.tan(.5*t)}function VC(e,t,r){return e.length-function(e,t){const r=Object(Ma.b)(e,t,!0);return-1===r?t<e[0]?0:e.length:r}(e,t*r.minimumEdgeLength)}function NC(e,t,r,i){for(let n=0;n<e.length;n++){const s=e[n].index,a=t[n],o=t[n+1];if(i)for(let e=a;e<o;e++){const t=i[e];r.set(t,s)}else for(let e=a;e<o;e++)r.set(e,s)}}const UC=f.a.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let BC=class extends N.a{constructor(e){super(e),this.updatingHandles=new B.a,this.perObjectData=new Map,this.renderers=new Map,this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.workerAbort=Object(m.e)(),this.tmpModelPosition=Object(S.e)(),this.tmpCameraPosition=Object(S.e)(),this.localOrigins=new cC(new lC.a(e.renderSR))}initialize(){this.worker=new MC(this.schedule),this.componentColorManager=new $x(this.rctx,2);const e=dC.e.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,0===t||3===t?0:1),e.sideness.set(t,1,0===t||1===t?0:1);this.verticesBufferObject=Wl.a.createVertex(this.rctx,35044,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach((e=>this._discardObjectEntry(e))),this.perObjectData.clear(),this.strokesTexture=Object(b.f)(this.strokesTexture),this.componentColorManager=Object(b.e)(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=Object(b.f)(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,r,i,n,s,a,o){if(this.hasObject(e))return;let l;const c=new GC(new Promise((e=>l=e)),r);this.perObjectData.set(e,c),await this.updatingHandles.addPromise(this.addComponentGeometry(t,c,i,n,s,a,o)),this.setNeedsRender(),l()}async addOrUpdateObject3D(e,t,r,i){if(this.destroyed)return void UC.warn("Attempt to add an object to a destroyed instance");const n=this.perObjectData.get(e);let s;const a=new GC(new Promise((e=>s=e)));this.perObjectData.set(e,a);const o=new Array;if(r.mergeGeometries&&e.geometries.length>1&&function(e){let t=null,r=null;for(let n=0;n<e.geometries.length;n++){var i;const s=e.geometryRecords[n];if(s.material.supportsEdges){if(t){if(!Object(Ma.e)(t,s.transformation))return!1}else t=s.transformation;if(!r&&Object(b.j)(s.origin))r=s;else if(Object(b.j)(null==(i=r)?void 0:i.origin)&&Object(b.j)(s.origin)&&r.origin.id!==s.origin.id)return!1}}return!0}(e))o.push(this.addObjectMergedGeometries(e,a,t,r,i));else for(let l=0;l<e.geometries.length;l++){const n=e.geometries[l],s=e.geometryRecords[l];s.material.supportsEdges&&o.push(this.addGeometry(e,a,n,s,t[0],r,i))}await this.updatingHandles.addPromise(Promise.all(o)),this._discardObjectEntry(n),this.setNeedsRender(),s()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach((e=>this.removeRenderable(e))),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const r=t instanceof Array?e=>t[e]:()=>t;(await this.updatingHandles.addPromise(this.getObjectEntry(e))).renderables.forEach((e=>{const t=e.components.meta.length;for(let i=0;i<t;i++){const t=r(i),n=e.components.meta[i],s=n.index;n.material.opacity=t,e.components.buffer.textureBuffer.setDataElement(s,1,3,255*t)}this.updateTransparency(e)})),this.setNeedsRender()}async updateAllComponentMaterials(e,t,r,i){const n=e instanceof uC.a,s=!!r.slicePlaneEnabled,a=DC(t),o=vC.getKey(a,s,n);(await this.updatingHandles.addPromise(this.getObjectEntry(e))).renderables.forEach((e=>{if(o!==e.rendererKey){const t=this.renderers.get(e.rendererKey),r=this.acquireRenderer(a,s,n);t.removeRenderable(e),t.refCount.decrement(),e.rendererKey=o,r.addRenderable(e)}for(let r=0;r<t.length;r++)e.components.meta[r].material=t[r];i&&this.updateComponentBuffer(e.components),this.updateTransparency(e)})),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this.getObjectEntry(e))).renderables.forEach((e=>e.visible=t)),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";return await t.loaded,t}removeAll(){this.perObjectData.forEach(((e,t)=>this.removeObject(t)))}render(e,t){if(Object(b.i)(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const r=e.camera.viewInverseTransposeMatrix,i=Object(S.e)(),n=new Bx,s=new Tx.a.ViewProjectionTransform,a=Object(Fd.b)();Object(Cl.y)(i,r[3],r[7],r[11]),n.set(i),Object(Cl.m)(s.worldFromView_TH,n.high),Object(Cl.m)(s.worldFromView_TL,n.low),Object(Dd.f)(s.viewFromCameraRelative_RS,e.camera.viewMatrix),Object(Pl.d)(s.projFromView,e.camera.projectionMatrix);const o=Object(Fd.b)();Object(Dd.n)(o,s.viewFromCameraRelative_RS),Object(Dd.e)(a,o);let l=0,c=0;if(this.renderers.forEach((e=>{0===e.refCount.value?(this.renderers.delete(e.key),e.dispose()):e.forEachRenderable((e=>{l+=e.statistics.averageEdgeLength,c++}),t)})),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),0===c)return;const u={distanceFalloffFactor:40*l/c,minimumEdgeLength:zC(e.camera.fullViewport[3],e.camera.fovY,1,3.5*e.camera.pixelRatio),transparency:t,viewProjectionTransform:s,transformNormal_ViewFromGlobal:a};this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach((t=>{this.renderRegularEdges(t,e,u),this.renderSilhouetteEdges(t,e,u)}))}updateTransparency(e){const t=FC(e.components.meta),r=LC(e.components.meta);t===e.edgeTransparency&&r===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=r,this.renderers.get(e.rendererKey).setRenderablesDirty())}computeModelTransformWithLocalOrigin(e,t,r){if(e.getCombinedStaticTransformation(t,r),Object(b.j)(t.origin))this.localOrigins.register(t.origin);else{const e=Object(Cl.y)(this.tmpModelPosition,r[12],r[13],r[14]);t.origin=this.localOrigins.acquire(e)}return function(e,t){const r=t,i=-e[0],n=-e[1],s=-e[2],a=r[3],o=r[7],l=r[11],c=r[15];r[0]+=a*i,r[1]+=a*n,r[2]+=a*s,r[4]+=o*i,r[5]+=o*n,r[6]+=o*s,r[8]+=l*i,r[9]+=l*n,r[10]+=l*s,r[12]+=c*i,r[13]+=c*n,r[14]+=c*s}(t.origin.vec3,r),t.origin}updateComponentBuffer(e){const{meta:t,buffer:r}=e;for(let i=0;i<t.length;i++){const e=t[i].material,n=t[i].index,s=Object(Bt.e)(Math.round(8*e.size),0,255),a=Object(Bt.e)(e.extensionLength,-128,127)+128,o="solid"===e.type?0:1,l=255*e.opacity,c=e.color,u=255*c[0],d=255*c[1],h=255*c[2],p=255*c[3];r.textureBuffer.setData(n,0,u,d,h,p),r.textureBuffer.setData(n,1,s,a,o,l)}}createComponentBuffers(e){if(Object(b.i)(this.componentColorManager))return null;const t=new Array,r=this.componentColorManager.getBuffer(e.length);for(let n=0;n<e.length;n++){const i=e[n],s=r.acquireIndex();t.push({index:s,material:i})}const i={meta:t,buffer:r};return this.updateComponentBuffer(i),i}extractEdges(e,t,r,i,n,s=n.length){return this.worker.process({data:t,indices:n,indicesLength:s,writerSettings:e,skipDeduplicate:r},this.workerAbort.signal,i)}createEdgeResources(e){const t={};if(Object(b.i)(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const r=new Zl.a(this.rctx,dC.b,{vertices:dC.f,instances:hC.a.glLayout},{vertices:this.verticesBufferObject,instances:Wl.a.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const r=new Zl.a(this.rctx,dC.b,{vertices:dC.f,instances:hC.b.glLayout},{vertices:this.verticesBufferObject,instances:Wl.a.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo}}return t}async addGeometry(e,t,r,i,n,s,a){const o=r.vertexAttributes.get("position"),l=r.indices.get("position"),c=Object(Al.d)(),u={position:o,indices:l,modelTransform:c,origin:this.computeModelTransformWithLocalOrigin(e,i,c)};return this.addPositionData(t,u,r.edgeIndicesLength,n,s,a)}async addPositionData(e,t,r,i,n,s=!1){if(null==e.loaded)return;const a=this.createComponentBuffers([i]);if(Object(b.i)(a)||r<=0)return;const o=this.acquireRenderer(i.type,!!n.slicePlaneEnabled),{modelTransform:l,origin:c}=t,u=t.indices,d=t.position,h=d.data.length/d.size,p=dC.a.createBuffer(h);for(let b=0;b<h;b++)p.position.set(b,0,d.data[b*d.size+0]),p.position.set(b,1,d.data[b*d.size+1]),p.position.set(b,2,d.data[b*d.size+2]);NC(a.meta,[0,p.componentIndex.count],p.componentIndex);const f=await this.updatingHandles.addPromise(this.extractEdges(o.writerSettings,p,!1,s,u,r));if(null==e.loaded)return;const{regular:m,silhouette:g}=this.createEdgeResources(f),y=(m?m.vao.size:0)+(g?g.vao.size:0),v={regular:m,silhouette:g,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:y,averageEdgeLength:f.averageEdgeLength},components:a,visible:!0,edgeTransparency:FC(a.meta),objectTransparency:LC(a.meta),distanceToCamera:0,rendererKey:o.key};e.renderables.push(v),o.addRenderable(v),this.gpuMemoryUsage+=y}async addComponentGeometry(e,t,r,i,n,s,a){if(null==t.loaded)return;const o=this.createComponentBuffers(s);if(Object(b.i)(o))return;const l=DC(s),c=this.acquireRenderer(l,a.slicePlaneEnabled||!1,!1),u=dC.a.createBuffer(r.count);Object(oC.a)(u.position,r),NC(o.meta,n,u.componentIndex,i);const d=c.writerSettings,h=await this.updatingHandles.addPromise(this.extractEdges(d,u,!0,!1,i));if(null==t.loaded)return;const{regular:p,silhouette:f}=this.createEdgeResources(h),m=(p?p.vao.size:0)+(f?f.vao.size:0),g={regular:p,silhouette:f,transform:e,statistics:{gpuMemoryUsage:m,averageEdgeLength:h.averageEdgeLength},components:o,visible:!0,edgeTransparency:FC(o.meta),objectTransparency:LC(o.meta),distanceToCamera:0,rendererKey:c.key};t.renderables.push(g),c.addRenderable(g),this.gpuMemoryUsage+=m}async addObjectMergedGeometries(e,t,r,i,n){const s=new Map;let a=0,o=null,l=null;for(let m=0;m<e.geometries.length;m++){const t=e.geometries[m],r=e.geometryRecords[m];if(!r.material.supportsEdges)continue;!l&&r.origin&&(l=r);const i=t.indices.get("position");a+=t.edgeIndicesLength,null!=o&&o!==Uint16Array||(o=Object(Tw.i)(i)?Uint16Array:Uint32Array)}const c=a?new o(a):null,u=[];let d=0;for(let m=0;m<e.geometries.length;m++){const t=e.geometries[m];if(!e.geometryRecords[m].material.supportsEdges)continue;const r=t.vertexAttributes.get("position"),i=t.indices.get("position");let n=s.get(r.data);if(null==n){n=u.length/3;for(let e=0;e<r.data.length;e+=r.size)u.push(r.data[e+0]),u.push(r.data[e+1]),u.push(r.data[e+2]);s.set(r.data,n)}if(i)for(let e=0;e<t.edgeIndicesLength;e++)c[d++]=n+i[e]}const h=l||e.geometryRecords[0],p=Object(Al.d)(),f=this.computeModelTransformWithLocalOrigin(e,h,p);for(let m=0;m<e.geometryRecords.length;m++)e.geometryRecords[m].origin=f;const b={position:{data:u,size:3},indices:c,modelTransform:p,origin:f};await this.updatingHandles.addPromise(this.addPositionData(t,b,c.length,r[0],i,n))}acquireRenderer(e,t,r=!0){const i=vC.getKey(e,t,r);let n=this.renderers.get(i);return Object(b.i)(this.strokesTexture)&&(this.strokesTexture=function(e){const t=IC.resolution,r=t/2,i=new Uint8Array(4*t*t),n=4*t*r,s=IC.amplitude,a=2*s,o=4*t,l=Object(Bt.n)(t)+1,c=IC.strokes.length;let u=(l-1)*c*o;for(const{distance:h,pressure:p}of IC.strokes){let e=h,t=p,r=u;for(let s=0;s<l;s++){0!==s&&(e=PC(e,0),t=PC(t,1));for(let s=0;s<IC.resolution;s++){const o=.5+(e?e[s%e.length]/a:0),l=t?t[s%t.length]:1;Object(Oc.i)(o,i,r),Object(Oc.i)(l,i,r+n),r+=4}r-=o*(c+1)}u+=o}const d=new $l.a(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:t,height:t,wrapMode:10497},i);return new RC(t,a,s,c,d)}(this.rctx)),n||(n=new vC(this.rctx,this.techniqueRepository,{type:e,slicePlaneEnabled:t,strokesTexture:this.strokesTexture,legacy:r}),this.renderers.set(i,n)),n.refCount.increment(),n}removeRenderable(e){!function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(const t of e.components.meta)e.components.buffer.releaseIndex(t.index)}}updateObjectCameraDistances(e){const t=e.camera.viewInverseTransposeMatrix;Object(Cl.y)(this.tmpCameraPosition,t[3],t[7],t[11]),this.perObjectData.forEach(((e,t)=>{const r=Object(b.j)(e.center)?e.center:Object(pu.g)(t.boundingVolumeWorldSpace.bounds),i=Object(Cl.o)(r,this.tmpCameraPosition);e.renderables.forEach((e=>e.distanceToCamera=i))}))}renderRegularEdges(e,t,r){e.bindRegularEdges(t,r);const i=r.transparency;e.forEachRenderable((i=>{if(!i.visible||!i.regular)return;const n=VC(i.regular.lod.lengths,i.distanceToCamera,r);"origin"in i.transform&&(t.localViewMatrixForEdges=this.localOrigins.getViewMatrix(i.transform.origin)),e.renderRegularEdges(i,t,n),this.numberOfRenderedEdges+=n}),i)}renderSilhouetteEdges(e,t,r){e.bindSilhouetteEdges(t,r);const i=r.transparency;e.forEachRenderable((i=>{if(!i.visible||!i.silhouette)return;const n=VC(i.silhouette.lod.lengths,i.distanceToCamera,r);"origin"in i.transform&&(t.localViewMatrixForEdges=this.localOrigins.getViewMatrix(i.transform.origin)),e.renderSilhouetteEdges(i,t,n),this.numberOfRenderedEdges+=n}),i)}};Object(i.a)([Object(j.b)({constructOnly:!0})],BC.prototype,"rctx",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],BC.prototype,"renderSR",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],BC.prototype,"techniqueRepository",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],BC.prototype,"setNeedsRender",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],BC.prototype,"schedule",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],BC.prototype,"updatingHandles",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],BC.prototype,"updating",null),BC=Object(i.a)([Object(w.a)("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],BC);class GC{constructor(e,t=null){this.center=t,this.renderables=new Array,this.loaded=e,this.loaded.then((()=>{null!=this.loaded&&(this.loaded=!0)}))}}var qC=r(533),HC=r(532),WC=r(436),$C=r(523);const QC=[],ZC=[],XC=Object(Al.d)(),JC=Object(Al.d)(),YC=Object(Al.d)(),KC=Object(Al.d)(),eM=Object(Al.d)();var tM=class{constructor(e,t,r,i,n,s,a,o,l){this._materialRep=e,this._shaderTechniqueRepository=r,this._rctx=i,this._compositingHelper=n,this._magnifierHelper=s,this.requestRender=a,this._stage=l,this._materialRenderers=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new WC.a,this._antialiasing=1,this._oitEnabled=!1,this._multipassTerrain=!0,this._opaqueTerrain=!0,this._lighting=new qC.a,this._handles=new F.a,this.renderHiddenTransparentEdges=()=>{},this._smaaPass=new eC(this._rctx,r),this._oitEnabled=this._hasOITSupport,this.requestRender(),this._offscreenRendering=new qS(this._rctx,this._compositingHelper),this._sliceHelper=new XT,this._shadowMap=new zT(this._rctx,l.viewingMode,2),this._ssaoHelper=new aC(r,this._rctx,(()=>this.requestRender())),this._highlightHelper=new zS(r,this._rctx),this._shadowHighlightHelper=new QT(this._rctx,l.viewingMode),this._shadowAccumulator=new VT(this._rctx,r,l,((e,t)=>{this.renderPassManager.shadowCastingEnabled=!0,this._renderPlugins.prepareRender(e,t),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled}),((e,t,r,i)=>{e.start(r,t,i),this.renderShadowCascades(4,e),r.setGLViewport(this._rctx),this.ensureCameraBindParameters(r)}),(()=>this.requestRender())),this._bindParameters={slot:null,camera:null,inverseViewport:Object(tc.b)(),shadowMap:this._shadowMap,shadowMappingEnabled:this._shadowMap.enabled,ssaoHelper:this._ssaoHelper,ssaoEnabled:this._ssaoHelper.enabled,origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:this._sliceHelper.plane,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,multipassGeometryEnabled:!1,cullAboveGround:!1,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,highlightColorTexture:null},this._renderContext=new $S.b(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderContext.multipassTerrainParams={camera:null,multipassTerrainEnabled:!1,cullAboveGround:!1,terrainLinearDepthTexture:null},this._renderContext.multipassGeometryParams={multipassGeometryEnabled:!1,geometryLinearDepthTexture:null},this._renderContext.ssrParams={camera:null,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1},this._renderPlugins=new ZS({renderContext:this._renderContext,shaderTechniqueRep:r,textureRep:t,materialRep:this._materialRep,requestRender:this.requestRender,schedule:o}),this.renderPassManager=new AS(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([Object(y.a)($b.a,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",(e=>{this.renderHiddenTransparentEdges=e?()=>this.renderEdges(1):()=>{},this.requestRender()})),Object(y.a)(this._stage,"camera",(()=>this.requestRender()),!0)])}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}dispose(){this._handles.destroy(),this._smaaPass.disable(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._edgeView=Object(b.e)(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=Object(b.f)(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlightHelper.dispose(),this._shadowHighlightHelper.dispose(),this._shadowAccumulator.dispose(),DS.a.prune(),this._content.clear()}get updating(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources||Object(b.j)(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return Object(b.i)(this._edgeView)&&(this._edgeView=new BC({rctx:this._rctx,renderSR:this._stage.renderSR,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this.requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(this._edgeView.watch("updating",(()=>this.requestRender()),!0)),this.requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return null===this._bindParameters.reprojectionMat||Object(Pl.f)(this._bindParameters.reprojectionMat,eM)}get hasShadowsEnabled(){var e;return!(null==(e=this._shadowMap)||!e.enabled)}setRenderParameters(e){const{renderPassManager:t,_shadowMap:r,_ssaoHelper:i}=this;void 0!==e.screenSpaceReflectionsEnabled&&t.screenSpaceReflectionsEnabled!==e.screenSpaceReflectionsEnabled&&(t.screenSpaceReflectionsEnabled=e.screenSpaceReflectionsEnabled,this.requestRender()),void 0===e.shadowMap||r.enabled===e.shadowMap&&t.shadowCastingEnabled===e.shadowMap||(r.enabled=e.shadowMap,t.shadowCastingEnabled=e.shadowMap,this.requestRender()),void 0!==e.shadowMapMaxCascades&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this.requestRender()),void 0!==e.ssao&&i.enabled!==e.ssao&&(i.enabled=e.ssao,this.requestRender()),void 0!==e.ssaoAttenuation&&i.attenuation!==e.ssaoAttenuation&&(i.attenuation=e.ssaoAttenuation,this.requestRender()),void 0!==e.ssaoRadius&&i.radius!==e.ssaoRadius&&(i.radius=e.ssaoRadius,this.requestRender()),void 0!==e.ssaoSamples&&i.samples!==e.ssaoSamples&&(i.samples=e.ssaoSamples,this.requestRender()),e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this.requestRender());const n=e.antialiasingEnabled?1:0;void 0!==e.antialiasingEnabled&&this._antialiasing!==n&&(this._antialiasing=n,this.requestRender()),void 0!==e.highQualityTransparency&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this.requestRender()),void 0!==e.defaultHighlightOptions&&(this._highlightHelper.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlightHelper.setDefaultOptions(e.defaultHighlightOptions),this.requestRender()),void 0!==e.slicePlane&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=Object(b.s)(e.slicePlane),this.requestRender());const s=this._rctx.parameters.maxTextureImageUnits>=10&&e.waterReflectionEnabled;void 0!==e.waterReflectionEnabled&&this._waterReflectionEnabled!==s&&(this._waterReflectionEnabled=s,this.requestRender()),void 0!==e.opaqueTerrain&&this._opaqueTerrain!==e.opaqueTerrain&&(this._opaqueTerrain=e.opaqueTerrain,this.requestRender()),void 0!==e.hasOverlayWater&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this.requestRender()),void 0!==e.shadowAccumulationOptions&&this._shadowAccumulator.setOptions(e.shadowAccumulationOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.capabilities.textureFloat&&this._rctx.capabilities.textureFloat.textureFloat&&this._rctx.capabilities.colorBufferFloat&&this._rctx.capabilities.colorBufferFloat.textureFloat}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:r,updates:i}=e;if(0===t.length&&0===r.length&&0===i.length)return;r.forAll((({id:e})=>this._content.delete(e))),t.forAll((e=>this._content.set(e.id,e)));const n=Object(QS.a)(e);let s=!1;n.forEach(((e,t)=>{let r=this._materialRenderers.get(t);if(!r){if(!(e.adds.length>0))return;r=new HC.a(this._rctx,this._materialRep,t),this._materialRenderers.set(t,r)}r.modify(e),r.isEmpty&&(s=!0)})),s&&this._materialRenderers.forEach(((e,t)=>{e.isEmpty&&(this._materialRenderers.delete(t),e.dispose())})),this._hasHighlights=Object(Na.b)(this._materialRenderers,(e=>e.hasHighlights)),this._hasOccludees=Object(Na.b)(this._materialRenderers,(e=>e.hasOccludees)),this._hasWater=Object(Na.b)(this._materialRenderers,(e=>e.hasWater)),this.requestRender()}updateLogic(e){let t=!1;return this._materialRenderers.forEach((r=>{r.updateLogic&&(t=r.updateLogic(e)||t)})),t}updateLightSources(e,t,r){this._lighting.groundLightingFactor=t,this._lighting.globalFactor=r,this._lighting.set(e)}render(e,t,r,i){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.lighting=this._lighting,this._renderContext.hasOccludees=this._hasOccludees,this._renderContext.transparencyPassType=3,this._bindParameters.transparencyPassType=3;const n=this._offscreenRendering;n.needLastFrameColorTexture=this.hasWaterReflection,n.advanceCurrentRenderTarget();const s=this._sliceHelper.plane;i&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this.needsShadowAccumulation&&(this.renderPassManager.shadowCastingEnabled=!0),this._renderPlugins.prepareRender(t,r),this.performanceInfo.advance(0);const a=this.computeDepthRange(t);this.renderShadowMap(e,t,this._lighting.lightingMainDirection,a),this.performanceInfo.advance(1),n.initializeFrame(t),this.ensureBindParameters(t),this.renderLinearDepth(),this.performanceInfo.advance(2),this.accumulateShadows(a,t,r),this.renderNormal(),this.performanceInfo.advance(3),this.ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(t,n.linearDepthTexture,n.normalTexture),this.performanceInfo.advance(4),this.performanceInfo.stats.reset(),this._renderContext.pass=0,n.bindFramebuffer(),this.renderSlot(0),this.renderOpaqueGeometry(),this.performanceInfo.advance(5);const o=this._multipassTerrain&&!this._opaqueTerrain;this.renderTerrainLinearDepth(o),this.setMultipassFlags(o),this.setTerrainCulling(o),this.renderEdges(2),this.performanceInfo.advance(6),this.renderHiddenTransparentEdges(),this._oitEnabled?this.renderOrderIndependentTransparency((()=>this.renderTransparentGeometry()),!1):this.renderTransparentGeometry(),this.performanceInfo.advance(7),this.renderGeometryLinearDepth(o);const l={hudVisibility:!1,transparentTerrain:!1};l.hudVisibility=this.renderHUDVisibility(),o||this.renderInternalSlot(20),this.performanceInfo.advance(9),this.renderEdges(1,o),this.performanceInfo.advance(8),l.transparentTerrain=this.renderTransparentTerrain(),l.transparentTerrain&&l.hudVisibility&&(o?this.renderLineCallouts(0):n.compositeTransparentTerrainOntoHUDVisibility(),this.renderHUD(0,n.framebuffer),this.performanceInfo.advance(16)),this.performanceInfo.advance(10),this.setTerrainCulling(!1),l.transparentTerrain&&(n.compositeTransparentTerrainOntoMain(),o&&(this.renderEdges(2),this.performanceInfo.advance(6),this._oitEnabled?this.renderOrderIndependentTransparency((()=>this.renderTransparentGeometry()),!1):this.renderTransparentGeometry(),this.performanceInfo.advance(7),this.renderEdges(1),this.performanceInfo.advance(8))),o&&this.renderLineCallouts(1),this.setMultipassFlags(!1),this._shadowAccumulator.render(),n.renderToTargets((()=>{this.renderInternalSlot(8),this.renderSlot(15),this.renderSlot(16)}),n.currentColorTarget,n.mainDepth),this.performanceInfo.advance(11),this._renderPlugins.needsLaserlineWithContrastControl&&n.renderTmpAndCompositeToMain((()=>{this.renderSlot(17)}),2),this.performanceInfo.advance(12),this.renderOccluded(),this.performanceInfo.advance(13);const c=!i&&this._magnifierHelper.enabled,u=c&&Object(b.i)(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(u),this.renderAntiAliasing(this._antialiasing,this._offscreenRendering.colorTexture)||this._compositingHelper.composite(this._offscreenRendering.colorTexture,0),this.performanceInfo.advance(14),this.renderHUD(1,u),this.performanceInfo.advance(17),this.renderHighlights(u,this._bindParameters),this.performanceInfo.advance(15),c&&this._magnifierHelper.render(this._rctx,this._bindParameters),u!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,0)),this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera),this._sliceHelper.plane=s,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}readDepthPixels(e,t,r,i,n,s){const a=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this.ensureBindParameters(e),this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const t=17664;this._rctx.clearSafe(t),this.renderGeometryAndTransparentTerrainPass(2)}a.readPixels(t,r,i,n,6408,5121,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}setMultipassFlags(e){this._renderContext.multipassTerrainParams.multipassTerrainEnabled=this._bindParameters.multipassTerrainEnabled=e,this._renderContext.multipassGeometryParams.multipassGeometryEnabled=this._bindParameters.multipassGeometryEnabled=e}setTerrainCulling(e){this._renderContext.multipassTerrainParams.cullAboveGround=this._bindParameters.cullAboveGround=e}renderSlot(e){return this._renderContext.slot=e,this._renderPlugins.render()}renderEdges(e,t=!1){const r=this._edgeView;Object(b.j)(r)&&r.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain((()=>r.render(this._bindParameters,e)),1,t)}renderShadowMap(e,t,r,i){const n=this._shadowMap;if(n.enabled){if($b.a.ENABLE_PROFILE_DEPTH_RANGE&&xS.begin("depthRange"),$b.a.ENABLE_PROFILE_DEPTH_RANGE&&xS.end("depthRange"),n.start(t,r,i),this.needsShadowHighlight){const e=this._shadowHighlightHelper;this.renderShadowCascades(7,this._shadowMap,(t=>n.takeCascadeSnapshotTo(t,e.highlightShadowMapSlot))),n.clear(),this.renderShadowCascades(6,this._shadowMap,(t=>{n.takeCascadeSnapshotTo(t,e.defaultSnapshotSlot),this.renderGeometryAndTransparentTerrainPass(7)}))}else this.renderShadowCascades(4);n.finish(e),t.setGLViewport(this._rctx)}}renderShadowCascades(e,t=this._shadowMap,r=(e=>{})){for(const i of t.getCascades())i.camera.setGLViewport(this._rctx),this.ensureCameraBindParameters(i.camera),this.renderGeometryAndTransparentTerrainPass(e),r(i)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowAccumulation}renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets((()=>this.renderGeometryAndTransparentTerrainPass(2)),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}renderTerrainLinearDepth(e){if(e){const e=this._renderContext.pass;this._renderContext.pass=2,this._offscreenRendering.renderToTargets((()=>this.renderTransparentTerrain()),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=e}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._renderContext.multipassTerrainParams.terrainLinearDepthTexture=this._bindParameters.terrainLinearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}renderGeometryLinearDepth(e){if(e){const e=this._renderContext.pass;this._offscreenRendering.renderToTargets((()=>this.renderGeometryPass(2)),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=e}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._renderContext.multipassGeometryParams.geometryLinearDepthTexture=this._bindParameters.geometryLinearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets((()=>{this.renderGeometryAndTransparentTerrainPass(3)}),this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowAccumulation}computeDepthRange(e){if(!this.needsDepthRange)return tx;const t=lS(e,this._content,this._stage.layers);return Kw(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this.renderGeometryPass(e),this.renderTransparentTerrain()}renderGeometryPass(e){this._renderContext.pass=e,this.renderOpaqueGeometry(),this.renderTransparentGeometry()}renderOpaqueGeometry(){this.renderSlot(1),this.renderSlot(2),this.renderInternalSlot(3),this.renderSlot(4),this.renderSlot(14)}renderTransparentGeometry(){this.renderInternalSlot(5),this.renderSlot(6)}renderTransparentTerrain(){return this.renderSlot(7)}renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility((()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper?this._renderContext.offscreenRenderingHelper.hudVisibilityTexture:null,e=this.renderInternalSlot(12)}),this._multipassTerrain&&!this._opaqueTerrain),e}renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,0===e?this._offscreenRendering.renderToTargets((()=>this.renderInternalSlot(20)),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderInternalSlot(20)}renderHUD(e,t){this._oitEnabled?(this.renderOrderIndependentTransparency((()=>this.renderHUDElements(e)),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,2)):0===e?this._offscreenRendering.renderToTargets((()=>this.renderHUDElements(0)),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderHUDElements(e)}renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this.renderInternalSlot(21),this.renderInternalSlot(18),this.renderInternalSlot(19)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlightHelper.isVisible&&this.needsHighlight}renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const r=this._highlightHelper,i=r.profilingCallback&&Object($C.a)(this._renderContext.rctx);this._renderContext.highlightDepthTexture=t.highlightDepthTexture;const n=this._offscreenRendering.renderToTargets((()=>{this.renderGeometryAndTransparentTerrainPass(5),this._rctx.clearSafe(256),this.renderHUDElements(2)}),this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=n.colorTexture,this.needsShadowHighlight&&this._shadowHighlightHelper.render(t,e),r.render(this._renderContext.camera,n,e),Object(b.j)(i)&&r.profilingCallback&&i.stop((e=>{r.profilingCallback&&r.profilingCallback(e)}))}get needsShadowAccumulation(){return this._shadowAccumulator.isAccumulating}accumulateShadows(e,t,r){this.needsShadowAccumulation&&(this._shadowAccumulator.setAccumulationDependencies(this._offscreenRendering.linearDepthTexture,e,t,r),this._shadowAccumulator.accumulateFixedSamples(),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled)}renderOrderIndependentTransparency(e,t){const r=r=>{this._renderContext.transparencyPassType=r,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._offscreenRendering.renderOITPass((()=>e()),r,t)},i=this._renderContext.pass;this._renderContext.pass=1,r(1),this._renderContext.pass=0,r(0),r(2),this._offscreenRendering.compositeTransparentOntoOpaque(t),this._renderContext.transparencyPassType=3,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._renderContext.pass=i}renderOccluded(){let e=0;this._materialRenderers.forEach(((t,r)=>{r&&r.isVisible()&&8===r.renderOccluded&&(e|=r.renderOccluded,ZC.push(r))}));const t=this._offscreenRendering,r=(r,i,n,s,a)=>{0!=(e&i)&&(t.renderToTargets(n,t.tmpColor,t.mainDepth,[0,0,0,0],s,a),t.compositeOccludedOntoMain(r))};0!==ZC.length&&(this.renderInternalSlot(10,ZC),r(.5,8,(()=>this.renderInternalSlot(11,ZC)),!1,!1),ZC.length=0),this._materialRenderers.forEach(((t,r)=>{r&&r.isVisible()&&(4===r.renderOccluded||2===r.renderOccluded||16===r.renderOccluded)&&(e|=r.renderOccluded,QC.push(r))}));const i=this._renderPlugins.renderOccludedFlags;if(e|=i,!e)return;const n=e=>{this._renderContext.renderOccludedMask=e,i>1&&this.renderSlot(9),this.renderInternalSlot(3,QC),this.renderInternalSlot(5,QC),this.renderInternalSlot(8,QC),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=0,r(.5,4,(()=>n(4)),!0,2),r(.5,2,(()=>n(2)),!0,2),r(1,16,(()=>n(16)),!0,2),QC.length=0}renderAntiAliasing(e,t){if(1===e){if(this._smaaPass.loadResources((()=>this.requestRender())),this._smaaPass.enable())return this._smaaPass.render({colorTexture:t}),!0}else this._smaaPass.disable();return!1}ensureCameraBindParameters(e){this._renderContext.camera=e,this._bindParameters.camera=this._renderContext.camera,this._bindParameters.inverseViewport[0]=1/this._renderContext.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/this._renderContext.camera.fullViewport[3]}ensureBindParameters(e){var t;this.ensureCameraBindParameters(e);const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=this._renderContext.shadowMap,this._bindParameters.shadowMappingEnabled=this._renderContext.shadowMap.enabled,this._bindParameters.ssaoHelper=this._renderContext.ssaoHelper,this._bindParameters.ssaoEnabled=this._renderContext.ssaoHelper.enabled,this._bindParameters.slicePlane=this._renderContext.sliceHelper.plane,this._bindParameters.hasOccludees=this._renderContext.hasOccludees,this._renderContext.multipassTerrainParams.camera=this._renderContext.camera,this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=null!=(t=r.depthTexture)?t:this.getFallbackDepthTexture()}ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._renderContext.camera)?this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=eM:(Object(Pl.t)(XC,this._renderContext.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),Object(Pl.t)(YC,this._renderContext.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),Object(Pl.a)(YC,YC),Object(Pl.a)(JC,this._renderContext.camera.projectionMatrix),Object(Pl.m)(KC,YC,JC),Object(Pl.m)(KC,XC,KC),Object(Pl.m)(KC,this._renderContext.lastFrameCamera.projectionMatrix,KC),this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=KC),this._renderContext.ssrParams.camera=this._renderContext.camera,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null,this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this.hasWaterReflection}renderInternalSlot(e,t){const r=0===this._renderContext.pass?this.performanceInfo.stats:null;let i=!1;return this._bindParameters.slot=e,Object(b.j)(t)?t.forEach((t=>{if(!Object(VS.c)(t,this._renderContext))return;const r=this._materialRenderers.get(t);Object(b.j)(r)&&(i=r.render(e,this._renderContext.pass,this._bindParameters)||i)})):this._materialRenderers.forEach(((t,n)=>{Object(VS.c)(n,this._renderContext)&&(i=t.render(e,this._renderContext.pass,this._bindParameters,r)||i)})),i}getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=Object(vc.b)(this._rctx)),this._fallbackDepthStencilTexture}getGpuMemoryUsage(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:(this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0)+(this._shadowHighlightHelper?this._shadowHighlightHelper.getGpuMemoryUsage():0),shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.gpuMemoryUsage:0}}get test(){const e=this;return{antialiasing:this._antialiasing,offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,lighting:this._lighting,materialRenderers:this._materialRenderers,oitEnabled:this._oitEnabled,shadowHighlights:this._shadowHighlightHelper,getFramebufferTexture:t=>{var r;switch(t){case 0:return e._offscreenRendering.colorTexture;case 1:return e._offscreenRendering.linearDepthTexture;case 2:return e._offscreenRendering.normalTexture;case 3:return null==(r=e._shadowMap)?void 0:r.test.depthTexture;case 4:return e._offscreenRendering.hudVisibilityTexture;case 5:return e._offscreenRendering.highlightTexture}}}}},rM=r(404);const iM=f.a.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");class nM{constructor(e,t,r){this._stage=e,this._rctx=r,this._idToRefCountedTexture=new Map,this._loadingCount=0,this._frameUpdates=new Map,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256),this.events=new zi.a,this._textureTechnique=t.acquire(rM.a,new rM.b);for(let i=0;i<this._fallbackTextureData.length;++i)this._fallbackTextureData[i]=255,this._fallbackTextureTransparentData[i]=(i+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this._rctx.parameters.maxMaxAnisotropy},this._frameTask=e.resourceController.scheduler.registerTask(Cm.b.TEXTURE_UNLOAD)}dispose(){this._frameTask.remove(),Object(b.j)(this._fallbackTexture)&&(this._fallbackTexture.dispose(),this._fallbackTexture=null),Object(b.j)(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent.dispose(),this._fallbackTextureTransparent=null),this._stage.forEachOfType(4,(e=>e.unload()))}get updating(){return this.loadingCount>0||this._frameTask.updating}acquire(e,t=!1,r){const i=this._getOrCreateRef(e,t,r);return i.ref(),i}update(){let e=!1;this._frameUpdates.forEach((t=>{const r=t.texture.frameUpdate(this._rctx,this._textureTechnique,t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)})),e&&this.events.emit("changed",0)}_getOrCreateRef(e,t,r){return this._idToRefCountedTexture.get(e)||this._createNewRef(e,t,r)}_createNewRef(e,t,r){const i=this._stage.getObject(e);Object(Oc.a)(void 0!==i);const n=i.events.on("unloaded",(()=>{n.remove(),this._onTextureUnloaded(e)})),s=new sM;this._idToRefCountedTexture.set(e,s);const a=i.load(this._rctx,this._textureTechnique);this._loadingCount++;const o=t=>(this._loadingCount--,this._updateGLTexture(s,t),r&&r(s),i.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s);return Object(m.q)(a)?(this._updateGLTexture(s,t?this.fallbackTextureTransparent:this.fallbackTexture),a.then(o,(e=>{this._loadingCount--,Object(m.n)(e)||iM.error(e)}))):o(a),s}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",1)}release(e){const t=this._idToRefCountedTexture.get(e);if(t&&(t.unref(),t.isUnreferenced)){const r=this._stage.getObject(e);this._frameTask.schedule((()=>{t.isUnreferenced&&r.unload()}))}}getTexture(e){return this._stage.getObject(e)}get loadingCount(){return this._loadingCount}_onTextureUnloaded(e){this._idToRefCountedTexture.delete(e),this._frameUpdates.delete(e)}get fallbackTexture(){return Object(b.i)(this._fallbackTexture)&&(this._fallbackTexture=new $l.a(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData)),this._fallbackTexture}get fallbackTextureTransparent(){return Object(b.i)(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent=new $l.a(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData)),this._fallbackTextureTransparent}}class sM{constructor(){this._refCount=0,this.glTexture=null}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}unref(){0!==this._refCount?--this._refCount:iM.error("Cannot dereference texture that has no references!")}}var aM=r(524);const oM=f.a.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let lM=class extends N.a{constructor(){super(...arguments),this._data=new Array,this.loadingState=0}dispose(){this.loadingState=0,this._data.forEach((e=>e.dispose())),this._data.length=0}get updating(){return 1===this.loadingState}get ready(){return 2===this.loadingState}loadTextures(e){const t=[Object(Be.b)("esri/images/materials/water/normals.jpg"),Object(Be.b)("esri/images/materials/water/perturbation.jpg")];this.loadingState=1,Promise.all(t.map((e=>Object(El.a)(e)))).then((t=>{t.forEach((t=>this._data.push(new $l.a(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:!0,maxAnisotropy:8,width:t.width,height:t.height},t)))),this.loadingState=2})).catch((e=>{oM.error("Failed to load textures for water material.",e),this.loadingState=0}))}bind(e){this._data.length>=2&&(e.bindTexture(this._data[0],"texWaveNormal"),e.bindTexture(this._data[1],"texWavePerturbation"))}};Object(i.a)([Object(j.b)()],lM.prototype,"loadingState",void 0),Object(i.a)([Object(j.b)({type:Boolean,readOnly:!0})],lM.prototype,"updating",null),lM=Object(i.a)([Object(w.a)("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],lM);var cM=r(259);class uM extends bw.a{constructor(e,t,r,i=null,n,s=!0){super(),this._rctx=e,this._renderScene=t,this._requestRenderScene=r,this._renderOverlay=i,this.forceCameraHook=n,this.supersample=s,this._screenshotQueue=[]}dispose(){this._rctx=null}takeScreenshot(e){this._requestRenderScene();const t=Object(m.h)();return this._screenshotQueue.push({settings:e,resolver:t}),t.promise}update(e){if(0!==this._screenshotQueue.length){for(const t of this._screenshotQueue){if(this.isDisposed){t.resolver.reject();continue}const r={...t.settings,pixelRatio:t.settings.pixelRatio*e.viewCamera.pixelRatio},i=this._ensureScreenshotEncodeCanvas(),n=this._renderScreenshot(e,r),s=Object(cM.b)(n,r,i,{flipY:!0,premultipliedAlpha:!0});t.resolver(s)}this._screenshotQueue=[]}}_renderScreenshotOverlay(e,t,r){if(Object(b.i)(this._renderOverlay))return t;e.width=t.width,e.height=t.height;const i=e.getContext("2d"),n=r.pixelRatio;return i.save(),i.translate(0,t.height),i.scale(1,-1),r.region&&i.translate(-r.region.x,-r.region.y),i.scale(n,n),t=this._renderOverlay(e,t),i.restore(),t}_readbackScreenshot(e){return e.resample?this._readbackScreenshotResampled(e):this._readbackScreenshotImmediate(e)}_readbackScreenshotResampled(e){const{framebufferWidth:t,framebufferHeight:r,region:i,resample:n}=e,s=this._ensureScreenshotEncodeCanvas();let a=Object(cM.a)(t,r,s);this._rctx.gl.readPixels(0,0,t,r,6408,5121,new Uint8Array(a.data.buffer)),a=this._renderScreenshotOverlay(s,a,{...e,region:null});const o=Object(cM.a)(i.width,i.height,s);return Object(cM.c)(a,o,!0,n.region.x,r-(n.region.y+n.region.height),n.region.width,n.region.height)}_readbackScreenshotImmediate(e){const{framebufferHeight:t,region:r}=e,i=this._ensureScreenshotEncodeCanvas(),n=Object(cM.a)(r.width,r.height,i);return this._rctx.gl.readPixels(r.x,t-(r.y+r.height),r.width,r.height,6408,5121,new Uint8Array(n.data.buffer)),this._renderScreenshotOverlay(i,n,e)}_renderScreenshot(e,t){let r=null;const i=e.viewCamera,{framebufferWidth:n,framebufferHeight:s}=t;let a=!1;const o=t.disableDecorations&&e.frameHasDecorations,l=n!==i.fullWidth||s!==i.fullHeight,c=t.ignorePadding&&i.pixelRatio!==t.pixelRatio,u=l||o||c;if(u){const e=i.clone();if(t.ignorePadding){const r=Object(Ml.f)(e.padding);for(let i=0;i<4;i++)r[i]=Math.round(r[i]/e.pixelRatio*t.pixelRatio);e.padding=r}e.fullWidth=n,e.fullHeight=s,e.pixelRatio=t.pixelRatio;const o=i.fovX-e.fovX,l=i.fovY-e.fovY;o<0&&o<l?e.fovX=i.fovX:l<0&&l<o&&(e.fovY=i.fovY),this.forceCameraHook(e),a=!0,r=new Vj.a(this._rctx,{width:e.fullWidth,height:e.fullHeight,colorTarget:0,depthStencilTarget:3}),this._renderScene(r,e,t.disableDecorations)}const d=this._readbackScreenshot(t);if(u&&!this._rctx.contextAttributes.alpha)for(let h=3;h<d.data.length;h+=4)d.data[h]=255;return r&&r.dispose(),this._rctx.bindFramebuffer(null),a&&this.forceCameraHook(i),d}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}var dM=r(407);const hM=f.a.getLogger("esri.views.3d.webgl-engine.parts.View");let pM=class extends(Object(bw.b)(N.a)){constructor(e){super({}),this.events=new zi.a,this.waterTextureRepository=new lM,this._magnifierHelper=new _S,this._componentObjectCollection=null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._logicUpdateLast=0,this._container=e.container,this._initializeContext(e.options),Object(y.a)(this.waterTextureRepository,"loadingState",(()=>this.setNeedsRender())),this._magnifierHelper.events.on("request-render",(()=>this.setNeedsRender())),this._stippleTextureRepository=new aM.a(this._rctx),this._shaderTechniqueRepository=new tS.a({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new nM(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",(e=>this.setNeedsRender(e))),this._materialRepository=new vS.a(this._textureRepository,this._shaderTechniqueRepository,(()=>this.setNeedsRender())),this._compositingHelper=new aS(this._rctx,this._shaderTechniqueRepository),this._renderer=new tM(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,((e=1)=>this.setNeedsRender(e)),((t,r)=>e.schedule(t,r)),e),this._screenshotManager=new uM(this._rctx,((e,t,r)=>this._renderer.render(e,t,t,r)),(()=>this.setNeedsRender()),e.options.screenshot.renderOverlay,(e=>this.events.emit("force-camera-for-screenshot",e))),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),this._shaderTechniqueRepository.dispose(),this._shaderTechniqueRepository=null,Object(Cv.a)(this._rctx),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==e.getUsedTextureMemory?e.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==e.getUsedRenderbufferMemory?e.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==e.getUsedVBOMemory?e.getUsedVBOMemory():void 0}}setNeedsRender(e=1){1===e?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0}get needsUpdate(){return this._needsUpdate}get updating(){return this.evaluateUpdating()}evaluateUpdating(){return this.needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,r){this._renderer.updateLightSources(e,t,r),this.setNeedsRender()}setRenderParameters(e){void 0!==e.idleSuspend&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.setNeedsRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}has(e){switch(e){case 0:return!!this._rctx.capabilities.compressedTextureETC;case 1:return!!this._rctx.capabilities.compressedTextureS3TC;case 2:return!!this._rctx.capabilities.shaderTextureLOD;case 3:return this._renderer.hasShadowsEnabled;default:return!1}}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}getMinimalDepthForArea(e,t,r,i,n=i){const s=r.constrainWindowSize(e,t,i*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(s);this._renderer.readDepthPixels(r,s[0],s[1],s[2],s[3],a);let o=Number.MAX_VALUE;for(let l=0;l<s[2]*s[3];l++){const e=oS(4*l,a,r.nearFar);o>e&&e!==r.nearFar[0]&&e!==r.nearFar[1]&&(o=e)}return o===Number.MAX_VALUE?void 0:o}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(Object(b.i)(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}getGpuMemoryUsage(){return this._renderer.getGpuMemoryUsage()}async hotReloadShaders(){CO(),await this._shaderTechniqueRepository.hotReload(),this.setNeedsRender()}_registerFrameTask(e){const t=e.state,r={viewCamera:t.camera,frameHasDecorations:!1};let i=!1;const n={preRender:r=>{i=this.evaluateUpdating(),e.processSyncLayers();const n=Object(hu.a)(r.time-this._logicUpdateLast);if(n>jO){const e={camera:t.camera,dt:n};this._logicUpdateLast=r.time,this._renderer.updateLogic(e)&&this.setNeedsRender(0)}},render:()=>{if((this.needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const e=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,!1),e&&this._renderer.hasWaterReflection&&(this.setNeedsRender(0),this._needsWaterReflectionUpdate=!0)}},postRender:()=>{i===this.updating&&i===this.evaluateUpdating()||this.notifyChange("updating")},update:()=>{r.viewCamera=t.camera,r.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(r)}};this._frameTask=Object(g.a)(n)}_initializeContext(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil,powerPreference:"high-performance"},r=Object(dM.b)(this._canvas,t,e.renderContext),i={disabledExtensions:e.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.debugWebGLExtensions||{},maxAnisotropy:8};this._rctx=new Nj.a(r,i),Object(Cv.b)(this._rctx),this._loadShaderOnlyExtensions(this._rctx),!e.alpha&&this._rctx.contextAttributes.alpha&&hM.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&Object(p.a)("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_loadShaderOnlyExtensions(e){const t=e.capabilities;t.enable("standardDerivatives"),t.enable("shaderTextureLOD"),t.enable("textureFloat")}get componentObjectCollection(){return Object(b.i)(this._componentObjectCollection)&&(this._componentObjectCollection=new Zx(this._renderer.renderPassManager)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};var fM;Object(i.a)([Object(j.b)({type:Boolean,readOnly:!0})],pM.prototype,"updating",null),Object(i.a)([Object(bw.c)()],pM.prototype,"_rctx",void 0),Object(i.a)([Object(bw.c)()],pM.prototype,"_container",void 0),Object(i.a)([Object(bw.c)()],pM.prototype,"_canvas",void 0),Object(i.a)([Object(bw.c)()],pM.prototype,"_stippleTextureRepository",void 0),Object(i.a)([Object(bw.c)(),Object(j.b)()],pM.prototype,"waterTextureRepository",void 0),Object(i.a)([Object(bw.c)(),Object(j.b)()],pM.prototype,"_magnifierHelper",void 0),Object(i.a)([Object(bw.c)(),Object(j.b)()],pM.prototype,"_textureRepository",void 0),Object(i.a)([Object(bw.c)()],pM.prototype,"_compositingHelper",void 0),Object(i.a)([Object(bw.c)()],pM.prototype,"_renderer",void 0),Object(i.a)([Object(bw.c)()],pM.prototype,"_screenshotManager",void 0),Object(i.a)([Object(bw.c)()],pM.prototype,"componentObjectCollection",null),Object(i.a)([Object(bw.c)()],pM.prototype,"_componentObjectCollection",void 0),pM=Object(i.a)([Object(w.a)("esri.views.3d.webgl-engine.parts.RenderView")],pM);let bM=fM=class extends(Object(bw.b)(N.a)){constructor(e){super(e),this._handles=new F.a,this._model=new ww,this._layers=new Wb.a,this._changeSet=new mw.a,this._layerSyncSet=new Set}initialize(){this._set("renderView",new pM(this)),this._frameTask=this.resourceController.scheduler.registerTask(Cm.b.STAGE,this),this._handles.add(this._frameTask)}destroy(){gw.a.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating}add(e){this._model.add(e),Object(lg.b)(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.setNeedsRender()}remove(e){Object(b.i)(e)||(this.renderView.setNeedsRender(),this._model.remove(e),Object(lg.b)(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){Object(b.j)(e)&&(this._model.addMany(e),this.renderView.setNeedsRender())}removeMany(e){Object(b.j)(e)&&(this._model.removeMany(e),this.renderView.setNeedsRender())}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.setNeedsRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;fM.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),fM.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map((e=>e.id))),console.log("RGs remove: "+this._changeSet.removes.map((e=>e.id)))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.setNeedsRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.setNeedsRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll((t=>{(this._layerSyncSet.has(t.id)||1===t.updatePolicy)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))}));for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.some((t=>t===e))||this._layers.push(e)}_removeLayer(e){this._commit(),null!=this._layers.removeUnordered(e)&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,r){const i=this.renderView.renderPlugins.add(e,t,r),n=()=>{qy(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(Object(m.p)(i))return i.then(n);n()}removeRenderPlugin(e){qy(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter((e=>e.type===t)).length,stopAnimations:t=>e._model.test.content.filter((e=>3===e.type)).forEach((e=>Object(b.c)(e.animation,(e=>e.stopAtTime(t))))),model:e._model}}};bM.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},Object(i.a)([Object(j.b)({constructOnly:!0})],bM.prototype,"resourceController",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],bM.prototype,"options",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],bM.prototype,"state",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],bM.prototype,"sceneIntersectionHelper",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],bM.prototype,"viewingMode",null),Object(i.a)([Object(j.b)({constructOnly:!0})],bM.prototype,"container",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],bM.prototype,"renderSR",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],bM.prototype,"_handles",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],bM.prototype,"updating",null),Object(i.a)([Object(j.b)({constructOnly:!0})],bM.prototype,"_model",void 0),Object(i.a)([Object(bw.c)(),Object(j.b)()],bM.prototype,"renderView",void 0),bM=fM=Object(i.a)([Object(w.a)("esri.views.3d.webgl-engine.Stage")],bM);var mM=r(441);var gM=r(330),yM=r(626);const vM={checkMajorWebPerformanceCaveat:!0};const OM="esri-component";let jM=class extends N.a{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(OM),t&&t.classList.remove(OM),this._set("node",e))}castNode(e){return e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),Object(c.a)(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};Object(i.a)([Object(j.b)({dependsOn:[]})],jM.prototype,"id",null),Object(i.a)([Object(j.b)()],jM.prototype,"node",null),Object(i.a)([Object(_.a)("node")],jM.prototype,"castNode",null),Object(i.a)([Object(j.b)({readOnly:!0})],jM.prototype,"widget",void 0),jM=Object(i.a)([Object(w.a)("esri.views.ui.Component")],jM);var _M=jM;const wM={left:0,top:0,bottom:0,right:0},xM={bottom:30,top:15,right:15,left:15},SM="manual",TM="esri-ui",CM="esri-ui-corner",MM="esri-ui-inner-container",PM="esri-ui-manual-container",AM="esri-ui-corner-container",EM="esri-ui-top-left",RM="esri-ui-top-right",IM="esri-ui-bottom-left",DM="esri-ui-bottom-right";function FM(e){return"object"!=typeof e||e instanceof _M||"declaredClass"in e||!("component"in e||"index"in e||"position"in e)?null:e}function LM(e,{top:t,bottom:r,left:i,right:n}){e.style.top=t,e.style.bottom=r,e.style.left=i,e.style.right=n}let kM=class extends zi.a.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new F.a,this.view=null,this._initContainers()}initialize(){this._handles.add([Object(y.a)(this,"view.padding, container",this._applyViewPadding.bind(this)),Object(y.a)(this,"padding",this._applyUIPadding.bind(this))])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(TM),e.classList.add(Object(Ge.d)()),this._attachContainers(e)),t&&(t.classList.remove(TM),LM(t,{top:"",bottom:"",left:"",right:""}),Object(c.b)(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(0===e)return e;const t=this._getViewPadding(),r=t.top+t.bottom;return Math.max(e-r,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:{...xM,...e}}get width(){const e=this.get("view.width")||0;if(0===e)return e;const t=this._getViewPadding(),r=t.left+t.right;return Math.max(e-r,0)}add(e,t){let r,i;if(Array.isArray(e))return void e.forEach((e=>this.add(e,t)));const n=FM(e);n&&({index:r,position:t,component:e,key:i}=n),t&&"object"==typeof t&&({index:r,key:i,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,i)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map((e=>this.remove(e,t)));const r=this._find(e);if(r){const i=this._componentToKey;if(i.has(e)&&i.get(e)!==t)return;const n=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(n,1)[0]}}empty(e){return Array.isArray(e)?e.map((e=>this.empty(e))).reduce(((e,t)=>e.concat(t))):(e=e||SM)===SM?Array.prototype.slice.call(this._manualContainer.children).filter((e=>!e.classList.contains(CM))).map((e=>this.remove(e))):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach((e=>this.move(e,t))),!e)return;let r;const i=FM(e)||FM(t);if(i&&(r=i.index,t=i.position,e=i.component||e),t&&!this._isValidPosition(t))return;const n=this.remove(e);n&&this.add(n,{position:t,index:r})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,r,i){e instanceof _M||(e=new _M({node:e})),this._place({component:e,position:t,index:r}),this._components.push(e),i&&this._componentToKey.set(e,i)}_find(e){return e?e instanceof _M?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||wM}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(MM),e.classList.add(AM);const t=document.createElement("div");t.classList.add(MM),t.classList.add(PM);const r=document.createElement("div");r.classList.add(EM),r.classList.add(CM),e.appendChild(r);const i=document.createElement("div");i.classList.add(RM),i.classList.add(CM),e.appendChild(i);const n=document.createElement("div");n.classList.add(IM),n.classList.add(CM),e.appendChild(n);const s=document.createElement("div");s.classList.add(DM),s.classList.add(CM),e.appendChild(s),this._innerContainer=e,this._manualContainer=t;const a=Object(Ge.h)();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":n,"bottom-right":s,"top-leading":a?i:r,"top-trailing":a?r:i,"bottom-leading":a?s:n,"bottom-trailing":a?n:s},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,r=e.position||SM,i=e.index,n=this._positionNameToContainerLookup[r],s=i>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(t.widget)&&t.widget.startup(),!s)return void n.appendChild(t.node);const a=Array.prototype.slice.call(n.children);0!==i?i>=a.length?n.appendChild(t.node):Object(c.c)(t.node,a[i]):n.firstChild?Object(c.c)(t.node,n.firstChild):n.appendChild(t.node)}_applyViewPadding(){const e=this.container;e&&LM(e,this._toPxPosition(this._getViewPadding()))}_applyUIPadding(){const e=this._innerContainer;e&&LM(e,this._toPxPosition(this.padding))}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return 0===e?"0":e+"px"}_findByComponent(e){let t,r=null;return this._components.some((i=>(t=i===e,t&&(r=i),t))),r}_findById(e){let t,r=null;return this._components.some((i=>(t=i.id===e,t&&(r=i),t))),r}_findByNode(e){let t,r=null;return this._components.some((i=>(t=i.node===e,t&&(r=i),t))),r}};Object(i.a)([Object(j.b)()],kM.prototype,"container",null),Object(i.a)([Object(j.b)()],kM.prototype,"height",null),Object(i.a)([Object(j.b)({value:xM})],kM.prototype,"padding",null),Object(i.a)([Object(_.a)("padding")],kM.prototype,"castPadding",null),Object(i.a)([Object(j.b)()],kM.prototype,"view",void 0),Object(i.a)([Object(j.b)()],kM.prototype,"width",null),kM=Object(i.a)([Object(w.a)("esri.views.ui.UI")],kM);var zM=kM;function VM(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function NM(e,t,r){r&&t&&(e.find((e=>e.layerView===t&&e.text===r))||e.push({text:r,layerView:t}))}const UM=[];let BM=class extends Z.a{constructor(e){super(e),this.clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new l.a,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const t=this.get("view.allLayerViews");t&&this.handles.add(t.map((e=>e.watch(["suspended","attributionVisible"],this._updateAttributionItems))),"suspension"),e&&e.removed&&e.removed.forEach((e=>{this._pendingAttributions.delete(e),this._fetchedAttributionData.delete(e)})),this._updateAttributionItems()},this._updateAttributionItems=()=>{const e=this.get("view.allLayerViews");UM.length=0,e?(e.forEach((e=>{if(e.suspended||!e.get("layer.attributionVisible"))return;const t=e.layer;if(VM(t,"user"))return void NM(UM,e,t.copyright);if(t.hasAttributionData){if(this._fetchedAttributionData.has(e)){const r=this._fetchedAttributionData.get(e);return void(r?NM(UM,e,this._getDynamicAttribution(r,this.view,t)):VM(t)&&NM(UM,e,t.copyright))}return void this._fetchAttributionData(e)}const r=t.get("portalItem.accessInformation");NM(UM,e,r||t.copyright)})),function(e,t){return e.length!==t.length||e.some(((e,r)=>e.text!==t[r].text))}(this.items,UM)&&(this.items.removeAll(),this.items.addMany(UM)),UM.length=0,this.notifyChange("state")):this.clear()},this.handles.add([Object(y.b)(this,"view.allLayerViews","change",this._allLayerViewsChange,this._allLayerViewsChange,this.clear),Object(y.k)(this,"view.stationary",(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Object(Am.d)(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=t.ok?this._createContributionIndex(t.value,function(e){return"bing-maps"===e.type}(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,t){const r=e.contributors,i={};if(!r)return i;for(let n=0;n<r.length;n++){const e=r[n],s=e.coverageAreas;if(!s)return;for(const r of s){const s=r.bbox,a=r.zoomMin-(t&&r.zoomMin?1:0),o=r.zoomMax-(t&&r.zoomMax?1:0),l={xmin:s[1],ymin:s[0],xmax:s[3],ymax:s[2],spatialReference:La.a.WGS84},c={extent:Object(R.b)(l),attribution:e.attribution||"",score:null!=r.score?r.score:100,id:n};for(let e=a;e<=o;e++)i[e]=i[e]||[],i[e].push(c)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(e,t,r){const{extent:i,scale:n}=t;let s=r.tileInfo.scaleToZoom(n);if(s=Math.min(e.maxKey,Math.round(s)),!i||null==s||s<=-1)return"";const a=e[s],o=Object(R.d)(i.center.clone().normalize(),t.spatialReference),l={};return a?a.filter((e=>{const t=!l[e.id]&&o&&Object(va.e)(e.extent,o);return t&&(l[e.id]=!0),t})).sort(((e,t)=>t.score-e.score||e.objectId-t.objectId)).map((e=>e.attribution)).join(", "):""}};Object(i.a)([Object(j.b)({readOnly:!0,type:l.a})],BM.prototype,"items",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],BM.prototype,"state",null),Object(i.a)([Object(j.b)()],BM.prototype,"view",void 0),BM=Object(i.a)([Object(w.a)("esri.widgets.Attribution.AttributionViewModel")],BM);var GM=BM;const qM="esri-attribution esri-widget",HM="esri-widget__anchor",WM="esri-attribution__powered-by",$M="esri-attribution__sources",QM="esri-attribution--open",ZM="esri-attribution__sources--open",XM="esri-attribution__link",JM="esri-icon-description",YM="esri-interactive";let KM=class extends $.a{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this.iconClass=JM,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new GM}initialize(){this.own(Object(y.b)(this,"viewModel.items","change",(()=>this.scheduleRender())))}get attributionText(){return this.viewModel.items.reduce(((e,t)=>(-1===e.indexOf(t.text)&&e.push(t.text),e)),[]).join(this.itemDelimiter)}render(){const e={[QM]:this._isOpen};return Object(He.a)("div",{bind:this,class:this.classes(qM,e),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return Object(He.a)("div",{class:WM},"Powered by"," ",Object(He.a)("a",{class:this.classes(XM,HM),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive(),r=t?0:-1,{attributionText:i}=this,n=t?"button":void 0,s={[ZM]:e,[YM]:t};return Object(He.a)("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes($M,s),innerHTML:i,role:n,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth}_afterSourcesNodeUpdate(e){let t=!1;const{clientHeight:r,clientWidth:i,scrollWidth:n}=e,s=n>=i,a=this._attributionTextOverflowed!==s;if(this._attributionTextOverflowed=s,a&&(t=!0),this._isOpen){const e=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,e&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive()&&(this._isOpen=!this._isOpen)}_isInteractive(){return this._isOpen||this._attributionTextOverflowed}};Object(i.a)([Object(j.b)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],KM.prototype,"attributionText",null),Object(i.a)([Object(j.b)()],KM.prototype,"iconClass",void 0),Object(i.a)([Object(j.b)()],KM.prototype,"itemDelimiter",void 0),Object(i.a)([Object(j.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],KM.prototype,"label",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/Attribution/t9n/Attribution")],KM.prototype,"messages",void 0),Object(i.a)([Object(W.a)("viewModel.view")],KM.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:GM})],KM.prototype,"viewModel",void 0),Object(i.a)([Object(Dn.a)()],KM.prototype,"_toggleState",null),KM=Object(i.a)([Object(w.a)("esri.widgets.Attribution")],KM);var eP=KM;let tP=class extends(Tn(N.a)){constructor(e){super(e),this._handles=new F.a,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(Object(y.a)(this,"view",this._updateRotationWatcher))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};"2d"===this.view.type?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){null!=e&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&("2d"===e.type?this._handles.add(Object(y.a)(this,"view.rotation",this._updateForRotation)):this._handles.add(Object(y.a)(this,"view.camera",this._updateForCamera)))}};Object(i.a)([Object(j.b)({readOnly:!0})],tP.prototype,"canShowNorth",null),Object(i.a)([Object(j.b)()],tP.prototype,"orientation",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],tP.prototype,"state",null),Object(i.a)([Object(j.b)()],tP.prototype,"view",void 0),tP=Object(i.a)([Object(w.a)("esri.widgets.CompassViewModel")],tP);var rP=tP;const iP="esri-compass esri-widget--button esri-widget",nP="esri-icon-font-fallback-text",sP="esri-compass__icon",aP="esri-icon-dial",oP="esri-icon-compass",lP="esri-icon-locate-circled",cP="esri-interactive",uP="esri-disabled";let dP=class extends $.a{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=lP,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new rP}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,r="disabled"===t,i="compass"===("rotation"===t?"rotation":"compass"),n=r?-1:0,s={[uP]:r,[cP]:!r},a={[oP]:i,[aP]:!i},{messages:o}=this;return Object(He.a)("div",{bind:this,class:this.classes(iP,s),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":o.reset,title:o.reset},Object(He.a)("span",{"aria-hidden":"true",class:this.classes(sP,a),styles:this._toRotationTransform(e)}),Object(He.a)("span",{class:nP},o.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};Object(i.a)([Object(W.a)("viewModel.goToOverride")],dP.prototype,"goToOverride",void 0),Object(i.a)([Object(j.b)()],dP.prototype,"iconClass",void 0),Object(i.a)([Object(j.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],dP.prototype,"label",void 0),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/Compass/t9n/Compass")],dP.prototype,"messages",void 0),Object(i.a)([Object(W.a)("viewModel.view")],dP.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:rP})],dP.prototype,"viewModel",void 0),Object(i.a)([Object(Dn.a)()],dP.prototype,"_reset",null),dP=Object(i.a)([Object(w.a)("esri.widgets.Compass")],dP);var hP=dP;let pP=class extends N.a{constructor(e){super(e),this._handles=new F.a,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(Object(y.f)(this,"view.inputManager",this._setNavigationMode.bind(this)))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}};Object(i.a)([Object(j.b)({readOnly:!0})],pP.prototype,"state",null),Object(i.a)([Object(j.b)()],pP.prototype,"navigationMode",void 0),Object(i.a)([Object(j.b)()],pP.prototype,"view",void 0),pP=Object(i.a)([Object(w.a)("esri.widgets.NavigationToggleViewModel")],pP);var fP=pP;const bP="esri-navigation-toggle esri-widget",mP="esri-navigation-toggle__button esri-widget--button",gP="esri-navigation-toggle__button--active",yP="esri-navigation-toggle__button--pan",vP="esri-navigation-toggle__button--rotate",OP="esri-navigation-toggle--horizontal",jP="esri-icon-rotate",_P="esri-icon-pan",wP="esri-icon-pan2",xP="esri-disabled";let SP=class extends $.a{constructor(e,t){super(e,t),this.iconClass=wP,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new fP}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e="disabled"===this.get("viewModel.state"),t="pan"===this.get("viewModel.navigationMode"),r={[xP]:e,[OP]:"horizontal"===this.layout},i={[gP]:t},n={[gP]:!t},s=e?-1:0,a=this.messages.toggle;return Object(He.a)("div",{bind:this,class:this.classes(bP,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:s,"aria-label":a,title:a},Object(He.a)("div",{class:this.classes(mP,yP,i)},Object(He.a)("span",{class:_P})),Object(He.a)("div",{class:this.classes(mP,vP,n)},Object(He.a)("span",{class:jP})))}_toggle(){this.toggle()}};Object(i.a)([Object(j.b)()],SP.prototype,"iconClass",void 0),Object(i.a)([Object(j.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],SP.prototype,"label",void 0),Object(i.a)([Object(j.b)({value:"vertical"})],SP.prototype,"layout",null),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],SP.prototype,"messages",void 0),Object(i.a)([Object(W.a)("viewModel.view")],SP.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:fP})],SP.prototype,"viewModel",void 0),Object(i.a)([Object(Dn.a)()],SP.prototype,"_toggle",null),SP=Object(i.a)([Object(w.a)("esri.widgets.NavigationToggle")],SP);var TP=SP;const CP="esri-widget--button esri-widget",MP="esri-disabled",PP="esri-interactive",AP="esri-icon-font-fallback-text",EP="esri-icon";let RP=class extends $.a{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[MP]:!this.enabled,[PP]:this.enabled},r={[this.iconClass]:!!this.iconClass};return Object(He.a)("div",{bind:this,class:this.classes(CP,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Object(He.a)("span",{"aria-hidden":"true",role:"presentation",class:this.classes(EP,r)}),Object(He.a)("span",{class:AP},this.title))}_triggerAction(){this.action.call(this)}};Object(i.a)([Object(j.b)()],RP.prototype,"action",void 0),Object(i.a)([Object(j.b)()],RP.prototype,"enabled",void 0),Object(i.a)([Object(j.b)()],RP.prototype,"iconClass",void 0),Object(i.a)([Object(j.b)()],RP.prototype,"title",void 0),Object(i.a)([Object(Dn.a)()],RP.prototype,"_triggerAction",null),RP=Object(i.a)([Object(w.a)("esri.widgets.IconButton")],RP);var IP=RP;let DP=class extends N.a{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return 0===t||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return 0===t||e<t}};Object(i.a)([Object(j.b)({readOnly:!0})],DP.prototype,"canZoomIn",null),Object(i.a)([Object(j.b)({readOnly:!0})],DP.prototype,"canZoomOut",null),Object(i.a)([Object(j.b)()],DP.prototype,"view",void 0),DP=Object(i.a)([Object(w.a)("esri.widgets.Zoom.ZoomConditions2D")],DP);var FP=DP;let LP=class extends N.a{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};Object(i.a)([Object(j.b)({readOnly:!0})],LP.prototype,"canZoomIn",null),Object(i.a)([Object(j.b)({readOnly:!0})],LP.prototype,"canZoomOut",null),Object(i.a)([Object(j.b)()],LP.prototype,"view",void 0),LP=Object(i.a)([Object(w.a)("esri.widgets.Zoom.ZoomConditions3D")],LP);var kP=LP;let zP=class extends N.a{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?"2d"===e.type?this._zoomConditions=new FP({view:e}):"3d"===e.type&&(this._zoomConditions=new kP({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():Object(m.m)(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():Object(m.m)(e.goTo({zoomFactor:.5}))}};Object(i.a)([Object(j.b)()],zP.prototype,"_zoomConditions",void 0),Object(i.a)([Object(j.b)({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],zP.prototype,"canZoomIn",void 0),Object(i.a)([Object(j.b)({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],zP.prototype,"canZoomOut",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],zP.prototype,"state",null),Object(i.a)([Object(j.b)()],zP.prototype,"view",null),zP=Object(i.a)([Object(w.a)("esri.widgets.Zoom.ZoomViewModel")],zP);var VP=zP;const NP="esri-zoom esri-widget",UP="esri-zoom--horizontal",BP="esri-icon-plus",GP="esri-icon-minus",qP="esri-icon-zoom-in-magnifying-glass";let HP=class extends $.a{constructor(e,t){super(e,t),this.iconClass=qP,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new VP}initialize(){this._zoomInButton=new IP({action:this.zoomIn.bind(this),iconClass:BP}),this._zoomOutButton=new IP({action:this.zoomOut.bind(this),iconClass:GP})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[UP]:"horizontal"===this.layout};return this._zoomInButton.enabled="ready"===e.state&&e.canZoomIn,this._zoomOutButton.enabled="ready"===e.state&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,Object(He.a)("div",{class:this.classes(NP,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};Object(i.a)([Object(j.b)()],HP.prototype,"iconClass",void 0),Object(i.a)([Object(j.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],HP.prototype,"label",void 0),Object(i.a)([Object(j.b)({value:"vertical"})],HP.prototype,"layout",null),Object(i.a)([Object(j.b)(),Object(qe.a)("esri/widgets/Zoom/t9n/Zoom")],HP.prototype,"messages",void 0),Object(i.a)([Object(W.a)("viewModel.view")],HP.prototype,"view",void 0),Object(i.a)([Object(j.b)({type:VP})],HP.prototype,"viewModel",void 0),HP=Object(i.a)([Object(w.a)("esri.widgets.Zoom")],HP);var WP=HP;const $P="esri.views.ui.DefaultUI";f.a.getLogger($P);let QP=class extends zM{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},this.components=[]}initialize(){this._handles.add([Object(y.a)(this,"components",this._componentsWatcher.bind(this)),Object(y.a)(this,"view",this._updateViewAwareWidgets.bind(this))])}_add(e,t,r,i){if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,r,i)}_removeComponents(e){e.forEach((e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())}))}_updateViewAwareWidgets(e){this.components.forEach((t=>{const r=this._find(t),i=r&&r.widget;(function(e){return e&&void 0!==e.view})(i)&&(i.view=e)}))}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(-1===e.indexOf("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(e){this.initialized&&e.forEach((e=>this.add(this._createComponent(e),this._defaultPositionLookup[e])))}_createComponent(e){const t=this._createWidget(e);if(t)return new _M({id:e,node:t})}_createWidget(e){return"attribution"===e?this._createAttribution():"compass"===e?this._createCompass():"navigation-toggle"===e?this._createNavigationToggle():"zoom"===e?this._createZoom():void 0}_createAttribution(){return new eP({view:this.view})}_createCompass(){return new hP({view:this.view})}_createNavigationToggle(){return new TP({view:this.view})}_createZoom(){return new WP({view:this.view})}};Object(i.a)([Object(j.b)()],QP.prototype,"components",void 0),QP=Object(i.a)([Object(w.a)($P)],QP);var ZP=QP;let XP=class extends ZP{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};Object(i.a)([Object(j.b)()],XP.prototype,"components",void 0),XP=Object(i.a)([Object(w.a)("esri.views.ui.3d.DefaultUI3D")],XP);var JP=XP;const YP=f.a.getLogger("esri.views.SceneView");let KP=class extends(V(ya(Pa(Vo)))){constructor(e){super(e),this._clippingArea=null,this._userClippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new iy.a({slicePlane:A.a},this),this._resourceController=function(e,t=(()=>performance.now())){return new jv.ResourceController({view:e,now:t})}(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Mm({view:this}),this.labeler=new ug({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new pl,this.environmentManager=new du,this.extent=null,this.floors=new l.a,this.windowDevicePixelRatio=1,this.fullOpacity=1,this.graphicsView=null,this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new cy,this.scale=null,this.spatialReference=null,this.isHeightModelInfoRequired=!0,this.alphaCompositingEnabled=!1,this.supersampleScreenhotsEnabled=!0,this.type="3d",this.ui=new JP,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new tv,Object(v.a)(),e&&e.environment||(this._defaults.environment=new Sl,this.environment=this._defaults.environment);const t=e=>{Object(b.j)(e)&&4===e.type||(this.notifyChange("dataExtent"),this.updatingChanged(),this.map&&this.map.allLayers.forEach((async e=>{try{await e.when()}catch{}this.updatingChanged()})))};this.handles.add([Object(y.b)(this,"map.allLayers","after-changes",t,t,t,!0),this.allLayerViews.on("after-changes",(e=>this._updateUpdatingMonitors(e))),this.watch("map",(e=>{e&&e.load&&e.load().catch((()=>{}))}))]),this.inputManager=new Hb({view:this});this.stateManager=new ky({view:this,updateDevicePixelRatio:()=>{const e=window.devicePixelRatio;e!==this.windowDevicePixelRatio&&(this.windowDevicePixelRatio=e,this.notifyChange("pixelRatio"))}})}initialize(){this.groundView=new Ca({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(Object(y.b)(this,"map.allLayers","after-changes",e,e,e)),this.updatingHandles.add(this.qualitySettings,"memoryLimit",(e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)}),2),this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",(e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)}),2),this.updatingHandles.add(this.qualitySettings,"frameRate",(e=>Object(g.c)(e>0?1e3/Math.ceil(e):0)),2),this.updatingHandles.add($b.a,"SCENEVIEW_LOCKING_LOG",(e=>this.defaultsFromMap.logDebugInformation=e),2),this.updatingHandles.add(this,"map.ground",e,3),this.updatingHandles.add(this,"map.ground.opacity",(()=>this._updateDefaultHitTestOptions()),3),this.handles.add(this.watch("spatialReference",(()=>this.notifyChange("clippingArea")),!0))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController.destroy(),this._resourceController=null,this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView.destroy(),this.groundView=null)}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if("global"===this.viewingMode)return null;let e=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||!e)return this._clippingArea=null,null;if(!(e instanceof Fa.a))return YP.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference){if(!Object(R.a)(e.spatialReference,this.spatialReference))return YP.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;e=Object(R.d)(e,this.spatialReference)}return this._clippingArea&&e&&this._clippingArea.equals(e)?this._clippingArea:(this._clippingArea=e,e)}set clippingArea(e){this.ready&&"global"===this.viewingMode&&e?YP.error("#clippingArea=","Clipping area is only supported in local viewingMode"):(this._userClippingArea=e,this.notifyChange("clippingArea"))}get dataExtent(){const e=this.spatialReference||La.a.WGS84;let t,r=this.clippingArea;r&&(r=Object(R.d)(r,e));const i=i=>{let n=Object(R.d)(i,e);n&&(r&&(n=n.intersection(r),!n)||(Object(b.j)(t)?t.union(n):t=n))},n=this.basemapTerrain;if(n&&n.spatialReference&&i(new Fa.a({xmin:n.extent[0],ymin:n.extent[1],zmin:0,xmax:n.extent[2],ymax:n.extent[3],zmax:0,spatialReference:n.spatialReference})),this.map){const e=e=>{!e.fullExtent||"graphics"===e.type&&e.internal||i(e.fullExtent)};this.map.allLayers.forEach((t=>e(t)))}return Object(b.i)(t)?new Fa.a({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:e}):(t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0),t)}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof Sl?e:e instanceof wl.a?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(e):Sl.fromWebsceneEnvironment(e):Object(x.m)(Sl,e):new Sl}get pixelRatio(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)}set pixelRatio(e){Object(b.j)(e)?this._override("pixelRatio",e):this._clearOverride("pixelRatio")}get maximumPixelRatio(){let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:r}=this.qualitySettings;if(null!=t&&(e=Math.min(e,t)),null!=r){const t=r/Math.max(this.width,this.height);e=Math.min(e,t)}return e}set maximumPixelRatio(e){Object(b.j)(e)?this._override("maximumPixelRatio",e):this._clearOverride("maximumPixelRatio")}get groundExtent(){const e=this._get("basemapTerrain");if(e&&e.spatialReference){const t=e.extent;return new Fa.a({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e.spatialReference})}const t=this.spatialReference||La.a.WGS84;return new Fa.a({spatialReference:t})}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get interacting(){return this.navigating||Object(b.j)(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(Object(b.i)(this.state)||this.state.stationary)}set qualityProfile(e){Yy.isValidProfile(e)&&(Yy.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||Yy.getDefaultProfile()}set slicePlane(e){if(this._stage.renderView.setRenderParameters({slicePlane:e}),Object(b.i)(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");Object(A.d)(e,t),this._set("slicePlane",t)}get resolution(){return null!=this.spatialReference?Object(E.a)(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return null!=e?T.a.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var e,t,r;let i=0,n=this.layerViewManager.updating,s=n?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach((e=>{if(e.isFulfilled()){if(e.updating){if(n=!0,e.suspended||Object(_v.j)(e))return;++s,i+="updatingProgress"in e?e.updatingProgress:.5}}else++s}));for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager])if(Object(b.j)(a)&&a.updating){const e=.1;s+=e,i+=.5*e}for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])Object(b.j)(a)&&a.updating&&(++s,i+=a.updatingProgress);if(n=!!(n||s>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(e=this.inputManager)&&e.hasPendingInputs||null!=(t=this.map)&&null!=(r=t.allLayers)&&r.some((e=>!e.isFulfilled()))),n?(this._numUpdating=Math.max(s,this._numUpdating),i+=this._numUpdating-s):this._numUpdating=0,this._numUpdating>0?i/=this._numUpdating:i=n?0:1,this._get("updatingProgress")!==i){const e=this._resourceController.scheduler.now;if(i<1){const t=Math.min((e-this._lastUpdateTime)/2e3,1);i=this.updatingProgress*(1-t)+i*t}this._set("updatingProgress",i),this._lastUpdateTime=n&&i<1?e:0}return n}get viewingMode(){const e=this.get("map.initialViewProperties.viewingMode");if(e)return e;const t=this.spatialReference;return!t||Object(gM.a)(t,"global")?"global":"local"}set viewingMode(e){this.ready?YP.error("#viewingMode","viewingMode cannot be set once view is ready"):["local","global"].indexOf(e)>=0?this._override("viewingMode",e):void 0===e&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new xv(this)}on(e,t,r,i){return this.viewEvents.on(e,t,r,i)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return YP.error("#toMap()","Scene view cannot be used before it is ready"),null;const r=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,i=Object(b.j)(r.graphics)&&(Object(b.j)(r.graphics.include)||Object(b.j)(r.graphics.exclude)),n=ao(e)?so(this,e):e,s=Object(O.i)(n);r.enableDraped=r.include&&!r.include.has(oO.b)||r.exclude&&r.exclude.has(oO.b);const a=this.sceneIntersectionHelper,o=new Oh.a(this.state.viewingMode);if(o.options.selectionMode=!0,o.options.store=i?2:0,a.intersectIntersectorScreen(s,o,r),i){for(const e of o.results.all){const t=Object(mM.a)(e,this);if(Object(b.i)(t))return this._intersectResultToMapPoint(e);if(this._testGraphicUidFilter(r.graphics,t))return this._intersectResultToMapPoint(e)}return null}return this._intersectResultToMapPoint(o.results.min)}toScreen(e){if(!this.ready)return YP.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=Object(b.t)(null==e.z&&Object(ja.b)(this.elevationProvider,e),0);return Object(C.u)(e,tA,this.renderSpatialReference,t),this.state.camera.projectToScreen(tA,rA),Object(O.e)(rA[0],rA[1])}pixelSizeAt(e){return this.ready?e?(Object(C.u)(e,tA,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(tA)):0:(YP.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return YP.error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=ao(e)?so(this,e):e,i=Object(O.f)(r.x,r.y),n=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=new Oh.a(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=2,this.sceneIntersectionHelper.intersectIntersectorScreen(i,s,n);const a=this._intersectResultsToHits(s.results.all,n.graphics),o=s.results.ground,l=Object(mM.b)(o,this),c=Object(b.j)(l)&&"type"in l&&"integrated-mesh"===l.type?l:null,u={screenPoint:r,results:a,ground:{mapPoint:this._intersectResultToMapPoint(o),distance:o.hasIntersectionPoint?o.distanceInRenderSpace:0,layer:c}};return $b.a.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=s),Promise.resolve(u)}popupHitTest(e){return async function(e,t){if("2d"===e.type)return e.hitTest(t);const r=await e.hitTest(t),i=r.results[0],n=r.results.findIndex((e=>e.distance!==i.distance));return-1!==n&&(r.results=r.results.slice(0,n)),r}(this,e).then((({results:t,ground:r})=>{let i=null;return!(0===t.length||Math.abs(t[0].distance-r.distance)<1e-5)||r.layer&&"integrated-mesh"===r.layer.type||(i=r.mapPoint),{results:t,screenPoint:e,mapPoint:i}}))}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}whenLayerView(e){return super.whenLayerView(e)}takeScreenshot(e){return this.whenReady().then((()=>{const t=Object(cM.e)(e,this);return t.pixelRatio/=this.pixelRatio,this._stage.renderView.takeScreenshot(Object(cM.d)(t,this.supersampleScreenhotsEnabled,this.padding))}))}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return $o(e)}hasLayerViewModule(e){return Wo(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null}async validate(){let e=function(e){e={...vM,...e};const t=Object(yM.a)();return t.available?e.checkMajorWebPerformanceCaveat&&t.majorPerformanceCaveat?new u.a("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?t.supportsElementIndexUint?t.supportsStandardDerivatives?t.supportsInstancedArrays?null:new u.a("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new u.a("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new u.a("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new u.a("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new u.a("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new u.a("webgl:required","WebGL is required but not supported.")}();if(Object(p.a)("safari")&&Object(p.a)("safari")<9&&(e=new u.a("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:Object(p.a)("safari")})),Object(b.j)(e))throw YP.warn("#validate()",e.message),e}isSpatialReferenceSupported(e,t,r){const i=e.isGeographic,n=e.isWebMercator,s=Object(gM.a)(e,"global"),a="local"===this.viewingMode,o=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(o){if(a&&i)return r?r(`Layer ${t.id} is ignored because it is GCS and viewing mode is local`):YP.warnOnce("Geographic coordinate systems are not supported in local viewing mode."),!1;if(!a&&!s)return r?r(`Layer ${t.id} is ignored because its spatial reference is not supported in global viewing mode`):YP.warnOnce("Spatial reference defined on view not supported in global viewing mode."),!1}else if(i&&!s)return r?r(`Layer ${t.id} is ignored because its spatial reference is geographic but unsupported`):YP.warnOnce("Spatial reference is geographic but not supported."),!1;if(t)if(Object(I.c)(t)){let i;if(o)i=null!=Object(_v.d)(t,e,Bo(this.viewingMode)).tileInfo;else{let r=Object(_v.d)(t,e,1);null==r.tileInfo&&(r=Object(_v.d)(t,e,2),null!=r.tileInfo&&n&&!this.ready&&(this.viewingMode="local")),i=null!=r.tileInfo}if(!i)return r&&r(`Layer ${t.id} is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode`),!1}else if((e.isWGS84||n)&&!a)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=e),o||this.ready||(this.viewingMode="global",r&&r(`Viewing mode locked to global due to reprojectable layer ${t.id}`)),r&&r(`Layer ${t.id} is ignored because it supports server-side reprojection`),!1;return!0}whenReady(){return new Promise((e=>{this.ready?e(this):this._resolveWhenReady.push(e)}))}computeMapPointFromVec3d(e,t){let r=this.spatialReference||La.a.WGS84;return Object(C.z)(e,this.renderSpatialReference,e,r)||(r=La.a.WGS84,Object(C.z)(e,this.renderSpatialReference,e,r)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=r):t=new Mn.a(e,r),t}trackGraphicState(e){if(!e.graphic)return YP.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let r=null,i=!1;const n=t=>{!i&&Object(b.j)(t)&&"graphics3d"in t&&t.graphics3d&&t.graphics3d.graphicsCore&&(r=t.graphics3d.graphicsCore.trackGraphicState(e))};return Object(b.j)(t)?n(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then((e=>n(e)),(()=>{})).catch((()=>{})),{remove:()=>{i=!0,Object(b.j)(r)&&(r.remove(),r=null)}}}highlight(e){if(Array.isArray(e))return Object(h.a)(e.map((e=>this.highlight(e))));if(l.a.isCollection(e))return Object(h.a)(e.toArray().map((e=>this.highlight(e))));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Object(h.b)()}maskOccludee(e){if(!e)return YP.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let r=null,i=!1;const n=t=>{!i&&Object(b.j)(t)&&"graphics3d"in t&&Object(bn.c)(t)&&(r=t.maskOccludee(e))};return Object(b.j)(t)?n(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then((e=>n(e)),(()=>{})).catch((()=>{})),{remove:()=>{i=!0,Object(b.j)(r)&&(r.remove(),r=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find((t=>t.layer===e.layer)):null}graphicChanged(e){Object(b.j)(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await Object(y.j)(this,"graphicsView"),this.graphicsView;if(!e.layer||!this.map)throw new u.a("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise(((t,r)=>{const i=this.map.allLayers.on("change",(n=>{-1!==n.added.indexOf(e.layer)&&(i.remove(),this.whenLayerView(e.layer).then(t,r))}))})):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,0),r=this._externalToInternalRenderItems(e.exclude,1);return{include:t.layerUids,exclude:r.layerUids,graphics:{include:t.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(tA)?(t=this.computeMapPointFromVec3d(tA,t),"TerrainRenderer"===e.intersector&&this.basemapTerrain&&(t.z=Object(b.t)(Object(ja.b)(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const r=new Array;let i=null;for(let n=0;n<e.length;n++){const s=e[n],a=Object(mM.b)(s,this);if(Object(b.j)(a)&&(a===this.map.ground||"type"in a&&"integrated-mesh"===a.type))break;const o=Object(mM.a)(s,this);if(!Object(b.j)(o))continue;if(Object(b.i)(i)&&n!==e.length-1&&(i=new Set),Object(b.j)(i)){const e=this._getGraphicFilterUid(o);if(i.has(e))continue;i.add(e)}if(!this._testGraphicUidFilter(t,o))continue;const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;r.push({graphic:o,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const r=this._getGraphicFilterUid(t);return Object(b.i)(e)||(Object(b.i)(e.include)||e.include.has(r))&&(Object(b.i)(e.exclude)||!e.exclude.has(r))}_externalToInternalRenderItems(e,t,r={layerUids:null,graphicUids:null}){return e?(e instanceof s.a?(function(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}(r,this._getGraphicFilterUid(e)),0===t&&(Object(b.j)(this.graphicsView)&&e.layer===this?eA(r,this.graphicsView.graphics3d.layer.id):e.layer&&eA(r,e.layer.uid))):"forEach"in e?e.forEach((e=>{Array.isArray(e)?this._externalToInternalRenderItems(e,t,r):l.a.isCollection(e)?e===this.graphics&&Object(b.j)(this.graphicsView)?eA(r,this.graphicsView.graphics3d.layer.id):this._externalToInternalRenderItems(e,t,r):e instanceof a.a?e===this.map.ground&&eA(r,oO.b):this._externalToInternalRenderItems(e,t,r)})):eA(r,e.uid),r):r}_initBasemapTerrain(){this._set("basemapTerrain",new fw({view:this})),this._set("elevationProvider",new Qy({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new pO({view:this})),this._set("featureTiles",new ty({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{const e=this.basemapTerrain&&this.basemapTerrain.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const e=Object(P.z)(this.basemapTerrain.extent,this.basemapTerrain.spatialReference);this.clippingArea?this.featureTiles.filterExtent=e.intersection(this.clippingArea):this.featureTiles.filterExtent=e}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add($b.a,"FEATURE_TILE_TREE_SHOW_TILES",(e=>{e&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(r.e(141).then(r.bind(null,976))).then((({FeatureTileTree3DDebugger:e})=>{!this.featureTreeDebugger&&$b.a.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new e({view:this}))})):e||!this.featureTreeDebugger||$b.a.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)}),3),this.updatingHandles.add(this,"clippingArea",e,3),this.updatingHandles.add(this,"basemapTerrain.extent",e,3)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new nv(this.map,e));const t=this.state.isGlobal,r=t?Object(M.g)(e):e;r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",pv.create(this.state.viewingMode,r)),t||this.handles.add(this.watch("basemapTerrain.extent",(e=>{0===e[0]&&0===e[1]&&0===e[2]&&0===e[3]||(this.renderCoordsHelper.extent=e)}),!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Oh.a.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){Object(b.j)(e)&&4===e.type||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach((e=>{e.destroyed||(this.handles.add([e.watch(["updating","updatingProgress"],(()=>this.updatingChanged()),!0)],"updatingMonitors"),e.when((()=>this.updatingChanged()),(()=>this.updatingChanged())))})),this.updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const r=e.getContext("2d");return r.putImageData(t,0,0),this.overlay.renderCanvas(e),r.getImageData(0,0,t.width,t.height)}_initStage(){const e={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(e,t)=>this._renderScreenshotOverlay(e,t)}},t=new Vy(this.state.viewingMode,{forEachLayer:e=>this._stage.layers.forAll(e)},this);this._set("sceneIntersectionHelper",t);const r=Object(c.a)(this.surface),{resourceController:i,state:n,renderSpatialReference:s}=this;this._stage=new bM({resourceController:i,container:r,options:e,state:n,sceneIntersectionHelper:t,renderSR:s}),this._lostWebGLContextHandle=Object(d.c)(this._stage.renderView.canvas,"webglcontextlost",(()=>this.fatalError=new u.a("webgl-context-lost"))),this.handles.add([this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",(()=>{this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})}),2),this.updatingHandles.add(this.qualitySettings,"highQualityTransparency",(()=>{this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency})}),2),Object(y.a)(this,"magnifier",(e=>this._stage.renderView.magnifier=e),!0)],"stage");const a=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:tv.toEngineOptions(this.highlightOptions)})};for(const o of["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity","highlightOptions.fillOpacity","highlightOptions.shadowOpacity","highlightOptions.shadowColor","highlightOptions.shadowDifference"])this.handles.add(this.updatingHandles.add(this,o,a),"stage");a(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Oh.a.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Pv({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new vg})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController)return;if(0===this.graphics.length)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=Object(m.e)();const e=()=>{this._createGraphicsViewController=null,this.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this.updatingChanged()}async _createGraphicsViewAsync(e){const t=(await Promise.all([r.e(3),r.e(66)]).then(r.bind(null,1171))).default;Object(m.x)(e),await Object(y.l)(this.basemapTerrain,"ready",e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),Object(b.j)(this.graphicsView)&&(this.handles.remove(this.graphicsView.graphics3d.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Bo(this.viewingMode);if(1===e&&(this._clippingArea=null),this._set("ready",!0),this._initSurface(e),this.handles.add(Object(y.b)(this,"graphics","after-changes",(()=>this._createGraphicsViewIfNeeded())),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const e=this.get("map.initialViewProperties.environment");e&&(this.environment=e)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach((e=>e(this)))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(oO.b);for(const e of this.map.allLayers.items)"integrated-mesh"===e.type&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(oO.b);for(const e of this.map.allLayers.items)"integrated-mesh"===e.type&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}};function eA(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}Object(i.a)([Object(j.b)()],KP.prototype,"_resourceController",void 0),Object(i.a)([Object(j.b)()],KP.prototype,"_stage",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"deconflictor",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"labeler",void 0),Object(i.a)([Object(j.b)({type:Uo,readOnly:!0,aliasOf:"state.animation"})],KP.prototype,"animation",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"basemapTerrain",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"elevationProvider",void 0),Object(i.a)([Object(j.b)({type:n.a,aliasOf:"stateManager.camera"})],KP.prototype,"camera",void 0),Object(i.a)([Object(j.b)({type:n.a,aliasOf:"stateManager.contentCamera"})],KP.prototype,"contentCamera",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"canvas",void 0),Object(i.a)([Object(j.b)({type:Mn.a,aliasOf:"stateManager.center"})],KP.prototype,"center",void 0),Object(i.a)([Object(j.b)({type:Fa.a,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],KP.prototype,"clippingArea",null),Object(i.a)([Object(j.b)({type:pl})],KP.prototype,"constraints",void 0),Object(i.a)([Object(j.b)({type:Fa.a,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],KP.prototype,"dataExtent",null),Object(i.a)([Object(j.b)({value:null,type:Sl})],KP.prototype,"environment",null),Object(i.a)([Object(_.a)("environment")],KP.prototype,"castEnvironment",null),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"environmentManager",void 0),Object(i.a)([Object(j.b)({type:Fa.a,aliasOf:"stateManager.extent"})],KP.prototype,"extent",void 0),Object(i.a)([Object(j.b)()],KP.prototype,"floors",void 0),Object(i.a)([Object(j.b)({readOnly:!0,aliasOf:"stateManager.screenCenter"})],KP.prototype,"screenCenter",void 0),Object(i.a)([Object(j.b)({type:Number})],KP.prototype,"pixelRatio",null),Object(i.a)([Object(j.b)({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],KP.prototype,"maximumPixelRatio",null),Object(i.a)([Object(j.b)({aliasOf:"stateManager.frustum"})],KP.prototype,"frustum",void 0),Object(i.a)([Object(j.b)({type:Number,readOnly:!0})],KP.prototype,"fullOpacity",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"graphicsView",void 0),Object(i.a)([Object(j.b)({type:Fa.a,dependsOn:["basemapTerrain.extent"],readOnly:!0})],KP.prototype,"groundExtent",null),Object(i.a)([Object(j.b)()],KP.prototype,"groundView",void 0),Object(i.a)([Object(j.b)({type:Boolean})],KP.prototype,"initialExtentRequired",null),Object(i.a)([Object(j.b)({type:Boolean,readOnly:!0})],KP.prototype,"interacting",null),Object(i.a)([Object(j.b)()],KP.prototype,"stationary",null),Object(i.a)([Object(j.b)({aliasOf:"state.navigating"})],KP.prototype,"navigating",void 0),Object(i.a)([Object(j.b)()],KP.prototype,"map",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"mapCoordsHelper",void 0),Object(i.a)([Object(j.b)({aliasOf:"stateManager.padding"})],KP.prototype,"padding",void 0),Object(i.a)([Object(j.b)({type:pO,readOnly:!0})],KP.prototype,"pointsOfInterest",void 0),Object(i.a)([Object(j.b)({type:ty,readOnly:!0})],KP.prototype,"featureTiles",void 0),Object(i.a)([Object(j.b)()],KP.prototype,"featureTreeDebugger",void 0),Object(i.a)([Object(j.b)({type:Boolean})],KP.prototype,"screenSizePerspectiveEnabled",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],KP.prototype,"deactivatedWebGLExtensions",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],KP.prototype,"debugWebGLExtensions",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],KP.prototype,"renderCanvas",void 0),Object(i.a)([Object(j.b)({constructOnly:!0})],KP.prototype,"state",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"inputManager",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"stateManager",void 0),Object(i.a)([Object(j.b)({type:["low","medium","high"]})],KP.prototype,"qualityProfile",null),Object(i.a)([Object(j.b)({type:dv,get(){let e=this._get("qualitySettings");return e||(e=new dv,Yy.apply(this.qualityProfile,e)),e}})],KP.prototype,"qualitySettings",void 0),Object(i.a)([Object(j.b)()],KP.prototype,"slicePlane",null),Object(i.a)([Object(j.b)({dependsOn:["viewingMode"]})],KP.prototype,"preconditionsReady",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"renderCoordsHelper",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"sceneIntersectionHelper",void 0),Object(i.a)([Object(j.b)({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],KP.prototype,"resolution",null),Object(i.a)([Object(j.b)({type:Number,aliasOf:"stateManager.scale"})],KP.prototype,"scale",void 0),Object(i.a)([Object(j.b)({dependsOn:[]})],KP.prototype,"heightModelInfo",null),Object(i.a)([Object(j.b)({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],KP.prototype,"spatialReference",void 0),Object(i.a)([Object(j.b)({type:Boolean,constructOnly:!0})],KP.prototype,"alphaCompositingEnabled",void 0),Object(i.a)([Object(j.b)({type:Boolean})],KP.prototype,"supersampleScreenhotsEnabled",void 0),Object(i.a)([Object(j.b)({readOnly:!0})],KP.prototype,"type",void 0),Object(i.a)([Object(j.b)({type:JP})],KP.prototype,"ui",void 0),Object(i.a)([Object(j.b)({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating"]})],KP.prototype,"updating",null),Object(i.a)([Object(j.b)({type:Number,readOnly:!0,dependsOn:["updating"]})],KP.prototype,"updatingProgress",void 0),Object(i.a)([Object(j.b)({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],KP.prototype,"viewingMode",null),Object(i.a)([Object(j.b)({type:o.a,aliasOf:"stateManager.viewpoint"})],KP.prototype,"viewpoint",void 0),Object(i.a)([Object(j.b)({type:Number,aliasOf:"stateManager.zoom"})],KP.prototype,"zoom",void 0),Object(i.a)([Object(j.b)({type:tv})],KP.prototype,"highlightOptions",void 0),KP=Object(i.a)([Object(w.a)("esri.views.SceneView")],KP);const tA=Object(S.e)(),rA=Object(O.f)();var iA=KP;t.a=iA},function(e,t,r){"use strict";var i=r(0),n=r(110),s=r(531),a=r(122),o=r(38),l=r(11),c=r(42),u=(r(8),r(13)),d=r(159),h=r(372),p=r(7),f=r(2),b=r(408),m=r(206),g=r(12),y=r(25),v=r(1),O=r(9),j=r(32),_=r(4),w=r(29),x=r(541),S=r(320),T=r(50),C=r(222),M=r(36),P=r(39),A=r(329),E=r(85),R=r(43),I=r(118),D=r(306),F=r(14);let L=class extends F.a{constructor(e){super(e),this.layerId=null,this.facilityIdField=null,this.siteIdField=null,this.nameField=null}};Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],L.prototype,"layerId",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],L.prototype,"facilityIdField",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],L.prototype,"siteIdField",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],L.prototype,"nameField",void 0),L=Object(i.a)([Object(_.a)("esri.layers.support.FacilityLayerInfo")],L);var k=L;let z=class extends F.a{constructor(e){super(e),this.layerId=null,this.levelIdField=null,this.facilityIdField=null,this.longNameField=null,this.shortNameField=null,this.levelNumberField=null,this.verticalOrderField=null}};Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],z.prototype,"layerId",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],z.prototype,"levelIdField",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],z.prototype,"facilityIdField",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],z.prototype,"longNameField",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],z.prototype,"shortNameField",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],z.prototype,"levelNumberField",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],z.prototype,"verticalOrderField",void 0),z=Object(i.a)([Object(_.a)("esri.layers.support.LevelLayerInfo")],z);var V=z;let N=class extends F.a{constructor(e){super(e),this.layerId=null,this.siteIdField=null,this.nameField=null}};Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],N.prototype,"layerId",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],N.prototype,"siteIdField",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],N.prototype,"nameField",void 0),N=Object(i.a)([Object(_.a)("esri.layers.support.SiteLayerInfo")],N);var U=N;let B=class extends F.a{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};Object(i.a)([Object(v.b)({type:V,json:{write:!0}})],B.prototype,"levelLayer",void 0),Object(i.a)([Object(v.b)({type:k,json:{write:!0}})],B.prototype,"facilityLayer",void 0),Object(i.a)([Object(v.b)({type:U,json:{write:!0}})],B.prototype,"siteLayer",void 0),B=Object(i.a)([Object(_.a)("esri.support.MapFloorInfo")],B);var G=B;const q="webscene:failed-to-copy-embedded-resources",H="webscene:schema-validation";var W=r(330),$=r(542);const Q={width:600,height:400},Z=1.5;function X(e){return{enabled:!(null==e||!e.length)}}var J,Y=r(37),K=r(375);let ee=J=class extends F.a{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new J({exactMatch:this.exactMatch,type:this.type,name:this.name})}};Object(i.a)([Object(v.b)({type:Boolean,json:{write:!0}})],ee.prototype,"exactMatch",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],ee.prototype,"name",void 0),Object(i.a)([Object(Y.a)(K.a)],ee.prototype,"type",void 0),ee=J=Object(i.a)([Object(_.a)("esri.webdoc.applicationProperties.SearchLayerField")],ee);var te,re=ee;let ie=te=class extends F.a{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new te(Object(u.a)({field:this.field,id:this.id,subLayer:this.subLayer}))}};Object(i.a)([Object(v.b)({type:re,json:{write:{isRequired:!0}}})],ie.prototype,"field",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:{isRequired:!0}}})],ie.prototype,"id",void 0),Object(i.a)([Object(v.b)({type:O.a,json:{write:!0}})],ie.prototype,"subLayer",void 0),ie=te=Object(i.a)([Object(_.a)("esri.webdoc.applicationProperties.SearchLayer")],ie);var ne,se=ie;let ae=ne=class extends F.a{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new ne({exactMatch:this.exactMatch,type:this.type,name:this.name})}};Object(i.a)([Object(v.b)({type:Boolean,json:{write:!0}})],ae.prototype,"exactMatch",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],ae.prototype,"name",void 0),Object(i.a)([Object(Y.a)(K.a)],ae.prototype,"type",void 0),ae=ne=Object(i.a)([Object(_.a)("esri.webdoc.applicationProperties.SearchTableField")],ae);var oe,le=ae;let ce=oe=class extends F.a{constructor(e){super(e),this.field=null,this.id=null}clone(){return new oe(Object(u.a)({field:this.field,id:this.id}))}};Object(i.a)([Object(v.b)({type:le,json:{write:{isRequired:!0}}})],ce.prototype,"field",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:{isRequired:!0}}})],ce.prototype,"id",void 0),ce=oe=Object(i.a)([Object(_.a)("esri.webdoc.applicationProperties.SearchTable")],ce);var ue,de=ce;const he=o.a.ofType(se),pe=o.a.ofType(de);let fe=ue=class extends F.a{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new he,this.tables=new pe}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,r){t[r]=!e}clone(){return new ue(Object(u.a)({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};Object(i.a)([Object(v.b)({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],fe.prototype,"addressSearchEnabled",void 0),Object(i.a)([Object(j.a)("addressSearchEnabled")],fe.prototype,"readAddressSearchEnabled",null),Object(i.a)([Object(w.a)("addressSearchEnabled")],fe.prototype,"writeAddressSearchEnabled",null),Object(i.a)([Object(v.b)({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],fe.prototype,"enabled",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],fe.prototype,"hintText",void 0),Object(i.a)([Object(v.b)({type:he,json:{write:{overridePolicy:X},origins:{"web-scene":{write:{isRequired:!0}}}}})],fe.prototype,"layers",void 0),Object(i.a)([Object(v.b)({type:pe,json:{read:!0,write:{overridePolicy:X},origins:{"web-scene":{read:!1,write:!1}}}})],fe.prototype,"tables",void 0),fe=ue=Object(i.a)([Object(_.a)("esri.webdoc.applicationProperties.Search")],fe);var be,me=fe;let ge=be=class extends F.a{constructor(e){super(e),this.search=null}clone(){return new be(Object(u.a)({search:this.search}))}};Object(i.a)([Object(v.b)({type:me,json:{write:!0}})],ge.prototype,"search",void 0),ge=be=Object(i.a)([Object(_.a)("esri.webdoc.applicationProperties.Viewing")],ge);var ye,ve=ge;let Oe=ye=class extends F.a{constructor(e){super(e),this.viewing=null}clone(){return new ye({viewing:this.viewing?this.viewing.clone():null})}};Object(i.a)([Object(v.b)({type:ve,json:{write:!0}})],Oe.prototype,"viewing",void 0),Oe=ye=Object(i.a)([Object(_.a)("esri.webscene.ApplicationProperties")],Oe);var je,_e=Oe,we=r(284);let xe=je=class extends F.a{constructor(e){super(e),this.environment=new we.a,this.spatialReference=null,this.viewpoint=null}set viewingMode(e){this._set("viewingMode",e)}clone(){return new je({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};Object(i.a)([Object(v.b)({type:we.a,json:{write:{isRequired:!0}}})],xe.prototype,"environment",void 0),Object(i.a)([Object(v.b)({type:P.a})],xe.prototype,"spatialReference",void 0),Object(i.a)([Object(v.b)({type:["local","global"]})],xe.prototype,"viewingMode",null),Object(i.a)([Object(v.b)({type:a.a,json:{write:{isRequired:!0}}})],xe.prototype,"viewpoint",void 0),xe=je=Object(i.a)([Object(_.a)("esri.webscene.InitialViewProperties")],xe);var Se,Te=xe,Ce=r(153),Me=r(45),Pe=r(328),Ae=r(102),Ee=r(3),Re=r(5),Ie=r(303),De=r(442),Fe=r(354),Le=r(67),ke=r(355),ze=r(80);let Ve=Se=class extends F.a{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new Se({url:this.url})}};Object(i.a)([Object(v.b)({type:String,json:{write:{isRequired:!0}}})],Ve.prototype,"url",void 0),Ve=Se=Object(i.a)([Object(_.a)("esri.webdoc.support.Thumbnail")],Ve);var Ne,Ue=Ve,Be=r(217);let Ge=Ne=class extends F.a{constructor(){super(...arguments),this.text=""}clone(){return new Ne({text:this.text})}};Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],Ge.prototype,"text",void 0),Ge=Ne=Object(i.a)([Object(_.a)("esri.webscene.support.Description")],Ge);var qe,He=Ge;let We=qe=class extends F.a{constructor(){super(...arguments),this.lighting=new Be.a}clone(){return new qe({lighting:Be.a.prototype.clone.call(this.lighting)})}};Object(i.a)([Object(v.b)({type:Be.a,json:{write:!0}})],We.prototype,"lighting",void 0),We=qe=Object(i.a)([Object(_.a)("esri.webscene.Environment")],We);var $e,Qe=r(283),Ze=r(200);let Xe=$e=class extends F.a{constructor(){super(...arguments),this.opacity=null}clone(){return new $e({opacity:this.opacity})}cloneAndApplyTo(e){return null==this.opacity||((e=null!=e?e.clone():new Qe.a).opacity=this.opacity),e}static fromGround(e){return new $e({opacity:e.opacity})}};Object(i.a)([Object(v.b)({type:Number,json:{type:O.a,read:{reader:Ze.b,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Object(Ze.a)(e)},target:"transparency"}}})],Xe.prototype,"opacity",void 0),Xe=$e=Object(i.a)([Object(_.a)("esri.webscene.support.SlideGround")],Xe);var Je,Ye=Xe;let Ke=Je=class extends F.a{constructor(e){super(e),this.id="",this.sublayerIds=null}clone(){return new Je({id:this.id,sublayerIds:Object(u.a)(this.sublayerIds)})}};Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],Ke.prototype,"id",void 0),Object(i.a)([Object(v.b)({type:[O.a],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],Ke.prototype,"sublayerIds",void 0),Ke=Je=Object(i.a)([Object(_.a)("esri.webscene.support.SlideVisibleLayer")],Ke);var et,tt=Ke;let rt=et=class extends F.a{constructor(){super(...arguments),this.text=""}clone(){return new et({text:this.text})}};Object(i.a)([Object(v.b)({type:String,json:{write:{isRequired:!0}}})],rt.prototype,"text",void 0),rt=et=Object(i.a)([Object(_.a)("esri.webscene.support.Title")],rt);var it=rt;let nt=0;const st=o.a.ofType(tt),at=p.a.getLogger("esri.webscene.Slide");let ot=class extends F.a{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+nt++,this.title=new it,this.description=new He,this.thumbnail=new Ue,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new We,this.visibleLayers=new st}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail&&this.thumbnail.destroy(),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return"string"==typeof e?new it({text:e}):Object(O.m)(it,e)}castDescription(e){return"string"==typeof e?new He({text:e}):Object(O.m)(He,e)}castThumbnail(e){return"string"==typeof e?new Ue({url:e}):Object(O.m)(Ue,e)}castBasemap(e){return Object(Fe.d)(e)}set visibleLayers(e){this._set("visibleLayers",Object(Ce.b)(e,this._get("visibleLayers"),st))}castVisibleLayers(e){return e&&"function"==typeof e.map?e.map((e=>{if("string"==typeof e)return{id:e};if(e instanceof Ie.a){const t=ct(e);return{id:e.id,sublayerIds:t}}return e.id?{id:e.id,sublayerIds:e.sublayerIds}:(at.warn('Invalid visible layer, expected { id }, Layer or "id"'),e)})):null}clone(){return new(0,this.constructor)({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})}_updateVisibleLayersFrom(e){const t=[];return Object(g.k)(this._getLayers(e.map).map((r=>e.whenLayerView(r).then((e=>{if(e.visible){const i=ct(r);t.push(new tt({id:e.layer.id,sublayerIds:i}))}})))).toArray()).then((()=>{this.visibleLayers.removeAll(),this.visibleLayers.addMany(t)}))}updateFrom(e,t){return t={screenshot:{format:"png",quality:80,width:120,height:75,disableDecorations:!0,...t&&t.screenshot}},e.when((()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=Be.a.prototype.clone.apply(e.environment.lighting),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?Ye.fromGround(e.map.ground):null,this._updateVisibleLayersFrom(e)))).then((()=>e.takeScreenshot(t.screenshot))).then((e=>(this.thumbnail=new Ue({url:e.dataUrl}),this)))}async applyTo(e,t){Object(f.j)(this._applyToController)&&this._applyToController.abort();let r=Object(g.e)();this._applyToController=r;const i=Object(g.t)(t,(()=>r.abort())),n=e.resourceController.scheduler.registerTask(ze.b.SLIDE);let s=!1;t={animate:!0,...t,signal:this._applyToController.signal};const a=await Object(Ae.d)(e.addUpdatingPromise((async()=>{n.schedule((()=>s=this._setViewpointOfInterest(e,t))),await n.schedule((()=>this._applyBasemap(e,t)),t.signal),n.schedule((()=>this._applyLayerVisibility(e)),t.signal),n.schedule((()=>this._applyGround(e)),t.signal),await n.schedule((()=>this._applyViewpoint(e,t)),t.signal)})()));if(s&&(e.contentCamera=null),n.remove(),this._applyToController===r&&(this._applyToController=null),r=null,null==i||i.remove(),!1===a.ok)throw a.error;return this}async _applyBasemap(e,t){if(this.basemap){try{await this.basemap.load(t)}catch(r){if(Object(g.n)(r))throw r}e.map.basemap=Object(Fe.a)(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const t=new o.a;return this._collectLayers(e,t),this._collectLayers(e.ground,t),t}_collectLayers(e,t){e.layers.forEach((e=>{Object(De.b)(e)&&(t.add(e),"layers"in e&&this._collectLayers(e,t))}))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach((e=>{const t=this.visibleLayers.find((t=>t.id===e.id));e.visible=null!=t;const r=t&&t.sublayerIds,i=lt(e);r&&i&&i.forEach((e=>e.visible=r.indexOf(e.id)>=0))}))}_setViewpointOfInterest(e,t){if(e.state.fixedContentCamera||!this.viewpoint||t.ignoreViewpoint||!t.useDestinationCamera)return!1;const r=Object(ke.c)(e,this.viewpoint);return e.contentCamera=r,Object(f.j)(r)}async _applyViewpoint(e,t){if(this.viewpoint&&!t.ignoreViewpoint){if(Object(f.j)(this.viewpoint.camera)&&(this.viewpoint.camera.fov=e.camera.fov),t.animate&&this.get("environment.lighting.date"))return void await this._animateToLighting(e,t);t.animate&&(e.environment.applyLighting(this.environment.lighting.clone()),await e.goTo(this.viewpoint,t)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,t){let r=null;"global"===e.viewingMode&&(r=this._animateLightingWithCamera(e)),e.environment.lighting.cameraTrackingEnabled=!1,e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,null!=this.environment.lighting.displayUTCOffset&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);const i=e.goTo(this.viewpoint,t),n=()=>{r&&r.remove(),e.environment.lighting.cameraTrackingEnabled=!0};return i.then((()=>{e.environment.applyLighting(this.environment.lighting.clone()),n()}),(e=>{throw n(),e}))}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,t,r){return e.setTime(t),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e){const t=new Date(e.environment.lighting.date.toString()),[r,i]=this._getTime(t),[n,s]=this._getTime(this.environment.lighting.date),a=function(e,t){let r=t-e;return r>dt&&(r-=ut),r<-dt&&(r+=ut),r}(i,s),o=e.renderCoordsHelper,l=Object(Re.e)();o.toRenderCoords(e.camera.position,l);const c=Object(Re.e)(),u=Object(Re.e)();Object(f.j)(this.viewpoint.camera)&&o.toRenderCoords(this.viewpoint.camera.position,c);const d=new Date;return e.watch("camera",(t=>{o.toRenderCoords(t.position,u);const s=Object(Ee.n)(l,u),h=Object(Ee.n)(c,u);let p=0;s+h!==0&&(p=s/(s+h));const f=r+(n-r)*p,b=function(e,t){return Object(Le.j)(e+t,ut)}(i,a*p);e.environment.lighting.date=this._setTime(d,f,b)}))}static createFrom(e,t){return(new this).updateFrom(e,t)}};function lt(e){if("building-scene"===e.type||"map-image"===e.type)return e.allSublayers.toArray()}function ct(e){const t=lt(e);if(t)return t.filter((e=>e.visible)).map((e=>e.id))}Object(i.a)([Object(v.b)({type:String,json:{write:{isRequired:!0}}})],ot.prototype,"id",void 0),Object(i.a)([Object(v.b)({type:it,json:{default:()=>new it({text:""}),write:{isRequired:!0}}})],ot.prototype,"title",void 0),Object(i.a)([Object(Me.a)("title")],ot.prototype,"castTitle",null),Object(i.a)([Object(v.b)({type:He,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.text)})}}})],ot.prototype,"description",void 0),Object(i.a)([Object(Me.a)("description")],ot.prototype,"castDescription",null),Object(i.a)([Object(v.b)({type:Ue,json:{default:()=>new Ue({url:""}),write:{isRequired:!0}}})],ot.prototype,"thumbnail",void 0),Object(i.a)([Object(Me.a)("thumbnail")],ot.prototype,"castThumbnail",null),Object(i.a)([Object(v.b)({type:a.a,nonNullable:!0,json:{write:{isRequired:!0}}})],ot.prototype,"viewpoint",void 0),Object(i.a)([Object(v.b)({type:Pe.default,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],ot.prototype,"basemap",void 0),Object(i.a)([Object(Me.a)("basemap")],ot.prototype,"castBasemap",null),Object(i.a)([Object(v.b)({type:Ye,json:{write:!0}})],ot.prototype,"ground",void 0),Object(i.a)([Object(v.b)({type:st,json:{write:{isRequired:!0}}})],ot.prototype,"visibleLayers",null),Object(i.a)([Object(Me.a)("visibleLayers")],ot.prototype,"castVisibleLayers",null),Object(i.a)([Object(v.b)({type:We,json:{write:!0}})],ot.prototype,"environment",void 0),ot=Object(i.a)([Object(_.a)("esri.webscene.Slide")],ot);const ut=86400,dt=43200;var ht=ot;const pt=o.a.ofType(ht);let ft=class extends F.a{constructor(e){super(e),this.slides=new pt}destroy(){this.slides.forEach((e=>e.destroy())),this.slides.removeAll()}set slides(e){e&&(e=e.filter((e=>!!e.viewpoint))),this._set("slides",Object(Ce.b)(e,this._get("slides"),pt))}clone(){return new(0,this.constructor)({slides:this.slides.clone()})}};Object(i.a)([Object(v.b)({type:pt,nonNullable:!0,json:{write:!0}}),Object(Me.a)(Ce.a)],ft.prototype,"slides",null),ft=Object(i.a)([Object(_.a)("esri.webscene.Presentation")],ft);var bt,mt=ft;let gt=bt=class extends F.a{constructor(e){super(e)}clone(){return new bt({name:this.name,path:this.path,title:this.title})}};Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],gt.prototype,"name",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],gt.prototype,"path",void 0),Object(i.a)([Object(v.b)({type:String,json:{write:!0}})],gt.prototype,"title",void 0),gt=bt=Object(i.a)([Object(_.a)("esri.webscene.TransportationNetwork")],gt);var yt=gt,vt=r(324);class Ot extends vt.a{constructor(e,t){super(e,t,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}const jt=p.a.getLogger("esri.WebScene"),_t=new Ot(1,24),wt="Web Scene",xt="ViewingMode-Local";let St=class extends(d.a.LoadableMixin(Object(m.b)(Object(b.a)(s.a)))){constructor(e){super(e),this._handles=new c.a,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=null,this.sourceVersion=null,this.supportsHeightModelInfo=!0,this.transportationNetworks=null,this.presentation=new mt,this.initialViewProperties=new Te,this.portalItem=null,this.resourceInfo=null,this.debouncedSaveOperations=Object(g.j)((async(e,t,r)=>{switch(e){case 0:return this._saveImpl(t);case 1:return this._saveAsImpl(r,t)}})),this.resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch((e=>{jt.error("#load()","Failed to load web scene",e)})),this.resourceInfo){let t;try{t=this._validateJSON(this.resourceInfo)}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(t),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",(()=>this._scheduleLayersIdGC())))}destroy(){this._unscheduleLayersIdGC(),this._handles.destroy(),this.presentation&&this.presentation.destroy();const e=this.portalItem;this.portalItem=null,null==e||e.destroy()}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,r,i){const n={...i,layerContainerType:"operational-layers"},s=e.map((e=>this.verifyWriteLayer(e,i)?e.write(null,n):null)).filter((e=>!!e));t[r]=s.toArray()}verifyWriteLayer(e,t){return"write"in e||(t&&t.messages&&t.messages.push(new l.a("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1)}readSourceVersion(e,t){const[r,i]=t.version.split(".");return new Ot(parseInt(r,10),parseInt(i,10))}writeSourceVersion(e,t,r){t[r]=`${_t.major}.${_t.minor}`}get thumbnailUrl(){return this.portalItem&&this.portalItem.thumbnailUrl||null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=n.d}writeGround(e,t,r,i){t[r]=e?e.write(null,i):{transparency:0,layers:[]}}readInitialViewProperties(e,t){const r={};return t.initialState&&t.initialState.environment&&(r.environment=we.a.fromJSON(t.initialState.environment)),t.spatialReference?r.spatialReference=P.a.fromJSON(t.spatialReference):r.spatialReference=P.a.WebMercator,r.viewingMode=t.viewingMode||"global",t.initialState&&t.initialState.viewpoint&&(r.viewpoint=a.a.fromJSON(t.initialState.viewpoint)),new Te(r)}get spatialReference(){var e,t;return null!=(e=null==(t=this.initialViewProperties)?void 0:t.spatialReference)?e:P.a.WebMercator}get viewingMode(){var e,t;return null!=(e=null==(t=this.initialViewProperties)?void 0:t.viewingMode)?e:"global"}load(e){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}loadAll(){return Object(h.a)(this,(e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map((e=>e.basemap)))}))}read(e,t){t={...t,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,i=this._isAuthoringAppSetByUser;if(Object(S.b)(this,e,(t=>super.read(e,t)),t),i||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){const t=e.baseMap.elevationLayers.map((e=>({id:e.id}))),r=this.presentation.slides,i=(e,t)=>e.visibleLayers.some((e=>e.id===t)),n=t.filter((e=>!r.some((t=>i(t,e.id)))));r.forEach((e=>{e.visibleLayers.addMany(n)}))}}_writeBasemapElevationLayers(e){const t=e.ground&&e.ground.layers;!e.baseMap&&t&&t.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=Object(u.a)(t))}write(e,t){var r;if("loaded"!==this.loadStatus){const e=new l.a("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw jt.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),e}this._runLayersIdGC();const i=!(null!=(r=t)&&r.messages);t={messages:[],...t,origin:"web-scene"};const n=super.write(e,t);if(i){const e=t.messages.filter((e=>"web-document-write:property-required"===e.name));if(e.length){const t=new l.a("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:e});throw jt.error("#toJSON()","One or more properties that are required in the webscene JSON are missing",e),t}}return this._writeBasemapElevationLayers(n),n}async save(e){return this.debouncedSaveOperations(0,e)}async _saveImpl(e){this.portalItem||(jt.error("save(): requires the .portalItem property to be set"),await Promise.reject(new l.a("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))),this.portalItem.type!==wt&&await Promise.reject(new l.a("webscene:portal-item-wrong-type",`Portal item needs to have type "${wt}"`));const t=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&Object(y.K)(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||I.a.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),i=this.write(null,r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(i,r,e),this._updateTypeKeywords(this.portalItem),await this.portalItem.update({data:i}),await Object($.a)(this.resourceReferences,r,null),Object(x.a)(r),t&&await t,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this.debouncedSaveOperations(1,t,e)}async _saveAsImpl(e,t){let r=D.default.from(e);r||(jt.error("saveAs(portalItem): requires a portal item parameter"),await Promise.reject(new l.a("webscene:portal-item-required","saveAs requires a portal item to save to"))),r.id&&(r=r.clone(),r.id=null);const i=r.portal||I.a.getDefault();await this._ensureLoadBeforeSave(),r.type=wt,r.portal=i;const n=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:i,portalItem:r,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),s=this.write(null,n);await Promise.all(n.resources.pendingOperations),await this._verifySaveAs(s,n,t);const a=this.thumbnailUrl,o=!this._isOverridden("thumbnailUrl");return this._updateTypeKeywords(r),await i._signIn(),await i.user.addItem({item:r,folder:t&&t.folder,data:s}),await Object($.a)(this.resourceReferences,n,null),this.portalItem=r,b.b.prototype.read.call(this,{version:s.version,authoringApp:s.authoringApp,authoringAppVersion:s.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl&&Object(y.K)(r.itemUrl)}),Object(x.a)(n),a&&(this.thumbnailUrl=o?Object(y.d)(a,"w","8192"):a),n.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,t,i,n=!1){if(!Object(R.f)(this.spatialReference))return Promise.reject(new l.a("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,a=t.messages.filter((e=>"error"===e.type)).map((e=>new l.a(e.name,e.message,e.details)));t.blockedRelativeUrls&&(a=a.concat(t.blockedRelativeUrls.map((e=>new l.a("url:unsupported",`Relative url '${e}' is not supported in Web Scene`))))),i&&i.ignoreUnsupported&&(a=a.filter((e=>"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&"symbol-layer:unsupported"!==e.name&&"property:unsupported"!==e.name&&"url:unsupported"!==e.name&&"scenemodification:unsupported"!==e.name))),null!=i&&i.requiredPropertyChecksDisabled&&(a=a.filter((e=>"web-document-write:property-required"!==e.name)));const o=i&&i.strictSchemaValidationEnabled;return s=o?Promise.all([r.e(22),r.e(211)]).then(r.bind(null,1170)).then((t=>{const r=t.validate(e);if(r.length>0){const e=`webscene did not validate:\n${r.join("\n")}`;jt.error(`${n?"saveAs":"save"}(): ${e}`)}return r.map((e=>new l.a("webscene:schema-validation",e)))})).then((e=>{if(o&&e.length>0)throw function(e){return new l.a(H,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})}(e.concat(a));return a})):Promise.resolve(a),s.then((e=>{if(e.length>0)return Promise.reject(new l.a("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:e}))}))}_verifySaveAs(e,t,r){return this.canSaveAs(t)?Promise.reject(new l.a(q,"Copying of embedded resources is currently not supported")):this._verifySave(e,t,r,!0)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write(null,t);return this._verifySaveAs(r,t,e)}canSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,e)),e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.length>0}async updateFrom(e,t={}){const r=this._updateFromInternal(e,t);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFromInternal(e,t={}){await e.whenReady(),!t.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=we.a.prototype.clone.apply(e.environment)),!t.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,e.clippingArea?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this&&e.allLayerViews.forEach((e=>{e.layer.visible=e.visible})),(!1===t.thumbnailExcluded||null==t.thumbnailExcluded&&!t.viewpointExcluded)&&await this._updateFromThumbnail(e,t.thumbnailSize||void 0)}async _updateFromThumbnail(e,t){const r=function(e,t){t=t||Q;let{width:r,height:i}=t;const n=r/i;return n<Z?i=r/Z:n>Z&&(r=i*Z),r>e.width&&(i*=e.width/r,r=e.width),i>e.height&&(r*=e.height/i,i=e.height),{width:Math.round(r),height:Math.round(i)}}(e,t),i=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=i.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,t){const r=this._validateJSON(e);return this.read(r,t),this._loadFromJSON(r,t)}_extractOperationalLayers(e){const t=[];if(!this.sourceVersion.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const n of e.baseMap.elevationLayers)t.push(n);const r=[],i=e=>(e.layers&&(e.layers=e.layers.filter(i)),"ArcGISTiledElevationServiceLayer"!==e.layerType||(this.sourceVersion.supportsGround||r.push(e),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(i):[],operationalElevationLayers:r,basemapElevationLayers:t}}_loadFromJSON(e,t){const i=new o.a;return this._validateSpatialReference().then((()=>this._validateHeightModelInfo())).then((()=>r.e(11).then(r.bind(null,695)))).then((({populateOperationalLayers:r})=>{const{operationalLayers:n,operationalElevationLayers:s,basemapElevationLayers:a}=this._extractOperationalLayers(e),o=[],l={context:{...t,layerContainerType:"operational-layers"}};if(this.portalItem&&(l.context.portal=this.portalItem.portal||I.a.getDefault()),a.length>0){const e={...l,context:{...l.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",o.push(r(this.ground.layers,a,e))}if(s.length>0){const e={...l,context:{...l.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",o.push(r(i,s,e))}return n&&n.length>0&&o.push(r(this.layers,n,l)),Object(g.k)(o).then((()=>{}))})).then((()=>this._loadObjectsWithLayers())).then((()=>{this.ground.layers.addMany(i)}))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[];for(const t of this.allLayers.items)if("beforeSave"in t&&"function"==typeof t.beforeSave){const r=t.beforeSave();r&&e.push(r)}await Object(g.k)(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach((t=>{t.basemap&&e.push(t.basemap.load())})),await Object(g.k)(e)}async _loadFromItem(e){if(await e.load().catch((e=>{throw new l.a("webscene:load-portal-item","Failed to load portal item",{error:e})})),"Web Scene"!==e.type)throw new l.a("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const r={origin:"web-scene",url:Object(y.K)(e.itemUrl),portal:e.portal||I.a.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(t,r),this.resourceReferences={portalItem:e,paths:r.readResourcePaths}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let r;if("local"!==e.viewingMode){if(!Object(W.a)(t,"global"))return Promise.reject(new l.a("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||Object(M.b)(e,t)}else{if(!Object(W.a)(t,"local"))return Promise.reject(new l.a("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||e.equals(t)}const i=e=>e&&(Object(f.j)(e.camera)&&e.camera.position&&e.camera.position.spatialReference||Object(f.j)(e.targetGeometry)&&e.targetGeometry.spatialReference),n=e.viewpoint,s=i(n);if(s&&!r(s))return Promise.reject(new l.a("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:s,sceneSpatialReference:t,viewingMode:e.viewingMode}));const a=this.presentation.slides.find((e=>!r(i(e.viewpoint))));if(a){const r=i(a.viewpoint);return Promise.reject(new l.a("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:r,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=Object(A.d)(this.heightModelInfo,e);return t?Promise.reject(t):Promise.resolve()}_validateJSON(e){const t=Ot.parse(e.version||"","webscene");return _t.validate(t),e.version=`${t.major}.${t.minor}`,1===t.major&&t.minor<=2&&(e.spatialReference=P.a.WebMercator.toJSON()),e}_updateTypeKeywords(e){"local"===this.initialViewProperties.viewingMode?e.typeKeywords?-1===e.typeKeywords.indexOf(xt)&&e.typeKeywords.push(xt):e.typeKeywords=[xt]:"global"===this.initialViewProperties.viewingMode&&e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((e=>e!==xt))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||P.a.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem&&this.portalItem.itemUrl?Object(y.K)(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout((()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()}),3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,t=e=>!!this.allLayers.find((t=>t.id===e));e&&e.layers&&(e.layers=e.layers.filter((e=>t(e.id))));const r=this.presentation&&this.presentation.slides;r&&r.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>t(e.id))))}))}static fromJSON(e){if(!e)throw new l.a("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};St.VERSION=_t,Object(i.a)([Object(v.b)({type:_e,json:{write:!0}})],St.prototype,"applicationProperties",void 0),Object(i.a)([Object(v.b)({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],St.prototype,"basemap",void 0),Object(i.a)([Object(v.b)({type:T.a,json:{read:{source:"clippingArea.geometry",reader:E.a},write:{target:"clippingArea.geometry"}}})],St.prototype,"clippingArea",void 0),Object(i.a)([Object(w.a)("clippingArea")],St.prototype,"writeClippingArea",null),Object(i.a)([Object(v.b)({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],St.prototype,"clippingEnabled",void 0),Object(i.a)([Object(j.a)("clippingEnabled",["clippingArea"])],St.prototype,"readClippingEnabled",null),Object(i.a)([Object(w.a)("clippingEnabled")],St.prototype,"writeClippingEnabled",null),Object(i.a)([Object(v.b)({type:G,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],St.prototype,"floorInfo",void 0),Object(i.a)([Object(v.b)({type:C.a,json:{write:!0}})],St.prototype,"heightModelInfo",void 0),Object(i.a)([Object(v.b)({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],St.prototype,"layers",void 0),Object(i.a)([Object(w.a)("layers")],St.prototype,"writeLayers",null),Object(i.a)([Object(v.b)({readOnly:!0,type:Ot,json:{type:(()=>{const e=[],t=_t.major;for(let r=8;r<=_t.minor;r++)e.push(`${t}.${r}`);return e})(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],St.prototype,"sourceVersion",void 0),Object(i.a)([Object(j.a)("sourceVersion",["version"])],St.prototype,"readSourceVersion",null),Object(i.a)([Object(w.a)("sourceVersion")],St.prototype,"writeSourceVersion",null),Object(i.a)([Object(v.b)({json:{read:!1,write:!1}})],St.prototype,"tables",void 0),Object(i.a)([Object(v.b)()],St.prototype,"thumbnailUrl",null),Object(i.a)([Object(v.b)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],St.prototype,"authoringApp",null),Object(i.a)([Object(w.a)("authoringApp")],St.prototype,"writeAuthoringApp",null),Object(i.a)([Object(v.b)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],St.prototype,"authoringAppVersion",null),Object(i.a)([Object(w.a)("authoringAppVersion")],St.prototype,"writeAuthoringAppVersion",null),Object(i.a)([Object(v.b)({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],St.prototype,"ground",void 0),Object(i.a)([Object(w.a)("ground")],St.prototype,"writeGround",null),Object(i.a)([Object(v.b)({type:o.a.ofType(yt),json:{write:!0}})],St.prototype,"transportationNetworks",void 0),Object(i.a)([Object(v.b)({type:mt,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,r,i)=>{if(e.slides&&e.slides.length>0){const r={...i,isPresentation:!0};t.presentation=e.write(null,r)}}}}})],St.prototype,"presentation",void 0),Object(i.a)([Object(v.b)({type:Te,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new Te({viewingMode:"global",spatialReference:P.a.WebMercator})}})],St.prototype,"initialViewProperties",void 0),Object(i.a)([Object(j.a)("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],St.prototype,"readInitialViewProperties",null),Object(i.a)([Object(v.b)({type:P.a,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],St.prototype,"spatialReference",null),Object(i.a)([Object(v.b)({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],St.prototype,"viewingMode",null),Object(i.a)([Object(v.b)({type:D.default})],St.prototype,"portalItem",void 0),Object(i.a)([Object(v.b)()],St.prototype,"resourceInfo",void 0),St=Object(i.a)([Object(_.a)("esri.WebScene")],St);var Tt=St;t.a=Tt},function(e,t,r){"use strict";r.r(t),r.d(t,"work",(function(){return _})),r.d(t,"wrappedWork",(function(){return j}));var i=r(515);function n(e,t,r){const i=t/3,n=new Uint32Array(r+1),s=new Uint32Array(r+1),a=(e,t)=>{e<t?n[e+1]++:s[t+1]++};for(let g=0;g<i;g++){const t=e[3*g],r=e[3*g+1],i=e[3*g+2];a(t,r),a(r,i),a(i,t)}let o=0,l=0;for(let g=0;g<r;g++){const e=n[g+1],t=s[g+1];n[g+1]=o,s[g+1]=l,o+=e,l+=t}const c=new Uint32Array(6*i),u=n[r],d=(e,t,r)=>{if(e<t){const i=n[e+1]++;c[2*i]=t,c[2*i+1]=r}else{const i=s[t+1]++;c[2*u+2*i]=e,c[2*u+2*i+1]=r}};for(let g=0;g<i;g++){const t=e[3*g],r=e[3*g+1],i=e[3*g+2];d(t,r,g),d(r,i,g),d(i,t,g)}const h=(e,t)=>{const r=2*e,i=t-e;for(let n=1;n<i;n++){const e=c[r+2*n],t=c[r+2*n+1];let i=n-1;for(;i>=0&&c[r+2*i]>e;i--)c[r+2*i+2]=c[r+2*i],c[r+2*i+3]=c[r+2*i+1];c[r+2*i+2]=e,c[r+2*i+3]=t}};for(let g=0;g<r;g++)h(n[g],n[g+1]),h(u+s[g],u+s[g+1]);const p=new Int32Array(3*i),f=(t,r)=>t===e[3*r]?0:t===e[3*r+1]?1:t===e[3*r+2]?2:-1,b=(e,t)=>{const r=f(e,t);p[3*t+r]=-1},m=(e,t,r,i)=>{const n=f(e,t);p[3*t+n]=i;const s=f(r,i);p[3*i+s]=t};for(let g=0;g<r;g++){let e=n[g];const t=n[g+1];let r=s[g];const i=s[g+1];for(;e<t&&r<i;){const t=c[2*e],i=c[2*u+2*r];t===i?(m(g,c[2*e+1],i,c[2*u+2*r+1]),e++,r++):t<i?(b(g,c[2*e+1]),e++):(b(i,c[2*u+2*r+1]),r++)}for(;e<t;)b(g,c[2*e+1]),e++;for(;r<i;)b(c[2*u+2*r],c[2*u+2*r+1]),r++}return p}var s=r(406),a=r(158),o=r(405),l=r(87),c=r(10),u=r(81),d=r(3),h=r(5);const p=-1;function f(e,t,r,i=O){const n=e.vertices.position,s=e.vertices.componentIndex,a=Object(c.g)(i.anglePlanar),o=Object(c.g)(i.angleSignificantEdge),h=Math.cos(o),f=Math.cos(a),j=y.edge,_=j.position0,w=j.position1,x=j.faceNormal0,S=j.faceNormal1,T=function(e){const t=e.faces.length/3,r=e.vertices.position,i=e.faces,n=v.v0,s=v.v1,a=v.v2,o=new Float32Array(3*t);for(let l=0;l<t;l++){const e=i[3*l+0],t=i[3*l+1],c=i[3*l+2];r.getVec(e,n),r.getVec(t,s),r.getVec(c,a),Object(d.l)(s,s,n),Object(d.l)(a,a,n),Object(d.i)(n,s,a),Object(d.t)(n,n),o[3*l+0]=n[0],o[3*l+1]=n[1],o[3*l+2]=n[2]}return o}(e),C=function(e){const t=e.faces.length/3,r=e.faces,i=e.neighbors;let n=0;for(let o=0;o<t;o++){const e=i[3*o+0],t=i[3*o+1],s=i[3*o+2],a=r[3*o+0],l=r[3*o+1],c=r[3*o+2];n+=e===p||a<l?1:0,n+=t===p||l<c?1:0,n+=s===p||c<a?1:0}const s=new Int32Array(4*n);let a=0;for(let o=0;o<t;o++){const e=i[3*o+0],t=i[3*o+1],n=i[3*o+2],l=r[3*o+0],c=r[3*o+1],u=r[3*o+2];(e===p||l<c)&&(s[a++]=l,s[a++]=c,s[a++]=o,s[a++]=e),(t===p||c<u)&&(s[a++]=c,s[a++]=u,s[a++]=o,s[a++]=t),(n===p||u<l)&&(s[a++]=u,s[a++]=l,s[a++]=o,s[a++]=n)}return s}(e),M=C.length/4,P=t.allocate(M);let A=0;const E=M,R=r.allocate(E);let I=0,D=0,F=0;const L=Object(l.i)(0,M),k=new Float32Array(M);Object(u.b)(k,((e,t,r)=>{n.getVec(C[4*t+0],_),n.getVec(C[4*t+1],w),r[t]=Object(d.o)(_,w)})),L.sort(((e,t)=>k[t]-k[e]));const z=new Array,V=new Array;for(let l=0;l<M;l++){const e=L[l],i=k[e],o=C[4*e+0],c=C[4*e+1],u=C[4*e+2],y=C[4*e+3],v=y===p;if(n.getVec(o,_),n.getVec(c,w),v)Object(d.y)(x,T[3*u+0],T[3*u+1],T[3*u+2]),Object(d.m)(S,x),j.componentIndex=s.get(o),j.cosAngle=Object(d.j)(x,S);else{if(Object(d.y)(x,T[3*u+0],T[3*u+1],T[3*u+2]),Object(d.y)(S,T[3*y+0],T[3*y+1],T[3*y+2]),j.componentIndex=s.get(o),j.cosAngle=Object(d.j)(x,S),m(j,f))continue;j.cosAngle<-.9999&&Object(d.m)(S,x)}D+=i,F++,v||b(j,h)?(t.write(P,A++,j),z.push(i)):g(j,a)&&(r.write(R,I++,j),V.push(i))}const N=new Float32Array(z.reverse()),U=new Float32Array(V.reverse());return{regular:{instancesData:t.trim(P,A),lodInfo:{lengths:N}},silhouette:{instancesData:r.trim(R,I),lodInfo:{lengths:U}},averageEdgeLength:D/F}}function b(e,t){return e.cosAngle<t}function m(e,t){return e.cosAngle>t}function g(e,t){const r=Object(c.b)(e.cosAngle),i=y.fwd,n=y.ortho;return Object(d.x)(i,e.position1,e.position0),r*(Object(d.j)(Object(d.i)(n,e.faceNormal0,e.faceNormal1),i)>0?-1:1)>t}const y={edge:{position0:Object(h.e)(),position1:Object(h.e)(),faceNormal0:Object(h.e)(),faceNormal1:Object(h.e)(),componentIndex:0,cosAngle:0},ortho:Object(h.e)(),fwd:Object(h.e)()},v={v0:Object(h.e)(),v1:Object(h.e)(),v2:Object(h.e)()},O={anglePlanar:4,angleSignificantEdge:35};async function j(e){const t=function(e){return{data:a.a.createView(e.dataBuffer),indices:"Uint32Array"===e.indicesType?new Uint32Array(e.indicesBuffer):"Uint16Array"===e.indicesType?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}(e),r=_(t),i=[t.data.buffer];return{result:w(r,i),transferList:i}}function _(e){const t=function(e,t,r,s){if(t)return{faces:r,facesLength:s,neighbors:n(r,s,e.count),vertices:e};const o=Object(i.a)(e.buffer,e.stride/4,{originalIndices:r,originalIndicesLength:s}),l=n(o.indices,s,o.uniqueCount);return{faces:o.indices,facesLength:o.indices.length,neighbors:l,vertices:a.a.createView(o.buffer)}}(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return x.updateSettings(e.writerSettings),S.updateSettings(e.writerSettings),f(t,x,S)}function w(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:Object(s.a)(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:Object(s.a)(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}const x=new o.a,S=new o.b},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(i){"object"===typeof window&&(r=window)}e.exports=r},,,function(e,t,r){"use strict";var i=r(551),n=60103,s=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var a=60109,o=60110,l=60112;t.Suspense=60113;var c=60115,u=60116;if("function"===typeof Symbol&&Symbol.for){var d=Symbol.for;n=d("react.element"),s=d("react.portal"),t.Fragment=d("react.fragment"),t.StrictMode=d("react.strict_mode"),t.Profiler=d("react.profiler"),a=d("react.provider"),o=d("react.context"),l=d("react.forward_ref"),t.Suspense=d("react.suspense"),c=d("react.memo"),u=d("react.lazy")}var h="function"===typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b={};function m(e,t,r){this.props=e,this.context=t,this.refs=b,this.updater=r||f}function g(){}function y(e,t,r){this.props=e,this.context=t,this.refs=b,this.updater=r||f}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},g.prototype=m.prototype;var v=y.prototype=new g;v.constructor=y,i(v,m.prototype),v.isPureReactComponent=!0;var O={current:null},j=Object.prototype.hasOwnProperty,_={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,r){var i,s={},a=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)j.call(t,i)&&!_.hasOwnProperty(i)&&(s[i]=t[i]);var l=arguments.length-2;if(1===l)s.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===s[i]&&(s[i]=l[i]);return{$$typeof:n,type:e,key:a,ref:o,props:s,_owner:O.current}}function x(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var S=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,r,i,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case s:l=!0}}if(l)return a=a(l=e),e=""===i?"."+T(l,0):i,Array.isArray(a)?(r="",null!=e&&(r=e.replace(S,"$&/")+"/"),C(a,t,r,"",(function(e){return e}))):null!=a&&(x(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(S,"$&/")+"/")+e)),t.push(a)),1;if(l=0,i=""===i?".":i+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=i+T(o=e[c],c);l+=C(o,t,r,u,a)}else if("function"===typeof(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e)))for(e=u.call(e),c=0;!(o=e.next()).done;)l+=C(o=o.value,t,r,u=i+T(o,c++),a);else if("object"===o)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function M(e,t,r){if(null==e)return e;var i=[],n=0;return C(e,i,"","",(function(e){return t.call(r,e,n++)})),i}function P(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var A={current:null};function E(){var e=A.current;if(null===e)throw Error(p(321));return e}var R={ReactCurrentDispatcher:A,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:O,IsSomeRendererActing:{current:!1},assign:i};t.Children={map:M,forEach:function(e,t,r){M(e,(function(){t.apply(this,arguments)}),r)},count:function(e){var t=0;return M(e,(function(){t++})),t},toArray:function(e){return M(e,(function(e){return e}))||[]},only:function(e){if(!x(e))throw Error(p(143));return e}},t.Component=m,t.PureComponent=y,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error(p(267,e));var s=i({},e.props),a=e.key,o=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,l=O.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)j.call(t,u)&&!_.hasOwnProperty(u)&&(s[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)s.children=r;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];s.children=c}return{$$typeof:n,type:e.type,key:a,ref:o,props:s,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:o,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return E().useCallback(e,t)},t.useContext=function(e,t){return E().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return E().useEffect(e,t)},t.useImperativeHandle=function(e,t,r){return E().useImperativeHandle(e,t,r)},t.useLayoutEffect=function(e,t){return E().useLayoutEffect(e,t)},t.useMemo=function(e,t){return E().useMemo(e,t)},t.useReducer=function(e,t,r){return E().useReducer(e,t,r)},t.useRef=function(e){return E().useRef(e)},t.useState=function(e){return E().useState(e)},t.version="17.0.2"},function(e,t,r){"use strict";var i=r(345),n=r(551),s=r(679);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!i)throw Error(a(227));var o=new Set,l={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(l[e]=t,e=0;e<t.length;e++)o.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,f={},b={};function m(e,t,r,i,n,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function O(e,t,r,i){var n=g.hasOwnProperty(t)?g[t]:null;(null!==n?0===n.type:!i&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,r,i){if(null===t||"undefined"===typeof t||function(e,t,r,i){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,r,i))return!0;if(i)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,r,n,i)&&(r=null),i||null===n?function(e){return!!p.call(b,e)||!p.call(f,e)&&(h.test(e)?b[e]=!0:(f[e]=!0,!1))}(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):n.mustUseProperty?e[n.propertyName]=null===r?3!==n.type&&"":r:(t=n.attributeName,i=n.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(n=n.type)||4===n&&!0===r?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var j=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=60103,w=60106,x=60107,S=60108,T=60114,C=60109,M=60110,P=60112,A=60113,E=60120,R=60115,I=60116,D=60121,F=60128,L=60129,k=60130,z=60131;if("function"===typeof Symbol&&Symbol.for){var V=Symbol.for;_=V("react.element"),w=V("react.portal"),x=V("react.fragment"),S=V("react.strict_mode"),T=V("react.profiler"),C=V("react.provider"),M=V("react.context"),P=V("react.forward_ref"),A=V("react.suspense"),E=V("react.suspense_list"),R=V("react.memo"),I=V("react.lazy"),D=V("react.block"),V("react.scope"),F=V("react.opaque.id"),L=V("react.debug_trace_mode"),k=V("react.offscreen"),z=V("react.legacy_hidden")}var N,U="function"===typeof Symbol&&Symbol.iterator;function B(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=U&&e[U]||e["@@iterator"])?e:null}function G(e){if(void 0===N)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);N=t&&t[1]||""}return"\n"+N+e}var q=!1;function H(e,t){if(!e||q)return"";q=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var n=l.stack.split("\n"),s=i.stack.split("\n"),a=n.length-1,o=s.length-1;1<=a&&0<=o&&n[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||n[a]!==s[o])return"\n"+n[a].replace(" at new "," at ")}while(1<=a&&0<=o);break}}}finally{q=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?G(e):""}function W(e){switch(e.tag){case 5:return G(e.type);case 16:return G("Lazy");case 13:return G("Suspense");case 19:return G("SuspenseList");case 0:case 2:case 15:return e=H(e.type,!1);case 11:return e=H(e.type.render,!1);case 22:return e=H(e.type._render,!1);case 1:return e=H(e.type,!0);default:return""}}function $(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case x:return"Fragment";case w:return"Portal";case T:return"Profiler";case S:return"StrictMode";case A:return"Suspense";case E:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case M:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case P:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case R:return $(e.type);case D:return $(e._render);case I:t=e._payload,e=e._init;try{return $(e(t))}catch(r){}}return null}function Q(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function X(e){e._valueTracker||(e._valueTracker=function(e){var t=Z(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var n=r.get,s=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=Z(e)?e.checked?"true":"false":e.value),(e=i)!==r&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function K(e,t){var r=t.checked;return n({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:e._wrapperState.initialChecked})}function ee(e,t){var r=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;r=Q(null!=t.value?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&O(e,"checked",t,!1)}function re(e,t){te(e,t);var r=Q(t.value),i=t.type;if(null!=r)"number"===i?(0===r&&""===e.value||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ne(e,t.type,r):t.hasOwnProperty("defaultValue")&&ne(e,t.type,Q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ie(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}""!==(r=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==r&&(e.name=r)}function ne(e,t,r){"number"===t&&Y(e.ownerDocument)===e||(null==r?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}function se(e,t){return e=n({children:void 0},t),(t=function(e){var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function ae(e,t,r,i){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&i&&(e[r].defaultSelected=!0)}else{for(r=""+Q(r),t=null,n=0;n<e.length;n++){if(e[n].value===r)return e[n].selected=!0,void(i&&(e[n].defaultSelected=!0));null!==t||e[n].disabled||(t=e[n])}null!==t&&(t.selected=!0)}}function oe(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return n({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var r=t.value;if(null==r){if(r=t.children,t=t.defaultValue,null!=r){if(null!=t)throw Error(a(92));if(Array.isArray(r)){if(!(1>=r.length))throw Error(a(93));r=r[0]}t=r}null==t&&(t=""),r=t}e._wrapperState={initialValue:Q(r)}}function ce(e,t){var r=Q(t.value),i=Q(t.defaultValue);null!=r&&((r=""+r)!==e.value&&(e.value=r),null==t.defaultValue&&e.defaultValue!==r&&(e.defaultValue=r)),null!=i&&(e.defaultValue=""+i)}function ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var de="http://www.w3.org/1999/xhtml",he="http://www.w3.org/2000/svg";function pe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?pe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var be,me,ge=(me=function(e,t){if(e.namespaceURI!==he||"innerHTML"in e)e.innerHTML=t;else{for((be=be||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=be.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction((function(){return me(e,t)}))}:me);function ye(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var ve={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Oe=["Webkit","ms","Moz","O"];function je(e,t,r){return null==t||"boolean"===typeof t||""===t?"":r||"number"!==typeof t||0===t||ve.hasOwnProperty(e)&&ve[e]?(""+t).trim():t+"px"}function _e(e,t){for(var r in e=e.style,t)if(t.hasOwnProperty(r)){var i=0===r.indexOf("--"),n=je(r,t[r],i);"float"===r&&(r="cssFloat"),i?e.setProperty(r,n):e[r]=n}}Object.keys(ve).forEach((function(e){Oe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ve[t]=ve[e]}))}));var we=n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xe(e,t){if(t){if(we[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function Se(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Te(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ce=null,Me=null,Pe=null;function Ae(e){if(e=Ki(e)){if("function"!==typeof Ce)throw Error(a(280));var t=e.stateNode;t&&(t=tn(t),Ce(e.stateNode,e.type,t))}}function Ee(e){Me?Pe?Pe.push(e):Pe=[e]:Me=e}function Re(){if(Me){var e=Me,t=Pe;if(Pe=Me=null,Ae(e),t)for(e=0;e<t.length;e++)Ae(t[e])}}function Ie(e,t){return e(t)}function De(e,t,r,i,n){return e(t,r,i,n)}function Fe(){}var Le=Ie,ke=!1,ze=!1;function Ve(){null===Me&&null===Pe||(Fe(),Re())}function Ne(e,t){var r=e.stateNode;if(null===r)return null;var i=tn(r);if(null===i)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(r&&"function"!==typeof r)throw Error(a(231,t,typeof r));return r}var Ue=!1;if(d)try{var Be={};Object.defineProperty(Be,"passive",{get:function(){Ue=!0}}),window.addEventListener("test",Be,Be),window.removeEventListener("test",Be,Be)}catch(me){Ue=!1}function Ge(e,t,r,i,n,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(u){this.onError(u)}}var qe=!1,He=null,We=!1,$e=null,Qe={onError:function(e){qe=!0,He=e}};function Ze(e,t,r,i,n,s,a,o,l){qe=!1,He=null,Ge.apply(Qe,arguments)}function Xe(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ye(e){if(Xe(e)!==e)throw Error(a(188))}function Ke(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Xe(e)))throw Error(a(188));return t!==e?null:e}for(var r=e,i=t;;){var n=r.return;if(null===n)break;var s=n.alternate;if(null===s){if(null!==(i=n.return)){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return Ye(n),e;if(s===i)return Ye(n),t;s=s.sibling}throw Error(a(188))}if(r.return!==i.return)r=n,i=s;else{for(var o=!1,l=n.child;l;){if(l===r){o=!0,r=n,i=s;break}if(l===i){o=!0,i=n,r=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===r){o=!0,r=s,i=n;break}if(l===i){o=!0,i=s,r=n;break}l=l.sibling}if(!o)throw Error(a(189))}}if(r.alternate!==i)throw Error(a(190))}if(3!==r.tag)throw Error(a(188));return r.stateNode.current===r?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var r=e.alternate;null!==t;){if(t===e||t===r)return!0;t=t.return}return!1}var tt,rt,it,nt,st=!1,at=[],ot=null,lt=null,ct=null,ut=new Map,dt=new Map,ht=[],pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ft(e,t,r,i,n){return{blockedOn:e,domEventName:t,eventSystemFlags:16|r,nativeEvent:n,targetContainers:[i]}}function bt(e,t){switch(e){case"focusin":case"focusout":ot=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":ct=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":dt.delete(t.pointerId)}}function mt(e,t,r,i,n,s){return null===e||e.nativeEvent!==s?(e=ft(t,r,i,n,s),null!==t&&(null!==(t=Ki(t))&&rt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==n&&-1===t.indexOf(n)&&t.push(n),e)}function gt(e){var t=Yi(e.target);if(null!==t){var r=Xe(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=Je(r)))return e.blockedOn=t,void nt(e.lanePriority,(function(){s.unstable_runWithPriority(e.priority,(function(){it(r)}))}))}else if(3===t&&r.stateNode.hydrate)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function yt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==r)return null!==(t=Ki(r))&&rt(t),e.blockedOn=r,!1;t.shift()}return!0}function vt(e,t,r){yt(e)&&r.delete(t)}function Ot(){for(st=!1;0<at.length;){var e=at[0];if(null!==e.blockedOn){null!==(e=Ki(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var r=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==r){e.blockedOn=r;break}t.shift()}null===e.blockedOn&&at.shift()}null!==ot&&yt(ot)&&(ot=null),null!==lt&&yt(lt)&&(lt=null),null!==ct&&yt(ct)&&(ct=null),ut.forEach(vt),dt.forEach(vt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,st||(st=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Ot)))}function _t(e){function t(t){return jt(t,e)}if(0<at.length){jt(at[0],e);for(var r=1;r<at.length;r++){var i=at[r];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==ot&&jt(ot,e),null!==lt&&jt(lt,e),null!==ct&&jt(ct,e),ut.forEach(t),dt.forEach(t),r=0;r<ht.length;r++)(i=ht[r]).blockedOn===e&&(i.blockedOn=null);for(;0<ht.length&&null===(r=ht[0]).blockedOn;)gt(r),null===r.blockedOn&&ht.shift()}function wt(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var xt={animationend:wt("Animation","AnimationEnd"),animationiteration:wt("Animation","AnimationIteration"),animationstart:wt("Animation","AnimationStart"),transitionend:wt("Transition","TransitionEnd")},St={},Tt={};function Ct(e){if(St[e])return St[e];if(!xt[e])return e;var t,r=xt[e];for(t in r)if(r.hasOwnProperty(t)&&t in Tt)return St[e]=r[t];return e}d&&(Tt=document.createElement("div").style,"AnimationEvent"in window||(delete xt.animationend.animation,delete xt.animationiteration.animation,delete xt.animationstart.animation),"TransitionEvent"in window||delete xt.transitionend.transition);var Mt=Ct("animationend"),Pt=Ct("animationiteration"),At=Ct("animationstart"),Et=Ct("transitionend"),Rt=new Map,It=new Map,Dt=["abort","abort",Mt,"animationEnd",Pt,"animationIteration",At,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Et,"transitionEnd","waiting","waiting"];function Ft(e,t){for(var r=0;r<e.length;r+=2){var i=e[r],n=e[r+1];n="on"+(n[0].toUpperCase()+n.slice(1)),It.set(i,t),Rt.set(i,n),c(n,[i])}}(0,s.unstable_now)();var Lt=8;function kt(e){if(0!==(1&e))return Lt=15,1;if(0!==(2&e))return Lt=14,2;if(0!==(4&e))return Lt=13,4;var t=24&e;return 0!==t?(Lt=12,t):0!==(32&e)?(Lt=11,32):0!==(t=192&e)?(Lt=10,t):0!==(256&e)?(Lt=9,256):0!==(t=3584&e)?(Lt=8,t):0!==(4096&e)?(Lt=7,4096):0!==(t=4186112&e)?(Lt=6,t):0!==(t=62914560&e)?(Lt=5,t):67108864&e?(Lt=4,67108864):0!==(134217728&e)?(Lt=3,134217728):0!==(t=805306368&e)?(Lt=2,t):0!==(1073741824&e)?(Lt=1,1073741824):(Lt=8,e)}function zt(e,t){var r=e.pendingLanes;if(0===r)return Lt=0;var i=0,n=0,s=e.expiredLanes,a=e.suspendedLanes,o=e.pingedLanes;if(0!==s)i=s,n=Lt=15;else if(0!==(s=134217727&r)){var l=s&~a;0!==l?(i=kt(l),n=Lt):0!==(o&=s)&&(i=kt(o),n=Lt)}else 0!==(s=r&~a)?(i=kt(s),n=Lt):0!==o&&(i=kt(o),n=Lt);if(0===i)return 0;if(i=r&((0>(i=31-qt(i))?0:1<<i)<<1)-1,0!==t&&t!==i&&0===(t&a)){if(kt(t),n<=Lt)return t;Lt=n}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)n=1<<(r=31-qt(t)),i|=e[r],t&=~n;return i}function Vt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Nt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Ut(24&~t))?Nt(10,t):e;case 10:return 0===(e=Ut(192&~t))?Nt(8,t):e;case 8:return 0===(e=Ut(3584&~t))&&(0===(e=Ut(4186112&~t))&&(e=512)),e;case 2:return 0===(t=Ut(805306368&~t))&&(t=268435456),t}throw Error(a(358,e))}function Ut(e){return e&-e}function Bt(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Gt(e,t,r){e.pendingLanes|=t;var i=t-1;e.suspendedLanes&=i,e.pingedLanes&=i,(e=e.eventTimes)[t=31-qt(t)]=r}var qt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Ht(e)/Wt|0)|0},Ht=Math.log,Wt=Math.LN2;var $t=s.unstable_UserBlockingPriority,Qt=s.unstable_runWithPriority,Zt=!0;function Xt(e,t,r,i){ke||Fe();var n=Yt,s=ke;ke=!0;try{De(n,e,t,r,i)}finally{(ke=s)||Ve()}}function Jt(e,t,r,i){Qt($t,Yt.bind(null,e,t,r,i))}function Yt(e,t,r,i){var n;if(Zt)if((n=0===(4&t))&&0<at.length&&-1<pt.indexOf(e))e=ft(null,e,t,r,i),at.push(e);else{var s=Kt(e,t,r,i);if(null===s)n&&bt(e,i);else{if(n){if(-1<pt.indexOf(e))return e=ft(s,e,t,r,i),void at.push(e);if(function(e,t,r,i,n){switch(t){case"focusin":return ot=mt(ot,e,t,r,i,n),!0;case"dragenter":return lt=mt(lt,e,t,r,i,n),!0;case"mouseover":return ct=mt(ct,e,t,r,i,n),!0;case"pointerover":var s=n.pointerId;return ut.set(s,mt(ut.get(s)||null,e,t,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,dt.set(s,mt(dt.get(s)||null,e,t,r,i,n)),!0}return!1}(s,e,t,r,i))return;bt(e,i)}Ei(e,t,i,null,r)}}}function Kt(e,t,r,i){var n=Te(i);if(null!==(n=Yi(n))){var s=Xe(n);if(null===s)n=null;else{var a=s.tag;if(13===a){if(null!==(n=Je(s)))return n;n=null}else if(3===a){if(s.stateNode.hydrate)return 3===s.tag?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return Ei(e,t,i,n,r),null}var er=null,tr=null,rr=null;function ir(){if(rr)return rr;var e,t,r=tr,i=r.length,n="value"in er?er.value:er.textContent,s=n.length;for(e=0;e<i&&r[e]===n[e];e++);var a=i-e;for(t=1;t<=a&&r[i-t]===n[s-t];t++);return rr=n.slice(e,1<t?1-t:void 0)}function nr(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function sr(){return!0}function ar(){return!1}function or(e){function t(t,r,i,n,s){for(var a in this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=n,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(n):n[a]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?sr:ar,this.isPropagationStopped=ar,this}return n(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=sr)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=sr)},persist:function(){},isPersistent:sr}),t}var lr,cr,ur,dr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hr=or(dr),pr=n({},dr,{view:0,detail:0}),fr=or(pr),br=n({},pr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tr,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ur&&(ur&&"mousemove"===e.type?(lr=e.screenX-ur.screenX,cr=e.screenY-ur.screenY):cr=lr=0,ur=e),lr)},movementY:function(e){return"movementY"in e?e.movementY:cr}}),mr=or(br),gr=or(n({},br,{dataTransfer:0})),yr=or(n({},pr,{relatedTarget:0})),vr=or(n({},dr,{animationName:0,elapsedTime:0,pseudoElement:0})),Or=or(n({},dr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),jr=or(n({},dr,{data:0})),_r={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=xr[e])&&!!t[e]}function Tr(){return Sr}var Cr=or(n({},pr,{key:function(e){if(e.key){var t=_r[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=nr(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wr[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tr,charCode:function(e){return"keypress"===e.type?nr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?nr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Mr=or(n({},br,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pr=or(n({},pr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tr})),Ar=or(n({},dr,{propertyName:0,elapsedTime:0,pseudoElement:0})),Er=or(n({},br,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Rr=[9,13,27,32],Ir=d&&"CompositionEvent"in window,Dr=null;d&&"documentMode"in document&&(Dr=document.documentMode);var Fr=d&&"TextEvent"in window&&!Dr,Lr=d&&(!Ir||Dr&&8<Dr&&11>=Dr),kr=String.fromCharCode(32),zr=!1;function Vr(e,t){switch(e){case"keyup":return-1!==Rr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nr(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Ur=!1;var Br={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Br[e.type]:"textarea"===t}function qr(e,t,r,i){Ee(i),0<(t=Ii(t,"onChange")).length&&(r=new hr("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var Hr=null,Wr=null;function $r(e){Si(e,0)}function Qr(e){if(J(en(e)))return e}function Zr(e,t){if("change"===e)return t}var Xr=!1;if(d){var Jr;if(d){var Yr="oninput"in document;if(!Yr){var Kr=document.createElement("div");Kr.setAttribute("oninput","return;"),Yr="function"===typeof Kr.oninput}Jr=Yr}else Jr=!1;Xr=Jr&&(!document.documentMode||9<document.documentMode)}function ei(){Hr&&(Hr.detachEvent("onpropertychange",ti),Wr=Hr=null)}function ti(e){if("value"===e.propertyName&&Qr(Wr)){var t=[];if(qr(t,Wr,e,Te(e)),e=$r,ke)e(t);else{ke=!0;try{Ie(e,t)}finally{ke=!1,Ve()}}}}function ri(e,t,r){"focusin"===e?(ei(),Wr=r,(Hr=t).attachEvent("onpropertychange",ti)):"focusout"===e&&ei()}function ii(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qr(Wr)}function ni(e,t){if("click"===e)return Qr(t)}function si(e,t){if("input"===e||"change"===e)return Qr(t)}var ai="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},oi=Object.prototype.hasOwnProperty;function li(e,t){if(ai(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++)if(!oi.call(t,r[i])||!ai(e[r[i]],t[r[i]]))return!1;return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var r,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var r="string"===typeof t.contentWindow.location.href}catch(i){r=!1}if(!r)break;t=Y((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var fi=d&&"documentMode"in document&&11>=document.documentMode,bi=null,mi=null,gi=null,yi=!1;function vi(e,t,r){var i=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;yi||null==bi||bi!==Y(i)||("selectionStart"in(i=bi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},gi&&li(gi,i)||(gi=i,0<(i=Ii(mi,"onSelect")).length&&(t=new hr("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=bi)))}Ft("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ft("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ft(Dt,2);for(var Oi="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),ji=0;ji<Oi.length;ji++)It.set(Oi[ji],0);u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _i="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wi=new Set("cancel close invalid load scroll toggle".split(" ").concat(_i));function xi(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,function(e,t,r,i,n,s,o,l,c){if(Ze.apply(this,arguments),qe){if(!qe)throw Error(a(198));var u=He;qe=!1,He=null,We||(We=!0,$e=u)}}(i,t,void 0,e),e.currentTarget=null}function Si(e,t){t=0!==(4&t);for(var r=0;r<e.length;r++){var i=e[r],n=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&n.isPropagationStopped())break e;xi(n,o,c),s=l}else for(a=0;a<i.length;a++){if(l=(o=i[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&n.isPropagationStopped())break e;xi(n,o,c),s=l}}}if(We)throw e=$e,We=!1,$e=null,e}function Ti(e,t){var r=rn(t),i=e+"__bubble";r.has(i)||(Ai(t,e,2,!1),r.add(i))}var Ci="_reactListening"+Math.random().toString(36).slice(2);function Mi(e){e[Ci]||(e[Ci]=!0,o.forEach((function(t){wi.has(t)||Pi(t,!1,e,null),Pi(t,!0,e,null)})))}function Pi(e,t,r,i){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,s=r;if("selectionchange"===e&&9!==r.nodeType&&(s=r.ownerDocument),null!==i&&!t&&wi.has(e)){if("scroll"!==e)return;n|=2,s=i}var a=rn(s),o=e+"__"+(t?"capture":"bubble");a.has(o)||(t&&(n|=4),Ai(s,e,n,t),a.add(o))}function Ai(e,t,r,i){var n=It.get(t);switch(void 0===n?2:n){case 0:n=Xt;break;case 1:n=Jt;break;default:n=Yt}r=n.bind(null,t,r,e),n=void 0,!Ue||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(n=!0),i?void 0!==n?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):void 0!==n?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function Ei(e,t,r,i,n){var s=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===n||8===o.nodeType&&o.parentNode===n)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===n||8===l.nodeType&&l.parentNode===n))return;a=a.return}for(;null!==o;){if(null===(a=Yi(o)))return;if(5===(l=a.tag)||6===l){i=s=a;continue e}o=o.parentNode}}i=i.return}!function(e,t,r){if(ze)return e(t,r);ze=!0;try{Le(e,t,r)}finally{ze=!1,Ve()}}((function(){var i=s,n=Te(r),a=[];e:{var o=Rt.get(e);if(void 0!==o){var l=hr,c=e;switch(e){case"keypress":if(0===nr(r))break e;case"keydown":case"keyup":l=Cr;break;case"focusin":c="focus",l=yr;break;case"focusout":c="blur",l=yr;break;case"beforeblur":case"afterblur":l=yr;break;case"click":if(2===r.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pr;break;case Mt:case Pt:case At:l=vr;break;case Et:l=Ar;break;case"scroll":l=fr;break;case"wheel":l=Er;break;case"copy":case"cut":case"paste":l=Or;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Mr}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==o?o+"Capture":null:o;u=[];for(var p,f=i;null!==f;){var b=(p=f).stateNode;if(5===p.tag&&null!==b&&(p=b,null!==h&&(null!=(b=Ne(f,h))&&u.push(Ri(f,b,p)))),d)break;f=f.return}0<u.length&&(o=new l(o,c,null,r,n),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(c=r.relatedTarget||r.fromElement)||!Yi(c)&&!c[Xi])&&(l||o)&&(o=n.window===n?n:(o=n.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(c=(c=r.relatedTarget||r.toElement)?Yi(c):null)&&(c!==(d=Xe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=mr,b="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Mr,b="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?o:en(l),p=null==c?o:en(c),(o=new u(b,f+"leave",l,r,n)).target=d,o.relatedTarget=p,b=null,Yi(n)===i&&((u=new u(h,f+"enter",c,r,n)).target=p,u.relatedTarget=d,b=u),d=b,l&&c)e:{for(h=c,f=0,p=u=l;p;p=Di(p))f++;for(p=0,b=h;b;b=Di(b))p++;for(;0<f-p;)u=Di(u),f--;for(;0<p-f;)h=Di(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Di(u),h=Di(h)}u=null}else u=null;null!==l&&Fi(a,o,l,u,!1),null!==c&&null!==d&&Fi(a,d,c,u,!0)}if("select"===(l=(o=i?en(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var m=Zr;else if(Gr(o))if(Xr)m=si;else{m=ii;var g=ri}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=ni);switch(m&&(m=m(e,i))?qr(a,m,r,n):(g&&g(e,o,i),"focusout"===e&&(g=o._wrapperState)&&g.controlled&&"number"===o.type&&ne(o,"number",o.value)),g=i?en(i):window,e){case"focusin":(Gr(g)||"true"===g.contentEditable)&&(bi=g,mi=i,gi=null);break;case"focusout":gi=mi=bi=null;break;case"mousedown":yi=!0;break;case"contextmenu":case"mouseup":case"dragend":yi=!1,vi(a,r,n);break;case"selectionchange":if(fi)break;case"keydown":case"keyup":vi(a,r,n)}var y;if(Ir)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Ur?Vr(e,r)&&(v="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(v="onCompositionStart");v&&(Lr&&"ko"!==r.locale&&(Ur||"onCompositionStart"!==v?"onCompositionEnd"===v&&Ur&&(y=ir()):(tr="value"in(er=n)?er.value:er.textContent,Ur=!0)),0<(g=Ii(i,v)).length&&(v=new jr(v,e,null,r,n),a.push({event:v,listeners:g}),y?v.data=y:null!==(y=Nr(r))&&(v.data=y))),(y=Fr?function(e,t){switch(e){case"compositionend":return Nr(t);case"keypress":return 32!==t.which?null:(zr=!0,kr);case"textInput":return(e=t.data)===kr&&zr?null:e;default:return null}}(e,r):function(e,t){if(Ur)return"compositionend"===e||!Ir&&Vr(e,t)?(e=ir(),rr=tr=er=null,Ur=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Lr&&"ko"!==t.locale?null:t.data;default:return null}}(e,r))&&(0<(i=Ii(i,"onBeforeInput")).length&&(n=new jr("onBeforeInput","beforeinput",null,r,n),a.push({event:n,listeners:i}),n.data=y))}Si(a,t)}))}function Ri(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Ii(e,t){for(var r=t+"Capture",i=[];null!==e;){var n=e,s=n.stateNode;5===n.tag&&null!==s&&(n=s,null!=(s=Ne(e,r))&&i.unshift(Ri(e,s,n)),null!=(s=Ne(e,t))&&i.push(Ri(e,s,n))),e=e.return}return i}function Di(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Fi(e,t,r,i,n){for(var s=t._reactName,a=[];null!==r&&r!==i;){var o=r,l=o.alternate,c=o.stateNode;if(null!==l&&l===i)break;5===o.tag&&null!==c&&(o=c,n?null!=(l=Ne(r,s))&&a.unshift(Ri(r,l,o)):n||null!=(l=Ne(r,s))&&a.push(Ri(r,l,o))),r=r.return}0!==a.length&&e.push({event:t,listeners:a})}function Li(){}var ki=null,zi=null;function Vi(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Ni(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Ui="function"===typeof setTimeout?setTimeout:void 0,Bi="function"===typeof clearTimeout?clearTimeout:void 0;function Gi(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function qi(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Hi(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r){if(0===t)return e;t--}else"/$"===r&&t++}e=e.previousSibling}return null}var Wi=0;var $i=Math.random().toString(36).slice(2),Qi="__reactFiber$"+$i,Zi="__reactProps$"+$i,Xi="__reactContainer$"+$i,Ji="__reactEvents$"+$i;function Yi(e){var t=e[Qi];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Xi]||r[Qi]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=Hi(e);null!==e;){if(r=e[Qi])return r;e=Hi(e)}return t}r=(e=r).parentNode}return null}function Ki(e){return!(e=e[Qi]||e[Xi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function en(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function tn(e){return e[Zi]||null}function rn(e){var t=e[Ji];return void 0===t&&(t=e[Ji]=new Set),t}var nn=[],sn=-1;function an(e){return{current:e}}function on(e){0>sn||(e.current=nn[sn],nn[sn]=null,sn--)}function ln(e,t){sn++,nn[sn]=e.current,e.current=t}var cn={},un=an(cn),dn=an(!1),hn=cn;function pn(e,t){var r=e.type.contextTypes;if(!r)return cn;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var n,s={};for(n in r)s[n]=t[n];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function fn(e){return null!==(e=e.childContextTypes)&&void 0!==e}function bn(){on(dn),on(un)}function mn(e,t,r){if(un.current!==cn)throw Error(a(168));ln(un,t),ln(dn,r)}function gn(e,t,r){var i=e.stateNode;if(e=t.childContextTypes,"function"!==typeof i.getChildContext)return r;for(var s in i=i.getChildContext())if(!(s in e))throw Error(a(108,$(t)||"Unknown",s));return n({},r,i)}function yn(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||cn,hn=un.current,ln(un,e),ln(dn,dn.current),!0}function vn(e,t,r){var i=e.stateNode;if(!i)throw Error(a(169));r?(e=gn(e,t,hn),i.__reactInternalMemoizedMergedChildContext=e,on(dn),on(un),ln(un,e)):on(dn),ln(dn,r)}var On=null,jn=null,_n=s.unstable_runWithPriority,wn=s.unstable_scheduleCallback,xn=s.unstable_cancelCallback,Sn=s.unstable_shouldYield,Tn=s.unstable_requestPaint,Cn=s.unstable_now,Mn=s.unstable_getCurrentPriorityLevel,Pn=s.unstable_ImmediatePriority,An=s.unstable_UserBlockingPriority,En=s.unstable_NormalPriority,Rn=s.unstable_LowPriority,In=s.unstable_IdlePriority,Dn={},Fn=void 0!==Tn?Tn:function(){},Ln=null,kn=null,zn=!1,Vn=Cn(),Nn=1e4>Vn?Cn:function(){return Cn()-Vn};function Un(){switch(Mn()){case Pn:return 99;case An:return 98;case En:return 97;case Rn:return 96;case In:return 95;default:throw Error(a(332))}}function Bn(e){switch(e){case 99:return Pn;case 98:return An;case 97:return En;case 96:return Rn;case 95:return In;default:throw Error(a(332))}}function Gn(e,t){return e=Bn(e),_n(e,t)}function qn(e,t,r){return e=Bn(e),wn(e,t,r)}function Hn(){if(null!==kn){var e=kn;kn=null,xn(e)}Wn()}function Wn(){if(!zn&&null!==Ln){zn=!0;var e=0;try{var t=Ln;Gn(99,(function(){for(;e<t.length;e++){var r=t[e];do{r=r(!0)}while(null!==r)}})),Ln=null}catch(r){throw null!==Ln&&(Ln=Ln.slice(e+1)),wn(Pn,Hn),r}finally{zn=!1}}}var $n=j.ReactCurrentBatchConfig;function Qn(e,t){if(e&&e.defaultProps){for(var r in t=n({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}return t}var Zn=an(null),Xn=null,Jn=null,Yn=null;function Kn(){Yn=Jn=Xn=null}function es(e){var t=Zn.current;on(Zn),e.type._context._currentValue=t}function ts(e,t){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)===t){if(null===r||(r.childLanes&t)===t)break;r.childLanes|=t}else e.childLanes|=t,null!==r&&(r.childLanes|=t);e=e.return}}function rs(e,t){Xn=e,Yn=Jn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ia=!0),e.firstContext=null)}function is(e,t){if(Yn!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(Yn=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Jn){if(null===Xn)throw Error(a(308));Jn=t,Xn.dependencies={lanes:0,firstContext:t,responders:null}}else Jn=Jn.next=t;return e._currentValue}var ns=!1;function ss(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function as(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function os(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ls(e,t){if(null!==(e=e.updateQueue)){var r=(e=e.shared).pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}}function cs(e,t){var r=e.updateQueue,i=e.alternate;if(null!==i&&r===(i=i.updateQueue)){var n=null,s=null;if(null!==(r=r.firstBaseUpdate)){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};null===s?n=s=a:s=s.next=a,r=r.next}while(null!==r);null===s?n=s=t:s=s.next=t}else n=s=t;return r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function us(e,t,r,i){var s=e.updateQueue;ns=!1;var a=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(null!==l){s.shared.pending=null;var c=l,u=c.next;c.next=null,null===o?a=u:o.next=u,o=c;var d=e.alternate;if(null!==d){var h=(d=d.updateQueue).lastBaseUpdate;h!==o&&(null===h?d.firstBaseUpdate=u:h.next=u,d.lastBaseUpdate=c)}}if(null!==a){for(h=s.baseState,o=0,d=u=c=null;;){l=a.lane;var p=a.eventTime;if((i&l)===l){null!==d&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,b=a;switch(l=t,p=r,b.tag){case 1:if("function"===typeof(f=b.payload)){h=f.call(p,h,l);break e}h=f;break e;case 3:f.flags=-4097&f.flags|64;case 0:if(null===(l="function"===typeof(f=b.payload)?f.call(p,h,l):f)||void 0===l)break e;h=n({},h,l);break e;case 2:ns=!0}}null!==a.callback&&(e.flags|=32,null===(l=s.effects)?s.effects=[a]:l.push(a))}else p={eventTime:p,lane:l,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===d?(u=d=p,c=h):d=d.next=p,o|=l;if(null===(a=a.next)){if(null===(l=s.shared.pending))break;a=l.next,l.next=null,s.lastBaseUpdate=l,s.shared.pending=null}}null===d&&(c=h),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=d,zo|=o,e.lanes=o,e.memoizedState=h}}function ds(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],n=i.callback;if(null!==n){if(i.callback=null,i=r,"function"!==typeof n)throw Error(a(191,n));n.call(i)}}}var hs=(new i.Component).refs;function ps(e,t,r,i){r=null===(r=r(i,t=e.memoizedState))||void 0===r?t:n({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}var fs={isMounted:function(e){return!!(e=e._reactInternals)&&Xe(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=cl(),n=ul(e),s=os(i,n);s.payload=t,void 0!==r&&null!==r&&(s.callback=r),ls(e,s),dl(e,n,i)},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=cl(),n=ul(e),s=os(i,n);s.tag=1,s.payload=t,void 0!==r&&null!==r&&(s.callback=r),ls(e,s),dl(e,n,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=cl(),i=ul(e),n=os(r,i);n.tag=2,void 0!==t&&null!==t&&(n.callback=t),ls(e,n),dl(e,i,r)}};function bs(e,t,r,i,n,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!li(r,i)||!li(n,s))}function ms(e,t,r){var i=!1,n=cn,s=t.contextType;return"object"===typeof s&&null!==s?s=is(s):(n=fn(t)?hn:un.current,s=(i=null!==(i=t.contextTypes)&&void 0!==i)?pn(e,n):cn),t=new t(r,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=fs,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function gs(e,t,r,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&fs.enqueueReplaceState(t,t.state,null)}function ys(e,t,r,i){var n=e.stateNode;n.props=r,n.state=e.memoizedState,n.refs=hs,ss(e);var s=t.contextType;"object"===typeof s&&null!==s?n.context=is(s):(s=fn(t)?hn:un.current,n.context=pn(e,s)),us(e,r,n,i),n.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(ps(e,t,s,r),n.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof n.getSnapshotBeforeUpdate||"function"!==typeof n.UNSAFE_componentWillMount&&"function"!==typeof n.componentWillMount||(t=n.state,"function"===typeof n.componentWillMount&&n.componentWillMount(),"function"===typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount(),t!==n.state&&fs.enqueueReplaceState(n,n.state,null),us(e,r,n,i),n.state=e.memoizedState),"function"===typeof n.componentDidMount&&(e.flags|=4)}var vs=Array.isArray;function Os(e,t,r){if(null!==(e=r.ref)&&"function"!==typeof e&&"object"!==typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(a(309));var i=r.stateNode}if(!i)throw Error(a(147,e));var n=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===n?t.ref:((t=function(e){var t=i.refs;t===hs&&(t=i.refs={}),null===e?delete t[n]:t[n]=e})._stringRef=n,t)}if("string"!==typeof e)throw Error(a(284));if(!r._owner)throw Error(a(290,e))}return e}function js(e,t){if("textarea"!==e.type)throw Error(a(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function _s(e){function t(t,r){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=r,t.lastEffect=r):t.firstEffect=t.lastEffect=r,r.nextEffect=null,r.flags=8}}function r(r,i){if(!e)return null;for(;null!==i;)t(r,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function n(e,t){return(e=Gl(e,t)).index=0,e.sibling=null,e}function s(t,r,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<r?(t.flags=2,r):i:(t.flags=2,r):r}function o(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,r,i){return null===t||6!==t.tag?((t=$l(r,e.mode,i)).return=e,t):((t=n(t,r)).return=e,t)}function c(e,t,r,i){return null!==t&&t.elementType===r.type?((i=n(t,r.props)).ref=Os(e,t,r),i.return=e,i):((i=ql(r.type,r.key,r.props,null,e.mode,i)).ref=Os(e,t,r),i.return=e,i)}function u(e,t,r,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Ql(r,e.mode,i)).return=e,t):((t=n(t,r.children||[])).return=e,t)}function d(e,t,r,i,s){return null===t||7!==t.tag?((t=Hl(r,e.mode,i,s)).return=e,t):((t=n(t,r)).return=e,t)}function h(e,t,r){if("string"===typeof t||"number"===typeof t)return(t=$l(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case _:return(r=ql(t.type,t.key,t.props,null,e.mode,r)).ref=Os(e,null,t),r.return=e,r;case w:return(t=Ql(t,e.mode,r)).return=e,t}if(vs(t)||B(t))return(t=Hl(t,e.mode,r,null)).return=e,t;js(e,t)}return null}function p(e,t,r,i){var n=null!==t?t.key:null;if("string"===typeof r||"number"===typeof r)return null!==n?null:l(e,t,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case _:return r.key===n?r.type===x?d(e,t,r.props.children,i,n):c(e,t,r,i):null;case w:return r.key===n?u(e,t,r,i):null}if(vs(r)||B(r))return null!==n?null:d(e,t,r,i,null);js(e,r)}return null}function f(e,t,r,i,n){if("string"===typeof i||"number"===typeof i)return l(t,e=e.get(r)||null,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case _:return e=e.get(null===i.key?r:i.key)||null,i.type===x?d(t,e,i.props.children,n,i.key):c(t,e,i,n);case w:return u(t,e=e.get(null===i.key?r:i.key)||null,i,n)}if(vs(i)||B(i))return d(t,e=e.get(r)||null,i,n,null);js(t,i)}return null}function b(n,a,o,l){for(var c=null,u=null,d=a,b=a=0,m=null;null!==d&&b<o.length;b++){d.index>b?(m=d,d=null):m=d.sibling;var g=p(n,d,o[b],l);if(null===g){null===d&&(d=m);break}e&&d&&null===g.alternate&&t(n,d),a=s(g,a,b),null===u?c=g:u.sibling=g,u=g,d=m}if(b===o.length)return r(n,d),c;if(null===d){for(;b<o.length;b++)null!==(d=h(n,o[b],l))&&(a=s(d,a,b),null===u?c=d:u.sibling=d,u=d);return c}for(d=i(n,d);b<o.length;b++)null!==(m=f(d,n,b,o[b],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?b:m.key),a=s(m,a,b),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach((function(e){return t(n,e)})),c}function m(n,o,l,c){var u=B(l);if("function"!==typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var d=u=null,b=o,m=o=0,g=null,y=l.next();null!==b&&!y.done;m++,y=l.next()){b.index>m?(g=b,b=null):g=b.sibling;var v=p(n,b,y.value,c);if(null===v){null===b&&(b=g);break}e&&b&&null===v.alternate&&t(n,b),o=s(v,o,m),null===d?u=v:d.sibling=v,d=v,b=g}if(y.done)return r(n,b),u;if(null===b){for(;!y.done;m++,y=l.next())null!==(y=h(n,y.value,c))&&(o=s(y,o,m),null===d?u=y:d.sibling=y,d=y);return u}for(b=i(n,b);!y.done;m++,y=l.next())null!==(y=f(b,n,m,y.value,c))&&(e&&null!==y.alternate&&b.delete(null===y.key?m:y.key),o=s(y,o,m),null===d?u=y:d.sibling=y,d=y);return e&&b.forEach((function(e){return t(n,e)})),u}return function(e,i,s,l){var c="object"===typeof s&&null!==s&&s.type===x&&null===s.key;c&&(s=s.props.children);var u="object"===typeof s&&null!==s;if(u)switch(s.$$typeof){case _:e:{for(u=s.key,c=i;null!==c;){if(c.key===u){switch(c.tag){case 7:if(s.type===x){r(e,c.sibling),(i=n(c,s.props.children)).return=e,e=i;break e}break;default:if(c.elementType===s.type){r(e,c.sibling),(i=n(c,s.props)).ref=Os(e,c,s),i.return=e,e=i;break e}}r(e,c);break}t(e,c),c=c.sibling}s.type===x?((i=Hl(s.props.children,e.mode,l,s.key)).return=e,e=i):((l=ql(s.type,s.key,s.props,null,e.mode,l)).ref=Os(e,i,s),l.return=e,e=l)}return o(e);case w:e:{for(c=s.key;null!==i;){if(i.key===c){if(4===i.tag&&i.stateNode.containerInfo===s.containerInfo&&i.stateNode.implementation===s.implementation){r(e,i.sibling),(i=n(i,s.children||[])).return=e,e=i;break e}r(e,i);break}t(e,i),i=i.sibling}(i=Ql(s,e.mode,l)).return=e,e=i}return o(e)}if("string"===typeof s||"number"===typeof s)return s=""+s,null!==i&&6===i.tag?(r(e,i.sibling),(i=n(i,s)).return=e,e=i):(r(e,i),(i=$l(s,e.mode,l)).return=e,e=i),o(e);if(vs(s))return b(e,i,s,l);if(B(s))return m(e,i,s,l);if(u&&js(e,s),"undefined"===typeof s&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(a(152,$(e.type)||"Component"))}return r(e,i)}}var ws=_s(!0),xs=_s(!1),Ss={},Ts=an(Ss),Cs=an(Ss),Ms=an(Ss);function Ps(e){if(e===Ss)throw Error(a(174));return e}function As(e,t){switch(ln(Ms,t),ln(Cs,e),ln(Ts,Ss),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fe(null,"");break;default:t=fe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}on(Ts),ln(Ts,t)}function Es(){on(Ts),on(Cs),on(Ms)}function Rs(e){Ps(Ms.current);var t=Ps(Ts.current),r=fe(t,e.type);t!==r&&(ln(Cs,e),ln(Ts,r))}function Is(e){Cs.current===e&&(on(Ts),on(Cs))}var Ds=an(0);function Fs(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||"$?"===r.data||"$!"===r.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ls=null,ks=null,zs=!1;function Vs(e,t){var r=Ul(5,null,null,0);r.elementType="DELETED",r.type="DELETED",r.stateNode=t,r.return=e,r.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=r,e.lastEffect=r):e.firstEffect=e.lastEffect=r}function Ns(e,t){switch(e.tag){case 5:var r=e.type;return null!==(t=1!==t.nodeType||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Us(e){if(zs){var t=ks;if(t){var r=t;if(!Ns(e,t)){if(!(t=qi(r.nextSibling))||!Ns(e,t))return e.flags=-1025&e.flags|2,zs=!1,void(Ls=e);Vs(Ls,r)}Ls=e,ks=qi(t.firstChild)}else e.flags=-1025&e.flags|2,zs=!1,Ls=e}}function Bs(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Ls=e}function Gs(e){if(e!==Ls)return!1;if(!zs)return Bs(e),zs=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Ni(t,e.memoizedProps))for(t=ks;t;)Vs(e,t),t=qi(t.nextSibling);if(Bs(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var r=e.data;if("/$"===r){if(0===t){ks=qi(e.nextSibling);break e}t--}else"$"!==r&&"$!"!==r&&"$?"!==r||t++}e=e.nextSibling}ks=null}}else ks=Ls?qi(e.stateNode.nextSibling):null;return!0}function qs(){ks=Ls=null,zs=!1}var Hs=[];function Ws(){for(var e=0;e<Hs.length;e++)Hs[e]._workInProgressVersionPrimary=null;Hs.length=0}var $s=j.ReactCurrentDispatcher,Qs=j.ReactCurrentBatchConfig,Zs=0,Xs=null,Js=null,Ys=null,Ks=!1,ea=!1;function ta(){throw Error(a(321))}function ra(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!ai(e[r],t[r]))return!1;return!0}function ia(e,t,r,i,n,s){if(Zs=s,Xs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,$s.current=null===e||null===e.memoizedState?Pa:Aa,e=r(i,n),ea){s=0;do{if(ea=!1,!(25>s))throw Error(a(301));s+=1,Ys=Js=null,t.updateQueue=null,$s.current=Ea,e=r(i,n)}while(ea)}if($s.current=Ma,t=null!==Js&&null!==Js.next,Zs=0,Ys=Js=Xs=null,Ks=!1,t)throw Error(a(300));return e}function na(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ys?Xs.memoizedState=Ys=e:Ys=Ys.next=e,Ys}function sa(){if(null===Js){var e=Xs.alternate;e=null!==e?e.memoizedState:null}else e=Js.next;var t=null===Ys?Xs.memoizedState:Ys.next;if(null!==t)Ys=t,Js=e;else{if(null===e)throw Error(a(310));e={memoizedState:(Js=e).memoizedState,baseState:Js.baseState,baseQueue:Js.baseQueue,queue:Js.queue,next:null},null===Ys?Xs.memoizedState=Ys=e:Ys=Ys.next=e}return Ys}function aa(e,t){return"function"===typeof t?t(e):t}function oa(e){var t=sa(),r=t.queue;if(null===r)throw Error(a(311));r.lastRenderedReducer=e;var i=Js,n=i.baseQueue,s=r.pending;if(null!==s){if(null!==n){var o=n.next;n.next=s.next,s.next=o}i.baseQueue=n=s,r.pending=null}if(null!==n){n=n.next,i=i.baseState;var l=o=s=null,c=n;do{var u=c.lane;if((Zs&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),i=c.eagerReducer===e?c.eagerState:e(i,c.action);else{var d={lane:u,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(o=l=d,s=i):l=l.next=d,Xs.lanes|=u,zo|=u}c=c.next}while(null!==c&&c!==n);null===l?s=i:l.next=o,ai(i,t.memoizedState)||(Ia=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,r.lastRenderedState=i}return[t.memoizedState,r.dispatch]}function la(e){var t=sa(),r=t.queue;if(null===r)throw Error(a(311));r.lastRenderedReducer=e;var i=r.dispatch,n=r.pending,s=t.memoizedState;if(null!==n){r.pending=null;var o=n=n.next;do{s=e(s,o.action),o=o.next}while(o!==n);ai(s,t.memoizedState)||(Ia=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),r.lastRenderedState=s}return[s,i]}function ca(e,t,r){var i=t._getVersion;i=i(t._source);var n=t._workInProgressVersionPrimary;if(null!==n?e=n===i:(e=e.mutableReadLanes,(e=(Zs&e)===e)&&(t._workInProgressVersionPrimary=i,Hs.push(t))),e)return r(t._source);throw Hs.push(t),Error(a(350))}function ua(e,t,r,i){var n=Ao;if(null===n)throw Error(a(349));var s=t._getVersion,o=s(t._source),l=$s.current,c=l.useState((function(){return ca(n,t,r)})),u=c[1],d=c[0];c=Ys;var h=e.memoizedState,p=h.refs,f=p.getSnapshot,b=h.source;h=h.subscribe;var m=Xs;return e.memoizedState={refs:p,source:t,subscribe:i},l.useEffect((function(){p.getSnapshot=r,p.setSnapshot=u;var e=s(t._source);if(!ai(o,e)){e=r(t._source),ai(d,e)||(u(e),e=ul(m),n.mutableReadLanes|=e&n.pendingLanes),e=n.mutableReadLanes,n.entangledLanes|=e;for(var i=n.entanglements,a=e;0<a;){var l=31-qt(a),c=1<<l;i[l]|=e,a&=~c}}}),[r,t,i]),l.useEffect((function(){return i(t._source,(function(){var e=p.getSnapshot,r=p.setSnapshot;try{r(e(t._source));var i=ul(m);n.mutableReadLanes|=i&n.pendingLanes}catch(s){r((function(){throw s}))}}))}),[t,i]),ai(f,r)&&ai(b,t)&&ai(h,i)||((e={pending:null,dispatch:null,lastRenderedReducer:aa,lastRenderedState:d}).dispatch=u=Ca.bind(null,Xs,e),c.queue=e,c.baseQueue=null,d=ca(n,t,r),c.memoizedState=c.baseState=d),d}function da(e,t,r){return ua(sa(),e,t,r)}function ha(e){var t=na();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:aa,lastRenderedState:e}).dispatch=Ca.bind(null,Xs,e),[t.memoizedState,e]}function pa(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},null===(t=Xs.updateQueue)?(t={lastEffect:null},Xs.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e),e}function fa(e){return e={current:e},na().memoizedState=e}function ba(){return sa().memoizedState}function ma(e,t,r,i){var n=na();Xs.flags|=e,n.memoizedState=pa(1|t,r,void 0,void 0===i?null:i)}function ga(e,t,r,i){var n=sa();i=void 0===i?null:i;var s=void 0;if(null!==Js){var a=Js.memoizedState;if(s=a.destroy,null!==i&&ra(i,a.deps))return void pa(t,r,s,i)}Xs.flags|=e,n.memoizedState=pa(1|t,r,s,i)}function ya(e,t){return ma(516,4,e,t)}function va(e,t){return ga(516,4,e,t)}function Oa(e,t){return ga(4,2,e,t)}function ja(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function _a(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,ga(4,2,ja.bind(null,t,e),r)}function wa(){}function xa(e,t){var r=sa();t=void 0===t?null:t;var i=r.memoizedState;return null!==i&&null!==t&&ra(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function Sa(e,t){var r=sa();t=void 0===t?null:t;var i=r.memoizedState;return null!==i&&null!==t&&ra(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function Ta(e,t){var r=Un();Gn(98>r?98:r,(function(){e(!0)})),Gn(97<r?97:r,(function(){var r=Qs.transition;Qs.transition=1;try{e(!1),t()}finally{Qs.transition=r}}))}function Ca(e,t,r){var i=cl(),n=ul(e),s={lane:n,action:r,eagerReducer:null,eagerState:null,next:null},a=t.pending;if(null===a?s.next=s:(s.next=a.next,a.next=s),t.pending=s,a=e.alternate,e===Xs||null!==a&&a===Xs)ea=Ks=!0;else{if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,l=a(o,r);if(s.eagerReducer=a,s.eagerState=l,ai(l,o))return}catch(c){}dl(e,n,i)}}var Ma={readContext:is,useCallback:ta,useContext:ta,useEffect:ta,useImperativeHandle:ta,useLayoutEffect:ta,useMemo:ta,useReducer:ta,useRef:ta,useState:ta,useDebugValue:ta,useDeferredValue:ta,useTransition:ta,useMutableSource:ta,useOpaqueIdentifier:ta,unstable_isNewReconciler:!1},Pa={readContext:is,useCallback:function(e,t){return na().memoizedState=[e,void 0===t?null:t],e},useContext:is,useEffect:ya,useImperativeHandle:function(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,ma(4,2,ja.bind(null,t,e),r)},useLayoutEffect:function(e,t){return ma(4,2,e,t)},useMemo:function(e,t){var r=na();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=na();return t=void 0!==r?r(t):t,i.memoizedState=i.baseState=t,e=(e=i.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ca.bind(null,Xs,e),[i.memoizedState,e]},useRef:fa,useState:ha,useDebugValue:wa,useDeferredValue:function(e){var t=ha(e),r=t[0],i=t[1];return ya((function(){var t=Qs.transition;Qs.transition=1;try{i(e)}finally{Qs.transition=t}}),[e]),r},useTransition:function(){var e=ha(!1),t=e[0];return fa(e=Ta.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,r){var i=na();return i.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:r},ua(i,e,t,r)},useOpaqueIdentifier:function(){if(zs){var e=!1,t=function(e){return{$$typeof:F,toString:e,valueOf:e}}((function(){throw e||(e=!0,r("r:"+(Wi++).toString(36))),Error(a(355))})),r=ha(t)[1];return 0===(2&Xs.mode)&&(Xs.flags|=516,pa(5,(function(){r("r:"+(Wi++).toString(36))}),void 0,null)),t}return ha(t="r:"+(Wi++).toString(36)),t},unstable_isNewReconciler:!1},Aa={readContext:is,useCallback:xa,useContext:is,useEffect:va,useImperativeHandle:_a,useLayoutEffect:Oa,useMemo:Sa,useReducer:oa,useRef:ba,useState:function(){return oa(aa)},useDebugValue:wa,useDeferredValue:function(e){var t=oa(aa),r=t[0],i=t[1];return va((function(){var t=Qs.transition;Qs.transition=1;try{i(e)}finally{Qs.transition=t}}),[e]),r},useTransition:function(){var e=oa(aa)[0];return[ba().current,e]},useMutableSource:da,useOpaqueIdentifier:function(){return oa(aa)[0]},unstable_isNewReconciler:!1},Ea={readContext:is,useCallback:xa,useContext:is,useEffect:va,useImperativeHandle:_a,useLayoutEffect:Oa,useMemo:Sa,useReducer:la,useRef:ba,useState:function(){return la(aa)},useDebugValue:wa,useDeferredValue:function(e){var t=la(aa),r=t[0],i=t[1];return va((function(){var t=Qs.transition;Qs.transition=1;try{i(e)}finally{Qs.transition=t}}),[e]),r},useTransition:function(){var e=la(aa)[0];return[ba().current,e]},useMutableSource:da,useOpaqueIdentifier:function(){return la(aa)[0]},unstable_isNewReconciler:!1},Ra=j.ReactCurrentOwner,Ia=!1;function Da(e,t,r,i){t.child=null===e?xs(t,null,r,i):ws(t,e.child,r,i)}function Fa(e,t,r,i,n){r=r.render;var s=t.ref;return rs(t,n),i=ia(e,t,r,i,s,n),null===e||Ia?(t.flags|=1,Da(e,t,i,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~n,to(e,t,n))}function La(e,t,r,i,n,s){if(null===e){var a=r.type;return"function"!==typeof a||Bl(a)||void 0!==a.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=ql(r.type,null,i,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,ka(e,t,a,i,n,s))}return a=e.child,0===(n&s)&&(n=a.memoizedProps,(r=null!==(r=r.compare)?r:li)(n,i)&&e.ref===t.ref)?to(e,t,s):(t.flags|=1,(e=Gl(a,i)).ref=t.ref,e.return=t,t.child=e)}function ka(e,t,r,i,n,s){if(null!==e&&li(e.memoizedProps,i)&&e.ref===t.ref){if(Ia=!1,0===(s&n))return t.lanes=e.lanes,to(e,t,s);0!==(16384&e.flags)&&(Ia=!0)}return Na(e,t,r,i,s)}function za(e,t,r){var i=t.pendingProps,n=i.children,s=null!==e?e.memoizedState:null;if("hidden"===i.mode||"unstable-defer-without-hiding"===i.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},vl(t,r);else{if(0===(1073741824&r))return e=null!==s?s.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},vl(t,e),null;t.memoizedState={baseLanes:0},vl(t,null!==s?s.baseLanes:r)}else null!==s?(i=s.baseLanes|r,t.memoizedState=null):i=r,vl(t,i);return Da(e,t,n,r),t.child}function Va(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.flags|=128)}function Na(e,t,r,i,n){var s=fn(r)?hn:un.current;return s=pn(t,s),rs(t,n),r=ia(e,t,r,i,s,n),null===e||Ia?(t.flags|=1,Da(e,t,r,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~n,to(e,t,n))}function Ua(e,t,r,i,n){if(fn(r)){var s=!0;yn(t)}else s=!1;if(rs(t,n),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),ms(t,r,i),ys(t,r,i,n),i=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=r.contextType;"object"===typeof c&&null!==c?c=is(c):c=pn(t,c=fn(r)?hn:un.current);var u=r.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==i||l!==c)&&gs(t,a,i,c),ns=!1;var h=t.memoizedState;a.state=h,us(t,i,a,n),l=t.memoizedState,o!==i||h!==l||dn.current||ns?("function"===typeof u&&(ps(t,r,u,i),l=t.memoizedState),(o=ns||bs(t,r,o,i,h,l,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4)):("function"===typeof a.componentDidMount&&(t.flags|=4),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):("function"===typeof a.componentDidMount&&(t.flags|=4),i=!1)}else{a=t.stateNode,as(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:Qn(t.type,o),a.props=c,d=t.pendingProps,h=a.context,"object"===typeof(l=r.contextType)&&null!==l?l=is(l):l=pn(t,l=fn(r)?hn:un.current);var p=r.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==d||h!==l)&&gs(t,a,i,l),ns=!1,h=t.memoizedState,a.state=h,us(t,i,a,n);var f=t.memoizedState;o!==d||h!==f||dn.current||ns?("function"===typeof p&&(ps(t,r,p,i),f=t.memoizedState),(c=ns||bs(t,r,c,i,h,f,l))?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,f,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),t.memoizedProps=i,t.memoizedState=f),a.props=i,a.state=f,a.context=l,i=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),i=!1)}return Ba(e,t,r,i,s,n)}function Ba(e,t,r,i,n,s){Va(e,t);var a=0!==(64&t.flags);if(!i&&!a)return n&&vn(t,r,!1),to(e,t,s);i=t.stateNode,Ra.current=t;var o=a&&"function"!==typeof r.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=ws(t,e.child,null,s),t.child=ws(t,null,o,s)):Da(e,t,o,s),t.memoizedState=i.state,n&&vn(t,r,!0),t.child}function Ga(e){var t=e.stateNode;t.pendingContext?mn(0,t.pendingContext,t.pendingContext!==t.context):t.context&&mn(0,t.context,!1),As(e,t.containerInfo)}var qa,Ha,Wa,$a={dehydrated:null,retryLane:0};function Qa(e,t,r){var i,n=t.pendingProps,s=Ds.current,a=!1;return(i=0!==(64&t.flags))||(i=(null===e||null!==e.memoizedState)&&0!==(2&s)),i?(a=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===n.fallback||!0===n.unstable_avoidThisFallback||(s|=1),ln(Ds,1&s),null===e?(void 0!==n.fallback&&Us(t),e=n.children,s=n.fallback,a?(e=Za(t,e,s,r),t.child.memoizedState={baseLanes:r},t.memoizedState=$a,e):"number"===typeof n.unstable_expectedLoadTime?(e=Za(t,e,s,r),t.child.memoizedState={baseLanes:r},t.memoizedState=$a,t.lanes=33554432,e):((r=Wl({mode:"visible",children:e},t.mode,r,null)).return=t,t.child=r)):(e.memoizedState,a?(n=Ja(e,t,n.children,n.fallback,r),a=t.child,s=e.child.memoizedState,a.memoizedState=null===s?{baseLanes:r}:{baseLanes:s.baseLanes|r},a.childLanes=e.childLanes&~r,t.memoizedState=$a,n):(r=Xa(e,t,n.children,r),t.memoizedState=null,r))}function Za(e,t,r,i){var n=e.mode,s=e.child;return t={mode:"hidden",children:t},0===(2&n)&&null!==s?(s.childLanes=0,s.pendingProps=t):s=Wl(t,n,0,null),r=Hl(r,n,i,null),s.return=e,r.return=e,s.sibling=r,e.child=s,r}function Xa(e,t,r,i){var n=e.child;return e=n.sibling,r=Gl(n,{mode:"visible",children:r}),0===(2&t.mode)&&(r.lanes=i),r.return=t,r.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=r}function Ja(e,t,r,i,n){var s=t.mode,a=e.child;e=a.sibling;var o={mode:"hidden",children:r};return 0===(2&s)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=o,null!==(a=r.lastEffect)?(t.firstEffect=r.firstEffect,t.lastEffect=a,a.nextEffect=null):t.firstEffect=t.lastEffect=null):r=Gl(a,o),null!==e?i=Gl(e,i):(i=Hl(i,s,n,null)).flags|=2,i.return=t,r.return=t,r.sibling=i,t.child=r,i}function Ya(e,t){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),ts(e.return,t)}function Ka(e,t,r,i,n,s){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n,lastEffect:s}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=r,a.tailMode=n,a.lastEffect=s)}function eo(e,t,r){var i=t.pendingProps,n=i.revealOrder,s=i.tail;if(Da(e,t,i.children,r),0!==(2&(i=Ds.current)))i=1&i|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ya(e,r);else if(19===e.tag)Ya(e,r);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(ln(Ds,i),0===(2&t.mode))t.memoizedState=null;else switch(n){case"forwards":for(r=t.child,n=null;null!==r;)null!==(e=r.alternate)&&null===Fs(e)&&(n=r),r=r.sibling;null===(r=n)?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),Ka(t,!1,n,r,s,t.lastEffect);break;case"backwards":for(r=null,n=t.child,t.child=null;null!==n;){if(null!==(e=n.alternate)&&null===Fs(e)){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}Ka(t,!0,r,null,s,t.lastEffect);break;case"together":Ka(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function to(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),zo|=t.lanes,0!==(r&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(r=Gl(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Gl(e,e.pendingProps)).return=t;r.sibling=null}return t.child}return null}function ro(e,t){if(!zs)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;null!==r;)null!==r.alternate&&(i=r),r=r.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function io(e,t,r){var i=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return fn(t.type)&&bn(),null;case 3:return Es(),on(dn),on(un),Ws(),(i=t.stateNode).pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(Gs(t)?t.flags|=4:i.hydrate||(t.flags|=256)),null;case 5:Is(t);var s=Ps(Ms.current);if(r=t.type,null!==e&&null!=t.stateNode)Ha(e,t,r,i),e.ref!==t.ref&&(t.flags|=128);else{if(!i){if(null===t.stateNode)throw Error(a(166));return null}if(e=Ps(Ts.current),Gs(t)){i=t.stateNode,r=t.type;var o=t.memoizedProps;switch(i[Qi]=t,i[Zi]=o,r){case"dialog":Ti("cancel",i),Ti("close",i);break;case"iframe":case"object":case"embed":Ti("load",i);break;case"video":case"audio":for(e=0;e<_i.length;e++)Ti(_i[e],i);break;case"source":Ti("error",i);break;case"img":case"image":case"link":Ti("error",i),Ti("load",i);break;case"details":Ti("toggle",i);break;case"input":ee(i,o),Ti("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Ti("invalid",i);break;case"textarea":le(i,o),Ti("invalid",i)}for(var c in xe(r,o),e=null,o)o.hasOwnProperty(c)&&(s=o[c],"children"===c?"string"===typeof s?i.textContent!==s&&(e=["children",s]):"number"===typeof s&&i.textContent!==""+s&&(e=["children",""+s]):l.hasOwnProperty(c)&&null!=s&&"onScroll"===c&&Ti("scroll",i));switch(r){case"input":X(i),ie(i,o,!0);break;case"textarea":X(i),ue(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=Li)}i=e,t.updateQueue=i,null!==i&&(t.flags|=4)}else{switch(c=9===s.nodeType?s:s.ownerDocument,e===de&&(e=pe(r)),e===de?"script"===r?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=c.createElement(r,{is:i.is}):(e=c.createElement(r),"select"===r&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,r),e[Qi]=t,e[Zi]=i,qa(e,t),t.stateNode=e,c=Se(r,i),r){case"dialog":Ti("cancel",e),Ti("close",e),s=i;break;case"iframe":case"object":case"embed":Ti("load",e),s=i;break;case"video":case"audio":for(s=0;s<_i.length;s++)Ti(_i[s],e);s=i;break;case"source":Ti("error",e),s=i;break;case"img":case"image":case"link":Ti("error",e),Ti("load",e),s=i;break;case"details":Ti("toggle",e),s=i;break;case"input":ee(e,i),s=K(e,i),Ti("invalid",e);break;case"option":s=se(e,i);break;case"select":e._wrapperState={wasMultiple:!!i.multiple},s=n({},i,{value:void 0}),Ti("invalid",e);break;case"textarea":le(e,i),s=oe(e,i),Ti("invalid",e);break;default:s=i}xe(r,s);var u=s;for(o in u)if(u.hasOwnProperty(o)){var d=u[o];"style"===o?_e(e,d):"dangerouslySetInnerHTML"===o?null!=(d=d?d.__html:void 0)&&ge(e,d):"children"===o?"string"===typeof d?("textarea"!==r||""!==d)&&ye(e,d):"number"===typeof d&&ye(e,""+d):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(l.hasOwnProperty(o)?null!=d&&"onScroll"===o&&Ti("scroll",e):null!=d&&O(e,o,d,c))}switch(r){case"input":X(e),ie(e,i,!1);break;case"textarea":X(e),ue(e);break;case"option":null!=i.value&&e.setAttribute("value",""+Q(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?ae(e,!!i.multiple,o,!1):null!=i.defaultValue&&ae(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=Li)}Vi(r,i)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Wa(0,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));r=Ps(Ms.current),Ps(Ts.current),Gs(t)?(i=t.stateNode,r=t.memoizedProps,i[Qi]=t,i.nodeValue!==r&&(t.flags|=4)):((i=(9===r.nodeType?r:r.ownerDocument).createTextNode(i))[Qi]=t,t.stateNode=i)}return null;case 13:return on(Ds),i=t.memoizedState,0!==(64&t.flags)?(t.lanes=r,t):(i=null!==i,r=!1,null===e?void 0!==t.memoizedProps.fallback&&Gs(t):r=null!==e.memoizedState,i&&!r&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Ds.current)?0===Fo&&(Fo=3):(0!==Fo&&3!==Fo||(Fo=4),null===Ao||0===(134217727&zo)&&0===(134217727&Vo)||bl(Ao,Ro))),(i||r)&&(t.flags|=4),null);case 4:return Es(),null===e&&Mi(t.stateNode.containerInfo),null;case 10:return es(t),null;case 17:return fn(t.type)&&bn(),null;case 19:if(on(Ds),null===(i=t.memoizedState))return null;if(o=0!==(64&t.flags),null===(c=i.rendering))if(o)ro(i,!1);else{if(0!==Fo||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=Fs(e))){for(t.flags|=64,ro(i,!1),null!==(o=c.updateQueue)&&(t.updateQueue=o,t.flags|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,i=r,r=t.child;null!==r;)e=i,(o=r).flags&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return ln(Ds,1&Ds.current|2),t.child}e=e.sibling}null!==i.tail&&Nn()>Go&&(t.flags|=64,o=!0,ro(i,!1),t.lanes=33554432)}else{if(!o)if(null!==(e=Fs(c))){if(t.flags|=64,o=!0,null!==(r=e.updateQueue)&&(t.updateQueue=r,t.flags|=4),ro(i,!0),null===i.tail&&"hidden"===i.tailMode&&!c.alternate&&!zs)return null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null),null}else 2*Nn()-i.renderingStartTime>Go&&1073741824!==r&&(t.flags|=64,o=!0,ro(i,!1),t.lanes=33554432);i.isBackwards?(c.sibling=t.child,t.child=c):(null!==(r=i.last)?r.sibling=c:t.child=c,i.last=c)}return null!==i.tail?(r=i.tail,i.rendering=r,i.tail=r.sibling,i.lastEffect=t.lastEffect,i.renderingStartTime=Nn(),r.sibling=null,t=Ds.current,ln(Ds,o?1&t|2:1&t),r):null;case 23:case 24:return Ol(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==i.mode&&(t.flags|=4),null}throw Error(a(156,t.tag))}function no(e){switch(e.tag){case 1:fn(e.type)&&bn();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Es(),on(dn),on(un),Ws(),0!==(64&(t=e.flags)))throw Error(a(285));return e.flags=-4097&t|64,e;case 5:return Is(e),null;case 13:return on(Ds),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return on(Ds),null;case 4:return Es(),null;case 10:return es(e),null;case 23:case 24:return Ol(),null;default:return null}}function so(e,t){try{var r="",i=t;do{r+=W(i),i=i.return}while(i);var n=r}catch(s){n="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:n}}function ao(e,t){try{console.error(t.value)}catch(r){setTimeout((function(){throw r}))}}qa=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},Ha=function(e,t,r,i){var s=e.memoizedProps;if(s!==i){e=t.stateNode,Ps(Ts.current);var a,o=null;switch(r){case"input":s=K(e,s),i=K(e,i),o=[];break;case"option":s=se(e,s),i=se(e,i),o=[];break;case"select":s=n({},s,{value:void 0}),i=n({},i,{value:void 0}),o=[];break;case"textarea":s=oe(e,s),i=oe(e,i),o=[];break;default:"function"!==typeof s.onClick&&"function"===typeof i.onClick&&(e.onclick=Li)}for(d in xe(r,i),r=null,s)if(!i.hasOwnProperty(d)&&s.hasOwnProperty(d)&&null!=s[d])if("style"===d){var c=s[d];for(a in c)c.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(l.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in i){var u=i[d];if(c=null!=s?s[d]:void 0,i.hasOwnProperty(d)&&u!==c&&(null!=u||null!=c))if("style"===d)if(c){for(a in c)!c.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in u)u.hasOwnProperty(a)&&c[a]!==u[a]&&(r||(r={}),r[a]=u[a])}else r||(o||(o=[]),o.push(d,r)),r=u;else"dangerouslySetInnerHTML"===d?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(o=o||[]).push(d,u)):"children"===d?"string"!==typeof u&&"number"!==typeof u||(o=o||[]).push(d,""+u):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(l.hasOwnProperty(d)?(null!=u&&"onScroll"===d&&Ti("scroll",e),o||c===u||(o=[])):"object"===typeof u&&null!==u&&u.$$typeof===F?u.toString():(o=o||[]).push(d,u))}r&&(o=o||[]).push("style",r);var d=o;(t.updateQueue=d)&&(t.flags|=4)}},Wa=function(e,t,r,i){r!==i&&(t.flags|=4)};var oo="function"===typeof WeakMap?WeakMap:Map;function lo(e,t,r){(r=os(-1,r)).tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){$o||($o=!0,Qo=i),ao(0,t)},r}function co(e,t,r){(r=os(-1,r)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var n=t.value;r.payload=function(){return ao(0,t),i(n)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(r.callback=function(){"function"!==typeof i&&(null===Zo?Zo=new Set([this]):Zo.add(this),ao(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),r}var uo="function"===typeof WeakSet?WeakSet:Set;function ho(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(r){kl(e,r)}else t.current=null}function po(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var r=e.memoizedProps,i=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?r:Qn(t.type,r),i),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Gi(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(a(163))}function fo(e,t,r){switch(r.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=r.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var i=e.create;e.destroy=i()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=r.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var n=e;i=n.next,0!==(4&(n=n.tag))&&0!==(1&n)&&(Dl(r,e),Il(r,e)),e=i}while(e!==t)}return;case 1:return e=r.stateNode,4&r.flags&&(null===t?e.componentDidMount():(i=r.elementType===r.type?t.memoizedProps:Qn(r.type,t.memoizedProps),e.componentDidUpdate(i,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=r.updateQueue)&&ds(r,t,e));case 3:if(null!==(t=r.updateQueue)){if(e=null,null!==r.child)switch(r.child.tag){case 5:e=r.child.stateNode;break;case 1:e=r.child.stateNode}ds(r,t,e)}return;case 5:return e=r.stateNode,void(null===t&&4&r.flags&&Vi(r.type,r.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===r.memoizedState&&(r=r.alternate,null!==r&&(r=r.memoizedState,null!==r&&(r=r.dehydrated,null!==r&&_t(r)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(a(163))}function bo(e,t){for(var r=e;;){if(5===r.tag){var i=r.stateNode;if(t)"function"===typeof(i=i.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{i=r.stateNode;var n=r.memoizedProps.style;n=void 0!==n&&null!==n&&n.hasOwnProperty("display")?n.display:null,i.style.display=je("display",n)}}else if(6===r.tag)r.stateNode.nodeValue=t?"":r.memoizedProps;else if((23!==r.tag&&24!==r.tag||null===r.memoizedState||r===e)&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}function mo(e,t){if(jn&&"function"===typeof jn.onCommitFiberUnmount)try{jn.onCommitFiberUnmount(On,t)}catch(s){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var i=r,n=i.destroy;if(i=i.tag,void 0!==n)if(0!==(4&i))Dl(t,r);else{i=t;try{n()}catch(s){kl(i,s)}}r=r.next}while(r!==e)}break;case 1:if(ho(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(s){kl(t,s)}break;case 5:ho(t);break;case 4:_o(e,t)}}function go(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function yo(e){return 5===e.tag||3===e.tag||4===e.tag}function vo(e){e:{for(var t=e.return;null!==t;){if(yo(t))break e;t=t.return}throw Error(a(160))}var r=t;switch(t=r.stateNode,r.tag){case 5:var i=!1;break;case 3:case 4:t=t.containerInfo,i=!0;break;default:throw Error(a(161))}16&r.flags&&(ye(t,""),r.flags&=-17);e:t:for(r=e;;){for(;null===r.sibling;){if(null===r.return||yo(r.return)){r=null;break e}r=r.return}for(r.sibling.return=r.return,r=r.sibling;5!==r.tag&&6!==r.tag&&18!==r.tag;){if(2&r.flags)continue t;if(null===r.child||4===r.tag)continue t;r.child.return=r,r=r.child}if(!(2&r.flags)){r=r.stateNode;break e}}i?Oo(e,r,t):jo(e,r,t)}function Oo(e,t,r){var i=e.tag,n=5===i||6===i;if(n)e=n?e.stateNode:e.stateNode.instance,t?8===r.nodeType?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(8===r.nodeType?(t=r.parentNode).insertBefore(e,r):(t=r).appendChild(e),null!==(r=r._reactRootContainer)&&void 0!==r||null!==t.onclick||(t.onclick=Li));else if(4!==i&&null!==(e=e.child))for(Oo(e,t,r),e=e.sibling;null!==e;)Oo(e,t,r),e=e.sibling}function jo(e,t,r){var i=e.tag,n=5===i||6===i;if(n)e=n?e.stateNode:e.stateNode.instance,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==i&&null!==(e=e.child))for(jo(e,t,r),e=e.sibling;null!==e;)jo(e,t,r),e=e.sibling}function _o(e,t){for(var r,i,n=t,s=!1;;){if(!s){s=n.return;e:for(;;){if(null===s)throw Error(a(160));switch(r=s.stateNode,s.tag){case 5:i=!1;break e;case 3:case 4:r=r.containerInfo,i=!0;break e}s=s.return}s=!0}if(5===n.tag||6===n.tag){e:for(var o=e,l=n,c=l;;)if(mo(o,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===l)break e;for(;null===c.sibling;){if(null===c.return||c.return===l)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}i?(o=r,l=n.stateNode,8===o.nodeType?o.parentNode.removeChild(l):o.removeChild(l)):r.removeChild(n.stateNode)}else if(4===n.tag){if(null!==n.child){r=n.stateNode.containerInfo,i=!0,n.child.return=n,n=n.child;continue}}else if(mo(e,n),null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;4===(n=n.return).tag&&(s=!1)}n.sibling.return=n.return,n=n.sibling}}function wo(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{3===(3&i.tag)&&(e=i.destroy,i.destroy=void 0,void 0!==e&&e()),i=i.next}while(i!==r)}return;case 1:return;case 5:if(null!=(r=t.stateNode)){i=t.memoizedProps;var n=null!==e?e.memoizedProps:i;e=t.type;var s=t.updateQueue;if(t.updateQueue=null,null!==s){for(r[Zi]=i,"input"===e&&"radio"===i.type&&null!=i.name&&te(r,i),Se(e,n),t=Se(e,i),n=0;n<s.length;n+=2){var o=s[n],l=s[n+1];"style"===o?_e(r,l):"dangerouslySetInnerHTML"===o?ge(r,l):"children"===o?ye(r,l):O(r,o,l,t)}switch(e){case"input":re(r,i);break;case"textarea":ce(r,i);break;case"select":e=r._wrapperState.wasMultiple,r._wrapperState.wasMultiple=!!i.multiple,null!=(s=i.value)?ae(r,!!i.multiple,s,!1):e!==!!i.multiple&&(null!=i.defaultValue?ae(r,!!i.multiple,i.defaultValue,!0):ae(r,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(a(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((r=t.stateNode).hydrate&&(r.hydrate=!1,_t(r.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(Bo=Nn(),bo(t.child,!0)),void xo(t);case 19:return void xo(t);case 17:return;case 23:case 24:return void bo(t,null!==t.memoizedState)}throw Error(a(163))}function xo(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new uo),t.forEach((function(t){var i=Vl.bind(null,e,t);r.has(t)||(r.add(t),t.then(i,i))}))}}function So(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var To=Math.ceil,Co=j.ReactCurrentDispatcher,Mo=j.ReactCurrentOwner,Po=0,Ao=null,Eo=null,Ro=0,Io=0,Do=an(0),Fo=0,Lo=null,ko=0,zo=0,Vo=0,No=0,Uo=null,Bo=0,Go=1/0;function qo(){Go=Nn()+500}var Ho,Wo=null,$o=!1,Qo=null,Zo=null,Xo=!1,Jo=null,Yo=90,Ko=[],el=[],tl=null,rl=0,il=null,nl=-1,sl=0,al=0,ol=null,ll=!1;function cl(){return 0!==(48&Po)?Nn():-1!==nl?nl:nl=Nn()}function ul(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===Un()?1:2;if(0===sl&&(sl=ko),0!==$n.transition){0!==al&&(al=null!==Uo?Uo.pendingLanes:0),e=sl;var t=4186112&~al;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Un(),0!==(4&Po)&&98===e?e=Nt(12,sl):e=Nt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),sl),e}function dl(e,t,r){if(50<rl)throw rl=0,il=null,Error(a(185));if(null===(e=hl(e,t)))return null;Gt(e,t,r),e===Ao&&(Vo|=t,4===Fo&&bl(e,Ro));var i=Un();1===t?0!==(8&Po)&&0===(48&Po)?ml(e):(pl(e,r),0===Po&&(qo(),Hn())):(0===(4&Po)||98!==i&&99!==i||(null===tl?tl=new Set([e]):tl.add(e)),pl(e,r)),Uo=e}function hl(e,t){e.lanes|=t;var r=e.alternate;for(null!==r&&(r.lanes|=t),r=e,e=e.return;null!==e;)e.childLanes|=t,null!==(r=e.alternate)&&(r.childLanes|=t),r=e,e=e.return;return 3===r.tag?r.stateNode:null}function pl(e,t){for(var r=e.callbackNode,i=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-qt(o),c=1<<l,u=s[l];if(-1===u){if(0===(c&i)||0!==(c&n)){u=t,kt(c);var d=Lt;s[l]=10<=d?u+250:6<=d?u+5e3:-1}}else u<=t&&(e.expiredLanes|=c);o&=~c}if(i=zt(e,e===Ao?Ro:0),t=Lt,0===i)null!==r&&(r!==Dn&&xn(r),e.callbackNode=null,e.callbackPriority=0);else{if(null!==r){if(e.callbackPriority===t)return;r!==Dn&&xn(r)}15===t?(r=ml.bind(null,e),null===Ln?(Ln=[r],kn=wn(Pn,Wn)):Ln.push(r),r=Dn):14===t?r=qn(99,ml.bind(null,e)):r=qn(r=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(a(358,e))}}(t),fl.bind(null,e)),e.callbackPriority=t,e.callbackNode=r}}function fl(e){if(nl=-1,al=sl=0,0!==(48&Po))throw Error(a(327));var t=e.callbackNode;if(Rl()&&e.callbackNode!==t)return null;var r=zt(e,e===Ao?Ro:0);if(0===r)return null;var i=r,n=Po;Po|=16;var s=wl();for(Ao===e&&Ro===i||(qo(),jl(e,i));;)try{Tl();break}catch(l){_l(e,l)}if(Kn(),Co.current=s,Po=n,null!==Eo?i=0:(Ao=null,Ro=0,i=Fo),0!==(ko&Vo))jl(e,0);else if(0!==i){if(2===i&&(Po|=64,e.hydrate&&(e.hydrate=!1,Gi(e.containerInfo)),0!==(r=Vt(e))&&(i=xl(e,r))),1===i)throw t=Lo,jl(e,0),bl(e,r),pl(e,Nn()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=r,i){case 0:case 1:throw Error(a(345));case 2:Pl(e);break;case 3:if(bl(e,r),(62914560&r)===r&&10<(i=Bo+500-Nn())){if(0!==zt(e,0))break;if(((n=e.suspendedLanes)&r)!==r){cl(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=Ui(Pl.bind(null,e),i);break}Pl(e);break;case 4:if(bl(e,r),(4186112&r)===r)break;for(i=e.eventTimes,n=-1;0<r;){var o=31-qt(r);s=1<<o,(o=i[o])>n&&(n=o),r&=~s}if(r=n,10<(r=(120>(r=Nn()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*To(r/1960))-r)){e.timeoutHandle=Ui(Pl.bind(null,e),r);break}Pl(e);break;case 5:Pl(e);break;default:throw Error(a(329))}}return pl(e,Nn()),e.callbackNode===t?fl.bind(null,e):null}function bl(e,t){for(t&=~No,t&=~Vo,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-qt(t),i=1<<r;e[r]=-1,t&=~i}}function ml(e){if(0!==(48&Po))throw Error(a(327));if(Rl(),e===Ao&&0!==(e.expiredLanes&Ro)){var t=Ro,r=xl(e,t);0!==(ko&Vo)&&(r=xl(e,t=zt(e,t)))}else r=xl(e,t=zt(e,0));if(0!==e.tag&&2===r&&(Po|=64,e.hydrate&&(e.hydrate=!1,Gi(e.containerInfo)),0!==(t=Vt(e))&&(r=xl(e,t))),1===r)throw r=Lo,jl(e,0),bl(e,t),pl(e,Nn()),r;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Pl(e),pl(e,Nn()),null}function gl(e,t){var r=Po;Po|=1;try{return e(t)}finally{0===(Po=r)&&(qo(),Hn())}}function yl(e,t){var r=Po;Po&=-2,Po|=8;try{return e(t)}finally{0===(Po=r)&&(qo(),Hn())}}function vl(e,t){ln(Do,Io),Io|=t,ko|=t}function Ol(){Io=Do.current,on(Do)}function jl(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(-1!==r&&(e.timeoutHandle=-1,Bi(r)),null!==Eo)for(r=Eo.return;null!==r;){var i=r;switch(i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&bn();break;case 3:Es(),on(dn),on(un),Ws();break;case 5:Is(i);break;case 4:Es();break;case 13:case 19:on(Ds);break;case 10:es(i);break;case 23:case 24:Ol()}r=r.return}Ao=e,Eo=Gl(e.current,null),Ro=Io=ko=t,Fo=0,Lo=null,No=Vo=zo=0}function _l(e,t){for(;;){var r=Eo;try{if(Kn(),$s.current=Ma,Ks){for(var i=Xs.memoizedState;null!==i;){var n=i.queue;null!==n&&(n.pending=null),i=i.next}Ks=!1}if(Zs=0,Ys=Js=Xs=null,ea=!1,Mo.current=null,null===r||null===r.return){Fo=1,Lo=t,Eo=null;break}e:{var s=e,a=r.return,o=r,l=t;if(t=Ro,o.flags|=2048,o.firstEffect=o.lastEffect=null,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l;if(0===(2&o.mode)){var u=o.alternate;u?(o.updateQueue=u.updateQueue,o.memoizedState=u.memoizedState,o.lanes=u.lanes):(o.updateQueue=null,o.memoizedState=null)}var d=0!==(1&Ds.current),h=a;do{var p;if(p=13===h.tag){var f=h.memoizedState;if(null!==f)p=null!==f.dehydrated;else{var b=h.memoizedProps;p=void 0!==b.fallback&&(!0!==b.unstable_avoidThisFallback||!d)}}if(p){var m=h.updateQueue;if(null===m){var g=new Set;g.add(c),h.updateQueue=g}else m.add(c);if(0===(2&h.mode)){if(h.flags|=64,o.flags|=16384,o.flags&=-2981,1===o.tag)if(null===o.alternate)o.tag=17;else{var y=os(-1,1);y.tag=2,ls(o,y)}o.lanes|=1;break e}l=void 0,o=t;var v=s.pingCache;if(null===v?(v=s.pingCache=new oo,l=new Set,v.set(c,l)):void 0===(l=v.get(c))&&(l=new Set,v.set(c,l)),!l.has(o)){l.add(o);var O=zl.bind(null,s,c,o);c.then(O,O)}h.flags|=4096,h.lanes=t;break e}h=h.return}while(null!==h);l=Error(($(o.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Fo&&(Fo=2),l=so(l,o),h=a;do{switch(h.tag){case 3:s=l,h.flags|=4096,t&=-t,h.lanes|=t,cs(h,lo(0,s,t));break e;case 1:s=l;var j=h.type,_=h.stateNode;if(0===(64&h.flags)&&("function"===typeof j.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===Zo||!Zo.has(_)))){h.flags|=4096,t&=-t,h.lanes|=t,cs(h,co(h,s,t));break e}}h=h.return}while(null!==h)}Ml(r)}catch(w){t=w,Eo===r&&null!==r&&(Eo=r=r.return);continue}break}}function wl(){var e=Co.current;return Co.current=Ma,null===e?Ma:e}function xl(e,t){var r=Po;Po|=16;var i=wl();for(Ao===e&&Ro===t||jl(e,t);;)try{Sl();break}catch(n){_l(e,n)}if(Kn(),Po=r,Co.current=i,null!==Eo)throw Error(a(261));return Ao=null,Ro=0,Fo}function Sl(){for(;null!==Eo;)Cl(Eo)}function Tl(){for(;null!==Eo&&!Sn();)Cl(Eo)}function Cl(e){var t=Ho(e.alternate,e,Io);e.memoizedProps=e.pendingProps,null===t?Ml(e):Eo=t,Mo.current=null}function Ml(e){var t=e;do{var r=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(r=io(r,t,Io)))return void(Eo=r);if(24!==(r=t).tag&&23!==r.tag||null===r.memoizedState||0!==(1073741824&Io)||0===(4&r.mode)){for(var i=0,n=r.child;null!==n;)i|=n.lanes|n.childLanes,n=n.sibling;r.childLanes=i}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(r=no(t)))return r.flags&=2047,void(Eo=r);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Eo=t);Eo=t=e}while(null!==t);0===Fo&&(Fo=5)}function Pl(e){var t=Un();return Gn(99,Al.bind(null,e,t)),null}function Al(e,t){do{Rl()}while(null!==Jo);if(0!==(48&Po))throw Error(a(327));var r=e.finishedWork;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(a(177));e.callbackNode=null;var i=r.lanes|r.childLanes,n=i,s=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;for(var o=e.eventTimes,l=e.expirationTimes;0<s;){var c=31-qt(s),u=1<<c;n[c]=0,o[c]=-1,l[c]=-1,s&=~u}if(null!==tl&&0===(24&i)&&tl.has(e)&&tl.delete(e),e===Ao&&(Eo=Ao=null,Ro=0),1<r.flags?null!==r.lastEffect?(r.lastEffect.nextEffect=r,i=r.firstEffect):i=r:i=r.firstEffect,null!==i){if(n=Po,Po|=32,Mo.current=null,ki=Zt,pi(o=hi())){if("selectionStart"in o)l={start:o.selectionStart,end:o.selectionEnd};else e:if(l=(l=o.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&0!==u.rangeCount){l=u.anchorNode,s=u.anchorOffset,c=u.focusNode,u=u.focusOffset;try{l.nodeType,c.nodeType}catch(T){l=null;break e}var d=0,h=-1,p=-1,f=0,b=0,m=o,g=null;t:for(;;){for(var y;m!==l||0!==s&&3!==m.nodeType||(h=d+s),m!==c||0!==u&&3!==m.nodeType||(p=d+u),3===m.nodeType&&(d+=m.nodeValue.length),null!==(y=m.firstChild);)g=m,m=y;for(;;){if(m===o)break t;if(g===l&&++f===s&&(h=d),g===c&&++b===u&&(p=d),null!==(y=m.nextSibling))break;g=(m=g).parentNode}m=y}l=-1===h||-1===p?null:{start:h,end:p}}else l=null;l=l||{start:0,end:0}}else l=null;zi={focusedElem:o,selectionRange:l},Zt=!1,ol=null,ll=!1,Wo=i;do{try{El()}catch(T){if(null===Wo)throw Error(a(330));kl(Wo,T),Wo=Wo.nextEffect}}while(null!==Wo);ol=null,Wo=i;do{try{for(o=e;null!==Wo;){var v=Wo.flags;if(16&v&&ye(Wo.stateNode,""),128&v){var O=Wo.alternate;if(null!==O){var j=O.ref;null!==j&&("function"===typeof j?j(null):j.current=null)}}switch(1038&v){case 2:vo(Wo),Wo.flags&=-3;break;case 6:vo(Wo),Wo.flags&=-3,wo(Wo.alternate,Wo);break;case 1024:Wo.flags&=-1025;break;case 1028:Wo.flags&=-1025,wo(Wo.alternate,Wo);break;case 4:wo(Wo.alternate,Wo);break;case 8:_o(o,l=Wo);var _=l.alternate;go(l),null!==_&&go(_)}Wo=Wo.nextEffect}}catch(T){if(null===Wo)throw Error(a(330));kl(Wo,T),Wo=Wo.nextEffect}}while(null!==Wo);if(j=zi,O=hi(),v=j.focusedElem,o=j.selectionRange,O!==v&&v&&v.ownerDocument&&di(v.ownerDocument.documentElement,v)){null!==o&&pi(v)&&(O=o.start,void 0===(j=o.end)&&(j=O),"selectionStart"in v?(v.selectionStart=O,v.selectionEnd=Math.min(j,v.value.length)):(j=(O=v.ownerDocument||document)&&O.defaultView||window).getSelection&&(j=j.getSelection(),l=v.textContent.length,_=Math.min(o.start,l),o=void 0===o.end?_:Math.min(o.end,l),!j.extend&&_>o&&(l=o,o=_,_=l),l=ui(v,_),s=ui(v,o),l&&s&&(1!==j.rangeCount||j.anchorNode!==l.node||j.anchorOffset!==l.offset||j.focusNode!==s.node||j.focusOffset!==s.offset)&&((O=O.createRange()).setStart(l.node,l.offset),j.removeAllRanges(),_>o?(j.addRange(O),j.extend(s.node,s.offset)):(O.setEnd(s.node,s.offset),j.addRange(O))))),O=[];for(j=v;j=j.parentNode;)1===j.nodeType&&O.push({element:j,left:j.scrollLeft,top:j.scrollTop});for("function"===typeof v.focus&&v.focus(),v=0;v<O.length;v++)(j=O[v]).element.scrollLeft=j.left,j.element.scrollTop=j.top}Zt=!!ki,zi=ki=null,e.current=r,Wo=i;do{try{for(v=e;null!==Wo;){var w=Wo.flags;if(36&w&&fo(v,Wo.alternate,Wo),128&w){O=void 0;var x=Wo.ref;if(null!==x){var S=Wo.stateNode;switch(Wo.tag){case 5:O=S;break;default:O=S}"function"===typeof x?x(O):x.current=O}}Wo=Wo.nextEffect}}catch(T){if(null===Wo)throw Error(a(330));kl(Wo,T),Wo=Wo.nextEffect}}while(null!==Wo);Wo=null,Fn(),Po=n}else e.current=r;if(Xo)Xo=!1,Jo=e,Yo=t;else for(Wo=i;null!==Wo;)t=Wo.nextEffect,Wo.nextEffect=null,8&Wo.flags&&((w=Wo).sibling=null,w.stateNode=null),Wo=t;if(0===(i=e.pendingLanes)&&(Zo=null),1===i?e===il?rl++:(rl=0,il=e):rl=0,r=r.stateNode,jn&&"function"===typeof jn.onCommitFiberRoot)try{jn.onCommitFiberRoot(On,r,void 0,64===(64&r.current.flags))}catch(T){}if(pl(e,Nn()),$o)throw $o=!1,e=Qo,Qo=null,e;return 0!==(8&Po)||Hn(),null}function El(){for(;null!==Wo;){var e=Wo.alternate;ll||null===ol||(0!==(8&Wo.flags)?et(Wo,ol)&&(ll=!0):13===Wo.tag&&So(e,Wo)&&et(Wo,ol)&&(ll=!0));var t=Wo.flags;0!==(256&t)&&po(e,Wo),0===(512&t)||Xo||(Xo=!0,qn(97,(function(){return Rl(),null}))),Wo=Wo.nextEffect}}function Rl(){if(90!==Yo){var e=97<Yo?97:Yo;return Yo=90,Gn(e,Fl)}return!1}function Il(e,t){Ko.push(t,e),Xo||(Xo=!0,qn(97,(function(){return Rl(),null})))}function Dl(e,t){el.push(t,e),Xo||(Xo=!0,qn(97,(function(){return Rl(),null})))}function Fl(){if(null===Jo)return!1;var e=Jo;if(Jo=null,0!==(48&Po))throw Error(a(331));var t=Po;Po|=32;var r=el;el=[];for(var i=0;i<r.length;i+=2){var n=r[i],s=r[i+1],o=n.destroy;if(n.destroy=void 0,"function"===typeof o)try{o()}catch(c){if(null===s)throw Error(a(330));kl(s,c)}}for(r=Ko,Ko=[],i=0;i<r.length;i+=2){n=r[i],s=r[i+1];try{var l=n.create;n.destroy=l()}catch(c){if(null===s)throw Error(a(330));kl(s,c)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return Po=t,Hn(),!0}function Ll(e,t,r){ls(e,t=lo(0,t=so(r,t),1)),t=cl(),null!==(e=hl(e,1))&&(Gt(e,1,t),pl(e,t))}function kl(e,t){if(3===e.tag)Ll(e,e,t);else for(var r=e.return;null!==r;){if(3===r.tag){Ll(r,e,t);break}if(1===r.tag){var i=r.stateNode;if("function"===typeof r.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Zo||!Zo.has(i))){var n=co(r,e=so(t,e),1);if(ls(r,n),n=cl(),null!==(r=hl(r,1)))Gt(r,1,n),pl(r,n);else if("function"===typeof i.componentDidCatch&&(null===Zo||!Zo.has(i)))try{i.componentDidCatch(t,e)}catch(s){}break}}r=r.return}}function zl(e,t,r){var i=e.pingCache;null!==i&&i.delete(t),t=cl(),e.pingedLanes|=e.suspendedLanes&r,Ao===e&&(Ro&r)===r&&(4===Fo||3===Fo&&(62914560&Ro)===Ro&&500>Nn()-Bo?jl(e,0):No|=r),pl(e,t)}function Vl(e,t){var r=e.stateNode;null!==r&&r.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===Un()?1:2:(0===sl&&(sl=ko),0===(t=Ut(62914560&~sl))&&(t=4194304))),r=cl(),null!==(e=hl(e,t))&&(Gt(e,t,r),pl(e,r))}function Nl(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Ul(e,t,r,i){return new Nl(e,t,r,i)}function Bl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Gl(e,t){var r=e.alternate;return null===r?((r=Ul(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.nextEffect=null,r.firstEffect=null,r.lastEffect=null),r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function ql(e,t,r,i,n,s){var o=2;if(i=e,"function"===typeof e)Bl(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case x:return Hl(r.children,n,s,t);case L:o=8,n|=16;break;case S:o=8,n|=1;break;case T:return(e=Ul(12,r,t,8|n)).elementType=T,e.type=T,e.lanes=s,e;case A:return(e=Ul(13,r,t,n)).type=A,e.elementType=A,e.lanes=s,e;case E:return(e=Ul(19,r,t,n)).elementType=E,e.lanes=s,e;case k:return Wl(r,n,s,t);case z:return(e=Ul(24,r,t,n)).elementType=z,e.lanes=s,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:o=10;break e;case M:o=9;break e;case P:o=11;break e;case R:o=14;break e;case I:o=16,i=null;break e;case D:o=22;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Ul(o,r,t,n)).elementType=e,t.type=i,t.lanes=s,t}function Hl(e,t,r,i){return(e=Ul(7,e,i,t)).lanes=r,e}function Wl(e,t,r,i){return(e=Ul(23,e,i,t)).elementType=k,e.lanes=r,e}function $l(e,t,r){return(e=Ul(6,e,null,t)).lanes=r,e}function Ql(e,t,r){return(t=Ul(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Zl(e,t,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=r,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Bt(0),this.expirationTimes=Bt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bt(0),this.mutableSourceEagerHydrationData=null}function Xl(e,t,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:r}}function Jl(e,t,r,i){var n=t.current,s=cl(),o=ul(n);e:if(r){t:{if(Xe(r=r._reactInternals)!==r||1!==r.tag)throw Error(a(170));var l=r;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(fn(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(a(171))}if(1===r.tag){var c=r.type;if(fn(c)){r=gn(r,c,l);break e}}r=l}else r=cn;return null===t.context?t.context=r:t.pendingContext=r,(t=os(s,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),ls(n,t),dl(n,o,s),o}function Yl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Kl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function ec(e,t){Kl(e,t),(e=e.alternate)&&Kl(e,t)}function tc(e,t,r){var i=null!=r&&null!=r.hydrationOptions&&r.hydrationOptions.mutableSources||null;if(r=new Zl(e,t,null!=r&&!0===r.hydrate),t=Ul(3,null,null,2===t?7:1===t?3:0),r.current=t,t.stateNode=r,ss(t),e[Xi]=r.current,Mi(8===e.nodeType?e.parentNode:e),i)for(e=0;e<i.length;e++){var n=(t=i[e])._getVersion;n=n(t._source),null==r.mutableSourceEagerHydrationData?r.mutableSourceEagerHydrationData=[t,n]:r.mutableSourceEagerHydrationData.push(t,n)}this._internalRoot=r}function rc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ic(e,t,r,i,n){var s=r._reactRootContainer;if(s){var a=s._internalRoot;if("function"===typeof n){var o=n;n=function(){var e=Yl(a);o.call(e)}}Jl(t,a,e,n)}else{if(s=r._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var r;r=e.lastChild;)e.removeChild(r);return new tc(e,0,t?{hydrate:!0}:void 0)}(r,i),a=s._internalRoot,"function"===typeof n){var l=n;n=function(){var e=Yl(a);l.call(e)}}yl((function(){Jl(t,a,e,n)}))}return Yl(a)}function nc(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!rc(t))throw Error(a(200));return Xl(e,t,null,r)}Ho=function(e,t,r){var i=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||dn.current)Ia=!0;else{if(0===(r&i)){switch(Ia=!1,t.tag){case 3:Ga(t),qs();break;case 5:Rs(t);break;case 1:fn(t.type)&&yn(t);break;case 4:As(t,t.stateNode.containerInfo);break;case 10:i=t.memoizedProps.value;var n=t.type._context;ln(Zn,n._currentValue),n._currentValue=i;break;case 13:if(null!==t.memoizedState)return 0!==(r&t.child.childLanes)?Qa(e,t,r):(ln(Ds,1&Ds.current),null!==(t=to(e,t,r))?t.sibling:null);ln(Ds,1&Ds.current);break;case 19:if(i=0!==(r&t.childLanes),0!==(64&e.flags)){if(i)return eo(e,t,r);t.flags|=64}if(null!==(n=t.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),ln(Ds,Ds.current),i)break;return null;case 23:case 24:return t.lanes=0,za(e,t,r)}return to(e,t,r)}Ia=0!==(16384&e.flags)}else Ia=!1;switch(t.lanes=0,t.tag){case 2:if(i=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,n=pn(t,un.current),rs(t,r),n=ia(null,t,i,e,n,r),t.flags|=1,"object"===typeof n&&null!==n&&"function"===typeof n.render&&void 0===n.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,fn(i)){var s=!0;yn(t)}else s=!1;t.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,ss(t);var o=i.getDerivedStateFromProps;"function"===typeof o&&ps(t,i,o,e),n.updater=fs,t.stateNode=n,n._reactInternals=t,ys(t,i,e,r),t=Ba(null,t,i,!0,s,r)}else t.tag=0,Da(null,t,n,r),t=t.child;return t;case 16:n=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,n=(s=n._init)(n._payload),t.type=n,s=t.tag=function(e){if("function"===typeof e)return Bl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===P)return 11;if(e===R)return 14}return 2}(n),e=Qn(n,e),s){case 0:t=Na(null,t,n,e,r);break e;case 1:t=Ua(null,t,n,e,r);break e;case 11:t=Fa(null,t,n,e,r);break e;case 14:t=La(null,t,n,Qn(n.type,e),i,r);break e}throw Error(a(306,n,""))}return t;case 0:return i=t.type,n=t.pendingProps,Na(e,t,i,n=t.elementType===i?n:Qn(i,n),r);case 1:return i=t.type,n=t.pendingProps,Ua(e,t,i,n=t.elementType===i?n:Qn(i,n),r);case 3:if(Ga(t),i=t.updateQueue,null===e||null===i)throw Error(a(282));if(i=t.pendingProps,n=null!==(n=t.memoizedState)?n.element:null,as(e,t),us(t,i,null,r),(i=t.memoizedState.element)===n)qs(),t=to(e,t,r);else{if((s=(n=t.stateNode).hydrate)&&(ks=qi(t.stateNode.containerInfo.firstChild),Ls=t,s=zs=!0),s){if(null!=(e=n.mutableSourceEagerHydrationData))for(n=0;n<e.length;n+=2)(s=e[n])._workInProgressVersionPrimary=e[n+1],Hs.push(s);for(r=xs(t,null,i,r),t.child=r;r;)r.flags=-3&r.flags|1024,r=r.sibling}else Da(e,t,i,r),qs();t=t.child}return t;case 5:return Rs(t),null===e&&Us(t),i=t.type,n=t.pendingProps,s=null!==e?e.memoizedProps:null,o=n.children,Ni(i,n)?o=null:null!==s&&Ni(i,s)&&(t.flags|=16),Va(e,t),Da(e,t,o,r),t.child;case 6:return null===e&&Us(t),null;case 13:return Qa(e,t,r);case 4:return As(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=ws(t,null,i,r):Da(e,t,i,r),t.child;case 11:return i=t.type,n=t.pendingProps,Fa(e,t,i,n=t.elementType===i?n:Qn(i,n),r);case 7:return Da(e,t,t.pendingProps,r),t.child;case 8:case 12:return Da(e,t,t.pendingProps.children,r),t.child;case 10:e:{i=t.type._context,n=t.pendingProps,o=t.memoizedProps,s=n.value;var l=t.type._context;if(ln(Zn,l._currentValue),l._currentValue=s,null!==o)if(l=o.value,0===(s=ai(l,s)?0:0|("function"===typeof i._calculateChangedBits?i._calculateChangedBits(l,s):1073741823))){if(o.children===n.children&&!dn.current){t=to(e,t,r);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){o=l.child;for(var u=c.firstContext;null!==u;){if(u.context===i&&0!==(u.observedBits&s)){1===l.tag&&((u=os(-1,r&-r)).tag=2,ls(l,u)),l.lanes|=r,null!==(u=l.alternate)&&(u.lanes|=r),ts(l.return,r),c.lanes|=r;break}u=u.next}}else o=10===l.tag&&l.type===t.type?null:l.child;if(null!==o)o.return=l;else for(o=l;null!==o;){if(o===t){o=null;break}if(null!==(l=o.sibling)){l.return=o.return,o=l;break}o=o.return}l=o}Da(e,t,n.children,r),t=t.child}return t;case 9:return n=t.type,i=(s=t.pendingProps).children,rs(t,r),i=i(n=is(n,s.unstable_observedBits)),t.flags|=1,Da(e,t,i,r),t.child;case 14:return s=Qn(n=t.type,t.pendingProps),La(e,t,n,s=Qn(n.type,s),i,r);case 15:return ka(e,t,t.type,t.pendingProps,i,r);case 17:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:Qn(i,n),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,fn(i)?(e=!0,yn(t)):e=!1,rs(t,r),ms(t,i,n),ys(t,i,n,r),Ba(null,t,i,!0,e,r);case 19:return eo(e,t,r);case 23:case 24:return za(e,t,r)}throw Error(a(156,t.tag))},tc.prototype.render=function(e){Jl(e,this._internalRoot,null,null)},tc.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Jl(null,e,null,(function(){t[Xi]=null}))},tt=function(e){13===e.tag&&(dl(e,4,cl()),ec(e,4))},rt=function(e){13===e.tag&&(dl(e,67108864,cl()),ec(e,67108864))},it=function(e){if(13===e.tag){var t=cl(),r=ul(e);dl(e,r,t),ec(e,r)}},nt=function(e,t){return t()},Ce=function(e,t,r){switch(t){case"input":if(re(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var n=tn(i);if(!n)throw Error(a(90));J(i),re(i,n)}}}break;case"textarea":ce(e,r);break;case"select":null!=(t=r.value)&&ae(e,!!r.multiple,t,!1)}},Ie=gl,De=function(e,t,r,i,n){var s=Po;Po|=4;try{return Gn(98,e.bind(null,t,r,i,n))}finally{0===(Po=s)&&(qo(),Hn())}},Fe=function(){0===(49&Po)&&(function(){if(null!==tl){var e=tl;tl=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,pl(e,Nn())}))}Hn()}(),Rl())},Le=function(e,t){var r=Po;Po|=2;try{return e(t)}finally{0===(Po=r)&&(qo(),Hn())}};var sc={Events:[Ki,en,tn,Ee,Re,Rl,{current:!1}]},ac={findFiberByHostInstance:Yi,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},oc={bundleType:ac.bundleType,version:ac.version,rendererPackageName:ac.rendererPackageName,rendererConfig:ac.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:j.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ke(e))?null:e.stateNode},findFiberByHostInstance:ac.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lc.isDisabled&&lc.supportsFiber)try{On=lc.inject(oc),jn=lc}catch(me){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sc,t.createPortal=nc,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw Error(a(268,Object.keys(e)))}return e=null===(e=Ke(t))?null:e.stateNode},t.flushSync=function(e,t){var r=Po;if(0!==(48&r))return e(t);Po|=1;try{if(e)return Gn(99,e.bind(null,t))}finally{Po=r,Hn()}},t.hydrate=function(e,t,r){if(!rc(t))throw Error(a(200));return ic(null,e,t,!0,r)},t.render=function(e,t,r){if(!rc(t))throw Error(a(200));return ic(null,e,t,!1,r)},t.unmountComponentAtNode=function(e){if(!rc(e))throw Error(a(40));return!!e._reactRootContainer&&(yl((function(){ic(null,null,e,!1,(function(){e._reactRootContainer=null,e[Xi]=null}))})),!0)},t.unstable_batchedUpdates=gl,t.unstable_createPortal=function(e,t){return nc(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!rc(r))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return ic(e,t,r,!1,i)},t.version="17.0.2"},function(e,t,r){"use strict";e.exports=r(680)},function(e,t,r){"use strict";var i,n,s,a;if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var u=null,d=null,h=function(){if(null!==u)try{var e=t.unstable_now();u(!0,e),u=null}catch(r){throw setTimeout(h,0),r}};i=function(e){null!==u?setTimeout(i,0,e):(u=e,setTimeout(h,0))},n=function(e,t){d=setTimeout(e,t)},s=function(){clearTimeout(d)},t.unstable_shouldYield=function(){return!1},a=t.unstable_forceFrameRate=function(){}}else{var p=window.setTimeout,f=window.clearTimeout;if("undefined"!==typeof console){var b=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof b&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var m=!1,g=null,y=-1,v=5,O=0;t.unstable_shouldYield=function(){return t.unstable_now()>=O},a=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):v=0<e?Math.floor(1e3/e):5};var j=new MessageChannel,_=j.port2;j.port1.onmessage=function(){if(null!==g){var e=t.unstable_now();O=e+v;try{g(!0,e)?_.postMessage(null):(m=!1,g=null)}catch(r){throw _.postMessage(null),r}}else m=!1},i=function(e){g=e,m||(m=!0,_.postMessage(null))},n=function(e,r){y=p((function(){e(t.unstable_now())}),r)},s=function(){f(y),y=-1}}function w(e,t){var r=e.length;e.push(t);e:for(;;){var i=r-1>>>1,n=e[i];if(!(void 0!==n&&0<T(n,t)))break e;e[i]=t,e[r]=n,r=i}}function x(e){return void 0===(e=e[0])?null:e}function S(e){var t=e[0];if(void 0!==t){var r=e.pop();if(r!==t){e[0]=r;e:for(var i=0,n=e.length;i<n;){var s=2*(i+1)-1,a=e[s],o=s+1,l=e[o];if(void 0!==a&&0>T(a,r))void 0!==l&&0>T(l,a)?(e[i]=l,e[o]=r,i=o):(e[i]=a,e[s]=r,i=s);else{if(!(void 0!==l&&0>T(l,r)))break e;e[i]=l,e[o]=r,i=o}}}return t}return null}function T(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}var C=[],M=[],P=1,A=null,E=3,R=!1,I=!1,D=!1;function F(e){for(var t=x(M);null!==t;){if(null===t.callback)S(M);else{if(!(t.startTime<=e))break;S(M),t.sortIndex=t.expirationTime,w(C,t)}t=x(M)}}function L(e){if(D=!1,F(e),!I)if(null!==x(C))I=!0,i(k);else{var t=x(M);null!==t&&n(L,t.startTime-e)}}function k(e,r){I=!1,D&&(D=!1,s()),R=!0;var i=E;try{for(F(r),A=x(C);null!==A&&(!(A.expirationTime>r)||e&&!t.unstable_shouldYield());){var a=A.callback;if("function"===typeof a){A.callback=null,E=A.priorityLevel;var o=a(A.expirationTime<=r);r=t.unstable_now(),"function"===typeof o?A.callback=o:A===x(C)&&S(C),F(r)}else S(C);A=x(C)}if(null!==A)var l=!0;else{var c=x(M);null!==c&&n(L,c.startTime-r),l=!1}return l}finally{A=null,E=i,R=!1}}var z=a;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){I||R||(I=!0,i(k))},t.unstable_getCurrentPriorityLevel=function(){return E},t.unstable_getFirstCallbackNode=function(){return x(C)},t.unstable_next=function(e){switch(E){case 1:case 2:case 3:var t=3;break;default:t=E}var r=E;E=t;try{return e()}finally{E=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=z,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=E;E=e;try{return t()}finally{E=r}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:P++,callback:r,priorityLevel:e,startTime:a,expirationTime:l=a+l,sortIndex:-1},a>o?(e.sortIndex=a,w(M,e),null===x(C)&&e===x(M)&&(D?s():D=!0,n(L,a-o))):(e.sortIndex=l,w(C,e),I||R||(I=!0,i(k))),e},t.unstable_wrapCallback=function(e){var t=E;return function(){var r=E;E=t;try{return e.apply(this,arguments)}finally{E=r}}}},,,,function(e,t,r){"use strict";r(551);var i=r(345),n=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var s=Symbol.for;n=s("react.element"),t.Fragment=s("react.fragment")}var a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var i,s={},c=null,u=null;for(i in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:n,type:e,key:c,ref:u,props:s,_owner:a.current}}t.jsx=c,t.jsxs=c}]]);
//# sourceMappingURL=35.d2b60f66.chunk.js.map