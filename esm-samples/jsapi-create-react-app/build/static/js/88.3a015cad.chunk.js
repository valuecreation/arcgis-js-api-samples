(this["webpackJsonpjsapi-create-react-app"]=this["webpackJsonpjsapi-create-react-app"]||[]).push([[88],{1182:function(e,t,r){"use strict";r.r(t);var s=r(0),a=(r(8),r(2)),n=(r(1),r(9),r(7),r(4)),o=r(571),i=r(56);r(10);(()=>{if(!("document"in i.a))return()=>null;const e=document.createElement("canvas"),t=e.getContext("2d");e.height=512,e.width=1})();function c(e){const t=Math.round(3*e),r=2*e*e,s=new Float64Array(2*t+1);for(let a=0;a<=s.length;a++)s[a]=Math.exp(-((a-t)**2)/r)/Math.sqrt(2*Math.PI)*(e/2);return s}var l=r(699),d=r(925),u=r(926);class h{constructor(e,t){this.offset=e,this.extent=t}}let p=class extends d.a{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];"heatmap"===r.type&&Object(o.a)(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}async onTileMessage(e,t,r){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const s=this._tileKeyToFeatureSets.get(e.key.id);if(Object(a.j)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&s.set(t.addOrUpdate.instance,t),t.end){const t=[],s=function(e){const t=e.key,r=new Map,s=256,a=l.v,n=e.tileInfoView.tileInfo.isWrappable;return r.set(Object(u.a)(t,-1,-1,n).id,new h([-a,-a],[a-s,a-s,a,a])),r.set(Object(u.a)(t,0,-1,n).id,new h([0,-a],[0,a-s,a,a])),r.set(Object(u.a)(t,1,-1,n).id,new h([a,-a],[0,a-s,s,a])),r.set(Object(u.a)(t,-1,0,n).id,new h([-a,0],[a-s,0,a,a])),r.set(Object(u.a)(t,1,0,n).id,new h([a,0],[0,0,s,a])),r.set(Object(u.a)(t,-1,1,n).id,new h([-a,a],[a-s,0,a,s])),r.set(Object(u.a)(t,0,1,n).id,new h([0,a],[0,0,a,s])),r.set(Object(u.a)(t,1,1,n).id,new h([a,a],[0,0,s,s])),r}(e);this._tileKeyToFeatureSets.forEach(((r,n)=>{if(n===e.key.id)r.forEach((e=>Object(a.b)(e.addOrUpdate,(e=>t.push(e)))));else if(s.has(n)){const e=s.get(n),[o,i]=e.offset;r.forEach((e=>Object(a.b)(e.addOrUpdate,(e=>{const r=e.transform(o,i,1,1);t.push(r)}))))}}));const n=function(e,t,r,s){const{blurRadius:a,fieldOffset:n,field:o}=t,i=new Float64Array(r*s),l=c(a),d=Math.round(3*a);let u,h=Number.NEGATIVE_INFINITY;const p=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):r=>+r.readAttribute(e)+t:e=>1}(o,n),f=new Set;for(const c of e){const e=c.getCursor();for(;e.next();){const t=e.getObjectId();if(f.has(t))continue;f.add(t);const a=e.readLegacyPointGeometry(),n=128;if(a.x<-n||a.x>=r+n||a.y<-n||a.y>s+n)continue;const o=+p(e),c=Math.round(a.x)-d,b=Math.round(a.y)-d,y=Math.max(0,c),O=Math.max(0,b),j=Math.min(s,Math.round(a.y)+d),m=Math.min(r,Math.round(a.x)+d);for(let e=O;e<j;e++){const t=l[e-b];for(let s=y;s<m;s++){const a=l[s-c];u=i[e*r+s]+=t*a*o,u>h&&(h=u)}}}}return{matrix:i.buffer,max:h}}(t,this._schema.mesh,512,512),o={tileKey:e.key.id,intensityInfo:n},i=[n.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",o,{...r,transferList:i})}}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}};p=Object(s.a)([Object(n.a)("esri.views.2d.layers.features.processors.HeatmapProcessor")],p);var f=p;t.default=f},925:function(e,t,r){"use strict";var s=r(0),a=r(178),n=r(1),o=(r(8),r(9),r(7),r(4));let i=class extends a.a{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};Object(s.a)([Object(n.b)({readOnly:!0})],i.prototype,"supportsTileUpdates",null),Object(s.a)([Object(n.b)({constructOnly:!0})],i.prototype,"remoteClient",void 0),Object(s.a)([Object(n.b)({constructOnly:!0})],i.prototype,"service",void 0),Object(s.a)([Object(n.b)()],i.prototype,"spatialReference",null),Object(s.a)([Object(n.b)({constructOnly:!0})],i.prototype,"tileInfo",void 0),Object(s.a)([Object(n.b)({constructOnly:!0})],i.prototype,"tileStore",void 0),i=Object(s.a)([Object(o.a)("esri.views.2d.layers.features.processors.BaseProcessor")],i);var c=i;t.a=c},926:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r(887);function s(e,t,r,s){const a=e.clone(),n=1<<a.level,o=a.col+t,i=a.row+r;return s&&o<0?(a.col=o+n,a.world-=1):o>=n?(a.col=o-n,a.world+=1):a.col=o,a.row=i,a}}}]);
//# sourceMappingURL=88.3a015cad.chunk.js.map