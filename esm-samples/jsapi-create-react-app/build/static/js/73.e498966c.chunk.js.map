{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/layers/BaseDynamicLayerView3D.js","../node_modules/@arcgis/core/views/3d/layers/support/projectExtentUtils.js","../node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js","../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js","../node_modules/@arcgis/core/views/3d/webgl-engine/materials/ImageMaterial.js","../node_modules/@arcgis/core/views/3d/layers/support/overlayImageUtils.js","../node_modules/@arcgis/core/views/3d/layers/DynamicLayerView3D.js"],"names":["o","e","constructor","super","arguments","this","type","r","s","t","l","view","spatialReference","layer","fullExtent","i","equals","Promise","resolve","clone","state","isLocal","portalItem","then","destroyed","catch","n","include","linearDepth","vertex","uniforms","add","attributes","varyings","multipassTerrainEnabled","code","fragment","a","output","float","d","OITEnabled","Object","freeze","__proto__","build","E","initializeProgram","shader","get","configuration","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","transparencyPassType","cullAboveGround","m","rctx","p","bindPass","program","camera","projectionMatrix","setUniform1f","opacity","setUniform2fv","nearFar","inverseViewport","bindDraw","rebindTextures","setPipelineState","T","blending","transparent","w","c","culling","P","cullFace","depthTest","func","u","depthWrite","writeDepth","v","colorWrite","j","stencilWrite","sceneHasOcludees","b","stencilTest","f","g","polygonOffset","h","enableOffset","initializePipeline","_occludeePipelineState","getPipelineState","pipeline","y","S","O","count","prototype","supportsEdges","techniqueConfig","getTechniqueConfig","params","relativeElevation","intersect","getGLMaterial","createBufferWriter","material","updateParameters","_material","updateTexture","textureId","_technique","_techniqueRep","releaseAndAcquire","_output","beginSlot","_updateOccludeeState","hasOccludees","setParameterValues","ensureParameters","bind","bindTextures","bindTextureScale","initTextureTransparent","createSquareGeometry","H","getLogger","G","drapeSourceType","updatePolicy","fullExtentInLocalViewSpatialReference","maximumDataResolution","_images","Array","_extents","_overlayExtents","updateWhenStationary","initialize","addResolvingPromise","L","_set","updatingHandles","_suspendedChangeHandler","handles","resourceController","scheduler","registerIdleStateCallbacks","_isScaleRangeActive","notifyChange","_isScaleRangeLayer","viewingMode","basemapTerrain","forEach","_updateImageExtent","destroy","clear","setDrapingExtent","index","extent","x","resolution","renderLocalOrigin","pixelRatio","_clippedExtent","width","height","Math","round","imageMaxWidth","imageMaxHeight","floor","_imageSizeDiffers","imageSize","suspended","_fetch","error","length","_clearImage","push","canResume","minScale","maxScale","scale","isUpdating","some","loadingPromise","HTMLImageElement","HTMLCanvasElement","image","findExtentInfoAt","contains","getFetchOptions","async","_createStageObjects","A","TESTS_DISABLE_UPDATE_THRESHOLDS","_","abs","texture","renderGeometry","loadingAbortController","pixelData","renderExtent","abort","signal","_waitFetchReady","requestAsImageElement","timestamp","refreshTimestamp","fetchImage","warnOnce","processResult","R","overlayManager","renderer","removeGeometries","_stage","remove","D","preMultiplyAlpha","wrap","min","max","Float64Array","Float32Array","Uint32Array","M","size","data","exclusive","I","id","C","origin","addGeometries","ready","refresh","readOnly","V"],"mappings":"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","file":"static/js/73.e498966c.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../chunks/tslib.es6.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import e from\"./DynamicLayerView3D.js\";let o=class extends e{constructor(){super(...arguments),this.type=\"base-dynamic-3d\"}};o=r([s(\"esri.views.3d.layers.BaseDynamicLayerView3D\")],o);var t=o;export default t;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{canProject as e,project as r}from\"../../../../geometry/support/webMercatorUtils.js\";import{projectGeometry as o}from\"../../../../portal/support/geometryServiceUtils.js\";function t(t){const l=t.view.spatialReference,s=t.layer.fullExtent,i=s&&s.spatialReference;return i?i.equals(l)?Promise.resolve(s.clone()):e(i,l)?Promise.resolve(r(s,l)):t.view.state.isLocal?o(s,l,t.layer.portalItem).then((e=>!t.destroyed&&e?e:void 0)).catch((()=>null)):Promise.resolve(null):Promise.resolve(null)}export{t as toViewIfLocal};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{Slice as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ReadLinearDepth as a}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{multipassTerrainTest as o}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{defaultMaskAlphaCutoff as i}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{ColorConversion as d}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{glsl as t}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as l}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function s(s){const n=new l;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(t`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(e,s),s.multipassTerrainEnabled&&(n.fragment.include(a),n.include(o,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(d),n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}var n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{bindSliceUniformsWithOrigin as t}from\"../core/shaderLibrary/Slice.glsl.js\";import{bindMultipassTerrainTexture as r}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{bindProjectionMatrix as i,bindView as s}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as a}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as o}from\"../core/shaderTechnique/ShaderTechnique.js\";import{ShaderTechniqueConfiguration as n,parameter as l}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as p}from\"../lib/DefaultVertexAttributeLocations.js\";import{OITBlending as c,OITDepthTest as u,OITDepthWrite as d,getOITPolygonOffset as h}from\"../lib/OrderIndependentTransparency.js\";import{Program as m}from\"../lib/Program.js\";import{stencilWriteMaskOn as b,stencilToolMaskBaseParams as f,stencilBaseAllZerosParams as g}from\"../lib/StencilUtils.js\";import{I as y}from\"../../../../chunks/ImageMaterial.glsl.js\";import{makePipelineState as T,cullingParams as P,defaultDepthWriteParams as v,defaultColorWriteParams as j,simpleBlendingParams as S}from\"../../../webgl/renderState.js\";class E extends o{initializeProgram(e){const t=E.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new m(e.rctx,i,p)}bindPass(e,t){i(this.program,t.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",t.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",t.inverseViewport),r(this.program,t))}bindDraw(e){s(this.program,e),t(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e;return T({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?w:c(e),culling:P(r.cullFace),depthTest:{func:u(e)},depthWrite:i?r.writeDepth&&v:d(e),colorWrite:j,stencilWrite:r.sceneHasOcludees?b:null,stencilTest:r.sceneHasOcludees?t?f:g:null,polygonOffset:i||s?null:h(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}E.shader=new a(y,(()=>import(\"./ImageMaterial.glsl.js\")));const w=S(1,771);class O extends n{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([l({count:8})],O.prototype,\"output\",void 0),e([l({count:3})],O.prototype,\"cullFace\",void 0),e([l()],O.prototype,\"slicePlaneEnabled\",void 0),e([l()],O.prototype,\"transparent\",void 0),e([l()],O.prototype,\"enableOffset\",void 0),e([l()],O.prototype,\"writeDepth\",void 0),e([l()],O.prototype,\"sceneHasOcludees\",void 0),e([l({count:4})],O.prototype,\"transparencyPassType\",void 0),e([l()],O.prototype,\"multipassTerrainEnabled\",void 0),e([l()],O.prototype,\"cullAboveGround\",void 0);export{E as ImageMaterialTechnique,O as ImageMaterialTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../lib/GLMaterialTexture.js\";import{Material as t,materialParametersDefaults as i}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as s}from\"../lib/OrderIndependentTransparency.js\";import{DefaultBufferWriter as a,PositionUVLayout as r}from\"./internal/DefaultBufferWriter.js\";import{intersectTriangleGeometry as n}from\"./internal/MaterialUtil.js\";import{ImageMaterialTechniqueConfiguration as u,ImageMaterialTechnique as h}from\"../shaders/ImageMaterialTechnique.js\";class c extends t{constructor(e){super(e,p),this.supportsEdges=!0,this.techniqueConfig=new u}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<s,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,s,a,r,u){n(e,t,s,a,r,void 0,u)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new l(e):void 0}createBufferWriter(){return new a(r)}}class l extends e{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(h,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){if(4===this._output)return 3===e;return e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const p={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...i};export{c as ImageMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{width as t,height as e,intersects as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{Geometry as i}from\"../../webgl-engine/lib/Geometry.js\";import r from\"../../webgl-engine/lib/GeometryUtil.js\";function o(n,i,r){const o=t(n)/e(n),a={width:r,height:r};return o>1.0001?a.height=r/o:o<.9999&&(a.width=r*o),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function a(t){return r.createSquareGeometry([[t[0],t[1],-1],[t[2],t[1],-1],[t[2],t[3],-1],[t[0],t[3],-1]])}function h(t,e){if(!n(t,e))return a(e);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],o=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],h=e[2]-e[0],u=e[3]-e[1],l=o[0]>0&&o[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,c=(m+1)*(l+1),g=new Float64Array(3*c),w=new Float32Array(2*c),d=new Uint32Array(6*(m*l-1));let f=0,p=0,y=0,x=0,M=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=o[r];t<=0||(g[p++]=e[0]+i,g[p++]=e[1]+f,g[p++]=-1,w[y++]=i/h,w[y++]=f/u,r<3&&n<3&&(1!==r||1!==n)&&(d[M++]=x,d[M++]=x+1,d[M++]=x+l+1,d[M++]=x+1,d[M++]=x+l+2,d[M++]=x+l+1),x++,i+=t)}f+=t}const v=new Uint32Array(d.length);return new i([[\"position\",{size:3,data:g,exclusive:!0}],[\"normal\",{size:3,data:s,exclusive:!0}],[\"uv0\",{size:2,data:w,exclusive:!0}]],[[\"position\",d],[\"normal\",v],[\"uv0\",d]])}const s=[0,0,1];export{o as computeImageExportSize,a as createGeometryForExtent,h as createOuterImageGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{forEach as t,result as i}from\"../../../core/asyncUtils.js\";import r from\"../../../core/Logger.js\";import{isSome as a,isNone as s}from\"../../../core/maybe.js\";import{isAbortError as n,eachAlways as o,createAbortController as l,onAbort as h,isAborted as m,createAbortError as d,always as c,throwIfAborted as g}from\"../../../core/promiseUtils.js\";import{whenOnce as u}from\"../../../core/watchUtils.js\";import{property as p}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as y}from\"../../../core/accessorSupport/decorators/subclass.js\";import f from\"../../../geometry/Extent.js\";import{create as x,equals as w,width as _,height as v,set as R,intersection as b}from\"../../../geometry/support/aaBoundingRect.js\";import{LayerView3D as S}from\"./LayerView3D.js\";import{computeImageExportSize as E,createGeometryForExtent as j,createOuterImageGeometry as I}from\"./support/overlayImageUtils.js\";import{toViewIfLocal as L}from\"./support/projectExtentUtils.js\";import A from\"../support/debugFlags.js\";import{RenderGeometry as C}from\"../webgl-engine/lib/RenderGeometry.js\";import{Texture as D}from\"../webgl-engine/lib/Texture.js\";import{ImageMaterial as M}from\"../webgl-engine/materials/ImageMaterial.js\";import G from\"../../layers/LayerView.js\";import{RefreshableLayerView as T}from\"../../layers/RefreshableLayerView.js\";const H=r.getLogger(\"esri.views.3d.layers.DynamicLayerView3D\");let O=class extends(T(S(G))){constructor(){super(...arguments),this.drapeSourceType=0,this.updatePolicy=1,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlayExtents=new Array,this.updateWhenStationary=!0}initialize(){this.addResolvingPromise(L(this).then((e=>this._set(\"fullExtentInLocalViewSpatialReference\",e)))),this.updatingHandles.add(this,\"suspended\",(()=>this._suspendedChangeHandler())),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((()=>{this._isScaleRangeActive()&&this.notifyChange(\"suspended\")}),(()=>{}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this.notifyChange(\"suspended\"))),\"local\"===this.view.viewingMode&&this.updatingHandles.add(this.view.basemapTerrain,\"extent\",(()=>this._overlayExtents.forEach(((e,t)=>this._updateImageExtent(t)))))}destroy(){this.clear()}setDrapingExtent(e,t){this._overlayExtents[e.index]={extent:x(e.extent),spatialReference:t,resolution:e.resolution,renderLocalOrigin:e.renderLocalOrigin,pixelRatio:e.pixelRatio},this._updateImageExtent(e.index)}_updateImageExtent(e){const t=this._overlayExtents[e],i=this._clippedExtent(t.extent,P),r=E(t.extent,i,t.resolution);let a=t.pixelRatio*this.view.pixelRatio;if(\"imageMaxWidth\"in this.layer||\"imageMaxHeight\"in this.layer){const e=this.layer.imageMaxWidth,t=this.layer.imageMaxHeight;if(r.width>e){const t=e/r.width;r.height=Math.floor(r.height*t),r.width=e,a*=t}if(r.height>t){const e=t/r.height;r.width=Math.floor(r.width*e),r.height=t,a*=e}}const s=this._extents[e];s&&w(s.extent,i)&&!this._imageSizeDiffers(i,s.imageSize,r)||(this._extents[e]={extent:x(i),spatialReference:t.spatialReference,imageSize:r,pixelRatio:a},this.suspended||this._fetch(e).catch((e=>{n(e)||H.error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(e){if(this.suspended)return;const t=[];for(let i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));await o(t)}canResume(){if(!super.canResume())return!1;if(this._isScaleRangeLayer()){const{minScale:e,maxScale:t}=this.layer;if(e>0||t>0){const i=this.view.scale;if(i<t||e>0&&i>e)return!1}}return!0}isUpdating(){return this._images.some((e=>!!e.loadingPromise))}async processResult(e,t,i){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const i=t.extent;if(new f(i[0],i[1],i[2],i[3],t.spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,i){await t(this._images,(async(t,r)=>{t&&(await e(t,i),await this._createStageObjects(r,t.image))}))}_imageSizeDiffers(e,t,i){if(!this.maximumDataResolution||A.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;const r=_(e)/this.maximumDataResolution.x,a=v(e)/this.maximumDataResolution.y,s=r/t.width,n=a/t.height,o=r/i.width,l=a/i.height,h=Math.abs(s-o),m=Math.abs(n-l);return h>1.5||m>1.5}async _fetch(e,t){if(this.suspended)return;const i=this._extents[e],r=i.extent;this._images[e]||(this._images[e]={texture:null,material:null,renderGeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:x(r)});const a=this._images[e];a.loadingAbortController&&(a.loadingAbortController.abort(),a.loadingAbortController=null);const s=new f(r[0],r[1],r[2],r[3],i.spatialReference);if(0===s.width||0===s.height)return void this._clearImage(e);const o=l();a.loadingAbortController=o,h(t,(()=>o.abort()));const g=o.signal,u=this._waitFetchReady(g).then((()=>{const t={requestAsImageElement:!0,pixelRatio:this._overlayExtents[e].pixelRatio,...this.getFetchOptions(),signal:g},{height:r,width:a}=i.imageSize;return t.timestamp=this.refreshTimestamp,this.layer.fetchImage(s,a,r,t)})).then((e=>{if(m(g))throw H.warnOnce(\"A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true.\"),d();return this.processResult(a,e)})).then((()=>R(a.renderExtent,r)));a.loadingPromise=u,c(u,(()=>{u===a.loadingPromise&&(a.loadingPromise=null,a.loadingAbortController=null)}));const p=u.then((async()=>{await this._createStageObjects(e,a.image),this.notifyChange(\"updating\")})).catch((e=>{throw e&&!n(e)&&H.error(e),this.notifyChange(\"updating\"),e}));this.notifyChange(\"updating\"),await p}_clearImage(e){const t=this._images[e];if(t){a(t.renderGeometry)&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.renderGeometry],this,2),t.renderGeometry=null);const e=this.view._stage;e.remove(t.texture),t.texture=null,e.remove(t.material),t.material=null,t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null}}async _createStageObjects(e,t){const r=this.view._stage,n=this._images[e],o=this.view.basemapTerrain.overlayManager.renderer,l=()=>{r.remove(n.texture),n.texture=null,a(n.renderGeometry)&&(o.removeGeometries([n.renderGeometry],this,2),n.renderGeometry=null)};if(t){const a=new D(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});let h;if(await i(this._images[0===e?1:0].loadingPromise),0===e)h=j(n.renderExtent);else{const e=this._images[0].renderExtent;if(!e)return void l();h=I(e,n.renderExtent)}l(),r.add(a),n.texture=a,s(n.material)?(n.material=new M({transparent:!0,textureId:a.id}),r.add(n.material)):n.material.setParameterValues({textureId:a.id}),n.renderGeometry=new C(h,n.material),n.renderGeometry.origin=this._overlayExtents[e].renderLocalOrigin,o.addGeometries([n.renderGeometry],this,2)}else l(),r.remove(n.material),n.material=null}_isScaleRangeLayer(){return\"minScale\"in this.layer&&\"maxScale\"in this.layer}_isScaleRangeActive(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)}_clippedExtent(e,t){if(\"local\"!==this.view.viewingMode)return R(t,e);const i=this.view.basemapTerrain,r=i.extent;return i.ready&&r?b(e,r,t):R(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refresh()}async _waitFetchReady(e){await u(this.view,\"stationary\",e),g(e)}};e([p()],O.prototype,\"layer\",void 0),e([p()],O.prototype,\"suspended\",void 0),e([p({readOnly:!0})],O.prototype,\"fullExtentInLocalViewSpatialReference\",void 0),e([p()],O.prototype,\"updating\",void 0),O=e([y(\"esri.views.3d.layers.DynamicLayerView3D\")],O);const P=x();var V=O;export default V;\n"],"sourceRoot":""}