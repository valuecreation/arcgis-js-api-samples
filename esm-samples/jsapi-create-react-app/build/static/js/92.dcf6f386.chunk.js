(this["webpackJsonpjsapi-create-react-app"]=this["webpackJsonpjsapi-create-react-app"]||[]).push([[92],{1162:function(e,t,i){"use strict";i.r(t);var s=i(0),a=i(2),r=i(1),n=(i(8),i(9),i(7),i(4)),o=i(946),l=i(564),c=i(19),h=i(42),d=i(10),u=i(901),b=i(23),_=i(289),p=i(3),g=i(5),O=i(782),m=i(166),j=i(36),v=i(53),w=i(902),y=i(903);let f=class extends c.a{constructor(e){super(e),this._unitNormalizer=new y.a,this._handles=new h.a,this._tempStartPosition=Object(g.e)(),this._tempEndPosition=Object(g.e)(),this._tempCornerPosition=Object(g.e)()}initialize(){this._handles.add(Object(b.j)(this.view,"ready",(()=>this._initialize()),!0))}destroy(){this._handles=Object(a.e)(this._handles)}_initialize(){const e=this.view.spatialReference,t=Object(v.g)(e),i=t===v.a?v.d:t;this._sphericalPCPF=i;const s=Object(j.b)(e,i);this._unitNormalizer.spatialReference=s?i:e,this._handles.add(Object(_.d)((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e})))}get _computedResult(){const{startPoint:e,endPoint:t}=this.layer;if(Object(a.i)(e)||Object(a.i)(t))return null;const i=this._euclideanDistances(e,t),s=this._exactGeodesicDistanceAndAngle(e,t,i.horizontal.value);return{directDistance:i.direct,horizontalDistance:i.horizontal,verticalDistance:i.vertical,geodesicDistance:s.distance,geodesicAngle:s.angle}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const s=this._tempStartPosition,a=this._tempEndPosition,r=this._tempCornerPosition,n=this.view.spatialReference,o=this._sphericalPCPF,l=Object(j.b)(n,o)?o:n;Object(j.u)(e,s,l),Object(j.u)(t,a,l),Object(j.u)(i,r,l);const c=Object(p.o)(s,a),h=Object(p.o)(r,a),d=Math.abs(t.z-e.z),b=e=>this._unitNormalizer.normalizeDistance(e),_=b(c),g=b(h),O=b(d);return{direct:new u.a(_,"meters"),horizontal:new u.a(g,"meters"),vertical:new u.a(O,"meters")}}_exactGeodesicDistanceAndAngle(e,t,i){const s=e.spatialReference,a=new m.a({spatialReference:s});a.addPath([e,t]);const r=s.isGeographic&&Object(w.c)(s)?Object(w.a)([a],"meters")[0]:s.isWebMercator?Object(O.geodesicLength)(a,"meters"):void 0,{distance:n,angle:o}=r?{distance:r,angle:this._fallbackGeodesicAngle(r,s)}:this._fallbackGeodesicDistance(e,t,i);return{distance:new u.a(n,"meters"),angle:new u.a(o,"degrees")}}_fallbackGeodesicAngle(e,t){return e/Object(v.e)(t).metersPerDegree}_fallbackGeodesicDistance(e,t,i){if(Object(j.v)(e,L)){Object(j.v)(t,z);const e=Object(d.g)(L[0]),i=Object(d.g)(L[1]),s=Object(d.g)(z[0]),a=Object(d.g)(z[1]),r=Math.abs(s-e),n=Object(d.b)(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(r)),o=Object(d.r)(n),l={distance:0};return Object(w.b)(l,[L[0],L[1]],[z[0],z[1]]),{distance:l.distance,angle:o}}const s=e.spatialReference,a=i;return{distance:a,angle:this._fallbackGeodesicAngle(a,s)}}};Object(s.a)([Object(r.b)()],f.prototype,"view",void 0),Object(s.a)([Object(r.b)()],f.prototype,"layer",void 0),Object(s.a)([Object(r.b)()],f.prototype,"viewData",void 0),Object(s.a)([Object(r.b)()],f.prototype,"_computedResult",null),f=Object(s.a)([Object(n.a)("esri.views.3d.layers.analysis.DirectLineMeasurement/DirectLineMeasurementController")],f);const L=Object(g.e)(),z=Object(g.e)();i(340);var M=i(947),C=i(17),V=i(54),S=i(18),P=i(192),E=i(963),D=i(784),x=i(20),A=i(34),G=i(742),R=i(160),T=i(94),q=i(184),U=i(103),H=i(92),W=i(77),k=i(82),Q=i(15),F=i(62),B=i(74),I=i(904),N=i(30);class J extends k.a{constructor(e,t,i){super(e,t,i)}initializeProgram(e){const t=J.shader.get().build();return new B.a(e.rctx,t,F.a)}bindPass(e,t){Object(H.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("width",e.width),this.program.setUniform1f("outlineSize",e.outlineSize),this.program.setUniform4fv("outlineColor",e.outlineColor),this.program.setUniform1f("stripeLength",e.stripeLength),this.program.setUniform4fv("stripeEvenColor",e.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",e.stripeOddColor)}bindDraw(e){Object(H.d)(this.program,e),this.program.rebindTextures()}initializePipeline(){return Object(N.g)({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:N.e,colorWrite:N.d})}get primitiveType(){return 5}}J.shader=new W.a(I.a,(()=>i.e(194).then(i.bind(null,1146))));class $ extends Q.a{constructor(){super(...arguments),this.polygonOffsetEnabled=!1}}Object(s.a)([Object(Q.b)()],$.prototype,"polygonOffsetEnabled",void 0);class K extends U.a{constructor(e){super(e,Y),this.techniqueConfig=new $}getTechniqueConfig(){return this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig}dispose(){}getPassParameters(){return this.params}intersect(){}createBufferWriter(){return new re}getGLMaterial(e){return 0===e.output?new X(e):void 0}}class X extends q.a{constructor(e){super(e),this.updateParameters()}updateParameters(){this._technique=this._techniqueRep.releaseAndAcquire(J,this._material.getTechniqueConfig(),this._technique)}beginSlot(e){return 3===e}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}}const Y={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1,...U.b},Z=Object(T.a)().vec3f("position").vec3f("normal").vec2f("uv0").f32("auxpos1"),ee=Object(g.e)(),te=Object(g.e)(),ie=Object(g.e)(),se=Object(g.e)(),ae=Object(g.e)();class re{constructor(){this.vertexBufferLayout=Z}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get("position").length/2+1)}write(e,t,i,s){const a=t.vertexAttributes.get("position").data,r=t.vertexAttributes.get("normal").data,n=a.length/3,o=t&&t.indices&&t.indices.get("position");o&&o.length!==2*(n-1)&&console.warn("MeasurementArrowMaterial does not support indices");const l=ee,c=te,h=ie,d=se,u=ae,b=e.transformation,_=e.invTranspTransformation,g=i.position,O=i.normal,m=i.uv0;let j=0;for(let w=0;w<n;++w){const e=3*w;if(Object(p.y)(l,a[e],a[e+1],a[e+2]),w<n-1){const e=3*(w+1);Object(p.y)(c,a[e],a[e+1],a[e+2]),Object(p.y)(u,r[e],r[e+1],r[e+2]),Object(p.t)(u,u),Object(p.l)(h,c,l),Object(p.t)(h,h),Object(p.i)(d,u,h),Object(p.t)(d,d)}const t=Object(p.o)(l,c);b&&_&&(Object(p.s)(l,l,b),Object(p.s)(c,c,b),Object(p.s)(d,d,_));const i=s+2*w,o=i+1;g.setVec(i,l),g.setVec(o,l),O.setVec(i,d),O.setVec(o,d),m.set(i,0,j),m.set(i,1,-1),m.set(o,0,j),m.set(o,1,1),w<n-1&&(j+=t)}const v=i.auxpos1;for(let p=0;p<2*n;++p)v.set(s+p,j)}}class ne extends G.a{constructor(e){super(e),this._parameters=oe,this._handles=null,this._origin=Object(g.e)(),this._originTransform=Object(x.d)(),this._arrowCenter=Object(g.e)(),this._renderOccluded=4,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial.setParameterValues({stripeEvenColor:e})}}createExternalResources(){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial=new K({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:e,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new h.a,this._handles.add(this.view.state.watch("camera",(()=>{this.viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(Object(a.i)(this._geometry)||Object(a.i)(this._geometry.startRenderSpace)||Object(a.i)(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()}_createArrowGeometry(e,t,i,s){const a=this.view.renderCoordsHelper,r=[],n=[],o=(e,t)=>{const s=A.c.get();Object(p.l)(s,e,i),r.push(s),n.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=A.c.get();a.worldUpAtPosition(this._arrowCenter,i),o(e,i),o(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),r=A.c.get(),n=A.c.get();s.eval(i,r),a.worldUpAtPosition(r,n),o(r,n)}}return R.a.createPolylineGeometry(r,n)}geometryChanged(){this.recreateGeometry()}viewChanged(){if(this.view.ready&&this.attached&&Object(a.j)(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}}}const oe={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};var le=i(16),ce=i(40),he=i(100),de=i(550),ue=i(341);class be extends G.a{constructor(e){super(e),this._handles=new h.a,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=Object(g.e)(),this._up=Object(g.e)(),this._right=Object(g.e)(),this._renderOccluded=4,this._color=Object(P.c)(1,0,0,1),this._outlineColor=Object(P.c)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){Object(ce.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(ce.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min(Object(p.o)(t,e),Object(p.o)(t,i))/3,Object(p.t)(this._up,Object(p.l)(this._up,e,t)),Object(p.t)(this._right,Object(p.l)(this._right,i,t)),Object(p.m)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new de.a(this.quadMaterialParameters),this._outlineMaterial=new ue.a(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=Object(p.h)(A.c.get(),this._up,this._right),i=R.a.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,i);Object(le.i)(_e),Object(le.t)(_e,_e,this._position),Object(le.s)(_e,_e,[s,s,s]),Object(a.j)(e)&&(e.transformation=_e)}_quadGeometryData(e,t){const i=Object(p.h)(A.c.get(),e,t);return new he.a([["position",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}const _e=Object(x.d)();var pe=i(949),ge=i(950),Oe=i(461),me=i(125),je=i(232);let ve=class extends c.a{constructor(e){super(e),this._params={...ye},this._handles=new h.a,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=Object(g.e)(),this._endPosition=Object(g.e)(),this._cornerPosition=Object(g.e)(),this._startPositionAtSeaLevel=Object(g.e)(),this._endPositionAtSeaLevel=Object(g.e)(),this._state=0,this._segmentLabelDisplayedMeasurement=1,this._triangleOrientationOverride=null,this.messages=null,this.viewMode=0,this.visualizedMeasurement=0,this.actualVisualizedMeasurement=1,this.visualElementOrientation=0,this.triangleCollapseRatioThreshold=.03}get _geodesicDistanceExceeded(){var e;const t=this.layerView.result;return Object(a.j)(t)&&(null==(e=t.horizontalDistance)?void 0:e.value)>this.layer.geodesicDistanceThreshold}get ready(){return 1===this._state}get visible(){return this.layerView.visible&&!this.layerView.suspended}get allowVisualElementsOrientationChange(){return Object(a.i)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){Object(a.i)(this._triangleOrientationOverride)!==e&&(Object(a.i)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._getActualVisualElementsOrientation():this._triangleOrientationOverride=null)}get labels(){return 2===this.actualVisualizedMeasurement?{direct:this._horizontalLabel,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement.stripeLength}}initialize(){this._handles.add(Object(b.j)(this.view,"ready",(()=>this._initialize()),!0))}_initialize(){switch(this._state){case 1:throw new Error("invalid state");case 2:return}const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new ne({...t,geometry:null,renderOccluded:4}),this._triangleVisualElement=new D.a({...t,width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:4}),this._rightAngleQuad=new be({...t,color:we,renderOccluded:4});const i={...t,polygonOffset:!0,stippleIntegerRepeats:!1,renderOccluded:4};this._projectedGeodesicLine=new D.a({...i,width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:Object(Oe.b)(e.guideStippleLengthPixels)}),this._geodesicStartHint=new D.a({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:Object(Oe.b)(e.guideStippleLengthPixels)}),this._geodesicEndHint=new D.a({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:Object(Oe.b)(e.guideStippleLengthPixels)}),this._segmentLabel=new E.a({...t,fontSize:e.direcLabelFontSize}),this._verticalLabel=new E.a({...t,fontSize:e.verticalLabelFontSize}),this._horizontalLabel=new E.a({...t,fontSize:e.horizontalLabelFontSize}),this._handles.add([Object(_.a)((()=>this._updateGeometryAndViewMode())),Object(_.a)((()=>this._updateVisualElementVisibility())),Object(_.a)((()=>this._updateLabelText())),Object(_.a)((()=>this._updateLabelVisibility())),Object(_.a)((()=>this._updateSegmentStripeLength())),Object(me.c)((async()=>this._updateMessageBundle()))]),this._state=1,this._updateMessageBundle()}destroy(){2!==this._state&&(this._handles=Object(a.e)(this._handles),this._segmentVisualElement=Object(a.e)(this._segmentVisualElement),this._triangleVisualElement=Object(a.e)(this._triangleVisualElement),this._rightAngleQuad=Object(a.e)(this._rightAngleQuad),this._projectedGeodesicLine=Object(a.e)(this._projectedGeodesicLine),this._geodesicStartHint=Object(a.e)(this._geodesicStartHint),this._geodesicEndHint=Object(a.e)(this._geodesicEndHint),this._segmentLabel=Object(a.e)(this._segmentLabel),this._verticalLabel=Object(a.e)(this._verticalLabel),this._horizontalLabel=Object(a.e)(this._horizontalLabel),this.set("view",null),this._state=2)}async whenReady(){await Object(b.j)(this,"ready")}async whenMessages(){await this.whenReady(),await Object(b.j)(this,"messages")}_updateVisualElementVisibility(){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,this.visible)switch(this.viewMode){case 0:break;case 1:this._segmentVisualElement.visible=!0;break;case 2:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case 3:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode(){const e=this.view.renderCoordsHelper,{startPoint:t,endPoint:i}=this.layer;if(Object(a.i)(t)||Object(a.i)(i)||t.equals(i)){this.viewMode=0;const e=this.visualizedMeasurement,t=0===e;return void(this.actualVisualizedMeasurement=t?1:e)}e.toRenderCoords(t,this._startPosition),e.toRenderCoords(i,this._endPosition);const s=this._getActualVisualElementsOrientation(),r=this._updateActualVisualizedMeasurement();this.viewMode=this._computeViewMode(r);let n=this._startPosition,o=this._endPosition;const l=1===s?1:-1,c=l*(e.getAltitude(o)-e.getAltitude(n));c<0&&(n=this._endPosition,o=this._startPosition);const h=2===r?new pe.b(this._startPosition,this._endPosition,e.spatialReference):new pe.a(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=h,this._updateSegmentStripeLength(),this._segmentLabelDisplayedMeasurement=r,this.viewMode){case 1:this._updateSegment(h,s);break;case 2:this._updateSegmentAndTriangle(h,s,n,o,l,c);break;case 3:this._updateSegmentAndProjection(s)}}_updateSegment(e,t){this._segmentLabel.anchor=1===t?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle(e,t,i,s,a,r){const n=this.view,o=n.renderCoordsHelper,l=n.state.camera,c=this._cornerPosition;o.worldUpAtPosition(i,c),Object(p.g)(c,c,a*Math.abs(r)),Object(p.h)(c,c,i),this._triangleVisualElement.geometry=[[[i[0],i[1],i[2]],[c[0],c[1],c[2]],[s[0],s[1],s[2]]]],this._rightAngleQuad.geometry={previous:i,center:c,next:s};const h=new pe.a(i,c),u=new pe.a(c,s),b=function(e,t,i,s,a){const r=Le,n=ze;a.projectToRenderScreen(i,r),a.projectToRenderScreen(t,n);const o={segment:"bottom",horizontal:"top",vertical:r[0]<n[0]?"left":"right"};{const s=Me,r=Ce;if(Object(ge.b)(e,i,s,a),Object(ge.b)(e,t,r,a),Object(S.h)(s,r)>=fe){const e=Object(d.t)(s[1])===Object(d.t)(r[1]);o.segment=e?Object(E.b)(o.vertical):o.vertical}else{const e=Ve;Object(ge.b)(i,t,e,a),Object(S.h)(e,r)>=fe&&(o.segment=Object(d.t)(e[0])===Object(d.t)(r[0])?Object(E.b)(o.horizontal):o.horizontal)}}if(2===s){const e=e=>"top"===e?"bottom":"top";o.segment=e(o.segment),o.horizontal=e(o.horizontal),o.vertical=e(o.vertical)}return o}(i,s,c,t,l);this._segmentLabel.anchor=b.segment,this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._verticalLabel.anchor=b.vertical,this._horizontalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._horizontalLabel.anchor=b.horizontal}_updateSegmentAndProjection(e){const t=this.view.renderCoordsHelper;t.setAltitude(this._startPositionAtSeaLevel,0,this._startPosition),t.setAltitude(this._endPositionAtSeaLevel,0,this._endPosition);const i=new pe.b(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(i),this._geodesicStartHint.setGeometryFromSegment(new pe.a(this._startPositionAtSeaLevel,this._startPosition)),this._geodesicEndHint.setGeometryFromSegment(new pe.a(this._endPositionAtSeaLevel,this._endPosition)),this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._segmentLabel.anchor=1===e?"top":"bottom"}_updateLabelText(){if(1!==this._state)return;const e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel,s=this.messages,r=this.layerView.result;if(Object(a.i)(r)||Object(a.i)(s))return e.text=null,t.text=null,void(i.text=null);const n=this._getLabelsText(s,r),o=1===this._segmentLabelDisplayedMeasurement;e.text=o?n.euclideanDistance:n.geodesicDistance,t.text=n.horizontalDistance,i.text=n.verticalDistance,this.notifyChange("labels")}_updateLabelVisibility(){if(1!==this._state)return;const e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel;if(e.visible=!1,t.visible=!1,i.visible=!1,this.visible)switch(this.viewMode){case 1:e.visible=!0;break;case 2:e.visible=!0,t.visible=!0,i.visible=!0;break;case 3:e.visible=!0}}_getLabelsText(e,{directDistance:t,horizontalDistance:i,verticalDistance:s,geodesicDistance:a,geodesicAngle:r}){const n=this.layerView.unit,o=e=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(n){case"metric":return o({euclideanDistance:t&&Object(M.e)(e,t),geodesicDistance:a&&Object(M.e)(e,a),horizontalDistance:i&&Object(M.e)(e,i),verticalDistance:s&&Object(M.f)(e,s)});case"imperial":return o({euclideanDistance:t&&Object(M.c)(e,t),geodesicDistance:a&&Object(M.c)(e,a),horizontalDistance:i&&Object(M.c)(e,i),verticalDistance:s&&Object(M.d)(e,s)});case"degrees":{const t=r&&Object(M.b)(e,r,"degrees");return o({euclideanDistance:t,geodesicDistance:t,horizontalDistance:t})}case"degrees-minutes-seconds":return o({horizontalDistance:r&&Object(M.a)(r)});default:return o({euclideanDistance:t&&Object(M.b)(e,t,n),geodesicDistance:a&&Object(M.b)(e,a,n),horizontalDistance:i&&Object(M.b)(e,i,n),verticalDistance:s&&Object(M.b)(e,s,n)})}}_updateSegmentStripeLength(){const e=this._measurementArrowStripeLength,t=this._segmentVisualElement;Object(a.j)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}_computeViewMode(e){if(2===e){if(!this._geodesicDistanceExceeded)return 1;if(this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition))return 3}const t=this.layerView.result;if(Object(a.i)(t))return 1;const{verticalDistance:i,horizontalDistance:s}=t,r=i.value,n=s.value;return Math.min(r/n,n/r)<this.triangleCollapseRatioThreshold?1:2}_getActualVisualElementsOrientation(){if(Object(a.j)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return 0===e?this.view.state.camera.aboveGround?1:2:e}_updateActualVisualizedMeasurement(){if(0===this.visualizedMeasurement){this.actualVisualizedMeasurement=1;const e=this.layerView.unit;"degrees"!==e&&"degrees-minutes-seconds"!==e||(this.actualVisualizedMeasurement=2),this._geodesicDistanceExceeded&&(this.actualVisualizedMeasurement=2)}else this.actualVisualizedMeasurement=this.visualizedMeasurement;return this.actualVisualizedMeasurement}_requiresGeodesicGuideAt(e){const t=this.view;if(!t.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,a=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/a>=10}get _measurementArrowStripeLength(){const e=this.view,{result:t,unit:i}=this.layerView;let s=null;if(Object(a.j)(t)){const e=t.directDistance;switch(i){case"metric":s=e&&e.toUnit("meters");break;case"imperial":s=e&&e.toUnit(Object(V.p)(e.value,e.unit));break;case"degrees":case"degrees-minutes-seconds":{const e=t.geodesicAngle;s=e&&e.toUnit("degrees");break}default:s=e&&e.toUnit(i)}}if(s){let t=1;return t=Object(d.o)(s.value/30),t*="degrees"===s.unit?Object(v.e)(e.spatialReference).metersPerDegree:Object(V.c)(1,s.unit,"meters"),t}return null}_updateMessageBundle(){Object(je.a)("esri/core/t9n/Units").then((e=>{this.messages=e,this.view&&this._updateLabelText()}))}};Object(s.a)([Object(r.b)()],ve.prototype,"_state",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"_segmentLabelDisplayedMeasurement",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"_triangleOrientationOverride",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"_geodesicDistanceExceeded",null),Object(s.a)([Object(r.b)()],ve.prototype,"messages",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"view",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"layer",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"layerView",void 0),Object(s.a)([Object(r.b)({readOnly:!0})],ve.prototype,"ready",null),Object(s.a)([Object(r.b)({readOnly:!0})],ve.prototype,"visible",null),Object(s.a)([Object(r.b)()],ve.prototype,"viewMode",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"visualizedMeasurement",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"actualVisualizedMeasurement",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"visualElementOrientation",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"triangleCollapseRatioThreshold",void 0),Object(s.a)([Object(r.b)()],ve.prototype,"allowVisualElementsOrientationChange",null),Object(s.a)([Object(r.b)()],ve.prototype,"labels",null),Object(s.a)([Object(r.b)()],ve.prototype,"testData",null),Object(s.a)([Object(r.b)()],ve.prototype,"_measurementArrowStripeLength",null),ve=Object(s.a)([Object(n.a)("esri.views.3d.layers.DirectLineMeasurement.DirectLineMeasurementView")],ve);const we=Object(P.c)(1,.5,0,.75),ye={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:we,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:we,guideLineWidth:2,guideLineColor:we,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},fe=Math.cos(Object(d.g)(12)),Le=Object(C.d)(),ze=Object(C.d)(),Me=Object(C.c)(),Ce=Object(C.c)(),Ve=Object(C.c)();var Se=i(562);let Pe=class extends(Object(l.a)(Se.a)){constructor(e){super(e),this._userUnit=null,this.type="direct-line-measurement-3d",this.result=null}set unit(e){this._userUnit=e}get unit(){return Object(a.t)(this._userUnit,this._defaultUnit)}get viewMode(){return this._analysisView.viewMode}get visualizedMeasurement(){return this._analysisView.visualizedMeasurement}set visualizedMeasurement(e){this._analysisView.visualizedMeasurement=e}get actualVisualizedMeasurement(){return this._analysisView.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisView.visualElementOrientation}set visualElementOrientation(e){this._analysisView.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisView.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisView.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisView.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisView.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisView.labels.direct.text}get horizontalLabelText(){return this._analysisView.labels.horizontal.text}get verticalLabelText(){return this._analysisView.labels.vertical.text}get testData(){return this._analysisView.testData}initialize(){const e=this.view,t=this.layer;this._analysisView=new ve({view:e,layer:t,layerView:this}),this._analysisController=new f({view:e,layer:t,viewData:this})}destroy(){Object(a.e)(this._analysisController),Object(a.e)(this._analysisView)}whenReady(){return this._analysisView.whenReady()}whenMessages(){return this._analysisView.whenMessages()}};Object(s.a)([Object(r.b)(o.a)],Pe.prototype,"_defaultUnit",void 0),Object(s.a)([Object(r.b)()],Pe.prototype,"_userUnit",void 0),Object(s.a)([Object(r.b)()],Pe.prototype,"_analysisView",void 0),Object(s.a)([Object(r.b)()],Pe.prototype,"_analysisController",void 0),Object(s.a)([Object(r.b)()],Pe.prototype,"type",void 0),Object(s.a)([Object(r.b)()],Pe.prototype,"unit",null),Object(s.a)([Object(r.b)()],Pe.prototype,"layer",void 0),Object(s.a)([Object(r.b)()],Pe.prototype,"result",void 0),Object(s.a)([Object(r.b)({readOnly:!0})],Pe.prototype,"viewMode",null),Object(s.a)([Object(r.b)()],Pe.prototype,"visualizedMeasurement",null),Object(s.a)([Object(r.b)({readOnly:!0})],Pe.prototype,"actualVisualizedMeasurement",null),Object(s.a)([Object(r.b)()],Pe.prototype,"visualElementOrientation",null),Object(s.a)([Object(r.b)()],Pe.prototype,"allowVisualElementsOrientationChange",null),Object(s.a)([Object(r.b)()],Pe.prototype,"triangleCollapseRatioThreshold",null),Object(s.a)([Object(r.b)({readOnly:!0})],Pe.prototype,"directLabelText",null),Object(s.a)([Object(r.b)({readOnly:!0})],Pe.prototype,"horizontalLabelText",null),Object(s.a)([Object(r.b)({readOnly:!0})],Pe.prototype,"verticalLabelText",null),Object(s.a)([Object(r.b)()],Pe.prototype,"testData",null),Pe=Object(s.a)([Object(n.a)("esri.views.3d.layers.DirectLineMeasurementLayerView3D")],Pe);var Ee=Pe;t.default=Ee},904:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));var s=i(6),a=i(73);function r(){const e=new a.a;e.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),e.attributes.add("position","vec3"),e.attributes.add("normal","vec3"),e.attributes.add("uv0","vec2"),e.attributes.add("auxpos1","float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),e.vertex.code.add(s.a`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),e.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");const t=1/Math.sqrt(2);return e.fragment.code.add(s.a`
    const float INV_SQRT2 = ${s.a.float(t)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),e}var n=Object.freeze({__proto__:null,build:r})}}]);
//# sourceMappingURL=92.dcf6f386.chunk.js.map